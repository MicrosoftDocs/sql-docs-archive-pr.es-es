---
title: Hacer copia de seguridad de una base de datos con tablas con optimización para memoria | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: 83d47694-e56d-4dae-b54e-14945bf8ba31
author: CarlRabeler
ms.author: carlrab
ms.openlocfilehash: 176448aa9d4bab4101ab2db12ffc9a8a7fd1a5b5
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87663470"
---
# <a name="backing-up-a-database-with-memory-optimized-tables"></a><span data-ttu-id="701f1-102">Hacer copia de seguridad de una base de datos con tablas con optimización para memoria</span><span class="sxs-lookup"><span data-stu-id="701f1-102">Backing Up a Database with Memory-Optimized Tables</span></span>
  <span data-ttu-id="701f1-103">La copia de seguridad de las tablas con optimización para memoria se realiza como parte de las copias de seguridad periódicas de las bases de datos.</span><span class="sxs-lookup"><span data-stu-id="701f1-103">Memory-optimized tables are backed up as part of regular database backups.</span></span> <span data-ttu-id="701f1-104">En cuanto a las tablas basadas en disco, la función CHECKSUM de los pares de archivos de datos y delta se valida como parte de la copia de seguridad de la base de datos para detectar si hay daños en el almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="701f1-104">As for disk-based tables, the CHECKSUM of data and delta file pairs is validated as part of the database backup to detect storage corruption.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="701f1-105">Durante una copia de seguridad, si detecta un error de suma de comprobación en uno o más archivos de un grupo de archivos optimizados para memoria, no podrá restaurar y reiniciar la base de datos.</span><span class="sxs-lookup"><span data-stu-id="701f1-105">During a backup, if you detect a CHECKSUM error in one or more files in a memory-optimized filegroup, you will not be able to restore and restart the database.</span></span> <span data-ttu-id="701f1-106">En esa situación, debe restaurar la base de datos con la última copia de seguridad buena conocida.</span><span class="sxs-lookup"><span data-stu-id="701f1-106">In that situation, you must, restore your database with the last known good backup.</span></span> <span data-ttu-id="701f1-107">Si no tiene una copia de seguridad, puede exportar los datos de las tablas optimizadas para memoria y las tablas basadas en disco, y recargarlos después de quitar y volver a crear la base de datos.</span><span class="sxs-lookup"><span data-stu-id="701f1-107">If you don't have a backup, you can export the data from memory-optimized tables and disk-based tables and reload after you drop and recreate the database.</span></span>  
  
 <span data-ttu-id="701f1-108">Una copia de seguridad completa de una base de datos con una o más tablas optimizadas para memoria consta del almacenamiento asignado para las tablas basadas en disco (si existen), el registro de transacciones activo, y los pares de archivos de datos y delta (también conocidos como pares de archivos de punto de comprobación) para las tablas optimizadas para memoria.</span><span class="sxs-lookup"><span data-stu-id="701f1-108">A full backup of a database with one or more memory-optimized tables consists of the allocated storage for disk-based tables (if any), the active transaction log, and the data and delta file pairs (also known as checkpoint file pairs) for memory-optimized tables.</span></span> <span data-ttu-id="701f1-109">Pero como se describe en [Durabilidad de las tablas optimizadas para memoria](memory-optimized-tables.md), el almacenamiento que usan las tablas optimizadas para memoria puede ser mucho mayor que el tamaño de la memoria y eso afecta al tamaño de la copia de seguridad de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="701f1-109">However, as described in [Durability for Memory-Optimized Tables](memory-optimized-tables.md), the storage used by memory-optimized tables can be much larger than its size in memory, and it affects the size of the database backup.</span></span>  
  
## <a name="full-database-backup"></a><span data-ttu-id="701f1-110">Copia de seguridad completa de base de datos</span><span class="sxs-lookup"><span data-stu-id="701f1-110">Full Database Backup</span></span>  
 <span data-ttu-id="701f1-111">Esta explicación se centrará en las copias de seguridad de las bases de datos que solo tienen tablas durables optimizadas para memoria, ya que la copia de seguridad para las tablas basadas en disco es igual.</span><span class="sxs-lookup"><span data-stu-id="701f1-111">This discussion will focus on database backups for databases with just durable memory-optimized tables, because the backup for disk-based tables is the same.</span></span> <span data-ttu-id="701f1-112">Los pares de archivos de punto de comprobación del grupo de archivos optimizados para memoria pueden estar en varios estados.</span><span class="sxs-lookup"><span data-stu-id="701f1-112">The checkpoint file pairs in the memory-optimized filegroup could be in various states.</span></span> <span data-ttu-id="701f1-113">En la tabla siguiente se describe de qué parte de los archivos se hace copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="701f1-113">The table below describes what part of the files is backed.</span></span>  
  
|<span data-ttu-id="701f1-114">Estado del par de archivos de punto de comprobación</span><span class="sxs-lookup"><span data-stu-id="701f1-114">Checkpoint File Pair State</span></span>|<span data-ttu-id="701f1-115">Copia de seguridad</span><span class="sxs-lookup"><span data-stu-id="701f1-115">Backup</span></span>|  
|--------------------------------|------------|  
|<span data-ttu-id="701f1-116">PRECREATED</span><span class="sxs-lookup"><span data-stu-id="701f1-116">PRECREATED</span></span>|<span data-ttu-id="701f1-117">Solo metadatos de archivo</span><span class="sxs-lookup"><span data-stu-id="701f1-117">File metadata only</span></span>|  
|<span data-ttu-id="701f1-118">UNDER CONSTRUCTION</span><span class="sxs-lookup"><span data-stu-id="701f1-118">UNDER CONSTRUCTION</span></span>|<span data-ttu-id="701f1-119">Solo metadatos de archivo</span><span class="sxs-lookup"><span data-stu-id="701f1-119">File metadata only</span></span>|  
|<span data-ttu-id="701f1-120">Active</span><span class="sxs-lookup"><span data-stu-id="701f1-120">Active</span></span>|<span data-ttu-id="701f1-121">Metadatos de archivo y bytes usados</span><span class="sxs-lookup"><span data-stu-id="701f1-121">File metadata plus used bytes</span></span>|  
|<span data-ttu-id="701f1-122">Merge source</span><span class="sxs-lookup"><span data-stu-id="701f1-122">Merge source</span></span>|<span data-ttu-id="701f1-123">Metadatos de archivo y bytes usados</span><span class="sxs-lookup"><span data-stu-id="701f1-123">File metadata plus used bytes</span></span>|  
|<span data-ttu-id="701f1-124">Merge target</span><span class="sxs-lookup"><span data-stu-id="701f1-124">Merge target</span></span>|<span data-ttu-id="701f1-125">Solo metadatos de archivo</span><span class="sxs-lookup"><span data-stu-id="701f1-125">File metadata only</span></span>|  
|<span data-ttu-id="701f1-126">REQUIRED FOR BACKUP/HA</span><span class="sxs-lookup"><span data-stu-id="701f1-126">REQUIRED FOR BACKUP/HA</span></span>|<span data-ttu-id="701f1-127">Metadatos de archivo y bytes usados</span><span class="sxs-lookup"><span data-stu-id="701f1-127">File metadata plus used bytes</span></span>|  
|<span data-ttu-id="701f1-128">IN TRANSITION TO TOMBSTONE</span><span class="sxs-lookup"><span data-stu-id="701f1-128">IN TRANSITION TO TOMBSTONE</span></span>|<span data-ttu-id="701f1-129">Solo metadatos de archivo</span><span class="sxs-lookup"><span data-stu-id="701f1-129">File metadata only</span></span>|  
|<span data-ttu-id="701f1-130">TOMBSTONE</span><span class="sxs-lookup"><span data-stu-id="701f1-130">TOMBSTONE</span></span>|<span data-ttu-id="701f1-131">Solo metadatos de archivo</span><span class="sxs-lookup"><span data-stu-id="701f1-131">File metadata only</span></span>|  
  
 <span data-ttu-id="701f1-132">El tamaño de las copias de seguridad de base de datos con una o más tablas optimizadas para memoria suele ser mayor que su tamaño en memoria pero menor que el almacenamiento en disco.</span><span class="sxs-lookup"><span data-stu-id="701f1-132">The size of database backups with one or more memory-optimized tables is typically larger than its size in memory but smaller than the on-disk storage.</span></span> <span data-ttu-id="701f1-133">El tamaño adicional dependerá del número de filas eliminadas y el número de pares de archivos de punto de comprobación que estén en los estados Merge source y REQUIRED FOR BACKUP/HA, lo que depende indirectamente de la carga de trabajo.</span><span class="sxs-lookup"><span data-stu-id="701f1-133">The extra size will depend upon the number of deleted rows and the number of checkpoint file pairs in the states Merge source and REQUIRED FOR BACKUP/HA which indirectly depends upon the workload.</span></span> <span data-ttu-id="701f1-134">Para obtener descripciones de los Estados de los pares de archivos de punto de comprobación, vea [Sys. dm_db_xtp_checkpoint_files &#40;&#41;de Transact-SQL ](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="701f1-134">For descriptions of the states for checkpoint file pairs, see [sys.dm_db_xtp_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql).</span></span>  
  
### <a name="estimating-size-of-full-database-backup"></a><span data-ttu-id="701f1-135">Estimar el tamaño de una copia de seguridad completa de base de datos</span><span class="sxs-lookup"><span data-stu-id="701f1-135">Estimating Size of Full Database Backup</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="701f1-136">Se recomienda no usar el valor BackupSizeInBytes para estimar el tamaño de la copia de seguridad para OLTP en memoria.</span><span class="sxs-lookup"><span data-stu-id="701f1-136">It's recommended that you not use the BackupSizeInBytes value to estimate the backup size for In-Memory OLTP.</span></span>  
  
 <span data-ttu-id="701f1-137">El primer escenario de carga de trabajo es (principalmente) para operaciones de inserción.</span><span class="sxs-lookup"><span data-stu-id="701f1-137">The first workload scenario is for (mostly) insert.</span></span> <span data-ttu-id="701f1-138">En este escenario, la mayoría de los archivos de datos estarán en el estado Active, totalmente cargados y con muy pocas filas eliminadas.</span><span class="sxs-lookup"><span data-stu-id="701f1-138">In this scenario, most data files will be in the Active state, fully loaded, and with very few deleted rows.</span></span> <span data-ttu-id="701f1-139">El tamaño de la copia de seguridad de base de datos será similar al tamaño de los datos en memoria.</span><span class="sxs-lookup"><span data-stu-id="701f1-139">The size of database backup up will be close to the size of data in memory.</span></span>  
  
 <span data-ttu-id="701f1-140">El segundo escenario de carga de trabajo es para operaciones frecuentes de inserción, eliminación y actualización: en el peor de los casos, cada uno de los pares de archivos de punto de comprobación están cargados al 50 %, después de contar las filas eliminadas.</span><span class="sxs-lookup"><span data-stu-id="701f1-140">The second workload scenario is for frequent insert, delete, and update operations: In the worst case, each of the checkpoint file pairs are 50% loaded, after accounting for the deleted rows.</span></span> <span data-ttu-id="701f1-141">Por tanto, el tamaño de la copia de seguridad de base de datos será al menos el doble que el tamaño de los datos en memoria.</span><span class="sxs-lookup"><span data-stu-id="701f1-141">So the size of the database backup will at least be 2 times the size of data in memory.</span></span> <span data-ttu-id="701f1-142">Además, habrá pocos pares de archivos de punto de comprobación en los estados Merge source y Required for backup/high availability que aumenten el tamaño de la copia de seguridad de base de datos.</span><span class="sxs-lookup"><span data-stu-id="701f1-142">Additionally, there will few checkpoint file pairs in states Merge source and Required for backup/high availability that will add to the size of database backup.</span></span>  
  
## <a name="differential-backups-of-databases-with-memory-optimized-tables"></a><span data-ttu-id="701f1-143">Copias de seguridad diferenciales de bases de datos con tablas con optimización para memoria</span><span class="sxs-lookup"><span data-stu-id="701f1-143">Differential Backups of Databases with Memory-Optimized Tables</span></span>  
 <span data-ttu-id="701f1-144">El almacenamiento de las tablas optimizadas para memoria consta de archivos delta y de datos como se describe en [Durabilidad de las tablas optimizadas para memoria](memory-optimized-tables.md).</span><span class="sxs-lookup"><span data-stu-id="701f1-144">The storage for memory-optimized tables consists of data and delta files as described in [Durability for Memory-Optimized Tables](memory-optimized-tables.md).</span></span> <span data-ttu-id="701f1-145">La copia de seguridad diferencial de una base de datos con tablas optimizadas para memoria contiene los datos siguientes:</span><span class="sxs-lookup"><span data-stu-id="701f1-145">The differential backup of a database with memory-optimized tables contains the following data:</span></span>  
  
-   <span data-ttu-id="701f1-146">La copia de seguridad diferencial de los grupos de archivos que almacenan las tablas basadas en disco no se ve afectada por la presencia de tablas optimizadas para memoria.</span><span class="sxs-lookup"><span data-stu-id="701f1-146">Differential backup for filegroups storing disk-based tables is not affected by the presence of memory-optimized tables.</span></span>  
  
-   <span data-ttu-id="701f1-147">El registro de transacciones activo es igual que en una copia de seguridad completa de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="701f1-147">The active transaction log is the same as in a full database backup.</span></span>  
  
-   <span data-ttu-id="701f1-148">Para un grupo de archivos de datos optimizados para memoria, la copia de seguridad diferencial utiliza el mismo algoritmo que la copia de seguridad completa de la base de datos para identificar los archivos delta y de datos de la copia de seguridad pero después filtra el subconjunto de archivos como sigue:</span><span class="sxs-lookup"><span data-stu-id="701f1-148">For a memory-optimized data filegroup, the differential backup uses the same algorithm as full database backup to identify the data and delta files for backup but it then filters out the subset of files as follows:</span></span>  
  
    -   <span data-ttu-id="701f1-149">Un archivo de datos contiene filas recién insertadas y cuando está lleno, se cierra y se marca como de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="701f1-149">A data file contains newly inserted rows and when it is full, it is closed and marked read-only.</span></span> <span data-ttu-id="701f1-150">Se hace una copia de seguridad de un archivo de datos solo si se ha cerrado después de la última copia de seguridad completa de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="701f1-150">A data file is backed up only if it was closed after the last full database backup.</span></span> <span data-ttu-id="701f1-151">Las copias de seguridad diferenciales solo hacen copia de seguridad de los archivos de datos que contienen las filas insertadas desde la última copia de seguridad completa de la base de datos con la excepción de un escenario de actualización y eliminación donde es posible que algunas filas insertadas se hayan marcado ya para recolección de elementos no utilizados o se hayan eliminado ya mediante el recolector de elementos no utilizados.</span><span class="sxs-lookup"><span data-stu-id="701f1-151">The differential backup only backups up data files containing the inserted rows since the last full database backup with the exception of an update and delete scenario where it is possible that some of the inserted rows may have already been either marked for garbage collection or already garbage collected.</span></span>  
  
    -   <span data-ttu-id="701f1-152">Los archivos delta almacenan las referencias a las filas de datos eliminadas.</span><span class="sxs-lookup"><span data-stu-id="701f1-152">A delta file stores references to the deleted data rows.</span></span> <span data-ttu-id="701f1-153">Puesto que las transacciones futuras pueden eliminar una fila, un archivo delta se puede modificar en cualquier momento durante su tiempo de vida, nunca se cierra.</span><span class="sxs-lookup"><span data-stu-id="701f1-153">Since any future transaction can delete a row, a delta file can be modified anytime in its life time, it is never closed.</span></span> <span data-ttu-id="701f1-154">Siempre se hace una copia de seguridad de un archivo delta.</span><span class="sxs-lookup"><span data-stu-id="701f1-154">A delta file is always backed up.</span></span> <span data-ttu-id="701f1-155">Los archivos delta suelen utilizar menos del 10 % del almacenamiento, de modo que los archivos delta tienen un efecto mínimo en el tamaño de la copia de seguridad diferencial.</span><span class="sxs-lookup"><span data-stu-id="701f1-155">Delta files typically use less than 10% of the storage, so delta files have a minimal impact on the size of differential backup.</span></span>  
  
 <span data-ttu-id="701f1-156">Si las tablas optimizadas para memoria son una parte significativa del tamaño de la base de datos, la copia de seguridad diferencial puede reducir considerablemente el tamaño de la copia de seguridad de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="701f1-156">If memory-optimized tables are a significant portion of your database size, the differential backup can significantly reduce the size of your database backup.</span></span>  
  
 <span data-ttu-id="701f1-157">Para las cargas de trabajo OLTP habituales, las copias de seguridad diferenciales serán mucho menores que las copias de seguridad completas de base de datos.</span><span class="sxs-lookup"><span data-stu-id="701f1-157">For typical OLTP workloads, the differential backups will be considerably smaller than the full database backups.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="701f1-158">Consulte también</span><span class="sxs-lookup"><span data-stu-id="701f1-158">See Also</span></span>  
 [<span data-ttu-id="701f1-159">Hacer copia de seguridad, restaurar y recuperar tablas con optimización para memoria</span><span class="sxs-lookup"><span data-stu-id="701f1-159">Backup, Restore, and Recovery of Memory-Optimized Tables</span></span>](restore-and-recovery-of-memory-optimized-tables.md)  
  
  
