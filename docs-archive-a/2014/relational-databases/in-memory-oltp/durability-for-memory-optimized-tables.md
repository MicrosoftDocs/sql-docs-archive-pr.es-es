---
title: Durabilidad de las tablas con optimización para memoria | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: d304c94d-3ab4-47b0-905d-3c8c2aba9db6
author: CarlRabeler
ms.author: carlrab
ms.openlocfilehash: 1d48d671b23d7b7b17557e7829d6f2522c375acd
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87748798"
---
# <a name="durability-for-memory-optimized-tables"></a><span data-ttu-id="c7c87-102">Durabilidad de las tablas con optimización para memoria</span><span class="sxs-lookup"><span data-stu-id="c7c87-102">Durability for Memory-Optimized Tables</span></span>
  [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] <span data-ttu-id="c7c87-103">proporciona durabilidad total para las tablas optimizadas para memoria.</span><span class="sxs-lookup"><span data-stu-id="c7c87-103">provides full durability for memory-optimized tables.</span></span> <span data-ttu-id="c7c87-104">Cuando una transacción que ha cambiado una tabla optimizada para memoria se confirma, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (como hace para las tablas basadas en disco) garantiza que los cambios son permanentes (sobrevivirán a un reinicio de la base de datos), siempre y cuando el almacenamiento subyacente esté disponible.</span><span class="sxs-lookup"><span data-stu-id="c7c87-104">When a transaction that changed a memory-optimized table commits, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (as it does for disk-based tables), guarantees that the changes are permanent (will survive a database restart), provided the underlying storage is available.</span></span> <span data-ttu-id="c7c87-105">Hay dos componentes clave de durabilidad: registro de transacciones y conservación de los cambios de los datos en el almacenamiento en disco.</span><span class="sxs-lookup"><span data-stu-id="c7c87-105">There are two key components of durability: transaction logging and persisting data changes to on-disk storage.</span></span>

## <a name="transaction-log"></a><span data-ttu-id="c7c87-106">Registro de transacciones</span><span class="sxs-lookup"><span data-stu-id="c7c87-106">Transaction Log</span></span>
 <span data-ttu-id="c7c87-107">Todos los cambios realizados en tablas basadas en disco o en tablas optimizadas para memoria se capturan en una o más entradas del registro de transacciones.</span><span class="sxs-lookup"><span data-stu-id="c7c87-107">All changes made to disk-based tables or durable memory-optimized tables are captured in one or more transaction log records.</span></span> <span data-ttu-id="c7c87-108">Cuando se confirma una transacción, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] escribe en el disco las entradas de registro asociadas a la transacción antes de comunicar a la aplicación o a la sesión de usuario que la transacción se ha confirmado.</span><span class="sxs-lookup"><span data-stu-id="c7c87-108">When a transaction commits, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] writes the log records associated with the transaction to disk before communicating to the application or user session that the transaction has committed.</span></span> <span data-ttu-id="c7c87-109">Esto garantiza que los cambios realizados por la transacción sean durables.</span><span class="sxs-lookup"><span data-stu-id="c7c87-109">This guarantees that changes made by the transaction are durable.</span></span> <span data-ttu-id="c7c87-110">El registro de transacciones para las tablas optimizadas para memoria está totalmente integrado con el mismo flujo de registro que emplean las tablas basadas en disco.</span><span class="sxs-lookup"><span data-stu-id="c7c87-110">The transaction log for memory-optimized tables is fully integrated with the same log stream used by disk-based tables.</span></span> <span data-ttu-id="c7c87-111">Esta integración permite que las operaciones de copia de seguridad, recuperación y restauración de registros de transacciones existentes sigan funcionando sin necesidad de realizar ningún paso adicional.</span><span class="sxs-lookup"><span data-stu-id="c7c87-111">This integration allows existing transaction log backup, recover, and restore operations to continue to work without requiring any additional steps.</span></span> <span data-ttu-id="c7c87-112">Sin embargo, puesto que [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] puede mejorar considerablemente el rendimiento de transacciones de la carga de trabajo, debe asegurarse de que el almacenamiento del registro de transacciones está configurado correctamente para controlar los requisitos crecientes de E/S.</span><span class="sxs-lookup"><span data-stu-id="c7c87-112">However, since [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] can increase transaction throughput of your workload significantly, you need to make sure that transaction log storage is configured appropriately to handle the increased IO requirements.</span></span>

## <a name="data-and-delta-files"></a><span data-ttu-id="c7c87-113">Archivos delta y de datos</span><span class="sxs-lookup"><span data-stu-id="c7c87-113">Data and Delta Files</span></span>
 <span data-ttu-id="c7c87-114">Los datos de las tablas optimizadas para memoria se almacenan en memoria como filas de datos de forma libre que se vinculan mediante uno o varios índices en memoria.</span><span class="sxs-lookup"><span data-stu-id="c7c87-114">The data in memory-optimized tables is stored as free-form data rows that are linked through one or more in-memory indexes, in memory.</span></span> <span data-ttu-id="c7c87-115">No hay ninguna estructura de página para las filas de datos, como las empleadas para las tablas basadas en disco.</span><span class="sxs-lookup"><span data-stu-id="c7c87-115">There are no page structures for data rows, such as those used for disk-based tables.</span></span> <span data-ttu-id="c7c87-116">Cuando la aplicación está lista para confirmar la transacción, [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] genera las entradas del registro para la transacción.</span><span class="sxs-lookup"><span data-stu-id="c7c87-116">When the application is ready to commit the transaction, the [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] generates the log records for the transaction.</span></span> <span data-ttu-id="c7c87-117">La persistencia de las tablas optimizadas para memoria se realiza con un conjunto de archivos de datos y delta mediante un subproceso en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="c7c87-117">The persistence of memory-optimized tables is done with a set of data and delta files using a background thread.</span></span> <span data-ttu-id="c7c87-118">Los archivos de datos y delta se encuentran en uno o varios contenedores (con el mismo mecanismo empleado para los datos FILESTREAM).</span><span class="sxs-lookup"><span data-stu-id="c7c87-118">The data and delta files are located in one or more containers (using the same mechanism used for FILESTREAM data).</span></span> <span data-ttu-id="c7c87-119">Estos contenedores se asignan a un nuevo tipo de grupo de archivos, denominado un grupo de archivos optimizados para memoria.</span><span class="sxs-lookup"><span data-stu-id="c7c87-119">These containers are mapped to a new type of filegroup, called a memory-optimized filegroup.</span></span>

 <span data-ttu-id="c7c87-120">Los datos se escriben en estos archivos de un modo estrictamente secuencial, lo que reduce la latencia de disco para las unidades de disco.</span><span class="sxs-lookup"><span data-stu-id="c7c87-120">Data is written to these files in a strictly sequential fashion, which minimizes disk latency for spinning media.</span></span> <span data-ttu-id="c7c87-121">Puede utilizar varios contenedores en discos diferentes para distribuir la actividad de E/S.</span><span class="sxs-lookup"><span data-stu-id="c7c87-121">You can use multiple containers on different disks to distribute the I/O activity.</span></span> <span data-ttu-id="c7c87-122">Los archivos delta y de datos en varios contenedores de discos distintos aumentarán el rendimiento de la recuperación cuando se leen los datos de los archivos delta y de datos en disco, en memoria.</span><span class="sxs-lookup"><span data-stu-id="c7c87-122">Data and delta files in multiple containers on different disks will increase recovery performance when data is read from the data and delta files on disk, into memory.</span></span>

 <span data-ttu-id="c7c87-123">Una aplicación no necesita acceso directamente a los archivos delta y de datos.</span><span class="sxs-lookup"><span data-stu-id="c7c87-123">An application does not directly access data and delta files.</span></span> <span data-ttu-id="c7c87-124">Todas las lecturas y escrituras de datos utilizan datos en memoria.</span><span class="sxs-lookup"><span data-stu-id="c7c87-124">All data reads and writes use in-memory data.</span></span>

### <a name="the-data-file"></a><span data-ttu-id="c7c87-125">Archivo de datos.</span><span class="sxs-lookup"><span data-stu-id="c7c87-125">The Data File</span></span>
 <span data-ttu-id="c7c87-126">Un archivo de datos contiene filas de una o más tablas optimizadas para memoria que se han insertado mediante varias transacciones como parte de las operaciones INSERT o UPDATE.</span><span class="sxs-lookup"><span data-stu-id="c7c87-126">A data file contains rows from one or more memory-optimized tables that were inserted by multiple transactions as part of INSERT or UPDATE operations.</span></span> <span data-ttu-id="c7c87-127">Por ejemplo, una fila puede ser de una tabla T1 optimizada para memoria y la siguiente puede ser de una tabla T2 optimizada para memoria.</span><span class="sxs-lookup"><span data-stu-id="c7c87-127">For example, one row can be from memory-optimized table T1 and the next row can be from memory-optimized table T2.</span></span> <span data-ttu-id="c7c87-128">Las filas se anexan al archivo de datos en el orden de las transacciones del registro de transacciones, con lo que el acceso a los datos es secuencial.</span><span class="sxs-lookup"><span data-stu-id="c7c87-128">The rows are appended to the data file in the order of transactions in the transaction log, making data access sequential.</span></span> <span data-ttu-id="c7c87-129">Esto permite un mejor rendimiento de la E/S del orden de magnitud en comparación con la E/S aleatoria.</span><span class="sxs-lookup"><span data-stu-id="c7c87-129">This enables an order of magnitude better I/O throughput compared to random I/O.</span></span> <span data-ttu-id="c7c87-130">Cada archivo de datos tiene un tamaño aproximado de 128 MB en los equipos con más de 16 GB de memoria y de 16 MB en los equipos con 16 GB o menos.</span><span class="sxs-lookup"><span data-stu-id="c7c87-130">Each data file is sized approximately to 128MB for computers with memory greater than 16GB, and 16MB for computers with less than or equal to 16GB.</span></span> <span data-ttu-id="c7c87-131">Una vez que el archivo de datos está lleno, las filas insertadas por las nuevas transacciones se almacenan en otro archivo de datos.</span><span class="sxs-lookup"><span data-stu-id="c7c87-131">Once the data file is full, the rows inserted by new transactions are stored in another data file.</span></span> <span data-ttu-id="c7c87-132">Con el tiempo, las filas de las tablas optimizadas para memoria perdurables se almacenan en uno de varios archivos de datos y cada archivo de datos contiene filas de un intervalo disjunto pero contiguo de transacciones.</span><span class="sxs-lookup"><span data-stu-id="c7c87-132">Over time, the rows from durable memory-optimized tables are stored in one of more data files and each data file containing rows from a disjoint but contiguous range of transactions.</span></span> <span data-ttu-id="c7c87-133">Por ejemplo, un archivo de datos con una marca de tiempo de confirmación de transacción en el intervalo de (100, 200) tiene todas las filas insertadas por transacciones cuya marca de tiempo de confirmación es mayor que 100 y menor o igual que 200.</span><span class="sxs-lookup"><span data-stu-id="c7c87-133">For example a data file with transaction commit timestamp in the range of (100, 200) has all the rows inserted by transactions that have commit timestamp greater than 100 and less than or equal to 200.</span></span> <span data-ttu-id="c7c87-134">La marca de tiempo de confirmación es un número de aumento regular asignado a una transacción cuando está lista para confirmarse.</span><span class="sxs-lookup"><span data-stu-id="c7c87-134">The commit timestamp is a monotonically increasing number assigned to a transaction when it is ready to commit.</span></span> <span data-ttu-id="c7c87-135">Cada transacción tiene una marca de tiempo única de confirmación.</span><span class="sxs-lookup"><span data-stu-id="c7c87-135">Each transaction has a unique commit timestamp.</span></span>

 <span data-ttu-id="c7c87-136">Cuando se elimina o actualiza una fila, no se quita ni se cambia en su lugar en el archivo de datos sino que las filas eliminadas se registran en otro tipo de archivo: el archivo delta.</span><span class="sxs-lookup"><span data-stu-id="c7c87-136">When a row is deleted or updated, the row is not removed or changed in-place in the data file but the deleted rows are tracked in another type of file: the delta file.</span></span> <span data-ttu-id="c7c87-137">Se procesan las operaciones de actualización como una tupla de las operaciones de eliminación e inserción para cada fila.</span><span class="sxs-lookup"><span data-stu-id="c7c87-137">Update operations are processed as a tuple of delete and insert operations for each row.</span></span> <span data-ttu-id="c7c87-138">Esto elimina la E/S aleatoria en el archivo de datos.</span><span class="sxs-lookup"><span data-stu-id="c7c87-138">This eliminates random IO on the data file.</span></span>

### <a name="the-delta-file"></a><span data-ttu-id="c7c87-139">El archivo delta</span><span class="sxs-lookup"><span data-stu-id="c7c87-139">The Delta File</span></span>
 <span data-ttu-id="c7c87-140">Cada archivo de datos está emparejado con un archivo delta que tiene el mismo intervalo de transacciones y hace un seguimiento de las filas eliminadas insertadas por transacciones en el intervalo de transacciones.</span><span class="sxs-lookup"><span data-stu-id="c7c87-140">Each data file is paired with a delta file that has the same transaction range and tracks the deleted rows inserted by transactions in the transaction range.</span></span> <span data-ttu-id="c7c87-141">El archivo de datos y el archivo delta se denominan “par de archivos de punto de comprobación” (CFP), que es la unidad de asignación y desasignación, y también la unidad de las operaciones Merge.</span><span class="sxs-lookup"><span data-stu-id="c7c87-141">This data and delta file is referred to as a Checkpoint File Pair (CFP) and it is the unit of allocation and deallocation as well as the unit for Merge operations.</span></span> <span data-ttu-id="c7c87-142">Por ejemplo, un archivo delta correspondiente al intervalo de transacciones (100, 200) almacenará las filas eliminadas que insertaron las transacciones del intervalo (100, 200).</span><span class="sxs-lookup"><span data-stu-id="c7c87-142">For example, a delta file corresponding to transaction range (100, 200) will store deleted rows that were inserted by transactions in the range (100, 200).</span></span> <span data-ttu-id="c7c87-143">Como los archivos de datos, se tiene acceso al archivo delta de forma secuencial.</span><span class="sxs-lookup"><span data-stu-id="c7c87-143">Like data files, the delta file is accessed sequentially.</span></span>

 <span data-ttu-id="c7c87-144">Cuando se elimina una fila, no se quita del archivo de datos sino se anexa una referencia a la fila al archivo delta asociado al intervalo de transacciones donde se ha insertado esta fila de datos.</span><span class="sxs-lookup"><span data-stu-id="c7c87-144">When a row is deleted, the row is not removed from the data file but a reference to the row is appended to the delta file associated with the transaction range where this data row was inserted.</span></span> <span data-ttu-id="c7c87-145">Puesto que la fila que se va a eliminar ya existe en el archivo de datos, el archivo delta solo almacena la información de referencia `{inserting_tx_id, row_id, deleting_tx_id }` y sigue el orden del registro transaccional de las operaciones de eliminación o actualización de origen.</span><span class="sxs-lookup"><span data-stu-id="c7c87-145">Since the row to be deleted already exists in the data file, the delta file only stores the reference information `{inserting_tx_id, row_id, deleting_tx_id }` and it follows the transactional log order of the originating delete or update operations.</span></span>

## <a name="populating-data-and-delta-files"></a><span data-ttu-id="c7c87-146">Rellenar los archivos delta y de datos</span><span class="sxs-lookup"><span data-stu-id="c7c87-146">Populating Data and Delta Files</span></span>
 <span data-ttu-id="c7c87-147">Los archivos delta y de datos son rellenados por un subproceso en segundo plano denominado punto de comprobación sin conexión.</span><span class="sxs-lookup"><span data-stu-id="c7c87-147">Data and delta file are populated by a background thread called offline checkpoint.</span></span> <span data-ttu-id="c7c87-148">Este subproceso lee las entradas del registro de transacciones generadas por las transacciones confirmadas en las tablas optimizadas para memoria y anexa información sobre las filas insertadas y eliminadas en los archivos de datos y delta correspondientes.</span><span class="sxs-lookup"><span data-stu-id="c7c87-148">This thread reads the transaction log records generated by committed transactions on memory-optimized tables and appends information about the inserted and deleted rows into appropriate data and delta files.</span></span> <span data-ttu-id="c7c87-149">A diferencia de las tablas basadas en disco donde las páginas de índice o datos se vacían con E/S aleatoria cuando se realiza el punto de comprobación, la persistencia de la tabla optimizada para memoria es una operación en segundo plano continua.</span><span class="sxs-lookup"><span data-stu-id="c7c87-149">Unlike disk-based tables where data/index pages are flushed with random I/O when checkpoint is done, the persistence of memory-optimized table is continuous background operation.</span></span> <span data-ttu-id="c7c87-150">Se obtiene acceso a varios archivos delta porque una transacción puede eliminar o actualizar cualquier fila que fuera insertada por alguna transacción anterior.</span><span class="sxs-lookup"><span data-stu-id="c7c87-150">Multiple delta files are accessed because a transaction can delete or update any row that was inserted by any previous transaction.</span></span> <span data-ttu-id="c7c87-151">La información de eliminación siempre se anexa al final del archivo delta.</span><span class="sxs-lookup"><span data-stu-id="c7c87-151">Deletion information is always appended at the end of the delta file.</span></span> <span data-ttu-id="c7c87-152">Por ejemplo, una transacción con una marca de tiempo de confirmación de 600 inserta una nueva fila y elimina las filas insertadas por las transacciones con una marca de tiempo de confirmación de 150, 250 y 450, como se muestra en la imagen siguiente.</span><span class="sxs-lookup"><span data-stu-id="c7c87-152">For example, a transaction with a commit timestamp of 600 inserts one new row and deletes rows inserted by transactions with a commit timestamp of 150, 250 and 450 as shown in the picture below.</span></span> <span data-ttu-id="c7c87-153">Las cuatro operaciones de E/S de archivo (tres para las filas eliminadas y 1 para las filas recién insertadas) son operaciones de solo anexar para los archivos de datos y delta correspondientes.</span><span class="sxs-lookup"><span data-stu-id="c7c87-153">All 4 file I/O operations (three for deleted rows and 1 for the newly inserted rows), are append-only operations to the corresponding delta and data files.</span></span>

 <span data-ttu-id="c7c87-154">![Leer las entradas de registro de las tablas optimizadas para memoria.](../../database-engine/media/read-logs-hekaton.gif "Leer las entradas de registro de las tablas optimizadas para memoria.")</span><span class="sxs-lookup"><span data-stu-id="c7c87-154">![Read log records for memory-optimized tables.](../../database-engine/media/read-logs-hekaton.gif "Read log records for memory-optimized tables.")</span></span>

## <a name="accessing-data-and-delta-files"></a><span data-ttu-id="c7c87-155">Acceso a los archivos delta y de datos</span><span class="sxs-lookup"><span data-stu-id="c7c87-155">Accessing Data and Delta Files</span></span>
 <span data-ttu-id="c7c87-156">Se tiene acceso a los pares de archivos delta y de datos cuando ocurre lo siguiente.</span><span class="sxs-lookup"><span data-stu-id="c7c87-156">Data and delta file pairs are accessed when the following occurs.</span></span>

 <span data-ttu-id="c7c87-157">Subproceso de punto de comprobación sin conexión este subproceso anexa las inserciones y eliminaciones a las filas de datos optimizadas para memoria, a los pares de archivos Delta y de datos correspondientes.</span><span class="sxs-lookup"><span data-stu-id="c7c87-157">Offline checkpoint thread This thread appends inserts and deletes to memory-optimized data rows, to the corresponding data and delta file pairs.</span></span>

 <span data-ttu-id="c7c87-158">Operación Merge la operación combina uno o varios pares de archivos Delta y de datos, y crea un nuevo par de archivos Delta y de datos.</span><span class="sxs-lookup"><span data-stu-id="c7c87-158">Merge operation The operation merges one or more data and delta file pairs and creates a new data and delta file pair.</span></span>

 <span data-ttu-id="c7c87-159">Durante la recuperación tras bloqueo cuando [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] se reinicia o la base de datos se vuelve a poner en línea, los datos optimizados para memoria se rellenan con los pares de archivos Delta y de datos.</span><span class="sxs-lookup"><span data-stu-id="c7c87-159">During crash recovery When [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is restarted or the database is brought back online, the memory-optimized data is populated using the data and delta file pairs.</span></span> <span data-ttu-id="c7c87-160">El archivo delta actúa como filtro para las filas eliminadas al leer las filas del archivo de datos correspondiente.</span><span class="sxs-lookup"><span data-stu-id="c7c87-160">The delta file acts as a filter for the deleted rows when reading the rows from the corresponding data file.</span></span> <span data-ttu-id="c7c87-161">Dado que cada par de archivos delta y de datos es independiente, estos archivos se cargan en paralelo para reducir el tiempo dedicado a rellenar los datos en la memoria.</span><span class="sxs-lookup"><span data-stu-id="c7c87-161">Because each data and delta file pair is independent, these files are loaded in parallel to reduce the time taken to populate data into memory.</span></span> <span data-ttu-id="c7c87-162">Una vez que los datos se han cargado en memoria, el motor OLTP en memoria aplica las entradas del registro de transacciones activo aún no cubiertas por los archivos de puntos de comprobación de modo que los datos optimizados para memoria estén completos.</span><span class="sxs-lookup"><span data-stu-id="c7c87-162">Once the data has been loaded into memory, the In-Memory OLTP engine applies the active transaction log records not yet covered by the checkpoint files so that the memory-optimized data is complete.</span></span>

 <span data-ttu-id="c7c87-163">Durante la operación de restauración, los archivos de punto de comprobación de OLTP en memoria se crean a partir de la copia de seguridad de base de datos y, después, se aplican una o varias copias de seguridad del registro de transacciones</span><span class="sxs-lookup"><span data-stu-id="c7c87-163">During restore operation The In-Memory OLTP checkpoint files are created from the database backup, and then one or more transaction log backups are applied.</span></span> <span data-ttu-id="c7c87-164">Al igual que ocurre con la recuperación tras bloqueo, el motor OLTP en memoria carga los datos en memoria en paralelo, para minimizar el impacto en el tiempo de recuperación.</span><span class="sxs-lookup"><span data-stu-id="c7c87-164">As with crash recovery, the In-Memory OLTP engine loads data into memory in parallel, to minimize the impact on recovery time.</span></span>

## <a name="merging-data-and-delta-files"></a><span data-ttu-id="c7c87-165">Combinar los archivos delta y de datos</span><span class="sxs-lookup"><span data-stu-id="c7c87-165">Merging Data and Delta Files</span></span>
 <span data-ttu-id="c7c87-166">Los datos de las tablas con optimización para memoria se almacenan en uno o varios pares de archivos de datos y delta (también denominados pares de archivos de puntos de comprobación o CFP).</span><span class="sxs-lookup"><span data-stu-id="c7c87-166">The data for memory optimized tables is stored in one or more data and delta file pairs (also called a checkpoint file pair, or CFP).</span></span> <span data-ttu-id="c7c87-167">Los archivos de datos almacenan las filas insertadas y los archivos delta hacen referencia a las filas eliminadas.</span><span class="sxs-lookup"><span data-stu-id="c7c87-167">Data files store inserted rows and delta files reference deleted rows.</span></span> <span data-ttu-id="c7c87-168">Durante la ejecución de una carga de trabajo de OLTP como las operaciones DML de actualización, inserción y eliminación de filas, se crean nuevos CFP para conservar las filas nuevas y la referencia a las filas eliminadas se anexa a los archivos delta.</span><span class="sxs-lookup"><span data-stu-id="c7c87-168">During the execution of an OLTP workload, as the DML operations update, insert, and delete rows, new CFPs are created to persist the new rows, and the reference to the deleted rows is appended to delta files.</span></span>

 <span data-ttu-id="c7c87-169">Los metadatos de todos los CFP previamente cerrados y activos actualmente se almacenan en una estructura de matriz interna a la que se hace referencia como matriz de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="c7c87-169">The metadata of all previously-closed and currently active CFPs is stored in an internal array structure referred to as the storage array.</span></span> <span data-ttu-id="c7c87-170">Es una matriz de tamaño finito (8.192 entradas) de CFP.</span><span class="sxs-lookup"><span data-stu-id="c7c87-170">It is a finitely sized (8,192 entries) array of CFPs.</span></span> <span data-ttu-id="c7c87-171">Las entradas de la matriz de almacenamiento se ordenan por intervalo de transacciones.</span><span class="sxs-lookup"><span data-stu-id="c7c87-171">The entries in the storage array are ordered by transaction range.</span></span> <span data-ttu-id="c7c87-172">Los CFP de la matriz de almacenamiento (junto con el final del registro) representan todos los estados en disco necesarios para recuperar una base de datos con tablas optimizadas para memoria.</span><span class="sxs-lookup"><span data-stu-id="c7c87-172">The CFPs in the storage array (along with the tail of the log) represent all the on-disk state required to recover a database with memory-optimized tables.</span></span>

 <span data-ttu-id="c7c87-173">Con el tiempo, con las operaciones DML, el número de CFP aumenta haciendo que la matriz de almacenamiento alcance su capacidad máxima, lo que presenta los desafíos siguientes:</span><span class="sxs-lookup"><span data-stu-id="c7c87-173">Over time, with DML operations, the number of CFPs grow causing the storage array to reach capacity, which introduces the following challenges:</span></span>

-   <span data-ttu-id="c7c87-174">Filas eliminadas.</span><span class="sxs-lookup"><span data-stu-id="c7c87-174">Deleted rows.</span></span>  <span data-ttu-id="c7c87-175">Las filas eliminadas permanecen en el archivo de datos pero se marcan como eliminadas en el archivo delta correspondiente.</span><span class="sxs-lookup"><span data-stu-id="c7c87-175">Deleted rows remain in the data file but are marked as deleted in the corresponding delta file.</span></span> <span data-ttu-id="c7c87-176">Estas filas ya no se necesitan y se quitarán del almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="c7c87-176">These rows are no longer needed and will be removed from the storage.</span></span> <span data-ttu-id="c7c87-177">Si las filas eliminadas no se han quitado de los CFP, usarán espacio innecesariamente y ralentizarán el tiempo de recuperación.</span><span class="sxs-lookup"><span data-stu-id="c7c87-177">If deleted rows were not removed from CFPs, they would use space unnecessarily and make recovery time slower.</span></span>

-   <span data-ttu-id="c7c87-178">Matriz de almacenamiento llena.</span><span class="sxs-lookup"><span data-stu-id="c7c87-178">Storage array full.</span></span> <span data-ttu-id="c7c87-179">Cuando hay asignadas 8.000 entradas de la matriz de almacenamiento (192 entradas de la matriz se reservan para completar las mezclas existentes o para que pueda realizar mezclas manuales), no se pueden ejecutar nuevas transacciones DML en las tablas durables optimizadas para memoria.</span><span class="sxs-lookup"><span data-stu-id="c7c87-179">When there 8,000 entries in the storage array are allocated (192 entries in the array are reserved for existing merges to compete or to allow you to do manual merges), no new DML transactions can be executed on durable memory-optimized tables.</span></span> <span data-ttu-id="c7c87-180">Solo se permite que el punto de comprobación y las operaciones de combinación utilicen las entradas restantes.</span><span class="sxs-lookup"><span data-stu-id="c7c87-180">Only checkpoint and merge operations are allowed to consume the remaining entries.</span></span> <span data-ttu-id="c7c87-181">Esto garantiza que las transacciones de DML no llenen la matriz y que algunas entradas de la matriz se reserven para combinar los archivos existentes y para recuperar el espacio en la matriz.</span><span class="sxs-lookup"><span data-stu-id="c7c87-181">This ensures that DML transactions do not fill the array and that some entries in the array are reserved to merge existing files and to reclaim space in the array.</span></span>

-   <span data-ttu-id="c7c87-182">Sobrecarga de manipulación de la matriz de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="c7c87-182">Storage array manipulation overhead.</span></span> <span data-ttu-id="c7c87-183">Los procesos internos buscan en la matriz de almacenamiento operaciones como buscar el archivo delta para anexar la información sobre una fila eliminada.</span><span class="sxs-lookup"><span data-stu-id="c7c87-183">Internal processes search the storage array for operations such as finding the delta file to append information about a deleted row.</span></span> <span data-ttu-id="c7c87-184">El costo de estas operaciones aumenta con el número de entradas.</span><span class="sxs-lookup"><span data-stu-id="c7c87-184">The cost of these operations increases with the number of entries.</span></span>

 <span data-ttu-id="c7c87-185">Para evitar estas ineficacias, los CFP cerrados anteriores se combinan, según una directiva de combinación descrita más adelante, por lo que la matriz de almacenamiento se compacta para representar el mismo conjunto de datos, con un número reducido de CFP.</span><span class="sxs-lookup"><span data-stu-id="c7c87-185">To help prevent these inefficiencies, the older closed CFPs are merged, based on a merge policy described below, so the storage array is compacted to represent the same set of data, with a reduced number of CFPs.</span></span>

 <span data-ttu-id="c7c87-186">El tamaño total en memoria de todas las tablas durables de una base de datos no debe superar los 250 GB.</span><span class="sxs-lookup"><span data-stu-id="c7c87-186">The total in-memory size of all durable tables in a database should not exceed 250 GB.</span></span> <span data-ttu-id="c7c87-187">Las tablas durables que usan hasta 250 GB de memoria, suponiendo operaciones de inserción, eliminación y actualización, necesitan por término medio 500 GB de espacio de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="c7c87-187">Durable tables that use up to 250 GB of memory will, assuming insert, delete, and update operations, require on average 500 GB of storage space.</span></span> <span data-ttu-id="c7c87-188">Se necesitan 4.000 pares de archivos de datos y delta en el grupo de archivos optimizados para memoria para admitir los 500 GB de espacio de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="c7c87-188">4,000 data and delta file pairs in the memory-optimized file group are required to support the 500 GB of storage space.</span></span>

 <span data-ttu-id="c7c87-189">Los picos breves de actividad de la base de datos pueden retrasar las operaciones de punto de comprobación y de combinación, lo que aumentará el número de pares de archivos de datos y delta necesarios.</span><span class="sxs-lookup"><span data-stu-id="c7c87-189">Short-term surges in database activity may cause checkpoint and merge operations lag, which will increase the number of required data and delta file pairs.</span></span> <span data-ttu-id="c7c87-190">Para admitir picos breves de actividad de la base de datos, el sistema de almacenamiento puede asignar hasta 8.000 pares de archivos de datos y delta hasta un total de 1 TB de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="c7c87-190">To accommodate short-term surges spikes in database activity, the storage system can allocate up to 8,000 data and delta file pairs up to a total of 1TB of storage.</span></span> <span data-ttu-id="c7c87-191">Cuando se alcance ese límite, no se permitirán nuevas transacciones en la base de datos hasta que se pongan al día las operaciones de punto de comprobación.</span><span class="sxs-lookup"><span data-stu-id="c7c87-191">When that limit is reached, there will be no new transactions allowed on the database until checkpoint operations catch up.</span></span> <span data-ttu-id="c7c87-192">Si el tamaño de las tablas durables en memoria supera los 250 GB durante largos períodos de tiempo, es probable que se alcance el límite de 8.000 pares de archivos.</span><span class="sxs-lookup"><span data-stu-id="c7c87-192">If the size of durable tables in memory exceeds 250GB for long periods of time, there is a chance of reaching the 8,000 file pair limit.</span></span>

 <span data-ttu-id="c7c87-193">La operación de combinación toma como entrada uno o varios CFP cerrados adyacentes (que se denominan origen de combinación) según una directiva de combinación definida internamente y genera un CFP resultante, denominado el destino de combinación.</span><span class="sxs-lookup"><span data-stu-id="c7c87-193">The merge operation takes as input one or more adjacent closed CFPs (called merge source) based on an internally defined merge policy, and produces one resultant CFP, called the merge target.</span></span> <span data-ttu-id="c7c87-194">Las entradas de cada archivo delta de los CFP de origen se utilizan para filtrar las filas del archivo de datos correspondiente para quitar las filas de datos que no son necesarias.</span><span class="sxs-lookup"><span data-stu-id="c7c87-194">The entries in each delta file of the source CFPs are used to filter rows from the corresponding data file to remove the data rows that are not needed.</span></span> <span data-ttu-id="c7c87-195">Las filas restantes de los CFP de origen se consolidan en un CFP de destino.</span><span class="sxs-lookup"><span data-stu-id="c7c87-195">The remaining rows in the source CFPs are consolidated into one target CFP.</span></span> <span data-ttu-id="c7c87-196">Una vez completada la combinación, el CFP de destino de combinación resultante reemplaza los CFP de origen (orígenes de combinación).</span><span class="sxs-lookup"><span data-stu-id="c7c87-196">After the merge is complete, the resultant merge-target CFP replaces the source CFPs (merge sources).</span></span> <span data-ttu-id="c7c87-197">Los CFP de origen de combinación pasan por una fase de transición antes de que se eliminen del almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="c7c87-197">The merge-source CFPs go through a transition phase before they are removed from storage.</span></span>

 <span data-ttu-id="c7c87-198">En el ejemplo siguiente, el grupo de archivos de tabla optimizada para memoria tiene cuatro pares de archivos delta y de datos en la marca de tiempo 500 que contiene los datos de transacciones anteriores.</span><span class="sxs-lookup"><span data-stu-id="c7c87-198">In the example below, the memory-optimized table file group has four data and delta file pairs at timestamp 500 containing data from previous transactions.</span></span> <span data-ttu-id="c7c87-199">Por ejemplo, las filas del primer archivo de datos corresponden a las transacciones con marca de tiempo mayor que 100 y menor o igual que 200; de forma alternativa, se representan como (100, 200].</span><span class="sxs-lookup"><span data-stu-id="c7c87-199">For example, the rows in the first data file correspond to transactions with timestamp greater than 100 and less than or equal to 200; alternatively represented as (100, 200].</span></span> <span data-ttu-id="c7c87-200">Los archivos de datos segundo y tercero están completos menos de un 50 por ciento tras tener en cuenta las filas marcadas como eliminadas.</span><span class="sxs-lookup"><span data-stu-id="c7c87-200">The second and third data files are shown to be less than 50 percent full after accounting for the rows marked as deleted.</span></span> <span data-ttu-id="c7c87-201">La operación de combinación combina estos dos CFP y crea un nuevo CFP que contiene las transacciones con marca de tiempo mayor que 200 y menor o igual que 400, que es el intervalo combinado de estos dos CFP.</span><span class="sxs-lookup"><span data-stu-id="c7c87-201">The merge operation combines these two CFPs and creates a new CFP containing transactions with timestamp greater than 200 and less than or equal to 400, which is the combined range of these two CFPs.</span></span> <span data-ttu-id="c7c87-202">Puede ver otro CFP con intervalo (500, 600] y el archivo delta no vacío para el intervalo de transacción (200, 400] muestra que la operación de combinación se puede realizar de forma simultanea a la actividad transaccional que incluye la eliminación de varias filas de los CFP de origen.</span><span class="sxs-lookup"><span data-stu-id="c7c87-202">You see another CFP with range (500, 600] and non-empty delta file for transaction range (200, 400] shows that merge operation can be done concurrently with transactional activity including deleting more rows from the source CFPs.</span></span>

 <span data-ttu-id="c7c87-203">![Diagrama que muestra grupo de archivos de tabla optimizada para memoria](../../database-engine/media/storagediagram-hekaton.png "Diagrama que muestra grupo de archivos de tabla optimizada para memoria")</span><span class="sxs-lookup"><span data-stu-id="c7c87-203">![Diagram shows memory optimized table file group](../../database-engine/media/storagediagram-hekaton.png "Diagram shows memory optimized table file group")</span></span>

 <span data-ttu-id="c7c87-204">Un subproceso en segundo plano evalúa todos los CFP cerrados mediante una directiva de combinación y después inicia una o varias solicitudes para los CFP aptos.</span><span class="sxs-lookup"><span data-stu-id="c7c87-204">A background thread evaluates all closed CFPs using a merge policy and then initiates one or more merge requests for the qualifying CFPs.</span></span> <span data-ttu-id="c7c87-205">Estas solicitudes de combinación se procesan mediante el subproceso de punto de comprobación sin conexión.</span><span class="sxs-lookup"><span data-stu-id="c7c87-205">These merge requests are processed by the offline checkpoint thread.</span></span> <span data-ttu-id="c7c87-206">La evaluación de la directiva de combinación se realiza periódicamente y también cuando se cierra un punto de comprobación.</span><span class="sxs-lookup"><span data-stu-id="c7c87-206">The evaluation of merge policy is done periodically and also when a checkpoint is closed.</span></span>

### <a name="sssql14-merge-policy"></a>[!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] <span data-ttu-id="c7c87-207">Directiva de combinación</span><span class="sxs-lookup"><span data-stu-id="c7c87-207">Merge Policy</span></span>
 [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] <span data-ttu-id="c7c87-208">implementa la directiva de combinación siguiente:</span><span class="sxs-lookup"><span data-stu-id="c7c87-208">implements the following merge policy:</span></span>

-   <span data-ttu-id="c7c87-209">Se programa una combinación si se pueden consolidar 2 o más CFP consecutivos, después de tener en cuenta las filas eliminadas, de forma que las filas resultantes quepan en 1 CFP de tamaño ideal.</span><span class="sxs-lookup"><span data-stu-id="c7c87-209">A merge is scheduled if 2 or more consecutive CFPs can be consolidated, after accounting for deleted rows, such that the resultant rows can fit into 1 CFP of ideal size.</span></span> <span data-ttu-id="c7c87-210">El tamaño ideal de un CFP se determina de la manera siguiente:</span><span class="sxs-lookup"><span data-stu-id="c7c87-210">The ideal size of CFP is determined as follows:</span></span>

    -   <span data-ttu-id="c7c87-211">Si un equipo tiene 16 GB de memoria o menos, el archivo de datos tiene 16 MB y el archivo delta 1 MB.</span><span class="sxs-lookup"><span data-stu-id="c7c87-211">If a computer has less than or equal to 16GB of memory, the data file is 16MB and delta file is 1MB.</span></span>

    -   <span data-ttu-id="c7c87-212">Si un equipo tiene más de 16 GB de memoria, el archivo de datos tiene 128 MB y el archivo delta 16 MB.</span><span class="sxs-lookup"><span data-stu-id="c7c87-212">If a computer has greater than 16GB of memory, the data file is 128MB and delta file is 16MB.</span></span>

-   <span data-ttu-id="c7c87-213">Un único CFP se puede autocombinar si el archivo de datos supera los 256 MB y se eliminan más de la mitad de las filas.</span><span class="sxs-lookup"><span data-stu-id="c7c87-213">A single CFP can be self-merged if the data file exceeds 256 MB and more than half of the rows are deleted.</span></span> <span data-ttu-id="c7c87-214">Un archivo de datos puede llegar a tener más de 128 MB si, por ejemplo, una única transacción o varias transacciones simultáneas insertan o actualizan una gran cantidad de datos, forzando que el archivo de datos crezca más allá de su tamaño ideal porque una transacción no puede abarcar varios CFP.</span><span class="sxs-lookup"><span data-stu-id="c7c87-214">A data file can grow larger than 128MB if, for example, a single transaction or multiple concurrent transactions inserts or updates large amount of data, forcing the data file to grow beyond its ideal size because a transaction cannot span multiple CFPs.</span></span>

 <span data-ttu-id="c7c87-215">A continuación se muestran algunos ejemplos que muestran los CFP que se combinarán con la directiva de combinación:</span><span class="sxs-lookup"><span data-stu-id="c7c87-215">Here are some examples that show the CFPs that will be merged under the merge policy:</span></span>

|<span data-ttu-id="c7c87-216">Archivos de origen CFP adyacentes (% completo)</span><span class="sxs-lookup"><span data-stu-id="c7c87-216">Adjacent CFPs Source Files (% full)</span></span>|<span data-ttu-id="c7c87-217">Selección de mezcla</span><span class="sxs-lookup"><span data-stu-id="c7c87-217">Merge Selection</span></span>|
|-------------------------------------------|---------------------|
|<span data-ttu-id="c7c87-218">CFP0 (30 %), CFP1 (50 %), CFP2 (50 %), CFP3 (90 %)</span><span class="sxs-lookup"><span data-stu-id="c7c87-218">CFP0 (30%), CFP1 (50%), CFP2 (50%), CFP3 (90%)</span></span>|<span data-ttu-id="c7c87-219">(CFP0, CFP1)</span><span class="sxs-lookup"><span data-stu-id="c7c87-219">(CFP0, CFP1)</span></span><br /><br /> <span data-ttu-id="c7c87-220">CFP2 no se elige porque hará que el archivo de datos resultante sea mayor que el 100 % del tamaño ideal.</span><span class="sxs-lookup"><span data-stu-id="c7c87-220">CFP2 is not chosen as it will make resultant data file greater than 100% of the ideal size.</span></span>|
|<span data-ttu-id="c7c87-221">CFP0 (30%), CFP1 (20%), CFP2 (50%), CFP3 (10%)</span><span class="sxs-lookup"><span data-stu-id="c7c87-221">CFP0 (30%), CFP1 (20%), CFP2 (50%), CFP3 (10%)</span></span>|<span data-ttu-id="c7c87-222">(CFP0, CFP1, CFP2).</span><span class="sxs-lookup"><span data-stu-id="c7c87-222">(CFP0, CFP1, CFP2).</span></span> <span data-ttu-id="c7c87-223">Los archivos se eligen empezando desde la izquierda.</span><span class="sxs-lookup"><span data-stu-id="c7c87-223">Files are chosen starting from left.</span></span><br /><br /> <span data-ttu-id="c7c87-224">CFP3 no se elige porque hará que el archivo de datos resultante sea mayor que el 100 % del tamaño ideal.</span><span class="sxs-lookup"><span data-stu-id="c7c87-224">CTP3 is not chosen as it will make resultant data file greater than 100% of the ideal size.</span></span>|
|<span data-ttu-id="c7c87-225">CFP0 (80%), CFP1 (30%), CFP2 (10%), CFP3 (40%)</span><span class="sxs-lookup"><span data-stu-id="c7c87-225">CFP0 (80%), CFP1 (30%), CFP2 (10%), CFP3 (40%)</span></span>|<span data-ttu-id="c7c87-226">(CFP1, CFP2, CFP3).</span><span class="sxs-lookup"><span data-stu-id="c7c87-226">(CFP1, CFP2, CFP3).</span></span> <span data-ttu-id="c7c87-227">Los archivos se eligen empezando desde la izquierda.</span><span class="sxs-lookup"><span data-stu-id="c7c87-227">Files are chosen starting from left.</span></span><br /><br /> <span data-ttu-id="c7c87-228">Se omite CFP0 porque si se combina con CFP1, el archivo de datos resultante será mayor que el 100% del tamaño ideal.</span><span class="sxs-lookup"><span data-stu-id="c7c87-228">CFP0 is skipped because if combined with CFP1, the resultant data file will be greater than 100% of the ideal size.</span></span>|

 <span data-ttu-id="c7c87-229">No todos los CFP con espacio disponible con aptos para la combinación.</span><span class="sxs-lookup"><span data-stu-id="c7c87-229">Not all CFPs with available space qualify for merge.</span></span> <span data-ttu-id="c7c87-230">Por ejemplo, si dos CFP adyacentes están completos al 60%, no optarán por la combinación y cada uno de estos CFP tendrá un almacenamiento del 40% no utilizado.</span><span class="sxs-lookup"><span data-stu-id="c7c87-230">For example, if two adjacent CFPs are 60% full, they will not qualify for merge and each of these CFPs will have 40% storage unused.</span></span> <span data-ttu-id="c7c87-231">En el peor de los casos, todos los CFP estarán completos al 50%, una utilización del almacenamiento de solo el 50%.</span><span class="sxs-lookup"><span data-stu-id="c7c87-231">In the worst case, all CFPs will be 50% full, a storage utilization of only 50%.</span></span> <span data-ttu-id="c7c87-232">Mientras que las filas eliminadas pueden existir en almacenamiento porque los CFP no son aptos para la combinación, es posible que el recolector de elementos no utilizados en memoria haya quitado ya las filas eliminadas.</span><span class="sxs-lookup"><span data-stu-id="c7c87-232">While the deleted rows may exist in storage because the CFPs don't qualify for merge, the deleted rows may have already been removed from memory by in-memory garbage collection.</span></span> <span data-ttu-id="c7c87-233">La administración de almacenamiento y de la memoria es independiente de la recolección de elementos no utilizados.</span><span class="sxs-lookup"><span data-stu-id="c7c87-233">The management of storage and the memory is independent from garbage collection.</span></span> <span data-ttu-id="c7c87-234">El almacenamiento ocupado por los CFP (no todos los CFP se actualizan) puede ser hasta 2 veces mayor que el tamaño de las tablas durables en memoria.</span><span class="sxs-lookup"><span data-stu-id="c7c87-234">Storage taken by active CFPs (not all CFPs are being updated) can be up to 2 times larger than the size of durable tables in memory.</span></span>

 <span data-ttu-id="c7c87-235">Si es necesario, se puede realizar explícitamente una combinación manual llamando a [Sys. sp_xtp_merge_checkpoint_files &#40;&#41;de Transact-SQL ](/sql/relational-databases/system-stored-procedures/sys-sp-xtp-merge-checkpoint-files-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="c7c87-235">If needed, a manual merge can be explicitly performed by calling [sys.sp_xtp_merge_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-xtp-merge-checkpoint-files-transact-sql).</span></span>

### <a name="life-cycle-of-a-cfp"></a><span data-ttu-id="c7c87-236">Ciclo de vida de un CFP</span><span class="sxs-lookup"><span data-stu-id="c7c87-236">Life Cycle of a CFP</span></span>
 <span data-ttu-id="c7c87-237">Los CPF realizan una transición por varios estados antes de que se puedan desasignar.</span><span class="sxs-lookup"><span data-stu-id="c7c87-237">CPFs transition through several states before they can be deallocated.</span></span> <span data-ttu-id="c7c87-238">En un momento dado, los CFP están en una de las fases siguientes: PRECREATED, UNDER CONSTRUCTION, ACTIVE, MERGE TARGET, MERGED SOURCE, REQUIRED FOR BACKUP/HA, IN TRANSITION TO TOMBSTONE y TOMBSTONE.</span><span class="sxs-lookup"><span data-stu-id="c7c87-238">At any given time, the CFPs are in one of the following phases: PRECREATED, UNDER CONSTRUCTION, ACTIVE, MERGE TARGET, MERGED SOURCE, REQUIRED FOR BACKUP/HA, IN TRANSITION TO TOMBSTONE, and TOMBSTONE.</span></span> <span data-ttu-id="c7c87-239">Para obtener una descripción de estas fases, vea [sys.dm_db_xtp_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="c7c87-239">For a description of these phases, see [sys.dm_db_xtp_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql).</span></span>

 <span data-ttu-id="c7c87-240">Después de tener en cuenta el almacenamiento ocupado por los CFP en distintos estados, el almacenamiento total ocupado por las tablas durables optimizadas para memoria puede ser mucho mayor que el doble del tamaño de las tablas en memoria.</span><span class="sxs-lookup"><span data-stu-id="c7c87-240">After accounting for the storage taken by CFPs in various states, the overall storage taken by durable memory-optimized tables can be much larger than 2 times the size of the tables in memory.</span></span> <span data-ttu-id="c7c87-241">La DMV [Sys. dm_db_xtp_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql) se puede consultar para enumerar todos los CFP en el grupo de archivos optimizados para memoria, incluida su fase.</span><span class="sxs-lookup"><span data-stu-id="c7c87-241">The DMV [sys.dm_db_xtp_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql) can be queried to list all the CFPs in the memory-optimized filegroup, including their phase.</span></span> <span data-ttu-id="c7c87-242">La transición de los CFP del estado SOURCE MERGE a TOMBSTONE y en última instancia a la recolección de elementos no utilizados puede consumir hasta cinco puntos de comprobación, donde cada punto de comprobación va seguido de una copia de seguridad de registros de transacciones, si la base de datos está configurada para el modelo de recuperación completa u optimizado para cargas masivas de registros.</span><span class="sxs-lookup"><span data-stu-id="c7c87-242">Transitioning CFPs from MERGE SOURCE state to TOMBSTONE and ultimately garbage collection can take up five checkpoints, with each checkpoint followed by a transaction log backup, if the database is configured for full or bulk-logged recovery model.</span></span>

 <span data-ttu-id="c7c87-243">Puede forzarse manualmente el punto de comprobación seguido de la copia de seguridad de registros para acelerar la recolección de elementos no utilizados pero esto agregará 5 CFP vacíos (5 pares de archivos de datos y delta con un archivo de datos de un tamaño de 128 MB cada uno).</span><span class="sxs-lookup"><span data-stu-id="c7c87-243">You can manually force the checkpoint followed by log backup to expedite the garbage collection but then this will add 5 empty CFPs (5 data/delta file pairs with data file of size 128MB each).</span></span> <span data-ttu-id="c7c87-244">En escenarios de producción, los puntos de comprobación automáticos y las copias de seguridad de registros realizados como parte de la estrategia de copia de seguridad simplificarán la transición de los CFP por estas fases sin que sea necesaria ninguna intervención manual.</span><span class="sxs-lookup"><span data-stu-id="c7c87-244">In production scenarios, the automatic checkpoints and log backups taken as part of backup strategy will seamlessly transition CFPs through these phases without requiring any manual intervention.</span></span> <span data-ttu-id="c7c87-245">El efecto del proceso de recolección de elementos no utilizados es que las bases de datos con tablas optimizadas para memoria pueden tener un tamaño de almacenamiento máximo respecto a su tamaño en memoria.</span><span class="sxs-lookup"><span data-stu-id="c7c87-245">The impact of the garbage collection process is that databases with memory-optimized tables may have a larger storage size compared to its size in memory.</span></span> <span data-ttu-id="c7c87-246">No es infrecuente que los CFP tengan en memoria un tamaño que es hasta cuatro veces el de las tablas durables optimizadas para memoria.</span><span class="sxs-lookup"><span data-stu-id="c7c87-246">It is not uncommon for CFPs to be up to four times the size of the durable memory-optimized tables in memory.</span></span>

## <a name="see-also"></a><span data-ttu-id="c7c87-247">Consulte también</span><span class="sxs-lookup"><span data-stu-id="c7c87-247">See Also</span></span>
 [<span data-ttu-id="c7c87-248">Crear y administrar el almacenamiento de objetos optimizados para memoria</span><span class="sxs-lookup"><span data-stu-id="c7c87-248">Creating and Managing Storage for Memory-Optimized Objects</span></span>](creating-and-managing-storage-for-memory-optimized-objects.md)


