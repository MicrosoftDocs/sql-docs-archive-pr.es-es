---
title: Estadísticas para las tablas con optimización para memoria | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: e644766d-1d1c-43d7-83ff-8ccfe4f3af9f
author: rothja
ms.author: jroth
ms.openlocfilehash: 0ae09d76c2642e23c56afcdd5ae4e1e468ef5883
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87749893"
---
# <a name="statistics-for-memory-optimized-tables"></a><span data-ttu-id="39fe3-102">Estadísticas para las tablas con optimización para memoria</span><span class="sxs-lookup"><span data-stu-id="39fe3-102">Statistics for Memory-Optimized Tables</span></span>
  <span data-ttu-id="39fe3-103">El optimizador de consultas utiliza las estadísticas de las columnas para crear planes de consulta que mejoren el rendimiento de las consultas.</span><span class="sxs-lookup"><span data-stu-id="39fe3-103">The query optimizer uses statistics about columns to create query plans that improve query performance.</span></span> <span data-ttu-id="39fe3-104">Las estadísticas se recopilan de las tablas de la base de datos y se almacenan en los metadatos de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="39fe3-104">Statistics are collected from the tables in the database and stored in the database metadata.</span></span>  
  
 <span data-ttu-id="39fe3-105">Las estadísticas se crean automáticamente, pero también se pueden crear manualmente.</span><span class="sxs-lookup"><span data-stu-id="39fe3-105">Statistics are created automatically, but can also be created manually.</span></span> <span data-ttu-id="39fe3-106">Por ejemplo, para las columnas de clave de índice, las estadísticas se crean automáticamente cuando se crea el índice.</span><span class="sxs-lookup"><span data-stu-id="39fe3-106">For example, statistics are created automatically for index key columns when the index is created.</span></span> <span data-ttu-id="39fe3-107">Para obtener más información acerca de cómo crear estadísticas, vea [Statistics](../statistics/statistics.md).</span><span class="sxs-lookup"><span data-stu-id="39fe3-107">For more information about creating statistics see [Statistics](../statistics/statistics.md).</span></span>  
  
 <span data-ttu-id="39fe3-108">Normalmente, los datos de tabla cambian a medida que se insertan, se actualizan y se eliminan filas.</span><span class="sxs-lookup"><span data-stu-id="39fe3-108">Table data typically changes over time as rows are inserted, updated, and deleted.</span></span> <span data-ttu-id="39fe3-109">Esto significa que las estadísticas deben actualizarse periódicamente.</span><span class="sxs-lookup"><span data-stu-id="39fe3-109">This means statistics need to be updated periodically.</span></span> <span data-ttu-id="39fe3-110">De forma predeterminada, las estadísticas basadas en disco se actualizan automáticamente cuando el optimizador determina que podrían estar obsoletas.</span><span class="sxs-lookup"><span data-stu-id="39fe3-110">By default, statistics on disk-based tables are updated automatically when the optimizer determines they might be out of date.</span></span>  
  
 <span data-ttu-id="39fe3-111">Las estadísticas de tablas optimizadas para memoria no se actualizan de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="39fe3-111">Statistics on memory-optimized tables are not updated by default.</span></span> <span data-ttu-id="39fe3-112">En su lugar, debe actualizarlas manualmente.</span><span class="sxs-lookup"><span data-stu-id="39fe3-112">Instead, you need to update them manually.</span></span> <span data-ttu-id="39fe3-113">Use [Update statistics &#40;Transact-SQL&#41;](/sql/t-sql/statements/update-statistics-transact-sql) para columnas, índices o tablas individuales.</span><span class="sxs-lookup"><span data-stu-id="39fe3-113">Use [UPDATE STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/statements/update-statistics-transact-sql) for individual columns, indexes, or tables.</span></span> <span data-ttu-id="39fe3-114">Use [sp_updatestats &#40;&#41;de Transact-SQL](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql) para actualizar las estadísticas de todas las tablas de usuario e internas de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="39fe3-114">Use [sp_updatestats &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql) to update statistics for all user and internal tables in the database.</span></span>  
  
 <span data-ttu-id="39fe3-115">Al usar [Create statistics &#40;Transact-sql&#41;](/sql/t-sql/statements/create-statistics-transact-sql) o [UPDATE STATISTICS &#40;transact-SQL&#41;](/sql/t-sql/statements/update-statistics-transact-sql), debe especificar `NORECOMPUTE` para deshabilitar la actualización automática de las estadísticas de las tablas optimizadas para memoria.</span><span class="sxs-lookup"><span data-stu-id="39fe3-115">When using [CREATE STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-statistics-transact-sql) or [UPDATE STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/statements/update-statistics-transact-sql), you must specify `NORECOMPUTE` to disable automatic statistics update for memory-optimized tables.</span></span> <span data-ttu-id="39fe3-116">En el caso de las tablas basadas en disco, [sp_updatestats &#40;Transact-sql&#41;](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql) solo actualiza las estadísticas si la tabla se ha modificado desde el último [sp_updatestats &#40;Transact-SQL ](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql)&#41;.</span><span class="sxs-lookup"><span data-stu-id="39fe3-116">For disk based tables, [sp_updatestats &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql) only updates statistics if the table has been modified since the last [sp_updatestats &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql).</span></span> <span data-ttu-id="39fe3-117">En el caso de las tablas optimizadas para memoria, [sp_updatestats &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql) siempre genera estadísticas actualizadas.</span><span class="sxs-lookup"><span data-stu-id="39fe3-117">For memory-optimized tables, [sp_updatestats &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql) always generates updated statistics.</span></span> <span data-ttu-id="39fe3-118">[sp_updatestats &#40;&#41;de Transact-SQL](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql) es una buena opción para las tablas optimizadas para memoria; en caso contrario, debe saber qué tablas tienen cambios significativos para que pueda actualizar las estadísticas de forma individual.</span><span class="sxs-lookup"><span data-stu-id="39fe3-118">[sp_updatestats &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql) is a good option for memory-optimized tables; otherwise you need to know which tables have significant changes so you can update statistics individually.</span></span>  
  
 <span data-ttu-id="39fe3-119">Se pueden generar estadísticas mediante el muestreo de los datos o realizando un examen completo.</span><span class="sxs-lookup"><span data-stu-id="39fe3-119">Statistics can either be generated by either sampling the data or performing a full scan.</span></span> <span data-ttu-id="39fe3-120">Las estadísticas muestreadas solo usan un ejemplo de los datos de la tabla para estimar la distribución de los datos.</span><span class="sxs-lookup"><span data-stu-id="39fe3-120">Sampled statistics only use a sample of the table data to estimate the data distribution.</span></span> <span data-ttu-id="39fe3-121">Las estadísticas completas examinan toda la tabla para determinar la distribución de los datos.</span><span class="sxs-lookup"><span data-stu-id="39fe3-121">Fullscan statistics scan the entire table to determine the data distribution.</span></span> <span data-ttu-id="39fe3-122">Las estadísticas completas suelen ser más precisas pero tardan más tiempo en calcularse.</span><span class="sxs-lookup"><span data-stu-id="39fe3-122">Fullscan statistics are usually more accurate but take longer to compute.</span></span> <span data-ttu-id="39fe3-123">Las estadísticas muestreadas se pueden recopilar más rápidamente.</span><span class="sxs-lookup"><span data-stu-id="39fe3-123">Sampled statistics can be collected faster.</span></span>  
  
 <span data-ttu-id="39fe3-124">Las tablas basadas en disco usan las estadísticas muestreadas de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="39fe3-124">Disk-based tables use sampled statistics by default.</span></span> <span data-ttu-id="39fe3-125">Las tablas con optimización para memoria solo admiten las estadísticas completas.</span><span class="sxs-lookup"><span data-stu-id="39fe3-125">Memory-optimized tables only support fullscan statistics.</span></span> <span data-ttu-id="39fe3-126">Al usar [Create statistics &#40;Transact-sql&#41;](/sql/t-sql/statements/create-statistics-transact-sql) o [UPDATE STATISTICS &#40;transact-SQL&#41;](/sql/t-sql/statements/update-statistics-transact-sql), debe especificar la `FULLSCAN` opción para las tablas optimizadas para memoria.</span><span class="sxs-lookup"><span data-stu-id="39fe3-126">When using [CREATE STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-statistics-transact-sql) or [UPDATE STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/statements/update-statistics-transact-sql), you must specify the `FULLSCAN` option for memory-optimized tables.</span></span>  
  
 <span data-ttu-id="39fe3-127">Consideraciones adicionales sobre las estadísticas de tablas optimizadas para memoria:</span><span class="sxs-lookup"><span data-stu-id="39fe3-127">Additional considerations for statistics on memory-optimized tables:</span></span>  
  
-   <span data-ttu-id="39fe3-128">Los índices de las tablas optimizadas para memoria se crean con la tabla.</span><span class="sxs-lookup"><span data-stu-id="39fe3-128">Indexes on memory-optimized tables are created with the table.</span></span> <span data-ttu-id="39fe3-129">Las estadísticas de las columnas de clave de índice se crean cuando la tabla está vacía.</span><span class="sxs-lookup"><span data-stu-id="39fe3-129">The statistics on the index key columns are created when the table is empty.</span></span> <span data-ttu-id="39fe3-130">Por lo tanto, estas estadísticas deberán actualizarse después de que los datos se hayan cargado en la tabla.</span><span class="sxs-lookup"><span data-stu-id="39fe3-130">Therefore, these statistics need to be updated after data is loaded into the table.</span></span>  
  
-   <span data-ttu-id="39fe3-131">Para los procedimientos almacenados compilados de forma nativa, los planes de ejecución de las consultas del procedimiento se optimizan cuando se compila el procedimiento.</span><span class="sxs-lookup"><span data-stu-id="39fe3-131">For natively compiled stored procedures, execution plans for queries in the procedure are optimized when the procedure is compiled.</span></span> <span data-ttu-id="39fe3-132">Esto solo ocurre cuando se crea el procedimiento y se reinicia el servidor, no cuando se actualizan las estadísticas.</span><span class="sxs-lookup"><span data-stu-id="39fe3-132">This happens only when the procedure is created and when the server restarts, not when statistics are updated.</span></span> <span data-ttu-id="39fe3-133">Por tanto, las tablas deben contener un conjunto de datos representativo, y las estadísticas deben actualizarse antes de que se creen los procedimientos.</span><span class="sxs-lookup"><span data-stu-id="39fe3-133">Therefore, the tables need to contain a representative set of data and statistics need to be up-to-date before the procedures are created.</span></span> <span data-ttu-id="39fe3-134">(Los procedimientos almacenados compilados de forma nativa se vuelven a compilar si la base de datos se deja sin conexión y se vuelve a poner en línea o si se ha reiniciado el servidor).</span><span class="sxs-lookup"><span data-stu-id="39fe3-134">(Natively compiled stored procedures are recompiled if the database is taken offline and brought back online, or if there is a server restart.)</span></span>  
  
## <a name="guidelines-for-statistics-when-deploying-memory-optimized-tables"></a><span data-ttu-id="39fe3-135">Directrices para las estadísticas cuando se implementan tablas con optimización para memoria</span><span class="sxs-lookup"><span data-stu-id="39fe3-135">Guidelines for Statistics When Deploying Memory-Optimized Tables</span></span>  
 <span data-ttu-id="39fe3-136">Para asegurarse de que el optimizador de consultas dispone de estadísticas actualizadas al crear los planes de consulta, implemente las tablas optimizadas para memoria siguiendo estos cinco pasos:</span><span class="sxs-lookup"><span data-stu-id="39fe3-136">To ensure that the query optimizer has up-to-date statistics when creating query plans, deploy memory-optimized tables using these five steps:</span></span>  
  
1.  <span data-ttu-id="39fe3-137">Cree tablas e índices.</span><span class="sxs-lookup"><span data-stu-id="39fe3-137">Create tables and indexes.</span></span> <span data-ttu-id="39fe3-138">Los índices se especifican insertados en instrucciones `CREATE TABLE`.</span><span class="sxs-lookup"><span data-stu-id="39fe3-138">Indexes are specified inline in the `CREATE TABLE` statements.</span></span>  
  
2.  <span data-ttu-id="39fe3-139">Cargue datos en las tablas.</span><span class="sxs-lookup"><span data-stu-id="39fe3-139">Load data into the tables.</span></span>  
  
3.  <span data-ttu-id="39fe3-140">Actualice las estadísticas de las tablas.</span><span class="sxs-lookup"><span data-stu-id="39fe3-140">Update statistics on the tables.</span></span>  
  
4.  <span data-ttu-id="39fe3-141">Cree procedimientos almacenados que tengan acceso a las tablas.</span><span class="sxs-lookup"><span data-stu-id="39fe3-141">Create stored procedures that access the tables.</span></span>  
  
5.  <span data-ttu-id="39fe3-142">Ejecute la carga de trabajo, que puede contener una combinación de procedimientos almacenados de [!INCLUDE[tsql](../../../includes/tsql-md.md)] compilados de forma nativa e interpretados, así como lotes ad hoc.</span><span class="sxs-lookup"><span data-stu-id="39fe3-142">Run the workload, which can contain a mix of natively compiled and interpreted [!INCLUDE[tsql](../../../includes/tsql-md.md)] stored procedures, as well as ad hoc batches.</span></span>  
  
 <span data-ttu-id="39fe3-143">El hecho de crear procedimientos almacenados compilados de forma nativa después de cargar los datos y actualizar las estadísticas asegura que el optimizador dispondrá de estadísticas para las tablas optimizadas para memoria.</span><span class="sxs-lookup"><span data-stu-id="39fe3-143">Creating natively compiled stored procedures after you load the data and update the statistics ensures that the optimizer has statistics available for the memory-optimized tables.</span></span> <span data-ttu-id="39fe3-144">Esto garantizará planes de consulta eficaces cuando se compile el procedimiento.</span><span class="sxs-lookup"><span data-stu-id="39fe3-144">This will ensure efficient query plans when the procedure is compiled.</span></span>  
  
## <a name="guidelines-for-maintaining-statistics-on-memory-optimized-tables"></a><span data-ttu-id="39fe3-145">Directrices para el mantenimiento de estadísticas en las tablas con optimización para memoria</span><span class="sxs-lookup"><span data-stu-id="39fe3-145">Guidelines for Maintaining Statistics on Memory-Optimized Tables</span></span>  
 <span data-ttu-id="39fe3-146">Para mantener las estadísticas actualizadas, actualice periódicamente las estadísticas de las tablas optimizadas para memoria.</span><span class="sxs-lookup"><span data-stu-id="39fe3-146">To keep statistics up-to-date, regularly update the statistics on memory-optimized tables.</span></span>  
  
 <span data-ttu-id="39fe3-147">Si los datos cambian con frecuencia, deberá actualizar las estadísticas a menudo.</span><span class="sxs-lookup"><span data-stu-id="39fe3-147">If data changes frequently, you should update statistics frequently.</span></span> <span data-ttu-id="39fe3-148">Por ejemplo, actualice las estadísticas de las tablas después de cada actualización por lotes.</span><span class="sxs-lookup"><span data-stu-id="39fe3-148">For example, update table statistics after a batch update.</span></span> <span data-ttu-id="39fe3-149">Después de actualizar las estadísticas, quite y vuelva a crear los procedimientos almacenados compilados de forma nativa para que puedan beneficiarse de las estadísticas actualizadas.</span><span class="sxs-lookup"><span data-stu-id="39fe3-149">After you update statistics, drop and recreate natively compiled stored procedures so they can benefit from the updated statistics.</span></span>  
  
 <span data-ttu-id="39fe3-150">.</span><span class="sxs-lookup"><span data-stu-id="39fe3-150">.</span></span>  
  
 <span data-ttu-id="39fe3-151">No actualice las estadísticas durante un período de carga de trabajo máxima.</span><span class="sxs-lookup"><span data-stu-id="39fe3-151">Do not update statistics during peak workload.</span></span>  
  
 <span data-ttu-id="39fe3-152">Para actualizar las estadísticas:</span><span class="sxs-lookup"><span data-stu-id="39fe3-152">To update statistics:</span></span>  
  
-   <span data-ttu-id="39fe3-153">Use [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] para [Create a Maintenance Plan](../maintenance-plans/create-a-maintenance-plan.md) con una [Tarea Actualizar estadísticas](../maintenance-plans/update-statistics-task-maintenance-plan.md)</span><span class="sxs-lookup"><span data-stu-id="39fe3-153">Use [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] to [Create a Maintenance Plan](../maintenance-plans/create-a-maintenance-plan.md) with an [Update Statistic Task](../maintenance-plans/update-statistics-task-maintenance-plan.md)</span></span>  
  
-   <span data-ttu-id="39fe3-154">O bien, actualice las estadísticas mediante un script [!INCLUDE[tsql](../../../includes/tsql-md.md)] , tal como se describe a continuación.</span><span class="sxs-lookup"><span data-stu-id="39fe3-154">Or, update statistics through a [!INCLUDE[tsql](../../../includes/tsql-md.md)] script, as discussed below.</span></span>  
  
 <span data-ttu-id="39fe3-155">Para actualizar las estadísticas de una sola tabla optimizada para memoria (*myschema*.</span><span class="sxs-lookup"><span data-stu-id="39fe3-155">To update the statistics for a single memory-optimized table (*myschema*.</span></span> <span data-ttu-id="39fe3-156">*Mytable*), ejecute el script siguiente:</span><span class="sxs-lookup"><span data-stu-id="39fe3-156">*Mytable*), run the following script:</span></span>  
  
```  
UPDATE STATISTICS myschema.Mytable WITH FULLSCAN, NORECOMPUTE  
```  
  
 <span data-ttu-id="39fe3-157">Para actualizar las estadísticas de todas las tablas optimizadas para memoria de la base de datos actual, ejecute el script siguiente:</span><span class="sxs-lookup"><span data-stu-id="39fe3-157">To update statistics for all memory-optimized tables in the current database, run the following script:</span></span>  
  
```sql  
DECLARE @sql NVARCHAR(MAX) = N''  
  
SELECT @sql += N'  
   UPDATE STATISTICS ' + quotename(schema_name(schema_id)) + N'.' + quotename(name) + N' WITH FULLSCAN, NORECOMPUTE'  
FROM sys.tables WHERE is_memory_optimized=1  
  
EXEC sp_executesql @sql  
```  
  
 <span data-ttu-id="39fe3-158">Para actualizar las estadísticas de todas las tablas de la base de datos, ejecute [sp_updatestats &#40;&#41;de Transact-SQL ](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="39fe3-158">To update statistics for all tables in the database, run [sp_updatestats &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql).</span></span>  
  
 <span data-ttu-id="39fe3-159">En el ejemplo siguiente se informa de cuándo se han actualizado por última vez las estadísticas de las tablas optimizadas para memoria.</span><span class="sxs-lookup"><span data-stu-id="39fe3-159">The following sample reports when the statistics on memory-optimized tables were last updated.</span></span> <span data-ttu-id="39fe3-160">Esta información puede ayudarle a determinar si necesita actualizar las estadísticas.</span><span class="sxs-lookup"><span data-stu-id="39fe3-160">This information can help you decide if you need to update the statistics.</span></span>  
  
```sql  
select t.object_id, t.name, sp.last_updated as 'stats_last_updated'  
from sys.tables t join sys.stats s on t.object_id=s.object_id cross apply sys.dm_db_stats_properties(t.object_id, s.stats_id) sp  
where t.is_memory_optimized=1  
```  
  
## <a name="see-also"></a><span data-ttu-id="39fe3-161">Consulte también</span><span class="sxs-lookup"><span data-stu-id="39fe3-161">See Also</span></span>  
 [<span data-ttu-id="39fe3-162">Tablas optimizadas para la memoria</span><span class="sxs-lookup"><span data-stu-id="39fe3-162">Memory-Optimized Tables</span></span>](memory-optimized-tables.md)  
  
  
