---
title: Introducción a la carga masiva XML (SQLXML 4,0) | Microsoft Docs
ms.custom: ''
ms.date: 03/07/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xml
ms.topic: reference
helpviewer_keywords:
- nontransacted XML Bulk Load operations
- XML Bulk Load [SQLXML], about XML Bulk Load
- bulk load [SQLXML], about bulk load
- transacted XML Bulk Load operations
- streaming XML data
ms.assetid: 38bd3cbd-65ef-4c23-9ef3-e70ecf6bb88a
author: rothja
ms.author: jroth
ms.openlocfilehash: 4f3e0e78edd967e5fcb7377312c1811d34cb1ef8
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87744028"
---
# <a name="introduction-to-xml-bulk-load-sqlxml-40"></a><span data-ttu-id="ff8e2-102">Introducción a la carga masiva XML (SQLXML 4.0)</span><span class="sxs-lookup"><span data-stu-id="ff8e2-102">Introduction to XML Bulk Load (SQLXML 4.0)</span></span>
  <span data-ttu-id="ff8e2-103">La carga masiva XML es un objeto COM independiente que permite cargar datos XML semiestructurados en tablas de Microsoft [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="ff8e2-103">XML Bulk Load is a stand-alone COM object that allows you to load semistructured XML data into Microsoft [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] tables.</span></span>  
  
 <span data-ttu-id="ff8e2-104">Puede insertar datos XML en una base de datos de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] mediante una instrucción INSERT y la función OPENXML; sin embargo, la utilidad Carga masiva proporciona mejor rendimiento cuando es necesario insertar grandes cantidades de datos XML.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-104">You can insert XML data into a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database by using an INSERT statement and the OPENXML function; however, the Bulk Load utility provides better performance when you need to insert large amounts of XML data.</span></span>  
  
 <span data-ttu-id="ff8e2-105">El método Execute del modelo de objetos de carga masiva XML toma dos parámetros:</span><span class="sxs-lookup"><span data-stu-id="ff8e2-105">The Execute method of the XML Bulk Load object model takes two parameters:</span></span>  
  
-   <span data-ttu-id="ff8e2-106">Una definición de esquema XML anotado (XSD) o un esquema reducido de datos XML (XDR).</span><span class="sxs-lookup"><span data-stu-id="ff8e2-106">An annotated XML Schema Definition (XSD) or XML-Data Reduced (XDR) schema.</span></span> <span data-ttu-id="ff8e2-107">La utilidad Carga masiva XML interpreta este esquema de asignación y las anotaciones que se especifican en el esquema para identificar las tablas de SQL Server donde se insertarán los datos XML.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-107">The XML Bulk Load utility interprets this mapping schema and the annotations that are specified in the schema in identifying the SQL Server tables into which the XML data is to be inserted.</span></span>  
  
-   <span data-ttu-id="ff8e2-108">Un documento o fragmento de documento XML (un fragmento de documento es un documento sin un elemento de nivel superior único).</span><span class="sxs-lookup"><span data-stu-id="ff8e2-108">An XML document or document fragment (a document fragment is a document without a single top-level element).</span></span> <span data-ttu-id="ff8e2-109">Se puede especificar un nombre de archivo o un flujo del que Carga masiva XML pueda leer.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-109">A file name or a stream from which XML Bulk Load can read can be specified.</span></span>  
  
 <span data-ttu-id="ff8e2-110">Carga masiva XML interpreta el esquema de asignación e identifica las tablas donde se insertarán los datos XML.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-110">XML Bulk Load interprets the mapping schema and identifies the table(s) into which the XML data is to be inserted.</span></span>  
  
 <span data-ttu-id="ff8e2-111">Se supone que está familiarizado con las siguientes características de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="ff8e2-111">It is assumed that you are familiar with the following [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] features:</span></span>  
  
-   <span data-ttu-id="ff8e2-112">Esquemas XSD y XDR anotados.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-112">Annotated XSD and XDR schemas.</span></span> <span data-ttu-id="ff8e2-113">Para obtener más información acerca de los esquemas XSD anotados, vea [Introducción a los esquemas XSD anotados &#40;SQLXML 4,0&#41;](../../sqlxml/annotated-xsd-schemas/introduction-to-annotated-xsd-schemas-sqlxml-4-0.md).</span><span class="sxs-lookup"><span data-stu-id="ff8e2-113">For more information about annotated XSD schemas, see [Introduction to Annotated XSD Schemas &#40;SQLXML 4.0&#41;](../../sqlxml/annotated-xsd-schemas/introduction-to-annotated-xsd-schemas-sqlxml-4-0.md).</span></span> <span data-ttu-id="ff8e2-114">Para obtener información acerca de los esquemas XDR anotados, vea [esquemas XDR anotados &#40;en desuso en SQLXML 4,0&#41;](../../sqlxml/annotated-xsd-schemas/annotated-xdr-schemas-deprecated-in-sqlxml-4-0.md).</span><span class="sxs-lookup"><span data-stu-id="ff8e2-114">For information about annotated XDR schemas, see [Annotated XDR Schemas &#40;Deprecated in SQLXML 4.0&#41;](../../sqlxml/annotated-xsd-schemas/annotated-xdr-schemas-deprecated-in-sqlxml-4-0.md).</span></span>  
  
-   <span data-ttu-id="ff8e2-115">Los mecanismos de inserción masiva de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], como la instrucción BULK INSERT de [!INCLUDE[tsql](../../../includes/tsql-md.md)] y la utilidad bcp.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-115">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] bulk insert mechanisms, such as the [!INCLUDE[tsql](../../../includes/tsql-md.md)] BULK INSERT statement and the bcp utility.</span></span> <span data-ttu-id="ff8e2-116">Para obtener más información, vea BULK INSERT &#40;la utilidad&#41;y [BCP](../../../tools/bcp-utility.md)de [Transact-SQL](/sql/t-sql/statements/bulk-insert-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="ff8e2-116">For more information, see [BULK INSERT &#40;Transact-SQL&#41;](/sql/t-sql/statements/bulk-insert-transact-sql) and [bcp Utility](../../../tools/bcp-utility.md).</span></span>  
  
## <a name="streaming-of-xml-data"></a><span data-ttu-id="ff8e2-117">Transmitir datos XML por secuencias</span><span class="sxs-lookup"><span data-stu-id="ff8e2-117">Streaming of XML Data</span></span>  
 <span data-ttu-id="ff8e2-118">Dado que el documento XML de origen puede ser grande, en el procesamiento de carga masiva no se carga en memoria todo el documento.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-118">Because the source XML document can be large, the entire document is not read into memory for bulk load processing.</span></span> <span data-ttu-id="ff8e2-119">En su lugar, Carga masiva XML interpreta los datos XML como un flujo y lo lee.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-119">Instead, XML Bulk Load interprets the XML data as a stream and reads it.</span></span> <span data-ttu-id="ff8e2-120">A medida que la utilidad lee los datos, identifica las tablas de base de datos, genera los registros adecuados a partir del origen de datos XML y, a continuación, envía los registros a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] para la inserción.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-120">As the utility reads the data, it identifies the database table(s), generates the appropriate record(s) from the XML data source, and then sends the record(s) to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] for insertion.</span></span>  
  
 <span data-ttu-id="ff8e2-121">Por ejemplo, el siguiente documento XML de origen consta de **\<Customer>** elementos y **\<Order>** elementos secundarios:</span><span class="sxs-lookup"><span data-stu-id="ff8e2-121">For example, the following source XML document consists of **\<Customer>** elements and **\<Order>** child elements:</span></span>  
  
```  
<Customer ...>  
    <Order.../>  
    <Order .../>  
     ...  
</Customer>  
...  
```  
  
 <span data-ttu-id="ff8e2-122">A medida que la carga masiva XML lee el **\<Customer>** elemento, genera un registro para el Customertable.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-122">As XML Bulk Load reads the **\<Customer>** element, it generates a record for the Customertable.</span></span> <span data-ttu-id="ff8e2-123">Cuando lee la **\</Customer>** etiqueta de cierre, la carga masiva XML inserta el registro en la tabla de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="ff8e2-123">When it reads the **\</Customer>** end tag, XML Bulk Load inserts that record into the table in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="ff8e2-124">Del mismo modo, cuando lee el **\<Order>** elemento, la carga masiva XML genera un registro para el Ordertable y, a continuación, inserta ese registro en la [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] tabla al leer la **\</Order>** etiqueta de cierre.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-124">In the same way, when it reads the **\<Order>** element, XML Bulk Load generates a record for the Ordertable, and then inserts that record into the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] table upon reading the **\</Order>** end tag.</span></span>  
  
## <a name="transacted-and-nontransacted-xml-bulk-load-operations"></a><span data-ttu-id="ff8e2-125">Operaciones de Carga masiva XML con y sin transacciones</span><span class="sxs-lookup"><span data-stu-id="ff8e2-125">Transacted and Nontransacted XML Bulk Load Operations</span></span>  
 <span data-ttu-id="ff8e2-126">Carga masiva XML puede funcionar tanto en modo con transacciones como en modo sin transacciones.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-126">XML Bulk Load can operate in either a transacted or a nontransacted mode.</span></span> <span data-ttu-id="ff8e2-127">El rendimiento suele ser óptimo si se realiza una carga masiva en un modo no transactd: es decir, la propiedad de transacción se establece en FALSE y se cumple cualquiera de las condiciones siguientes:</span><span class="sxs-lookup"><span data-stu-id="ff8e2-127">Performance is usually optimal if you are bulk loading in a nontransacted mode: that is, the Transaction property is set to FALSE) and either of the following conditions is true:</span></span>  
  
-   <span data-ttu-id="ff8e2-128">Las tablas donde se realiza la carga masiva de los datos están vacías y no tienen índices.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-128">The tables into which the data is bulk loaded are empty with no indexes.</span></span>  
  
-   <span data-ttu-id="ff8e2-129">Las tablas tienen datos e índices únicos.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-129">The tables have data and unique indexes.</span></span>  
  
 <span data-ttu-id="ff8e2-130">El enfoque sin transacciones no garantiza una reversión si se produce algún error en el proceso de carga masiva (si bien se pueden producir reversiones parciales).</span><span class="sxs-lookup"><span data-stu-id="ff8e2-130">The nontransacted approach does not guarantee a rollback if something goes wrong in the bulk load process (although partial rollbacks can happen).</span></span> <span data-ttu-id="ff8e2-131">La carga masiva sin transacciones es adecuada cuando la base de datos está vacía.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-131">The nontransacted bulk load is appropriate when the database is empty.</span></span> <span data-ttu-id="ff8e2-132">Por tanto, si algo sale mal, puede limpiar la base de datos e iniciar de nuevo Carga masiva XML.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-132">Therefore, if something does go wrong, you can clean the database and start XML Bulk Load again.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ff8e2-133">En modo sin transacciones, Carga masiva XML utiliza una transacción interna predeterminada y la confirma.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-133">In nontransacted mode, XML Bulk Load uses a default internal transaction and commits it.</span></span> <span data-ttu-id="ff8e2-134">Cuando la propiedad de transacción se establece en TRUE, la carga masiva XML no llama a commit en esta transacción.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-134">When the Transaction property is set to TRUE, XML Bulk Load does not call commit on this transaction.</span></span>  
  
 <span data-ttu-id="ff8e2-135">Si la propiedad de transacción se establece en TRUE, la carga masiva XML crea archivos temporales, uno para cada tabla que se identifica en el esquema de asignación.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-135">If the Transaction property is set to TRUE, XML Bulk Load creates temporary files, one for each table that is identified in the mapping schema.</span></span> <span data-ttu-id="ff8e2-136">Carga masiva XML almacena en primer lugar los registros del documento XML de origen en estos archivos temporales.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-136">XML Bulk Load first stores the records from the source XML document in these temporary files.</span></span> <span data-ttu-id="ff8e2-137">A continuación, la instrucción BULK INSERT de [!INCLUDE[tsql](../../../includes/tsql-md.md)] recupera estos registros de los archivos y los almacena en las tablas correspondientes.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-137">Then, a [!INCLUDE[tsql](../../../includes/tsql-md.md)] BULK INSERT statement retrieves these records from the files and stores them in the corresponding tables.</span></span> <span data-ttu-id="ff8e2-138">Puede especificar la ubicación de estos archivos temporales mediante la propiedad TempFilePath.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-138">You can specify the location for these temporary files by using the TempFilePath property.</span></span> <span data-ttu-id="ff8e2-139">Debe asegurarse de que la cuenta de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] que se utiliza con Carga masiva XML tiene acceso a esta ruta.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-139">You must ensure that the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] account used with XML Bulk Load has access to this path.</span></span> <span data-ttu-id="ff8e2-140">Si no se especifica la propiedad TempFilePath, se usa la ruta de acceso de archivo predeterminada que se especifica en la variable de entorno TEMP para crear los archivos temporales.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-140">If the TempFilePath property is not specified, the default file path that is specified in the TEMP environment variable is used to create the temporary files.</span></span>  
  
 <span data-ttu-id="ff8e2-141">Si la propiedad Transaction está establecida en FALSE (el valor predeterminado), la carga masiva XML usa la interfaz OLE DB IRowsetFastLoad para cargar los datos de forma masiva.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-141">If the Transaction property is set to FALSE (the default setting), XML Bulk Load uses the OLE DB interface IRowsetFastLoad to bulk load the data.</span></span>  
  
 <span data-ttu-id="ff8e2-142">Si la propiedad ConnectionString establece la cadena de conexión y la propiedad Transaction está establecida en TRUE, la carga masiva XML funciona en su propio contexto de transacción.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-142">If the ConnectionString property sets the connection string, and the Transaction property is set to TRUE, XML Bulk Load operates in its own transaction context.</span></span> <span data-ttu-id="ff8e2-143">(Por ejemplo, Carga masiva XML inicia su propia transacción y confirma o revierte según corresponda.)</span><span class="sxs-lookup"><span data-stu-id="ff8e2-143">(For example, XML Bulk Load starts its own transaction, and commits or rolls back as appropriate.)</span></span>  
  
 <span data-ttu-id="ff8e2-144">Si la propiedad ConnectionCommand establece la conexión con un objeto de conexión existente y la propiedad de transacción está establecida en TRUE, la carga masiva XML no emite una instrucción COMMIT o ROLLBACK en caso de que se produzca un error o un error, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-144">If the ConnectionCommand property sets the connection with an existing connection object and the Transaction property is set to TRUE, XML Bulk Load does not issue a COMMIT or ROLLBACK statement in the case of a success or a failure, respectively.</span></span> <span data-ttu-id="ff8e2-145">Si se produce un error, Carga masiva XML devuelve el mensaje de error adecuado.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-145">If there is an error, XML Bulk Load returns the appropriate error message.</span></span> <span data-ttu-id="ff8e2-146">La decisión de emitir una instrucción COMMIT o ROLLBACK queda en manos del cliente que inició la carga masiva.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-146">The decision to issue a COMMIT or ROLLBACK statement is left to the client that initiated the bulk load.</span></span> <span data-ttu-id="ff8e2-147">El objeto de conexión que se usa para la carga masiva XML debe ser de tipo ICommand o ser un objeto de comando de ADO.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-147">The connection object that is used for XML Bulk Load should be of type ICommand or be an ADO command object.</span></span>  
  
 <span data-ttu-id="ff8e2-148">En SQLXML 4,0, no se puede usar un ConnectionObject con la propiedad de transacción establecida en FALSE.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-148">In SQLXML 4.0, a ConnectionObject cannot be used with the Transaction property set to FALSE.</span></span> <span data-ttu-id="ff8e2-149">El modo no transactd no es compatible con ConnectionObject porque es imposible abrir más de una interfaz IRowsetFastLoad en una sesión pasada.</span><span class="sxs-lookup"><span data-stu-id="ff8e2-149">The nontransacted mode is not supported with a ConnectionObject because it is impossible to open more than one IRowsetFastLoad interface on a passed-in session.</span></span>  
  
  
