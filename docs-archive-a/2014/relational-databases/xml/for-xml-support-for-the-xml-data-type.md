---
title: Compatibilidad de FOR XML con el tipo de datos xml | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xml
ms.topic: conceptual
helpviewer_keywords:
- user-defined functions [SQL Server], XML
- xml data type [SQL Server], FOR XML clause
ms.assetid: 365de07d-694c-4c8b-b671-8825be27f87c
author: rothja
ms.author: jroth
ms.openlocfilehash: 16b03d5f10ded40bb284c409f772ee8986060515
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87751982"
---
# <a name="for-xml-support-for-the-xml-data-type"></a><span data-ttu-id="ea18a-102">Compatibilidad de FOR XML con el tipo de datos xml</span><span class="sxs-lookup"><span data-stu-id="ea18a-102">FOR XML Support for the xml Data Type</span></span>
  <span data-ttu-id="ea18a-103">Si una consulta FOR XML especifica una columna de tipo `xml` en la cláusula SELECT, los valores de columna se asignan como elementos en el XML devuelto, aunque no se especifique la directiva ELEMENTS.</span><span class="sxs-lookup"><span data-stu-id="ea18a-103">If a FOR XML query specifies a column of `xml` type in the SELECT clause, column values are mapped as elements in the returned XML, regardless of whether you specify the ELEMENTS directive.</span></span> <span data-ttu-id="ea18a-104">Las declaraciones XML en la columna de tipo `xml` no se serializan.</span><span class="sxs-lookup"><span data-stu-id="ea18a-104">Any XML declaration in the `xml` type column is not serialized.</span></span>  
  
 <span data-ttu-id="ea18a-105">Por ejemplo, la consulta siguiente recupera información de contacto del cliente, como `BusinessEntityID` las `FirstName` columnas, y `LastName` , y los números de teléfono de la `AdditionalContactInfo` columna de `xml` tipo.</span><span class="sxs-lookup"><span data-stu-id="ea18a-105">For example, the following query retrieves customer contact information such as the `BusinessEntityID`, `FirstName`, and `LastName` columns, and the telephone numbers from the `AdditionalContactInfo` column of `xml` type.</span></span>  
  
```  
USE AdventureWorks2012;  
GO  
SELECT BusinessEntityID, FirstName, LastName, AdditionalContactInfo.query('  
declare namespace act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes";  
 //act:telephoneNumber/act:number  
') AS PhoneNumber  
FROM Person.Person  
WHERE AdditionalContactInfo.query('  
declare namespace act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes";  
 //act:telephoneNumber/act:number  
')IS NOT NULL  
FOR XML AUTO, TYPE;  
```  
  
 <span data-ttu-id="ea18a-106">Como la consulta no especifica la directiva ELEMENTS, los valores de columna se devuelven como atributos, excepto en el caso de los valores de información de contacto adicional recuperados de la columna de tipo `xml`.</span><span class="sxs-lookup"><span data-stu-id="ea18a-106">Because the query does not specify the ELEMENTS directive, the column values are returned as attributes, except for the additional contact information values retrieved from the `xml` type column.</span></span> <span data-ttu-id="ea18a-107">Estos se devuelven como elementos.</span><span class="sxs-lookup"><span data-stu-id="ea18a-107">These are returned as elements.</span></span>  
  
 <span data-ttu-id="ea18a-108">Éste es el resultado parcial:</span><span class="sxs-lookup"><span data-stu-id="ea18a-108">This is the partial result:</span></span>  
  
 `<Person.Person BusinessEntityID="291" FirstName="Gustavo" LastName="Achong">`  
  
 `<PhoneNumber>`  
  
 `<act:number xmlns:act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes">425-555-1112</act:number>`  
  
 `<act:number xmlns:act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes">425-555-1111</act:number>`  
  
 `</PhoneNumber>`  
  
 `</Person.Person>`  
  
 `<Person.Person BusinessEntityID="293" FirstName="Catherine" LastName="Abel">`  
  
 `<PhoneNumber>`  
  
 `<act:number xmlns:act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes">206-555-2222</act:number>`  
  
 `<act:number xmlns:act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes">206-555-1234</act:number>`  
  
 `</PhoneNumber>`  
  
```  
</Person.Person>  
...  
```  
  
 <span data-ttu-id="ea18a-109">Si se especifica un alias de columna para la columna XML generada por la consulta XQuery, se utiliza ese alias para agregar un elemento contenedor alrededor del XML generado.</span><span class="sxs-lookup"><span data-stu-id="ea18a-109">If you specify a column alias for the XML column generated by the XQuery, that alias is used to add a wrapper element around the XML generated by the XQuery.</span></span> <span data-ttu-id="ea18a-110">Por ejemplo, la consulta siguiente especifica `MorePhoneNumbers` como alias de columna:</span><span class="sxs-lookup"><span data-stu-id="ea18a-110">For example, the following query specifies `MorePhoneNumbers` as a column alias:</span></span>  
  
```  
SELECT BusinessEntityID, FirstName, LastName, AdditionalContactInfo.query('  
declare namespace act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes";  
 //act:telephoneNumber/act:number  
') AS PhoneNumber  
FROM Person.Person  
WHERE AdditionalContactInfo.query('  
declare namespace act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes";  
 //act:telephoneNumber/act:number  
')IS NOT NULL  
FOR XML AUTO, TYPE;  
```  
  
 <span data-ttu-id="ea18a-111">El XML devuelto por la consulta XQuery se incluye dentro del elemento <`MorePhoneNumbers`>, como se muestra en el siguiente resultado parcial:</span><span class="sxs-lookup"><span data-stu-id="ea18a-111">The XML returned by the XQuery is wrapped in the <`MorePhoneNumbers`> element, as shown in the following partial result:</span></span>  
  
 `<Person.Person BusinessEntityID="291" FirstName="Gustavo" LastName="Achong">`  
  
 `<MorePhoneNumbers>`  
  
 `<act:number xmlns:act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes">425-555-1112</act:number>`  
  
 `<act:number xmlns:act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes">425-555-1111</act:number>`  
  
 `</MorePhoneNumbers>`  
  
 `</Person.Person>`  
  
 `<Person.Person BusinessEntityID="293" FirstName="Catherine" LastName="Abel">`  
  
 `<MorePhoneNumbers>`  
  
 `<act:number xmlns:act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes">206-555-2222</act:number>`  
  
 `<act:number xmlns:act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes">206-555-1234</act:number>`  
  
 `</MorePhoneNumbers>`  
  
```  
</Person.Person>  
...  
```  
  
 <span data-ttu-id="ea18a-112">Si se especifica la directiva ELEMENTS en la consulta, se devolverán BusinessEntityID, LastName y FirstName como elementos en el XML resultante.</span><span class="sxs-lookup"><span data-stu-id="ea18a-112">If you specify the ELEMENTS directive in the query, the BusinessEntityID, LastName, and FirstName will be returned as elements in the resulting XML.</span></span>  
  
 <span data-ttu-id="ea18a-113">En el ejemplo siguiente se muestra cómo la lógica de procesamiento de FOR XML no serializa las declaraciones XML de los datos XML de una columna de tipo `xml`:</span><span class="sxs-lookup"><span data-stu-id="ea18a-113">The following example illustrates that the FOR XML processing logic does not serialize any XML declarations in the XML data from an `xml` type column:</span></span>  
  
```  
create table t(i int, x xml)  
go  
insert into t values(1, '<?xml version="1.0" encoding="UTF-8" ?>  
                             <Root SomeID="10" />')  
select i, x  
from   t  
for xml auto;  
```  
  
 <span data-ttu-id="ea18a-114">Éste es el resultado.</span><span class="sxs-lookup"><span data-stu-id="ea18a-114">This is the result.</span></span> <span data-ttu-id="ea18a-115">En el resultado, no se serializa la declaración XML <`?xml version="1.0" encoding="UTF-8" ?`>.</span><span class="sxs-lookup"><span data-stu-id="ea18a-115">In the result, the XML declaration <`?xml version="1.0" encoding="UTF-8" ?`> is not serialized.</span></span>  
  
```  
<root>  
  <t i="1">  
    <x>  
      <Root SomeID="10" />  
    </x>  
  </t>  
</root>  
```  
  
## <a name="returning-xml-from-a-user-defined-function"></a><span data-ttu-id="ea18a-116">Devolver XML con una función definida por el usuario</span><span class="sxs-lookup"><span data-stu-id="ea18a-116">Returning XML from a User-defined Function</span></span>  
 <span data-ttu-id="ea18a-117">Se pueden utilizar consultas FOR XML para obtener XML utilizando una función definida por el usuario que devuelva alguno de los siguientes resultados:</span><span class="sxs-lookup"><span data-stu-id="ea18a-117">FOR XML queries can be used for returning XML from a user-defined function that returns either of the following:</span></span>  
  
-   <span data-ttu-id="ea18a-118">Una tabla con una sola columna de tipo `xml`</span><span class="sxs-lookup"><span data-stu-id="ea18a-118">A table with a single `xml` type column</span></span>  
  
-   <span data-ttu-id="ea18a-119">Una instancia del tipo `xml`</span><span class="sxs-lookup"><span data-stu-id="ea18a-119">An instance of the `xml` type</span></span>  
  
 <span data-ttu-id="ea18a-120">Por ejemplo, la siguiente función definida por el usuario devuelve una tabla con una sola columna de tipo `xm`l:</span><span class="sxs-lookup"><span data-stu-id="ea18a-120">For example, the following user-defined function returns a table with a single column of `xm`l type:</span></span>  
  
```  
USE AdventureWorks2012;  
GO  
CREATE FUNCTION dbo.MyUDF (@ProudctModelID int)  
RETURNS @T TABLE  
  (  
     ProductDescription xml  
  )  
AS  
BEGIN  
  INSERT @T  
     SELECT CatalogDescription.query('  
declare namespace PD="http://www.adventure-works.com/schemas/products/description";  
                    //PD:ProductDescription  ')  
     FROM Production.ProductModel  
     WHERE ProductModelID = @ProudctModelID  
  RETURN  
END;  
```  
  
 <span data-ttu-id="ea18a-121">Se puede ejecutar la función definida por el usuario y consultar la tabla que devuelve.</span><span class="sxs-lookup"><span data-stu-id="ea18a-121">You can execute the user-defined function and query the table returned by it.</span></span> <span data-ttu-id="ea18a-122">En este ejemplo, el XML devuelto al consultar la tabla se asigna a una variable de tipo `xml`.</span><span class="sxs-lookup"><span data-stu-id="ea18a-122">In this example, the XML returned by querying the table is assigned to an `xml` type variable.</span></span>  
  
```  
declare @x xml;  
set @x = (SELECT * FROM MyUDF(19));  
select @x;  
```  
  
 <span data-ttu-id="ea18a-123">Este es otro ejemplo de función definida por el usuario.</span><span class="sxs-lookup"><span data-stu-id="ea18a-123">This is another example of a user-defined function.</span></span> <span data-ttu-id="ea18a-124">Esta función definida por el usuario devuelve una instancia del tipo `xml`.</span><span class="sxs-lookup"><span data-stu-id="ea18a-124">This user-defined function returns an instance of the `xml` type.</span></span> <span data-ttu-id="ea18a-125">En este ejemplo, la función definida por el usuario devuelve una instancia XML con tipo, porque se especifica el espacio de nombres del esquema.</span><span class="sxs-lookup"><span data-stu-id="ea18a-125">In this example, the user-defined function returns a typed XML instance, because the schema namespace is specified.</span></span>  
  
```  
DROP FUNCTION dbo.MyUDF;  
GO  
CREATE FUNCTION MyUDF (@ProductModelID int)   
RETURNS xml ([Production].[ProductDescriptionSchemaCollection])  
AS  
BEGIN  
  declare @x xml  
  set @x =   ( SELECT CatalogDescription  
          FROM Production.ProductModel  
          WHERE ProductModelID = @ProductModelID )  
  return @x  
END;  
```  
  
 <span data-ttu-id="ea18a-126">El resultado XML devuelto por la función definida por el usuario se puede asignar a una variable de tipo `xml`, como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="ea18a-126">The XML returned by the user-defined function can be assigned to an `xml` type variable as follows:</span></span>  
  
```  
declare @x xml;  
SELECT @x= dbo.MyUDF4 (19) ;  
select @x;  
```  
  
## <a name="see-also"></a><span data-ttu-id="ea18a-127">Consulte también</span><span class="sxs-lookup"><span data-stu-id="ea18a-127">See Also</span></span>  
 [<span data-ttu-id="ea18a-128">Compatibilidad de FOR XML con varios tipos de datos de SQL Server</span><span class="sxs-lookup"><span data-stu-id="ea18a-128">FOR XML Support for Various SQL Server Data Types</span></span>](for-xml-support-for-various-sql-server-data-types.md)  
  
  
