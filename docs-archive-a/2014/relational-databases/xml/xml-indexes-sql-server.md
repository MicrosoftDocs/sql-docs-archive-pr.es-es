---
title: Índices XML (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xml
ms.topic: conceptual
helpviewer_keywords:
- removing indexes
- deleting indexes
- secondary indexes [XML in SQL Server]
- xml data type [SQL Server], indexes
- dropping indexes
- PATH index
- DROP_EXISTING clause
- XML [SQL Server], indexes
- primary indexes [XML in SQL Server]
- indexes [SQL Server], XML
- XML indexes [SQL Server], secondary
- BLOBs, XML indexes
- disabling indexes
- XML indexes [SQL Server], modifying
- XML indexes [SQL Server]
- XML indexes [SQL Server], primary
- modifying indexes
- XML indexes [SQL Server], dropping
- VALUE index
- XML indexes [SQL Server], xml data type
- PROPERTY index
- XML indexes [SQL Server], creating
ms.assetid: f5c9209d-b3f3-4543-b30b-01365a5e7333
author: rothja
ms.author: jroth
ms.openlocfilehash: bf9a33bc18790bf8821d778746a708f78bbb3d8f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87674670"
---
# <a name="xml-indexes-sql-server"></a><span data-ttu-id="1f2a5-102">Índices XML (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="1f2a5-102">XML Indexes (SQL Server)</span></span>
  <span data-ttu-id="1f2a5-103">Es posible crear índices XML en columnas del tipo de datos `xml`.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-103">XML indexes can be created on `xml` data type columns.</span></span> <span data-ttu-id="1f2a5-104">Se indizan todas las etiquetas, los valores y las rutas de acceso de las instancias XML de la columna y se mejora el rendimiento de las consultas.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-104">They index all tags, values and paths over the XML instances in the column and benefit query performance.</span></span> <span data-ttu-id="1f2a5-105">Un índice XML puede afectar positivamente a una aplicación en estas situaciones:</span><span class="sxs-lookup"><span data-stu-id="1f2a5-105">Your application may benefit from an XML index in the following situations:</span></span>  
  
-   <span data-ttu-id="1f2a5-106">Las consultas en columnas XML son habituales en su carga de trabajo.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-106">Queries on XML columns are common in your workload.</span></span> <span data-ttu-id="1f2a5-107">Es preciso considerar el costo de mantenimiento del índice XML durante la modificación de datos.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-107">XML index maintenance cost during data modification must be considered.</span></span>  
  
-   <span data-ttu-id="1f2a5-108">Los valores XML son relativamente grandes y las partes recuperadas son relativamente pequeñas.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-108">Your XML values are relatively large and the retrieved parts are relatively small.</span></span> <span data-ttu-id="1f2a5-109">La generación del índice evita tener que analizar todo el conjunto de datos en tiempo de ejecución y favorece las búsquedas basadas en índices que permiten un procesamiento más eficiente de las consultas.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-109">Building the index avoids parsing the whole data at run time and benefits index lookups for efficient query processing.</span></span>  
  
 <span data-ttu-id="1f2a5-110">Los índices XML se dividen en las categorías siguientes:</span><span class="sxs-lookup"><span data-stu-id="1f2a5-110">XML indexes fall into the following categories:</span></span>  
  
-   <span data-ttu-id="1f2a5-111">Índice XML principal</span><span class="sxs-lookup"><span data-stu-id="1f2a5-111">Primary XML index</span></span>  
  
-   <span data-ttu-id="1f2a5-112">Índice XML secundario</span><span class="sxs-lookup"><span data-stu-id="1f2a5-112">Secondary XML index</span></span>  
  
 <span data-ttu-id="1f2a5-113">El primer índice de la columna de tipo `xml` debe ser el índice XML principal.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-113">The first index on the `xml` type column must be the primary XML index.</span></span> <span data-ttu-id="1f2a5-114">Con el índice XML principal, se admiten los siguientes tipos de índices secundarios: PATH, VALUE y PROPERTY.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-114">Using the primary XML index, the following types of secondary indexes are supported: PATH, VALUE, and PROPERTY.</span></span> <span data-ttu-id="1f2a5-115">Dependiendo del tipo de consulta, los índices secundarios pueden contribuir a mejorar el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-115">Depending on the type of queries, these secondary indexes might help improve query performance.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="1f2a5-116">No puede crear o modificar un índice XML si las opciones de base de datos no están establecidas correctamente para trabajar con el tipo de datos `xml`.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-116">You cannot create or modify an XML index unless the database options are set correctly for working with the `xml` data type.</span></span> <span data-ttu-id="1f2a5-117">Para obtener más información, vea [Usar la búsqueda de texto completo con columnas XML](use-full-text-search-with-xml-columns.md).</span><span class="sxs-lookup"><span data-stu-id="1f2a5-117">For more information, see [Use Full-Text Search with XML Columns](use-full-text-search-with-xml-columns.md).</span></span>  
  
 <span data-ttu-id="1f2a5-118">Las instancias XML se almacenan en las columnas de tipo `xml` como objetos binarios grandes (BLOB).</span><span class="sxs-lookup"><span data-stu-id="1f2a5-118">XML instances are stored in `xml` type columns as large binary objects (BLOBs).</span></span> <span data-ttu-id="1f2a5-119">Estas instancias XML pueden ser grandes, y la representación binaria almacenada de instancias de datos de tipo `xml` puede tener un tamaño de hasta 2 GB.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-119">These XML instances can be large, and the stored binary representation of `xml` data type instances can be up to 2 GB.</span></span> <span data-ttu-id="1f2a5-120">Sin ningún índice, estos objetos binarios grandes se dividen en tiempo de ejecución para evaluar una consulta.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-120">Without an index, these binary large objects are shredded at run time to evaluate a query.</span></span> <span data-ttu-id="1f2a5-121">Este proceso de división puede resultar lento.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-121">This shredding can be time-consuming.</span></span> <span data-ttu-id="1f2a5-122">Por ejemplo, considere la siguiente consulta:</span><span class="sxs-lookup"><span data-stu-id="1f2a5-122">For example, consider the following query:</span></span>  
  
```  
WITH XMLNAMESPACES ('https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ProductModelDescription' AS "PD")  
  
SELECT CatalogDescription.query('  
  /PD:ProductDescription/PD:Summary  
') as Result  
FROM Production.ProductModel  
WHERE CatalogDescription.exist ('/PD:ProductDescription/@ProductModelID[.="19"]') = 1  
```  
  
 <span data-ttu-id="1f2a5-123">Para seleccionar instancias XML que cumplan la condición de la cláusula `WHERE` , el objeto binario grande (BLOB) XML de cada fila de la tabla `Production.ProductModel` se divide en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-123">To select the XML instances that satisfy the condition in the `WHERE` clause, the XML binary large object (BLOB) in each row of table `Production.ProductModel` is shredded at run time.</span></span> <span data-ttu-id="1f2a5-124">A continuación, se evalúa la expresión `(/PD:ProductDescription/@ProductModelID[.="19"]`) en el método `exist()` .</span><span class="sxs-lookup"><span data-stu-id="1f2a5-124">Then, the expression `(/PD:ProductDescription/@ProductModelID[.="19"]`) in the `exist()` method is evaluated.</span></span> <span data-ttu-id="1f2a5-125">Esta división en tiempo de ejecución puede ser costosa, en función del tamaño y el número de instancias almacenadas en la columna.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-125">This run-time shredding can be costly, depending on the size and number of instances stored in the column.</span></span>  
  
 <span data-ttu-id="1f2a5-126">Si las consultas de objetos binarios grandes (BLOB) XML son frecuentes en su entorno de aplicación, será útil indizar las columnas de tipo `xml`.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-126">If querying XML binary large objects (BLOBs) is common in your application environment, it helps to index the `xml` type columns.</span></span> <span data-ttu-id="1f2a5-127">No obstante, el mantenimiento del índice durante la modificación de datos lleva un costo asociado.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-127">However, there is a cost associated with maintaining the index during data modification.</span></span>  
  
## <a name="primary-xml-index"></a><span data-ttu-id="1f2a5-128">Índice XML principal</span><span class="sxs-lookup"><span data-stu-id="1f2a5-128">Primary XML Index</span></span>  
 <span data-ttu-id="1f2a5-129">El índice XML principal incluye todas las etiquetas, los valores y las rutas de acceso de las instancias XML de una columna XML.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-129">The primary XML index indexes all tags, values, and paths within the XML instances in an XML column.</span></span> <span data-ttu-id="1f2a5-130">Para crear un índice XML principal, la tabla que contiene la columna XML, debe tener un índice clúster en la clave principal de la tabla.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-130">To create a primary XML index, the table in which the XML column occurs must have a clustered index on the primary key of the table.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="1f2a5-131">utiliza esta clave principal para correlacionar las filas del índice XML principal con las filas de la tabla que contiene la columna XML.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-131">uses this primary key to correlate rows in the primary XML index with rows in the table that contains the XML column.</span></span>  
  
 <span data-ttu-id="1f2a5-132">El índice XML principal es una representación dividida y persistente de los objetos binarios grandes (BLOB) XML de la columna de tipo de datos `xml`.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-132">The primary XML index is a shredded and persisted representation of the XML BLOBs in the `xml` data type column.</span></span> <span data-ttu-id="1f2a5-133">Para cada BLOB XML de la columna, el índice crea varias filas de datos.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-133">For each XML binary large object (BLOB) in the column, the index creates several rows of data.</span></span> <span data-ttu-id="1f2a5-134">El número de filas del índice es prácticamente igual al número de nodos del BLOB XML.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-134">The number of rows in the index is approximately equal to the number of nodes in the XML binary large object.</span></span> <span data-ttu-id="1f2a5-135">Cuando una consulta recupera la instancia XML completa, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] proporciona la instancia a partir de la columna XML.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-135">When a query retrieves the full XML instance, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] provides the instance from the XML column.</span></span> <span data-ttu-id="1f2a5-136">Las consultas dentro de instancias XML usan el índice XML principal y pueden devolver valores escalares o subárboles XML utilizando el propio índice.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-136">Queries within XML instances use the primary XML index, and can return scalar values or XML subtrees by using the index itself.</span></span>  
  
 <span data-ttu-id="1f2a5-137">Cada fila almacena la siguiente información acerca del nodo:</span><span class="sxs-lookup"><span data-stu-id="1f2a5-137">Each row stores the following node information:</span></span>  
  
-   <span data-ttu-id="1f2a5-138">Nombre de etiqueta (p. ej., un nombre de elemento o atributo).</span><span class="sxs-lookup"><span data-stu-id="1f2a5-138">Tag name such as an element or attribute name.</span></span>  
  
-   <span data-ttu-id="1f2a5-139">Valor del nodo.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-139">Node value.</span></span>  
  
-   <span data-ttu-id="1f2a5-140">Tipo de nodo (p. ej., un nodo de elemento, de atributo o de texto).</span><span class="sxs-lookup"><span data-stu-id="1f2a5-140">Node type such as an element node, attribute node, or text node.</span></span>  
  
-   <span data-ttu-id="1f2a5-141">Información del pedido de documento, representado mediante un identificador de nodo interno.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-141">Document order information, represented by an internal node identifier.</span></span>  
  
-   <span data-ttu-id="1f2a5-142">Ruta de acceso desde cada nodo a la raíz del árbol XML.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-142">Path from each node to the root of the XML tree.</span></span> <span data-ttu-id="1f2a5-143">La consulta busca expresiones de ruta en esta columna.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-143">This column is searched for path expressions in the query.</span></span>  
  
-   <span data-ttu-id="1f2a5-144">Clave principal de la tabla base.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-144">Primary key of the base table.</span></span> <span data-ttu-id="1f2a5-145">La clave principal de la tabla base está duplicada en el índice XML principal para mantener la combinación con la tabla base, y el número máximo de columnas en la clave principal de la tabla base se limita a 15.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-145">The primary key of the base table is duplicated in the primary XML index for a back join with the base table, and the maximum number of columns in the primary key of the base table is limited to 15.</span></span>  
  
 <span data-ttu-id="1f2a5-146">Esta información de nodo se utiliza para evaluar y crear resultados XML para una consulta específica.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-146">This node information is used to evaluate and construct XML results for a specified query.</span></span> <span data-ttu-id="1f2a5-147">Con fines de optimización, la información de nombre de etiqueta y tipo de nodo se codifica en forma de valores enteros; la columna Patch utiliza la misma codificación.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-147">For optimization purposes, the tag name and the node type information are encoded as integer values, and the Path column uses the same encoding.</span></span> <span data-ttu-id="1f2a5-148">Asimismo, las rutas de acceso se almacenan en orden inverso para permitir rutas de acceso coincidentes cuando solo se conoce el sufijo de la ruta de acceso.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-148">Also, paths are stored in reverse order to allow matching paths when only the path suffix is known.</span></span> <span data-ttu-id="1f2a5-149">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="1f2a5-149">For example:</span></span>  
  
-   <span data-ttu-id="1f2a5-150">`//ContactRecord/PhoneNumber` , donde solo se conocen los dos últimos pasos.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-150">`//ContactRecord/PhoneNumber` where only the last two steps are known</span></span>  
  
 <span data-ttu-id="1f2a5-151">O BIEN</span><span class="sxs-lookup"><span data-stu-id="1f2a5-151">OR</span></span>  
  
-   <span data-ttu-id="1f2a5-152">`/Book/*/Title` donde el carácter comodín (`*`) se especifica en mitad de la expresión.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-152">`/Book/*/Title` where the wildcard character (`*`) is specified in the middle of the expression.</span></span>  
  
 <span data-ttu-id="1f2a5-153">El procesador de consultas usa el índice XML principal para las consultas relacionadas con los [xml Data Type Methods](/sql/t-sql/xml/xml-data-type-methods) y devuelve valores escalares o los subárboles XML del propio índice principal.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-153">The query processor uses the primary XML index for queries that involve [xml Data Type Methods](/sql/t-sql/xml/xml-data-type-methods) and returns either scalar values or the XML subtrees from the primary index itself.</span></span> <span data-ttu-id="1f2a5-154">(Este índice almacena toda la información necesaria para volver a construir la instancia XML).</span><span class="sxs-lookup"><span data-stu-id="1f2a5-154">(This index stores all the necessary information to reconstruct the XML instance.)</span></span>  
  
 <span data-ttu-id="1f2a5-155">Por ejemplo, la siguiente consulta devuelve información de Resumen almacenada en la `CatalogDescription``xml` columna Type de la `ProductModel` tabla.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-155">For example, the following query returns summary information stored in the `CatalogDescription``xml` type column in the `ProductModel` table.</span></span> <span data-ttu-id="1f2a5-156">La consulta devuelve información perteneciente a <`Summary`> solo para modelos de producto cuya descripción de catálogo también almacena información sobre <`Features`>.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-156">The query returns <`Summary`> information only for product models whose catalog description also stores the <`Features`> description.</span></span>  
  
```  
WITH XMLNAMESPACES ('https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ProductModelDescription' AS "PD")SELECT CatalogDescription.query('  /PD:ProductDescription/PD:Summary') as ResultFROM Production.ProductModelWHERE CatalogDescription.exist ('/PD:ProductDescription/PD:Features') = 1  
```  
  
 <span data-ttu-id="1f2a5-157">En relación con el índice XML principal, en lugar de dividir cada instancia de BLOB XML en la tabla base, las filas del índice que corresponden a cada BLOB XML se examinan secuencialmente para determinar la expresión especificada en el método `exist()` .</span><span class="sxs-lookup"><span data-stu-id="1f2a5-157">With regard to the primary XML index, instead of shredding each XML binary large object instance in the base table, the rows in the index that correspond to each XML binary large object are searched sequentially for the expression specified in the `exist()` method.</span></span> <span data-ttu-id="1f2a5-158">Si la ruta de acceso se encuentra en la columna Path del índice, el elemento <`Summary`> y sus subárboles se recuperan a partir del índice XML principal y se convierten en un BLOB XML como resultado del método `query()`.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-158">If the path is found in the Path column in the index, the <`Summary`> element together with its subtrees is retrieved from the primary XML index and converted into an XML binary large object as the result of the `query()` method.</span></span>  
  
 <span data-ttu-id="1f2a5-159">Tenga en cuenta que el índice XML principal no se utiliza al recuperar una instancia XML completa.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-159">Note that the primary XML index is not used when retrieving a full XML instance.</span></span> <span data-ttu-id="1f2a5-160">Por ejemplo, la consulta siguiente recupera de la tabla la instancia XML completa que describe las instrucciones de fabricación para un modelo determinado de producto.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-160">For example, the following query retrieves from the table the whole XML instance that describes the manufacturing instructions for a specific product model.</span></span>  
  
```  
USE AdventureWorks2012;SELECT InstructionsFROM Production.ProductModel WHERE ProductModelID=7;  
```  
  
## <a name="secondary-xml-indexes"></a><span data-ttu-id="1f2a5-161">Índices XML secundarios</span><span class="sxs-lookup"><span data-stu-id="1f2a5-161">Secondary XML Indexes</span></span>  
 <span data-ttu-id="1f2a5-162">Para mejorar los resultados de las búsquedas, pueden crearse índices XML secundarios.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-162">To enhance search performance, you can create secondary XML indexes.</span></span> <span data-ttu-id="1f2a5-163">Antes de crear índices secundarios, debe existir un índice XML principal.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-163">A primary XML index must first exist before you can create secondary indexes.</span></span> <span data-ttu-id="1f2a5-164">A continuación, se indican los tipos existentes:</span><span class="sxs-lookup"><span data-stu-id="1f2a5-164">These are the types:</span></span>  
  
-   <span data-ttu-id="1f2a5-165">Índice XML secundario PATH</span><span class="sxs-lookup"><span data-stu-id="1f2a5-165">PATH secondary XML index</span></span>  
  
-   <span data-ttu-id="1f2a5-166">Índice XML secundario VALUE</span><span class="sxs-lookup"><span data-stu-id="1f2a5-166">VALUE secondary XML index</span></span>  
  
-   <span data-ttu-id="1f2a5-167">Índice XML secundario PROPERTY</span><span class="sxs-lookup"><span data-stu-id="1f2a5-167">PROPERTY secondary XML index</span></span>  
  
 <span data-ttu-id="1f2a5-168">A continuación se incluyen algunas directrices para crear uno o varios índices secundarios:</span><span class="sxs-lookup"><span data-stu-id="1f2a5-168">Following are some guidelines for creating one or more secondary indexes:</span></span>  
  
-   <span data-ttu-id="1f2a5-169">Si la carga de trabajo incluye numerosas expresiones de ruta de acceso en las columnas XML, es probable que el índice XML secundario PATH reduzca la carga de trabajo.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-169">If your workload uses path expressions significantly on XML columns, the PATH secondary XML index is likely to speed up your workload.</span></span> <span data-ttu-id="1f2a5-170">El caso más habitual es el uso del método **exist()** con columnas XML en la cláusula WHERE de Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-170">The most common case is the use of the **exist()** method on XML columns in the WHERE clause of Transact-SQL.</span></span>  
  
-   <span data-ttu-id="1f2a5-171">Si la carga de trabajo recupera varios valores a partir de instancias XML individuales empleando expresiones de ruta de acceso, puede resultar útil la agrupación en clústeres de las rutas dentro de cada instancia XML en el índice PROPERTY.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-171">If your workload retrieves multiple values from individual XML instances by using path expressions, clustering paths within each XML instance in the PROPERTY index may be helpful.</span></span> <span data-ttu-id="1f2a5-172">Éste suele ser el caso de una bolsa de propiedades, cuando se capturan las propiedades de un objeto y se conoce el valor de su clave principal.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-172">This scenario typically occurs in a property bag scenario when properties of an object are fetched and its primary key value is known.</span></span>  
  
-   <span data-ttu-id="1f2a5-173">Si la carga de trabajo implica consultar valores dentro de instancias XML sin conocer los nombres de los elementos o atributos que contienen dichos valores, puede ser útil crear el índice VALUE.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-173">If your workload involves querying for values within XML instances without knowing the element or attribute names that contain those values, you may want to create the VALUE index.</span></span> <span data-ttu-id="1f2a5-174">Esto suele ocurrir con búsquedas en ejes descendentes, como //author[last-name="Howard"], donde los elementos \<author> pueden aparecer en cualquier nivel de la jerarquía.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-174">This typically occurs with descendant axes lookups, such as //author[last-name="Howard"], where \<author> elements can occur at any level of the hierarchy.</span></span> <span data-ttu-id="1f2a5-175">También ocurre en consultas con caracteres comodín, como /book [@\* = "novel"], donde la consulta busca elementos \<book> que tengan algún atributo con el valor "novel".</span><span class="sxs-lookup"><span data-stu-id="1f2a5-175">It also occurs in wildcard queries, such as /book [@\* = "novel"], where the query looks for \<book> elements that have some attribute having the value "novel".</span></span>  
  
### <a name="path-secondary-xml-index"></a><span data-ttu-id="1f2a5-176">Índice XML secundario PATH</span><span class="sxs-lookup"><span data-stu-id="1f2a5-176">PATH Secondary XML Index</span></span>  
 <span data-ttu-id="1f2a5-177">Si sus consultas suelen especificar expresiones de ruta de acceso en columnas de tipo `xml`, un índice secundario PATH podría acelerar la búsqueda.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-177">If your queries generally specify path expressions on `xml` type columns, a PATH secondary index may be able to speed up the search.</span></span> <span data-ttu-id="1f2a5-178">Como se indicó anteriormente en este tema, el índice principal resulta útil cuando se realizan consultas que especifican el método **exist()** en la cláusula WHERE.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-178">As described earlier in this topic, the primary index is helpful when you have queries that specify **exist()** method in the WHERE clause.</span></span> <span data-ttu-id="1f2a5-179">Si agrega un índice secundario PATH, también puede mejorar los resultados de búsqueda en dichas consultas.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-179">If you add a PATH secondary index, you may also improve the search performance in such queries.</span></span>  
  
 <span data-ttu-id="1f2a5-180">Aunque un índice XML principal evita que el BLOB XML se tenga que dividir en tiempo de ejecución, es posible que no proporcione un rendimiento óptimo con consultas basadas en expresiones de ruta de acceso.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-180">Although a primary XML index avoids having to shred the XML binary large objects at run time, it may not provide the best performance for queries based on path expressions.</span></span> <span data-ttu-id="1f2a5-181">Dado que todas las filas del índice XML principal correspondientes a un BLOB XML se examinan secuencialmente para instancias XML de gran tamaño, la búsqueda secuencial puede ser lenta.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-181">Because all rows in the primary XML index corresponding to an XML binary large object are searched sequentially for large XML instances, the sequential search may be slow.</span></span> <span data-ttu-id="1f2a5-182">En este caso, incorporar un índice secundario a los valores de ruta de acceso y de nodo del índice principal puede aumentar significativamente la velocidad de búsqueda del índice.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-182">In this case, having a secondary index built on the path values and node values in the primary index can significantly speed up the index search.</span></span> <span data-ttu-id="1f2a5-183">En el índice secundario PATH, los valores de ruta de acceso y de nodo son columnas de clave que permiten operaciones más eficaces durante la búsqueda de rutas.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-183">In the PATH secondary index, the path and node values are key columns that allow for more efficient seeks when searching for paths.</span></span> <span data-ttu-id="1f2a5-184">El optimizador de consultas puede utilizar el índice PATH para expresiones como las siguientes:</span><span class="sxs-lookup"><span data-stu-id="1f2a5-184">The query optimizer may use the PATH index for expressions such as those shown in the following:</span></span>  
  
-   <span data-ttu-id="1f2a5-185">`/root/Location` , que solo especifica una ruta de acceso.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-185">`/root/Location` which specify only a path</span></span>  
  
 <span data-ttu-id="1f2a5-186">O BIEN</span><span class="sxs-lookup"><span data-stu-id="1f2a5-186">OR</span></span>  
  
-   <span data-ttu-id="1f2a5-187">`/root/Location/@LocationID[.="10"]` , donde se especifican los valores de ruta de acceso y de nodo.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-187">`/root/Location/@LocationID[.="10"]` where both the path and the node value are specified.</span></span>  
  
 <span data-ttu-id="1f2a5-188">La consulta siguiente muestra en qué lugar es útil el índice PATH:</span><span class="sxs-lookup"><span data-stu-id="1f2a5-188">The following query shows where the PATH index is helpful:</span></span>  
  
```  
WITH XMLNAMESPACES ('https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ProductModelDescription' AS "PD")  
  
SELECT CatalogDescription.query('  
  /PD:ProductDescription/PD:Summary  
') AS Result  
FROM Production.ProductModel  
WHERE CatalogDescription.exist ('/PD:ProductDescription/@ProductModelID[.="19"]') = 1  
```  
  
 <span data-ttu-id="1f2a5-189">En la consulta, la expresión de ruta de acceso `/PD:ProductDescription/@ProductModelID` y el valor `"19"` del método `exist()` corresponden a los campos clave del índice PATH.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-189">In the query, the path expression `/PD:ProductDescription/@ProductModelID` and value `"19"` in the `exist()` method correspond to the key fields of the PATH index.</span></span> <span data-ttu-id="1f2a5-190">Esto permite realizar búsquedas directas en el índice PATH y ofrece mejores resultados que la búsqueda secuencial de valores de ruta de acceso en el índice principal.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-190">This allows for direct seek in the PATH index and provides better search performance than the sequential search for path values in the primary index.</span></span>  
  
### <a name="value-secondary-xml-index"></a><span data-ttu-id="1f2a5-191">Índice XML secundario VALUE</span><span class="sxs-lookup"><span data-stu-id="1f2a5-191">VALUE Secondary XML Index</span></span>  
 <span data-ttu-id="1f2a5-192">Si las consultas se basan en valores, como, por ejemplo, `/Root/ProductDescription/@*[. = "Mountain Bike"]` o `//ProductDescription[@Name = "Mountain Bike"]`, y la ruta de acceso no se especifica completamente o incluye un carácter comodín, se pueden obtener resultados más rápidos creando un índice XML secundario que se agregue a los valores de nodo en el índice XML principal.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-192">If queries are value based, for example, `/Root/ProductDescription/@*[. = "Mountain Bike"]` or `//ProductDescription[@Name = "Mountain Bike"]`, and the path is not fully specified or it includes a wildcard, you might obtain faster results by building a secondary XML index that is built on node values in the primary XML index.</span></span>  
  
 <span data-ttu-id="1f2a5-193">Las columnas de clave del índice VALUE (valor de nodo y ruta de acceso) pertenecen al índice XML principal.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-193">The key columns of the VALUE index are (node value and path) of the primary XML index.</span></span> <span data-ttu-id="1f2a5-194">Si la carga de trabajo requiere consultar valores de instancias XML sin conocer los nombres de elemento o atributo que contienen los valores, un índice VALUE puede resultar útil.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-194">If your workload involves querying for values from XML instances without knowing the element or attribute names that contain the values, a VALUE index may be useful.</span></span> <span data-ttu-id="1f2a5-195">Por ejemplo, la siguiente expresión se beneficiará del índice VALUE:</span><span class="sxs-lookup"><span data-stu-id="1f2a5-195">For example, the following expression will benefit from having a VALUE index:</span></span>  
  
-   <span data-ttu-id="1f2a5-196">`//author[LastName="someName"]`, donde se conoce el valor del elemento <`LastName`>, pero el elemento primario <`author`> puede estar en cualquier lugar.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-196">`//author[LastName="someName"]` where you know the value of the <`LastName`> element, but the <`author`> parent can occur anywhere.</span></span>  
  
-   <span data-ttu-id="1f2a5-197">`/book[@* = "someValue"]`, donde la consulta busca el elemento <`book`> que contiene algún atributo con el valor `"someValue"`.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-197">`/book[@* = "someValue"]` where the query looks for the <`book`> element that has some attribute having the value `"someValue"`.</span></span>  
  
 <span data-ttu-id="1f2a5-198">La consulta siguiente devuelve `ContactID` de la tabla `Contact` .</span><span class="sxs-lookup"><span data-stu-id="1f2a5-198">The following query returns `ContactID` from the `Contact` table.</span></span> <span data-ttu-id="1f2a5-199">La `WHERE` cláusula especifica un filtro que busca valores en la `AdditionalContactInfo``xml` columna tipo.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-199">The `WHERE` clause specifies a filter that looks for values in the `AdditionalContactInfo``xml` type column.</span></span> <span data-ttu-id="1f2a5-200">Los Id. de contacto se devuelven solo si el BLOB XML de información adicional de contacto correspondiente incluye un número de teléfono específico.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-200">The contact IDs are returned only if the corresponding additional contact information XML binary large object includes a specific telephone number.</span></span> <span data-ttu-id="1f2a5-201">Dado que el elemento <`telephoneNumber`> puede aparecer en cualquier lugar del XML, la expresión de ruta de acceso especifica el eje descendant-or-self.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-201">Because the <`telephoneNumber`> element may appear anywhere in the XML, the path expression specifies the descendent-or-self axis.</span></span>  
  
```  
WITH XMLNAMESPACES (  
  'https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactInfo' AS CI,  
  'https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes' AS ACT)  
  
SELECT ContactID   
FROM   Person.Contact  
WHERE  AdditionalContactInfo.exist('//ACT:telephoneNumber/ACT:number[.="111-111-1111"]') = 1  
```  
  
 <span data-ttu-id="1f2a5-202">En esta situación, se conoce el valor de búsqueda para <`number`>, pero puede aparecer en cualquier lugar de la instancia XML como elemento secundario del elemento <`telephoneNumber`>.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-202">In this situation, the search value for <`number`> is known, but it can appear anywhere in the XML instance as a child of the <`telephoneNumber`> element.</span></span> <span data-ttu-id="1f2a5-203">Este tipo de consulta puede beneficiarse de una búsqueda de índice basada en un valor específico.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-203">This kind of query might benefit from an index lookup based on a specific value.</span></span>  
  
### <a name="property-secondary-index"></a><span data-ttu-id="1f2a5-204">Índice secundario PROPERTY</span><span class="sxs-lookup"><span data-stu-id="1f2a5-204">PROPERTY Secondary Index</span></span>  
 <span data-ttu-id="1f2a5-205">Las consultas que recuperan uno o varios valores de instancias XML individuales pueden beneficiarse del índice PROPERTY.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-205">Queries that retrieve one or more values from individual XML instances might benefit from a PROPERTY index.</span></span> <span data-ttu-id="1f2a5-206">Este escenario se produce cuando se recuperan propiedades de objeto mediante el método **Value ()** del `xml` tipo y cuando se conoce el valor de clave principal del objeto.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-206">This scenario occurs when you retrieve object properties by using the **value()** method of the `xml` type and when the primary key value of the object is known.</span></span>  
  
 <span data-ttu-id="1f2a5-207">El índice PROPERTY se agrega a columnas (PK, Path y valor de nodo) del índice XML principal, donde PK es la clave principal de la tabla base.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-207">The PROPERTY index is built on columns (PK, Path and node value) of the primary XML index where PK is the primary key of the base table.</span></span>  
  
 <span data-ttu-id="1f2a5-208">Por ejemplo, para el modelo de producto `19`, la consulta siguiente recupera los valores de los atributos `ProductModelID` y `ProductModelName` mediante el método `value()` .</span><span class="sxs-lookup"><span data-stu-id="1f2a5-208">For example, for product model `19`, the following query retrieves the `ProductModelID` and `ProductModelName` attribute values using the `value()` method.</span></span> <span data-ttu-id="1f2a5-209">En lugar de utilizar el índice XML principal o los otros índices XML secundarios, el índice PROPERTY puede ofrecer una ejecución más rápida.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-209">Instead of using the primary XML index or the other secondary XML indexes, the PROPERTY index may provide faster execution.</span></span>  
  
```  
WITH XMLNAMESPACES ('https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ProductModelDescription' AS "PD")  
  
SELECT CatalogDescription.value('(/PD:ProductDescription/@ProductModelID)[1]', 'int') as ModelID,  
       CatalogDescription.value('(/PD:ProductDescription/@ProductModelName)[1]', 'varchar(30)') as ModelName          
FROM Production.ProductModel     
WHERE ProductModelID = 19  
```  
  
 <span data-ttu-id="1f2a5-210">Salvo por las diferencias descritas más adelante en este tema, crear un índice XML en una `xml` columna de tipo es similar a crear un índice en una columna que no sea de `xml` tipo.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-210">Except for the differences described later in this topic, creating an XML index on an`xml` type column is similar to creating an index on a non-`xml` type column.</span></span> <span data-ttu-id="1f2a5-211">Las siguientes instrucciones DDL [!INCLUDE[tsql](../../includes/tsql-md.md)] pueden usarse para crear y administrar índices XML:</span><span class="sxs-lookup"><span data-stu-id="1f2a5-211">The following [!INCLUDE[tsql](../../includes/tsql-md.md)] DDL statements can be used to create and manage XML indexes:</span></span>  
  
-   [<span data-ttu-id="1f2a5-212">CREATE INDEX &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="1f2a5-212">CREATE INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-index-transact-sql)  
  
-   [<span data-ttu-id="1f2a5-213">ALTER INDEX &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="1f2a5-213">ALTER INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-index-transact-sql)  
  
-   [<span data-ttu-id="1f2a5-214">DROP INDEX &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="1f2a5-214">DROP INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/drop-index-transact-sql)  
  
## <a name="getting-information-about-xml-indexes"></a><span data-ttu-id="1f2a5-215">Obtener información acerca de los índices XML</span><span class="sxs-lookup"><span data-stu-id="1f2a5-215">Getting Information about XML Indexes</span></span>  
 <span data-ttu-id="1f2a5-216">Las entradas del índice XML aparecen en la vista de catálogo, sys.indexes, con el "tipo" de índice 3.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-216">XML index entries appear in the catalog view, sys.indexes, with the index "type" 3.</span></span> <span data-ttu-id="1f2a5-217">La columna del nombre contiene el nombre del índice XML.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-217">The name column contains the name of the XML index.</span></span>  
  
 <span data-ttu-id="1f2a5-218">Los índices XML también se registran en la vista de catálogo sys.xml_indexes.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-218">XML indexes are also recorded in the catalog view, sys.xml_indexes.</span></span> <span data-ttu-id="1f2a5-219">Ésta contiene todas las columnas de sys.indexes y algunas específicas que son útiles para índices XML.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-219">This contains all the columns of sys.indexes and some specific ones that are useful for XML indexes.</span></span> <span data-ttu-id="1f2a5-220">El valor NULL de la columna secondary_type indica un índice XML principal; los valores "P", "R" y "V" representan los índices XML secundarios PATH, PROPERTY y VALUE, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-220">The value NULL in the column, secondary_type, indicates a primary XML index; the values 'P', 'R' and 'V' stand for PATH, PROPERTY, and VALUE secondary XML indexes, respectively.</span></span>  
  
 <span data-ttu-id="1f2a5-221">Es posible encontrar el uso de espacio de los índices XML en la función con valores de tabla [sys.dm_db_index_physical_stats](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-index-physical-stats-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="1f2a5-221">The space use of XML indexes can be found in the table-valued function [sys.dm_db_index_physical_stats](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-index-physical-stats-transact-sql).</span></span> <span data-ttu-id="1f2a5-222">Contiene información como el número de páginas de disco ocupadas, el tamaño medio de las filas en bytes y el número de registros de todos los tipos de índice.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-222">It provides information, such as the number of disk pages occupied, average row size in bytes, and number of records, for all index types..</span></span> <span data-ttu-id="1f2a5-223">Se refiere también a los índices XML.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-223">This also includes XML indexes.</span></span> <span data-ttu-id="1f2a5-224">Esta información está disponible para cada partición de base de datos.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-224">This information is available for each database partition.</span></span> <span data-ttu-id="1f2a5-225">Los índices XML usan el mismo esquema de partición y la misma función de partición que la tabla base.</span><span class="sxs-lookup"><span data-stu-id="1f2a5-225">XML indexes use the same partitioning scheme and partitioning function of the base table.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="1f2a5-226">Consulte también</span><span class="sxs-lookup"><span data-stu-id="1f2a5-226">See Also</span></span>  
 <span data-ttu-id="1f2a5-227">[sys.dm_db_index_physical_stats &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-index-physical-stats-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="1f2a5-227">[sys.dm_db_index_physical_stats &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-index-physical-stats-transact-sql) </span></span>  
 [<span data-ttu-id="1f2a5-228">Datos XML &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="1f2a5-228">XML Data &#40;SQL Server&#41;</span></span>](../xml/xml-data-sql-server.md)  
  
  
