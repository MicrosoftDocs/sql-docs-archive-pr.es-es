---
title: Registrando tipos definidos por el usuario en SQL Server | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: clr
ms.topic: reference
dev_langs:
- TSQL
helpviewer_keywords:
- UDTs [CLR integration], maintaining
- user-defined types [CLR integration], maintaining
- dependencies [CLR integration]
- deploying user-defined types [CLR integration]
- CurrencyConversion function
- user-defined types [CLR integration], deploying
- Transact-SQL deploying UDTs
- assemblies [CLR integration], user-defined types
- cross-database UDT support
- CREATE ASSEMBLY statement
- DROP TYPE statement
- Currency UDT
- CREATE TYPE statement
- registering user-defined types
- UDTs [CLR integration], deploying
- removing user-defined types
- user-defined types [CLR integration], registering
- ALTER ASSEMBLY statement
- UDTs [CLR integration], registering
- ADD FILE clause
ms.assetid: f7da3e92-e407-4f0b-b3a3-f214e442b37d
author: rothja
ms.author: jroth
ms.openlocfilehash: 7d24f7948e093335eff708f3c4a8a7361cfc156f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87669707"
---
# <a name="registering-user-defined-types-in-sql-server"></a><span data-ttu-id="6b21e-102">Registrar tipos definidos por el usuario en SQL Server</span><span class="sxs-lookup"><span data-stu-id="6b21e-102">Registering User-Defined Types in SQL Server</span></span>
  <span data-ttu-id="6b21e-103">Para poder usar un tipo definido por el usuario (UDT) en [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , debe registrarlo.</span><span class="sxs-lookup"><span data-stu-id="6b21e-103">In order to use a user-defined type (UDT) in [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], you must register it.</span></span> <span data-ttu-id="6b21e-104">El registro de un UDT implica el registro del ensamblado y la creación del tipo en la base de datos en la que desea usarlo.</span><span class="sxs-lookup"><span data-stu-id="6b21e-104">Registering a UDT involves registering the assembly and creating the type in the database in which you wish to use it.</span></span> <span data-ttu-id="6b21e-105">El ámbito de los UDT es una sola base de datos, por lo que no pueden usarse en varias bases de datos a menos que se registren un ensamblado y UDT idénticos en cada base de datos.</span><span class="sxs-lookup"><span data-stu-id="6b21e-105">UDTs are scoped to a single database, and cannot be used in multiple databases unless the identical assembly and UDT are registered with each database.</span></span> <span data-ttu-id="6b21e-106">Una vez que haya registrado el ensamblado UDT y que haya creado el tipo, podrá usar el UDT en [!INCLUDE[tsql](../../includes/tsql-md.md)] y en el código del cliente.</span><span class="sxs-lookup"><span data-stu-id="6b21e-106">Once the UDT assembly is registered and the type created, you can use the UDT in [!INCLUDE[tsql](../../includes/tsql-md.md)] and in client code.</span></span> <span data-ttu-id="6b21e-107">Para obtener más información, vea [Tipos definidos por el usuario de CLR](clr-user-defined-types.md).</span><span class="sxs-lookup"><span data-stu-id="6b21e-107">For more information, see [CLR User-Defined Types](clr-user-defined-types.md).</span></span>  
  
## <a name="using-visual-studio-to-deploy-udts"></a><span data-ttu-id="6b21e-108">Usar Visual Studio para implementar tipos UDT</span><span class="sxs-lookup"><span data-stu-id="6b21e-108">Using Visual Studio to Deploy UDTs</span></span>  
 <span data-ttu-id="6b21e-109">La forma más fácil de implementar un UDT consiste en usar [!INCLUDE[msCoName](../../includes/msconame-md.md)] Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="6b21e-109">The easiest way to deploy your UDT is by using [!INCLUDE[msCoName](../../includes/msconame-md.md)] Visual Studio.</span></span> <span data-ttu-id="6b21e-110">Sin embargo, en escenarios de implementación más complejos y para obtener la máxima flexibilidad, es preferible que use [!INCLUDE[tsql](../../includes/tsql-md.md)] tal y como se describe más adelante en este tema.</span><span class="sxs-lookup"><span data-stu-id="6b21e-110">For more complex deployment scenarios and the greatest flexibility, however, use [!INCLUDE[tsql](../../includes/tsql-md.md)] as discussed later in this topic.</span></span>  
  
 <span data-ttu-id="6b21e-111">Siga estos pasos para crear e implementar un UDT mediante Visual Studio:</span><span class="sxs-lookup"><span data-stu-id="6b21e-111">Follow these steps to create and deploy a UDT using Visual Studio:</span></span>  
  
1.  <span data-ttu-id="6b21e-112">Cree un nuevo proyecto de **base de datos** en los nodos del lenguaje **Visual Basic** o **Visual C#** .</span><span class="sxs-lookup"><span data-stu-id="6b21e-112">Create a new **Database** project in the **Visual Basic** or **Visual C#** language nodes.</span></span>  
  
2.  <span data-ttu-id="6b21e-113">Agregue una referencia a la base de datos de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] que contenga el UDT.</span><span class="sxs-lookup"><span data-stu-id="6b21e-113">Add a reference to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database that will contain the UDT.</span></span>  
  
3.  <span data-ttu-id="6b21e-114">Agregue una clase de **tipo definido por el usuario** .</span><span class="sxs-lookup"><span data-stu-id="6b21e-114">Add a **User-Defined Type** class.</span></span>  
  
4.  <span data-ttu-id="6b21e-115">Escriba código para implementar el UDT.</span><span class="sxs-lookup"><span data-stu-id="6b21e-115">Write code to implement the UDT.</span></span>  
  
5.  <span data-ttu-id="6b21e-116">En el menú **compilar** , seleccione **implementar**.</span><span class="sxs-lookup"><span data-stu-id="6b21e-116">From the **Build** menu, select **Deploy**.</span></span> <span data-ttu-id="6b21e-117">De este modo, se registrará el ensamblado y se creará el tipo en la base de datos de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="6b21e-117">This registers the assembly and creates the type in the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database.</span></span>  
  
## <a name="using-transact-sql-to-deploy-udts"></a><span data-ttu-id="6b21e-118">Usar Transact-SQL para implementar tipos UDT</span><span class="sxs-lookup"><span data-stu-id="6b21e-118">Using Transact-SQL to Deploy UDTs</span></span>  
 <span data-ttu-id="6b21e-119">La sintaxis de la instrucción CREATE ASSEMBLY de [!INCLUDE[tsql](../../includes/tsql-md.md)] se usa para registrar el ensamblado en la base de datos en la que se desea usar el UDT.</span><span class="sxs-lookup"><span data-stu-id="6b21e-119">The [!INCLUDE[tsql](../../includes/tsql-md.md)] CREATE ASSEMBLY syntax is used to register the assembly in the database in which you wish to use the UDT.</span></span> <span data-ttu-id="6b21e-120">Se almacena internamente en las tablas del sistema de la base de datos, no externamente en el sistema de archivos.</span><span class="sxs-lookup"><span data-stu-id="6b21e-120">It is stored internally in database system tables, not externally in the file system.</span></span> <span data-ttu-id="6b21e-121">Si el UDT depende de ensamblados externos, éstos también deben cargarse en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="6b21e-121">If the UDT is dependent on external assemblies, they too must be loaded into the database.</span></span> <span data-ttu-id="6b21e-122">La instrucción CREATE TYPE se usa para crear el UDT en la base de datos en la que va a utilizarse.</span><span class="sxs-lookup"><span data-stu-id="6b21e-122">The CREATE TYPE statement is used to create the UDT in the database in which it is to be used.</span></span> <span data-ttu-id="6b21e-123">Para obtener más información, vea [Create assembly &#40;Transact-sql&#41;](/sql/t-sql/statements/create-assembly-transact-sql) y [Create Type &#40;transact-SQL&#41;](/sql/t-sql/statements/create-type-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="6b21e-123">For more information, see [CREATE ASSEMBLY &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-assembly-transact-sql) and [CREATE TYPE &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-type-transact-sql).</span></span>  
  
### <a name="using-create-assembly"></a><span data-ttu-id="6b21e-124">Usar CREATE ASSEMBLY</span><span class="sxs-lookup"><span data-stu-id="6b21e-124">Using CREATE ASSEMBLY</span></span>  
 <span data-ttu-id="6b21e-125">La sintaxis de la instrucción CREATE ASSEMBLY registra el ensamblado en la base de datos en la que se desea usar el UDT.</span><span class="sxs-lookup"><span data-stu-id="6b21e-125">The CREATE ASSEMBLY syntax registers the assembly in the database in which you wish to use the UDT.</span></span> <span data-ttu-id="6b21e-126">Cuando se registra el ensamblado, no tiene ninguna dependencia.</span><span class="sxs-lookup"><span data-stu-id="6b21e-126">Once the assembly is registered, it has no dependencies.</span></span>  
  
 <span data-ttu-id="6b21e-127">No está permitido crear varias versiones del mismo ensamblado en una base de datos determinada.</span><span class="sxs-lookup"><span data-stu-id="6b21e-127">Creating multiple versions of the same assembly in a given database is not allowed.</span></span> <span data-ttu-id="6b21e-128">Sin embargo, es posible crear varias versiones del mismo ensamblado basadas en la referencia cultural en una base de datos determinada.</span><span class="sxs-lookup"><span data-stu-id="6b21e-128">However, it is possible to create multiple versions of the same assembly based on culture in a given database.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="6b21e-129">distingue varias versiones de referencia cultural de un ensamblado mediante los distintos nombres registrados en la instancia de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="6b21e-129">distinguishes multiple culture versions of an assembly by different names as registered in the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="6b21e-130">Para obtener más información, vea el tema sobre la forma de crear y utilizar ensamblados con nombres seguros en .NET Framework SDK.</span><span class="sxs-lookup"><span data-stu-id="6b21e-130">For more information, see "Creating and Using Strong-Named Assemblies" in the .NET Framework SDK.</span></span>  
  
 <span data-ttu-id="6b21e-131">Al ejecutar CREATE ASSEMBLY con los conjuntos de permisos SAFE o EXTERNAL_ACCESS, se comprueba el ensamblado para garantizar que sea comprobable y presente seguridad de tipos.</span><span class="sxs-lookup"><span data-stu-id="6b21e-131">When CREATE ASSEMBLY is executed with the SAFE or EXTERNAL_ACCESS permission sets, the assembly is checked to make sure that it is verifiable and type safe.</span></span> <span data-ttu-id="6b21e-132">Si no se especifica ningún conjunto de permisos, se usa el conjunto de permisos SAFE.</span><span class="sxs-lookup"><span data-stu-id="6b21e-132">If you omit specifying a permission set, SAFE is assumed.</span></span> <span data-ttu-id="6b21e-133">El código con el conjunto de permisos UNSAFE no se comprueba.</span><span class="sxs-lookup"><span data-stu-id="6b21e-133">Code with the UNSAFE permission set is not checked.</span></span> <span data-ttu-id="6b21e-134">Para obtener más información sobre los conjuntos de permisos de ensamblado, vea [Diseño de ensamblados](../../relational-databases/clr-integration/assemblies-designing.md).</span><span class="sxs-lookup"><span data-stu-id="6b21e-134">For more information about assembly permission sets, see [Designing Assemblies](../../relational-databases/clr-integration/assemblies-designing.md).</span></span>  
  
#### <a name="example"></a><span data-ttu-id="6b21e-135">Ejemplo</span><span class="sxs-lookup"><span data-stu-id="6b21e-135">Example</span></span>  
 <span data-ttu-id="6b21e-136">La [!INCLUDE[tsql](../../includes/tsql-md.md)] instrucción siguiente registra el ensamblado de punto en [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] en la base de datos **AdventureWorks** , con el conjunto de permisos Safe.</span><span class="sxs-lookup"><span data-stu-id="6b21e-136">The following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement registers the Point assembly in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] in the **AdventureWorks** database, with the SAFE permission set.</span></span> <span data-ttu-id="6b21e-137">Si se omite la cláusula PERMISSION_SET, el ensamblado se registra con el conjunto de permisos SAFE.</span><span class="sxs-lookup"><span data-stu-id="6b21e-137">If the WITH PERMISSION_SET clause is omitted, the assembly is registered with the SAFE permission set.</span></span>  
  
```  
USE AdventureWorks;  
CREATE ASSEMBLY Point  
FROM '\\ShareName\Projects\Point\bin\Point.dll'   
WITH PERMISSION_SET = SAFE;  
```  
  
 <span data-ttu-id="6b21e-138">La [!INCLUDE[tsql](../../includes/tsql-md.md)] instrucción siguiente registra el ensamblado mediante *<assembly_bits argumento>* en la cláusula FROM.</span><span class="sxs-lookup"><span data-stu-id="6b21e-138">The following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement registers the assembly using *<assembly_bits>* argument in the FROM clause.</span></span> <span data-ttu-id="6b21e-139">Este valor `varbinary` representa el archivo como un flujo de bytes.</span><span class="sxs-lookup"><span data-stu-id="6b21e-139">This `varbinary` value represents the file as a stream of bytes.</span></span>  
  
```  
USE AdventureWorks;  
CREATE ASSEMBLY Point  
FROM 0xfeac4 ... 21ac78  
```  
  
### <a name="using-create-type"></a><span data-ttu-id="6b21e-140">Usar CREATE TYPE</span><span class="sxs-lookup"><span data-stu-id="6b21e-140">Using CREATE TYPE</span></span>  
 <span data-ttu-id="6b21e-141">Una vez que haya cargado el ensamblado en la base de datos, podrá crear el tipo mediante la instrucción CREATE TYPE de [!INCLUDE[tsql](../../includes/tsql-md.md)].</span><span class="sxs-lookup"><span data-stu-id="6b21e-141">Once the assembly is loaded into the database, you can then create the type using the [!INCLUDE[tsql](../../includes/tsql-md.md)] CREATE TYPE statement.</span></span> <span data-ttu-id="6b21e-142">De esta forma, el tipo se agregará a la lista de tipos disponibles para esa base de datos.</span><span class="sxs-lookup"><span data-stu-id="6b21e-142">This adds the type to the list of available types for that database.</span></span> <span data-ttu-id="6b21e-143">El tipo tiene como ámbito la base de datos y solamente puede usarse en la base de datos en la que se creó.</span><span class="sxs-lookup"><span data-stu-id="6b21e-143">The type has database scope and the type can only be used in the database in which it was created.</span></span> <span data-ttu-id="6b21e-144">Si el UDT ya existe en la base de datos, la instrucción CREATE TYPE generará un error.</span><span class="sxs-lookup"><span data-stu-id="6b21e-144">If the UDT already exists in the database, the CREATE TYPE statement fails with an error.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6b21e-145">La sintaxis de la instrucción CREATE TYPE también se usa para crear tipos de datos de alias nativos de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] y sirve para reemplazar `sp_addtype` como un medio de creación de tipos de datos de alias.</span><span class="sxs-lookup"><span data-stu-id="6b21e-145">The CREATE TYPE syntax is also used for creating native [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] alias data types, and is intended to replace `sp_addtype` as a means of creating alias data types.</span></span> <span data-ttu-id="6b21e-146">Algunos de los argumentos opcionales de la sintaxis de CREATE TYPE hacen referencia a la creación de UDTs y no sirven para crear tipos de datos de alias (como el tipo base).</span><span class="sxs-lookup"><span data-stu-id="6b21e-146">Some of the optional arguments in the CREATE TYPE syntax refer to creating UDTs, and are not applicable to creating alias data types (such as base type).</span></span>  
  
 <span data-ttu-id="6b21e-147">Para obtener más información, vea [Create TYPE &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-type-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="6b21e-147">For more information, see [CREATE TYPE &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-type-transact-sql).</span></span>  
  
#### <a name="example"></a><span data-ttu-id="6b21e-148">Ejemplo</span><span class="sxs-lookup"><span data-stu-id="6b21e-148">Example</span></span>  
 <span data-ttu-id="6b21e-149">La siguiente instrucción [!INCLUDE[tsql](../../includes/tsql-md.md)] crea el tipo `Point`.</span><span class="sxs-lookup"><span data-stu-id="6b21e-149">The following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement creates the `Point` type.</span></span> <span data-ttu-id="6b21e-150">El nombre externo se especifica mediante la sintaxis de nomenclatura de dos partes de *AssemblyName*. *Nombreudt*.</span><span class="sxs-lookup"><span data-stu-id="6b21e-150">The EXTERNAL NAME is specified using the two-part naming syntax of *AssemblyName*.*UDTName*.</span></span>  
  
```  
CREATE TYPE dbo.Point   
EXTERNAL NAME Point.[Point];  
```  
  
## <a name="removing-a-udt-from-the-database"></a><span data-ttu-id="6b21e-151">Quitar un UDT de la base de datos</span><span class="sxs-lookup"><span data-stu-id="6b21e-151">Removing a UDT from the Database</span></span>  
 <span data-ttu-id="6b21e-152">La instrucción DROP TYPE quita un UDT de la base de datos actual.</span><span class="sxs-lookup"><span data-stu-id="6b21e-152">The DROP TYPE statement removes a UDT from the current database.</span></span> <span data-ttu-id="6b21e-153">Una vez quitado un UDT, puede utilizar la instrucción DROP ASSEMBLY para quitar el ensamblado de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="6b21e-153">Once a UDT is dropped, you can use the DROP ASSEMBLY statement to drop the assembly from the database.</span></span>  
  
 <span data-ttu-id="6b21e-154">La instrucción DROP TYPE no se ejecuta en las situaciones siguientes:</span><span class="sxs-lookup"><span data-stu-id="6b21e-154">The DROP TYPE statement does not execute in the following situations:</span></span>  
  
-   <span data-ttu-id="6b21e-155">Tablas de la base de datos que contienen columnas definidas mediante el UDT.</span><span class="sxs-lookup"><span data-stu-id="6b21e-155">Tables in the database that contain columns defined using the UDT.</span></span>  
  
-   <span data-ttu-id="6b21e-156">Funciones, procedimientos almacenados o desencadenadores que usan variables o parámetros del UDT creados en la base de datos con la cláusula WITH SCHEMABINDING.</span><span class="sxs-lookup"><span data-stu-id="6b21e-156">Functions, stored procedures, or triggers that use variables or parameters of the UDT, created in the database with the WITH SCHEMABINDING clause.</span></span>  
  
### <a name="example"></a><span data-ttu-id="6b21e-157">Ejemplo</span><span class="sxs-lookup"><span data-stu-id="6b21e-157">Example</span></span>  
 <span data-ttu-id="6b21e-158">La siguiente consulta [!INCLUDE[tsql](../../includes/tsql-md.md)] debe ejecutarse en el orden que se indica.</span><span class="sxs-lookup"><span data-stu-id="6b21e-158">The following [!INCLUDE[tsql](../../includes/tsql-md.md)] must execute in the following order.</span></span> <span data-ttu-id="6b21e-159">En primer lugar, debe quitarse la tabla que hace referencia al UDT `Point`, después, el tipo y, por último, el ensamblado.</span><span class="sxs-lookup"><span data-stu-id="6b21e-159">First the table which references the `Point` UDT must be dropped, then the type, and finally the assembly.</span></span>  
  
```  
DROP TABLE dbo.Points;  
DROP TYPE dbo.Point;  
DROP ASSEMBLY Point;  
```  
  
### <a name="finding-udt-dependencies"></a><span data-ttu-id="6b21e-160">Buscar dependencias UDT</span><span class="sxs-lookup"><span data-stu-id="6b21e-160">Finding UDT Dependencies</span></span>  
 <span data-ttu-id="6b21e-161">Si hay objetos dependientes, como tablas con definiciones de columna UDT, se produce un error en la instrucción DROP TYPE.</span><span class="sxs-lookup"><span data-stu-id="6b21e-161">If there are dependent objects, such as tables with UDT column definitions, the DROP TYPE statement fails.</span></span> <span data-ttu-id="6b21e-162">También produce un error si hay funciones, procedimientos almacenados o desencadenadores creados en la base de datos con la cláusula WITH SCHEMABINDING, cuando estas rutinas utilizan variables o parámetros del tipo definido por el usuario.</span><span class="sxs-lookup"><span data-stu-id="6b21e-162">It also fails if there are functions, stored procedures, or triggers created in the database using the WITH SCHEMABINDING clause, if these routines use variables or parameters of the user-defined type.</span></span> <span data-ttu-id="6b21e-163">Debe quitar primero todos los objetos dependientes y, a continuación, ejecutar la instrucción DROP TYPE.</span><span class="sxs-lookup"><span data-stu-id="6b21e-163">You must first drop all dependent objects, and then execute the DROP TYPE statement.</span></span>  
  
 <span data-ttu-id="6b21e-164">La siguiente [!INCLUDE[tsql](../../includes/tsql-md.md)] consulta busca todas las columnas y parámetros que usan un UDT en la base de datos **AdventureWorks** .</span><span class="sxs-lookup"><span data-stu-id="6b21e-164">The following [!INCLUDE[tsql](../../includes/tsql-md.md)] query locates all of the columns and parameters that use a UDT in the **AdventureWorks** database.</span></span>  
  
```  
USE Adventureworks;  
SELECT o.name AS major_name, o.type_desc AS major_type_desc  
     , c.name AS minor_name, c.type_desc AS minor_type_desc  
     , at.assembly_class  
  FROM (  
        SELECT object_id, name, user_type_id, 'SQL_COLUMN' AS type_desc  
          FROM sys.columns  
     UNION ALL  
        SELECT object_id, name, user_type_id, 'SQL_PROCEDURE_PARAMETER'  
          FROM sys.parameters  
     ) AS c  
  JOIN sys.objects AS o  
    ON o.object_id = c.object_id  
  JOIN sys.assembly_types AS at  
    ON at.user_type_id = c.user_type_id;  
```  
  
## <a name="maintaining-udts"></a><span data-ttu-id="6b21e-165">Mantener los UDT</span><span class="sxs-lookup"><span data-stu-id="6b21e-165">Maintaining UDTs</span></span>  
 <span data-ttu-id="6b21e-166">No es posible modificar un UDT una vez creado en una base de datos de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], pero puede modificar el ensamblado en el que se basa el tipo.</span><span class="sxs-lookup"><span data-stu-id="6b21e-166">You cannot modify a UDT once it is created in a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database, although you can alter the assembly on which the type is based.</span></span> <span data-ttu-id="6b21e-167">En la mayoría de los casos, tendrá que quitar el UDT de la base de datos con la instrucción DROP TYPE de [!INCLUDE[tsql](../../includes/tsql-md.md)], efectuar cambios en el ensamblado subyacente y volver a cargarlo mediante la instrucción ALTER ASSEMBLY.</span><span class="sxs-lookup"><span data-stu-id="6b21e-167">In most cases, you must remove the UDT from the database with the [!INCLUDE[tsql](../../includes/tsql-md.md)] DROP TYPE statement, make changes to the underlying assembly, and reload it using the ALTER ASSEMBLY statement.</span></span> <span data-ttu-id="6b21e-168">A continuación, tendrá que volver a crear el UDT y todos los objetos dependientes.</span><span class="sxs-lookup"><span data-stu-id="6b21e-168">You then need to re-create the UDT and any dependent objects.</span></span>  
  
### <a name="example"></a><span data-ttu-id="6b21e-169">Ejemplo</span><span class="sxs-lookup"><span data-stu-id="6b21e-169">Example</span></span>  
 <span data-ttu-id="6b21e-170">La instrucción ALTER ASSEMBLY se usa después de haber realizado cambios en el código fuente del ensamblado UDT y después de haberlo compilado de nuevo.</span><span class="sxs-lookup"><span data-stu-id="6b21e-170">The ALTER ASSEMBLY statement is used after you have made changes to the source code in your UDT assembly and recompiled it.</span></span> <span data-ttu-id="6b21e-171">Esta instrucción copia el archivo .dll en el servidor y lo enlaza al nuevo ensamblado.</span><span class="sxs-lookup"><span data-stu-id="6b21e-171">It copies the .dll file to the server and rebinds to the new assembly.</span></span> <span data-ttu-id="6b21e-172">Para obtener la sintaxis completa, vea [ALTER assembly &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-assembly-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="6b21e-172">For the complete syntax, see [ALTER ASSEMBLY &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-assembly-transact-sql).</span></span>  
  
 <span data-ttu-id="6b21e-173">La siguiente instrucción ALTER ASSEMBLY de [!INCLUDE[tsql](../../includes/tsql-md.md)] vuelve a cargar el ensamblado Point.dll desde la ubicación del disco especificada.</span><span class="sxs-lookup"><span data-stu-id="6b21e-173">The following [!INCLUDE[tsql](../../includes/tsql-md.md)] ALTER ASSEMBLY statement reloads the Point.dll assembly from the specified location on disk.</span></span>  
  
```  
ALTER ASSEMBLY Point  
FROM '\\Projects\Point\bin\Point.dll'  
```  
  
### <a name="using-alter-assembly-to-add-source-code"></a><span data-ttu-id="6b21e-174">Usar ALTER ASSEMBLY para agregar código fuente</span><span class="sxs-lookup"><span data-stu-id="6b21e-174">Using ALTER ASSEMBLY to Add Source Code</span></span>  
 <span data-ttu-id="6b21e-175">La cláusula ADD FILE de la sintaxis ALTER ASSEMBLY no está presente en CREATE ASSEMBLY.</span><span class="sxs-lookup"><span data-stu-id="6b21e-175">The ADD FILE clause in the ALTER ASSEMBLY syntax is not present in CREATE ASSEMBLY.</span></span> <span data-ttu-id="6b21e-176">Puede usarla para agregar código fuente o cualquier otro archivo asociado a un ensamblado.</span><span class="sxs-lookup"><span data-stu-id="6b21e-176">You can use it to add source code or any other files associated with an assembly.</span></span> <span data-ttu-id="6b21e-177">Los archivos se copian desde sus ubicaciones originales y se almacenan en tablas del sistema en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="6b21e-177">The files are copied from their original locations and stored in system tables in the database.</span></span> <span data-ttu-id="6b21e-178">De esta forma, se garantiza que el código fuente u otros archivos estén disponibles siempre que sea necesario volver a crear o documentar la versión actual del UDT.</span><span class="sxs-lookup"><span data-stu-id="6b21e-178">This ensures that you always have source code or other files on hand should you ever need to re-create or document the current version of the UDT.</span></span>  
  
 <span data-ttu-id="6b21e-179">La siguiente [!INCLUDE[tsql](../../includes/tsql-md.md)] instrucción ALTER ASSEMBLY agrega el código fuente de la clase Point.CS para el `Point` UDT.</span><span class="sxs-lookup"><span data-stu-id="6b21e-179">The following [!INCLUDE[tsql](../../includes/tsql-md.md)] ALTER ASSEMBLY statement adds the Point.cs class source code for the `Point` UDT.</span></span> <span data-ttu-id="6b21e-180">De esta forma, el texto incluido en el archivo Point.cs se copia y se almacena en la base de datos con el nombre "PointSource".</span><span class="sxs-lookup"><span data-stu-id="6b21e-180">This copies the text contained in the Point.cs file and stores it in the database under the name "PointSource".</span></span>  
  
```  
ALTER ASSEMBLY Point  
ADD FILE FROM '\\Projects\Point\Point.cs' AS PointSource;  
```  
  
 <span data-ttu-id="6b21e-181">La información de ensamblado se almacena en la tabla **Sys. assembly_files** en la base de datos donde se ha instalado el ensamblado.</span><span class="sxs-lookup"><span data-stu-id="6b21e-181">Assembly information is stored in the **sys.assembly_files** table in the database where the assembly has been installed.</span></span> <span data-ttu-id="6b21e-182">La tabla **Sys. assembly_files** contiene las columnas siguientes.</span><span class="sxs-lookup"><span data-stu-id="6b21e-182">The **sys.assembly_files** table contains the following columns.</span></span>  
  
 <span data-ttu-id="6b21e-183">**assembly_id**</span><span class="sxs-lookup"><span data-stu-id="6b21e-183">**assembly_id**</span></span>  
 <span data-ttu-id="6b21e-184">Identificador definido para el ensamblado.</span><span class="sxs-lookup"><span data-stu-id="6b21e-184">The identifier defined for the assembly.</span></span> <span data-ttu-id="6b21e-185">Este número se asigna a todos los objetos relacionados con el mismo ensamblado.</span><span class="sxs-lookup"><span data-stu-id="6b21e-185">This number is assigned to all objects relating to the same assembly.</span></span>  
  
 <span data-ttu-id="6b21e-186">**name**</span><span class="sxs-lookup"><span data-stu-id="6b21e-186">**name**</span></span>  
 <span data-ttu-id="6b21e-187">El nombre del objeto.</span><span class="sxs-lookup"><span data-stu-id="6b21e-187">The name of the object.</span></span>  
  
 <span data-ttu-id="6b21e-188">**file_id**</span><span class="sxs-lookup"><span data-stu-id="6b21e-188">**file_id**</span></span>  
 <span data-ttu-id="6b21e-189">Número que identifica cada objeto, con el primer objeto asociado a una **assembly_id** determinada a la que se proporciona el valor 1.</span><span class="sxs-lookup"><span data-stu-id="6b21e-189">A number identifying each object, with the first object associated with a given **assembly_id** being given the value of 1.</span></span> <span data-ttu-id="6b21e-190">Si hay varios objetos asociados al mismo **assembly_id**, cada valor de **file_id** subsiguiente se incrementa en 1.</span><span class="sxs-lookup"><span data-stu-id="6b21e-190">If there are multiple objects associated with the same **assembly_id**, then each subsequent **file_id** value is incremented by 1.</span></span>  
  
 <span data-ttu-id="6b21e-191">**content**</span><span class="sxs-lookup"><span data-stu-id="6b21e-191">**content**</span></span>  
 <span data-ttu-id="6b21e-192">Representación hexadecimal del ensamblado o archivo.</span><span class="sxs-lookup"><span data-stu-id="6b21e-192">The hexadecimal representation of the assembly or file.</span></span>  
  
 <span data-ttu-id="6b21e-193">Puede utilizar la función CAST o CONVERT para convertir el contenido de la columna **Content** en texto legible.</span><span class="sxs-lookup"><span data-stu-id="6b21e-193">You can use the CAST or CONVERT function to convert the contents of the **content** column to readable text.</span></span> <span data-ttu-id="6b21e-194">La consulta siguiente convierte el contenido del archivo Point.cs en texto legible, utilizando el nombre de la cláusula WHERE para restringir el conjunto de resultados a una única fila.</span><span class="sxs-lookup"><span data-stu-id="6b21e-194">The following query converts the contents of the Point.cs file to readable text, using the name in the WHERE clause to restrict the result set to a single row.</span></span>  
  
```  
SELECT CAST(content AS varchar(8000))   
  FROM sys.assembly_files   
  WHERE name='PointSource';  
```  
  
 <span data-ttu-id="6b21e-195">Si copia y pega los resultados en un editor de texto, verá que se han conservado los saltos de línea y los espacios originales.</span><span class="sxs-lookup"><span data-stu-id="6b21e-195">If you copy and paste the results in to a text editor, you will see that the line breaks and spaces that existed in the original have been preserved.</span></span>  
  
## <a name="managing-udts-and-assemblies"></a><span data-ttu-id="6b21e-196">Administrar UDT y ensamblados</span><span class="sxs-lookup"><span data-stu-id="6b21e-196">Managing UDTs and Assemblies</span></span>  
 <span data-ttu-id="6b21e-197">A la hora de planear la implementación de los UDT, tenga en cuenta qué métodos se necesitan en el propio ensamblado UDT y qué métodos deberían crearse en ensamblados independientes e implementarse como funciones o procedimientos almacenados definidos por el usuario.</span><span class="sxs-lookup"><span data-stu-id="6b21e-197">When planning your implementation of UDTs, consider which methods are needed in the UDT assembly itself, and which methods should be created in separate assemblies and implemented as user-defined functions or stored procedures.</span></span> <span data-ttu-id="6b21e-198">Si separa los métodos en ensamblados distintos, podrá actualizar el código sin que esto afecte a los datos almacenados en una columna UDT de una tabla.</span><span class="sxs-lookup"><span data-stu-id="6b21e-198">Separating methods into separate assemblies allows you to update code without affecting data that may be stored in a UDT column in a table.</span></span> <span data-ttu-id="6b21e-199">Solo podrá modificar los ensamblados UDT sin quitar las columnas UDT y otros objetos dependientes cuando la nueva definición pueda leer los valores anteriores y la firma del tipo no cambie.</span><span class="sxs-lookup"><span data-stu-id="6b21e-199">You can modify UDT assemblies without dropping UDT columns and other dependent objects only when the new definition can read the former values and the signature of the type does not change.</span></span>  
  
 <span data-ttu-id="6b21e-200">Puede simplificar considerablemente el mantenimiento separando el código de los procedimientos que pueden cambiar del código necesario para implementar el UDT.</span><span class="sxs-lookup"><span data-stu-id="6b21e-200">Separating procedural code that may change from the code required to implement the UDT greatly simplifies maintenance.</span></span> <span data-ttu-id="6b21e-201">Si solamente incluye el código necesario para que el UDT funcione y crea las definiciones UDT de la forma más simple posible, se reducirá el riesgo de que el propio UDT tenga quitarse de la base de datos a la hora de revisar el código o corregir errores.</span><span class="sxs-lookup"><span data-stu-id="6b21e-201">Including only code that is necessary for the UDT to function, and keeping your UDT definitions as simple as possible, reduces the risk that the UDT itself may need to be dropped from the database for code revisions or bug fixes.</span></span>  
  
### <a name="the-currency-udt-and-currency-conversion-function"></a><span data-ttu-id="6b21e-202">El UDT Currency y la función de conversión de monedas</span><span class="sxs-lookup"><span data-stu-id="6b21e-202">The Currency UDT and Currency Conversion Function</span></span>  
 <span data-ttu-id="6b21e-203">El UDT **Currency** de la base de datos de ejemplo **AdventureWorks** proporciona un ejemplo útil de la manera recomendada de estructurar un UDT y sus funciones asociadas.</span><span class="sxs-lookup"><span data-stu-id="6b21e-203">The **Currency** UDT in the **AdventureWorks** sample database provides a useful example of the recommended way to structure a UDT and its associated functions.</span></span> <span data-ttu-id="6b21e-204">El UDT **Currency** se utiliza para controlar el dinero según el sistema monetario de una referencia cultural determinada y permite el almacenamiento de distintos tipos de moneda, como dólares, euros, etc.</span><span class="sxs-lookup"><span data-stu-id="6b21e-204">The **Currency** UDT is used for handling money based on the monetary system of a particular culture, and allows for storage of different currency types, such as dollars, euros, and so forth.</span></span> <span data-ttu-id="6b21e-205">La clase UDT expone un nombre de referencia cultural como una cadena y un importe monetario como un tipo de datos `decimal`.</span><span class="sxs-lookup"><span data-stu-id="6b21e-205">The UDT class exposes a culture name as a string, and an amount of money as a `decimal` data type.</span></span> <span data-ttu-id="6b21e-206">Todos los métodos de serialización necesarios están incluidos en el ensamblado que define la clase.</span><span class="sxs-lookup"><span data-stu-id="6b21e-206">All of the necessary serialization methods are contained within the assembly defining the class.</span></span> <span data-ttu-id="6b21e-207">La función que implementa la conversión de moneda de una referencia cultural a otra se implementa como una función externa denominada **ConvertCurrency**y esta función se encuentra en un ensamblado independiente.</span><span class="sxs-lookup"><span data-stu-id="6b21e-207">The function that implements currency conversion from one culture to another is implemented as an external function named **ConvertCurrency**, and this function is located in a separate assembly.</span></span> <span data-ttu-id="6b21e-208">La función **ConvertCurrency** realiza su trabajo mediante la recuperación de la tasa de conversión de una tabla en la base de datos **AdventureWorks** .</span><span class="sxs-lookup"><span data-stu-id="6b21e-208">The **ConvertCurrency** function does its work by retrieving the conversion rate from a table in the **AdventureWorks** database.</span></span> <span data-ttu-id="6b21e-209">Si el origen de las tasas de conversión debe cambiar alguna vez, o si debe haber otros cambios en el código existente, el ensamblado se puede modificar fácilmente sin que afecte al UDT de **moneda** .</span><span class="sxs-lookup"><span data-stu-id="6b21e-209">If the source of the conversion rates should ever change, or if there should be any other changes to the existing code, the assembly can be easily modified without affecting the **Currency** UDT.</span></span>  
  
 <span data-ttu-id="6b21e-210">La lista de código de las funciones UDT de **moneda** y **ConvertCurrency** se puede encontrar instalando los ejemplos de Common Language Runtime (CLR).</span><span class="sxs-lookup"><span data-stu-id="6b21e-210">The code listing for the **Currency** UDT and **ConvertCurrency** functions can be found by installing the common language runtime (CLR) samples.</span></span>  
  
### <a name="using-udts-across-databases"></a><span data-ttu-id="6b21e-211">Usar tipos UDT en varias bases de datos</span><span class="sxs-lookup"><span data-stu-id="6b21e-211">Using UDTs Across Databases</span></span>  
 <span data-ttu-id="6b21e-212">El ámbito de los UDT es, por definición, una sola base de datos.</span><span class="sxs-lookup"><span data-stu-id="6b21e-212">UDTs are by definition scoped to a single database.</span></span> <span data-ttu-id="6b21e-213">Por lo tanto, un UDT definido en una base de datos no puede usarse en una definición de columna de otra base de datos.</span><span class="sxs-lookup"><span data-stu-id="6b21e-213">Therefore, a UDT defined in one database cannot be used in a column definition in another database.</span></span> <span data-ttu-id="6b21e-214">Para usar los UDT en varias bases de datos, debe ejecutar las instrucciones CREATE ASSEMBLY y CREATE TYPE en cada base de datos en ensamblados idénticos.</span><span class="sxs-lookup"><span data-stu-id="6b21e-214">In order to use UDTs in multiple databases, you must execute the CREATE ASSEMBLY and CREATE TYPE statements in each database on identical assemblies.</span></span> <span data-ttu-id="6b21e-215">Los ensamblados se consideran idénticos si tienen el mismo nombre, nombre seguro, referencia cultural, versión, conjunto de permisos y contenido binario.</span><span class="sxs-lookup"><span data-stu-id="6b21e-215">Assemblies are considered identical if they have the same name, strong name, culture, version, permission set, and binary contents.</span></span>  
  
 <span data-ttu-id="6b21e-216">Cuando el UDT se haya registrado y esté accesible en ambas bases de datos, podrá convertir un valor UDT de una base de datos para utilizarlo en la otra.</span><span class="sxs-lookup"><span data-stu-id="6b21e-216">Once the UDT is registered and accessible in both databases, you can convert a UDT value from one database for use in another.</span></span> <span data-ttu-id="6b21e-217">Pueden usarse UDT idénticos en varias bases de datos en los escenarios siguientes:</span><span class="sxs-lookup"><span data-stu-id="6b21e-217">Identical UDTs can be used across databases in the following scenarios:</span></span>  
  
-   <span data-ttu-id="6b21e-218">Al llamar a un procedimiento almacenado definido en bases de datos diferentes.</span><span class="sxs-lookup"><span data-stu-id="6b21e-218">Calling stored procedure defined in different databases.</span></span>  
  
-   <span data-ttu-id="6b21e-219">Al consultar tablas definidas en bases de datos diferentes.</span><span class="sxs-lookup"><span data-stu-id="6b21e-219">Querying tables defined in different databases.</span></span>  
  
-   <span data-ttu-id="6b21e-220">Al seleccionar datos UDT de una columna UDT de una tabla de base de datos e insertarlos en una segunda base de datos con una columna UDT idéntica.</span><span class="sxs-lookup"><span data-stu-id="6b21e-220">Selecting UDT data from one database table UDT column and inserting it into a second database with an identical UDT column.</span></span>  
  
 <span data-ttu-id="6b21e-221">En estas situaciones, todas las conversiones que requiere el servidor se realizan automáticamente.</span><span class="sxs-lookup"><span data-stu-id="6b21e-221">In these situations, any conversion required by the server occurs automatically.</span></span> <span data-ttu-id="6b21e-222">No puede realizar las conversiones de forma explícita utilizando las funciones CAST o CONVERT de [!INCLUDE[tsql](../../includes/tsql-md.md)].</span><span class="sxs-lookup"><span data-stu-id="6b21e-222">You are not able to perform the conversions explicitly using the [!INCLUDE[tsql](../../includes/tsql-md.md)] CAST or CONVERT functions.</span></span>  
  
 <span data-ttu-id="6b21e-223">Tenga en cuenta que no es necesario realizar ninguna acción para usar UDT cuando [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] crea tablas de trabajo en la base de datos del sistema **tempdb** .</span><span class="sxs-lookup"><span data-stu-id="6b21e-223">Note that you do not need to take any action for using UDTs when [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] creates work tables in the **tempdb** system database.</span></span> <span data-ttu-id="6b21e-224">Esto incluye el control de cursores, variables de tabla y funciones con valores de tabla definidas por el usuario que incluyen UDT y que usan de forma transparente **tempdb**.</span><span class="sxs-lookup"><span data-stu-id="6b21e-224">This includes the handling of cursors, table variables, and user-defined table-valued functions that include UDTs and that transparently make use of **tempdb**.</span></span> <span data-ttu-id="6b21e-225">Sin embargo, si crea explícitamente una tabla temporal en **tempdb** que define una columna UDT, el UDT debe registrarse en **tempdb** del mismo modo que para una base de datos de usuario.</span><span class="sxs-lookup"><span data-stu-id="6b21e-225">However, if you explicitly create a temporary table in **tempdb** that defines a UDT column, then the UDT must be registered in **tempdb** the same way as for a user database.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="6b21e-226">Consulte también</span><span class="sxs-lookup"><span data-stu-id="6b21e-226">See Also</span></span>  
 [<span data-ttu-id="6b21e-227">Tipos definidos por el usuario CLR</span><span class="sxs-lookup"><span data-stu-id="6b21e-227">CLR User-Defined Types</span></span>](clr-user-defined-types.md)  
  
  
