---
title: SQL Server y claves de cifrado de base de datos (motor de base de datos) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: security
ms.topic: conceptual
helpviewer_keywords:
- keys [SQL Server], database encryption
ms.assetid: 15c0a5e8-9177-484c-ae75-8c552dc0dac0
author: jaszymas
ms.author: jaszymas
ms.openlocfilehash: f846e74e0afd89c6bb10a4aa9a23a6420b6a613a
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87752053"
---
# <a name="sql-server-and-database-encryption-keys-database-engine"></a><span data-ttu-id="8d57f-102">SQL Server y claves de cifrado de base de datos (motor de base de datos)</span><span class="sxs-lookup"><span data-stu-id="8d57f-102">SQL Server and Database Encryption Keys (Database Engine)</span></span>
  [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="8d57f-103">usa claves de cifrado para proteger los datos, las credenciales y la información de conexión que se almacena en una base de datos servidor.</span><span class="sxs-lookup"><span data-stu-id="8d57f-103">uses encryption keys to help secure data, credentials, and connection information that is stored in a server database.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="8d57f-104">tiene dos tipos de claves: *simétricas* y *asimétricas*.</span><span class="sxs-lookup"><span data-stu-id="8d57f-104">has two kinds of keys: *symmetric* and *asymmetric*.</span></span> <span data-ttu-id="8d57f-105">Las claves simétricas utilizan la misma contraseña para cifrar y descifrar los datos.</span><span class="sxs-lookup"><span data-stu-id="8d57f-105">Symmetric keys use the same password to encrypt and decrypt data.</span></span> <span data-ttu-id="8d57f-106">Las claves asimétricas usan una contraseña para cifrar los datos (denominada clave *pública* ) y otra para descifrar los datos (denominada clave *privada* ).</span><span class="sxs-lookup"><span data-stu-id="8d57f-106">Asymmetric keys use one password to encrypt data (called the *public* key) and another to decrypt data (called the *private* key).</span></span>  
  
 <span data-ttu-id="8d57f-107">En [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], las claves de cifrado incluyen una combinación de claves públicas, privadas y simétricas que se utilizan para proteger la información confidencial.</span><span class="sxs-lookup"><span data-stu-id="8d57f-107">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], encryption keys include a combination of public, private, and symmetric keys that are used to protect sensitive data.</span></span> <span data-ttu-id="8d57f-108">La clave simétrica se crea durante la inicialización de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] al iniciar por primera vez la instancia de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="8d57f-108">The symmetric key is created during [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] initialization when you first start the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="8d57f-109">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] utiliza la clave para cifrar los datos confidenciales que se almacenan en [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8d57f-109">The key is used by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] to encrypt sensitive data that is stored in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="8d57f-110">El sistema operativo crea las claves públicas y privadas, y éstas se utilizan para proteger la clave simétrica.</span><span class="sxs-lookup"><span data-stu-id="8d57f-110">Public and private keys are created by the operating system and they are used to protect the symmetric key.</span></span> <span data-ttu-id="8d57f-111">Para cada instancia de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] que almacena datos confidenciales en una base de datos se crea un par de claves pública y privada.</span><span class="sxs-lookup"><span data-stu-id="8d57f-111">A public and private key pair is created for each [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance that stores sensitive data in a database.</span></span>  
  
## <a name="applications-for-sql-server-and-database-keys"></a><span data-ttu-id="8d57f-112">Aplicaciones para las claves de SQL Server y las claves de las bases de datos</span><span class="sxs-lookup"><span data-stu-id="8d57f-112">Applications for SQL Server and Database Keys</span></span>  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="8d57f-113">tiene dos aplicaciones principales para las claves: una *clave maestra de servicio* (SMK) generada en y para una instancia de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , y una *clave maestra de base de datos* (DMK) usada para una base de datos.</span><span class="sxs-lookup"><span data-stu-id="8d57f-113">has two primary applications for keys: a *service master key* (SMK) generated on and for a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance, and a *database master key* (DMK) used for a database.</span></span>  
  
 <span data-ttu-id="8d57f-114">La clave maestra de servicio se genera automáticamente la primera vez que se inicia la instancia de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] y se utiliza para cifrar una contraseña de servidor vinculado, las credenciales y la clave maestra de base de datos.</span><span class="sxs-lookup"><span data-stu-id="8d57f-114">The SMK is automatically generated the first time the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance is started and is used to encrypt a linked server password, credentials, and the database master key.</span></span> <span data-ttu-id="8d57f-115">La SMK se cifra mediante la clave del equipo local y la API de protección de datos de Windows (DPAPI).</span><span class="sxs-lookup"><span data-stu-id="8d57f-115">The SMK is encrypted by using the local computer key using the Windows Data Protection API (DPAPI).</span></span> <span data-ttu-id="8d57f-116">La DPAPI utiliza una clave derivada de las credenciales de Windows de la cuenta de servicio de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] y de las credenciales del equipo.</span><span class="sxs-lookup"><span data-stu-id="8d57f-116">The DPAPI uses a key that is derived from the Windows credentials of the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] service account and the computer's credentials.</span></span> <span data-ttu-id="8d57f-117">La clave maestra de servicio solo puede descifrarse con la cuenta de servicio en la que se creó o con una entidad de seguridad que tenga acceso a las credenciales del equipo.</span><span class="sxs-lookup"><span data-stu-id="8d57f-117">The service master key can only be decrypted by the service account under which it was created or by a principal that has access to the machine's credentials.</span></span>  
  
 <span data-ttu-id="8d57f-118">La clave maestra de base de datos es una clave simétrica que se utiliza para proteger las claves privadas de certificados y las claves asimétricas presentes en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="8d57f-118">The database master key is a symmetric key that is used to protect the private keys of certificates and asymmetric keys that are present in the database.</span></span> <span data-ttu-id="8d57f-119">También se puede utilizar para cifrar los datos, pero sus limitaciones de longitud hacen que sea más práctico utilizar una clave simétrica.</span><span class="sxs-lookup"><span data-stu-id="8d57f-119">It can also be used to encrypt data, but it has length limitations that make it less practical for data than using a symmetric key.</span></span>  
  
 <span data-ttu-id="8d57f-120">Al crearla, la clave maestra se cifra mediante el algoritmo Triple DES y una contraseña proporcionada por el usuario.</span><span class="sxs-lookup"><span data-stu-id="8d57f-120">When it is created, the master key is encrypted by using the Triple DES algorithm and a user-supplied password.</span></span> <span data-ttu-id="8d57f-121">Para habilitar el descifrado automático de la clave maestra, se cifra una copia de la clave mediante la SMK.</span><span class="sxs-lookup"><span data-stu-id="8d57f-121">To enable the automatic decryption of the master key, a copy of the key is encrypted by using the SMK.</span></span> <span data-ttu-id="8d57f-122">Esta copia se almacena en la base de datos donde se utiliza y en la base de datos del sistema `master`.</span><span class="sxs-lookup"><span data-stu-id="8d57f-122">It is stored in both the database where it is used and in the `master` system database.</span></span>  
  
 <span data-ttu-id="8d57f-123">La copia de la DMK almacenada en la base de datos del sistema `master` se actualiza automáticamente siempre que se modifica la DMK.</span><span class="sxs-lookup"><span data-stu-id="8d57f-123">The copy of the DMK stored in the `master` system database is silently updated whenever the DMK is changed.</span></span> <span data-ttu-id="8d57f-124">Sin embargo, este comportamiento predeterminado se puede cambiar con la opción `DROP ENCRYPTION BY SERVICE MASTER KEY` de la instrucción `ALTER MASTER KEY`.</span><span class="sxs-lookup"><span data-stu-id="8d57f-124">However, this default can be changed by using the `DROP ENCRYPTION BY SERVICE MASTER KEY` option of the `ALTER MASTER KEY` statement.</span></span> <span data-ttu-id="8d57f-125">Para abrir una DMK que no se haya cifrado con la clave maestra de servicio, debe utilizarse la instrucción `OPEN MASTER KEY` y una contraseña.</span><span class="sxs-lookup"><span data-stu-id="8d57f-125">A DMK that is not encrypted by the service master key must be opened by using the `OPEN MASTER KEY` statement and a password.</span></span>  
  
## <a name="managing-sql-server-and-database-keys"></a><span data-ttu-id="8d57f-126">Administrar las claves de SQL Server y las claves de las bases de datos</span><span class="sxs-lookup"><span data-stu-id="8d57f-126">Managing SQL Server and Database Keys</span></span>  
 <span data-ttu-id="8d57f-127">La administración de las claves de cifrado consiste en crear nuevas claves de base de datos, crear una copia de seguridad de las claves del servidor y de las bases de datos, y saber cuándo y cómo se deben restaurar, eliminar o cambiar dichas claves.</span><span class="sxs-lookup"><span data-stu-id="8d57f-127">Managing encryption keys consists of creating new database keys, creating a backup of the server and database keys, and knowing when and how to restore, delete, or change the keys.</span></span>  
  
 <span data-ttu-id="8d57f-128">Para administrar las claves simétricas, puede utilizar las herramientas incluidas en [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] para hacer lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="8d57f-128">To manage symmetric keys, you can use the tools included in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] to do the following:</span></span>  
  
-   <span data-ttu-id="8d57f-129">Crear una copia de seguridad de las claves del servidor y de las claves de las bases de datos que se pueda utilizar para recuperar una instalación de un servidor de informes, o como parte de una migración planeada.</span><span class="sxs-lookup"><span data-stu-id="8d57f-129">Back up a copy of the server and database keys so that you can use them to recover a server installation, or as part of a planned migration.</span></span>  
  
-   <span data-ttu-id="8d57f-130">Restaurar una clave guardada previamente en una base de datos.</span><span class="sxs-lookup"><span data-stu-id="8d57f-130">Restore a previously saved key to a database.</span></span> <span data-ttu-id="8d57f-131">Esto permite el acceso de una nueva instancia del servidor a datos existentes que no cifró originalmente.</span><span class="sxs-lookup"><span data-stu-id="8d57f-131">This enables a new server instance to access existing data that it did not originally encrypt.</span></span>  
  
-   <span data-ttu-id="8d57f-132">Eliminar los datos cifrados en una base de datos, en el caso poco probable de que ya no se tenga acceso a datos cifrados.</span><span class="sxs-lookup"><span data-stu-id="8d57f-132">Delete the encrypted data in a database in the unlikely event that you can no longer access encrypted data.</span></span>  
  
-   <span data-ttu-id="8d57f-133">Volver a crear claves y volver a cifrar datos en el caso poco probable de que la clave esté en unas circunstancias comprometidas.</span><span class="sxs-lookup"><span data-stu-id="8d57f-133">Re-create keys and re-encrypt data in the unlikely event that the key is compromised.</span></span> <span data-ttu-id="8d57f-134">Como práctica recomendada de seguridad, se deberían volver a crear las claves periódicamente (por ejemplo, cada cierto número de meses) para proteger el servidor de ataques que traten de descifrar las claves.</span><span class="sxs-lookup"><span data-stu-id="8d57f-134">As a security best practice, you should re-create the keys periodically (for example, every few months) to protect the server from attacks that try to decipher the keys.</span></span>  
  
-   <span data-ttu-id="8d57f-135">Agregar o quitar una instancia del servidor de una implementación escalada de este servidor en la que varios servidores comparten una sola base de datos y la clave que proporciona el cifrado reversible para dicha base de datos.</span><span class="sxs-lookup"><span data-stu-id="8d57f-135">Add or remove a server instance from a server scale-out deployment where multiple servers share both a single database and the key that provides reversible encryption for that database.</span></span>  
  
## <a name="important-security-information"></a><span data-ttu-id="8d57f-136">Información de seguridad importante</span><span class="sxs-lookup"><span data-stu-id="8d57f-136">Important Security Information</span></span>  
 <span data-ttu-id="8d57f-137">Para tener acceso a los objetos protegidos por la clave maestra de servicio, es necesaria la cuenta de servicio de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] que se utilizó para crear la clave o la cuenta del equipo.</span><span class="sxs-lookup"><span data-stu-id="8d57f-137">Accessing objects secured by the service master key requires either the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Service account that was used to create the key or the computer (machine) account.</span></span> <span data-ttu-id="8d57f-138">Es decir, el equipo vinculado al sistema donde se creó la clave.</span><span class="sxs-lookup"><span data-stu-id="8d57f-138">That is, the computer is tied to the system where the key was created.</span></span> <span data-ttu-id="8d57f-139">Puede cambiar la cuenta de servicio de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]*o* la cuenta del equipo sin perder el acceso a la clave.</span><span class="sxs-lookup"><span data-stu-id="8d57f-139">You can change the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Service account *or* the computer account without losing access to the key.</span></span> <span data-ttu-id="8d57f-140">Sin embargo, si cambia ambas, perderá el acceso a la clave maestra de servicio.</span><span class="sxs-lookup"><span data-stu-id="8d57f-140">However, if you change both, you will lose access to the service master key.</span></span> <span data-ttu-id="8d57f-141">Si pierde el acceso a la clave maestra de servicio sin uno de estos dos elementos, no podrá descifrar los datos y los objetos cifrados mediante la clave original.</span><span class="sxs-lookup"><span data-stu-id="8d57f-141">If you lose access to the service master key without one of these two elements, you be unable to decrypt data and objects encrypted by using the original key.</span></span>  
  
 <span data-ttu-id="8d57f-142">Las conexiones protegidas con la clave maestra de servicio no se pueden restaurar sin dicha clave.</span><span class="sxs-lookup"><span data-stu-id="8d57f-142">Connections secured with the service master key cannot be restored without the service master key.</span></span>  
  
 <span data-ttu-id="8d57f-143">El acceso a los objetos y los datos protegidos con la clave maestra de base de datos únicamente requiere la contraseña que se utiliza para proteger la clave.</span><span class="sxs-lookup"><span data-stu-id="8d57f-143">Access to objects and data secured with the database master key require only the password that is used to help secure the key.</span></span>  
  
> [!CAUTION]  
>  <span data-ttu-id="8d57f-144">Si pierde todo tipo de acceso a las claves descritas anteriormente, también perderá el acceso a los objetos, las conexiones y los datos protegidos mediante esas claves.</span><span class="sxs-lookup"><span data-stu-id="8d57f-144">If you lose all access to the keys described earlier, you will lose access to the objects, connections, and data secured by those keys.</span></span> <span data-ttu-id="8d57f-145">Puede restaurar la clave maestra de servicio, tal y como se describe en los vínculos que se muestran a continuación, o puede regresar al sistema de cifrado original para recuperar el acceso.</span><span class="sxs-lookup"><span data-stu-id="8d57f-145">You can restore the service master key, as described in the links that are shown here, or you can go back to the original encrypting system to recover the access.</span></span> <span data-ttu-id="8d57f-146">No hay ninguna "puerta trasera" para recuperar el acceso.</span><span class="sxs-lookup"><span data-stu-id="8d57f-146">There is no "back-door" to recover the access.</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="8d57f-147">En esta sección</span><span class="sxs-lookup"><span data-stu-id="8d57f-147">In This Section</span></span>  
 [<span data-ttu-id="8d57f-148">Clave maestra de servicio</span><span class="sxs-lookup"><span data-stu-id="8d57f-148">Service Master Key</span></span>](service-master-key.md)  
 <span data-ttu-id="8d57f-149">Proporciona una breve explicación de la clave maestra de servicio y las prácticas recomendadas.</span><span class="sxs-lookup"><span data-stu-id="8d57f-149">Provides a brief explanation for the service master key and its best practices.</span></span>  
  
 [<span data-ttu-id="8d57f-150">Administración extensible de claves &#40;EKM&#41;</span><span class="sxs-lookup"><span data-stu-id="8d57f-150">Extensible Key Management &#40;EKM&#41;</span></span>](extensible-key-management-ekm.md)  
 <span data-ttu-id="8d57f-151">Explica cómo usar los sistemas de administración de claves de terceros con [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8d57f-151">Explains how to use third-party key management systems with [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
## <a name="related-tasks"></a><span data-ttu-id="8d57f-152">Related Tasks</span><span class="sxs-lookup"><span data-stu-id="8d57f-152">Related Tasks</span></span>  
 [<span data-ttu-id="8d57f-153">Hacer una copia de seguridad de la clave maestra de servicio</span><span class="sxs-lookup"><span data-stu-id="8d57f-153">Back Up the Service Master Key</span></span>](back-up-the-service-master-key.md)  
  
 [<span data-ttu-id="8d57f-154">Restaurar la clave maestra de servicio</span><span class="sxs-lookup"><span data-stu-id="8d57f-154">Restore the Service Master Key</span></span>](restore-the-service-master-key.md)  
  
 [<span data-ttu-id="8d57f-155">Crear la clave maestra de una base de datos</span><span class="sxs-lookup"><span data-stu-id="8d57f-155">Create a Database Master Key</span></span>](create-a-database-master-key.md)  
  
 [<span data-ttu-id="8d57f-156">Hacer copias de seguridad de una clave maestra de una base de datos</span><span class="sxs-lookup"><span data-stu-id="8d57f-156">Back Up a Database Master Key</span></span>](back-up-a-database-master-key.md)  
  
 [<span data-ttu-id="8d57f-157">Restaurar una clave maestra de base de datos</span><span class="sxs-lookup"><span data-stu-id="8d57f-157">Restore a Database Master Key</span></span>](restore-a-database-master-key.md)  
  
 [<span data-ttu-id="8d57f-158">Crear claves simétricas idénticas en dos servidores</span><span class="sxs-lookup"><span data-stu-id="8d57f-158">Create Identical Symmetric Keys on Two Servers</span></span>](create-identical-symmetric-keys-on-two-servers.md)  
  
 [<span data-ttu-id="8d57f-159">Administración extensible de claves con el Almacén de claves de Azure &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="8d57f-159">Extensible Key Management Using Azure Key Vault &#40;SQL Server&#41;</span></span>](extensible-key-management-using-azure-key-vault-sql-server.md)  
  
 [<span data-ttu-id="8d57f-160">Habilitar TDE con EKM</span><span class="sxs-lookup"><span data-stu-id="8d57f-160">Enable TDE Using EKM</span></span>](enable-tde-on-sql-server-using-ekm.md)  
  
## <a name="related-content"></a><span data-ttu-id="8d57f-161">Contenido relacionado</span><span class="sxs-lookup"><span data-stu-id="8d57f-161">Related Content</span></span>  
 [<span data-ttu-id="8d57f-162">CREATE MASTER KEY &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="8d57f-162">CREATE MASTER KEY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-master-key-transact-sql)  
  
 [<span data-ttu-id="8d57f-163">ALTER SERVICE MASTER KEY &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="8d57f-163">ALTER SERVICE MASTER KEY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-service-master-key-transact-sql)  
  
 [<span data-ttu-id="8d57f-164">Restaurar una clave maestra de base de datos</span><span class="sxs-lookup"><span data-stu-id="8d57f-164">Restore a Database Master Key</span></span>](restore-a-database-master-key.md)  
  
## <a name="see-also"></a><span data-ttu-id="8d57f-165">Consulte también</span><span class="sxs-lookup"><span data-stu-id="8d57f-165">See Also</span></span>  
 <span data-ttu-id="8d57f-166">[Hacer copia de seguridad y restaurar claves de cifrado de Reporting Services](../../../reporting-services/install-windows/ssrs-encryption-keys-back-up-and-restore-encryption-keys.md) </span><span class="sxs-lookup"><span data-stu-id="8d57f-166">[Back Up and Restore Reporting Services Encryption Keys](../../../reporting-services/install-windows/ssrs-encryption-keys-back-up-and-restore-encryption-keys.md) </span></span>  
 <span data-ttu-id="8d57f-167">[Eliminar y volver a crear claves de cifrado &#40;Administrador de configuración de SSRS&#41;](../../../reporting-services/install-windows/ssrs-encryption-keys-delete-and-re-create-encryption-keys.md) </span><span class="sxs-lookup"><span data-stu-id="8d57f-167">[Delete and Re-create Encryption Keys  &#40;SSRS Configuration Manager&#41;](../../../reporting-services/install-windows/ssrs-encryption-keys-delete-and-re-create-encryption-keys.md) </span></span>  
 <span data-ttu-id="8d57f-168">[Agregar y quitar claves de cifrado para implementaciones escaladas &#40;Administrador de configuración de SSRS&#41;](../../../reporting-services/install-windows/add-and-remove-encryption-keys-for-scale-out-deployment.md) </span><span class="sxs-lookup"><span data-stu-id="8d57f-168">[Add and Remove Encryption Keys for Scale-Out Deployment &#40;SSRS Configuration Manager&#41;](../../../reporting-services/install-windows/add-and-remove-encryption-keys-for-scale-out-deployment.md) </span></span>  
 [<span data-ttu-id="8d57f-169">Cifrado de datos transparente &#40;TDE&#41;</span><span class="sxs-lookup"><span data-stu-id="8d57f-169">Transparent Data Encryption &#40;TDE&#41;</span></span>](transparent-data-encryption.md)  
  
  
