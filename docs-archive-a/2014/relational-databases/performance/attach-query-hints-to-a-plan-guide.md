---
title: Asociar sugerencias de consulta a una guía de plan | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: performance
ms.topic: conceptual
ms.assetid: 2131f796-6359-4f9e-9047-da0b3d4dedaf
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 074c69ffefd2b5a7b2ef445f941f97b7130b0732
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87674784"
---
# <a name="attach-query-hints-to-a-plan-guide"></a><span data-ttu-id="55962-102">Asociar sugerencias de consulta a una guía de plan</span><span class="sxs-lookup"><span data-stu-id="55962-102">Attach Query Hints to a Plan Guide</span></span>
  <span data-ttu-id="55962-103">En una guía de plan se puede usar cualquier combinación de sugerencias de consulta válidas.</span><span class="sxs-lookup"><span data-stu-id="55962-103">Any combination of valid query hints can be used in a plan guide.</span></span> <span data-ttu-id="55962-104">Cuando una guía de plan coincide con una consulta, la cláusula OPTION especificada en la cláusula de sugerencia de una guía de plan se agrega a la consulta antes de la compilación y optimización.</span><span class="sxs-lookup"><span data-stu-id="55962-104">When a plan guide matches a query, the OPTION clause specified in the hints clause of a plan guide is added to the query before it compiles and optimizes.</span></span> <span data-ttu-id="55962-105">Si una consulta que coincide con una guía de plan ya tiene una cláusula OPTION, las sugerencias de consulta especificadas en la guía de plan sustituirán a las de la consulta.</span><span class="sxs-lookup"><span data-stu-id="55962-105">If a query that is matched to a plan guide already has an OPTION clause, the query hints specified in the plan guide replace those in the query.</span></span> <span data-ttu-id="55962-106">Sin embargo, para que una guía de plan coincida con una consulta que ya tiene una cláusula OPTION, debe incluir esta cláusula de la consulta al especificar el texto con el que debe coincidir la instrucción sp_create_plan_guide.</span><span class="sxs-lookup"><span data-stu-id="55962-106">However, for a plan guide to match a query that already has an OPTION clause, you must include the OPTION clause of the query when you specify the text of the query to match in the sp_create_plan_guide statement.</span></span> <span data-ttu-id="55962-107">Si desea que las sugerencias especificadas en la guía de plan se agreguen a las que ya existen en la consulta, en lugar de sustituirlas, debe especificar tanto las originales como las adicionales en la cláusula OPTION de la guía de plan.</span><span class="sxs-lookup"><span data-stu-id="55962-107">If you want the hints specified in the plan guide to be added to the hints that already exist on the query, instead of replacing them, you must specify both the original hints and the additional hints in the OPTION clause of the plan guide.</span></span>  
  
> [!CAUTION]  
>  <span data-ttu-id="55962-108">Las guías de plan que usan incorrectamente las sugerencias de consulta pueden provocar problemas de compilación, ejecución o rendimiento.</span><span class="sxs-lookup"><span data-stu-id="55962-108">Plan guides that misuse query hints can cause compilation, execution, or performance problems.</span></span> <span data-ttu-id="55962-109">Solo deben utilizarlas los programadores y administradores de bases de datos con experiencia.</span><span class="sxs-lookup"><span data-stu-id="55962-109">Plan guides should be used only by experienced developers and database administrators.</span></span>  
  
## <a name="common-query-hints-used-in-plan-guides"></a><span data-ttu-id="55962-110">Sugerencias de consulta comúnmente utilizadas en las guías de plan</span><span class="sxs-lookup"><span data-stu-id="55962-110">Common Query Hints Used in Plan Guides</span></span>  
 <span data-ttu-id="55962-111">Las consultas que pueden aprovechar las guías de plan suelen estar basadas en parámetros, y puede que su rendimiento sea bajo porque utilizan planes de consulta en caché cuyos valores de parámetros no representan un caso del tipo "el peor de los casos" o el más representativo.</span><span class="sxs-lookup"><span data-stu-id="55962-111">Queries that can benefit from plan guides are generally parameter-based, and may be performing poorly because they use cached query plans whose parameter values do not represent a worst-case or most representative scenario.</span></span> <span data-ttu-id="55962-112">Este problema se puede solucionar con las sugerencias de consulta OPTIMIZE FOR y RECOMPILE.</span><span class="sxs-lookup"><span data-stu-id="55962-112">The OPTIMIZE FOR and RECOMPILE query hints can be used to address this problem.</span></span> <span data-ttu-id="55962-113">OPTIMIZE FOR indica a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] que utilice un valor determinado para un parámetro cuando se optimiza la consulta.</span><span class="sxs-lookup"><span data-stu-id="55962-113">OPTIMIZE FOR instructs [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to use a particular value for a parameter when the query is optimized.</span></span> <span data-ttu-id="55962-114">RECOMPILE indica al servidor que descarte un plan de consulta tras la ejecución, con lo que se forzará al optimizador de consultas a volver a compilar un nuevo plan de consulta la próxima vez que se ejecute la misma consulta.</span><span class="sxs-lookup"><span data-stu-id="55962-114">RECOMPILE instructs the server to discard a query plan after execution, forcing the query optimizer to recompile a new query plan the next time that the same query is executed.</span></span> <span data-ttu-id="55962-115">Para obtener un ejemplo, vea [Guías de plan](plan-guides.md).</span><span class="sxs-lookup"><span data-stu-id="55962-115">For an example, see [Plan Guides](plan-guides.md).</span></span>  
  
 <span data-ttu-id="55962-116">Por otro lado, puede especificar las sugerencias de tabla INDEX, FORCESCAN y FORCESEEK como sugerencias de consulta.</span><span class="sxs-lookup"><span data-stu-id="55962-116">In addition, you can specify the table hints INDEX, FORCESCAN, and FORCESEEK as query hints.</span></span> <span data-ttu-id="55962-117">Cuando se especifican como sugerencias de consulta, estas sugerencias se comportan de la misma manera que una tabla insertada o una sugerencia de vista.</span><span class="sxs-lookup"><span data-stu-id="55962-117">When specified as query hints, these hints behave like an inline table or view hint.</span></span> <span data-ttu-id="55962-118">La sugerencia INDEX obliga al optimizador de consultas a usar solo los índices especificados para tener acceso a los datos a los que se hace referencia en la tabla o vista.</span><span class="sxs-lookup"><span data-stu-id="55962-118">The INDEX hint forces the query optimizer to use only the specified indexes to access the data in the referenced table or view.</span></span> <span data-ttu-id="55962-119">La sugerencia FORCESEEK obliga al optimizador de consultas a usar solo una operación Index Seek para tener acceso a los datos a los que se hace referencia en la tabla o en la vista.</span><span class="sxs-lookup"><span data-stu-id="55962-119">The FORCESEEK hint forces the optimizer to use only an index seek operation to access the data in the referenced table or view.</span></span> <span data-ttu-id="55962-120">Estas sugerencias proporcionan la funcionalidad de la guía de plan adicional y permiten tener más influencia sobre la optimización de consultas que usan la guía de plan.</span><span class="sxs-lookup"><span data-stu-id="55962-120">These hints provide additional plan guide functionality and allow you to have more influence over the optimization of queries that use the plan guide.</span></span>  
  
  
