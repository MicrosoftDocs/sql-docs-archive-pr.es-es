---
title: Reducción de la carga de optimización del servidor de producción | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: performance
ms.topic: conceptual
helpviewer_keywords:
- overhead [Database Engine Tuning Advisor]
- tuning overhead [SQL Server]
- reducing production server tuning load
- Database Engine Tuning Advisor [SQL Server], test servers
- test servers [Database Engine Tuning Advisor]
- production servers [SQL Server]
- offload tuning overhead [SQL Server]
ms.assetid: bb95ecaf-444a-4771-a625-e0a91c8f0709
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 53a61b17793a50d6b819f7c1684afdc4de4377f4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87674776"
---
# <a name="reduce-the-production-server-tuning-load"></a><span data-ttu-id="b7c45-102">Reducir la carga de optimización del servidor de producción</span><span class="sxs-lookup"><span data-stu-id="b7c45-102">Reduce the Production Server Tuning Load</span></span>
  [!INCLUDE[ssDE](../../../includes/ssde-md.md)] <span data-ttu-id="b7c45-103">se basa en el optimizador de consultas para analizar una carga de trabajo y realizar recomendaciones de optimización.</span><span class="sxs-lookup"><span data-stu-id="b7c45-103">Tuning Advisor relies on the query optimizer to analyze a workload and to make tuning recommendations.</span></span> <span data-ttu-id="b7c45-104">La realización de este análisis en el servidor de producción le agrega carga y puede perjudicar su rendimiento durante la sesión de optimización.</span><span class="sxs-lookup"><span data-stu-id="b7c45-104">Performing this analysis on the production server adds to the server load and can hurt server performance during the tuning session.</span></span> <span data-ttu-id="b7c45-105">Puede reducir el efecto en la carga del servidor durante una sesión de optimización utilizando un servidor de pruebas además del servidor de producción.</span><span class="sxs-lookup"><span data-stu-id="b7c45-105">You can reduce the impact to the server load during a tuning session by using a test server in addition to the production server.</span></span>

## <a name="how-database-engine-tuning-advisor-uses-a-test-server"></a><span data-ttu-id="b7c45-106">Cómo utiliza el Asistente para la optimización de motor de base de datos un servidor de prueba</span><span class="sxs-lookup"><span data-stu-id="b7c45-106">How Database Engine Tuning Advisor Uses a Test Server</span></span>
 <span data-ttu-id="b7c45-107">El modo tradicional de utilizar un servidor de prueba consiste en copiar todos los datos del servidor de producción al servidor de prueba, optimizar el servidor de prueba y luego implementar la recomendación en el servidor de producción.</span><span class="sxs-lookup"><span data-stu-id="b7c45-107">The traditional way to use a test server is to copy all of the data from your production server to your test server, tune the test server, and then implement the recommendation on your production server.</span></span> <span data-ttu-id="b7c45-108">Este proceso elimina el impacto negativo de rendimiento que sufriría el servidor de producción, pero no es la solución idónea.</span><span class="sxs-lookup"><span data-stu-id="b7c45-108">This process eliminates the performance impact on your production server, but nevertheless is not the optimal solution.</span></span> <span data-ttu-id="b7c45-109">Por ejemplo, cuando sea necesario copiar grandes volúmenes de datos del servidor de producción al de prueba, el consumo de tiempo y recursos se dispara.</span><span class="sxs-lookup"><span data-stu-id="b7c45-109">For example, copying large amounts of data from the production to the test server can consume substantial amounts of time and resources.</span></span> <span data-ttu-id="b7c45-110">Además, el hardware del servidor de prueba no suele ser tan eficaz como el hardware implementado en los servidores de producción.</span><span class="sxs-lookup"><span data-stu-id="b7c45-110">In addition, test server hardware is seldom as powerful as the hardware that is deployed for production servers.</span></span> <span data-ttu-id="b7c45-111">El proceso de optimización se basa en el optimizador de consultas y las recomendaciones que éste genera se basan en parte del hardware subyacente.</span><span class="sxs-lookup"><span data-stu-id="b7c45-111">The tuning process relies on the query optimizer, and the recommendations it generates are based in part on the underlying hardware.</span></span> <span data-ttu-id="b7c45-112">Si el hardware del servidor de pruebas no es idéntico al del servidor de producción, disminuirá la calidad de las recomendaciones que efectúe el Asistente para la optimización de [!INCLUDE[ssDE](../../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="b7c45-112">If the test and production server hardware are not identical, the [!INCLUDE[ssDE](../../../includes/ssde-md.md)] Tuning Advisor recommendation quality is diminished.</span></span>

 <span data-ttu-id="b7c45-113">Para evitar estos problemas, el Asistente para la optimización de [!INCLUDE[ssDE](../../../includes/ssde-md.md)] lleva a cabo la optimización de una base de datos en un servidor de producción procediendo a la descarga de gran parte de la carga de optimización en el servidor de prueba.</span><span class="sxs-lookup"><span data-stu-id="b7c45-113">To avoid these problems, [!INCLUDE[ssDE](../../../includes/ssde-md.md)] Tuning Advisor tunes a database on a production server by offloading most of the tuning load onto a test server.</span></span> <span data-ttu-id="b7c45-114">Esto lo realiza gracias a la información de configuración del hardware del servidor de producción y sin tener que copiar los datos de dicho servidor al de prueba.</span><span class="sxs-lookup"><span data-stu-id="b7c45-114">It does this by using the production server hardware configuration information and without actually copying the data from the production server to the test server.</span></span> [!INCLUDE[ssDE](../../../includes/ssde-md.md)] <span data-ttu-id="b7c45-115">no copia datos reales del servidor de producción al servidor de prueba.</span><span class="sxs-lookup"><span data-stu-id="b7c45-115">Tuning Advisor does not copy actual data from the production server to the test server.</span></span> <span data-ttu-id="b7c45-116">Solo copia los metadatos y las estadísticas que necesita.</span><span class="sxs-lookup"><span data-stu-id="b7c45-116">It only copies the metadata and necessary statistics.</span></span>

 <span data-ttu-id="b7c45-117">Los siguientes pasos describen el proceso de optimización de una base de datos en un servidor de prueba:</span><span class="sxs-lookup"><span data-stu-id="b7c45-117">The following steps outline the process for tuning a production database on a test server:</span></span>

1.  <span data-ttu-id="b7c45-118">Asegúrese de que el usuario que desea utilizar el servidor de prueba existe en ambos servidores.</span><span class="sxs-lookup"><span data-stu-id="b7c45-118">Make sure that the user who wants to use the test server exists on both servers.</span></span>

     <span data-ttu-id="b7c45-119">Antes de empezar, compruebe que el usuario que quiere utilizar el servidor de prueba para optimizar una base de datos del servidor de producción existe en ambos servidores.</span><span class="sxs-lookup"><span data-stu-id="b7c45-119">Before you start, make sure that the user who wants to use the test server to tune a database on the production server exists on both servers.</span></span> <span data-ttu-id="b7c45-120">Para ello deberá crear el usuario y su inicio de sesión correspondiente en el servidor de prueba.</span><span class="sxs-lookup"><span data-stu-id="b7c45-120">This requires that you create the user and his or her login on the test server.</span></span> <span data-ttu-id="b7c45-121">Si es miembro del rol fijo de servidor **sysadmin** de ambos equipos no es necesario que lleve a cabo este paso.</span><span class="sxs-lookup"><span data-stu-id="b7c45-121">If you are a member of the **sysadmin** fixed server role on both computers, this step is not necessary.</span></span>

2.  <span data-ttu-id="b7c45-122">Optimice la carga de trabajo en el servidor de prueba.</span><span class="sxs-lookup"><span data-stu-id="b7c45-122">Tune the workload on the test server.</span></span>

     <span data-ttu-id="b7c45-123">Para optimizar la carga de trabajo en un servidor de prueba se necesita un archivo de entrada XML que debe ejecutarse con la utilidad de la línea de comandos **dta** .</span><span class="sxs-lookup"><span data-stu-id="b7c45-123">To tune a workload on a test server, you must use an XML input file with the **dta** command-line utility.</span></span> <span data-ttu-id="b7c45-124">En el archivo de entrada XML, especifique el nombre del servidor de prueba mediante el subelemento **TestServer** además de especificar los valores del resto de los subelementos en el elemento principal **TuningOptions** .</span><span class="sxs-lookup"><span data-stu-id="b7c45-124">In the XML input file, specify the name of your test server with the **TestServer** subelement in addition to specifying the values for the other subelements under the **TuningOptions** parent element.</span></span>

     <span data-ttu-id="b7c45-125">Durante el proceso de optimización, el Asistente para la optimización de motor de base de datos crea una base de datos de shell en el servidor de prueba.</span><span class="sxs-lookup"><span data-stu-id="b7c45-125">During the tuning process, Database Engine Tuning Advisor creates a shell database on the test server.</span></span> <span data-ttu-id="b7c45-126">Para crear y optimizar esta base de datos, el Asistente para la optimización de motor de base de datos efectúa llamadas al servidor de producción para poder llevar a cabo los pasos que se indican a continuación:</span><span class="sxs-lookup"><span data-stu-id="b7c45-126">To create this shell database and tune it, Database Engine Tuning Advisor makes calls to the production server for the following:</span></span>

    1.  [!INCLUDE[ssDE](../../../includes/ssde-md.md)] <span data-ttu-id="b7c45-127">importa los metadatos de la base de datos de producción en la base de datos de shell del servidor de pruebas.</span><span class="sxs-lookup"><span data-stu-id="b7c45-127">Tuning Advisor imports metadata from the production database to the test server shell database.</span></span> <span data-ttu-id="b7c45-128">Los metadatos incluyen tablas vacías, índices, vistas, procedimientos almacenados, desencadenadores, etc.</span><span class="sxs-lookup"><span data-stu-id="b7c45-128">This metadata includes empty tables, indexes, views, stored procedures, triggers, and so on.</span></span> <span data-ttu-id="b7c45-129">Este paso permite ejecutar las consultas de carga de trabajo en la base de datos de shell del servidor de prueba.</span><span class="sxs-lookup"><span data-stu-id="b7c45-129">This makes it possible for the workload queries to execute against the test server shell database.</span></span>

    2.  [!INCLUDE[ssDE](../../../includes/ssde-md.md)] <span data-ttu-id="b7c45-130">importa las estadísticas del servidor de producción para que el optimizador de consultas pueda optimizar con precisión las consultas en el servidor de prueba.</span><span class="sxs-lookup"><span data-stu-id="b7c45-130">Tuning Advisor imports statistics from the production server so the query optimizer can accurately optimize queries on the test server.</span></span>

    3.  [!INCLUDE[ssDE](../../../includes/ssde-md.md)] <span data-ttu-id="b7c45-131">importa los parámetros de hardware y especifica el número de procesadores y memoria disponible del servidor de producción a fin de suministrar al optimizador de consultas la información que requiere para generar un plan de consulta.</span><span class="sxs-lookup"><span data-stu-id="b7c45-131">Tuning Advisor imports hardware parameters specifying the number of processors and available memory from the production server to provide the query optimizer with the information it needs to generate a query plan.</span></span>

3.  <span data-ttu-id="b7c45-132">Una vez que el Asistente para la optimización de [!INCLUDE[ssDE](../../../includes/ssde-md.md)] ha terminado de ajustar la base de datos de shell del servidor de pruebas, genera una recomendación de optimización.</span><span class="sxs-lookup"><span data-stu-id="b7c45-132">After [!INCLUDE[ssDE](../../../includes/ssde-md.md)] Tuning Advisor finishes tuning the test server shell database, it generates a tuning recommendation.</span></span>

4.  <span data-ttu-id="b7c45-133">Aplique la recomendación recibida del servidor de prueba en el servidor de producción.</span><span class="sxs-lookup"><span data-stu-id="b7c45-133">Apply the recommendation received from tuning the test server to the production server.</span></span>

 <span data-ttu-id="b7c45-134">La siguiente ilustración representa el escenario de los servidores de prueba y producción:</span><span class="sxs-lookup"><span data-stu-id="b7c45-134">The following illustration shows the test server and production server scenario:</span></span>

 <span data-ttu-id="b7c45-135">![Uso del servidor de prueba del Asistente para la optimización de motor de base de datos](../../database-engine/media/testsvr.gif "Uso del servidor de prueba del Asistente para la optimización de motor de base de datos")</span><span class="sxs-lookup"><span data-stu-id="b7c45-135">![Database Engine Tuning Advisor test server usage](../../database-engine/media/testsvr.gif "Database Engine Tuning Advisor test server usage")</span></span>

> [!NOTE]
>  <span data-ttu-id="b7c45-136">La característica de optimización del servidor de prueba no se admite en la interfaz gráfica de usuario (GUI) del Asistente para la optimización de [!INCLUDE[ssDE](../../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="b7c45-136">The test server tuning feature is not supported in the [!INCLUDE[ssDE](../../../includes/ssde-md.md)] Tuning Advisor graphical user interface (GUI).</span></span>

## <a name="example"></a><span data-ttu-id="b7c45-137">Ejemplo</span><span class="sxs-lookup"><span data-stu-id="b7c45-137">Example</span></span>
 <span data-ttu-id="b7c45-138">Asegúrese primero de que el usuario que desea realizar la optimización existe tanto en el servidor de prueba como en el de producción.</span><span class="sxs-lookup"><span data-stu-id="b7c45-138">First, make sure that the user who wants to perform the tuning exists on both the test and production servers.</span></span>

 <span data-ttu-id="b7c45-139">Después de copiar la información del usuario al servidor de pruebas, puede definir la sesión de optimización del mismo en el archivo de entrada XML del Asistente para la optimización de [!INCLUDE[ssDE](../../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="b7c45-139">After the user information is copied over to your test server, you can define your test server tuning session in the [!INCLUDE[ssDE](../../../includes/ssde-md.md)] Tuning Advisor XML input file.</span></span> <span data-ttu-id="b7c45-140">El siguiente archivo de entrada XML de ejemplo muestra cómo especificar un servidor de pruebas para optimizar una base de datos con el Asistente para la optimización de [!INCLUDE[ssDE](../../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="b7c45-140">The following example XML input file illustrates how to specify a test server to tune a database with [!INCLUDE[ssDE](../../../includes/ssde-md.md)] Tuning Advisor.</span></span>

 <span data-ttu-id="b7c45-141">En este ejemplo se optimiza la base de datos `MyDatabaseName` en `MyServerName`.</span><span class="sxs-lookup"><span data-stu-id="b7c45-141">In this example, the `MyDatabaseName` database is being tuned on `MyServerName`.</span></span> <span data-ttu-id="b7c45-142">Como carga de trabajo se utiliza un script [!INCLUDE[tsql](../../includes/tsql-md.md)] , `MyWorkloadScript.sql`.</span><span class="sxs-lookup"><span data-stu-id="b7c45-142">The [!INCLUDE[tsql](../../includes/tsql-md.md)] script, `MyWorkloadScript.sql`, is used as the workload.</span></span> <span data-ttu-id="b7c45-143">Esta carga de trabajo contiene eventos que se ejecutarán en `MyDatabaseName`.</span><span class="sxs-lookup"><span data-stu-id="b7c45-143">This workload contains events that execute against `MyDatabaseName`.</span></span> <span data-ttu-id="b7c45-144">La mayoría de las llamadas del optimizador de consultas a esta base de datos, llamadas que forman parte del proceso de optimización, se gestionan desde la base de datos de shell en el servidor `MyTestServerName`.</span><span class="sxs-lookup"><span data-stu-id="b7c45-144">Most of the query optimizer calls to this database, which occur as part of the tuning process, are handled by the shell database that resides on `MyTestServerName`.</span></span> <span data-ttu-id="b7c45-145">La base de datos de shell se compone de metadatos y estadísticas.</span><span class="sxs-lookup"><span data-stu-id="b7c45-145">The shell database is composed of metadata and statistics.</span></span> <span data-ttu-id="b7c45-146">Al aplicar el proceso se descarga al servidor de prueba el impacto en el rendimiento que causa la optimización.</span><span class="sxs-lookup"><span data-stu-id="b7c45-146">This process results in the tuning overhead being offloaded to the test server.</span></span> <span data-ttu-id="b7c45-147">Cuando el Asistente para la optimización de [!INCLUDE[ssDE](../../../includes/ssde-md.md)] genera la recomendación de optimización con este archivo de entrada XML, éste debería considerar únicamente los índices (`<FeatureSet>IDX</FeatureSet>`), pero no las particiones y tampoco precisa mantener ninguna de las estructuras de diseño físicas existentes en `MyDatabaseName`.</span><span class="sxs-lookup"><span data-stu-id="b7c45-147">When [!INCLUDE[ssDE](../../../includes/ssde-md.md)] Tuning Advisor generates its tuning recommendation using this XML input file, it should consider indexes only (`<FeatureSet>IDX</FeatureSet>`), no partitioning, and need not keep any of the existing physical design structures in `MyDatabaseName`.</span></span>

```
<?xml version="1.0" encoding="utf-16" ?>
<DTAXML xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="https://schemas.microsoft.com/sqlserver/2004/07/dta">
  <DTAInput>
    <Server>
      <Name>MyServerName</Name>
      <Database>
        <Name>MyDatabaseName</Name>
      </Database>
    </Server>
    <Workload>
      <File>MyWorkloadScript.sql</File>
    </Workload>
    <TuningOptions>
      <TestServer>MyTestServerName</TestServer>
      <FeatureSet>IDX</FeatureSet>
      <Partitioning>NONE</Partitioning>
      <KeepExisting>NONE</KeepExisting>
    </TuningOptions>
  </DTAInput>
</DTAXML>
```

## <a name="see-also"></a><span data-ttu-id="b7c45-148">Consulte también</span><span class="sxs-lookup"><span data-stu-id="b7c45-148">See Also</span></span>
 <span data-ttu-id="b7c45-149">[Consideraciones sobre el uso de los servidores de prueba referencia de](considerations-for-using-test-servers.md) [archivo de entrada XML &#40;Asistente para la optimización de motor de base de datos&#41;](database-engine-tuning-advisor.md)</span><span class="sxs-lookup"><span data-stu-id="b7c45-149">[Considerations for Using Test Servers](considerations-for-using-test-servers.md) [XML Input File Reference &#40;Database Engine Tuning Advisor&#41;](database-engine-tuning-advisor.md)</span></span>


