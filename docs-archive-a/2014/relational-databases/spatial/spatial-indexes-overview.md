---
title: Información general sobre los índices espaciales | Microsoft Docs
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- spatial indexes [SQL Server]
ms.assetid: b1ae7b78-182a-459e-ab28-f743e43f8293
author: MladjoA
ms.author: mlandzic
ms.openlocfilehash: 36406bd60b4204469aca3d20862020870a8832fe
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87674055"
---
# <a name="spatial-indexes-overview"></a><span data-ttu-id="6da2f-102">Información general sobre los índices espaciales</span><span class="sxs-lookup"><span data-stu-id="6da2f-102">Spatial Indexes Overview</span></span>
  [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="6da2f-103">admite datos espaciales e índices espaciales.</span><span class="sxs-lookup"><span data-stu-id="6da2f-103">supports spatial data and spatial indexes.</span></span> <span data-ttu-id="6da2f-104">Un *índice espacial* es un tipo de índice extendido que permite indizar una columna espacial.</span><span class="sxs-lookup"><span data-stu-id="6da2f-104">A *spatial index* is a type of extended index that allows you to index a spatial column.</span></span> <span data-ttu-id="6da2f-105">Una columna espacial es una columna de tabla que contiene datos de un tipo espacial, como `geometry` o `geography`.</span><span class="sxs-lookup"><span data-stu-id="6da2f-105">A spatial column is a table column that contains data of a spatial data type, such as `geometry` or `geography`.</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="6da2f-106">Para obtener una descripción detallada y ejemplos de las nuevas características espaciales de [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)], incluidas las características que afectan a los índices espaciales, descargue las notas del producto [Nuevas características espaciales de SQL Server 2012](https://go.microsoft.com/fwlink/?LinkId=226407).</span><span class="sxs-lookup"><span data-stu-id="6da2f-106">For a detailed description and examples of spatial features introduced in [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)], including features that affect spatial indexes, download the white paper, [New Spatial Features in SQL Server 2012](https://go.microsoft.com/fwlink/?LinkId=226407).</span></span>

##  <a name="about-spatial-indexes"></a><a name="about"></a> <span data-ttu-id="6da2f-107">Acerca de los índices espaciales</span><span class="sxs-lookup"><span data-stu-id="6da2f-107">About Spatial Indexes</span></span>

###  <a name="decomposing-indexed-space-into-a-grid-hierarchy"></a><a name="decompose"></a> <span data-ttu-id="6da2f-108">Descomponer espacio indizado en una jerarquía de cuadrículas</span><span class="sxs-lookup"><span data-stu-id="6da2f-108">Decomposing Indexed Space into a Grid Hierarchy</span></span>
 <span data-ttu-id="6da2f-109">En [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], los índices espaciales se generan usando árboles B, es decir, los índices deben representar los datos espaciales bidimensionales en el orden lineal de los árboles B.</span><span class="sxs-lookup"><span data-stu-id="6da2f-109">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], spatial indexes are built using B-trees, which means that the indexes must represent the 2-dimensional spatial data in the linear order of B-trees.</span></span> <span data-ttu-id="6da2f-110">Por consiguiente, antes de leer los datos en un índice espacial, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] implementa una descomposición uniforme jerárquica de espacio.</span><span class="sxs-lookup"><span data-stu-id="6da2f-110">Therefore, before reading data into a spatial index, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] implements a hierarchical uniform decomposition of space.</span></span> <span data-ttu-id="6da2f-111">El proceso de creación de índices *descompone* el espacio en una *jerarquía de cuadrículas*de cuatro niveles.</span><span class="sxs-lookup"><span data-stu-id="6da2f-111">The index-creation process *decomposes* the space into a four-level *grid hierarchy*.</span></span> <span data-ttu-id="6da2f-112">Estos niveles se conocen como *nivel 1* (el nivel superior), *nivel 2*, *nivel 3*y *nivel 4*.</span><span class="sxs-lookup"><span data-stu-id="6da2f-112">These levels are referred to as *level 1* (the top level), *level 2*, *level 3*, and *level 4*.</span></span>

 <span data-ttu-id="6da2f-113">Cada nivel sucesivo descompone el nivel superior, de manera que cada celda de nivel superior contiene una cuadrícula completa en el nivel siguiente.</span><span class="sxs-lookup"><span data-stu-id="6da2f-113">Each successive level further decomposes the level above it, so each upper-level cell contains a complete grid at the next level.</span></span> <span data-ttu-id="6da2f-114">En un nivel determinado, todas las cuadrículas tienen el mismo número de celdas a lo largo de ambos ejes (por ejemplo, 4x4 o 8x8) y las celdas son todas del mismo tamaño.</span><span class="sxs-lookup"><span data-stu-id="6da2f-114">On a given level, all the grids have the same number of cells along both axes (for example, 4x4 or 8x8), and the cells are all one size.</span></span>

 <span data-ttu-id="6da2f-115">La ilustración siguiente muestra la descomposición para la celda superior derecha en cada nivel de la jerarquía de cuadrículas en una cuadrícula 4x4.</span><span class="sxs-lookup"><span data-stu-id="6da2f-115">The following illustration shows the decomposition for the upper-right cell at each level of the grid hierarchy into a 4x4 grid.</span></span> <span data-ttu-id="6da2f-116">En realidad, todas las celdas se descomponen de esta manera.</span><span class="sxs-lookup"><span data-stu-id="6da2f-116">In reality, all the cells are decomposed in this way.</span></span> <span data-ttu-id="6da2f-117">Así, por ejemplo, la descomposición de un espacio en cuatro niveles de cuadrículas 4x4 produce realmente un total de 65.536 celdas de cuatro niveles.</span><span class="sxs-lookup"><span data-stu-id="6da2f-117">Thus, for example, decomposing a space into four levels of 4x4 grids actually produces a total of 65,536 level-four cells.</span></span>

 <span data-ttu-id="6da2f-118">![Cuatro niveles de teselación recursiva](../../database-engine/media/spndx-recursive-levels-telescoped.gif "Cuatro niveles de teselación recursiva")</span><span class="sxs-lookup"><span data-stu-id="6da2f-118">![Four-levels of recursive tessellation](../../database-engine/media/spndx-recursive-levels-telescoped.gif "Four-levels of recursive tessellation")</span></span>

> [!NOTE]
>  <span data-ttu-id="6da2f-119">La descomposición de espacio de un índice espacial es independiente de la unidad de medida que el dato de aplicación usa.</span><span class="sxs-lookup"><span data-stu-id="6da2f-119">The decomposition of space for a spatial index is independent of the unit of measurement that the application data uses.</span></span>

 <span data-ttu-id="6da2f-120">Las celdas de una jerarquía de cuadrícula se enumeran de un modo lineal usando una variación de la curva de rellenado de espacio Hilbert.</span><span class="sxs-lookup"><span data-stu-id="6da2f-120">Grid hierarchy cells are numbered in a linear fashion by using a variation of the Hilbert space-filling curve.</span></span> <span data-ttu-id="6da2f-121">Para esta ilustración, sin embargo, esta discusión usa una numeración de modo de fila simple, en lugar de la numeración realmente generada por la curva de Hilbert.</span><span class="sxs-lookup"><span data-stu-id="6da2f-121">For the purpose of illustration, however, this discussion uses a simple row-wise numbering, instead of the numbering that is actually produced by the Hilbert curve.</span></span> <span data-ttu-id="6da2f-122">En la ilustración siguiente, ya se han colocado varios polígonos que representan edificios y líneas que representan calles en una cuadrícula de nivel 1 4x4.</span><span class="sxs-lookup"><span data-stu-id="6da2f-122">In the following illustration, several polygons that represent buildings, and lines that represent streets, have already been placed into a 4x4, level-1 grid.</span></span> <span data-ttu-id="6da2f-123">Las celdas de nivel 1 se numeran del 1 al 16, comenzando por la celda superior izquierda.</span><span class="sxs-lookup"><span data-stu-id="6da2f-123">The level-1 cells are numbered from 1 through 16, starting with the upper-left cell.</span></span>

 <span data-ttu-id="6da2f-124">![Polígonos y líneas colocados en una cuadrícula de nivel 1 4x4](../../database-engine/media/spndx-level-1-objects.gif "Polígonos y líneas colocados en una cuadrícula de nivel 1 4x4")</span><span class="sxs-lookup"><span data-stu-id="6da2f-124">![Polygons and lines placed into a 4x4 level-1 grid](../../database-engine/media/spndx-level-1-objects.gif "Polygons and lines placed into a 4x4 level-1 grid")</span></span>

#### <a name="grid-density"></a><span data-ttu-id="6da2f-125">Densidad de cuadrícula</span><span class="sxs-lookup"><span data-stu-id="6da2f-125">Grid Density</span></span>
 <span data-ttu-id="6da2f-126">El número de celdas a lo largo de los ejes de una cuadrícula determina su *densidad*: cuanto mayor sea el número, más densa será la cuadrícula.</span><span class="sxs-lookup"><span data-stu-id="6da2f-126">The number of cells along the axes of a grid determines its *density*: the larger the number, the denser the grid.</span></span> <span data-ttu-id="6da2f-127">Por ejemplo, una cuadrícula 8x8 (que genera 64 celdas), es más densa que una cuadrícula 4x4 (que genera 16 celdas).</span><span class="sxs-lookup"><span data-stu-id="6da2f-127">For example, an 8x8 grid (which produces 64 cells), is denser than a 4x4 grid (which produces 16 cells).</span></span> <span data-ttu-id="6da2f-128">La densidad de cuadrícula se define por nivel.</span><span class="sxs-lookup"><span data-stu-id="6da2f-128">Grid density is defined on a per-level basis.</span></span>

 <span data-ttu-id="6da2f-129">La instrucción [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql)[!INCLUDE[tsql](../../../includes/tsql-md.md)] admite una cláusula GRIDS que le permite especificar las densidades de cuadrícula diferentes en niveles diferentes.</span><span class="sxs-lookup"><span data-stu-id="6da2f-129">The [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql)[!INCLUDE[tsql](../../../includes/tsql-md.md)] statement supports a GRIDS clause that enables you to specify different grid densities at different levels.</span></span> <span data-ttu-id="6da2f-130">La densidad de cuadrícula para un nivel determinado se especifica con una de las palabras clave siguientes.</span><span class="sxs-lookup"><span data-stu-id="6da2f-130">The grid density for a given level is specified by using one of the following keywords.</span></span>

|<span data-ttu-id="6da2f-131">Palabra clave</span><span class="sxs-lookup"><span data-stu-id="6da2f-131">Keyword</span></span>|<span data-ttu-id="6da2f-132">Configuración de cuadrícula</span><span class="sxs-lookup"><span data-stu-id="6da2f-132">Grid configuration</span></span>|<span data-ttu-id="6da2f-133">Número de celdas</span><span class="sxs-lookup"><span data-stu-id="6da2f-133">Number of cells</span></span>|
|-------------|------------------------|---------------------|
|<span data-ttu-id="6da2f-134">LOW</span><span class="sxs-lookup"><span data-stu-id="6da2f-134">LOW</span></span>|<span data-ttu-id="6da2f-135">4X4</span><span class="sxs-lookup"><span data-stu-id="6da2f-135">4X4</span></span>|<span data-ttu-id="6da2f-136">16</span><span class="sxs-lookup"><span data-stu-id="6da2f-136">16</span></span>|
|<span data-ttu-id="6da2f-137">MEDIUM</span><span class="sxs-lookup"><span data-stu-id="6da2f-137">MEDIUM</span></span>|<span data-ttu-id="6da2f-138">8X8</span><span class="sxs-lookup"><span data-stu-id="6da2f-138">8X8</span></span>|<span data-ttu-id="6da2f-139">64</span><span class="sxs-lookup"><span data-stu-id="6da2f-139">64</span></span>|
|<span data-ttu-id="6da2f-140">HIGH</span><span class="sxs-lookup"><span data-stu-id="6da2f-140">HIGH</span></span>|<span data-ttu-id="6da2f-141">16X16</span><span class="sxs-lookup"><span data-stu-id="6da2f-141">16X16</span></span>|<span data-ttu-id="6da2f-142">256</span><span class="sxs-lookup"><span data-stu-id="6da2f-142">256</span></span>|

 <span data-ttu-id="6da2f-143">En [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], cuando el nivel de compatibilidad de la base de datos se establece en 100 o menos, el valor predeterminado es MEDIUM en todos los niveles.</span><span class="sxs-lookup"><span data-stu-id="6da2f-143">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], when the database compatibility level is set to 100 or lower, then the default is MEDIUM on all levels.</span></span> <span data-ttu-id="6da2f-144">Cuando el nivel de compatibilidad de la base de datos se establece en 110 o más, el valor predeterminado es un esquema de cuadrícula automática.</span><span class="sxs-lookup"><span data-stu-id="6da2f-144">When the database compatibility level is set to 110 or higher, then the default is an auto grid scheme.</span></span>

 <span data-ttu-id="6da2f-145">Puede controlar el proceso de descomposición especificando densidades de cuadrícula no predeterminadas.</span><span class="sxs-lookup"><span data-stu-id="6da2f-145">You can control the decomposition process by specifying non-default grid densities.</span></span> <span data-ttu-id="6da2f-146">Por ejemplo, quizá sean útiles diferentes densidades de cuadrícula en niveles distintos para ajustar correctamente un índice basado en el tamaño del espacio indizado y los objetos de la columna espacial.</span><span class="sxs-lookup"><span data-stu-id="6da2f-146">For example, different grid densities on different levels might be useful for fine tuning an index based on the size of the indexed space and the objects in the spatial column.</span></span>

> [!NOTE]
>  <span data-ttu-id="6da2f-147">Las densidades de cuadrícula de un índice espacial se ven en las columnas level_1_grid, level_2_grid, level_3_grid y level_4_grid de la vista de catálogo [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) cuando el nivel de compatibilidad de la base de datos se establece en 100 o menos.</span><span class="sxs-lookup"><span data-stu-id="6da2f-147">The grid densities of a spatial index are visible in the level_1_grid, level_2_grid, level_3_grid, and level_4_grid columns of the [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) catalog view when the database compatibility level is set to 100 or lower.</span></span> <span data-ttu-id="6da2f-148">Las `GEOMETRY_AUTO_GRID` / `GEOGRAPHY_AUTO_GRID` Opciones del esquema de teselación no rellenan estas columnas.</span><span class="sxs-lookup"><span data-stu-id="6da2f-148">The `GEOMETRY_AUTO_GRID`/`GEOGRAPHY_AUTO_GRID` tessellation scheme options do not populate these columns.</span></span> <span data-ttu-id="6da2f-149">la vista de catálogo sys. spatial_index_tessellations tiene `NULL` valores para estas columnas cuando se usan las opciones de cuadrícula automática.</span><span class="sxs-lookup"><span data-stu-id="6da2f-149">sys.spatial_index_tessellations catalog view has `NULL` values for these columns when the auto grid options are used.</span></span>

###  <a name="tessellation"></a><a name="tessellation"></a> <span data-ttu-id="6da2f-150">Teselación</span><span class="sxs-lookup"><span data-stu-id="6da2f-150">Tessellation</span></span>
 <span data-ttu-id="6da2f-151">Después de la descomposición de un espacio indizado en una jerarquía de cuadrículas, el índice espacial lee los datos de la columna espacial, fila por fila.</span><span class="sxs-lookup"><span data-stu-id="6da2f-151">After decomposition of an indexed space into a grid hierarchy, the spatial index reads the data from the spatial column, row by row.</span></span> <span data-ttu-id="6da2f-152">Después de leer los datos para un objeto espacial (o instancia), el índice espacial realiza un *proceso de teselación* para dicho objeto.</span><span class="sxs-lookup"><span data-stu-id="6da2f-152">After reading the data for a spatial object (or instance), the spatial index performs a *tessellation process* for that object.</span></span> <span data-ttu-id="6da2f-153">El proceso de teselación ajusta el objeto en la jerarquía de cuadrículas asociándolo a un conjunto de celdas de cuadrícula que modifique (*celdas modificadas*).</span><span class="sxs-lookup"><span data-stu-id="6da2f-153">The tessellation processfits the object into the grid hierarchy by associating the object with a set of grid cells that it touches (*touched cells*).</span></span> <span data-ttu-id="6da2f-154">Comenzando por el nivel 1 de la jerarquía de cuadrículas, el proceso de teselación continúa por el nivel *primero a lo ancho* .</span><span class="sxs-lookup"><span data-stu-id="6da2f-154">Starting at level 1 of the grid hierarchy, the tessellation process proceeds *breadth first* across the level.</span></span> <span data-ttu-id="6da2f-155">Potencialmente, el proceso puede continuar a través de los cuatro niveles, un nivel a la vez.</span><span class="sxs-lookup"><span data-stu-id="6da2f-155">Potentially, the process can continue through all four levels, one level at a time.</span></span>

 <span data-ttu-id="6da2f-156">El resultado del proceso de teselación es un conjunto de celdas modificadas que se graban en el índice espacial para el objeto.</span><span class="sxs-lookup"><span data-stu-id="6da2f-156">The output of the tessellation process is a set of touched cells that are recorded in the spatial index for the object.</span></span> <span data-ttu-id="6da2f-157">Haciendo referencia a estas celdas grabadas, el índice espacial puede buscar el objeto en el espacio relativo a otros objetos de la columna espacial también almacenados en el índice.</span><span class="sxs-lookup"><span data-stu-id="6da2f-157">By referring to these recorded cells, the spatial index can locate the object in space relative to other objects in the spatial column that are also stored in the index.</span></span>

#### <a name="tessellation-rules"></a><span data-ttu-id="6da2f-158">Reglas de teselación</span><span class="sxs-lookup"><span data-stu-id="6da2f-158">Tessellation Rules</span></span>
 <span data-ttu-id="6da2f-159">Para limitar el número de celdas modificadas que se graban para un objeto, el proceso teselación aplica varias reglas de teselación.</span><span class="sxs-lookup"><span data-stu-id="6da2f-159">To limit the number of touched cells that are recorded for an object, the tessellation process applies several tessellation rules.</span></span> <span data-ttu-id="6da2f-160">Estas reglas determinan la profundidad del proceso de teselación y cuáles de las celdas modificadas se graban en el índice.</span><span class="sxs-lookup"><span data-stu-id="6da2f-160">These rules determine the depth of the tessellation process and which of the touched cells are recorded in the index.</span></span>

 <span data-ttu-id="6da2f-161">Estas reglas son:</span><span class="sxs-lookup"><span data-stu-id="6da2f-161">These rules are as follows:</span></span>

-   <span data-ttu-id="6da2f-162">La regla de cobertura</span><span class="sxs-lookup"><span data-stu-id="6da2f-162">The covering rule</span></span>

     <span data-ttu-id="6da2f-163">Si el objeto cubre una celda por completo, se dice que dicha celda está *cubierta* por el objeto.</span><span class="sxs-lookup"><span data-stu-id="6da2f-163">If the object completely covers a cell, that cell is said to be *covered* by the object.</span></span> <span data-ttu-id="6da2f-164">Se cuenta una celda cubierta y no se aplica la teselación.</span><span class="sxs-lookup"><span data-stu-id="6da2f-164">A covered cell is counted and is not tessellated.</span></span> <span data-ttu-id="6da2f-165">Esta regla se aplica a todos los niveles de la jerarquía de cuadrículas.</span><span class="sxs-lookup"><span data-stu-id="6da2f-165">This rule applies at all levels of the grid hierarchy.</span></span> <span data-ttu-id="6da2f-166">La regla de cobertura simplifica el proceso de teselación y reduce la cantidad de datos que un índice espacial registra.</span><span class="sxs-lookup"><span data-stu-id="6da2f-166">The covering rule simplifies the tessellation process and reduces the amount of data that a spatial index records.</span></span>

-   <span data-ttu-id="6da2f-167">La regla de celdas por proyecto</span><span class="sxs-lookup"><span data-stu-id="6da2f-167">The cells-per-object rule</span></span>

     <span data-ttu-id="6da2f-168">Esta regla exige el *límite de celdas por proyecto*, que determina el número máximo de celdas que se pueden contar para cada objeto, excepto en el nivel 1.</span><span class="sxs-lookup"><span data-stu-id="6da2f-168">This rule enforces the *cells-per-object limit*, which determines the maximum number of cells that can be counted for each object, except on level 1.</span></span> <span data-ttu-id="6da2f-169">En los niveles inferiores, la regla de celdas por proyecto controla la cantidad de información que se puede grabar sobre el objeto.</span><span class="sxs-lookup"><span data-stu-id="6da2f-169">At lower levels, the cells-per-object rule controls the amount of information that can be recorded about the object.</span></span>

-   <span data-ttu-id="6da2f-170">La regla de celda más profunda</span><span class="sxs-lookup"><span data-stu-id="6da2f-170">The deepest-cell rule</span></span>

     <span data-ttu-id="6da2f-171">La regla de celda más profunda genera la mejor aproximación de un objeto grabando solo las únicas celdas de la parte más inferior que se han teselado para el objeto.</span><span class="sxs-lookup"><span data-stu-id="6da2f-171">The deepest-cell rule generates the best approximation of an object by recording only the bottom-most cells that have been tessellated for the object.</span></span> <span data-ttu-id="6da2f-172">Las celdas principales no contribuyen al recuento de celdas por objeto y no se graban en el índice.</span><span class="sxs-lookup"><span data-stu-id="6da2f-172">Parent cells do not contribute to the cells-per-object count, and they are not recorded in the index.</span></span>

 <span data-ttu-id="6da2f-173">Estas reglas de teselación se aplican en cada nivel de cuadrícula de forma recursiva.</span><span class="sxs-lookup"><span data-stu-id="6da2f-173">These tessellation rules are applied recursively on each grid level.</span></span> <span data-ttu-id="6da2f-174">El resto de esta sección describe las reglas de teselación con más detalle.</span><span class="sxs-lookup"><span data-stu-id="6da2f-174">The rest of this section describes the tessellation rules in more detail.</span></span>

#### <a name="covering-rule"></a><span data-ttu-id="6da2f-175">Regla de cobertura</span><span class="sxs-lookup"><span data-stu-id="6da2f-175">Covering Rule</span></span>
 <span data-ttu-id="6da2f-176">Si un objeto cubre una celda por completo, se dice que dicha celda está *cubierta* por el objeto.</span><span class="sxs-lookup"><span data-stu-id="6da2f-176">If an object completely covers a cell, that cell is said to be *covered* by the object.</span></span> <span data-ttu-id="6da2f-177">Por ejemplo, en la ilustración siguiente, una de las celdas de segundo nivel, 15.11, está cubierta completamente por la parte media de un octágono.</span><span class="sxs-lookup"><span data-stu-id="6da2f-177">For example, in the following illustration, one of the second-level cells, 15.11, is completely covered by the middle portion of an octagon.</span></span>

 <span data-ttu-id="6da2f-178">![Optimización de cobertura](../../database-engine/media/spndx-opt-covering.gif "Optimización de cobertura")</span><span class="sxs-lookup"><span data-stu-id="6da2f-178">![Covering optimization](../../database-engine/media/spndx-opt-covering.gif "Covering optimization")</span></span>

 <span data-ttu-id="6da2f-179">Se cuenta una celda cubierta y se graba en el índice, y la celda no se divide más en mosaicos.</span><span class="sxs-lookup"><span data-stu-id="6da2f-179">A covered cell is counted and recorded in the index, and the cell is not tessellated any further.</span></span>

#### <a name="cells-per-object-rule"></a><span data-ttu-id="6da2f-180">Regla de celdas por proyecto</span><span class="sxs-lookup"><span data-stu-id="6da2f-180">Cells-Per-Object Rule</span></span>
 <span data-ttu-id="6da2f-181">El nivel de teselación de cada objeto depende principalmente del *límite de celdas por proyecto* del índice espacial.</span><span class="sxs-lookup"><span data-stu-id="6da2f-181">The extent of tessellation of each object depends primarily on the *cells-per-object limit* of the spatial index.</span></span> <span data-ttu-id="6da2f-182">Este límite define el número máximo de celdas que la teselación puede contar por objeto.</span><span class="sxs-lookup"><span data-stu-id="6da2f-182">This limit defines the maximum number of cells that tessellation can count per object.</span></span> <span data-ttu-id="6da2f-183">Sin embargo, tenga en cuenta que la regla de celdas por proyecto no se exige para el nivel 1, de modo que es posible superar este límite.</span><span class="sxs-lookup"><span data-stu-id="6da2f-183">Note, however, that the cells-per-object rule is not enforced for level 1, so it is possible to exceed this limit.</span></span> <span data-ttu-id="6da2f-184">Si el recuento del nivel 1 alcanza, o supera, el límite de celdas por objeto, no se produce más teselación en los niveles inferiores.</span><span class="sxs-lookup"><span data-stu-id="6da2f-184">If the level-1 count reaches, or exceeds, the cells-per-object limit, no further tessellation occurs at the lower levels.</span></span>

 <span data-ttu-id="6da2f-185">Siempre que el recuento sea menor que el límite de celdas por proyecto, el proceso de teselación continúa.</span><span class="sxs-lookup"><span data-stu-id="6da2f-185">As long as the count is less than the cells-per-object limit, the tessellation process continues.</span></span> <span data-ttu-id="6da2f-186">Empezando por la celda modificada de número inferior (por ejemplo, la celda 15.6 de la ilustración anterior), el proceso prueba todas las celdas para evaluar si contarlas o dividirlas en mosaicos.</span><span class="sxs-lookup"><span data-stu-id="6da2f-186">Starting with the lowest-number touched cell (for example, cell 15.6 in the preceding illustration), the process tests each cell to evaluate whether to count it or tessellate it.</span></span> <span data-ttu-id="6da2f-187">Si con la teselación de una celda se superaría el límite de celdas por proyecto, se cuenta la celda y no se realiza su teselación.</span><span class="sxs-lookup"><span data-stu-id="6da2f-187">If tessellating a cell would exceed the cells-per-object limit, the cell is counted and not tessellated.</span></span> <span data-ttu-id="6da2f-188">De lo contrario, la celda se divide en mosaicos y se cuentan las celdas de nivel inferior modificadas por el objeto.</span><span class="sxs-lookup"><span data-stu-id="6da2f-188">Otherwise, the cell is tessellated, and the lower-level cells that are touched by the object are counted.</span></span> <span data-ttu-id="6da2f-189">El proceso de teselación continúa de esta manera, en toda la amplitud, por el nivel.</span><span class="sxs-lookup"><span data-stu-id="6da2f-189">The tessellation process continues in this way, breadth-wise, across the level.</span></span> <span data-ttu-id="6da2f-190">Este proceso se repite recursivamente para las cuadrículas de nivel inferior de las celdas divididas en mosaicos hasta que se alcanza el límite o no hay más celdas que contar.</span><span class="sxs-lookup"><span data-stu-id="6da2f-190">This process is repeated recursively for the lower-level grids of the tessellated cells until the limit is reached or there are no more cells to count.</span></span>

 <span data-ttu-id="6da2f-191">Por ejemplo, piense en la ilustración anterior, que muestra un octágono que se ajusta por completo a la celda 15 de la cuadrícula de nivel 1.</span><span class="sxs-lookup"><span data-stu-id="6da2f-191">For example, consider the preceding illustration, which shows an octagon that fits completely into cell 15 of the level-1 grid.</span></span> <span data-ttu-id="6da2f-192">En la ilustración, se ha realizado la teselación en la celda 15, diseccionando el octágono en nueve celdas de nivel 2.</span><span class="sxs-lookup"><span data-stu-id="6da2f-192">In the figure, cell 15 has been tessellated, dissecting the octagon into nine level-2 cells.</span></span> <span data-ttu-id="6da2f-193">Esta ilustración supone que el límite de celdas por proyecto es 9 o más.</span><span class="sxs-lookup"><span data-stu-id="6da2f-193">This illustration assumes that the cells-per-object limit is 9 or more.</span></span> <span data-ttu-id="6da2f-194">Sin embargo, si el límite de celdas por proyecto fuera 8 o menos, no se realizaría la teselación en la celda 15 y solo se contaría dicha celda 15 para el objeto.</span><span class="sxs-lookup"><span data-stu-id="6da2f-194">If the cells-per-object limit were 8 or less, however, cell 15 would not be tessellated, and only that cell 15 would be counted for the object.</span></span>

 <span data-ttu-id="6da2f-195">De forma predeterminada, el límite de celdas por proyecto es de 16 celdas por objeto, lo que proporciona un equilibrio satisfactorio entre espacio y precisión para la mayoría de los índices espaciales.</span><span class="sxs-lookup"><span data-stu-id="6da2f-195">By default, the cells-per-object limit is 16 cells per object, which provides a satisfactory trade-off between space and precision for most spatial indexes.</span></span> <span data-ttu-id="6da2f-196">Sin embargo, la instrucción [Create Spatial index](/sql/t-sql/statements/create-spatial-index-transact-sql) [!INCLUDE[tsql](../../../includes/tsql-md.md)] admite una `=` cláusula CELLS_PER_OBJECT*n* que le permite especificar un límite de celdas por objeto entre 1 y 8192, ambos incluidos.</span><span class="sxs-lookup"><span data-stu-id="6da2f-196">However, the [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql)[!INCLUDE[tsql](../../../includes/tsql-md.md)] statement supports a CELLS_PER_OBJECT`=`*n* clause that enables you to specify a cells-per-object limit between 1 and 8192, inclusive.</span></span>

> [!NOTE]
>  <span data-ttu-id="6da2f-197">El valor **cells_per_object** de un índice espacial es visible en la vista de catálogo [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="6da2f-197">The **cells_per_object** setting of a spatial index is visible in the [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) catalog view.</span></span>

#### <a name="deepest-cell-rule"></a><span data-ttu-id="6da2f-198">Regla de celda más profunda</span><span class="sxs-lookup"><span data-stu-id="6da2f-198">Deepest-Cell Rule</span></span>
 <span data-ttu-id="6da2f-199">La regla de celda más profunda se aprovecha del hecho de que todas las celdas de nivel inferior pertenecen a la celda superior: una celda de nivel 4 pertenece a una celda de nivel 3, una celda de nivel 3 pertenece a una celda de nivel 2 y una celda de nivel 2 pertenece a una celda de nivel 1.</span><span class="sxs-lookup"><span data-stu-id="6da2f-199">The deepest-cell rule exploits the fact that every lower-level cell belongs to the cell above it: a level-4 cell belongs to a level-3 cell, a level-3 cell belongs to a level-2 cell, and a level-2 cell belongs to a level-1 cell.</span></span> <span data-ttu-id="6da2f-200">Por ejemplo, un objeto que pertenezca a la celda 1.1.1.1, también pertenece a la celda 1.1.1, a la celda 1.1 y a la celda 1.</span><span class="sxs-lookup"><span data-stu-id="6da2f-200">For example, an object that belongs to cell 1.1.1.1 also belongs to cell 1.1.1, cell 1.1, and cell 1.</span></span> <span data-ttu-id="6da2f-201">El conocimiento de dichas relaciones de jerarquía de celdas está integrado en el procesador de consultas.</span><span class="sxs-lookup"><span data-stu-id="6da2f-201">Knowledge of such cell-hierarchy relationships is built into the query processor.</span></span> <span data-ttu-id="6da2f-202">Por consiguiente, solo las celdas de nivel más profundo se tienen que grabar en el índice, minimizando la información que el índice tiene que almacenar.</span><span class="sxs-lookup"><span data-stu-id="6da2f-202">Therefore, only the deepest-level cells need to be recorded in the index, minimizing the information that the index needs to store.</span></span>

 <span data-ttu-id="6da2f-203">En la ilustración siguiente, un polígono en forma de rombo relativamente pequeño se divide en mosaicos.</span><span class="sxs-lookup"><span data-stu-id="6da2f-203">In the following illustration, a relatively small diamond-shaped polygon is tessellated.</span></span> <span data-ttu-id="6da2f-204">El índice usa el límite de celdas por proyecto predeterminado de 16, que no se alcanza para este objeto pequeño.</span><span class="sxs-lookup"><span data-stu-id="6da2f-204">The index uses the default cells-per-object limit of 16, which is not reached for this small object.</span></span> <span data-ttu-id="6da2f-205">Por lo tanto, la teselación continúa bajando hasta el nivel 4.</span><span class="sxs-lookup"><span data-stu-id="6da2f-205">Therefore, tessellation continues down to level 4.</span></span> <span data-ttu-id="6da2f-206">El polígono reside en las siguientes celdas del nivel 1 hasta el nivel 3: 4, 4.4, 4.4.10 y 4.4.14.</span><span class="sxs-lookup"><span data-stu-id="6da2f-206">The polygon resides in the following level-1 through level-3 cells: 4, 4.4, and 4.4.10 and 4.4.14.</span></span> <span data-ttu-id="6da2f-207">Sin embargo, si se usa la regla de celda más profunda, la teselación solo cuenta las doce celdas del nivel 4: 4.4.10.13-15 y 4.4.14.1-3, 4.4.14.5-7 y 4.4.14.9-11.</span><span class="sxs-lookup"><span data-stu-id="6da2f-207">However, using the deepest-cell rule, the tessellation counts only the twelve level-4 cells: 4.4.10.13-15 and 4.4.14.1-3, 4.4.14.5-7, and 4.4.14.9-11.</span></span>

 <span data-ttu-id="6da2f-208">![Optimización de celda más profunda](../../database-engine/media/spndx-opt-deepest-cell.gif "Optimización de celda más profunda")</span><span class="sxs-lookup"><span data-stu-id="6da2f-208">![Deepest-cell optimization](../../database-engine/media/spndx-opt-deepest-cell.gif "Deepest-cell optimization")</span></span>

###  <a name="tessellation-schemes"></a><a name="schemes"></a> <span data-ttu-id="6da2f-209">Esquemas de teselación</span><span class="sxs-lookup"><span data-stu-id="6da2f-209">Tessellation Schemes</span></span>
 <span data-ttu-id="6da2f-210">El comportamiento de un índice espacial depende en parte de su *esquema de teselación*.</span><span class="sxs-lookup"><span data-stu-id="6da2f-210">The behavior of a spatial index depends partly on its *tessellation scheme*.</span></span> <span data-ttu-id="6da2f-211">El esquema de teselación es el tipo de datos concreto.</span><span class="sxs-lookup"><span data-stu-id="6da2f-211">The tessellation scheme is data-type specific.</span></span> <span data-ttu-id="6da2f-212">En [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], los índices espaciales admiten dos esquemas de teselación:</span><span class="sxs-lookup"><span data-stu-id="6da2f-212">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], spatial indexes support two tessellation schemes:</span></span>

-   <span data-ttu-id="6da2f-213">*Teselación de cuadrícula de geometría*, que es el esquema del `geometry` tipo de datos.</span><span class="sxs-lookup"><span data-stu-id="6da2f-213">*Geometry grid tessellation*, which is the scheme for the `geometry` data type.</span></span>

-   <span data-ttu-id="6da2f-214">*Teselación de cuadrícula de geografía*, que se aplica a las columnas del `geography` tipo de datos.</span><span class="sxs-lookup"><span data-stu-id="6da2f-214">*Geography grid tessellation*, which applies to columns of the `geography` data type.</span></span>

> [!NOTE]
>  <span data-ttu-id="6da2f-215">El valor **tessellation_scheme** de un índice espacial es visible en la vista de catálogo [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="6da2f-215">The **tessellation_scheme** setting of a spatial index is visible in the [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) catalog view.</span></span>

#### <a name="geometry-grid-tessellation-scheme"></a><span data-ttu-id="6da2f-216">Esquema de teselación de cuadrícula de geometría</span><span class="sxs-lookup"><span data-stu-id="6da2f-216">Geometry Grid Tessellation Scheme</span></span>
 <span data-ttu-id="6da2f-217">La teselación GEOMETRY_AUTO_GRID es el esquema de teselación predeterminado para el tipo de datos `geometry` de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] y posterior.</span><span class="sxs-lookup"><span data-stu-id="6da2f-217">GEOMETRY_AUTO_GRID tessellation is the default tessellation scheme for the `geometry` data type for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and later.</span></span>  <span data-ttu-id="6da2f-218">La teselación GEOMETRY_GRID es el único esquema de teselación disponible para los tipos de datos geometry de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="6da2f-218">GEOMETRY_GRID tessellation is the only tessellation scheme available for geometry data types in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="6da2f-219">En esta sección se tratan los aspectos de teselación de cuadrícula de geometría relacionados con trabajar con índices espaciales: métodos compatibles y cuadros de límite.</span><span class="sxs-lookup"><span data-stu-id="6da2f-219">This section discusses aspects of geometry grid tessellation that are relevant to working with spatial indexes: supported methods and bounding boxes.</span></span>

> [!NOTE]
>  <span data-ttu-id="6da2f-220">Puede especificar explícitamente este esquema de teselación con la cláusula USING (GEOMETRY_AUTO_GRID/GEOMETRY_GRID) de la instrucción [Create Spatial index](/sql/t-sql/statements/create-spatial-index-transact-sql) [!INCLUDE[tsql](../../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="6da2f-220">You can explicitly specify this tessellation scheme by using the USING (GEOMETRY_AUTO_GRID/GEOMETRY_GRID) clause of the [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql)[!INCLUDE[tsql](../../../includes/tsql-md.md)] statement.</span></span>

##### <a name="the-bounding-box"></a><span data-ttu-id="6da2f-221">El cuadro de límite</span><span class="sxs-lookup"><span data-stu-id="6da2f-221">The Bounding Box</span></span>
 <span data-ttu-id="6da2f-222">Los datos geométricos ocupan un plano que puede ser infinito.</span><span class="sxs-lookup"><span data-stu-id="6da2f-222">Geometric data occupies a plane that can be infinite.</span></span> <span data-ttu-id="6da2f-223">Sin embargo, en [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], un índice espacial requiere un espacio finito.</span><span class="sxs-lookup"><span data-stu-id="6da2f-223">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], however, a spatial index requires a finite space.</span></span> <span data-ttu-id="6da2f-224">Para establecer un espacio finito para descomposición, el esquema de teselación de cuadrícula de geometría exige un *cuadro de límite*rectangular.</span><span class="sxs-lookup"><span data-stu-id="6da2f-224">To establish a finite space for decomposition, the geometry grid tessellation scheme requires a rectangular *bounding box*.</span></span> <span data-ttu-id="6da2f-225">El cuadro de límite está definido por cuatro coordenadas, `(` _x-min_**, y**_-min_ `)` y `(` _x-MAX_**,**_y-Max_ `)` , que se almacenan como propiedades del índice espacial.</span><span class="sxs-lookup"><span data-stu-id="6da2f-225">The bounding box is defined by four coordinates, `(`_x-min_**,**_y-min_`)` and `(`_x-max_**,**_y-max_`)`, which are stored as properties of the spatial index.</span></span> <span data-ttu-id="6da2f-226">Estas coordenadas representan lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="6da2f-226">These coordinates represent the following:</span></span>

-   <span data-ttu-id="6da2f-227">*x-min* es la coordenada x de la esquina inferior izquierda del cuadro de límite.</span><span class="sxs-lookup"><span data-stu-id="6da2f-227">*x-min* is the x-coordinate of the lower-left corner of the bounding box.</span></span>

-   <span data-ttu-id="6da2f-228">*y-min* es la coordenada y de la esquina inferior izquierda.</span><span class="sxs-lookup"><span data-stu-id="6da2f-228">*y-min* is the y-coordinate of the lower-left corner.</span></span>

-   <span data-ttu-id="6da2f-229">*x-max* es la coordenada x de la esquina superior derecha.</span><span class="sxs-lookup"><span data-stu-id="6da2f-229">*x-max* is the x-coordinate of the upper-right corner.</span></span>

-   <span data-ttu-id="6da2f-230">*y-max* es la coordenada y de la esquina superior derecha.</span><span class="sxs-lookup"><span data-stu-id="6da2f-230">*y-max* is the y-coordinate of upper-right corner.</span></span>

> [!NOTE]
>  <span data-ttu-id="6da2f-231">Estas coordenadas se especifican mediante la cláusula BOUNDING_BOX de la instrucción [Create Spatial index](/sql/t-sql/statements/create-spatial-index-transact-sql) [!INCLUDE[tsql](../../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="6da2f-231">These coordinates are specified by the BOUNDING_BOX clause of the [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql)[!INCLUDE[tsql](../../../includes/tsql-md.md)] statement.</span></span>

 <span data-ttu-id="6da2f-232">Las `(` coordenadas _x-min_**,**_y-min_ `)` y `(` _x-MAX_**,**_y-Max_ `)` determinan la posición y las dimensiones del cuadro de límite.</span><span class="sxs-lookup"><span data-stu-id="6da2f-232">The `(`_x-min_**,**_y-min_`)` and `(`_x-max_**,**_y-max_`)` coordinates determine the placement and dimensions of the bounding box.</span></span> <span data-ttu-id="6da2f-233">El espacio exterior del cuadro de límite se trata como una celda única con el número 0.</span><span class="sxs-lookup"><span data-stu-id="6da2f-233">The space outside of the bounding box is treated as a single cell that is numbered 0.</span></span>

 <span data-ttu-id="6da2f-234">El índice espacial descompone el espacio que se encuentra dentro del cuadro de límite.</span><span class="sxs-lookup"><span data-stu-id="6da2f-234">The spatial index decomposes the space inside the bounding box.</span></span> <span data-ttu-id="6da2f-235">La cuadrícula de nivel 1 de la jerarquía de cuadrículas rellena el cuadro de límite.</span><span class="sxs-lookup"><span data-stu-id="6da2f-235">The level-1 grid of the grid hierarchy fills the bounding box.</span></span> <span data-ttu-id="6da2f-236">Para colocar un objeto geométrico en la jerarquía de cuadrículas, el índice espacial compara las coordenadas del objeto con las coordenadas del cuadro de límite.</span><span class="sxs-lookup"><span data-stu-id="6da2f-236">To place a geometric object in the grid hierarchy, the spatial index compares the coordinates of the object to the bounding-box coordinates.</span></span>

 <span data-ttu-id="6da2f-237">En la ilustración siguiente se muestran los puntos definidos por las `(` coordenadas _x-min_**,**_y-min_ `)` y `(` _x-MAX_**,**_y-Max_ `)` del cuadro de límite.</span><span class="sxs-lookup"><span data-stu-id="6da2f-237">The following illustration shows the points defined by the `(`_x-min_**,**_y-min_`)` and `(`_x-max_**,**_y-max_`)` coordinates of the bounding box.</span></span> <span data-ttu-id="6da2f-238">El nivel superior de la jerarquía de cuadrículas se muestra como una cuadrícula 4x4.</span><span class="sxs-lookup"><span data-stu-id="6da2f-238">The top-level of the grid hierarchy is shown as a 4x4 grid.</span></span> <span data-ttu-id="6da2f-239">Para la ilustración, se omiten los niveles inferiores.</span><span class="sxs-lookup"><span data-stu-id="6da2f-239">For the purpose of illustration, the lower levels are omitted.</span></span> <span data-ttu-id="6da2f-240">Un cero (0) indica el espacio exterior del cuadro de límite.</span><span class="sxs-lookup"><span data-stu-id="6da2f-240">The space outside of the bounding box is indicated by a zero (0).</span></span> <span data-ttu-id="6da2f-241">Tenga en cuenta que el objeto 'A' se extiende, en parte, más allá del cuadro y el objeto 'B' permanece por completo fuera del cuadro de la celda 0.</span><span class="sxs-lookup"><span data-stu-id="6da2f-241">Note that object 'A' extends partly beyond the box, and object 'B' lies completely outside the box in cell 0.</span></span>

 <span data-ttu-id="6da2f-242">![Cuadro de límite que muestra las coordenadas y la celda 0.](../../database-engine/media/spndx-bb-4x4-objects.gif "Cuadro de límite que muestra las coordenadas y la celda 0.")</span><span class="sxs-lookup"><span data-stu-id="6da2f-242">![Bounding box showing coordinates and cell 0.](../../database-engine/media/spndx-bb-4x4-objects.gif "Bounding box showing coordinates and cell 0.")</span></span>

 <span data-ttu-id="6da2f-243">Un cuadro de límite se corresponde a alguna parte de los datos espaciales de una aplicación.</span><span class="sxs-lookup"><span data-stu-id="6da2f-243">A bounding box corresponds to some portion of an application's spatial data.</span></span> <span data-ttu-id="6da2f-244">Depende de la aplicación si el cuadro de límite del índice contiene por completo los datos almacenados en la columna espacial, o solo contiene una parte.</span><span class="sxs-lookup"><span data-stu-id="6da2f-244">Whether the bounding-box of the index completely contains the data stored in the spatial column, or only contains a portion, is up to the application.</span></span> <span data-ttu-id="6da2f-245">Solo las operaciones calculadas en los objetos que están completamente dentro del cuadro de límite se benefician del índice espacial.</span><span class="sxs-lookup"><span data-stu-id="6da2f-245">Only operations computed on objects that are entirely inside of the bounding box benefit from the spatial index.</span></span> <span data-ttu-id="6da2f-246">Por consiguiente, para aprovechar al máximo un índice espacial en una columna `geometry`, es necesario especificar un cuadro de límite que contenga todos los objetos o la mayoría de ellos.</span><span class="sxs-lookup"><span data-stu-id="6da2f-246">Therefore, to gain the greatest advantage from a spatial index on a `geometry` column, you need to specify a bounding-box that contains all or most of the objects.</span></span>

> [!NOTE]
>  <span data-ttu-id="6da2f-247">Las densidades de cuadrícula de un índice espacial están visibles en las columnas bounding_box_xmin, bounding_box_ymin, bounding_box_xmax y bounding_box_ymax de la vista de catálogo [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="6da2f-247">The grid densities of a spatial index are visible in the bounding_box_xmin, bounding_box_ymin, bounding_box_xmax, and bounding_box_ymax columns of the [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) catalog view.</span></span>

#### <a name="the-geography-grid-tessellation-scheme"></a><span data-ttu-id="6da2f-248">El esquema de teselación de cuadrícula de geografía</span><span class="sxs-lookup"><span data-stu-id="6da2f-248">The Geography Grid Tessellation Scheme</span></span>
 <span data-ttu-id="6da2f-249">Este esquema de teselación solo se aplica a una columna `geography`.</span><span class="sxs-lookup"><span data-stu-id="6da2f-249">This tessellation scheme applies only to a `geography` column.</span></span> <span data-ttu-id="6da2f-250">Esta sección resume los métodos admitidos por teselación de cuadrícula de geografía y trata cómo se proyecta el espacio geodésico en un plano, que se descompone a continuación en una jerarquía de cuadrículas.</span><span class="sxs-lookup"><span data-stu-id="6da2f-250">This section summarizes the methods that are supported by geography grid tessellation and discusses how geodetic space is projected onto a plane, which is then decomposed into a grid hierarchy.</span></span>

> [!NOTE]
>  <span data-ttu-id="6da2f-251">Puede especificar explícitamente este esquema de teselación con la cláusula USING (GEOGRAPHY_AUTO_GRID/GEOGRAPHY_GRID) de la instrucción [Create Spatial index](/sql/t-sql/statements/create-spatial-index-transact-sql) [!INCLUDE[tsql](../../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="6da2f-251">You can explicitly specify this tessellation scheme by using the USING (GEOGRAPHY_AUTO_GRID/GEOGRAPHY_GRID) clause of the [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql)[!INCLUDE[tsql](../../../includes/tsql-md.md)] statement.</span></span>

##### <a name="projection-of-the-geodetic-space-onto-a-plane"></a><span data-ttu-id="6da2f-252">Proyección del espacio geodésico en un plano</span><span class="sxs-lookup"><span data-stu-id="6da2f-252">Projection of the Geodetic Space onto a Plane</span></span>
 <span data-ttu-id="6da2f-253">Los cálculos en instancias de `geography` (objetos) tratan el espacio que contiene los objetos como un elipsoide geodésico.</span><span class="sxs-lookup"><span data-stu-id="6da2f-253">Computations on `geography` instances (objects) treat the space containing the objects as a geodetic ellipsoid.</span></span> <span data-ttu-id="6da2f-254">Para descomponer este espacio, el esquema teselación de cuadrícula geography divide la superficie del elipsoide en sus hemisferios superior e inferior y, a continuación, realiza los pasos siguientes:</span><span class="sxs-lookup"><span data-stu-id="6da2f-254">To decompose this space, the geography grid tessellation scheme divides the surface of the ellipsoid into its upper and lower hemispheres and then performs the following steps:</span></span>

1.  <span data-ttu-id="6da2f-255">Proyecta cada hemisferio en las caras de una pirámide cuadrangular.</span><span class="sxs-lookup"><span data-stu-id="6da2f-255">Projects each hemisphere onto the facets of a quadrilateral pyramid.</span></span>

2.  <span data-ttu-id="6da2f-256">Aplana las dos pirámides.</span><span class="sxs-lookup"><span data-stu-id="6da2f-256">Flattens the two pyramids.</span></span>

3.  <span data-ttu-id="6da2f-257">Une las pirámides aplanadas para formar un plano no euclidiano.</span><span class="sxs-lookup"><span data-stu-id="6da2f-257">Joins the flattened pyramids to form a non-Euclidean plane.</span></span>

 <span data-ttu-id="6da2f-258">La ilustración siguiente muestra una vista esquemática del proceso de descomposición de tres pasos.</span><span class="sxs-lookup"><span data-stu-id="6da2f-258">The following illustration shows a schematic view of the three-step decomposition process.</span></span> <span data-ttu-id="6da2f-259">En las pirámides, las líneas de puntos representan los límites de las cuatro facetas de cada pirámide.</span><span class="sxs-lookup"><span data-stu-id="6da2f-259">In the pyramids, the dotted lines represent the boundaries of the four facets of each pyramid.</span></span> <span data-ttu-id="6da2f-260">Los pasos 1 y 2 muestran el elipsoide geodésico, usando una línea horizontal verde para representar la línea de longitud ecuatorial y una serie de líneas verticales verdes para representar varias líneas de latitud.</span><span class="sxs-lookup"><span data-stu-id="6da2f-260">Steps 1 and 2 illustrate the geodetic ellipsoid, using a green horizontal line to represent the equatorial longitude line and a series of green vertical lines to represent several latitude lines.</span></span> <span data-ttu-id="6da2f-261">El paso 1 muestra las pirámides proyectándose sobre los dos hemisferios.</span><span class="sxs-lookup"><span data-stu-id="6da2f-261">Step 1 shows the pyramids being projected over the two hemispheres.</span></span> <span data-ttu-id="6da2f-262">El paso 2 muestra las pirámides aplanándose.</span><span class="sxs-lookup"><span data-stu-id="6da2f-262">Step 2 shows the pyramids being flattened.</span></span> <span data-ttu-id="6da2f-263">El paso 3 muestra las pirámides aplanadas, una vez que se han combinado para formar un plano, mostrando varias líneas de longitud proyectadas.</span><span class="sxs-lookup"><span data-stu-id="6da2f-263">Step 3 illustrates the flattened pyramids, after they have been combined to form a plane, showing a number of projected longitude lines.</span></span> <span data-ttu-id="6da2f-264">Observe que estas líneas proyectadas se ponen rectas y varían en longitud, dependiendo de dónde se encuentra en las pirámides.</span><span class="sxs-lookup"><span data-stu-id="6da2f-264">Notice that these projected lines are straightened and vary in length, depending on where they fall on the pyramids.</span></span>

 <span data-ttu-id="6da2f-265">![Proyección de la elipsoide en un plano](../../database-engine/media/spndx-geodetic-projection.gif "Proyección de la elipsoide en un plano")</span><span class="sxs-lookup"><span data-stu-id="6da2f-265">![Projection of the ellipsoid onto a plane](../../database-engine/media/spndx-geodetic-projection.gif "Projection of the ellipsoid onto a plane")</span></span>

 <span data-ttu-id="6da2f-266">Una vez que se ha proyectado el espacio en el plano, éste se descompone en la jerarquía de cuadrículas de cuatro niveles.</span><span class="sxs-lookup"><span data-stu-id="6da2f-266">Once the space has been projected onto the plane, the plane is decomposed into the four-level grid hierarchy.</span></span> <span data-ttu-id="6da2f-267">Diferentes niveles pueden usar distintas densidades de cuadrícula.</span><span class="sxs-lookup"><span data-stu-id="6da2f-267">Different levels can use different grid densities.</span></span> <span data-ttu-id="6da2f-268">La ilustración siguiente muestra el plano una vez se ha descompuesto en una cuadrícula de nivel 1 4x4.</span><span class="sxs-lookup"><span data-stu-id="6da2f-268">The following illustration shows the plane after it has been decomposed into a 4x4 level-1 grid.</span></span> <span data-ttu-id="6da2f-269">Para esta ilustración, se omiten los niveles inferiores de la jerarquía de cuadrículas.</span><span class="sxs-lookup"><span data-stu-id="6da2f-269">For the purposes of illustration, the lower-levels of the grid hierarchy are omitted.</span></span> <span data-ttu-id="6da2f-270">En realidad, el plano se descompone totalmente en una jerarquía de cuadrículas de cuatro niveles.</span><span class="sxs-lookup"><span data-stu-id="6da2f-270">In actuality, the plane is fully decomposed into a four-level grid hierarchy.</span></span> <span data-ttu-id="6da2f-271">Cuando termina el proceso de descomposición, se leen los datos geográficos, fila por fila, desde la columna geography y, a su vez, se lleva a cabo el proceso de teselación para cada objeto.</span><span class="sxs-lookup"><span data-stu-id="6da2f-271">After the decomposition process finishes, the geographic data is read, row by row, from the geography column, and the tessellation process is performed for each object in turn.</span></span>

 <span data-ttu-id="6da2f-272">![Cuadrícula de geography de nivel 1](../../database-engine/media/spndx-geodetic-level1grid.gif "Cuadrícula de geography de nivel 1")</span><span class="sxs-lookup"><span data-stu-id="6da2f-272">![Level-1 geography grid](../../database-engine/media/spndx-geodetic-level1grid.gif "Level-1 geography grid")</span></span>

##  <a name="methods-supported-by-spatial-indexes"></a><a name="methods"></a><span data-ttu-id="6da2f-273">Métodos admitidos por los índices espaciales</span><span class="sxs-lookup"><span data-stu-id="6da2f-273">Methods Supported by Spatial Indexes</span></span>

###  <a name="geometry-methods-supported-by-spatial-indexes"></a><a name="geometry"></a><span data-ttu-id="6da2f-274">Métodos de geometría admitidos por los índices espaciales</span><span class="sxs-lookup"><span data-stu-id="6da2f-274">Geometry Methods Supported by Spatial Indexes</span></span>
 <span data-ttu-id="6da2f-275">En ciertas condiciones, los índices espaciales son compatibles con los siguientes métodos de geometry y orientados a conjuntos: STContains(), STDistance(), STEquals(), STIntersects(), STOverlaps(), STTouches() y STWithin().</span><span class="sxs-lookup"><span data-stu-id="6da2f-275">Spatial indexes support the following set-oriented geometry methods under certain conditions: STContains(), STDistance(), STEquals(), STIntersects(), STOverlaps(), STTouches(), and STWithin().</span></span> <span data-ttu-id="6da2f-276">Para que un índice espacial los admita, estos métodos se deben usar dentro de la cláusula WHERE o JOIN ON de una consulta, y se deben producir dentro de un predicado con el formato general siguiente:</span><span class="sxs-lookup"><span data-stu-id="6da2f-276">To be supported by a spatial index, these methods must be used within the WHERE or JOIN ON clause of a query, and they must occur within a predicate of the following general form:</span></span>

 <span data-ttu-id="6da2f-277">*geometry1*. *method_name*(*geometry2*)*comparison_operator \* \* valid_number*</span><span class="sxs-lookup"><span data-stu-id="6da2f-277">*geometry1*.*method_name*(*geometry2*)*comparison_operator\*\*valid_number*</span></span>

 <span data-ttu-id="6da2f-278">Para devolver un resultado no nulo, *geometry1* y *geometry2* deben tener el mismo [identificador de referencia espacial (SRID)](../spatial/spatial-reference-identifiers-srids.md).</span><span class="sxs-lookup"><span data-stu-id="6da2f-278">To return a non-null result, *geometry1* and *geometry2* must have the same [spatial reference identifier (SRID)](../spatial/spatial-reference-identifiers-srids.md).</span></span> <span data-ttu-id="6da2f-279">De lo contrario, el método devolverá NULL.</span><span class="sxs-lookup"><span data-stu-id="6da2f-279">Otherwise, the method returns NULL.</span></span>

 <span data-ttu-id="6da2f-280">Los índices espaciales son compatibles con los formatos de predicado siguientes:</span><span class="sxs-lookup"><span data-stu-id="6da2f-280">Spatial indexes support the following predicate forms:</span></span>

-   <span data-ttu-id="6da2f-281">*geometry1*.[STContains](/sql/t-sql/spatial-geometry/stcontains-geometry-data-type)(*geometry2*) = 1</span><span class="sxs-lookup"><span data-stu-id="6da2f-281">*geometry1*.[STContains](/sql/t-sql/spatial-geometry/stcontains-geometry-data-type)(*geometry2*) = 1</span></span>

-   <span data-ttu-id="6da2f-282">*geometry1*. *Número* de < de [STDistance](/sql/t-sql/spatial-geometry/stdistance-geometry-data-type)(*geometry2*)</span><span class="sxs-lookup"><span data-stu-id="6da2f-282">*geometry1*.[STDistance](/sql/t-sql/spatial-geometry/stdistance-geometry-data-type)(*geometry2*) < *number*</span></span>

-   <span data-ttu-id="6da2f-283">*geometry1*.[STDistance](/sql/t-sql/spatial-geometry/stdistance-geometry-data-type)(*geometry2*) <= *number*</span><span class="sxs-lookup"><span data-stu-id="6da2f-283">*geometry1*.[STDistance](/sql/t-sql/spatial-geometry/stdistance-geometry-data-type)(*geometry2*) <= *number*</span></span>

-   <span data-ttu-id="6da2f-284">*geometry1*.[STEquals](/sql/t-sql/spatial-geometry/stequals-geometry-data-type)(*geometry2*)= 1</span><span class="sxs-lookup"><span data-stu-id="6da2f-284">*geometry1*.[STEquals](/sql/t-sql/spatial-geometry/stequals-geometry-data-type)(*geometry2*)= 1</span></span>

-   <span data-ttu-id="6da2f-285">*geometry1*.[STIntersects](/sql/t-sql/spatial-geometry/stintersects-geometry-data-type)(*geometry2*)= 1</span><span class="sxs-lookup"><span data-stu-id="6da2f-285">*geometry1*.[STIntersects](/sql/t-sql/spatial-geometry/stintersects-geometry-data-type)(*geometry2*)= 1</span></span>

-   <span data-ttu-id="6da2f-286">*geometry1.*</span><span class="sxs-lookup"><span data-stu-id="6da2f-286">*geometry1.*</span></span> <span data-ttu-id="6da2f-287">[STOverlaps](/sql/t-sql/spatial-geometry/stoverlaps-geometry-data-type) *(geometry2) = 1*</span><span class="sxs-lookup"><span data-stu-id="6da2f-287">[STOverlaps](/sql/t-sql/spatial-geometry/stoverlaps-geometry-data-type) *(geometry2) = 1*</span></span>

-   <span data-ttu-id="6da2f-288">*geometry1*.[STTouches](/sql/t-sql/spatial-geometry/sttouches-geometry-data-type)(*geometry2*) = 1</span><span class="sxs-lookup"><span data-stu-id="6da2f-288">*geometry1*.[STTouches](/sql/t-sql/spatial-geometry/sttouches-geometry-data-type)(*geometry2*) = 1</span></span>

-   <span data-ttu-id="6da2f-289">*geometry1*.[STWithin](/sql/t-sql/spatial-geometry/stwithin-geometry-data-type)(*geometry2*)= 1</span><span class="sxs-lookup"><span data-stu-id="6da2f-289">*geometry1*.[STWithin](/sql/t-sql/spatial-geometry/stwithin-geometry-data-type)(*geometry2*)= 1</span></span>

###  <a name="geography-methods-supported-by-spatial-indexes"></a><a name="geography"></a><span data-ttu-id="6da2f-290">Métodos Geography admitidos por los índices espaciales</span><span class="sxs-lookup"><span data-stu-id="6da2f-290">Geography Methods Supported by Spatial Indexes</span></span>
 <span data-ttu-id="6da2f-291">En ciertas condiciones, los índices espaciales son compatibles con los siguientes métodos de geography orientados a conjuntos: STIntersects(),STEquals() y STDistance().</span><span class="sxs-lookup"><span data-stu-id="6da2f-291">Under certain conditions, spatial indexes support the following set-oriented geography methods: STIntersects(),STEquals(), and STDistance().</span></span> <span data-ttu-id="6da2f-292">Para que un índice espacial los admita, estos métodos se deben usar dentro de la cláusula WHERE y se deben producir dentro de un predicado con el formato general siguiente:</span><span class="sxs-lookup"><span data-stu-id="6da2f-292">To be supported by a spatial index, these methods must be used within the WHERE clause of a query, and they must occur within a predicate of the following general form:</span></span>

 <span data-ttu-id="6da2f-293">*geography1*. *method_name*(*geography2*)*comparison_operator \* \* valid_number*</span><span class="sxs-lookup"><span data-stu-id="6da2f-293">*geography1*.*method_name*(*geography2*)*comparison_operator\*\*valid_number*</span></span>

 <span data-ttu-id="6da2f-294">Para devolver un resultado no nulo, *geography1* y *geography2* deben tener el mismo [identificador de referencia espacial (SRID)](../spatial/spatial-reference-identifiers-srids.md).</span><span class="sxs-lookup"><span data-stu-id="6da2f-294">To return a non-null result, *geography1* and *geography2* must have the same [Spatial Reference Identifier (SRID)](../spatial/spatial-reference-identifiers-srids.md).</span></span> <span data-ttu-id="6da2f-295">De lo contrario, el método devolverá NULL.</span><span class="sxs-lookup"><span data-stu-id="6da2f-295">Otherwise, the method returns NULL.</span></span>

 <span data-ttu-id="6da2f-296">Los índices espaciales son compatibles con los formatos de predicado siguientes:</span><span class="sxs-lookup"><span data-stu-id="6da2f-296">Spatial indexes support the following predicate forms:</span></span>

-   <span data-ttu-id="6da2f-297">*geography1*.[STIntersects](/sql/t-sql/spatial-geography/stintersects-geography-data-type)(*geography2*)= 1</span><span class="sxs-lookup"><span data-stu-id="6da2f-297">*geography1*.[STIntersects](/sql/t-sql/spatial-geography/stintersects-geography-data-type)(*geography2*)= 1</span></span>

-   <span data-ttu-id="6da2f-298">*geography1*.[STEquals](/sql/t-sql/spatial-geography/stequals-geography-data-type)(*geography2*)= 1</span><span class="sxs-lookup"><span data-stu-id="6da2f-298">*geography1*.[STEquals](/sql/t-sql/spatial-geography/stequals-geography-data-type)(*geography2*)= 1</span></span>

-   <span data-ttu-id="6da2f-299">*geography1*. *Número* de < de [STDistance](/sql/t-sql/spatial-geography/stdistance-geography-data-type)(*geography2*)</span><span class="sxs-lookup"><span data-stu-id="6da2f-299">*geography1*.[STDistance](/sql/t-sql/spatial-geography/stdistance-geography-data-type)(*geography2*) < *number*</span></span>

-   <span data-ttu-id="6da2f-300">*geography1*.[STDistance](/sql/t-sql/spatial-geography/stdistance-geography-data-type)(*geography2*) <= *number*</span><span class="sxs-lookup"><span data-stu-id="6da2f-300">*geography1*.[STDistance](/sql/t-sql/spatial-geography/stdistance-geography-data-type)(*geography2*) <= *number*</span></span>

### <a name="queries-that-use-spatial-indexes"></a><span data-ttu-id="6da2f-301">Consultas que usan índices espaciales</span><span class="sxs-lookup"><span data-stu-id="6da2f-301">Queries that use Spatial Indexes</span></span>
 <span data-ttu-id="6da2f-302">Solo se admiten índices espaciales en las consultas que incluyen un operador espacial indizado en la cláusula `WHERE`.</span><span class="sxs-lookup"><span data-stu-id="6da2f-302">Spatial indexes are only supported in queries that include an indexed spatial operator in the `WHERE` clause.</span></span> <span data-ttu-id="6da2f-303">Por ejemplo, sintaxis como la siguiente:</span><span class="sxs-lookup"><span data-stu-id="6da2f-303">For example syntax such as:</span></span>

```
[spatial object].SpatialMethod([reference spatial object]) [ = | < ] [const literal or variable]
```

 <span data-ttu-id="6da2f-304">El optimizador de consultas entiende la conmutatividad de las operaciones espaciales ( `@a.STIntersects(@b) = @b.STInterestcs(@a)` ).</span><span class="sxs-lookup"><span data-stu-id="6da2f-304">The query optimizer understands the commutativity of spatial operations (that `@a.STIntersects(@b) = @b.STInterestcs(@a)` ).</span></span> <span data-ttu-id="6da2f-305">Sin embargo, el índice espacial no se usará si el principio de una comparación no contiene el operador espacial (por ejemplo, `WHERE 1 = spatial op` no usará el índice espacial).</span><span class="sxs-lookup"><span data-stu-id="6da2f-305">However, the spatial index will not be used if the beginning of a comparison does not contain the spatial operator (for example `WHERE 1 = spatial op` will not use the spatial index).</span></span> <span data-ttu-id="6da2f-306">Para usar el índice espacial, vuelva a escribir la comparación (por ejemplo, `WHERE spatial op = 1`).</span><span class="sxs-lookup"><span data-stu-id="6da2f-306">To use the spatial index, rewrite the comparison (for example `WHERE spatial op = 1`).</span></span>

 <span data-ttu-id="6da2f-307">Como ocurre con cualquier otro índice, cuando se admite un índice espacial, el uso del índice espacial se elige en función del costo, de modo que el optimizador de consultas no elige usar el índice espacial aunque se cumplan todos los requisitos para usarlo.</span><span class="sxs-lookup"><span data-stu-id="6da2f-307">As with any other index, when a spatial index is supported, the use of the spatial index is chosen based on cost, so the query optimizer might not choose to use the spatial index even though all requirements for using it are met.</span></span> <span data-ttu-id="6da2f-308">Use el plan de presentación para ver si se usó el índice espacial y, si es necesario, proporcione sugerencias de consulta para forzar un plan de consulta deseado.</span><span class="sxs-lookup"><span data-stu-id="6da2f-308">Use showplan to see if the spatial index was used and if necessary provide query hints to force a desired query plan.</span></span>

 <span data-ttu-id="6da2f-309">El tipo de vecino más cercano de consulta también admite índices espaciales; sin embargo, solo si se escribe una sintaxis de consulta específica.</span><span class="sxs-lookup"><span data-stu-id="6da2f-309">The nearest neighbor type of query also supports spatial indexes however only if a specific query syntax is written.</span></span> <span data-ttu-id="6da2f-310">La sintaxis adecuada es:</span><span class="sxs-lookup"><span data-stu-id="6da2f-310">The appropriate syntax is:</span></span>

```
SELECT TOP(K) [WITH TIES] * 
FROM <Table> AS T [WITH(INDEX(<SpatialIndex>))]
WHERE <SpatialColumn>.STDistance(@reference_object) IS NOT NULL
ORDER BY <SpatialColumn>.STDistance(@reference_object) [;]
```

## <a name="see-also"></a><span data-ttu-id="6da2f-311">Consulte también</span><span class="sxs-lookup"><span data-stu-id="6da2f-311">See Also</span></span>
 [<span data-ttu-id="6da2f-312">Datos espaciales &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="6da2f-312">Spatial Data &#40;SQL Server&#41;</span></span>](../spatial/spatial-data-sql-server.md)


