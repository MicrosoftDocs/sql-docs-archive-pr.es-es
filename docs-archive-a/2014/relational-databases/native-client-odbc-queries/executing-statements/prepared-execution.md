---
title: Ejecución preparada | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- deferred statement preparation
- prepared execution [ODBC]
- SQLPrepare function
- ODBC applications, statements
- SQLExecute function
- statements [ODBC], prepared execution
ms.assetid: f3a9d32b-6cd7-4f0c-b38d-c8ccc4ee40c3
author: rothja
ms.author: jroth
ms.openlocfilehash: 33ab9f35cd9d3eaf04e688a89390b5eb3f00ae58
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87662872"
---
# <a name="prepared-execution"></a><span data-ttu-id="db1e1-102">Ejecución preparada</span><span class="sxs-lookup"><span data-stu-id="db1e1-102">Prepared Execution</span></span>
  <span data-ttu-id="db1e1-103">La API de ODBC define la ejecución preparada como una manera de reducir la sobrecarga de análisis y compilación asociada a la ejecución reiterativa de una instrucción [!INCLUDE[tsql](../../../includes/tsql-md.md)].</span><span class="sxs-lookup"><span data-stu-id="db1e1-103">The ODBC API defines prepared execution as a way to reduce the parsing and compiling overhead associated with repeatedly executing a [!INCLUDE[tsql](../../../includes/tsql-md.md)] statement.</span></span> <span data-ttu-id="db1e1-104">La aplicación genera una cadena de caracteres que contiene una instrucción SQL y, a continuación, la ejecuta en dos fases.</span><span class="sxs-lookup"><span data-stu-id="db1e1-104">The application builds a character string containing an SQL statement and then executes it in two stages.</span></span> <span data-ttu-id="db1e1-105">Llama a [SQLPrepare function](https://go.microsoft.com/fwlink/?LinkId=59360) una vez para que la instrucción se analice y compile en un plan de ejecución [!INCLUDE[ssDE](../../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="db1e1-105">It calls [SQLPrepare Function](https://go.microsoft.com/fwlink/?LinkId=59360) once to have the statement parsed and compiled into an execution plan by the [!INCLUDE[ssDE](../../../includes/ssde-md.md)].</span></span> <span data-ttu-id="db1e1-106">A continuación, llama a **SQLExecute** para cada ejecución del plan de ejecución preparado.</span><span class="sxs-lookup"><span data-stu-id="db1e1-106">It then calls **SQLExecute** for each execution of the prepared execution plan.</span></span> <span data-ttu-id="db1e1-107">De esta forma, se guarda la sobrecarga de análisis y compilación en cada ejecución.</span><span class="sxs-lookup"><span data-stu-id="db1e1-107">This saves the parsing and compiling overhead on each execution.</span></span> <span data-ttu-id="db1e1-108">Las aplicaciones suelen usar la ejecución preparada para ejecutar repetidamente una misma instrucción SQL parametrizada.</span><span class="sxs-lookup"><span data-stu-id="db1e1-108">Prepared execution is commonly used by applications to repeatedly execute the same, parameterized SQL statement.</span></span>  
  
 <span data-ttu-id="db1e1-109">Para la mayoría de las bases de datos, la ejecución preparada es más rápida que la ejecución directa de instrucciones que se ejecutan más de tres o cuatro veces, principalmente porque la instrucción se compila solo una vez, mientras que las instrucciones ejecutadas directamente se compilan cada vez que se ejecutan.</span><span class="sxs-lookup"><span data-stu-id="db1e1-109">For most databases, prepared execution is faster than direct execution for statements executed more than three or four times primarily because the statement is compiled only once, while statements executed directly are compiled each time they are executed.</span></span> <span data-ttu-id="db1e1-110">La ejecución preparada también puede proporcionar una reducción del tráfico de red porque el controlador puede enviar un identificador de plan de ejecución y los valores de los parámetros, en lugar de una instrucción SQL completa, al origen de datos cada vez que se ejecuta la instrucción.</span><span class="sxs-lookup"><span data-stu-id="db1e1-110">Prepared execution can also provide a reduction in network traffic because the driver can send an execution plan identifier and the parameter values, rather than an entire SQL statement, to the data source each time the statement is executed.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]<span data-ttu-id="db1e1-111">reduce la diferencia de rendimiento entre la ejecución directa y preparada a través de algoritmos mejorados para detectar y volver a usar planes de ejecución de **SQLExecDirect**.</span><span class="sxs-lookup"><span data-stu-id="db1e1-111">reduces the performance difference between direct and prepared execution through improved algorithms for detecting and reusing execution plans from **SQLExecDirect**.</span></span> <span data-ttu-id="db1e1-112">Estos algoritmos permiten disfrutar en las instrucciones que se ejecutan directamente de algunas de las ventajas de rendimiento de la ejecución preparada.</span><span class="sxs-lookup"><span data-stu-id="db1e1-112">This makes some of the performance benefits of prepared execution available to statements executed directly.</span></span> <span data-ttu-id="db1e1-113">Para obtener más información, vea [ejecución directa](direct-execution.md).</span><span class="sxs-lookup"><span data-stu-id="db1e1-113">For more information, see [Direct Execution](direct-execution.md).</span></span>  
  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="db1e1-114">proporciona también compatibilidad nativa con la ejecución preparada.</span><span class="sxs-lookup"><span data-stu-id="db1e1-114">also provides native support for prepared execution.</span></span> <span data-ttu-id="db1e1-115">Un plan de ejecución se compila en **SQLPrepare** y, posteriormente, se ejecuta cuando se llama a **SQLExecute** .</span><span class="sxs-lookup"><span data-stu-id="db1e1-115">An execution plan is built on **SQLPrepare** and later executed when **SQLExecute** is called.</span></span> <span data-ttu-id="db1e1-116">Dado [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] que no es necesario para crear procedimientos almacenados temporales en **SQLPrepare**, no hay ninguna sobrecarga adicional en las tablas del sistema de **tempdb**.</span><span class="sxs-lookup"><span data-stu-id="db1e1-116">Because [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is not required to build temporary stored procedures on **SQLPrepare**, there is no extra overhead on the system tables in **tempdb**.</span></span>  
  
 <span data-ttu-id="db1e1-117">Por motivos de rendimiento, la preparación de instrucciones se difiere hasta que se llama a **SQLExecute** o se realiza una operación de metapropiedad (como [SQLDescribeCol](../../native-client-odbc-api/sqldescribecol.md) o [SQLDescribeParam](../../native-client-odbc-api/sqldescribeparam.md) en ODBC).</span><span class="sxs-lookup"><span data-stu-id="db1e1-117">For performance reasons, the statement preparation is deferred until **SQLExecute** is called or a metaproperty operation (such as [SQLDescribeCol](../../native-client-odbc-api/sqldescribecol.md) or [SQLDescribeParam](../../native-client-odbc-api/sqldescribeparam.md) in ODBC) is performed.</span></span> <span data-ttu-id="db1e1-118">Este es el comportamiento predeterminado.</span><span class="sxs-lookup"><span data-stu-id="db1e1-118">This is the default behavior.</span></span> <span data-ttu-id="db1e1-119">Cualquier error que se produzca en la instrucción que se está preparando no se dará a conocer hasta que la instrucción se ejecute o hasta que se realice una operación de metapropiedad.</span><span class="sxs-lookup"><span data-stu-id="db1e1-119">Any errors in the statement being prepared are not known until the statement is executed or a metaproperty operation is performed.</span></span> <span data-ttu-id="db1e1-120">Si desea desactivar este comportamiento predeterminado, establezca el atributo de instrucción específico del controlador ODBC de Native Client de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] SQL_SOPT_SS_DEFER_PREPARE en SQL_DP_OFF.</span><span class="sxs-lookup"><span data-stu-id="db1e1-120">Setting the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver-specific statement attribute SQL_SOPT_SS_DEFER_PREPARE to SQL_DP_OFF can turn off this default behavior.</span></span>  
  
 <span data-ttu-id="db1e1-121">En el caso de la preparación diferida, al llamar a **SQLDescribeCol** o **SQLDescribeParam** antes de llamar a **SQLExecute** , se genera un viaje de ida y vuelta adicional al servidor.</span><span class="sxs-lookup"><span data-stu-id="db1e1-121">In case of deferred prepare, calling either **SQLDescribeCol** or **SQLDescribeParam** before calling **SQLExecute** generates an extra roundtrip to the server.</span></span> <span data-ttu-id="db1e1-122">En **SQLDescribeCol**, el controlador quita la cláusula WHERE de la consulta y la envía al servidor con set FMTONLY on para obtener la descripción de las columnas del primer conjunto de resultados devuelto por la consulta.</span><span class="sxs-lookup"><span data-stu-id="db1e1-122">On **SQLDescribeCol**, the driver removes the WHERE clause from the query and sends it to the server with SET FMTONLY ON to get the description of the columns in the first result set returned by the query.</span></span> <span data-ttu-id="db1e1-123">En **SQLDescribeParam**, el controlador llama al servidor para obtener una descripción de las expresiones o columnas a las que hacen referencia los marcadores de parámetros de la consulta.</span><span class="sxs-lookup"><span data-stu-id="db1e1-123">On **SQLDescribeParam**, the driver calls the server to get a description of the expressions or columns referenced by any parameter markers in the query.</span></span> <span data-ttu-id="db1e1-124">Este método tiene también algunas restricciones, como la imposibilidad de resolver parámetros en subconsultas.</span><span class="sxs-lookup"><span data-stu-id="db1e1-124">This method also has some restrictions, such as not being able to resolve parameters in subqueries.</span></span>  
  
 <span data-ttu-id="db1e1-125">El uso excesivo de **SQLPrepare** con el [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] controlador ODBC de Native Client degrada el rendimiento, especialmente cuando se conecta a versiones anteriores de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="db1e1-125">Excess use of **SQLPrepare** with the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver degrades performance, especially when connected to earlier versions of SQL Server.</span></span> <span data-ttu-id="db1e1-126">La ejecución preparada no se debe utilizar para las instrucciones que se ejecutan una sola vez.</span><span class="sxs-lookup"><span data-stu-id="db1e1-126">Prepared execution should not be used for statements executed a single time.</span></span> <span data-ttu-id="db1e1-127">La ejecución preparada es más lenta que la ejecución directa para una ejecución única de una instrucción porque requiere un ciclo de ida y vuelta de red adicional del cliente al servidor.</span><span class="sxs-lookup"><span data-stu-id="db1e1-127">Prepared execution is slower than direct execution for a single execution of a statement because it requires an extra network roundtrip from the client to the server.</span></span> <span data-ttu-id="db1e1-128">En las versiones anteriores de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] genera además un procedimiento almacenado temporal.</span><span class="sxs-lookup"><span data-stu-id="db1e1-128">On earlier versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] it also generates a temporary stored procedure.</span></span>  
  
 <span data-ttu-id="db1e1-129">Las instrucciones preparadas no se pueden utilizar para crear objetos temporales en [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="db1e1-129">Prepared statements cannot be used to create temporary objects on [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
 <span data-ttu-id="db1e1-130">Algunas aplicaciones ODBC tempranas usaban **SQLPrepare** siempre que se usaba [SQLBindParameter](../../native-client-odbc-api/sqlbindparameter.md) .</span><span class="sxs-lookup"><span data-stu-id="db1e1-130">Some early ODBC applications used **SQLPrepare** any time [SQLBindParameter](../../native-client-odbc-api/sqlbindparameter.md) was used.</span></span> <span data-ttu-id="db1e1-131">**SQLBindParameter** no requiere el uso de **SQLPrepare**, sino que se puede usar con **SQLExecDirect**.</span><span class="sxs-lookup"><span data-stu-id="db1e1-131">**SQLBindParameter** does not require the use of **SQLPrepare**, it can be used with **SQLExecDirect**.</span></span> <span data-ttu-id="db1e1-132">Por ejemplo, use **SQLExecDirect** con **SQLBindParameter** para recuperar el código de retorno o los parámetros de salida de un procedimiento almacenado que solo se ejecuta una vez.</span><span class="sxs-lookup"><span data-stu-id="db1e1-132">For example, use **SQLExecDirect** with **SQLBindParameter** to retrieve the return code or output parameters from a stored procedure that is only executed one time.</span></span> <span data-ttu-id="db1e1-133">No use **SQLPrepare** con **SQLBindParameter** a menos que la misma instrucción se ejecute varias veces.</span><span class="sxs-lookup"><span data-stu-id="db1e1-133">Do not use **SQLPrepare** with **SQLBindParameter** unless the same statement will be executed multiple times.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="db1e1-134">Consulte también</span><span class="sxs-lookup"><span data-stu-id="db1e1-134">See Also</span></span>  
 [<span data-ttu-id="db1e1-135">Ejecutar instrucciones &#40;ODBC&#41;</span><span class="sxs-lookup"><span data-stu-id="db1e1-135">Executing Statements &#40;ODBC&#41;</span></span>](executing-statements-odbc.md)  
  
  
