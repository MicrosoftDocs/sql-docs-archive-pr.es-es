---
title: 'Tutorial: Firmar procedimientos almacenados con un certificado | Microsoft Docs'
ms.custom: ''
ms.date: 06/14/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- signing stored procedures tutorial [SQL Server]
ms.assetid: a4b0f23b-bdc8-425f-b0b9-e0621894f47e
author: rothja
ms.author: jroth
ms.openlocfilehash: 6fe387c43431436ba5fba5bcab879584ecdad533
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87677502"
---
# <a name="tutorial-signing-stored-procedures-with-a-certificate"></a><span data-ttu-id="9161c-102">Tutorial: Firmar procedimientos almacenados con un certificado</span><span class="sxs-lookup"><span data-stu-id="9161c-102">Tutorial: Signing Stored Procedures with a Certificate</span></span>
  <span data-ttu-id="9161c-103">En este tutorial se describe cómo se firman los procedimientos almacenados con un certificado generado por [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="9161c-103">This tutorial illustrates signing stored procedures using a certificate generated by [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="9161c-104">Para ejecutar el código de este tutorial, debe estar configurada la seguridad de modo mixto y la base de datos [!INCLUDE[ssSampleDBobject](../includes/sssampledbobject-md.md)] debe estar instalada.</span><span class="sxs-lookup"><span data-stu-id="9161c-104">To run the code in this tutorial you must have both Mixed Mode security configured and the [!INCLUDE[ssSampleDBobject](../includes/sssampledbobject-md.md)] database installed.</span></span> <span data-ttu-id="9161c-105">Escenario</span><span class="sxs-lookup"><span data-stu-id="9161c-105">Scenario</span></span>  
  
 <span data-ttu-id="9161c-106">La firma de procedimientos almacenados mediante un certificado es útil si desea exigir permisos en el procedimiento almacenado sin conceder explícitamente esos derechos al usuario.</span><span class="sxs-lookup"><span data-stu-id="9161c-106">Signing stored procedures using a certificate is useful when you want to require permissions on the stored procedure but you do not want to explicitly grant a user those rights.</span></span> <span data-ttu-id="9161c-107">Aunque esto se puede conseguir de distintas maneras, por ejemplo, mediante la instrucción EXECUTE AS, los certificados le permiten usar un seguimiento para buscar al autor de la llamada original del procedimiento almacenado.</span><span class="sxs-lookup"><span data-stu-id="9161c-107">Although you can accomplish this task in other ways, such as using the EXECUTE AS statement, using a certificate allows you to use a trace to find the original caller of the stored procedure.</span></span> <span data-ttu-id="9161c-108">De este modo, se consigue un alto nivel de auditoría, especialmente durante las operaciones de seguridad o de lenguaje de definición de datos (DDL).</span><span class="sxs-lookup"><span data-stu-id="9161c-108">This provides a high level of auditing, especially during security or Data Definition Language (DDL) operations.</span></span>  
  
 <span data-ttu-id="9161c-109">Puede crear un certificado en la base de datos maestra para permitir permisos de nivel de servidor o puede crear un certificado en cualquier base de datos de usuario para permitir permisos de nivel de base de datos.</span><span class="sxs-lookup"><span data-stu-id="9161c-109">You can create a certificate in the master database to allow server-level permissions, or you can create a certificate in any user databases to allow database-level permissions.</span></span> <span data-ttu-id="9161c-110">En este escenario, un usuario sin derechos en las tablas base deberá obtener acceso a un procedimiento almacenado de la base de datos [!INCLUDE[ssSampleDBobject](../includes/sssampledbobject-md.md)] y deberá realizar una auditoría del acceso a los objetos.</span><span class="sxs-lookup"><span data-stu-id="9161c-110">In this scenario, a user with no rights to base tables must access a stored procedure in the [!INCLUDE[ssSampleDBobject](../includes/sssampledbobject-md.md)] database, and you want to audit the object access trail.</span></span> <span data-ttu-id="9161c-111">En lugar de usar los métodos de cadenas de propiedad, deberá crear una cuenta de servidor y de usuario de base de datos sin derechos en los objetos base, y una cuenta de usuario de base de datos con derechos en una tabla y en un procedimiento almacenado.</span><span class="sxs-lookup"><span data-stu-id="9161c-111">Rather than using other ownership chain methods, you will create a server and database user account with no rights to the base objects, and a database user account with rights to a table and a stored procedure.</span></span> <span data-ttu-id="9161c-112">Tanto el procedimiento almacenado como la segunda cuenta de usuario de base de datos estarán protegidos con un certificado.</span><span class="sxs-lookup"><span data-stu-id="9161c-112">Both the stored procedure and the second database user account will be secured with a certificate.</span></span> <span data-ttu-id="9161c-113">La segunda cuenta de la base de datos tendrá acceso a todos los objetos y podrá conceder acceso al procedimiento almacenado en la primera cuenta de usuario de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="9161c-113">The second database account will have access to all objects, and grant access to the stored procedure to the first database user account.</span></span>  
  
 <span data-ttu-id="9161c-114">En este escenario, en primer lugar creará un certificado de base de datos, un procedimiento almacenado y un usuario y, a continuación, comprobará el proceso mediante los pasos siguientes:</span><span class="sxs-lookup"><span data-stu-id="9161c-114">In this scenario you will first create a database certificate, a stored procedure, and a user, and then you will test the process following these steps:</span></span>  
  
1.  <span data-ttu-id="9161c-115">Configure el entorno.</span><span class="sxs-lookup"><span data-stu-id="9161c-115">Configure the environment.</span></span>  
  
2.  <span data-ttu-id="9161c-116">Cree un certificado.</span><span class="sxs-lookup"><span data-stu-id="9161c-116">Create a certificate.</span></span>  
  
3.  <span data-ttu-id="9161c-117">Cree y firme un procedimiento almacenado mediante el certificado.</span><span class="sxs-lookup"><span data-stu-id="9161c-117">Create and sign a stored procedure using the certificate.</span></span>  
  
4.  <span data-ttu-id="9161c-118">Cree una cuenta de certificado mediante el certificado.</span><span class="sxs-lookup"><span data-stu-id="9161c-118">Create a certificate account using the certificate.</span></span>  
  
5.  <span data-ttu-id="9161c-119">Conceda al certificado derechos de base de datos de cuentas.</span><span class="sxs-lookup"><span data-stu-id="9161c-119">Grant the certificate account database rights.</span></span>  
  
6.  <span data-ttu-id="9161c-120">Muestre el contexto de acceso.</span><span class="sxs-lookup"><span data-stu-id="9161c-120">Display the access context.</span></span>  
  
7.  <span data-ttu-id="9161c-121">Restablezca el entorno.</span><span class="sxs-lookup"><span data-stu-id="9161c-121">Reset the environment.</span></span>  
  
 <span data-ttu-id="9161c-122">Cada bloque de código incluido en este ejemplo se describe en línea.</span><span class="sxs-lookup"><span data-stu-id="9161c-122">Each code block in this example is explained in line.</span></span> <span data-ttu-id="9161c-123">Para copiar el ejemplo completo, vea [Ejemplo completo](#CompleteExample) al final de este tutorial.</span><span class="sxs-lookup"><span data-stu-id="9161c-123">To copy the complete example, see [Complete Example](#CompleteExample) at the end of this tutorial.</span></span>  
  
## <a name="1-configure-the-environment"></a><span data-ttu-id="9161c-124">1. Configurar el entorno</span><span class="sxs-lookup"><span data-stu-id="9161c-124">1. Configure the Environment</span></span>  
 <span data-ttu-id="9161c-125">Para establecer el contexto inicial del ejemplo, en [!INCLUDE[ssManStudioFull](../includes/ssmanstudiofull-md.md)] abra una consulta nueva y ejecute el código siguiente para abrir la base de datos [!INCLUDE[ssSampleDBobject](../includes/sssampledbobject-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="9161c-125">To set the initial context of the example, in [!INCLUDE[ssManStudioFull](../includes/ssmanstudiofull-md.md)] open a new Query and run the following code to open the [!INCLUDE[ssSampleDBobject](../includes/sssampledbobject-md.md)] database.</span></span> <span data-ttu-id="9161c-126">Este código cambia el contexto de la base de datos a `AdventureWorks2012` y crea un inicio de sesión de servidor y una cuenta de usuario de base de datos nuevos (`TestCreditRatingUser`) mediante una contraseña.</span><span class="sxs-lookup"><span data-stu-id="9161c-126">This code changes the database context to `AdventureWorks2012` and creates a new server login and database user account (`TestCreditRatingUser`), using a password.</span></span>  
  
```  
USE AdventureWorks2012;  
GO  
-- Set up a login for the test user  
CREATE LOGIN TestCreditRatingUser  
   WITH PASSWORD = 'ASDECd2439587y'  
GO  
CREATE USER TestCreditRatingUser  
FOR LOGIN TestCreditRatingUser;  
GO  
```  
  
 <span data-ttu-id="9161c-127">Para obtener más información sobre la instrucción CREATE USER, consulte [CREATE USER &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-user-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="9161c-127">For more information on the CREATE USER statement, see [CREATE USER &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-user-transact-sql).</span></span> <span data-ttu-id="9161c-128">Para obtener más información sobre la instrucción CREATE LOGIN, consulte [CREATE LOGIN &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-login-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="9161c-128">For more information on the CREATE LOGIN statement, see [CREATE LOGIN &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-login-transact-sql).</span></span>  
  
## <a name="2-create-a-certificate"></a><span data-ttu-id="9161c-129">2. Crear un certificado</span><span class="sxs-lookup"><span data-stu-id="9161c-129">2. Create a Certificate</span></span>  
 <span data-ttu-id="9161c-130">Puede crear certificados en los servidores mediante la base de datos maestra como contexto y mediante una base de datos de usuario, o ambas.</span><span class="sxs-lookup"><span data-stu-id="9161c-130">You can create certificates in the server using the master database as the context, using a user database, or both.</span></span> <span data-ttu-id="9161c-131">Existen varias opciones para proteger el certificado.</span><span class="sxs-lookup"><span data-stu-id="9161c-131">There are multiple options for securing the certificate.</span></span> <span data-ttu-id="9161c-132">Para obtener más información sobre los certificados, consulte [CREATE CERTIFICATE &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-certificate-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="9161c-132">For more information on certificates, see [CREATE CERTIFICATE &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-certificate-transact-sql).</span></span>  
  
 <span data-ttu-id="9161c-133">Ejecute este código para crear un certificado de base de datos y protéjalo mediante una contraseña.</span><span class="sxs-lookup"><span data-stu-id="9161c-133">Run this code to create a database certificate and secure it using a password.</span></span>  
  
```  
CREATE CERTIFICATE TestCreditRatingCer  
   ENCRYPTION BY PASSWORD = 'pGFD4bb925DGvbd2439587y'  
      WITH SUBJECT = 'Credit Rating Records Access',   
      EXPIRY_DATE = '12/05/2014';  
GO  
```  
  
## <a name="3-create-and-sign-a-stored-procedure-using-the-certificate"></a><span data-ttu-id="9161c-134">3. Crear y firmar un procedimiento almacenado mediante el certificado</span><span class="sxs-lookup"><span data-stu-id="9161c-134">3. Create and Sign a Stored Procedure Using the Certificate</span></span>  
 <span data-ttu-id="9161c-135">Utilice el siguiente código para crear un procedimiento almacenado que seleccione los datos de la tabla `Vendor` en el esquema de la base de datos `Purchasing` y restrinja el acceso únicamente a las compañías con una solvencia de 1.</span><span class="sxs-lookup"><span data-stu-id="9161c-135">Use the following code to create a stored procedure that selects data from the `Vendor` table in the `Purchasing` database schema, restricting access to only the companies with a credit rating of 1.</span></span> <span data-ttu-id="9161c-136">Tenga en cuenta que la primera sección del procedimiento almacenado muestra el contexto de la cuenta de usuario que ejecuta el procedimiento almacenado, que solo se usa para demostrar los conceptos.</span><span class="sxs-lookup"><span data-stu-id="9161c-136">Note that the first section of the stored procedure displays the context of the user account running the stored procedure, which is to demonstrate the concepts only.</span></span> <span data-ttu-id="9161c-137">No es necesario cumplir los requisitos.</span><span class="sxs-lookup"><span data-stu-id="9161c-137">It is not required to satisfy the requirements.</span></span>  
  
```  
CREATE PROCEDURE TestCreditRatingSP  
AS  
BEGIN  
   -- Show who is running the stored procedure  
   SELECT SYSTEM_USER 'system Login'  
   , USER AS 'Database Login'  
   , NAME AS 'Context'  
   , TYPE  
   , USAGE   
   FROM sys.user_token     
  
   -- Now get the data  
   SELECT AccountNumber, Name, CreditRating   
   FROM Purchasing.Vendor  
   WHERE CreditRating = 1  
END  
GO  
```  
  
 <span data-ttu-id="9161c-138">Ejecute este código para firmar el procedimiento almacenado con el certificado de base de datos mediante una contraseña.</span><span class="sxs-lookup"><span data-stu-id="9161c-138">Run this code to sign the stored procedure with the database certificate, using a password.</span></span>  
  
```  
ADD SIGNATURE TO TestCreditRatingSP   
   BY CERTIFICATE TestCreditRatingCer  
    WITH PASSWORD = 'pGFD4bb925DGvbd2439587y';  
GO  
```  
  
 <span data-ttu-id="9161c-139">Para obtener más información sobre los procedimientos almacenados, consulte [Procedimientos almacenados &#40;motor de base de datos&#41;](stored-procedures/stored-procedures-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="9161c-139">For more information on stored procedures, see [Stored Procedures &#40;Database Engine&#41;](stored-procedures/stored-procedures-database-engine.md).</span></span>  
  
 <span data-ttu-id="9161c-140">Para obtener más información sobre cómo firmar los procedimientos almacenados, consulte [ADD SIGNATURE &#40;Transact-SQL&#41;](/sql/t-sql/statements/add-signature-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="9161c-140">For more information on signing stored procedures, see [ADD SIGNATURE &#40;Transact-SQL&#41;](/sql/t-sql/statements/add-signature-transact-sql).</span></span>  
  
## <a name="4-create-a-certificate-account-using-the-certificate"></a><span data-ttu-id="9161c-141">4. Crear una cuenta de certificado mediante el certificado</span><span class="sxs-lookup"><span data-stu-id="9161c-141">4. Create a Certificate Account Using the Certificate</span></span>  
 <span data-ttu-id="9161c-142">Ejecute este código para crear un usuario de base de datos (`TestCreditRatingcertificateAccount`) a partir del certificado.</span><span class="sxs-lookup"><span data-stu-id="9161c-142">Run this code to create a database user (`TestCreditRatingcertificateAccount`) from the certificate.</span></span> <span data-ttu-id="9161c-143">Esta cuenta no tiene inicio de sesión en el servidor y en última instancia controlará el acceso a las tablas subyacentes.</span><span class="sxs-lookup"><span data-stu-id="9161c-143">This account has no server login, and will ultimately control access to the underlying tables.</span></span>  
  
```  
USE AdventureWorks2012;  
GO  
CREATE USER TestCreditRatingcertificateAccount  
   FROM CERTIFICATE TestCreditRatingCer;  
GO  
```  
  
## <a name="5-grant-the-certificate-account-database-rights"></a><span data-ttu-id="9161c-144">5. Conceder al certificado derechos de base de datos de cuentas</span><span class="sxs-lookup"><span data-stu-id="9161c-144">5. Grant the Certificate Account Database Rights</span></span>  
 <span data-ttu-id="9161c-145">Ejecute este código para conceder derechos `TestCreditRatingcertificateAccount` a la tabla base y al procedimiento almacenado.</span><span class="sxs-lookup"><span data-stu-id="9161c-145">Run this code to grant `TestCreditRatingcertificateAccount` rights to the base table and the stored procedure.</span></span>  
  
```  
GRANT SELECT   
   ON Purchasing.Vendor   
   TO TestCreditRatingcertificateAccount;  
GO  
  
GRANT EXECUTE   
   ON TestCreditRatingSP   
   TO TestCreditRatingcertificateAccount;  
GO  
```  
  
 <span data-ttu-id="9161c-146">Para obtener más información sobre cómo conceder permisos a los objetos, consulte [GRANT &#40;Transact-SQL&#41;](/sql/t-sql/statements/grant-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="9161c-146">For more information on granting permissions to objects, see [GRANT &#40;Transact-SQL&#41;](/sql/t-sql/statements/grant-transact-sql).</span></span>  
  
## <a name="6-display-the-access-context"></a><span data-ttu-id="9161c-147">6. Mostrar el contexto de acceso</span><span class="sxs-lookup"><span data-stu-id="9161c-147">6. Display the Access Context</span></span>  
 <span data-ttu-id="9161c-148">Para mostrar los derechos asociados al acceso al procedimiento almacenado, ejecute el siguiente código para conceder al usuario de `TestCreditRatingUser` los derechos para ejecutar el procedimiento almacenado.</span><span class="sxs-lookup"><span data-stu-id="9161c-148">To display the rights associated with the stored procedure access, run the following code to grant the rights to run the stored procedure to the `TestCreditRatingUser` user.</span></span>  
  
```  
GRANT EXECUTE   
   ON TestCreditRatingSP   
   TO TestCreditRatingUser;  
GO  
```  
  
 <span data-ttu-id="9161c-149">A continuación, ejecute el siguiente código para ejecutar el procedimiento almacenado como el inicio de sesión dbo que ha usado en el servidor.</span><span class="sxs-lookup"><span data-stu-id="9161c-149">Next, run the following code to run the stored procedure as the dbo login you used on the server.</span></span> <span data-ttu-id="9161c-150">Compruebe la salida de la información de contexto del usuario.</span><span class="sxs-lookup"><span data-stu-id="9161c-150">Observe the output of the user context information.</span></span> <span data-ttu-id="9161c-151">Mostrará la cuenta dbo como el contexto con sus derechos propios y no a través de una pertenencia a un grupo.</span><span class="sxs-lookup"><span data-stu-id="9161c-151">It will show the dbo account as the context with its own rights and not through a group membership.</span></span>  
  
```  
EXECUTE TestCreditRatingSP;  
GO  
```  
  
 <span data-ttu-id="9161c-152">Ejecute el siguiente código para que la instrucción `EXECUTE AS` se convierta en la cuenta `TestCreditRatingUser` y ejecute el procedimiento almacenado.</span><span class="sxs-lookup"><span data-stu-id="9161c-152">Run the following code to use the `EXECUTE AS` statement to become the `TestCreditRatingUser` account and run the stored procedure.</span></span> <span data-ttu-id="9161c-153">En esta ocasión, el contexto de usuario se establece en el contexto USER MAPPED TO CERTIFICATE.</span><span class="sxs-lookup"><span data-stu-id="9161c-153">This time you will see the user context is set to the USER MAPPED TO CERTIFICATE context.</span></span>  
  
```  
EXECUTE AS LOGIN = 'TestCreditRatingUser';  
GO  
EXECUTE TestCreditRatingSP;  
GO  
```  
  
 <span data-ttu-id="9161c-154">Se muestra la auditoría disponible porque ha firmado el procedimiento almacenado.</span><span class="sxs-lookup"><span data-stu-id="9161c-154">This shows you the auditing available because you signed the stored procedure.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="9161c-155">Use EXECUTE AS para cambiar contextos dentro de una base de datos.</span><span class="sxs-lookup"><span data-stu-id="9161c-155">Use EXECUTE AS to switch contexts within a database.</span></span>  
  
## <a name="7-reset-the-environment"></a><span data-ttu-id="9161c-156">7. Restablecer el entorno</span><span class="sxs-lookup"><span data-stu-id="9161c-156">7. Reset the Environment</span></span>  
 <span data-ttu-id="9161c-157">El código siguiente usa la instrucción `REVERT` para devolver el contexto de la cuenta actual a dbo y, a continuación, restablece el entorno.</span><span class="sxs-lookup"><span data-stu-id="9161c-157">The following code uses the `REVERT` statement to return the context of the current account to dbo, and resets the environment.</span></span>  
  
```  
REVERT;  
GO  
DROP PROCEDURE TestCreditRatingSP;  
GO  
DROP USER TestCreditRatingcertificateAccount;  
GO  
DROP USER TestCreditRatingUser;  
GO  
DROP LOGIN TestCreditRatingUser;  
GO  
DROP CERTIFICATE TestCreditRatingCer;  
GO  
```  
  
 <span data-ttu-id="9161c-158">Para obtener más información sobre la instrucción REVERT, consulte [REVERT &#40;Transact-SQL&#41;](/sql/t-sql/statements/revert-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="9161c-158">For more information about the REVERT statement, see [REVERT &#40;Transact-SQL&#41;](/sql/t-sql/statements/revert-transact-sql).</span></span>  
  
##  <a name="complete-example"></a><a name="CompleteExample"></a><span data-ttu-id="9161c-159">Ejemplo completo</span><span class="sxs-lookup"><span data-stu-id="9161c-159">Complete Example</span></span>  
 <span data-ttu-id="9161c-160">En esta sección se muestra el código de ejemplo completo.</span><span class="sxs-lookup"><span data-stu-id="9161c-160">This section displays the complete example code.</span></span>  
  
```  
/* Step 1 - Open the AdventureWorks2012 database */  
USE AdventureWorks2012;  
GO  
-- Set up a login for the test user  
CREATE LOGIN TestCreditRatingUser  
   WITH PASSWORD = 'ASDECd2439587y'  
GO  
CREATE USER TestCreditRatingUser  
FOR LOGIN TestCreditRatingUser;  
GO  
  
/* Step 2 - Create a certificate in the AdventureWorks2012 database */  
CREATE CERTIFICATE TestCreditRatingCer  
   ENCRYPTION BY PASSWORD = 'pGFD4bb925DGvbd2439587y'  
      WITH SUBJECT = 'Credit Rating Records Access',   
      EXPIRY_DATE = '12/05/2014';  
GO  
  
/* Step 3 - Create a stored procedure and  
sign it using the certificate */  
CREATE PROCEDURE TestCreditRatingSP  
AS  
BEGIN  
   -- Shows who is running the stored procedure  
   SELECT SYSTEM_USER 'system Login'  
   , USER AS 'Database Login'  
   , NAME AS 'Context'  
   , TYPE  
   , USAGE   
   FROM sys.user_token;     
  
   -- Now get the data  
   SELECT AccountNumber, Name, CreditRating   
   FROM Purchasing.Vendor  
   WHERE CreditRating = 1;  
END  
GO  
  
ADD SIGNATURE TO TestCreditRatingSP   
   BY CERTIFICATE TestCreditRatingCer  
    WITH PASSWORD = 'pGFD4bb925DGvbd2439587y';  
GO  
  
/* Step 4 - Create a database user for the certificate.   
This user has the ownership chain associated with it. */  
USE AdventureWorks2012;  
GO  
CREATE USER TestCreditRatingcertificateAccount  
   FROM CERTIFICATE TestCreditRatingCer;  
GO  
  
/* Step 5 - Grant the user database rights */  
GRANT SELECT   
   ON Purchasing.Vendor   
   TO TestCreditRatingcertificateAccount;  
GO  
  
GRANT EXECUTE  
   ON TestCreditRatingSP   
   TO TestCreditRatingcertificateAccount;  
GO  
  
/* Step 6 - Test, using the EXECUTE AS statement */  
GRANT EXECUTE   
   ON TestCreditRatingSP   
   TO TestCreditRatingUser;  
GO  
  
-- Run the procedure as the dbo user, notice the output for the type  
EXEC TestCreditRatingSP;  
GO  
  
EXECUTE AS LOGIN = 'TestCreditRatingUser';  
GO  
EXEC TestCreditRatingSP;  
GO  
  
/* Step 7 - Clean up the example */  
REVERT;  
GO  
DROP PROCEDURE TestCreditRatingSP;  
GO  
DROP USER TestCreditRatingcertificateAccount;  
GO  
DROP USER TestCreditRatingUser;  
GO  
DROP LOGIN TestCreditRatingUser;  
GO  
DROP CERTIFICATE TestCreditRatingCer;  
GO  
```  
  
## <a name="see-also"></a><span data-ttu-id="9161c-161">Consulte también</span><span class="sxs-lookup"><span data-stu-id="9161c-161">See Also</span></span>  
 [<span data-ttu-id="9161c-162">Centro de seguridad para el Motor de base de datos de SQL Server y Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="9161c-162">Security Center for SQL Server Database Engine and Azure SQL Database</span></span>](security/security-center-for-sql-server-database-engine-and-azure-sql-database.md)  
  
  
