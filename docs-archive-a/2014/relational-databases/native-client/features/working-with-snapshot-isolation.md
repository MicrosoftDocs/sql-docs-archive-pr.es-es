---
title: Trabajo con aislamiento de instantánea | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- data access [SQL Server Native Client], snapshot isolation
- SQLNCLI, snapshot isolation
- isolation levels [SQL Server], snapshot
- DBPROPSET_SESSION property set
- DBDROPSET_DATASOURCEINFO property set
- snapshot isolation [SQL Server Native Client]
- SQL Server Native Client OLE DB provider, snapshot isolation
- SQL Server Native Client ODBC driver, snapshot isolation
- SQL Server Native Client, snapshot isolation
- SQLGetInfo function
- concurrency [SQL Server Native Client]
- SQLSetConnectAttr function
ms.assetid: 39e87eb1-677e-45dd-bc61-83a4025a7756
author: rothja
ms.author: jroth
ms.openlocfilehash: 242d054a5fd2ad12a8811bebc834d423f547a499
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87675300"
---
# <a name="working-with-snapshot-isolation"></a><span data-ttu-id="cc2eb-102">Trabajar con aislamiento de instantánea</span><span class="sxs-lookup"><span data-stu-id="cc2eb-102">Working with Snapshot Isolation</span></span>
  [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] <span data-ttu-id="cc2eb-103">introdujo un nuevo nivel de aislamiento de "instantánea" pensado para mejorar la simultaneidad en las aplicaciones de procesamiento de transacciones en línea (OLTP).</span><span class="sxs-lookup"><span data-stu-id="cc2eb-103">introduced a new "snapshot" isolation level that is intended to enhance concurrency for online transaction processing (OLTP) applications.</span></span> <span data-ttu-id="cc2eb-104">En versiones anteriores de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], la simultaneidad se basada únicamente en el bloqueo, lo que podía provocar problemas de bloqueo e interbloqueo en algunas aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="cc2eb-104">In earlier versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], concurrency was based solely on locking, which can cause blocking and deadlocking problems for some applications.</span></span> <span data-ttu-id="cc2eb-105">El aislamiento de instantánea depende de las mejoras de las versiones de fila y está pensado para mejorar el rendimiento evitando situaciones de bloqueo de lectura-escritura.</span><span class="sxs-lookup"><span data-stu-id="cc2eb-105">Snapshot isolation depends on enhancements to row versioning and is intended to improve performance by avoiding reader-writer blocking scenarios.</span></span>  
  
 <span data-ttu-id="cc2eb-106">Las transacciones que se inician bajo el aislamiento de instantánea leen una instantánea de la base de datos realizada al comenzar la transacción.</span><span class="sxs-lookup"><span data-stu-id="cc2eb-106">Transactions that start under snapshot isolation read a database snapshot as of the time when the transaction starts.</span></span> <span data-ttu-id="cc2eb-107">Un resultado de esta acción es que los cursores estáticos, dinámicos y controlados por conjunto de claves, al abrirse dentro de un contexto de transacciones de instantánea, actúan de forma muy similar a los cursores estáticos que se abren desde transacciones serializables.</span><span class="sxs-lookup"><span data-stu-id="cc2eb-107">One result of this is that keyset, dynamic and static server cursors, when opened within a snapshot transaction context, behave much like static cursors opened within serializable transactions.</span></span> <span data-ttu-id="cc2eb-108">Sin embargo, cuando los cursores se abren bajo el nivel de aislamiento de instantánea no se toman bloqueos, lo que puede reducir el bloqueo en el servidor.</span><span class="sxs-lookup"><span data-stu-id="cc2eb-108">However, when the cursors are opened under the snapshot isolation level locks are not taken, which can reduce blocking on the server.</span></span>  
  
## <a name="sql-server-native-client-ole-db-provider"></a><span data-ttu-id="cc2eb-109">Proveedor OLE DB de SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="cc2eb-109">SQL Server Native Client OLE DB Provider</span></span>  
 <span data-ttu-id="cc2eb-110">El [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] proveedor de OLE DB de Native Client tiene mejoras que aprovechan el aislamiento de instantánea introducido en [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="cc2eb-110">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider has enhancements that take advantage of the snapshot isolation introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span> <span data-ttu-id="cc2eb-111">Estas mejoras incluyen cambios en los conjuntos de propiedades DBPROPSET_SESSION y DBPROPSET_DATASOURCEINFO.</span><span class="sxs-lookup"><span data-stu-id="cc2eb-111">These enhancements include changes to the DBPROPSET_DATASOURCEINFO and DBPROPSET_SESSION property sets.</span></span>  
  
### <a name="dbpropset_datasourceinfo"></a><span data-ttu-id="cc2eb-112">DBPROPSET_DATASOURCEINFO</span><span class="sxs-lookup"><span data-stu-id="cc2eb-112">DBPROPSET_DATASOURCEINFO</span></span>  
 <span data-ttu-id="cc2eb-113">El conjunto de propiedades DBPROPSET_DATASOURCEINFO ha cambiado para indicar que se admite el nivel de aislamiento de instantánea mediante la adición del valor DBPROPVAL_TI_SNAPSHOT que se utiliza en la propiedad DBPROP_SUPPORTEDTXNISOLEVELS.</span><span class="sxs-lookup"><span data-stu-id="cc2eb-113">The DBPROPSET_DATASOURCEINFO property set has been changed to indicate that the snapshot isolation level is supported by the addition of the DBPROPVAL_TI_SNAPSHOT value that is used in the DBPROP_SUPPORTEDTXNISOLEVELS property.</span></span> <span data-ttu-id="cc2eb-114">Este nuevo valor indica que se admite el nivel del aislamiento de instantánea independientemente de que se haya habilitado o no el control de versiones en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="cc2eb-114">This new value indicates that the snapshot isolation level is supported whether or not versioning has been enabled on the database.</span></span> <span data-ttu-id="cc2eb-115">A continuación se incluye una lista de los valores de DBPROP_SUPPORTEDTXNISOLEVELS:</span><span class="sxs-lookup"><span data-stu-id="cc2eb-115">The following is a list of the DBPROP_SUPPORTEDTXNISOLEVELS values:</span></span>  
  
|<span data-ttu-id="cc2eb-116">Id. de propiedad</span><span class="sxs-lookup"><span data-stu-id="cc2eb-116">Property ID</span></span>|<span data-ttu-id="cc2eb-117">Descripción</span><span class="sxs-lookup"><span data-stu-id="cc2eb-117">Description</span></span>|  
|-----------------|-----------------|  
|<span data-ttu-id="cc2eb-118">DBPROP_SUPPORTEDTXNISOLEVELS</span><span class="sxs-lookup"><span data-stu-id="cc2eb-118">DBPROP_SUPPORTEDTXNISOLEVELS</span></span>|<span data-ttu-id="cc2eb-119">Tipo: VT_I4</span><span class="sxs-lookup"><span data-stu-id="cc2eb-119">Type: VT_I4</span></span><br /><br /> <span data-ttu-id="cc2eb-120">L/E: de solo lectura</span><span class="sxs-lookup"><span data-stu-id="cc2eb-120">R/W: Read only</span></span><br /><br /> <span data-ttu-id="cc2eb-121">Descripción: una máscara de bits que especifica los niveles de aislamiento de transacción admitidos.</span><span class="sxs-lookup"><span data-stu-id="cc2eb-121">Description: A bitmask specifying the supported transaction isolation levels.</span></span> <span data-ttu-id="cc2eb-122">Combinación de cero o más de los siguientes elementos:</span><span class="sxs-lookup"><span data-stu-id="cc2eb-122">A combination of zero or more of the following:</span></span><br /><br /> <span data-ttu-id="cc2eb-123">-DBPROPVAL_TI_CHAOS</span><span class="sxs-lookup"><span data-stu-id="cc2eb-123">-   DBPROPVAL_TI_CHAOS</span></span><br /><span data-ttu-id="cc2eb-124">-DBPROPVAL_TI_READUNCOMMITTED</span><span class="sxs-lookup"><span data-stu-id="cc2eb-124">-   DBPROPVAL_TI_READUNCOMMITTED</span></span><br /><span data-ttu-id="cc2eb-125">-DBPROPVAL_TI_BROWSE</span><span class="sxs-lookup"><span data-stu-id="cc2eb-125">-   DBPROPVAL_TI_BROWSE</span></span><br /><span data-ttu-id="cc2eb-126">-DBPROPVAL_TI_CURSORSTABILITY</span><span class="sxs-lookup"><span data-stu-id="cc2eb-126">-   DBPROPVAL_TI_CURSORSTABILITY</span></span><br /><span data-ttu-id="cc2eb-127">-DBPROPVAL_TI_READCOMMITTED</span><span class="sxs-lookup"><span data-stu-id="cc2eb-127">-   DBPROPVAL_TI_READCOMMITTED</span></span><br /><span data-ttu-id="cc2eb-128">-DBPROPVAL_TI_REPEATABLEREAD</span><span class="sxs-lookup"><span data-stu-id="cc2eb-128">-   DBPROPVAL_TI_REPEATABLEREAD</span></span><br /><span data-ttu-id="cc2eb-129">-DBPROPVAL_TI_SERIALIZABLE</span><span class="sxs-lookup"><span data-stu-id="cc2eb-129">-   DBPROPVAL_TI_SERIALIZABLE</span></span><br /><span data-ttu-id="cc2eb-130">-DBPROPVAL_TI_ISOLATED</span><span class="sxs-lookup"><span data-stu-id="cc2eb-130">-   DBPROPVAL_TI_ISOLATED</span></span><br /><span data-ttu-id="cc2eb-131">-DBPROPVAL_TI_SNAPSHOT</span><span class="sxs-lookup"><span data-stu-id="cc2eb-131">-   DBPROPVAL_TI_SNAPSHOT</span></span>|  
  
### <a name="dbpropset_session"></a><span data-ttu-id="cc2eb-132">DBPROPSET_SESSION</span><span class="sxs-lookup"><span data-stu-id="cc2eb-132">DBPROPSET_SESSION</span></span>  
 <span data-ttu-id="cc2eb-133">El conjunto de propiedades DBPROPSET_SESSION ha cambiado para indicar que se admite el nivel de aislamiento de instantánea mediante la adición del valor DBPROPVAL_TI_SNAPSHOT que se utiliza en la propiedad DBPROP_SESS_AUTOCOMMITISOLEVELS.</span><span class="sxs-lookup"><span data-stu-id="cc2eb-133">The DBPROPSET_SESSION property set has been changed to indicate that the snapshot isolation level is supported by the addition of the DBPROPVAL_TI_SNAPSHOT value that is used in the DBPROP_SESS_AUTOCOMMITISOLEVELS property.</span></span> <span data-ttu-id="cc2eb-134">Este nuevo valor indica que se admite el nivel del aislamiento de instantánea independientemente de que se haya habilitado o no el control de versiones en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="cc2eb-134">This new value indicates that the snapshot isolation level is supported whether or not versioning has been enabled on the database.</span></span> <span data-ttu-id="cc2eb-135">A continuación se incluye una lista de los valores de DBPROP_SESS_AUTOCOMMITISOLEVELS:</span><span class="sxs-lookup"><span data-stu-id="cc2eb-135">The following is a list of the DBPROP_SESS_AUTOCOMMITISOLEVELS values:</span></span>  
  
|<span data-ttu-id="cc2eb-136">Id. de propiedad</span><span class="sxs-lookup"><span data-stu-id="cc2eb-136">Property ID</span></span>|<span data-ttu-id="cc2eb-137">Descripción</span><span class="sxs-lookup"><span data-stu-id="cc2eb-137">Description</span></span>|  
|-----------------|-----------------|  
|<span data-ttu-id="cc2eb-138">DBPROP_SESS_AUTOCOMMITISOLEVELS</span><span class="sxs-lookup"><span data-stu-id="cc2eb-138">DBPROP_SESS_AUTOCOMMITISOLEVELS</span></span>|<span data-ttu-id="cc2eb-139">Tipo: VT_I4</span><span class="sxs-lookup"><span data-stu-id="cc2eb-139">Type: VT_I4</span></span><br /><br /> <span data-ttu-id="cc2eb-140">L/E: de solo lectura</span><span class="sxs-lookup"><span data-stu-id="cc2eb-140">R/W: Read only</span></span><br /><br /> <span data-ttu-id="cc2eb-141">Descripción: especifica una máscara de bits que indica el nivel de aislamiento de transacción mientras está activo el modo de confirmación automática.</span><span class="sxs-lookup"><span data-stu-id="cc2eb-141">Description: Specifies a bitmask that indicates the transaction isolation level while in auto-commit mode.</span></span> <span data-ttu-id="cc2eb-142">Los valores que se pueden establecer en esta máscara de bits son iguales a los que se pueden establecer para DBPROP_SUPPORTEDTXNISOLEVELS.</span><span class="sxs-lookup"><span data-stu-id="cc2eb-142">The values that can be set in this bitmask are the same as those that can be set for DBPROP_SUPPORTEDTXNISOLEVELS.</span></span>|  
  
> [!NOTE]  
>  <span data-ttu-id="cc2eb-143">Si se establece DBPROPVAL_TI_SNAPSHOT con las versiones de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] anteriores a [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], se generan los errores DB_S_ERRORSOCCURRED o DB_E_ERRORSOCCURRED.</span><span class="sxs-lookup"><span data-stu-id="cc2eb-143">The errors DB_S_ERRORSOCCURRED or DB_E_ERRORSOCCURRED will occur if DBPROPVAL_TI_SNAPSHOT is set when using versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] earlier than [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span>  
  
 <span data-ttu-id="cc2eb-144">Para más información sobre cómo se admite el aislamiento de instantánea en transacciones, consulte [Compatibilidad con transacciones locales](../../native-client-ole-db-transactions/transactions.md).</span><span class="sxs-lookup"><span data-stu-id="cc2eb-144">For information about how snapshot isolation is supported in transactions, see [Supporting Local Transactions](../../native-client-ole-db-transactions/transactions.md).</span></span>  
  
## <a name="sql-server-native-client-odbc-driver"></a><span data-ttu-id="cc2eb-145">Controlador ODBC de SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="cc2eb-145">SQL Server Native Client ODBC Driver</span></span>  
 <span data-ttu-id="cc2eb-146">El [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] controlador ODBC de Native Client proporciona compatibilidad para el aislamiento de instantáneas a través de las mejoras realizadas en las funciones [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) y [SQLGetInfo](../../native-client-odbc-api/sqlgetinfo.md) .</span><span class="sxs-lookup"><span data-stu-id="cc2eb-146">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver provides support for snapshot isolation though enhancements made to the [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) and [SQLGetInfo](../../native-client-odbc-api/sqlgetinfo.md) functions.</span></span>  
  
### <a name="sqlsetconnectattr"></a><span data-ttu-id="cc2eb-147">SQLSetConnectAttr</span><span class="sxs-lookup"><span data-stu-id="cc2eb-147">SQLSetConnectAttr</span></span>  
 <span data-ttu-id="cc2eb-148">La función **SQLSetConnectAttr** admite ahora el uso del atributo SQL_COPT_SS_TXN_ISOLATION.</span><span class="sxs-lookup"><span data-stu-id="cc2eb-148">The **SQLSetConnectAttr** function now supports the use of the SQL_COPT_SS_TXN_ISOLATION attribute.</span></span> <span data-ttu-id="cc2eb-149">Si SQL_COPT_SS_TXN_ISOLATION se establece en SQL_TXN_SS_SNAPSHOT, significa que la transacción tendrá lugar en el nivel de aislamiento de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="cc2eb-149">Setting SQL_COPT_SS_TXN_ISOLATION to SQL_TXN_SS_SNAPSHOT indicates that the transaction will take place under the snapshot isolation level.</span></span>  
  
### <a name="sqlgetinfo"></a><span data-ttu-id="cc2eb-150">SQLGetInfo</span><span class="sxs-lookup"><span data-stu-id="cc2eb-150">SQLGetInfo</span></span>  
 <span data-ttu-id="cc2eb-151">La función [SQLGetInfo](../../native-client-odbc-api/sqlgetinfo.md) admite ahora el valor SQL_TXN_SS_SNAPSHOT que se ha agregado al tipo de información SQL_TXN_ISOLATION_OPTION.</span><span class="sxs-lookup"><span data-stu-id="cc2eb-151">The [SQLGetInfo](../../native-client-odbc-api/sqlgetinfo.md) function now supports the SQL_TXN_SS_SNAPSHOT value that has been added to the SQL_TXN_ISOLATION_OPTION info type.</span></span>  
  
 <span data-ttu-id="cc2eb-152">Para obtener información sobre cómo se admite el aislamiento de instantáneas en transacciones, vea [cursor TRANSACTION ISOLATION LEVEL](../../native-client-odbc-cursors/properties/cursor-transaction-isolation-level.md).</span><span class="sxs-lookup"><span data-stu-id="cc2eb-152">For information about how snapshot isolation is supported in transactions, see [Cursor Transaction Isolation Level](../../native-client-odbc-cursors/properties/cursor-transaction-isolation-level.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="cc2eb-153">Consulte también</span><span class="sxs-lookup"><span data-stu-id="cc2eb-153">See Also</span></span>  
 <span data-ttu-id="cc2eb-154">[Características de SQL Server Native Client](sql-server-native-client-features.md) </span><span class="sxs-lookup"><span data-stu-id="cc2eb-154">[SQL Server Native Client Features](sql-server-native-client-features.md) </span></span>  
 [<span data-ttu-id="cc2eb-155">Propiedades y comportamientos de conjuntos de filas</span><span class="sxs-lookup"><span data-stu-id="cc2eb-155">Rowset Properties and Behaviors</span></span>](../../native-client-ole-db-rowsets/rowset-properties-and-behaviors.md)  
  
  
