---
title: Trabajar con notificaciones de consulta | Microsoft Docs
ms.custom: ''
ms.date: 04/27/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- data access [SQL Server Native Client], query notifications
- rowsets [SQL Server], notifications
- SQL Server Native Client, query notifications
- notifications [SQL Server Native Client]
- query notifications [SQL Server], SQL Server Native Client
- canceling rowset changes
- IRowsetNotify interface
- SQLNCLI, query notifications
- SQL Server Native Client OLE DB provider, query notifications
- consumer notification for rowset changes [SQL Server Native Client]
ms.assetid: 2f906fff-5ed9-4527-9fd3-9c0d27c3dff7
author: rothja
ms.author: jroth
ms.openlocfilehash: ba30bfc8df05a55e297ae8fcb8e2253de57e3ca6
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87675304"
---
# <a name="working-with-query-notifications"></a><span data-ttu-id="7e2c2-102">Trabajar con notificaciones de consulta</span><span class="sxs-lookup"><span data-stu-id="7e2c2-102">Working with Query Notifications</span></span>
  <span data-ttu-id="7e2c2-103">Las notificaciones de consulta se introdujeron con [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] y [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-103">Query notifications were introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] and [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client.</span></span> <span data-ttu-id="7e2c2-104">Las notificaciones de consulta, creadas a partir de la infraestructura de Service Broker introducida en [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], permiten notificar a las aplicaciones si los datos han cambiado.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-104">Built upon the Service Broker infrastructure introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], query notifications allow applications to be notified when data has changed.</span></span> <span data-ttu-id="7e2c2-105">Esta característica resulta especialmente útil para las aplicaciones que proporcionan una caché de información de una base de datos, como una aplicación web, y necesitan recibir notificaciones si se modifican los datos de origen.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-105">This feature is particularly useful for applications that provide a cache of information from a database, such as a Web application, and need to be notified when the source data is changed.</span></span>  
  
 <span data-ttu-id="7e2c2-106">Las notificaciones de consulta permiten al usuario solicitar notificaciones dentro de un período de tiempo de espera especificado si se modifican los datos subyacentes de una consulta.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-106">Query notifications allow you to request notification within a specified time-out period when the underlying data of a query changes.</span></span> <span data-ttu-id="7e2c2-107">La solicitud de notificación especifica las opciones de notificación, entre las que se incluyen el nombre de servicio, el texto del mensaje y el valor de tiempo de espera para el servidor.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-107">The request for notification specifies the notification options, which include the service name, message text, and time-out value to the server.</span></span> <span data-ttu-id="7e2c2-108">Las notificaciones se entregan a través de una cola de Service Broker que las aplicaciones pueden sondear de cara a las notificaciones disponibles.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-108">Notifications are delivered through a Service Broker queue that applications may poll for available notifications.</span></span>  
  
 <span data-ttu-id="7e2c2-109">La sintaxis de la cadena de opciones de notificación de consulta es la siguiente:</span><span class="sxs-lookup"><span data-stu-id="7e2c2-109">The syntax of the query notifications options string is:</span></span>  
  
 `service=<service-name>[;(local database=<database> | broker instance=<broker instance>)]`  
  
 <span data-ttu-id="7e2c2-110">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="7e2c2-110">For example:</span></span>  
  
 `service=mySSBService;local database=mydb`  
  
 <span data-ttu-id="7e2c2-111">Las suscripciones de notificación duran más que el proceso que las inicia, de modo que una aplicación puede crear una suscripción de notificación y, a continuación, terminar.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-111">Notification subscriptions outlive the process that initiates them, as an application may create a notification subscription and then terminate.</span></span> <span data-ttu-id="7e2c2-112">La suscripción seguirá siendo válida y la notificación se producirá si los datos cambian dentro del período de tiempo de espera especificado al crear la suscripción.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-112">The subscription remains valid, and the notification will occur if the data changes within the time-out period specified when the subscription was created.</span></span> <span data-ttu-id="7e2c2-113">Una notificación se identifica mediante la consulta ejecutada, las opciones de notificación y el texto del mensaje, y puede cancelarse estableciendo su valor de tiempo de espera en cero.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-113">A notification is identified by the query executed, the notification options, and the message text, and may be cancelled by setting its time-out value to zero.</span></span>  
  
 <span data-ttu-id="7e2c2-114">Las notificaciones se envían una sola vez.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-114">Notifications are sent only once.</span></span> <span data-ttu-id="7e2c2-115">Para obtener notificaciones continuas de cambios de datos, debe crearse una nueva suscripción ejecutando de nuevo la consulta después de procesar cada notificación.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-115">For continuous notification of data change, a new subscription must be created by re-executing the query after each notification is processed.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]<span data-ttu-id="7e2c2-116">Normalmente, las aplicaciones cliente nativas reciben notificaciones mediante el [!INCLUDE[tsql](../../../includes/tsql-md.md)] comando [Receive](/sql/t-sql/statements/receive-transact-sql) para leer las notificaciones de la cola asociada al servicio especificado en las opciones de notificación.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-116">Native Client applications typically receive notifications by using the [!INCLUDE[tsql](../../../includes/tsql-md.md)] [RECEIVE](/sql/t-sql/statements/receive-transact-sql) command to read notifications from the queue associated with the service specified in the notification options.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="7e2c2-117">Los nombres de tabla deben calificarse en las consultas para las que se requiere notificación como, por ejemplo, `dbo.myTable`.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-117">Table names must be qualified in queries for which notification is required, for example, `dbo.myTable`.</span></span> <span data-ttu-id="7e2c2-118">Las tablas deben calificarse con nombres de dos partes.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-118">Table names must be qualified with two part names.</span></span> <span data-ttu-id="7e2c2-119">La suscripción no será válida si se usan nombres de tres o cuatro partes.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-119">Subscription is invalid if three- or four-part names are used.</span></span>  
  
 <span data-ttu-id="7e2c2-120">La infraestructura de notificación se crea a partir una característica de colas introducida en [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span><span class="sxs-lookup"><span data-stu-id="7e2c2-120">The notification infrastructure is built on top of a queuing feature introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span> <span data-ttu-id="7e2c2-121">Normalmente, las notificaciones generadas en el servidor se envían a través de estas colas para procesarse más adelante.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-121">In general, notifications generated at the server are sent through these queues to be processed later.</span></span>  
  
 <span data-ttu-id="7e2c2-122">Para poder usar notificaciones de consulta, debe haber una cola y un servicio en el servidor.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-122">To use query notifications a queue and a service must exist on the server.</span></span> <span data-ttu-id="7e2c2-123">Pueden crearse utilizando código [!INCLUDE[tsql](../../../includes/tsql-md.md)] similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="7e2c2-123">These can be created using [!INCLUDE[tsql](../../../includes/tsql-md.md)] similar to the following:</span></span>  
  
```  
CREATE QUEUE myQueue  
CREATE SERVICE myService ON QUEUE myQueue   
  
([https://schemas.microsoft.com/SQL/Notifications/PostQueryNotification])  
```  
  
> [!NOTE]  
>  <span data-ttu-id="7e2c2-124">El servicio debe usar el contrato predefinido `https://schemas.microsoft.com/SQL/Notifications/PostQueryNotification`, tal y como se indicó anteriormente.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-124">The service must use the predefined contract `https://schemas.microsoft.com/SQL/Notifications/PostQueryNotification` as shown above.</span></span>  
  
## <a name="sql-server-native-client-ole-db-provider"></a><span data-ttu-id="7e2c2-125">Proveedor OLE DB de SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="7e2c2-125">SQL Server Native Client OLE DB Provider</span></span>  
 <span data-ttu-id="7e2c2-126">El [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] proveedor de OLE DB de Native Client admite la notificación de consumidor en la modificación del conjunto de filas.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-126">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports consumer notification on rowset modification.</span></span> <span data-ttu-id="7e2c2-127">El consumidor recibe notificaciones en cada fase de modificación del conjunto de filas y ante cualquiera intento de modificación.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-127">The consumer receives notification at every phase of rowset modification and on any attempted change.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="7e2c2-128">Pasar una consulta de notificaciones al servidor con **ICommand:: Execute** es la única manera válida de suscribirse a las notificaciones de consulta con el [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] proveedor de OLE DB de Native Client.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-128">Passing a notifications query to the server with **ICommand::Execute** is the only valid way to subscribe to query notifications with the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider.</span></span>  
  
### <a name="the-dbpropset_sqlserverrowset-property-set"></a><span data-ttu-id="7e2c2-129">Conjunto de propiedades DBPROPSET_SQLSERVERROWSET</span><span class="sxs-lookup"><span data-stu-id="7e2c2-129">The DBPROPSET_SQLSERVERROWSET Property Set</span></span>  
 <span data-ttu-id="7e2c2-130">Para admitir las notificaciones de consulta a través de OLE DB, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client agrega las siguientes propiedades nuevas al conjunto de propiedades DBPROPSET_SQLSERVERROWSET.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-130">In order to support query notifications through OLE DB, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client adds the following new properties to the DBPROPSET_SQLSERVERROWSET property set.</span></span>  
  
|<span data-ttu-id="7e2c2-131">Nombre</span><span class="sxs-lookup"><span data-stu-id="7e2c2-131">Name</span></span>|<span data-ttu-id="7e2c2-132">Tipo</span><span class="sxs-lookup"><span data-stu-id="7e2c2-132">Type</span></span>|<span data-ttu-id="7e2c2-133">Descripción</span><span class="sxs-lookup"><span data-stu-id="7e2c2-133">Description</span></span>|  
|----------|----------|-----------------|  
|<span data-ttu-id="7e2c2-134">SSPROP_QP_NOTIFICATION_TIMEOUT</span><span class="sxs-lookup"><span data-stu-id="7e2c2-134">SSPROP_QP_NOTIFICATION_TIMEOUT</span></span>|<span data-ttu-id="7e2c2-135">VT_UI4</span><span class="sxs-lookup"><span data-stu-id="7e2c2-135">VT_UI4</span></span>|<span data-ttu-id="7e2c2-136">Número de segundos que la notificación de consulta va a permanecer activa.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-136">The number of seconds that the query notification is to remain active.</span></span><br /><br /> <span data-ttu-id="7e2c2-137">El valor predeterminado es 432000 segundos (5 días).</span><span class="sxs-lookup"><span data-stu-id="7e2c2-137">The default is 432000 seconds (5 days).</span></span> <span data-ttu-id="7e2c2-138">El valor mínimo es 1 segundo y el valor máximo es 2^31-1 segundos.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-138">The minimum value is 1 second, and the maximum value is 2^31-1 seconds.</span></span>|  
|<span data-ttu-id="7e2c2-139">SSPROP_QP_NOTIFICATION_MSGTEXT</span><span class="sxs-lookup"><span data-stu-id="7e2c2-139">SSPROP_QP_NOTIFICATION_MSGTEXT</span></span>|<span data-ttu-id="7e2c2-140">VT_BSTR</span><span class="sxs-lookup"><span data-stu-id="7e2c2-140">VT_BSTR</span></span>|<span data-ttu-id="7e2c2-141">Texto del mensaje de la notificación.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-141">The message text of the notification.</span></span> <span data-ttu-id="7e2c2-142">Lo define el usuario y no tiene ningún formato predefinido.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-142">This is user defined, and has no predefined format.</span></span><br /><br /> <span data-ttu-id="7e2c2-143">De forma predeterminada, la cadena está vacía.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-143">By default, the string is empty.</span></span> <span data-ttu-id="7e2c2-144">Puede especificarse un mensaje usando de 1 a 2000 caracteres.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-144">You can specify a message using 1-2000 characters.</span></span>|  
|<span data-ttu-id="7e2c2-145">SSPROP_QP_NOTIFICATION_OPTIONS</span><span class="sxs-lookup"><span data-stu-id="7e2c2-145">SSPROP_QP_NOTIFICATION_OPTIONS</span></span>|<span data-ttu-id="7e2c2-146">VT_BSTR</span><span class="sxs-lookup"><span data-stu-id="7e2c2-146">VT_BSTR</span></span>|<span data-ttu-id="7e2c2-147">Opciones de notificación de consulta.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-147">The query notification options.</span></span> <span data-ttu-id="7e2c2-148">Se especifican en una cadena con la sintaxis del valor de *nombre* = *value* .</span><span class="sxs-lookup"><span data-stu-id="7e2c2-148">These are specified in a string with *name*=*value* syntax.</span></span> <span data-ttu-id="7e2c2-149">El usuario es responsable de la creación del servicio y de la lectura de las notificaciones fuera de la cola.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-149">The user is responsible for creating the service and reading notifications off of the queue.</span></span><br /><br /> <span data-ttu-id="7e2c2-150">El valor predeterminado es una cadena vacía.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-150">The default is an empty string.</span></span>|  
  
 <span data-ttu-id="7e2c2-151">La suscripción de notificación se confirma siempre, independientemente de que la instrucción se haya ejecutado en una transacción de usuario o en una confirmación automática o de que la transacción en la que se haya ejecutado la instrucción se haya confirmado o revertido.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-151">The notification subscription is always committed, regardless of whether the statement ran in a user transaction or in auto commit or whether the transaction in which the statement ran committed or rolled back.</span></span> <span data-ttu-id="7e2c2-152">La notificación del servidor se activa ante cualquiera de las siguientes condiciones de notificación no válida: cambio de esquema o datos subyacentes o cuando se alcanza el período de tiempo de espera, lo que ocurra antes.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-152">The server notification fires upon any of the following invalid notification conditions: change of underlying data or schema, or when the timeout period is reached; whichever is first.</span></span> <span data-ttu-id="7e2c2-153">Los registros de notificación se eliminan en cuanto se activan.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-153">Notification registrations are deleted as soon as they are fired.</span></span> <span data-ttu-id="7e2c2-154">Por lo tanto, al recibir las notificaciones, la aplicación debe suscribirse de nuevo en caso de que deseen obtenerse actualizaciones posteriores.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-154">Hence upon receiving notifications, the application must subscribe again in case they want to get further updates.</span></span>  
  
 <span data-ttu-id="7e2c2-155">Otra conexión o subproceso puede comprobar las notificaciones en la cola de destino.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-155">Another connection or thread can check the destination queue for notifications.</span></span> <span data-ttu-id="7e2c2-156">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="7e2c2-156">For example:</span></span>  
  
```  
WAITFOR (RECEIVE * FROM MyQueue);   // Where MyQueue is the queue name.   
```  
  
 <span data-ttu-id="7e2c2-157">Tenga en cuenta que SELECT \* no elimina la entrada de la cola; en cambio, RECEIVE \* FROM sí que la elimina.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-157">Note that SELECT \* does not delete the entry from the Queue, however RECEIVE \* FROM does.</span></span> <span data-ttu-id="7e2c2-158">Esto detiene un subproceso del servidor si la cola está vacía.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-158">This stalls a server thread if the queue is empty.</span></span> <span data-ttu-id="7e2c2-159">Si hay entradas en la cola en el momento de la llamada, se devuelven inmediatamente; de lo contrario, la llamada espera a que se realice una entrada en la cola.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-159">If there are queue entries at the time of the call, they are returned immediately; otherwise the call waits until a queue entry is made.</span></span>  
  
```  
RECEIVE * FROM MyQueue  
```  
  
 <span data-ttu-id="7e2c2-160">Si la cola está vacía, esta instrucción devuelve inmediatamente un conjunto de resultados vacío; de lo contrario, devuelve todas las notificaciones en cola.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-160">This statement immediately returns an empty result set if the queue is empty; otherwise it returns all queue notifications.</span></span>  
  
 <span data-ttu-id="7e2c2-161">Si los valores SSPROP_QP_NOTIFICATION_MSGTEXT y SSPROP_QP_NOTIFICATION_OPTIONS son distintos de NULL y no están vacíos, el encabezado TDS de notificación de consulta que contiene las tres propiedades definidas anteriormente se envía al servidor cada vez que se ejecuta el comando.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-161">If SSPROP_QP_NOTIFICATION_MSGTEXT and SSPROP_QP_NOTIFICATION_OPTIONS are non-NULL and non-empty, the query notifications TDS header containing the three properties defined above are sent to the server with each execution of the command.</span></span> <span data-ttu-id="7e2c2-162">Si alguno de estos valores es NULL (o está vacío), el encabezado no se envía y se produce un error DB_E_ERRORSOCCURRED (o DB_S_ERRORSOCCURRED si ambas propiedades están marcadas como opcionales) y el valor de estado se establece en DBPROPSTATUS_BADVALUE.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-162">If either of them is null (or empty), the header is not sent and DB_E_ERRORSOCCURRED is raised, (or DB_S_ERRORSOCCURRED if the properties are both marked as optional), and the status value is set to DBPROPSTATUS_BADVALUE.</span></span> <span data-ttu-id="7e2c2-163">La validación se produce durante la ejecución y preparación.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-163">The validation occurs on Execute/Prepare.</span></span> <span data-ttu-id="7e2c2-164">Del mismo modo, se produce un error DB_S_ERRORSOCCURED cuando las propiedades de notificación de consulta se establecen para conexiones con versiones de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] anteriores a [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span><span class="sxs-lookup"><span data-stu-id="7e2c2-164">Similarly, DB_S_ERRORSOCCURED is raised when the query notification properties are set for connections to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] versions before [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span> <span data-ttu-id="7e2c2-165">En este caso, el valor de estado es DBPROPSTATUS_NOTSUPPORTED.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-165">The status value in this case is DBPROPSTATUS_NOTSUPPORTED.</span></span>  
  
 <span data-ttu-id="7e2c2-166">Iniciar una suscripción no garantiza que los mensajes posteriores se entregarán correctamente.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-166">Initiating a subscription does not guarantee that subsequent messages will be successfully delivered.</span></span> <span data-ttu-id="7e2c2-167">Además, no se realiza ninguna comprobación de validez del nombre de servicio especificado.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-167">In addition, no check is made as to the validity of the service name specified.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="7e2c2-168">La preparación de instrucciones no hará nunca que se inicie una suscripción; esta acción solo se consigue mediante la ejecución de instrucciones, y las notificaciones de consulta no se verán afectadas por el uso de los servicios principales de OLE DB.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-168">Preparing statements will never cause the subscription to be initiated; only statement execution will achieve this and query notifications are not impacted by the use of OLE DB core services.</span></span>  
  
 <span data-ttu-id="7e2c2-169">Para obtener más información sobre el conjunto de propiedades DBPROPSET_SQLSERVERROWSET, vea [propiedades y comportamientos de conjuntos de filas](../../native-client-ole-db-rowsets/rowset-properties-and-behaviors.md).</span><span class="sxs-lookup"><span data-stu-id="7e2c2-169">For more information about the DBPROPSET_SQLSERVERROWSET property set, see [Rowset Properties and Behaviors](../../native-client-ole-db-rowsets/rowset-properties-and-behaviors.md).</span></span>  
  
## <a name="sql-server-native-client-odbc-driver"></a><span data-ttu-id="7e2c2-170">Controlador ODBC de SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="7e2c2-170">SQL Server Native Client ODBC Driver</span></span>  
 <span data-ttu-id="7e2c2-171">El [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] controlador ODBC de Native Client admite las notificaciones de consulta mediante la adición de tres nuevos atributos a las funciones [SQLGetStmtAttr](../../native-client-odbc-api/sqlgetstmtattr.md) y [SQLSetStmtAttr](../../native-client-odbc-api/sqlsetstmtattr.md) :</span><span class="sxs-lookup"><span data-stu-id="7e2c2-171">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver supports query notifications through the addition of three new attributes to the [SQLGetStmtAttr](../../native-client-odbc-api/sqlgetstmtattr.md) and [SQLSetStmtAttr](../../native-client-odbc-api/sqlsetstmtattr.md) functions:</span></span>  
  
-   <span data-ttu-id="7e2c2-172">SQL_SOPT_SS_QUERYNOTIFICATION_MSGTEXT</span><span class="sxs-lookup"><span data-stu-id="7e2c2-172">SQL_SOPT_SS_QUERYNOTIFICATION_MSGTEXT</span></span>  
  
-   <span data-ttu-id="7e2c2-173">SQL_SOPT_SS_QUERYNOTIFICATION_OPTIONS</span><span class="sxs-lookup"><span data-stu-id="7e2c2-173">SQL_SOPT_SS_QUERYNOTIFICATION_OPTIONS</span></span>  
  
-   <span data-ttu-id="7e2c2-174">SQL_SOPT_SS_QUERYNOTIFICATION_TIMEOUT</span><span class="sxs-lookup"><span data-stu-id="7e2c2-174">SQL_SOPT_SS_QUERYNOTIFICATION_TIMEOUT</span></span>  
  
 <span data-ttu-id="7e2c2-175">Si los valores de SQL_SOPT_SS_QUERYNOTIFICATION_MSGTEXT y SQL_SOPT_SS_QUERYNOTIFICATION_OPTIONS son distintos de NULL, el encabezado TDS de notificación de consulta que contiene los tres atributos definidos anteriormente se enviará al servidor cada vez que se ejecute el comando.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-175">If SQL_SOPT_SS_QUERYNOTIFICATION_MSGTEXT and SQL_SOPT_SS_QUERYNOTIFICATION_OPTIONS are not NULL, the query notifications TDS header containing the three attributes defined above will be sent to the server each time the command is executed.</span></span> <span data-ttu-id="7e2c2-176">Si alguno de estos valores es NULL, el encabezado no se envía y se devuelve SQL_SUCCESS_WITH_INFO.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-176">If either of them is null, the header is not sent, and SQL_SUCCESS_WITH_INFO is returned.</span></span> <span data-ttu-id="7e2c2-177">La validación se produce en la [función SQLPrepare](https://go.microsoft.com/fwlink/?LinkId=59360), **SqlExecDirect**y **SqlExecute**, y todas ellas generan un error si los atributos no son válidos.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-177">The validation occurs on [SQLPrepare Function](https://go.microsoft.com/fwlink/?LinkId=59360), **SqlExecDirect**, and **SqlExecute**, all of which fail if the attributes are not valid.</span></span> <span data-ttu-id="7e2c2-178">Del mismo modo, cuando estos atributos de notificación de consulta se establecen para versiones de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] anteriores a [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], se produce un error de ejecución con SQL_SUCCESS_WITH_INFO.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-178">Similarly, when these query notification attributes are set for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] versions before [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], the execution fails with SQL_SUCCESS_WITH_INFO.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="7e2c2-179">La preparación de instrucciones no hará que se inicie nunca la suscripción; la ejecución de la instrucción sí que puede iniciar la suscripción.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-179">Prepare statements will never cause the subscription to be initiated; subscription can be initiated by statement execution.</span></span>  
  
## <a name="special-cases-and-restrictions"></a><span data-ttu-id="7e2c2-180">Restricciones y casos especiales</span><span class="sxs-lookup"><span data-stu-id="7e2c2-180">Special Cases and Restrictions</span></span>  
 <span data-ttu-id="7e2c2-181">Las notificaciones no admiten los siguientes tipos de datos:</span><span class="sxs-lookup"><span data-stu-id="7e2c2-181">The following data types are not supported for notifications:</span></span>  
  
-   `text`  
  
-   `ntext`  
  
-   `image`  
  
 <span data-ttu-id="7e2c2-182">Si se realiza una solicitud de notificación para una consulta que devuelve cualquiera de estos tipos, la notificación se activa inmediatamente, especificando que no fue posible la suscripción de notificación.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-182">If a notification request is made for a query which returns any of these types, the notification fires immediately, specifying that notification subscription was not possible.</span></span>  
  
 <span data-ttu-id="7e2c2-183">Cuando se realiza una solicitud de suscripción para un lote o procedimiento almacenado, se realiza una solicitud de suscripción independiente para cada instrucción del lote o procedimiento almacenado.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-183">If a subscription request is made for a batch or stored procedure, a separate subscription request is made for each statement executed within the batch or stored procedure.</span></span> <span data-ttu-id="7e2c2-184">Las instrucciones EXECUTE no registrarán ninguna notificación, pero enviarán la solicitud de notificación al comando ejecutado.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-184">EXECUTE statements will not register a notification, but will send the notification request to the executed command.</span></span> <span data-ttu-id="7e2c2-185">Si se trata de un lote, el contexto se aplicará a las instrucciones ejecutadas y se aplicarán las mismas reglas descritas anteriormente.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-185">If it is a batch, the context will be applied to the executed statements and the same rules described above apply.</span></span>  
  
 <span data-ttu-id="7e2c2-186">El envío de una consulta de notificación enviada por el mismo usuario en el mismo contexto de base de datos y que tiene la misma plantilla, los mismos valores de parámetro, el mismo identificador de notificación y la misma ubicación de entrega de una suscripción activa existente, renovará la suscripción existente y restablecerá el nuevo tiempo de espera especificado. Esto significa que si se solicita una notificación para consultas idénticas, solo se enviará una notificación.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-186">Submission of a query for notification that was submitted by the same user under the same database context and has the same template, same parameter values, same notification ID, and same delivery location of an existing active subscription, will renew the existing subscription, resetting the new specified time-out. This means that if notification is requested for identical queries, only one notification will be sent.</span></span> <span data-ttu-id="7e2c2-187">Esto se aplicaría a una consulta duplicada de un lote o si se llamó varias veces a una consulta de un procedimiento almacenado.</span><span class="sxs-lookup"><span data-stu-id="7e2c2-187">This would apply to a query duplicated in a batch, or a query in a stored procedure that was called multiple times.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="7e2c2-188">Consulte también</span><span class="sxs-lookup"><span data-stu-id="7e2c2-188">See Also</span></span>  
 [<span data-ttu-id="7e2c2-189">Características de SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="7e2c2-189">SQL Server Native Client Features</span></span>](sql-server-native-client-features.md)  
  
  
