---
title: Uso de la creación de reflejo de la base de datos | Microsoft Docs
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- database mirroring [SQL Server], interoperability
- SQL Server Native Client, database mirroring
- data access [SQL Server Native Client], database mirroring
- database mirroring [SQL Server], connecting clients to
- SQLNCLI, database mirroring
- SQL Server Native Client ODBC driver, database mirroring
- SQL Server Native Client OLE DB provider, database mirroring
ms.assetid: 71b15712-7972-4465-9274-e0ddc271eedc
author: rothja
ms.author: jroth
ms.openlocfilehash: 389036322137abcc9a40e36c697e8d45e39a7de5
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87669651"
---
# <a name="using-database-mirroring"></a><span data-ttu-id="09b12-102">Usar la creación de reflejo de bases de datos</span><span class="sxs-lookup"><span data-stu-id="09b12-102">Using Database Mirroring</span></span>
    
> [!NOTE]  
>  [!INCLUDE[ssNoteDepFutureAvoid](../../../includes/ssnotedepfutureavoid-md.md)] <span data-ttu-id="09b12-103">Se usa [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] en su lugar.</span><span class="sxs-lookup"><span data-stu-id="09b12-103">Use [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] instead.</span></span>  
  
 <span data-ttu-id="09b12-104">La creación de reflejo de la base de datos, introducida en [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], es una solución de software para aumentar la disponibilidad de la base de datos y la redundancia de datos.</span><span class="sxs-lookup"><span data-stu-id="09b12-104">Database mirroring, introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], is a solution for increasing database availability and data redundancy.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]<span data-ttu-id="09b12-105">Native Client proporciona compatibilidad implícita con la creación de reflejo de la base de datos, por lo que el desarrollador no necesita escribir código ni realizar ninguna otra acción una vez configurado para la base de datos.</span><span class="sxs-lookup"><span data-stu-id="09b12-105">Native Client provides implicit support for database mirroring, so the developer does not need to write any code or take any other action once it has been configured for the database.</span></span>  
  
 <span data-ttu-id="09b12-106">La creación de reflejo de la base de datos, implementada para cada base de datos, conserva una copia de una base de datos de producción de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] en un servidor en espera.</span><span class="sxs-lookup"><span data-stu-id="09b12-106">Database mirroring, which is implemented on a per-database basis, keeps a copy of a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] production database on a standby server.</span></span> <span data-ttu-id="09b12-107">Este servidor puede ser un servidor en estado de espera activa o semiactiva, dependiendo de la configuración y del estado de la sesión de creación de reflejo de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="09b12-107">This server is either a hot or warm standby server, depending on the configuration and state of the database mirroring session.</span></span> <span data-ttu-id="09b12-108">Un servidor en estado de espera activa admite la conmutación por error rápida sin pérdida de las transacciones confirmadas, mientras que un servidor en estado de espera semiactiva admite la acción de forzar el servicio (con posible pérdida de datos).</span><span class="sxs-lookup"><span data-stu-id="09b12-108">A hot standby server supports rapid failover with no loss of committed transactions, and a warm standby server supports forcing service (with possible data loss).</span></span>  
  
 <span data-ttu-id="09b12-109">La base de datos de producción se denomina *base de datos principal*y la copia en espera se llama *base de datos reflejada*.</span><span class="sxs-lookup"><span data-stu-id="09b12-109">The production database is called the *principal database*, and the standby copy is called the *mirror database*.</span></span> <span data-ttu-id="09b12-110">La base de datos principal y la base de datos reflejada deben residir en instancias independientes de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (instancias del servidor) y, si es posible, en equipos diferentes.</span><span class="sxs-lookup"><span data-stu-id="09b12-110">The principal database and mirror database must reside on separate instances of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (server instances), and they should reside on separate computers if possible.</span></span>  
  
 <span data-ttu-id="09b12-111">La instancia del servidor de producción, denominado *servidor principal*, se comunica con la instancia del servidor en espera, denominado *servidor reflejado*.</span><span class="sxs-lookup"><span data-stu-id="09b12-111">The production server instance, called the *principal server*, communicates with the standby server instance, called the *mirror server*.</span></span> <span data-ttu-id="09b12-112">Los servidores principal y reflejado actúan como asociados dentro de una *sesión* de creación de reflejo de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="09b12-112">The principal and mirror servers act as partners within a database mirroring *session*.</span></span> <span data-ttu-id="09b12-113">Si el servidor principal genera un error, el servidor reflejado puede convertir su base de datos en la base de datos principal mediante un proceso llamado *conmutación por error*.</span><span class="sxs-lookup"><span data-stu-id="09b12-113">If the principal server fails, the mirror server can make its database into the principal database through a process called *failover*.</span></span> <span data-ttu-id="09b12-114">Por ejemplo, Partner_A y Partner_B son dos servidores asociados, con la base de datos principal inicialmente en Partner_A como servidor principal y la base de datos reflejada en Partner_B como servidor reflejado.</span><span class="sxs-lookup"><span data-stu-id="09b12-114">For example, Partner_A and Partner_B are two partner servers, with the principal database initially on Partner_A as principal server, and the mirror database residing on Partner_B as the mirror server.</span></span> <span data-ttu-id="09b12-115">Si Partner_A se queda sin conexión, la base de datos de Partner_B puede realizar la conmutación por error para convertirse en la base de datos principal actual.</span><span class="sxs-lookup"><span data-stu-id="09b12-115">If Partner_A goes offline, the database on Partner_B can fail over to become the current principal database.</span></span> <span data-ttu-id="09b12-116">Cuando Partner_A se vuelve a unir a la sesión de creación de reflejo, se convierte en el servidor reflejado y su base de datos pasa a ser la base de datos reflejada.</span><span class="sxs-lookup"><span data-stu-id="09b12-116">When Partner_A rejoins the mirroring session, it becomes the mirror server and its database becomes the mirror database.</span></span>  
  
 <span data-ttu-id="09b12-117">Las configuraciones alternativas de creación de reflejo de la base de datos proporcionan diferentes niveles de rendimiento y de seguridad de los datos, y admiten varias formas de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="09b12-117">Alternative database mirroring configurations offer different levels of performance and data safety, and support different forms of failover.</span></span> <span data-ttu-id="09b12-118">Para obtener más información, vea [Creación de reflejo de la base de datos &#40;SQL Server&#41;](../../../database-engine/database-mirroring/database-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="09b12-118">For more information, see [Database Mirroring &#40;SQL Server&#41;](../../../database-engine/database-mirroring/database-mirroring-sql-server.md).</span></span>  
  
 <span data-ttu-id="09b12-119">Se puede utilizar un alias al especificar el nombre de la base de datos reflejada.</span><span class="sxs-lookup"><span data-stu-id="09b12-119">It is possible to use an alias when specifying the mirror database name.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="09b12-120">Para más información sobre los intentos de conexión inicial y de reconexión a una base de datos reflejada, consulte [Conectar clientes a una sesión de creación de reflejo de la base de datos &#40;SQL Server&#41;](../../../database-engine/database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="09b12-120">For information about initial connection attempts and reconnection attempts to a mirrored database, see [Connect Clients to a Database Mirroring Session &#40;SQL Server&#41;](../../../database-engine/database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md).</span></span>  
  
## <a name="programming-considerations"></a><span data-ttu-id="09b12-121">Consideraciones sobre la programación</span><span class="sxs-lookup"><span data-stu-id="09b12-121">Programming Considerations</span></span>  
 <span data-ttu-id="09b12-122">Cuando el servidor principal genera un error, la aplicación cliente recibe mensajes de error como respuesta a las llamadas a la API que indican que se ha perdido la conexión a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="09b12-122">When the principal database server fails, the client application receives errors in response to API calls, which indicate that the connection to the database has been lost.</span></span> <span data-ttu-id="09b12-123">Cuando esto sucede, se pierde cualquier cambio no confirmado en la base de datos y se revierte la transacción actual.</span><span class="sxs-lookup"><span data-stu-id="09b12-123">When this happens, any uncommitted changes to the database are lost and the current transaction is rolled back.</span></span> <span data-ttu-id="09b12-124">Si esto se produce, la aplicación debe cerrar la conexión (o liberar el objeto de origen de datos) y volverla a abrir.</span><span class="sxs-lookup"><span data-stu-id="09b12-124">If this occurs, the application should close the connection (or release the data source object) and re-open it.</span></span> <span data-ttu-id="09b12-125">La conexión se redirige de forma transparente a la base de datos reflejada, que ahora actúa como servidor principal.</span><span class="sxs-lookup"><span data-stu-id="09b12-125">The connection is transparently re-directed to the mirror database, which now acts as the principal server.</span></span>  
  
 <span data-ttu-id="09b12-126">Cuando se establece una conexión, el servidor principal envía la identidad de su asociado de conmutación por error al cliente que se va a utilizar cuando se produzca la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="09b12-126">When a connection is established, the principal server sends the identity of its failover partner to the client to be used when failover occurs.</span></span> <span data-ttu-id="09b12-127">Si una aplicación intenta establecer una conexión después de producirse un error en el servidor principal, el cliente no conocerá la identidad del asociado de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="09b12-127">Where an application tried to establish a connection after the principal server failed, the client does not know the identity of the failover partner.</span></span> <span data-ttu-id="09b12-128">Para que los clientes tengan la oportunidad de solucionar esta situación, una propiedad de inicialización y una palabra clave de cadena de conexión asociada permiten al cliente especificar por sí solo la identidad del asociado de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="09b12-128">To allow clients the opportunity to cope with this scenario, an initialization property and an associated connection string keyword allow the client to specify the identity of the failover partner on its own.</span></span> <span data-ttu-id="09b12-129">El atributo de cliente solamente se utiliza en esta situación; si el servidor principal está disponible, no se utiliza.</span><span class="sxs-lookup"><span data-stu-id="09b12-129">The client attribute is used only in this scenario; if the principal server is available, it is not used.</span></span> <span data-ttu-id="09b12-130">Si el servidor asociado de conmutación por error proporcionado por el cliente no corresponde a un servidor que actúa como asociado de conmutación por error, el servidor rechaza la conexión.</span><span class="sxs-lookup"><span data-stu-id="09b12-130">If the failover partner server supplied by the client does not refer to a server acting as a failover partner, the connection is refused by the server.</span></span> <span data-ttu-id="09b12-131">Para que las aplicaciones puedan adaptarse a los cambios de configuración, se puede determinar la identidad del asociado de conmutación por error real inspeccionando el atributo una vez establecida la conexión.</span><span class="sxs-lookup"><span data-stu-id="09b12-131">To allow applications to adapt to configuration changes, the identity of the actual failover partner can be determined by inspecting the attribute after the connection has been established.</span></span> <span data-ttu-id="09b12-132">Conviene almacenar en la memoria caché la información del asociado para actualizar la cadena de conexión o concebir una estrategia de reintento en caso de que no se consiga establecer una conexión en el primer intento. </span><span class="sxs-lookup"><span data-stu-id="09b12-132">You should consider caching the partner information to update the connection string or devise a retry strategy in the event that the first attempt at making a connection fails.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="09b12-133">Debe especificar explícitamente la base de datos que va a ser utilizada por una conexión si desea usar esta característica en un nombre del origen de datos (DSN), una cadena de conexión, o un atributo o propiedad de conexión.</span><span class="sxs-lookup"><span data-stu-id="09b12-133">You must explicitly specify the database to be used by a connection if you want to use this feature in a DSN, connection string, or connection property/attribute.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="09b12-134">Native Client no intentará realizar la conmutación por error a la base de datos asociada si no se hace esto.</span><span class="sxs-lookup"><span data-stu-id="09b12-134">Native Client will not attempt to failover to the partner database if this is not done.</span></span>  
>   
>  <span data-ttu-id="09b12-135">La creación de reflejo es una característica de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="09b12-135">Mirroring is a feature of the database.</span></span> <span data-ttu-id="09b12-136">Puede darse el caso de que las aplicaciones que utilizan varias bases de datos no puedan utilizar esta característica.</span><span class="sxs-lookup"><span data-stu-id="09b12-136">Applications that use multiple databases might not be able to exploit this feature.</span></span>  
>   
>  <span data-ttu-id="09b12-137">Además, los nombres de servidor no distinguen mayúsculas de minúsculas, pero los nombres de base de datos sí lo hacen.</span><span class="sxs-lookup"><span data-stu-id="09b12-137">In addition, server names are case insensitive, but database names are case sensitive.</span></span> <span data-ttu-id="09b12-138">Debe asegurarse, por lo tanto, de utilizar la misma grafía en los nombres de origen de datos (DSN) y en las cadenas de conexión.</span><span class="sxs-lookup"><span data-stu-id="09b12-138">You should therefore make sure that you use the same casing in DSNs and connection strings.</span></span>  
  
## <a name="sql-server-native-client-ole-db-provider"></a><span data-ttu-id="09b12-139">Proveedor OLE DB de SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="09b12-139">SQL Server Native Client OLE DB Provider</span></span>  
 <span data-ttu-id="09b12-140">El [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] proveedor de OLE DB de Native Client admite la creación de reflejo de la base de datos a través de atributos de cadena de conexión y conexión.</span><span class="sxs-lookup"><span data-stu-id="09b12-140">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports database mirroring through connection and connection string attributes.</span></span> <span data-ttu-id="09b12-141">Se ha agregado la propiedad SSPROP_INIT_FAILOVERPARTNER al conjunto de propiedades DBPROPSET_SQLSERVERDBINIT, y la palabra clave `FailoverPartner` es un nuevo atributo de cadena de conexión para DBPROP_INIT_PROVIDERSTRING.</span><span class="sxs-lookup"><span data-stu-id="09b12-141">The SSPROP_INIT_FAILOVERPARTNER property has been added to the DBPROPSET_SQLSERVERDBINIT property set, and the `FailoverPartner` keyword is a new connection string attribute for DBPROP_INIT_PROVIDERSTRING.</span></span> <span data-ttu-id="09b12-142">Para obtener más información, vea [usar palabras clave de cadena de conexión con SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md).</span><span class="sxs-lookup"><span data-stu-id="09b12-142">For more information, see [Using Connection String Keywords with SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md).</span></span>  
  
 <span data-ttu-id="09b12-143">La caché de conmutación por error se mantiene siempre que se cargue el proveedor, que es hasta que se llama a **CoUninitialize** o siempre que la aplicación tenga una referencia a algún objeto administrado por el [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] proveedor de OLE DB de Native Client, como un objeto de origen de datos.</span><span class="sxs-lookup"><span data-stu-id="09b12-143">The failover cache is maintained as long as the provider is loaded, which is until **CoUninitialize** is called or as long as the application has a reference to some object managed by the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider such as a data source object.</span></span>  
  
 <span data-ttu-id="09b12-144">Para más información sobre la [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] compatibilidad del proveedor de OLE DB de Native Client con la creación de reflejo de la base de datos, consulte [propiedades de inicialización y autorización](../../native-client-ole-db-data-source-objects/initialization-and-authorization-properties.md).</span><span class="sxs-lookup"><span data-stu-id="09b12-144">For details about [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider support for database mirroring, see [Initialization and Authorization Properties](../../native-client-ole-db-data-source-objects/initialization-and-authorization-properties.md).</span></span>  
  
## <a name="sql-server-native-client-odbc-driver"></a><span data-ttu-id="09b12-145">Controlador ODBC de SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="09b12-145">SQL Server Native Client ODBC Driver</span></span>  
 <span data-ttu-id="09b12-146">El [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] controlador ODBC de Native Client admite la creación de reflejo de la base de datos a través de los atributos de cadena de conexión y conexión.</span><span class="sxs-lookup"><span data-stu-id="09b12-146">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver supports database mirroring through connection and connection string attributes.</span></span> <span data-ttu-id="09b12-147">En concreto, se ha agregado el atributo SQL_COPT_SS_FAILOVER_PARTNER para su uso con las funciones [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) y [SQLGetConnectAttr](../../native-client-odbc-api/sqlgetconnectattr.md) . y se ha `Failover_Partner` agregado la palabra clave como un nuevo atributo de cadena de conexión.</span><span class="sxs-lookup"><span data-stu-id="09b12-147">Specifically, the SQL_COPT_SS_FAILOVER_PARTNER attribute has been added for use with the [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) and [SQLGetConnectAttr](../../native-client-odbc-api/sqlgetconnectattr.md) functions; and the `Failover_Partner` keyword has been added as a new connection string attribute.</span></span>  
  
 <span data-ttu-id="09b12-148">La memoria caché de conmutación por error se mantiene mientras la aplicación tiene asignado por lo menos un identificador de entorno.</span><span class="sxs-lookup"><span data-stu-id="09b12-148">The failover cache is maintained as long as the application has at least one environment handle allocated.</span></span> <span data-ttu-id="09b12-149">En cambio, se pierde cuando se cancela la asignación del último identificador de entorno.</span><span class="sxs-lookup"><span data-stu-id="09b12-149">Conversely, it is lost when the last environment handle is deallocated.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="09b12-150">El Administrador de controladores ODBC se ha mejorado para admitir la especificación del nombre del servidor de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="09b12-150">The ODBC Driver Manager has been enhanced to support the specification of the failover server name.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="09b12-151">Consulte también</span><span class="sxs-lookup"><span data-stu-id="09b12-151">See Also</span></span>  
 <span data-ttu-id="09b12-152">[Características de SQL Server Native Client](sql-server-native-client-features.md) </span><span class="sxs-lookup"><span data-stu-id="09b12-152">[SQL Server Native Client Features](sql-server-native-client-features.md) </span></span>  
 <span data-ttu-id="09b12-153">[Conectar clientes a una sesión de creación de reflejo de la base de datos &#40;SQL Server&#41;](../../../database-engine/database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="09b12-153">[Connect Clients to a Database Mirroring Session &#40;SQL Server&#41;](../../../database-engine/database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md) </span></span>  
 [<span data-ttu-id="09b12-154">Creación de reflejo de la base de datos &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="09b12-154">Database Mirroring &#40;SQL Server&#41;</span></span>](../../../database-engine/database-mirroring/database-mirroring-sql-server.md)  
  
  
