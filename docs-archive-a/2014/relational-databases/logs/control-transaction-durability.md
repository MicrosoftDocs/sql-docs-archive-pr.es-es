---
title: Control de la durabilidad de las transacciones | Microsoft Docs
ms.custom: ''
ms.date: 05/19/2016
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: supportability
ms.topic: conceptual
helpviewer_keywords:
- delayed durability
- Lazy Commit
ms.assetid: 3ac93b28-cac7-483e-a8ab-ac44e1cc1c76
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: f37bcaf8719f4a2f3b1e7fbca1cf332717bd936e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87671540"
---
# <a name="control-transaction-durability"></a><span data-ttu-id="173fd-102">Controlar la durabilidad de las transacciones</span><span class="sxs-lookup"><span data-stu-id="173fd-102">Control Transaction Durability</span></span>
  <span data-ttu-id="173fd-103">Las confirmaciones de transacciones de[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] pueden ser totalmente durables (el valor predeterminado de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ) o durables diferidas (conocidas también como confirmaciones diferidas).</span><span class="sxs-lookup"><span data-stu-id="173fd-103">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] transaction commits can be either fully durable, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] default, or delayed durable (also known as lazy commit).</span></span>  
  
 <span data-ttu-id="173fd-104">Las confirmaciones de transacciones totalmente durables son sincrónicas y notifican una instrucción COMMIT como correcta para devolver el control al cliente únicamente tras escribir en disco los registros de la transacción.</span><span class="sxs-lookup"><span data-stu-id="173fd-104">Fully durable transaction commits are synchronous and report a commit as successful and return control to the client only after the log records for the transaction are written to disk.</span></span> <span data-ttu-id="173fd-105">Las confirmaciones de transacciones durables diferidas son asincrónicas y notifican una instrucción COMMIT como correcta antes de escribir en disco los registros de la transacción.</span><span class="sxs-lookup"><span data-stu-id="173fd-105">Delayed durable transaction commits are asynchronous and report a commit as successful before the log records for the transaction are written to disk.</span></span> <span data-ttu-id="173fd-106">Para que una transacción sea durable, es necesario escribir las entradas del registro de transacciones en el disco.</span><span class="sxs-lookup"><span data-stu-id="173fd-106">Writing the transaction log entries to disk is required for a transaction to be durable.</span></span> <span data-ttu-id="173fd-107">Las transacciones durables diferidas pasan a ser durables cuando las entradas del registro de transacciones se vacían en el disco.</span><span class="sxs-lookup"><span data-stu-id="173fd-107">Delayed durable transactions become durable when the transaction log entries are flushed to disk.</span></span>  
  
 <span data-ttu-id="173fd-108">Este tema contiene información detallada sobre las transacciones durables diferidas.</span><span class="sxs-lookup"><span data-stu-id="173fd-108">This topic details delayed durable transactions.</span></span>  
  
## <a name="full-vs-delayed-transaction-durability"></a><span data-ttu-id="173fd-109">Durabilidad total frente a  durabilidad diferida de transacciones</span><span class="sxs-lookup"><span data-stu-id="173fd-109">Full vs. Delayed Transaction Durability</span></span>  
 <span data-ttu-id="173fd-110">Tanto la durabilidad total como la durabilidad diferida de transacciones tienen sus ventajas y desventajas.</span><span class="sxs-lookup"><span data-stu-id="173fd-110">Both full and delayed transaction durability have their advantages and disadvantages.</span></span> <span data-ttu-id="173fd-111">Una aplicación puede tener una combinación de transacciones totalmente durables y durables diferidas.</span><span class="sxs-lookup"><span data-stu-id="173fd-111">An application can have a mix of fully and delayed durable transactions.</span></span> <span data-ttu-id="173fd-112">Debe considerar detenidamente las necesidades de la empresa y cómo encaja cada una de ellas en esas necesidades.</span><span class="sxs-lookup"><span data-stu-id="173fd-112">You should carefully consider your business needs and how each fits into those needs.</span></span>  
  
### <a name="full-transaction-durability"></a><span data-ttu-id="173fd-113">Durabilidad total de transacciones</span><span class="sxs-lookup"><span data-stu-id="173fd-113">Full transaction durability</span></span>  
 <span data-ttu-id="173fd-114">Las transacciones totalmente durables escriben el registro de transacciones en el disco antes de devolver el control al cliente.</span><span class="sxs-lookup"><span data-stu-id="173fd-114">Fully durable transactions write the transaction log to disk before returning control to the client.</span></span> <span data-ttu-id="173fd-115">Debe utilizar transacciones totalmente durables cuando:</span><span class="sxs-lookup"><span data-stu-id="173fd-115">You should use fully durable transactions whenever:</span></span>  
  
-   <span data-ttu-id="173fd-116">El sistema no puede tolerar la pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="173fd-116">Your system cannot tolerate any data loss.</span></span>   
    <span data-ttu-id="173fd-117">Vea la sección [¿Cuándo puedo perder datos?](#when-can-i-lose-data) para obtener información sobre cuándo puede perder algunos de los datos.</span><span class="sxs-lookup"><span data-stu-id="173fd-117">See the section [When can I lose data?](#when-can-i-lose-data) for information on when you can lose some of your data.</span></span>  
  
-   <span data-ttu-id="173fd-118">El cuello de botella no se debe a la latencia de escritura en el registro de transacciones.</span><span class="sxs-lookup"><span data-stu-id="173fd-118">The bottleneck is not due to transaction log write latency.</span></span>  
  
 <span data-ttu-id="173fd-119">La durabilidad diferida de transacciones reduce la latencia debida a operaciones de E/S de registro al conservar los registros de transacciones en memoria y escribir por lotes en el registro de transacciones, lo que requiere menos operaciones de E/S.</span><span class="sxs-lookup"><span data-stu-id="173fd-119">Delayed transaction durability reduces the latency due to log I/O by keeping the transaction log records in memory and writing to the transaction log in batches, thus requiring fewer I/O operations.</span></span> <span data-ttu-id="173fd-120">Las transacciones de perdurabilidad diferida reduce potencialmente la contención de las E/S del registro, de forma que se reducen las esperas en el sistema.</span><span class="sxs-lookup"><span data-stu-id="173fd-120">Delayed transaction durability potentially reduces log I/O contention, thus reducing waits in the system.</span></span>  
  
 <span data-ttu-id="173fd-121">**Garantías de la durabilidad total de transacciones**</span><span class="sxs-lookup"><span data-stu-id="173fd-121">**Full Transaction Durability Guarantees**</span></span>  
  
-   <span data-ttu-id="173fd-122">Una vez que la transacción se confirma correctamente, los cambios que realiza la transacción son visibles para las demás transacciones del sistema.</span><span class="sxs-lookup"><span data-stu-id="173fd-122">Once transaction commit succeeds, the changes made by the transaction are visible to the other transactions in the system.</span></span> <span data-ttu-id="173fd-123">Vea el tema [niveles de aislamiento de transacción](../../database-engine/transaction-isolation-levels.md) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="173fd-123">See the topic [Transaction Isolation Levels](../../database-engine/transaction-isolation-levels.md) for more information.</span></span>  
  
-   <span data-ttu-id="173fd-124">La durabilidad se garantiza en el momento de la confirmación.</span><span class="sxs-lookup"><span data-stu-id="173fd-124">Durability is guaranteed on commit.</span></span> <span data-ttu-id="173fd-125">Las entradas de registro correspondientes se guardan en el disco antes de que la transacción se confirme correctamente y se devuelva el control al cliente.</span><span class="sxs-lookup"><span data-stu-id="173fd-125">Corresponding log records are persisted to disk before the transaction commit succeeds and returns control to the client.</span></span>  
  
### <a name="delayed-transaction-durability"></a><span data-ttu-id="173fd-126">Durabilidad diferida de transacciones</span><span class="sxs-lookup"><span data-stu-id="173fd-126">Delayed transaction durability</span></span>  
 <span data-ttu-id="173fd-127">La durabilidad diferida de las transacciones se realiza mediante escrituras asincrónicas de registro en el disco.</span><span class="sxs-lookup"><span data-stu-id="173fd-127">Delayed transaction durability is accomplished using asynchronous log writes to disk.</span></span> <span data-ttu-id="173fd-128">Las entradas del registro de transacciones se conservan en un búfer y se escriben en el disco cuando el búfer se llena o cuando se produce un evento de vaciado del búfer.</span><span class="sxs-lookup"><span data-stu-id="173fd-128">Transaction log records are kept in a buffer and written to disk when the buffer fills or a buffer flushing event takes place.</span></span> <span data-ttu-id="173fd-129">La durabilidad diferida de las transacciones reduce tanto la latencia como la contención en el sistema porque:</span><span class="sxs-lookup"><span data-stu-id="173fd-129">Delayed transaction durability reduces both latency and contention within the system because:</span></span>  
  
-   <span data-ttu-id="173fd-130">El procesamiento de confirmación de transacciones no espera a que finalicen las E/S del registro y a devolver el control al cliente.</span><span class="sxs-lookup"><span data-stu-id="173fd-130">The transaction commit processing does not wait for log IO to finish and return control to the client.</span></span>  
  
-   <span data-ttu-id="173fd-131">Resulta menos probable que las transacciones simultáneas compitan por E/S del registro; en su lugar, el búfer de registro puede vaciarse en el disco en fragmentos mayores, lo cual reduce la contención y aumenta el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="173fd-131">Concurrent transactions are less likely to contend for log IO; instead, the log buffer can be flushed to disk in larger chunks, reducing contention, and increasing throughput.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="173fd-132">Es posible que siga habiendo contención de E/S si hay un alto grado de simultaneidad, especialmente si el búfer de registro se llena más rápidamente que se vacía.</span><span class="sxs-lookup"><span data-stu-id="173fd-132">You may still have log I/O contention if there is a high degree of concurrency, particularly if you fill up the log buffer faster than you flush it.</span></span>  
  
 <span data-ttu-id="173fd-133">**Cuándo utilizar durabilidad diferida de transacciones**</span><span class="sxs-lookup"><span data-stu-id="173fd-133">**When to use delayed transaction durability**</span></span>  
  
 <span data-ttu-id="173fd-134">He aquí algunos casos en los que puede ser beneficioso usar la durabilidad diferida de transacciones:</span><span class="sxs-lookup"><span data-stu-id="173fd-134">Some of the cases in which you could benefit from using delayed transaction durability are:</span></span>  
  
 <span data-ttu-id="173fd-135">**Puede tolerar alguna pérdida de datos.** </span><span class="sxs-lookup"><span data-stu-id="173fd-135">**You can tolerate some data loss.**</span></span>  
 <span data-ttu-id="173fd-136">Si puede tolerar cierta pérdida de datos, por ejemplo cuando los registros individuales no son críticos siempre y cuando tenga la mayoría de los datos, puede resultar útil usar la durabilidad diferida.</span><span class="sxs-lookup"><span data-stu-id="173fd-136">If you can tolerate some data loss, for example, where individual records are not critical as long as you have most of the data, then delayed durability may be worth considering.</span></span> <span data-ttu-id="173fd-137">Si no puede tolerar la pérdida de datos, no utilice la durabilidad diferida de transacciones.</span><span class="sxs-lookup"><span data-stu-id="173fd-137">If you cannot tolerate any data loss, do not use delayed transaction durability.</span></span>  
  
 <span data-ttu-id="173fd-138">**Experimenta cuellos de botella en la escritura de registros de transacciones.** </span><span class="sxs-lookup"><span data-stu-id="173fd-138">**You are experiencing a bottleneck on transaction log writes.**</span></span>  
 <span data-ttu-id="173fd-139">Si los problemas de rendimiento se deben a la latencia en la escritura de registros de transacciones, seguramente la aplicación se beneficiará de utilizar la durabilidad diferida de transacciones.</span><span class="sxs-lookup"><span data-stu-id="173fd-139">If your performance issues are due to latency in transaction log writes, your application will likely benefit from using delayed transaction durability.</span></span>  
  
 <span data-ttu-id="173fd-140">**Las cargas de trabajo conllevan un alto índice de contención.** </span><span class="sxs-lookup"><span data-stu-id="173fd-140">**Your workloads have a high contention rate.**</span></span>  
 <span data-ttu-id="173fd-141">Si el sistema tiene cargas de trabajo con un alto índice de contención, se perderá mucho tiempo esperando a que se liberen los bloqueos.</span><span class="sxs-lookup"><span data-stu-id="173fd-141">If your system has workloads with a high contention level much time is lost waiting for locks to be released.</span></span> <span data-ttu-id="173fd-142">La durabilidad diferida de transacciones reduce el tiempo de confirmación y, por tanto, libera los bloqueos con mayor rapidez, lo que redunda en un mayor rendimiento.</span><span class="sxs-lookup"><span data-stu-id="173fd-142">Delayed transaction durability reduces commit time and thus releases locks faster which results in higher throughput.</span></span>  
  
 <span data-ttu-id="173fd-143">**Garantías de la durabilidad diferida de transacciones**</span><span class="sxs-lookup"><span data-stu-id="173fd-143">**Delayed Transaction Durability Guarantees**</span></span>  
  
-   <span data-ttu-id="173fd-144">Una vez que la transacción se confirma correctamente, los cambios que realiza la transacción son visibles para las demás transacciones del sistema.</span><span class="sxs-lookup"><span data-stu-id="173fd-144">Once transaction commit succeeds, the changes made by the transaction are visible to the other transactions in the system.</span></span>  
  
-   <span data-ttu-id="173fd-145">La durabilidad de las transacciones solo se garantiza después de vaciar en el disco el registro de transacciones en memoria.</span><span class="sxs-lookup"><span data-stu-id="173fd-145">Transaction durability is guaranteed only following a flush of the in-memory transaction log to disk.</span></span> <span data-ttu-id="173fd-146">El registro de transacciones en memoria se vacía en el disco cuando:</span><span class="sxs-lookup"><span data-stu-id="173fd-146">The in-memory transaction log is flushed to disk when:</span></span>  
  
    -   <span data-ttu-id="173fd-147">Una transacción totalmente durable de la misma base de datos efectúa un cambio en la base de datos y se confirma correctamente.</span><span class="sxs-lookup"><span data-stu-id="173fd-147">A fully durable transaction in the same database makes a change in the database and successfully commits.</span></span>  
  
    -   <span data-ttu-id="173fd-148">El usuario ejecuta el procedimiento almacenado del sistema `sp_flush_log` correctamente.</span><span class="sxs-lookup"><span data-stu-id="173fd-148">The user executes the system stored procedure `sp_flush_log` successfully.</span></span>  
  
    -   <span data-ttu-id="173fd-149">El búfer de registro de transacciones en memoria se llena y se vacía en el disco automáticamente.</span><span class="sxs-lookup"><span data-stu-id="173fd-149">The in-memory transaction log buffer fills up and automatically flushes to disk.</span></span>  
  
     <span data-ttu-id="173fd-150">Si una transacción totalmente durable o sp_flush_log se confirman correctamente, todas las transacciones de durabilidad diferida que se hubieran confirmado anteriormente serán durables.</span><span class="sxs-lookup"><span data-stu-id="173fd-150">If a fully durable transaction or sp_flush_log successfully commit, all previously committed delayed durability transactions have been made durable.</span></span>  
  
 <span data-ttu-id="173fd-151">Es posible que el registro se vacíe en el disco de forma periódica.</span><span class="sxs-lookup"><span data-stu-id="173fd-151">The log may be flushed to disk periodically.</span></span> <span data-ttu-id="173fd-152">Sin embargo, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] no proporciona garantías de durabilidad que no sean las transacciones durables y sp_flush_log.</span><span class="sxs-lookup"><span data-stu-id="173fd-152">However, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] does not provide any durability guarantees other than durable transactions and sp_flush_log.</span></span>  
  
## <a name="how-to-control-transaction-durability"></a><span data-ttu-id="173fd-153">Cómo controlar la durabilidad de las transacciones</span><span class="sxs-lookup"><span data-stu-id="173fd-153">How to control transaction durability</span></span>  
  
### <a name="database-level-control"></a><span data-ttu-id="173fd-154">Control de nivel de base de datos</span><span class="sxs-lookup"><span data-stu-id="173fd-154">Database level control</span></span>  
 <span data-ttu-id="173fd-155">Como administrador de la base de datos (DBA), con la instrucción siguiente puede controlar si los usuarios pueden usar transacciones de durabilidad diferida en una base de datos.</span><span class="sxs-lookup"><span data-stu-id="173fd-155">You, the DBA, can control whether users can use delayed transaction durability on a database with the following statement.</span></span> <span data-ttu-id="173fd-156">Debe establecer la configuración de durabilidad diferida con ALTER DATABASE.</span><span class="sxs-lookup"><span data-stu-id="173fd-156">You must set the delayed durability setting with ALTER DATABASE.</span></span>  
  
```sql  
ALTER DATABASE ... SET DELAYED_DURABILITY = { DISABLED | ALLOWED | FORCED }  
```  
  
 `DISABLED`  
 <span data-ttu-id="173fd-157">[valor predeterminado] Con esta configuración, todas las transacciones que se confirman en la base de datos son totalmente durables, independientemente del nivel de confirmación (DELAYED_DURABILITY= [ON | OFF]).</span><span class="sxs-lookup"><span data-stu-id="173fd-157">[default] With this setting, all transactions that commit on the database are fully durable, regardless of the commit level setting (DELAYED_DURABILITY=[ON | OFF]).</span></span> <span data-ttu-id="173fd-158">No hay necesidad de modificar y recompilar el procedimiento almacenado.</span><span class="sxs-lookup"><span data-stu-id="173fd-158">There is no need for stored procedure change and recompilation.</span></span> <span data-ttu-id="173fd-159">De esta forma, puede asegurarse de que la durabilidad diferida nunca ponga datos en peligro.</span><span class="sxs-lookup"><span data-stu-id="173fd-159">This allows you to ensure that no data is ever put at risk by delayed durability.</span></span>  
  
 `ALLOWED`  
 <span data-ttu-id="173fd-160">Con esta configuración, la durabilidad de cada transacción se determina en el nivel de transacción: DELAYED_DURABILITY = { *OFF* | ON }.</span><span class="sxs-lookup"><span data-stu-id="173fd-160">With this setting, each transaction's durability is determined at the transaction level - DELAYED_DURABILITY = { *OFF* | ON }.</span></span> <span data-ttu-id="173fd-161">Consulte [control de nivel de bloque atómico: procedimientos almacenados compilados](#atomic-block-level-control---natively-compiled-stored-procedures) de forma nativa y [control de nivel de confirmación: Transact-SQL](#commit-level-control---t-sql) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="173fd-161">See [Atomic block level control - Natively Compiled Stored Procedures](#atomic-block-level-control---natively-compiled-stored-procedures) and [COMMIT level control - Transact-SQL](#commit-level-control---t-sql) for more information.</span></span>  
  
 `FORCED`  
 <span data-ttu-id="173fd-162">Con esta configuración, cada transacción que se confirma en la base de datos es durable diferida.</span><span class="sxs-lookup"><span data-stu-id="173fd-162">With this setting, every transaction that commits on the database is delayed durable.</span></span> <span data-ttu-id="173fd-163">Independientemente de que la transacción especifique que es totalmente durable (DELAYED_DURABILITY = OFF) o no haga especificación alguna, la transacción es durable diferida.</span><span class="sxs-lookup"><span data-stu-id="173fd-163">Whether the transaction specifies fully durable (DELAYED_DURABILITY = OFF) or makes no specification, the transaction is delayed durable.</span></span> <span data-ttu-id="173fd-164">Esta configuración resulta útil cuando la durabilidad diferida es adecuada para una base de datos y no desea cambiar ningún código de aplicación.</span><span class="sxs-lookup"><span data-stu-id="173fd-164">This setting is useful when delayed transaction durability is useful for a database and you do not want to change any application code.</span></span>  
  
### <a name="atomic-block-level-control---natively-compiled-stored-procedures"></a><span data-ttu-id="173fd-165"> Control de nivel de bloque ATOMIC: procedimientos almacenados compilados de forma nativa</span><span class="sxs-lookup"><span data-stu-id="173fd-165">Atomic block level control - Natively Compiled Stored Procedures</span></span>  
 <span data-ttu-id="173fd-166">El código siguiente va en el interior del bloque ATOMIC.</span><span class="sxs-lookup"><span data-stu-id="173fd-166">The following code goes inside the atomic block.</span></span>  
  
```sql  
DELAYED_DURABILITY = { OFF | ON }  
```  
  
 `OFF`  
 <span data-ttu-id="173fd-167">[valor predeterminado] La transacción es totalmente durable, salvo que la opción de base de datos DELAYED_DURABLITY = FORCED esté activa, en cuyo caso la instrucción COMMIT será asíncrona y por tanto durable diferida.</span><span class="sxs-lookup"><span data-stu-id="173fd-167">[default] The transaction is fully durable, unless the database option DELAYED_DURABLITY = FORCED is in effect, in which case the commit is asynchronous and thus delayed durable.</span></span> <span data-ttu-id="173fd-168">Consulte [Database level control](#database-level-control) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="173fd-168">See [Database level control](#database-level-control) for more information.</span></span>  
  
 `ON`  
 <span data-ttu-id="173fd-169">La transacción es durable diferida, salvo que la opción de base de datos DELAYED_DURABLITY = DISABLED esté activa, en cuyo caso la instrucción COMMIT será síncrona y por tanto totalmente durable.</span><span class="sxs-lookup"><span data-stu-id="173fd-169">The transaction is delayed durable, unless the database option DELAYED_DURABLITY = DISABLED is in effect, in which case the commit is synchronous and thus fully durable.</span></span>  <span data-ttu-id="173fd-170">Consulte [Database level control](#database-level-control) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="173fd-170">See [Database level control](#database-level-control) for more information.</span></span>  
  
 <span data-ttu-id="173fd-171">**Código de ejemplo**</span><span class="sxs-lookup"><span data-stu-id="173fd-171">**Example Code:**</span></span>  
  
```sql  
CREATE PROCEDURE <procedureName> ...  
WITH NATIVE_COMPILATION, SCHEMABINDING, EXECUTE AS OWNER  
AS BEGIN ATOMIC WITH   
(  
    DELAYED_DURABILITY = ON,  
    TRANSACTION ISOLATION LEVEL = SNAPSHOT,  
    LANGUAGE = N'English'  
    ...  
)  
END  
```  
  
### <a name="table-1-durability-in-atomic-blocks"></a><span data-ttu-id="173fd-172">Tabla 1: Durabilidad en bloques ATOMIC</span><span class="sxs-lookup"><span data-stu-id="173fd-172">Table 1: Durability in Atomic Blocks</span></span>  
  
|<span data-ttu-id="173fd-173">Opción de durabilidad de bloque ATOMIC</span><span class="sxs-lookup"><span data-stu-id="173fd-173">Atomic block durability option</span></span>|<span data-ttu-id="173fd-174">Ninguna transacción existente</span><span class="sxs-lookup"><span data-stu-id="173fd-174">No existing transaction</span></span>|<span data-ttu-id="173fd-175">Transacción en proceso (totalmente durable o durable diferida)</span><span class="sxs-lookup"><span data-stu-id="173fd-175">Transaction in process (fully or delayed durable)</span></span>|  
|------------------------------------|-----------------------------|---------------------------------------------------------|  
|`DELAYED_DURABILITY = OFF`|<span data-ttu-id="173fd-176">El bloque ATOMIC inicia una nueva transacción totalmente durable.</span><span class="sxs-lookup"><span data-stu-id="173fd-176">Atomic block starts a new fully durable transaction.</span></span>|<span data-ttu-id="173fd-177">El bloque ATOMIC crea un punto de retorno en la transacción existente y después inicia la nueva transacción.</span><span class="sxs-lookup"><span data-stu-id="173fd-177">Atomic block creates a save point in the existing transaction, then begins the new transaction.</span></span>|  
|`DELAYED_DURABILITY = ON`|<span data-ttu-id="173fd-178">El bloque ATOMIC inicia una nueva transacción durable diferida.</span><span class="sxs-lookup"><span data-stu-id="173fd-178">Atomic block starts a new delayed durable transaction.</span></span>|<span data-ttu-id="173fd-179">El bloque ATOMIC crea un punto de retorno en la transacción existente y después inicia la nueva transacción.</span><span class="sxs-lookup"><span data-stu-id="173fd-179">Atomic block creates a save point in the existing transaction, then begins the new transaction.</span></span>|  
  
### <a name="commit-level-control---t-sql"></a><span data-ttu-id="173fd-180">Control de nivel de confirmación (T-SQL)</span><span class="sxs-lookup"><span data-stu-id="173fd-180">COMMIT level control - (T-SQL)</span></span>
 <span data-ttu-id="173fd-181">La sintaxis de COMMIT se ha ampliado para que pueda forzar la durabilidad diferida de transacciones.</span><span class="sxs-lookup"><span data-stu-id="173fd-181">The COMMIT syntax is extended so you can force delayed transaction durability.</span></span> <span data-ttu-id="173fd-182">Si DELAYED_DURABILITY es DISABLED o FORCED en el nivel de base de datos (vea más arriba), esta opción de COMMIT se omite.</span><span class="sxs-lookup"><span data-stu-id="173fd-182">If DELAYED_DURABILITY is DISABLED or FORCED at the database level (see above) this COMMIT option is ignored.</span></span>  
  
```sql  
COMMIT [ { TRAN | TRANSACTION } ] [ transaction_name | @tran_name_variable ] ] [ WITH ( DELAYED_DURABILITY = { OFF | ON } ) ]  
  
```  
  
 `OFF`  
 <span data-ttu-id="173fd-183">[valor predeterminado] La instrucción COMMIT de la transacción es totalmente durable, salvo que la opción de base de datos DELAYED_DURABLITY = FORCED esté activa, en cuyo caso la instrucción COMMIT será asincrónica y por tanto durable diferida.</span><span class="sxs-lookup"><span data-stu-id="173fd-183">[default] The transaction COMMIT is fully durable, unless the database option DELAYED_DURABLITY = FORCED is in effect, in which case the COMMIT is asynchronous and thus delayed durable.</span></span> <span data-ttu-id="173fd-184">Consulte [Database level control](#database-level-control) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="173fd-184">See [Database level control](#database-level-control) for more information.</span></span>  
  
 `ON`  
 <span data-ttu-id="173fd-185">La instrucción COMMIT de la transacción es durable diferida, salvo que la opción de base de datos DELAYED_DURABLITY = DISABLED esté activa, en cuyo caso la instrucción COMMIT será sincrónica y por tanto totalmente durable.</span><span class="sxs-lookup"><span data-stu-id="173fd-185">The transaction COMMIT is delayed durable, unless the database option DELAYED_DURABLITY = DISABLED is in effect, in which case the COMMIT is synchronous and thus fully durable.</span></span> <span data-ttu-id="173fd-186">Consulte [Database level control](#database-level-control) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="173fd-186">See [Database level control](#database-level-control) for more information.</span></span>  
  
### <a name="summary-of-options-and-their-interactions"></a><span data-ttu-id="173fd-187">Resumen de opciones y sus interacciones</span><span class="sxs-lookup"><span data-stu-id="173fd-187">Summary of options and their interactions</span></span>  
 <span data-ttu-id="173fd-188">En esta tabla se resumen las interacciones entre las configuraciones de durabilidad diferida de nivel de base de datos y las configuraciones de nivel de confirmación.</span><span class="sxs-lookup"><span data-stu-id="173fd-188">This table summarizes the interactions between database level delayed durability settings and commit level settings.</span></span> <span data-ttu-id="173fd-189">Las configuraciones de nivel de base de datos siempre tienen prioridad sobre las configuraciones de nivel de confirmación.</span><span class="sxs-lookup"><span data-stu-id="173fd-189">Database level settings always take precedence over commit level settings.</span></span>  
  
|<span data-ttu-id="173fd-190">Valor COMMIT/Valor de base de datos</span><span class="sxs-lookup"><span data-stu-id="173fd-190">COMMIT setting/Database setting</span></span>|<span data-ttu-id="173fd-191">DELAYED_DURABILITY = DISABLED</span><span class="sxs-lookup"><span data-stu-id="173fd-191">DELAYED_DURABILITY = DISABLED</span></span>|<span data-ttu-id="173fd-192">DELAYED_DURABILITY = ALLOWED</span><span class="sxs-lookup"><span data-stu-id="173fd-192">DELAYED_DURABILITY = ALLOWED</span></span>|<span data-ttu-id="173fd-193">DELAYED_DURABILITY = FORCED</span><span class="sxs-lookup"><span data-stu-id="173fd-193">DELAYED_DURABILITY = FORCED</span></span>|  
|--------------------------------------|-------------------------------------|------------------------------------|-----------------------------------|  
|<span data-ttu-id="173fd-194">`DELAYED_DURABILITY = OFF` Transacciones de nivel de base de datos.</span><span class="sxs-lookup"><span data-stu-id="173fd-194">`DELAYED_DURABILITY = OFF` Database level transactions.</span></span>|<span data-ttu-id="173fd-195">La transacción es totalmente durable.</span><span class="sxs-lookup"><span data-stu-id="173fd-195">Transaction is fully durable.</span></span>|<span data-ttu-id="173fd-196">La transacción es totalmente durable.</span><span class="sxs-lookup"><span data-stu-id="173fd-196">Transaction is fully durable.</span></span>|<span data-ttu-id="173fd-197">La transacción es de durabilidad diferida.</span><span class="sxs-lookup"><span data-stu-id="173fd-197">Transaction is delayed durable.</span></span>|  
|<span data-ttu-id="173fd-198">`DELAYED_DURABILITY = ON` Transacciones de nivel de base de datos.</span><span class="sxs-lookup"><span data-stu-id="173fd-198">`DELAYED_DURABILITY = ON` Database level transactions.</span></span>|<span data-ttu-id="173fd-199">La transacción es totalmente durable.</span><span class="sxs-lookup"><span data-stu-id="173fd-199">Transaction is fully durable.</span></span>|<span data-ttu-id="173fd-200">La transacción es de durabilidad diferida.</span><span class="sxs-lookup"><span data-stu-id="173fd-200">Transaction is delayed durable.</span></span>|<span data-ttu-id="173fd-201">La transacción es de durabilidad diferida.</span><span class="sxs-lookup"><span data-stu-id="173fd-201">Transaction is delayed durable.</span></span>|  
|<span data-ttu-id="173fd-202">`DELAYED_DURABILITY = OFF` Transacciones entre bases de datos o distribuidas.</span><span class="sxs-lookup"><span data-stu-id="173fd-202">`DELAYED_DURABILITY = OFF` Cross database or distributed transaction.</span></span>|<span data-ttu-id="173fd-203">La transacción es totalmente durable.</span><span class="sxs-lookup"><span data-stu-id="173fd-203">Transaction is fully durable.</span></span>|<span data-ttu-id="173fd-204">La transacción es totalmente durable.</span><span class="sxs-lookup"><span data-stu-id="173fd-204">Transaction is fully durable.</span></span>|<span data-ttu-id="173fd-205">La transacción es totalmente durable.</span><span class="sxs-lookup"><span data-stu-id="173fd-205">Transaction is fully durable.</span></span>|  
|<span data-ttu-id="173fd-206">`DELAYED_DURABILITY = ON` Transacciones entre bases de datos o distribuidas.</span><span class="sxs-lookup"><span data-stu-id="173fd-206">`DELAYED_DURABILITY = ON` Cross database or distributed transaction.</span></span>|<span data-ttu-id="173fd-207">La transacción es totalmente durable.</span><span class="sxs-lookup"><span data-stu-id="173fd-207">Transaction is fully durable.</span></span>|<span data-ttu-id="173fd-208">La transacción es totalmente durable.</span><span class="sxs-lookup"><span data-stu-id="173fd-208">Transaction is fully durable.</span></span>|<span data-ttu-id="173fd-209">La transacción es totalmente durable.</span><span class="sxs-lookup"><span data-stu-id="173fd-209">Transaction is fully durable.</span></span>|  
  
## <a name="how-to-force-a-transaction-log-flush"></a><span data-ttu-id="173fd-210">Cómo forzar un vaciado del registro de transacciones</span><span class="sxs-lookup"><span data-stu-id="173fd-210">How to force a transaction log flush</span></span>  
 <span data-ttu-id="173fd-211">Existen dos formas de forzar el vaciado en el disco del registro de transacciones.</span><span class="sxs-lookup"><span data-stu-id="173fd-211">There are two means to force flush the transaction log to disk.</span></span>  
  
-   <span data-ttu-id="173fd-212">Ejecutar todas las transacciones totalmente durables que modifican la misma base de datos.</span><span class="sxs-lookup"><span data-stu-id="173fd-212">Execute any fully durable transaction that alters the same database.</span></span> <span data-ttu-id="173fd-213">De esta forma se fuerza un vaciado en disco de las entradas de registro de todas las transacciones de durabilidad diferida confirmadas previamente.</span><span class="sxs-lookup"><span data-stu-id="173fd-213">This forces a flush of the log records of all preceding committed delayed durability transactions to disk.</span></span>  
  
-   <span data-ttu-id="173fd-214">Ejecutar el procedimiento almacenado del sistema `sp_flush_log`.</span><span class="sxs-lookup"><span data-stu-id="173fd-214">Execute the system stored procedure `sp_flush_log`.</span></span> <span data-ttu-id="173fd-215">Este procedimiento fuerza un vaciado en disco de las entradas de registro de todas las transacciones de durabilidad diferida confirmadas previamente.</span><span class="sxs-lookup"><span data-stu-id="173fd-215">This procedure forces a flush of the log records of all preceding committed delayed durable transactions to disk.</span></span> <span data-ttu-id="173fd-216">Para obtener más información, vea [sys.sp_flush_log &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-flush-log-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="173fd-216">For more information see [sys.sp_flush_log &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-flush-log-transact-sql).</span></span>  
  
##  <a name="delayed-durability-and-other-sql-server-features"></a><span data-ttu-id="173fd-217">Durabilidad diferida y otras características de SQL Server</span><span class="sxs-lookup"><span data-stu-id="173fd-217">Delayed durability and other SQL Server features</span></span>  
 <span data-ttu-id="173fd-218">**Seguimiento de cambios y captura de datos modificados**</span><span class="sxs-lookup"><span data-stu-id="173fd-218">**Change tracking and change data capture**</span></span>  
 <span data-ttu-id="173fd-219">Todas las transacciones con seguimiento de cambios son totalmente durables.</span><span class="sxs-lookup"><span data-stu-id="173fd-219">All transactions with change tracking are fully durable.</span></span> <span data-ttu-id="173fd-220">Las transacciones tienen la propiedad de seguimiento de cambios si realizan operaciones de escritura en tablas que se han habilitado para seguimiento de cambios.</span><span class="sxs-lookup"><span data-stu-id="173fd-220">A transaction has the change tracking property if it does any write operations to tables that are enabled for change tracking.</span></span> <span data-ttu-id="173fd-221">No se admite el uso de durabilidad diferida para bases de datos que usan captura de datos modificados (CDC).</span><span class="sxs-lookup"><span data-stu-id="173fd-221">The use of delayed durability is not supported for databases which use change data capture (CDC).</span></span>   
  
 <span data-ttu-id="173fd-222">**Recuperación tras bloqueo**</span><span class="sxs-lookup"><span data-stu-id="173fd-222">**Crash recovery**</span></span>  
 <span data-ttu-id="173fd-223">Se garantiza la coherencia, pero es posible que se pierdan algunas modificaciones de las transacciones de durabilidad diferida que se habían confirmado.</span><span class="sxs-lookup"><span data-stu-id="173fd-223">Consistency is guaranteed, but some changes from delayed durable transactions that have committed may be lost.</span></span>  
  
 <span data-ttu-id="173fd-224">**Transacciones entre bases de datos y DTC**</span><span class="sxs-lookup"><span data-stu-id="173fd-224">**Cross-database and DTC**</span></span>  
 <span data-ttu-id="173fd-225">Si una transacción es entre bases de datos o distribuida, es totalmente durable, independientemente de cualquier configuración de confirmación de base de datos o de transacción.</span><span class="sxs-lookup"><span data-stu-id="173fd-225">If a transaction is cross-database or distributed, if is fully durable, regardless of any database or transaction commit setting.</span></span>  
  
 <span data-ttu-id="173fd-226">**Grupos de disponibilidad AlwaysOn y creación de reflejo**</span><span class="sxs-lookup"><span data-stu-id="173fd-226">**Always On Availability Groups and Mirroring**</span></span>  
 <span data-ttu-id="173fd-227">Las transacciones de durabilidad diferida no garantizan la durabilidad del primario ni de los secundarios.</span><span class="sxs-lookup"><span data-stu-id="173fd-227">Delayed durable transactions do not guarantee any durability on either the primary or any of the secondaries.</span></span> <span data-ttu-id="173fd-228">Tampoco garantizan ningún conocimiento sobre la transacción en el secundario.</span><span class="sxs-lookup"><span data-stu-id="173fd-228">In addition, they do not guarantee any knowledge about the transaction at the secondary.</span></span> <span data-ttu-id="173fd-229">Después de COMMIT, se devuelve el control al cliente antes de que se reciba algún reconocimiento desde un elemento secundario sincrónico.</span><span class="sxs-lookup"><span data-stu-id="173fd-229">After commit, control is returned to the client before any acknowledgement is received from any synchronous secondary.</span></span>  
  
 <span data-ttu-id="173fd-230">**Agrupación en clústeres de conmutación por error**</span><span class="sxs-lookup"><span data-stu-id="173fd-230">**Failover clustering**</span></span>  
 <span data-ttu-id="173fd-231">Es posible que se pierdan algunas escrituras de transacciones durables diferidas.</span><span class="sxs-lookup"><span data-stu-id="173fd-231">Some delayed durable transaction writes might be lost.</span></span>  
  
 <span data-ttu-id="173fd-232">**Replicación de transacciones**</span><span class="sxs-lookup"><span data-stu-id="173fd-232">**Transaction Replication**</span></span>  
 <span data-ttu-id="173fd-233">Las transacciones durables diferidas no son compatibles con la replicación transaccional.</span><span class="sxs-lookup"><span data-stu-id="173fd-233">Delayed durable transactions is not supported with Transactional Replication.</span></span>  
  
 <span data-ttu-id="173fd-234">**Trasvase de registros**</span><span class="sxs-lookup"><span data-stu-id="173fd-234">**Log shipping**</span></span>  
 <span data-ttu-id="173fd-235">Solo las transacciones que se han convertido en durables se incluyen en el registro que se trasvasa.</span><span class="sxs-lookup"><span data-stu-id="173fd-235">Only transactions that have been made durable are included in the log that is shipped.</span></span>  
  
 <span data-ttu-id="173fd-236">**Copia de seguridad de registros**</span><span class="sxs-lookup"><span data-stu-id="173fd-236">**Log Backup**</span></span>  
 <span data-ttu-id="173fd-237">Solo las transacciones que se han convertido en durables se incluyen en la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="173fd-237">Only transactions that have been made durable are included in the backup.</span></span>  
  
## <a name="when-can-i-lose-data"></a><span data-ttu-id="173fd-238">¿Cuándo puedo perder datos?</span><span class="sxs-lookup"><span data-stu-id="173fd-238">When can I lose data?</span></span>  
 <span data-ttu-id="173fd-239">Si implementa la durabilidad diferida en alguna de las tablas, verá que ciertas condiciones pueden provocar la pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="173fd-239">If you implement delayed durability on any of your tables, you should understand that certain circumstances can lead to data loss.</span></span> <span data-ttu-id="173fd-240">Si no puede tolerar una pérdida de datos, no debería usar la durabilidad diferida en las tablas.</span><span class="sxs-lookup"><span data-stu-id="173fd-240">If you cannot tolerate any data loss, you should not use delayed durability on your tables.</span></span>  
  
### <a name="catastrophic-events"></a><span data-ttu-id="173fd-241">Catástrofes</span><span class="sxs-lookup"><span data-stu-id="173fd-241">Catastrophic events</span></span>  
 <span data-ttu-id="173fd-242">En caso de catástrofe, como un bloqueo del servidor, perderá los datos de todas las transacciones confirmadas que no se hayan guardado en el disco.</span><span class="sxs-lookup"><span data-stu-id="173fd-242">In the case of a catastrophic event, like a server crash, you will lose the data for all committed transactions that have not been saved to disk.</span></span> <span data-ttu-id="173fd-243">Las transacciones de durabilidad diferida se guardan en el disco siempre que se ejecute una transacción totalmente durable respecto a una tabla (optimizada para memoria durable o basada en disco) en la base de datos o cuando se llama a `sp_flush_log` .</span><span class="sxs-lookup"><span data-stu-id="173fd-243">Delayed durable transactions are saved to disk whenever a fully durable transaction is executed against any table (durable memory-optimized or disk-based) in the database, or `sp_flush_log` is called.</span></span> <span data-ttu-id="173fd-244">Si está usando transacciones de durabilidad diferida, conviene crear una tabla pequeña en la base de datos que podrá actualizar regularmente o llamar de forma periódica a `sp_flush_log` para guardar todas las transacciones confirmadas pendientes.</span><span class="sxs-lookup"><span data-stu-id="173fd-244">If you are using delayed durable transactions, you may want to create a small table in the database that you can periodically update or periodically call `sp_flush_log` to save all outstanding committed transactions.</span></span> <span data-ttu-id="173fd-245">El registro de transacciones también se vacía cada vez que se llena, pero es difícil de predecir e imposible de controlar.</span><span class="sxs-lookup"><span data-stu-id="173fd-245">The transaction log also flushes whenever it becomes full, but that is hard to predict and impossible to control.</span></span>  
  
### <a name="sql-server-shutdown-and-restart"></a><span data-ttu-id="173fd-246">SQL Server apagar y reiniciar</span><span class="sxs-lookup"><span data-stu-id="173fd-246">SQL Server shutdown and restart</span></span>  
 <span data-ttu-id="173fd-247">En lo que respecta a la durabilidad diferida, no hay ninguna diferencia entre el cierre inesperado y el cierre/reinicio planeado de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="173fd-247">For delayed durability, there is no difference between an unexpected shutdown and an expected shutdown/restart of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="173fd-248">Al igual que en las catástrofes, debe prever una pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="173fd-248">Like catastrophic events, you should plan for data loss.</span></span> <span data-ttu-id="173fd-249">En un cierre/reinicio planeado, algunas transacciones que no se han escrito en el disco podrían, en primer lugar, guardarse en el disco, pero no debería contar con ello.</span><span class="sxs-lookup"><span data-stu-id="173fd-249">In a planned shutdown/restart some transactions that have not been written to disk may first be saved to disk, but you should not plan on it.</span></span> <span data-ttu-id="173fd-250">Tenga previsto sin embargo que en un cierre/reinicio, bien se haya planeado o no, se pierden datos al igual que en las catástrofes.</span><span class="sxs-lookup"><span data-stu-id="173fd-250">Plan as though a shutdown/restart, whether planned or unplanned, loses the data the same as a catastrophic event.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="173fd-251">Consulte también</span><span class="sxs-lookup"><span data-stu-id="173fd-251">See Also</span></span>  
 <span data-ttu-id="173fd-252">[Niveles de aislamiento de transacción](../../database-engine/transaction-isolation-levels.md) </span><span class="sxs-lookup"><span data-stu-id="173fd-252">[Transaction Isolation Levels](../../database-engine/transaction-isolation-levels.md) </span></span>  
 [<span data-ttu-id="173fd-253">Instrucciones para los niveles de aislamiento de transacciones con tablas con optimización para memoria</span><span class="sxs-lookup"><span data-stu-id="173fd-253">Guidelines for Transaction Isolation Levels with Memory-Optimized Tables</span></span>](../in-memory-oltp/memory-optimized-tables.md)  
  
  
