---
title: Archivos de datos de SQL Server en Azure | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: supportability
ms.topic: conceptual
ms.assetid: 38ffd9c2-18a5-43d2-b674-e425addec4e4
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 21f960a50ed48ff2b146d96b73a1609d73b35c32
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87744119"
---
# <a name="sql-server-data-files-in-azure"></a><span data-ttu-id="ebbd6-102">Archivos de datos de SQL Server en Azure</span><span class="sxs-lookup"><span data-stu-id="ebbd6-102">SQL Server Data Files in Azure</span></span>
  <span data-ttu-id="ebbd6-103">SQL Server los archivos de datos de Azure permiten la compatibilidad nativa con los archivos de base de datos de SQL Server almacenados como blobs de Azure.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-103">SQL Server Data Files in Azure enables native support for SQL Server database files stored as Azure Blobs.</span></span> <span data-ttu-id="ebbd6-104">Permite crear una base de datos en SQL Server que se ejecuta en el entorno local o en una máquina virtual de Azure con una ubicación de almacenamiento dedicada para los datos en Azure Blob Storage.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-104">It allows you to create a database in SQL Server running in on-premises or in a virtual machine in Azure with a dedicated storage location for your data in Azure Blob Storage.</span></span> <span data-ttu-id="ebbd6-105">Esta mejora simplifica especialmente el traslado de bases de datos entre equipos mediante operaciones de separar y adjuntar.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-105">This enhancement especially simplifies to move databases between machines by using detach and attach operations.</span></span> <span data-ttu-id="ebbd6-106">Además, proporciona una ubicación de almacenamiento alternativa para los archivos de copia de seguridad de base de datos, ya que permite realizar la restauración desde o hasta Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-106">In addition, it provides an alternative storage location for your database backup files by allowing you to restore from or to Azure Storage.</span></span> <span data-ttu-id="ebbd6-107">Por tanto, habilita diversas soluciones híbridas al aportar varias ventajas en cuanto a virtualización de datos, movimiento de datos, seguridad y disponibilidad, así como costos y mantenimiento reducidos para lograr escalado flexible y alta disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-107">Therefore, it enables several hybrid solutions by providing several benefits for data virtualization, data movement, security and availability, and any easy low costs and maintenance for high-availability and elastic scaling.</span></span>  
  
 <span data-ttu-id="ebbd6-108">En este tema se presentan los conceptos y las consideraciones que son fundamentales para almacenar archivos de datos de SQL Server en Azure Storage Service.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-108">This topic introduces concepts and considerations that are central to storing SQL Server data files in Azure Storage Service.</span></span>  
  
 <span data-ttu-id="ebbd6-109">Para una experiencia práctica práctica sobre cómo usar esta nueva característica, consulte [Tutorial: SQL Server de archivos de datos en Azure Storage Service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="ebbd6-109">For a practical hands-on experience on how to use this new feature, see [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
 <span data-ttu-id="ebbd6-110">En el diagrama siguiente se muestra que esta mejora permite almacenar SQL Server archivos de base de datos como blobs de Azure en Azure Storage independientemente de dónde resida el servidor.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-110">The following diagram demonstrates that this enhancement enables you to store SQL Server database files as Azure blobs in Azure Storage regardless of where your server resides.</span></span>  
  
 <span data-ttu-id="ebbd6-111">![Integración de SQL Server con Azure Storage](../../database-engine/media/sql-server-dbfiles-stored-as-blobs.gif "Integración de SQL Server con Azure Storage")</span><span class="sxs-lookup"><span data-stu-id="ebbd6-111">![SQL Server Integration with Azure Storage](../../database-engine/media/sql-server-dbfiles-stored-as-blobs.gif "SQL Server Integration with Azure Storage")</span></span>  
  
## <a name="benefits-of-using-sql-server-data-files-in-azure"></a><span data-ttu-id="ebbd6-112">Ventajas de usar archivos de datos de SQL Server en Azure</span><span class="sxs-lookup"><span data-stu-id="ebbd6-112">Benefits of using SQL Server Data Files in Azure</span></span>  
  
-   <span data-ttu-id="ebbd6-113">**Ventajas de una migración rápida y sencilla:** Esta característica simplifica el proceso de migración, para lo que mueve una base de datos cada vez entre equipos locales así como entre entornos locales y en la nube sin cambios en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-113">**Easy and fast migration benefits:** This feature simplifies the migration process by moving one database at a time between machines in on-premises as well as between on-premises and cloud environments without any application changes.</span></span> <span data-ttu-id="ebbd6-114">Por tanto, admite una migración incremental a la vez que conserva la infraestructura local existente.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-114">Therefore, it supports an incremental migration while maintaining your existing on-premises infrastructure in place.</span></span> <span data-ttu-id="ebbd6-115">Además, tener acceso a un almacenamiento de datos centralizado simplifica la lógica de la aplicación en los casos en los que una aplicación deba ejecutarse en varias ubicaciones en un entorno local.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-115">In addition, having access to a centralized data storage simplifies the application logic when an application needs to run in multiple locations in an on-premises environment.</span></span> <span data-ttu-id="ebbd6-116">En algunos casos, es posible que necesite configurar rápidamente centros informáticos en ubicaciones geográficamente dispersas, que recopilen datos de muchas fuentes diferentes.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-116">In some cases, you may need to rapidly setup computer centers in geographically dispersed locations, which gather data from many different sources.</span></span> <span data-ttu-id="ebbd6-117">Con esta nueva mejora, en lugar de mover datos de una ubicación a otra, puede almacenar muchas bases de datos como blobs de Azure y, después, ejecutar scripts de Transact-SQL para crear bases de datos en los equipos locales o máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-117">By using this new enhancement, instead of moving data from one location to another, you can store many databases as Azure blobs, and then run Transact-SQL scripts to create databases on the local machines or virtual machines.</span></span>  
  
-   <span data-ttu-id="ebbd6-118">**Ventajas del costo y del almacenamiento ilimitado:** Esta característica permite tener un almacenamiento fuera de la ubicación ilimitado en Azure al tiempo que se aprovechan los recursos de proceso locales.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-118">**Cost and limitless storage benefits:** This feature enables you to have limitless off-site storage in Azure while leveraging on-premises compute resources.</span></span> <span data-ttu-id="ebbd6-119">Si usa Azure como ubicación de almacenamiento, puede centrarse fácilmente en la lógica de la aplicación sin la sobrecarga de administración de hardware.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-119">When you use Azure as a storage location, you can easily focus on the application logic without the overhead of hardware management.</span></span> <span data-ttu-id="ebbd6-120">Si pierde un nodo de proceso local, puede configurar uno nuevo sin tener que mover datos.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-120">If you lose a computation node on-premises, you can set up a new one without any data movement.</span></span>  
  
-   <span data-ttu-id="ebbd6-121">**Ventajas de alta disponibilidad y recuperación ante desastres:** El uso de SQL Server archivos de datos en la característica de Azure puede simplificar las soluciones de alta disponibilidad y recuperación ante desastres.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-121">**High availability and disaster recovery benefits:** Using SQL Server Data Files in Azure feature might simplify the high availability and disaster recovery solutions.</span></span> <span data-ttu-id="ebbd6-122">Por ejemplo, si una máquina virtual de Azure o una instancia de SQL Server se bloquea, puede volver a crear las bases de datos en una nueva máquina simplemente volviendo a establecer vínculos a los blobs de Azure.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-122">For example, if a virtual machine in Azure or an instance of SQL Server crashes, you can re-create your databases in a new machine by just re-establishing links to Azure Blobs.</span></span>  
  
-   <span data-ttu-id="ebbd6-123">**Ventajas de seguridad:** esta nueva mejora permite separar una instancia de proceso de una instancia de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-123">**Security benefits:** This new enhancement allows you to separate a compute instance from a storage instance.</span></span> <span data-ttu-id="ebbd6-124">Puede tener una base de datos completamente cifrada donde el descifrado solo se produce en una instancia de proceso, pero no en una instancia de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-124">You can have a fully encrypted database with decryption only occurring on compute instance but not in a storage instance.</span></span> <span data-ttu-id="ebbd6-125">Es decir, con esta nueva mejora, puede cifrar todos los datos de la nube pública mediante certificados de cifrado de datos transparente (TDE), que están separados físicamente de los datos.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-125">In other words, using this new enhancement, you can encrypt all data in public cloud using Transparent Data Encryption (TDE)  certificates, which are physically separated from the data.</span></span> <span data-ttu-id="ebbd6-126">Las claves TDE se pueden almacenar en la base de datos maestra, la cual se almacena localmente en el equipo local protegido físicamente y con copia de seguridad íntegra.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-126">The TDE keys can be stored in the master database, which is stored locally in your physically secure on-premises machine and backed up locally.</span></span> <span data-ttu-id="ebbd6-127">Puede usar estas claves locales para cifrar los datos, que residen en Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-127">You can use these local keys to encrypt the data, which resides in Azure Storage.</span></span> <span data-ttu-id="ebbd6-128">Si roban las credenciales de la cuenta de almacenamiento en la nube, los datos seguirán estando protegidos ya que los certificados TDE siempre se encuentran en el entorno local.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-128">If your cloud storage account credentials are stolen, your data still stays secure as the TDE certificates always reside in on-premises.</span></span>  
  
## <a name="concepts-and-requirements"></a><span data-ttu-id="ebbd6-129">Conceptos y requisitos</span><span class="sxs-lookup"><span data-stu-id="ebbd6-129">Concepts and Requirements</span></span>  
  
### <a name="azure-storage-concepts"></a><span data-ttu-id="ebbd6-130">Conceptos de Azure Storage</span><span class="sxs-lookup"><span data-stu-id="ebbd6-130">Azure Storage Concepts</span></span>  
 <span data-ttu-id="ebbd6-131">Cuando use la característica Archivos de datos de SQL Server en Azure, debe crear una cuenta de almacenamiento y un contenedor en Azure.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-131">When using SQL Server Data Files in Azure feature, you need to create a storage account and a container in Azure.</span></span> <span data-ttu-id="ebbd6-132">A continuación, debe crear una credencial de SQL Server, que incluye información sobre la directiva del contenedor así como una firma de acceso compartido, la cual resulta necesaria para tener acceso al contenedor.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-132">Then, you need to create a SQL Server credential, which includes information on the policy of the container as well as a shared access signature that is necessary to access the container.</span></span>  
  
 <span data-ttu-id="ebbd6-133">En Azure, una cuenta de almacenamiento representa el nivel más alto del espacio de nombres para tener acceso a los BLOBs.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-133">In Azure, a storage account represents the highest level of the namespace for accessing Blobs.</span></span> <span data-ttu-id="ebbd6-134">Una cuenta de almacenamiento puede contener un número ilimitado de contenedores, siempre que su tamaño total sea inferior a 500 TB.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-134">A storage account can contain an unlimited number of containers, as long as their total size is under 500 TB.</span></span> <span data-ttu-id="ebbd6-135">Para obtener la información más reciente acerca de los límites de almacenamiento, vea [Suscripciones de Azure y límites de servicio, cuotas y restricciones](https://azure.microsoft.com/documentation/articles/azure-subscription-service-limits/).</span><span class="sxs-lookup"><span data-stu-id="ebbd6-135">For the latest information on storage limits, see [Azure Subscription and Service Limits, Quotas, and Constraints](https://azure.microsoft.com/documentation/articles/azure-subscription-service-limits/).</span></span> <span data-ttu-id="ebbd6-136">Un contenedor proporciona una agrupación de un conjunto de blobs.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-136">A container provides a grouping of a set of Blobs.</span></span> <span data-ttu-id="ebbd6-137">Todos los blobs deben estar en un contenedor.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-137">All Blobs must be in a container.</span></span> <span data-ttu-id="ebbd6-138">Una cuenta puede contener un número ilimitado de contenedores.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-138">An account can contain an unlimited number of containers.</span></span> <span data-ttu-id="ebbd6-139">De forma similar, un contenedor puede almacenar un número ilimitado de blobs igualmente.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-139">Similarly, a container can store an unlimited number of Blobs as well.</span></span> <span data-ttu-id="ebbd6-140">Existen dos tipos de blobs que pueden almacenarse en Azure Storage: blobs en páginas y en bloques.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-140">There are two types of blobs that can be stored in Azure Storage: block and page blobs.</span></span> <span data-ttu-id="ebbd6-141">Esta nueva característica utiliza blobs en páginas, que pueden tener un tamaño de hasta 1 TB y son más eficaces cuando los intervalos de bytes en el archivo se modifican con frecuencia.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-141">This new feature uses Page blobs, which can be up to 1TB in size, and are more efficient when ranges of bytes in a file are modified frequently.</span></span> <span data-ttu-id="ebbd6-142">Puede obtener acceso a blobs mediante el siguiente formato de dirección URL: `http://storageaccount.blob.core.windows.net/<container>/<blob>`.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-142">You can access Blobs using the following URL format: `http://storageaccount.blob.core.windows.net/<container>/<blob>`.</span></span>  
  
### <a name="azure-billing-considerations"></a><span data-ttu-id="ebbd6-143">Consideraciones sobre la facturación de Azure</span><span class="sxs-lookup"><span data-stu-id="ebbd6-143">Azure Billing Considerations</span></span>  
 <span data-ttu-id="ebbd6-144">Estimar el costo de usar los servicios de Azure es una cuestión importante a la hora de tomar decisiones y en el proceso de planeamiento.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-144">Estimating the cost of using Azure Services is an important matter in the decision making and planning process.</span></span> <span data-ttu-id="ebbd6-145">Al almacenar archivos de datos de SQL Server en Azure Storage, deberá correr con los gastos asociados al almacenamiento y las transacciones.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-145">When storing SQL Server data files in Azure Storage, you need to pay costs associated with storage and transactions.</span></span> <span data-ttu-id="ebbd6-146">Además, la implementación de la característica Archivos de datos de SQL Server en Azure Storage requiere una renovación de la concesión de blobs cada 45-60 segundos de forma implícita.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-146">In addition, the implementation of SQL Server Data Files in Azure Storage feature requires a renewal of Blob lease every 45 to 60 seconds implicitly.</span></span> <span data-ttu-id="ebbd6-147">Esto también ocasiona costos de transacción por archivo de base de datos, como .mdf y .ldf.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-147">This also results in transaction costs per database file, such as .mdf or .ldf.</span></span> <span data-ttu-id="ebbd6-148">Según nuestras estimaciones, el costo por renovar las concesiones para dos archivos de base de datos (.mdf y .ldf) sería de unos 2 centavos al mes según el modelo actual de precios.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-148">Based on our estimations, the cost of renewing leases for two database files (.mdf and .ldf) would be about 2 cents per month according to the current pricing model.</span></span> <span data-ttu-id="ebbd6-149">Recomendamos usar la información de la página [Precios de Azure](https://azure.microsoft.com/pricing/) como ayuda para estimar los costos mensuales asociados al uso de Azure Storage y Máquinas virtuales de Azure.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-149">We recommend that you use the information on the [Azure Pricing](https://azure.microsoft.com/pricing/) page to help estimate the monthly costs associated with the use of Azure Storage and Azure Virtual Machines.</span></span>  
  
### <a name="sql-server-concepts"></a><span data-ttu-id="ebbd6-150">Conceptos de SQL Server</span><span class="sxs-lookup"><span data-stu-id="ebbd6-150">SQL Server Concepts</span></span>  
 <span data-ttu-id="ebbd6-151">Cuando use esta nueva mejora, deberá hacer lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="ebbd6-151">When using this new enhancement, you are required to do the followings:</span></span>  
  
-   <span data-ttu-id="ebbd6-152">Es preciso que cree una directiva en un contenedor y que genere una clave de firma de acceso compartido (SAS).</span><span class="sxs-lookup"><span data-stu-id="ebbd6-152">You must create a policy on a container and also generate a shared access signature (SAS) key.</span></span>  
  
-   <span data-ttu-id="ebbd6-153">Para cada contenedor utilizado por un archivo de datos o de registro, debe crear una credencial de SQL Server cuyo nombre coincida con la ruta de acceso del contenedor.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-153">For each container used by a data or a log file, you must create a SQL Server Credential whose name matches the container path.</span></span>  
  
-   <span data-ttu-id="ebbd6-154">Debe almacenar la información sobre el contenedor de Azure Storage, su nombre de directiva asociado y la clave SAS en el almacén de credenciales de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-154">You must store the information regarding Azure Storage container, its associated policy name, and SAS key in the SQL Server credential store.</span></span>  
  
 <span data-ttu-id="ebbd6-155">En el ejemplo siguiente se da por supuesto que se ha creado un contenedor de Azure Storage y que se ha creado una directiva con derechos de lectura, escritura, lista y.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-155">The following example assumes that an Azure Storage container has been created, and a policy has been created with read, write, list, rights.</span></span> <span data-ttu-id="ebbd6-156">Cuando se crea una directiva en un contenedor, se genera una clave SAS que podrá guardar en la memoria de forma segura sin cifrar y que necesita SQL Server para acceder a los archivos de blob en el contenedor.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-156">Creating a policy on a container generates a SAS key which is safe to keep unencrypted in memory and needed by SQL Server to access the blob files in the container.</span></span> <span data-ttu-id="ebbd6-157">En el siguiente fragmento de código, reemplace `'your SAS key'` por una entrada similar a la siguiente: `'sr=c&si=<MYPOLICYNAME>&sig=<THESHAREDACCESSSIGNATURE>'`.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-157">In the following code snippet, replace `'your SAS key'` with an entry similar to the following: `'sr=c&si=<MYPOLICYNAME>&sig=<THESHAREDACCESSSIGNATURE>'`.</span></span> <span data-ttu-id="ebbd6-158">Para obtener más información, consulte [crear y usar una firma de acceso compartido](https://msdn.microsoft.com/library/azure/jj721951.aspx)</span><span class="sxs-lookup"><span data-stu-id="ebbd6-158">For more information, see [Create and Use a Shared Access Signature](https://msdn.microsoft.com/library/azure/jj721951.aspx)</span></span>  
  
```sql
-- Create a credential  
CREATE CREDENTIAL [https://testdb.blob.core.windows.net/data]  
WITH IDENTITY='SHARED ACCESS SIGNATURE',  
SECRET = 'your SAS key'  
  
-- Create database with data and log files in Azure container.  
CREATE DATABASE testdb   
ON  
( NAME = testdb_dat,  
    FILENAME = 'https://testdb.blob.core.windows.net/data/TestData.mdf' )  
 LOG ON  
( NAME = testdb_log,  
    FILENAME =  'https://testdb.blob.core.windows.net/data/TestLog.ldf')
```  
  
> [!IMPORTANT]
> <span data-ttu-id="ebbd6-159">Si hay referencias activas a archivos de datos en un contenedor, cualquier intento de eliminar la credencial correspondiente de SQL Server generará un error.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-159">If there are any active references to data files in a container, attempts to delete the corresponding SQL Server credential fails.</span></span>  
  
### <a name="security"></a><span data-ttu-id="ebbd6-160">Seguridad</span><span class="sxs-lookup"><span data-stu-id="ebbd6-160">Security</span></span>  
 <span data-ttu-id="ebbd6-161">A continuación se describen las consideraciones y los requisitos relativos a la seguridad cuando se almacenan archivos de datos de SQL Server en Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-161">The following are security considerations and requirements when storing SQL Server Data Files in Azure Storage.</span></span>  
  
-   <span data-ttu-id="ebbd6-162">Al crear un contenedor para el servicio Blob Storage de Azure, se recomienda establecer el acceso en privado.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-162">When creating a container for the Azure Blob storage service, we recommend that you set the access to private.</span></span> <span data-ttu-id="ebbd6-163">Al establecer el acceso en privado, solo el propietario de la cuenta de Azure puede leer el contenedor y los datos de blob.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-163">When you set the access to private, container and blob data can be read by the Azure account owner only.</span></span>  
  
-   <span data-ttu-id="ebbd6-164">Cuando se almacenan archivos de la base de datos de SQL Server en Azure Storage, debe usar una firma de acceso compartido, un URI que concede derechos de acceso restringido a contenedores, blobs, colas y tablas.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-164">When storing SQL Server database files in Azure Storage, you need to use a shared access signature, a URI that grants restricted access rights to containers, blobs, queues, and tables.</span></span> <span data-ttu-id="ebbd6-165">El uso de una firma de acceso compartido permite que SQL Server obtenga acceso a recursos de su cuenta de almacenamiento sin compartir la clave de su cuenta de Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-165">By using a shared access signature, you can enable SQL Server to access resources in your storage account without sharing your Azure storage account key.</span></span>  
  
-   <span data-ttu-id="ebbd6-166">Por otra parte, se recomienda que siga implementando los procedimientos habituales de seguridad locales para las bases de datos.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-166">In addition, we recommend that you continue implementing the traditional on-premises security practices for your databases.</span></span>  
  
### <a name="installation-prerequisites"></a><span data-ttu-id="ebbd6-167">Requisitos previos de instalación</span><span class="sxs-lookup"><span data-stu-id="ebbd6-167">Installation Prerequisites</span></span>  
 <span data-ttu-id="ebbd6-168">A continuación se indican los requisitos previos de instalación cuando se almacenan SQL Server archivos de datos en Azure.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-168">The followings are installation prerequisites when storing SQL Server Data Files in Azuree.</span></span>  
  
-   <span data-ttu-id="ebbd6-169">**SQL Server local:** la versión SQL Server 2014 incluye esta característica.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-169">**SQL Server on-premises:** SQL Server 2014 version includes this feature.</span></span> <span data-ttu-id="ebbd6-170">Para obtener información sobre cómo descargar SQL Server 2014, vea [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx).</span><span class="sxs-lookup"><span data-stu-id="ebbd6-170">To learn how to download SQL Server 2014, see [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx).</span></span>  
  
-   <span data-ttu-id="ebbd6-171">SQL Server que se ejecuta en una máquina virtual de Azure: si va a instalar SQL Server en una máquina virtual de Azure, instale SQL Server 2014 o actualice la instancia existente.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-171">SQL Server running in an Azure virtual machine: If you are installing SQL Server on an Azure Virtual Machine, install SQL Server 2014, or update your existing instance.</span></span> <span data-ttu-id="ebbd6-172">Del mismo modo, también puede crear una nueva máquina virtual en Azure con la imagen de la plataforma SQL Server 2014.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-172">Similarly, you can also create a new virtual machine in Azure using SQL Server 2014 platform image.</span></span> <span data-ttu-id="ebbd6-173">Para obtener información sobre cómo descargar SQL Server 2014, vea [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx).</span><span class="sxs-lookup"><span data-stu-id="ebbd6-173">To learn how to download SQL Server 2014, see [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx).</span></span>  
  
###  <a name="limitations"></a><a name="bkmk_Limitations"></a> <span data-ttu-id="ebbd6-174">Limitaciones</span><span class="sxs-lookup"><span data-stu-id="ebbd6-174">Limitations</span></span>  
  
-   <span data-ttu-id="ebbd6-175">En la versión actual de esta característica, `FileStream` no se admite el almacenamiento de datos en Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-175">In the current release of this feature, storing `FileStream` data in Azure Storage is not supported.</span></span> <span data-ttu-id="ebbd6-176">Puede almacenar `Filestream` datos en una Azure Storage base de datos local integrada, pero no puede trasladar datos de FileStream entre equipos mediante Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-176">You can store `Filestream` data in an Azure Storage integrated local database but you cannot move Filestream data between machines using Azure Storage.</span></span> <span data-ttu-id="ebbd6-177">Para los datos `FileStream`, se recomienda que siga usando las técnicas tradicionales para mover archivos (.mdf, .ldf) asociadas con Filestream entre varios equipos.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-177">For `FileStream` data, we recommend that you continue using the traditional techniques to move the files (.mdf, .ldf) associated with Filestream between different machines.</span></span>  
  
-   <span data-ttu-id="ebbd6-178">Actualmente, esta nueva mejora no admite que más de una instancia de SQL Server tenga acceso a los mismos archivos de base de datos de Azure Storage al mismo tiempo.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-178">Currently, this new enhancement does not support more than one SQL Server instance accessing the same database files in Azure Storage at the same time.</span></span> <span data-ttu-id="ebbd6-179">Si el Servidor A está en línea con un archivo de base de datos activo y el Servidor B se inicia accidentalmente y tiene también una base de datos que apunta al mismo archivo de datos, el segundo servidor no podrá iniciar la base de datos y se generará un error con un código **5120 No se puede abrir el archivo físico "%.\*ls". Error del sistema operativo %d: "%ls"** .</span><span class="sxs-lookup"><span data-stu-id="ebbd6-179">If ServerA is online with an active database file and if ServerB is accidentally started, and it also has a database which points to the same data file, the second server will fail to start the database with an error code **5120 Unable to open the physical file "%.\*ls". Operating system error %d: "%ls"**.</span></span>  
  
-   <span data-ttu-id="ebbd6-180">Solo los archivos .mdf, .ldf y .ndf se pueden almacenar en Azure Storage con la característica Archivos de datos de SQL Server en Azure.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-180">Only .mdf, .ldf, and .ndf files can be stored in Azure Storage by using the SQL Server Data Files in Azure feature.</span></span>  
  
-   <span data-ttu-id="ebbd6-181">Cuando se utiliza la característica Archivos de datos de SQL Server en Azure, no se admite la replicación geográfica para la cuenta de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-181">When using the SQL Server Data Files in Azure feature, geo-replication for your storage account is not supported.</span></span> <span data-ttu-id="ebbd6-182">Si se realiza la replicación geográfica en la cuenta de almacenamiento y se produce una conmutación por error geográfica, se dañará la base de datos.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-182">If a storage account is geo-replicated and a geo-failover happened, database corruption could occur.</span></span>  
  
-   <span data-ttu-id="ebbd6-183">Cada blob puede tener un tamaño máximo de 1 TB.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-183">Each Blob can be up to maximum 1 TB in size.</span></span> <span data-ttu-id="ebbd6-184">Esto crea un límite superior en cuanto a los archivos de datos y de registro de base de datos individuales que se pueden almacenar en Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-184">This creates an upper limit on individual database data and log files that can be stored in Azure Storage.</span></span>  
  
-   <span data-ttu-id="ebbd6-185">No es posible almacenar datos de OLTP en memoria en el Blob de Azure con la característica Archivos de datos de SQL Server en Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-185">It is not possible to store In-Memory OLTP data in Azure Blob using the SQL Server Data Files in Azure Storage feature.</span></span> <span data-ttu-id="ebbd6-186">Esto se debe a que OLTP en memoria tiene una dependencia de `FileStream` y, en la versión actual de esta característica, `FileStream` no se admite el almacenamiento de datos en Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-186">This is because In-Memory OLTP has a dependency on `FileStream` and, in the current release of this feature, storing `FileStream` data in Azure Storage is not supported.</span></span>  
  
-   <span data-ttu-id="ebbd6-187">Al utilizar SQL Server archivos de datos en la característica de Azure, SQL Server realiza todas las comparaciones de ruta de acceso de archivo o dirección URL mediante la intercalación establecida en la `master` base de datos.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-187">When using SQL Server Data Files in Azure feature, SQL Server performs all URL or file path comparisons using the Collation set in the `master` database.</span></span>  
  
-   <span data-ttu-id="ebbd6-188">Se admiten `AlwaysOn Availability Groups` siempre y cuando no agregue nuevos archivos de base de datos a la base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-188">`AlwaysOn Availability Groups` are supported as long as you do not add new database files to the primary database.</span></span> <span data-ttu-id="ebbd6-189">Si una operación de base de datos requiere que se cree un nuevo archivo en la base de datos principal, en primer lugar, deshabilite los grupos de disponibilidad AlwaysOn en el nodo secundario.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-189">If a database operation requires a new file to be created in the primary database, first disable AlwaysOn Availability Groups in the secondary node.</span></span> <span data-ttu-id="ebbd6-190">Posteriormente, realice la operación de base de datos en la base de datos principal y haga una copia de seguridad de la base de datos en el nodo principal.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-190">Then, perform the database operation on the primary database and backup the database in the primary node.</span></span> <span data-ttu-id="ebbd6-191">A continuación, restaure la base de datos al nodo secundario y habilite los grupos de disponibilidad AlwaysOn en el nodo secundario.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-191">Next, restore the database to the secondary node, and enable AlwaysOn Availability Groups in the secondary node.</span></span> <span data-ttu-id="ebbd6-192">Tenga en cuenta que las instancias de clúster de conmutación por error de AlwaysOn no se admiten cuando se usa la característica archivos de datos de SQL Server en Azure.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-192">Note that AlwaysOn Failover Cluster Instances is not supported when using the SQL Server Data Files in Azure feature.</span></span>  
  
-   <span data-ttu-id="ebbd6-193">Durante el funcionamiento normal, SQL Server utiliza concesiones temporales con el fin de reservar y almacenar blobs con una renovación de cada concesión de blob cada 45-60 segundos.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-193">During normal operation, SQL Server uses temporary leases to reserve Blobs for storage with a renewal of each Blob lease every 45 to 60 seconds.</span></span> <span data-ttu-id="ebbd6-194">Si se bloquea un servidor y se inicia otra instancia de SQL Server configurada para usar los mismos blobs, la instancia nueva esperará hasta 60 segundos para que expire la concesión existente del blob.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-194">If a server crashes and another instance of SQL Server configured to use the same blobs is started, the new instance will wait up to 60 seconds for the existing lease on the Blob to expire.</span></span> <span data-ttu-id="ebbd6-195">Si desea adjuntar la base de datos a otra instancia y no puede esperar 60 segundos a que expire la concesión, puede detener explícitamente la concesión en el blob para evitar errores en las operaciones de adjuntar.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-195">If you want to attach the database to another instance and you cannot wait for the lease to expire within 60 seconds, you can explicitly break the lease on the Blob to avoid any failures in attach operations.</span></span>  
  
## <a name="tools-and-programming-reference-support"></a><span data-ttu-id="ebbd6-196">Herramientas y compatibilidad con referencia de programación</span><span class="sxs-lookup"><span data-stu-id="ebbd6-196">Tools and programming reference support</span></span>  
 <span data-ttu-id="ebbd6-197">En esta sección se describen las herramientas y las bibliotecas de referencia de programación que se pueden utilizar al almacenar archivos de datos de SQL Server en Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-197">This section describes which tools and programming reference libraries can be used when storing SQL Server data files in Azure Storage.</span></span>  
  
### <a name="powershell-support"></a><span data-ttu-id="ebbd6-198">Compatibilidad con PowerShell</span><span class="sxs-lookup"><span data-stu-id="ebbd6-198">PowerShell support</span></span>  
 <span data-ttu-id="ebbd6-199">En SQL Server 2014, puede usar los cmdlets de PowerShell para almacenar archivos de datos de SQL Server en Azure Blob Storage servicio haciendo referencia a una ruta de acceso de la dirección URL de Blob Storage en lugar de a una ruta de acceso de archivo.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-199">In SQL Server 2014, you can use PowerShell cmdlets to store SQL Server data files in Azure Blob Storage service by referencing a Blob Storage URL path instead of a file path.</span></span> <span data-ttu-id="ebbd6-200">Puede obtener acceso a blobs mediante el siguiente formato de dirección URL:`: http://storageaccount.blob.core.windows.net/<container>/<blob>` .</span><span class="sxs-lookup"><span data-stu-id="ebbd6-200">You can access Blobs using the following URL format`: http://storageaccount.blob.core.windows.net/<container>/<blob>` .</span></span>  
  
### <a name="sql-server-object-and-performance-counters-support"></a><span data-ttu-id="ebbd6-201">Objetos de SQL Server y compatibilidad con contadores de rendimiento</span><span class="sxs-lookup"><span data-stu-id="ebbd6-201">SQL Server Object and performance counters support</span></span>  
 <span data-ttu-id="ebbd6-202">A partir de SQL Server 2014, se ha agregado un nuevo objeto de SQL Server que se usará con la característica Archivos de datos de SQL Server en Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-202">Starting with SQL Server 2014, a new SQL Server object has been added to be used with SQL Server Data Files in Azure Storage feature.</span></span> <span data-ttu-id="ebbd6-203">El nuevo objeto de SQL Server se denomina [SQL Server, HTTP_STORAGE_OBJECT](../performance-monitor/sql-server-http-storage-object.md) y lo puede usar el Monitor de sistema para supervisar la actividad cuando se ejecuta SQL Server con Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-203">The new SQL Server object is called as [SQL Server, HTTP_STORAGE_OBJECT](../performance-monitor/sql-server-http-storage-object.md) and it can be used by System Monitor to monitor activity when running SQL Server with Azure Storage.</span></span>  
  
### <a name="sql-server-management-studio-support"></a><span data-ttu-id="ebbd6-204">Compatibilidad con SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="ebbd6-204">SQL Server Management Studio support</span></span>  
 <span data-ttu-id="ebbd6-205">SQL Server Management Studio le permite usar esta característica a través de varias ventanas de diálogo.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-205">SQL Server Management Studio allows you to use this feature via several dialog windows.</span></span> <span data-ttu-id="ebbd6-206">Por ejemplo, puede escribir la ruta de acceso de la dirección URL del contenedor de almacenamiento, de esta forma: `https://teststorageaccnt.blob.core.windows.net/testcontainer/` como una **Ruta de acceso** en varias ventanas de diálogo, como **Nueva base de datos**, **Adjuntar base de datos**y **Restaurar base de datos**.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-206">For example, you can type the URL path of the storage container, such as `https://teststorageaccnt.blob.core.windows.net/testcontainer/` as a **Path** in several dialog windows, such as **New Database**, **Attach Database**, and **Restore Database**.</span></span> <span data-ttu-id="ebbd6-207">Para obtener más información, vea [Tutorial: SQL Server de archivos de datos en Azure Storage Service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="ebbd6-207">For more information, see [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
### <a name="sql-server-management-objects-support"></a><span data-ttu-id="ebbd6-208">Compatibilidad con Objetos de administración de SQL Server</span><span class="sxs-lookup"><span data-stu-id="ebbd6-208">SQL Server Management Objects support</span></span>  
 <span data-ttu-id="ebbd6-209">Cuando se usa la característica Archivos de datos de SQL Server en Azure, se admiten todos los Objetos de administración de SQL Server (SMO).</span><span class="sxs-lookup"><span data-stu-id="ebbd6-209">When using the SQL Server Data Files in Azure feature, all SQL Server Management Objects (SMO) are supported.</span></span> <span data-ttu-id="ebbd6-210">Si un objeto SMO requiere una ruta de acceso, use el formato de dirección URL BLOB en lugar de una ruta de acceso de archivos local, como `https://teststorageaccnt.blob.core.windows.net/testcontainer/`.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-210">If an SMO object requires a file path, use the BLOB URL format instead of a local file path, such as `https://teststorageaccnt.blob.core.windows.net/testcontainer/`.</span></span> <span data-ttu-id="ebbd6-211">Para obtener más información sobre Objetos de administración de SQL Server (SMO), vea [Guía de programación para objetos de administración de SQL Server &#40;SMO&#41;](../server-management-objects-smo/sql-server-management-objects-smo-programming-guide.md)en los Libros en pantalla de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-211">For more information about SQL Server Management Objects (SMO), see [SQL Server Management Objects &#40;SMO&#41; Programming Guide](../server-management-objects-smo/sql-server-management-objects-smo-programming-guide.md) in SQL Server Books Online.</span></span>  
  
### <a name="transact-sql-support"></a><span data-ttu-id="ebbd6-212">Compatibilidad con Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="ebbd6-212">Transact-SQL support</span></span>  
 <span data-ttu-id="ebbd6-213">Esta nueva característica presenta el siguiente cambio en el área expuesta de Transact-SQL:</span><span class="sxs-lookup"><span data-stu-id="ebbd6-213">This new feature has introduced the following change in the Transact-SQL surface area:</span></span>  
  
-   <span data-ttu-id="ebbd6-214">Una nueva columna **int** , **credential_id**, en la vista del sistema **sys.master_files** .</span><span class="sxs-lookup"><span data-stu-id="ebbd6-214">A new **int** column, **credential_id**, in the **sys.master_files** system view.</span></span> <span data-ttu-id="ebbd6-215">La columna **credential_id** se usa para permitir la referencia cruzada en sys.credentials de los archivos de datos habilitados en Azure Storage para las credenciales creadas para ellos.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-215">The **credential_id** column is used to enable Azure Storage enabled data files to be cross-referenced back to sys.credentials for the credentials created for them.</span></span> <span data-ttu-id="ebbd6-216">Puede usarla para solucionar problemas, como que una credencial no se puede eliminar cuando un archivo de base de datos la está usando.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-216">You can use it for troubleshooting, such as a credential cannot be deleted when there is a database file which uses it.</span></span>  
  
##  <a name="troubleshooting-for-sql-server-data-files-in-azure"></a><a name="bkmk_Troubleshooting"></a><span data-ttu-id="ebbd6-217">Solución de problemas de archivos de datos de SQL Server en Azure</span><span class="sxs-lookup"><span data-stu-id="ebbd6-217">Troubleshooting for SQL Server Data Files in Azure</span></span>  
 <span data-ttu-id="ebbd6-218">Para evitar errores por funciones no admitidas o limitaciones, primero consulte [Limitations](sql-server-data-files-in-microsoft-azure.md#bkmk_Limitations).</span><span class="sxs-lookup"><span data-stu-id="ebbd6-218">To avoid errors due to unsupported features or limitations, first review [Limitations](sql-server-data-files-in-microsoft-azure.md#bkmk_Limitations).</span></span>  
  
 <span data-ttu-id="ebbd6-219">La lista de errores que puede obtener cuando se usa la característica Archivos de datos de SQL Server en Azure Storage es la siguiente:</span><span class="sxs-lookup"><span data-stu-id="ebbd6-219">The list of errors that you might get when using the SQL Server Data Files in Azure Storage feature are as follows.</span></span>  
  
 <span data-ttu-id="ebbd6-220">**Errores de autenticación**</span><span class="sxs-lookup"><span data-stu-id="ebbd6-220">**Authentication errors**</span></span>  
  
-   <span data-ttu-id="ebbd6-221">*No se puede quitar la credencial '%.\*ls' porque la usa un archivo de base de datos activo.*  </span><span class="sxs-lookup"><span data-stu-id="ebbd6-221">*Cannot drop the credential '%.\*ls' because it is used by an active database file.* </span></span>  
    <span data-ttu-id="ebbd6-222">Resolución: puede ver este error si intenta quitar una credencial que aún se use con un archivo de base de datos activo en Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-222">Resolution: You may see this error when you try to drop a credential that is still being used by an active database file in Azure Storage.</span></span> <span data-ttu-id="ebbd6-223">Para quitar la credencial, en primer lugar, debe eliminar el blob asociado que tiene este archivo de base de datos.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-223">To drop the credential, first you must delete the associated blob that has this database file.</span></span> <span data-ttu-id="ebbd6-224">Para eliminar un blob que tiene una concesión activa, debe interrumpir primero la concesión.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-224">To delete a blob that has an active lease, you must first break the lease.</span></span>  
  
-   <span data-ttu-id="ebbd6-225">*No se ha creado correctamente la firma de acceso compartido en el contenedor.*  </span><span class="sxs-lookup"><span data-stu-id="ebbd6-225">*Shared Access Signature has not been created on the container correctly.* </span></span>  
     <span data-ttu-id="ebbd6-226">Resolución: asegúrese de haber creado correctamente una firma de acceso compartido en el contenedor.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-226">Resolution: Make sure that you have created a Shared Access Signature on the container correctly.</span></span> <span data-ttu-id="ebbd6-227">Revise las instrucciones indicadas en la lección 2 en [Tutorial: SQL Server de archivos de datos en Azure Storage Service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="ebbd6-227">Review the instructions given in Lesson 2 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
-   <span data-ttu-id="ebbd6-228">*La credencial de SQL Server no se ha creado correctamente.*  </span><span class="sxs-lookup"><span data-stu-id="ebbd6-228">*SQL Server credential has not been not created correctly.* </span></span>  
    <span data-ttu-id="ebbd6-229">Resolución: asegúrese de que ha usado "Firma de acceso compartido" en el campo **Identidad** y que ha creado un secreto correctamente.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-229">Resolution: Make sure that you have used 'Shared Access Signature' for the **Identity** field and created a secret correctly.</span></span> <span data-ttu-id="ebbd6-230">Revise las instrucciones indicadas en la lección 3 de [Tutorial: SQL Server de archivos de datos en Azure Storage Service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="ebbd6-230">Review the instructions given in Lesson 3 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
 <span data-ttu-id="ebbd6-231">**Errores de concesión de blobs:**</span><span class="sxs-lookup"><span data-stu-id="ebbd6-231">**Lease blob errors:**</span></span>  
  
-   <span data-ttu-id="ebbd6-232">Error al intentar iniciar SQL Server después de que otra instancia que usa los mismos archivos de blob se haya bloqueado.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-232">Error when trying to start SQL Server after another instance using the same blob files has crashed.</span></span> <span data-ttu-id="ebbd6-233">Solución: durante el funcionamiento normal, SQL Server utiliza concesiones temporales con el fin de reservar y almacenar blobs con una renovación de cada concesión de blob cada 45-60 segundos.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-233">Resolution: During normal operation, SQL Server uses temporary leases to reserve Blobs for storage with a renewal of each Blob lease every 45 to 60 seconds.</span></span> <span data-ttu-id="ebbd6-234">Si se bloquea un servidor y se inicia otra instancia de SQL Server configurada para usar los mismos blobs, la instancia nueva esperará hasta 60 segundos para que expire la concesión existente del blob.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-234">If a server crashes and another instance of SQL Server configured to use the same blobs is started, the new instance will wait up to 60 seconds for the existing lease on the Blob to expire.</span></span> <span data-ttu-id="ebbd6-235">Si desea adjuntar la base de datos a otra instancia y no puede esperar 60 segundos a que expire la concesión, puede detener explícitamente la concesión en el blob para evitar errores en las operaciones de adjuntar.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-235">If you want to attach the database to another instance and you cannot wait for the lease to expire within 60 seconds, you can explicitly break the lease on the Blob to avoid any failures in attach operations.</span></span>  
  
 <span data-ttu-id="ebbd6-236">**Errores de base de datos:**</span><span class="sxs-lookup"><span data-stu-id="ebbd6-236">**Database errors**</span></span>  
  
1.  <span data-ttu-id="ebbd6-237">*Errores al crear una base de datos* </span><span class="sxs-lookup"><span data-stu-id="ebbd6-237">*Errors when creating a database* </span></span>  
    <span data-ttu-id="ebbd6-238">Solución: Revise las instrucciones indicadas en la lección 4 de [Tutorial: SQL Server de archivos de datos en Azure Storage Service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="ebbd6-238">Resolution: Review the instructions given in Lesson 4 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
2.  <span data-ttu-id="ebbd6-239">*Errores al ejecutar la instrucción Alter* </span><span class="sxs-lookup"><span data-stu-id="ebbd6-239">*Errors when running the Alter statement* </span></span>  
    <span data-ttu-id="ebbd6-240">Resolución: asegúrese de ejecutar la instrucción ALTER DATABASE cuando la base de datos esté en línea.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-240">Resolution: Make sure to execute the Alter Database statement when the database is online.</span></span> <span data-ttu-id="ebbd6-241">Cuando copie archivos de datos en Azure Storage, cree siempre un blob en páginas y no un blob en bloques.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-241">When copying the data files to Azure Storage, always create a page blob not a block blob.</span></span> <span data-ttu-id="ebbd6-242">De lo contrario, ALTER DATABASE no se ejecutará correctamente.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-242">Otherwise, ALTER Database will fail.</span></span> <span data-ttu-id="ebbd6-243">Revise las instrucciones indicadas en la lección 7 del [Tutorial: SQL Server archivos de datos en Azure Storage Service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="ebbd6-243">Review the instructions given in Lesson 7 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
3.  <span data-ttu-id="ebbd6-244">*Código de error 5120 no se puede abrir el archivo físico "%. \* LS ". Error del sistema operativo% d: "% LS"* </span><span class="sxs-lookup"><span data-stu-id="ebbd6-244">*Error code 5120 Unable to open the physical file "%.\*ls". Operating system error %d: "%ls"* </span></span>  
    <span data-ttu-id="ebbd6-245">Resolución: Actualmente, esta nueva mejora no admite que más de una instancia de SQL Server tenga acceso a los mismos archivos de base de datos de Azure Storage al mismo tiempo.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-245">Resolution: Currently, this new enhancement does not support more than one SQL Server instance accessing the same database files in Azure Storage at the same time.</span></span> <span data-ttu-id="ebbd6-246">Si el Servidor A está en línea con un archivo de base de datos activo y el Servidor B se inicia accidentalmente y tiene también una base de datos que apunta al mismo archivo de datos, el segundo servidor no podrá iniciar la base de datos y se generará un error con un código *5120 No se puede abrir el archivo físico "%.\*ls". Error del sistema operativo %d: "%ls"* .</span><span class="sxs-lookup"><span data-stu-id="ebbd6-246">If ServerA is online with an active database file and if ServerB is accidentally started, and it also has a database which points to the same data file, the second server will fail to start the database with an error *code 5120 Unable to open the physical file "%.\*ls". Operating system error %d: "%ls"*.</span></span>  
  
     <span data-ttu-id="ebbd6-247">Para resolver este problema, determine en primer lugar si necesita que el Servidor A obtenga acceso al archivo de base de datos de Azure Storage o no.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-247">To resolve this issue, first determine if you need ServerA to access the database file in Azure Storage or not.</span></span> <span data-ttu-id="ebbd6-248">Si no es así, basta con quitar las conexiones entre el Servidor A y los archivos de base de datos de Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-248">If not, simply remove any connection between ServerA and the database files in Azure Storage.</span></span> <span data-ttu-id="ebbd6-249">Para ello, siga estos pasos.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-249">To do this, follow these steps:</span></span>  
  
    1.  <span data-ttu-id="ebbd6-250">Establezca la ruta de acceso de ServidorA en una carpeta local mediante la instrucción ALTER DATABASE.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-250">Set the file path of Server A to a local folder by using the ALTER Database statement.</span></span>  
  
    2.  <span data-ttu-id="ebbd6-251">Ponga la base de datos sin conexión en el ServidorA.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-251">Set the database offline in Server A.</span></span>  
  
    3.  <span data-ttu-id="ebbd6-252">Luego copie los archivos de base de datos de Azure Storage en la carpeta local del Servidor A. Esto garantiza que el Servidor A siga conservando localmente una copia de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-252">Then, copy database files from Azure Storage to the local folder in Server A. This ensures that ServerA still has a copy of the database locally.</span></span>  
  
    4.  <span data-ttu-id="ebbd6-253">Ponga la base de datos en línea.</span><span class="sxs-lookup"><span data-stu-id="ebbd6-253">Set the database online.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ebbd6-254">Consulte también</span><span class="sxs-lookup"><span data-stu-id="ebbd6-254">See Also</span></span>  
 [<span data-ttu-id="ebbd6-255">Tutorial: Archivos de datos de SQL Server en el servicio Azure Storage</span><span class="sxs-lookup"><span data-stu-id="ebbd6-255">Tutorial: SQL Server Data Files in Azure Storage service</span></span>](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md)  
