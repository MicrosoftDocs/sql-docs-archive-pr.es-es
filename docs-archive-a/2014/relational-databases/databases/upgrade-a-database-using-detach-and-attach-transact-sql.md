---
title: Actualizar una base de datos mediante Separar y Adjuntar (Transact-SQL) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- database attaching [SQL Server]
- upgrading databases
- database upgrades [SQL Server]
- database detaching [SQL Server]
- detaching databases [SQL Server]
- attaching databases [SQL Server]
ms.assetid: 99f66ed9-3a75-4e38-ad7d-6c27cc3529a9
author: stevestein
ms.author: sstein
ms.openlocfilehash: d430825fd862ff49b867790f366200a524df3c1c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87671093"
---
# <a name="upgrade-a-database-using-detach-and-attach-transact-sql"></a><span data-ttu-id="3eb19-102">Actualizar una base de datos mediante Separar y Adjuntar (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="3eb19-102">Upgrade a Database Using Detach and Attach (Transact-SQL)</span></span>
  <span data-ttu-id="3eb19-103">En este tema se describe cómo usar las operaciones de separar y adjuntar para actualizar una base de datos de [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="3eb19-103">This topic describes how to use detach and attach operations to upgrade a database in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="3eb19-104">Después de asociarla a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)], la base de datos está disponible de inmediato y se actualiza automáticamente.</span><span class="sxs-lookup"><span data-stu-id="3eb19-104">After being attached to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)], the database is available immediately and is automatically upgraded.</span></span>  
  
 <span data-ttu-id="3eb19-105">**En este tema**</span><span class="sxs-lookup"><span data-stu-id="3eb19-105">**In This Topic**</span></span>  
  
-   <span data-ttu-id="3eb19-106">**Antes de empezar:**</span><span class="sxs-lookup"><span data-stu-id="3eb19-106">**Before you begin:**</span></span>  
  
     [<span data-ttu-id="3eb19-107">Limitaciones y restricciones</span><span class="sxs-lookup"><span data-stu-id="3eb19-107">Limitations and Restrictions</span></span>](#Restrictions)  
  
     [<span data-ttu-id="3eb19-108">Recomendaciones</span><span class="sxs-lookup"><span data-stu-id="3eb19-108">Recommendations</span></span>](#Recommendations)  
  
-   <span data-ttu-id="3eb19-109">**Para actualizar una base de datos de SQL Server:**</span><span class="sxs-lookup"><span data-stu-id="3eb19-109">**To Upgrade a SQL Server Database:**</span></span>  
  
     [<span data-ttu-id="3eb19-110">Usando operaciones de separar y adjuntar</span><span class="sxs-lookup"><span data-stu-id="3eb19-110">Using detach and attach operations</span></span>](#SSMSProcedure)  
  
-   <span data-ttu-id="3eb19-111">**Seguimiento:**  [Después de actualizar una base de datos de SQL Server](#FollowUp)</span><span class="sxs-lookup"><span data-stu-id="3eb19-111">**Follow Up:**  [After Upgrading a SQL Server Database](#FollowUp)</span></span>  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="3eb19-112">Antes de comenzar</span><span class="sxs-lookup"><span data-stu-id="3eb19-112">Before You Begin</span></span>  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="3eb19-113">Limitaciones y restricciones</span><span class="sxs-lookup"><span data-stu-id="3eb19-113">Limitations and Restrictions</span></span>  
  
-   <span data-ttu-id="3eb19-114">Las bases de datos del sistema no pueden adjuntarse.</span><span class="sxs-lookup"><span data-stu-id="3eb19-114">The system databases cannot be attached.</span></span>  
  
-   <span data-ttu-id="3eb19-115">Las operaciones de adjuntar y separar deshabilitan el encadenamiento de propiedad entre bases de datos si se establece la opción **cross db ownership chaining** en 0.</span><span class="sxs-lookup"><span data-stu-id="3eb19-115">Attach and detach disable cross-database ownership chaining for the database by setting its **cross db ownership chaining** option to 0.</span></span> <span data-ttu-id="3eb19-116">Para obtener más información sobre cómo habilitar el encadenamiento, vea [cross db ownership chaining (opción de configuración del servidor)](../../database-engine/configure-windows/cross-db-ownership-chaining-server-configuration-option.md).</span><span class="sxs-lookup"><span data-stu-id="3eb19-116">For information about enabling chaining, see [cross db ownership chaining Server Configuration Option](../../database-engine/configure-windows/cross-db-ownership-chaining-server-configuration-option.md).</span></span>  
  
-   <span data-ttu-id="3eb19-117">Cuando adjunte una base de datos replicada que fue copiada en lugar de separada:</span><span class="sxs-lookup"><span data-stu-id="3eb19-117">When attaching a replicated database that was copied instead of detached:</span></span>  
  
    -   <span data-ttu-id="3eb19-118">Si se adjunta la base de datos a una versión actualizada de la misma instancia de servidor, es necesario ejecutar **sp_vupgrade_replication** para actualizar la replicación una vez finalizada la operación de adjuntar.</span><span class="sxs-lookup"><span data-stu-id="3eb19-118">If you attach the database to an upgraded version of the same server instance, you must execute **sp_vupgrade_replication** to upgrade replication after the attach operation finishes.</span></span> <span data-ttu-id="3eb19-119">Para obtener más información, vea [sp_vupgrade_replication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-vupgrade-replication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="3eb19-119">For more information, see [sp_vupgrade_replication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-vupgrade-replication-transact-sql).</span></span>  
  
    -   <span data-ttu-id="3eb19-120">Si adjunta la base de datos a una instancia de servidor diferente, sin que importe la versión, debe ejecutar **sp_removedbreplication** para quitar la replicación una vez completada la operación de adjuntar.</span><span class="sxs-lookup"><span data-stu-id="3eb19-120">If you attach the database to a different server instance (regardless of version), you must execute **sp_removedbreplication** to remove replication after the attach operation finishes.</span></span> <span data-ttu-id="3eb19-121">Para obtener más información, vea [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="3eb19-121">For more information, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
###  <a name="recommendations"></a><a name="Recommendations"></a> <span data-ttu-id="3eb19-122">Recomendaciones</span><span class="sxs-lookup"><span data-stu-id="3eb19-122">Recommendations</span></span>  
 <span data-ttu-id="3eb19-123">Se recomienda no adjuntar ni restaurar bases de datos de orígenes desconocidos o que no sean de confianza.</span><span class="sxs-lookup"><span data-stu-id="3eb19-123">We recommend that you do not attach or restore databases from unknown or untrusted sources.</span></span> <span data-ttu-id="3eb19-124">Es posible que dichas bases de datos contengan código malintencionado que podría ejecutar código [!INCLUDE[tsql](../../includes/tsql-md.md)] no deseado o provocar errores al modificar el esquema o la estructura de la base de datos física.</span><span class="sxs-lookup"><span data-stu-id="3eb19-124">Such databases could contain malicious code that might execute unintended [!INCLUDE[tsql](../../includes/tsql-md.md)] code or cause errors by modifying the schema or the physical database structure.</span></span> <span data-ttu-id="3eb19-125">Para usar una base de datos desde un origen desconocido o que no sea de confianza, ejecute [DBCC CHECKDB](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql) en la base de datos de un servidor que no sea de producción y examine también el código, como procedimientos almacenados u otro código definido por el usuario, en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="3eb19-125">Before you use a database from an unknown or untrusted source, run [DBCC CHECKDB](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql) on the database on a nonproduction server and also examine the code, such as stored procedures or other user-defined code, in the database.</span></span>  
  
##  <a name="to-upgrade-a-database-by-using-detach-and-attach"></a><a name="SSMSProcedure"></a> <span data-ttu-id="3eb19-126">Para actualizar una base de datos mediante las operaciones de separar y adjuntar</span><span class="sxs-lookup"><span data-stu-id="3eb19-126">To Upgrade a Database by Using Detach and Attach</span></span>  
  
1.  <span data-ttu-id="3eb19-127">Separe la base de datos.</span><span class="sxs-lookup"><span data-stu-id="3eb19-127">Detach the database.</span></span> <span data-ttu-id="3eb19-128">Para obtener más información, vea [Separar una base de datos](detach-a-database.md)</span><span class="sxs-lookup"><span data-stu-id="3eb19-128">For more information, see [Detach a Database](detach-a-database.md).</span></span>  
  
2.  <span data-ttu-id="3eb19-129">También puede mover los archivos de la base de datos separada y los archivos de registro.</span><span class="sxs-lookup"><span data-stu-id="3eb19-129">Optionally, move the detached database file or files and the log file or files.</span></span>  
  
     <span data-ttu-id="3eb19-130">Debe mover los archivos de registro, junto con los archivos de datos, incluso aunque piense crear archivos de registro.</span><span class="sxs-lookup"><span data-stu-id="3eb19-130">You should move the log files along with the data files, even if you intend to create new log files.</span></span> <span data-ttu-id="3eb19-131">En algunos casos, para volver a adjuntar una base de datos son necesarios sus archivos de registro.</span><span class="sxs-lookup"><span data-stu-id="3eb19-131">In some cases, reattaching a database requires its existing log files.</span></span> <span data-ttu-id="3eb19-132">Por tanto, mantenga siempre todos los archivos de registro separados hasta que la base de datos se haya adjuntado correctamente sin ellos.</span><span class="sxs-lookup"><span data-stu-id="3eb19-132">Therefore, always keep all the detached log files until the database has been successfully attached without them.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="3eb19-133">Si intenta adjuntar la base de datos sin especificar el archivo de registro, la operación de adjuntar buscará el archivo de registro en su ubicación original.</span><span class="sxs-lookup"><span data-stu-id="3eb19-133">If you try to attach the database without specifying the log file, the attach operation will look for the log file in its original location.</span></span> <span data-ttu-id="3eb19-134">Si la copia original del registro todavía está en esa ubicación, se adjuntará esa copia.</span><span class="sxs-lookup"><span data-stu-id="3eb19-134">If the original copy of the log still exists in that location, that copy is attached.</span></span> <span data-ttu-id="3eb19-135">Para evitar que se utilice el archivo de registro original, especifique la ruta de acceso del nuevo archivo de registro o elimine la copia original del archivo de registro (después de copiarlo en la nueva ubicación).</span><span class="sxs-lookup"><span data-stu-id="3eb19-135">To avoid using the original log file, either specify the path of the new log file or remove the original copy of the log file (after copying it to the new location).</span></span>  
  
3.  <span data-ttu-id="3eb19-136">Adjunte los archivos copiados a la instancia de [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="3eb19-136">Attach the copied files to the instance of [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="3eb19-137">Para obtener más información, consulte [Attach a Database](attach-a-database.md).</span><span class="sxs-lookup"><span data-stu-id="3eb19-137">For more information, see [Attach a Database](attach-a-database.md).</span></span>  
  
## <a name="example"></a><span data-ttu-id="3eb19-138">Ejemplo</span><span class="sxs-lookup"><span data-stu-id="3eb19-138">Example</span></span>  
 <span data-ttu-id="3eb19-139">El ejemplo siguiente actualiza una copia de una base de datos de una versión anterior de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="3eb19-139">The following example upgrades a copy of a database from an earlier version of SQL Server.</span></span> <span data-ttu-id="3eb19-140">Las instrucciones [!INCLUDE[tsql](../../includes/tsql-md.md)] se ejecutan en una ventana del Editor de consultas que esté conectada a la instancia del servidor a la que se ha adjuntado.</span><span class="sxs-lookup"><span data-stu-id="3eb19-140">The [!INCLUDE[tsql](../../includes/tsql-md.md)] statements are executed in a Query Editor window that is connected to the server instance to which is attached.</span></span>  
  
1.  <span data-ttu-id="3eb19-141">Separe la base de datos ejecutando las siguientes instrucciones [!INCLUDE[tsql](../../includes/tsql-md.md)] :</span><span class="sxs-lookup"><span data-stu-id="3eb19-141">Detach the database by executing the following [!INCLUDE[tsql](../../includes/tsql-md.md)] statements:</span></span>  
  
    ```  
    USE master;  
    GO  
    EXEC sp_detach_db @dbname = N'MyDatabase';  
    GO  
    ```  
  
2.  <span data-ttu-id="3eb19-142">Mediante el método que elija, copie los archivos de datos y de registro a la nueva ubicación.</span><span class="sxs-lookup"><span data-stu-id="3eb19-142">Using the method of your choice, copy the data and log files to the new location.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="3eb19-143">En el caso de una base de datos de producción, coloque la base de datos y el registro de transacciones en discos independientes.</span><span class="sxs-lookup"><span data-stu-id="3eb19-143">For a production database, place the database and transaction log on separate disks.</span></span>  
  
     <span data-ttu-id="3eb19-144">Para copiar archivos a través de la red en un disco de un equipo remoto, use el nombre UNC (Convención de nomenclatura universal) de la ubicación remota.</span><span class="sxs-lookup"><span data-stu-id="3eb19-144">To copy files over the network to a disk on a remote computer, use the universal naming convention (UNC) name of the remote location.</span></span> <span data-ttu-id="3eb19-145">Un nombre UNC toma la forma **\\\\** _ServerName_ **\\** _nombreDeRecursoCompartido_ **\\** _rutaDeAcceso_ **\\** _nombreDeArchivo_.</span><span class="sxs-lookup"><span data-stu-id="3eb19-145">A UNC name takes the form **\\\\**_Servername_**\\**_Sharename_**\\**_Path_**\\**_Filename_.</span></span> <span data-ttu-id="3eb19-146">De la misma forma que al escribir archivos en el disco duro local, se debe conceder a la cuenta de usuario que usa la instancia de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]los permisos necesarios para leer o escribir en archivos del disco remoto.</span><span class="sxs-lookup"><span data-stu-id="3eb19-146">As with writing files to the local hard disk, the appropriate permissions that are required to read or write to a file on the remote disk must be granted to the user account used by the instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
3.  <span data-ttu-id="3eb19-147">Adjunte la base de datos movida y, opcionalmente, su registro ejecutando la siguiente instrucción [!INCLUDE[tsql](../../includes/tsql-md.md)] :</span><span class="sxs-lookup"><span data-stu-id="3eb19-147">Attach the moved database and, optionally, its log by executing the following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement:</span></span>  
  
    ```  
    USE master;  
    GO  
    CREATE DATABASE MyDatabase   
        ON (FILENAME = 'C:\MySQLServer\MyDatabase.mdf'),  
        (FILENAME = 'C:\MySQLServer\Database.ldf')  
        FOR ATTACH;  
    GO  
    ```  
  
     <span data-ttu-id="3eb19-148">En [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], una base de datos recién adjuntada no es inmediatamente visible en el Explorador de objetos.</span><span class="sxs-lookup"><span data-stu-id="3eb19-148">In [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], a newly attached database is not immediately visible in Object Explorer.</span></span> <span data-ttu-id="3eb19-149">Para ver la base de datos, en el Explorador de objetos, haga clic en **Ver** y, a continuación, en **Actualizar**.</span><span class="sxs-lookup"><span data-stu-id="3eb19-149">To view the database, in Object Explorer, click **View,** and then **Refresh**.</span></span> <span data-ttu-id="3eb19-150">Cuando se expande el nodo **Bases de datos** en el Explorador de objetos, la base de datos recién adjuntada aparecerá en la lista de bases de datos.</span><span class="sxs-lookup"><span data-stu-id="3eb19-150">When the **Databases** node is expanded in Object Explorer, the newly attached database now appears in the list of databases.</span></span>  
  
##  <a name="follow-up-after-upgrading-a-sql-server-database"></a><a name="FollowUp"></a> <span data-ttu-id="3eb19-151">Seguimiento: Después de actualizar una base de datos de SQL Server</span><span class="sxs-lookup"><span data-stu-id="3eb19-151">Follow Up: After Upgrading a SQL Server Database</span></span>  
 <span data-ttu-id="3eb19-152">Si la base de datos tiene índices de texto completo, el proceso de actualización los importa, los restablece o los vuelve a generar, en función del valor de la propiedad del servidor **upgrade_option** .</span><span class="sxs-lookup"><span data-stu-id="3eb19-152">If the database has full-text indexes, the upgrade process either imports, resets, or rebuilds them, depending on the setting of the **upgrade_option** server property.</span></span> <span data-ttu-id="3eb19-153">Si la opción de actualización se establece en importar (**upgrade_option** = 2) o en volver a generar (**upgrade_option** = 0), los índices de texto completo no estarán disponibles durante la actualización.</span><span class="sxs-lookup"><span data-stu-id="3eb19-153">If the upgrade option is set to import (**upgrade_option** = 2) or rebuild (**upgrade_option** = 0), the full-text indexes will be unavailable during the upgrade.</span></span> <span data-ttu-id="3eb19-154">Dependiendo de la cantidad de datos que se indicen, la importación puede requerir varias horas y volver a generar puede requerir hasta diez veces más.</span><span class="sxs-lookup"><span data-stu-id="3eb19-154">Depending the amount of data being indexed, importing can take several hours, and rebuilding can take up to ten times longer.</span></span> <span data-ttu-id="3eb19-155">Observe también que cuando la opción de actualización se establece en importar, se vuelven a generar los índices de texto completo asociados si no se dispone de un catálogo de texto completo.</span><span class="sxs-lookup"><span data-stu-id="3eb19-155">Note also that when the upgrade option is set to import, the associated full-text indexes are rebuilt if a full-text catalog is not available.</span></span> <span data-ttu-id="3eb19-156">Para cambiar el valor de la propiedad de servidor **upgrade_option** , use [sp_fulltext_service](/sql/relational-databases/system-stored-procedures/sp-fulltext-service-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="3eb19-156">To change the setting of the **upgrade_option** server property, use [sp_fulltext_service](/sql/relational-databases/system-stored-procedures/sp-fulltext-service-transact-sql).</span></span>  
  
### <a name="database-compatibility-level-after-upgrade"></a><span data-ttu-id="3eb19-157">Nivel de compatibilidad de la base de datos después de la actualización</span><span class="sxs-lookup"><span data-stu-id="3eb19-157">Database Compatibility Level After Upgrade</span></span>  
 <span data-ttu-id="3eb19-158">Si el nivel de compatibilidad de una base de datos de usuario es 100 o superior antes de la actualización, permanece igual después de la misma.</span><span class="sxs-lookup"><span data-stu-id="3eb19-158">If the compatibility level of a user database is 100 or higher before upgrade, it remains the same after upgrade.</span></span> <span data-ttu-id="3eb19-159">Si el nivel de compatibilidad es 90 antes de la actualización en la base de datos actualizada, el nivel de compatibilidad se establece en 100, que es el nivel de compatibilidad mínimo admitido en [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="3eb19-159">If the compatibility level is 90 before upgrade in the upgraded database, the compatibility level is set to 100, which is the lowest supported compatibility level in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="3eb19-160">Para obtener más información, vea [Nivel de compatibilidad de ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql-compatibility-level).</span><span class="sxs-lookup"><span data-stu-id="3eb19-160">For more information, see [ALTER DATABASE Compatibility Level &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql-compatibility-level).</span></span>  
  
### <a name="managing-metadata-on-the-upgraded-server-instance"></a><span data-ttu-id="3eb19-161">Administrar metadatos en la instancia de servidor actualizada</span><span class="sxs-lookup"><span data-stu-id="3eb19-161">Managing Metadata on the Upgraded Server Instance</span></span>  
 <span data-ttu-id="3eb19-162">Al adjuntar una base de datos a otra instancia de servidor, para que los usuarios y las aplicaciones puedan utilizarla de igual manera, puede que tenga que volver a crear algunos o todos los metadatos de la base de datos, como los inicios de sesión, los trabajos y los permisos, en la otra instancia de servidor.</span><span class="sxs-lookup"><span data-stu-id="3eb19-162">When you attach a database onto another server instance, to provide a consistent experience to users and applications, you might have to re-create some or all of the metadata for the database, such as logins, jobs, and permissions, on the other server instance.</span></span> <span data-ttu-id="3eb19-163">Para obtener más información, vea [Administrar los metadatos cuando una base de datos pasa a estar disponible en otra instancia del servidor &#40;SQL Server&#41;](manage-metadata-when-making-a-database-available-on-another-server.md).</span><span class="sxs-lookup"><span data-stu-id="3eb19-163">For more information, see [Manage Metadata When Making a Database Available on Another Server Instance &#40;SQL Server&#41;](manage-metadata-when-making-a-database-available-on-another-server.md).</span></span>  
  
### <a name="service-master-key-and-database-master-key-encryption-changes-from-3des-to-aes"></a><span data-ttu-id="3eb19-164">La clave maestra de servicio y el cifrado de la clave maestra de la base de datos cambia de 3DES a AES</span><span class="sxs-lookup"><span data-stu-id="3eb19-164">Service Master Key and Database Master Key Encryption changes from 3DES to AES</span></span>  
 [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] <span data-ttu-id="3eb19-165">y versiones posteriores usan el algoritmo de cifrado AES para proteger la clave maestra de servicio (SMK) y la clave maestra de la base de datos (DMK).</span><span class="sxs-lookup"><span data-stu-id="3eb19-165">and higher versions uses the AES encryption algorithm to protect the service master key (SMK) and the database master key (DMK).</span></span> <span data-ttu-id="3eb19-166">AES es un algoritmo de cifrado más reciente que el algoritmo 3DES empleado en versiones anteriores.</span><span class="sxs-lookup"><span data-stu-id="3eb19-166">AES is a newer encryption algorithm than 3DES used in earlier versions.</span></span> <span data-ttu-id="3eb19-167">La primera vez que se adjunta una base de datos o se restaura en una instancia nueva de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], aún no se ha almacenado una copia de la clave maestra de la base de datos (cifrada por la clave maestra de servicio) en el servidor.</span><span class="sxs-lookup"><span data-stu-id="3eb19-167">When a database is first attached or restored to a new instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], a copy of the database master key (encrypted by the service master key) is not yet stored in the server.</span></span> <span data-ttu-id="3eb19-168">Debe usar la instrucción `OPEN MASTER KEY` para descifrar la clave maestra de la base de datos (DMK).</span><span class="sxs-lookup"><span data-stu-id="3eb19-168">You must use the `OPEN MASTER KEY` statement to decrypt the database master key (DMK).</span></span> <span data-ttu-id="3eb19-169">Una vez que se ha descifrado la clave maestra de la base de datos, tiene la posibilidad de habilitar el descifrado automático en el futuro usando la instrucción `ALTER MASTER KEY REGENERATE` para proporcionar al servidor una copia de la clave maestra de la base de datos cifrada con la clave maestra de servicio (SMK).</span><span class="sxs-lookup"><span data-stu-id="3eb19-169">Once the DMK has been decrypted, you have the option of enabling automatic decryption in the future by using the `ALTER MASTER KEY REGENERATE` statement to provision the server with a copy of the DMK, encrypted with the service master key (SMK).</span></span> <span data-ttu-id="3eb19-170">Cuando una base de datos se haya actualizado desde una versión anterior, se debe volver a generar la DMK para usar el algoritmo AES más reciente.</span><span class="sxs-lookup"><span data-stu-id="3eb19-170">When a database has been upgraded from an earlier version, the DMK should be regenerated to use the newer AES algorithm.</span></span> <span data-ttu-id="3eb19-171">Para obtener más información sobre cómo volver a generar la DMK, vea [ALTER MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-master-key-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="3eb19-171">For more information about regenerating the DMK, see [ALTER MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-master-key-transact-sql).</span></span> <span data-ttu-id="3eb19-172">El tiempo necesario para volver a generar la DMK con el fin de actualizarse a AES depende del número de objetos protegidos por la DMK.</span><span class="sxs-lookup"><span data-stu-id="3eb19-172">The time required to regenerate the DMK key to upgrade to AES depends upon the number of objects protected by the DMK.</span></span> <span data-ttu-id="3eb19-173">Solo es necesario volver a generar la DMK una vez y no tiene ningún efecto sobre las nuevas generaciones futuras como parte de una estrategia de rotación de claves.</span><span class="sxs-lookup"><span data-stu-id="3eb19-173">Regenerating the DMK key to upgrade to AES is only necessary once, and has no impact on future regenerations as part of a key rotation strategy.</span></span>  
  
  
