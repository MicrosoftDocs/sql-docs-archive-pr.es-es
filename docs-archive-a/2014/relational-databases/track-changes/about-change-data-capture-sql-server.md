---
title: Acerca de la captura de datos modificados (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- change data capture [SQL Server], about
- change data capture [SQL Server]
- 22832 (Database Engine error)
ms.assetid: 7d8c4684-9eb1-4791-8c3b-0f0bb15d9634
author: rothja
ms.author: jroth
ms.openlocfilehash: cf8045ff45e7467a626bee85857ae8319f5d2649
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87674690"
---
# <a name="about-change-data-capture-sql-server"></a><span data-ttu-id="d9fa6-102">Acerca de la captura de datos modificados (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="d9fa6-102">About Change Data Capture (SQL Server)</span></span>
  <span data-ttu-id="d9fa6-103">La captura de datos modificados registra la actividad de inserción, actualización y eliminación que se aplica a una tabla de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="d9fa6-103">Change data capture records insert, update, and delete activity that is applied to a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] table.</span></span> <span data-ttu-id="d9fa6-104">Esto hace que los detalles de estos cambios estén disponibles en un formato relacional de fácil uso.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-104">This makes the details of the changes available in an easily consumed relational format.</span></span> <span data-ttu-id="d9fa6-105">La información de las columnas y los metadatos que se necesitan para aplicar los cambios a un entorno de destino se capturan para las filas modificadas y se almacenan en tablas de cambios que reflejan la estructura de columnas de las tablas de origen sometidas a seguimiento.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-105">Column information and the metadata that is required to apply the changes to a target environment is captured for the modified rows and stored in change tables that mirror the column structure of the tracked source tables.</span></span> <span data-ttu-id="d9fa6-106">Se proporcionan funciones con valores de tabla para permitir el acceso sistemático a los datos modificados por los consumidores.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-106">Table-valued functions are provided to allow systematic access to the change data by consumers.</span></span>  
  
 <span data-ttu-id="d9fa6-107">Un buen ejemplo de consumidor de datos a quien va dirigida esta tecnología es una aplicación de extracción, transformación y carga (ETL).</span><span class="sxs-lookup"><span data-stu-id="d9fa6-107">A good example of a data consumer that is targeted by this technology is an extraction, transformation, and loading (ETL) application.</span></span> <span data-ttu-id="d9fa6-108">Una aplicación ETL carga incrementalmente los datos modificados de las tablas de origen de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] en un almacenamiento de datos o data mart.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-108">An ETL application incrementally loads change data from [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] source tables to a data warehouse or data mart.</span></span> <span data-ttu-id="d9fa6-109">Aunque la representación de las tablas de origen dentro del almacén de datos debe reflejar los cambios en las tablas de origen, una tecnología de extremo a extremo que actualice una réplica del origen no resulta adecuada en este caso.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-109">Although the representation of the source tables within the data warehouse must reflect changes in the source tables, an end-to-end technology that refreshes a replica of the source is not appropriate.</span></span> <span data-ttu-id="d9fa6-110">En su lugar, necesita un flujo de datos modificados confiable y estructurado de forma que los consumidores puedan aplicarlo a representaciones de destino dispares de los datos.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-110">Instead, you need a reliable stream of change data that is structured so that consumers can apply it to dissimilar target representations of the data.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="d9fa6-111">proporciona esta tecnología.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-111">change data capture provides this technology.</span></span>  
  
## <a name="change-data-capture-data-flow"></a><span data-ttu-id="d9fa6-112">Flujo de datos de la captura de datos modificados</span><span class="sxs-lookup"><span data-stu-id="d9fa6-112">Change Data Capture Data Flow</span></span>  
 <span data-ttu-id="d9fa6-113">La ilustración siguiente muestra el flujo de datos principal de la captura de datos modificados.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-113">The following illustration shows the principal data flow for change data capture.</span></span>  
  
 <span data-ttu-id="d9fa6-114">![Flujo de datos de la captura de datos modificados](../../database-engine/media/cdcdataflow.gif "Flujo de datos de la captura de datos modificados")</span><span class="sxs-lookup"><span data-stu-id="d9fa6-114">![Change data capture data flow](../../database-engine/media/cdcdataflow.gif "Change data capture data flow")</span></span>  
  
 <span data-ttu-id="d9fa6-115">El origen de los datos modificados para la captura de datos modificados es el registro de transacciones de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="d9fa6-115">The source of change data for change data capture is the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] transaction log.</span></span> <span data-ttu-id="d9fa6-116">A medida que se aplican las inserciones, actualizaciones y eliminaciones a las tablas de origen sometidas a seguimiento, se agregan al registro las entradas que describen esos cambios.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-116">As inserts, updates, and deletes are applied to tracked source tables, entries that describe those changes are added to the log.</span></span> <span data-ttu-id="d9fa6-117">El registro actúa como entrada para el proceso de captura.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-117">The log serves as input to the capture process.</span></span> <span data-ttu-id="d9fa6-118">Así, se lee el registro y se agrega información sobre los cambios a la tabla de cambios asociada de la tabla sometida a seguimiento.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-118">This reads the log and adds information about changes to the tracked table's associated change table.</span></span> <span data-ttu-id="d9fa6-119">Se proporcionan funciones para enumerar los cambios que aparecen en las tablas de cambios sobre un intervalo especificado, que devuelven la información en forma de un conjunto de resultados filtrado.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-119">Functions are provided to enumerate the changes that appear in the change tables over a specified range, returning the information in the form of a filtered result set.</span></span> <span data-ttu-id="d9fa6-120">Un proceso de aplicación utiliza normalmente el conjunto de resultados filtrado para actualizar una representación del origen en algún entorno externo.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-120">The filtered result set is typically used by an application process to update a representation of the source in some external environment.</span></span>  
  
## <a name="understanding-change-data-capture-and-the-capture-instance"></a><span data-ttu-id="d9fa6-121">Descripción de la captura de datos modificados y la instancia de captura</span><span class="sxs-lookup"><span data-stu-id="d9fa6-121">Understanding Change Data Capture and the Capture Instance</span></span>  
 <span data-ttu-id="d9fa6-122">Para que se pueda realizar el seguimiento de los cambios de cualquier tabla individual dentro de una base de datos, la captura de datos modificados debe habilitarse explícitamente en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-122">Before changes to any individual tables within a database can be tracked, change data capture must be explicitly enabled for the database.</span></span> <span data-ttu-id="d9fa6-123">Para ello, se usa el procedimiento almacenado [sys.sp_cdc_enable_db](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-enable-db-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d9fa6-123">This is done by using the stored procedure [sys.sp_cdc_enable_db](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-enable-db-transact-sql).</span></span> <span data-ttu-id="d9fa6-124">Cuando se habilita la base de datos, las tablas de origen se pueden identificar como tablas sometidas a seguimiento mediante el procedimiento almacenado [sys.sp_cdc_enable_table](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-enable-table-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d9fa6-124">When the database is enabled, source tables can be identified as tracked tables by using the stored procedure [sys.sp_cdc_enable_table](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-enable-table-transact-sql).</span></span> <span data-ttu-id="d9fa6-125">Cuando una tabla se habilita para la captura de datos modificados, se crea una instancia de la captura asociada para admitir la diseminación de los datos modificados en la tabla de origen.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-125">When a table is enabled for change data capture, an associated capture instance is created to support the dissemination of the change data in the source table.</span></span> <span data-ttu-id="d9fa6-126">La instancia de captura está compuesta de una tabla de cambios y de dos funciones de consulta, como máximo.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-126">The capture instance consists of a change table and up to two query functions.</span></span> <span data-ttu-id="d9fa6-127">Los metadatos que describen los detalles de configuración de la instancia de captura se conservan en las siguientes tablas de metadatos de captura de datos modificados: `cdc.change_tables`, `cdc.index_columns` y `cdc.captured_columns`.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-127">Metadata that describes the configuration details of the capture instance is retained in the change data capture metadata tables `cdc.change_tables`, `cdc.index_columns`, and `cdc.captured_columns`.</span></span> <span data-ttu-id="d9fa6-128">Esta información se puede recuperar al usar el procedimiento almacenado [sys.sp_cdc_help_change_data_capture](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-change-data-capture-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d9fa6-128">This information can be retrieved by using the stored procedure [sys.sp_cdc_help_change_data_capture](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-change-data-capture-transact-sql).</span></span>  
  
 <span data-ttu-id="d9fa6-129">Todos los objetos que están asociados a una instancia de captura se crean en el esquema de captura de datos modificados de la base de datos habilitada.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-129">All objects that are associated with a capture instance are created in the change data capture schema of the enabled database.</span></span> <span data-ttu-id="d9fa6-130">El nombre de la instancia de captura tiene que ser un nombre de objeto válido y único en todas las instancias de captura de base de datos.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-130">The requirements for the capture instance name is that it be a valid object name, and that it be unique across the database capture instances.</span></span> <span data-ttu-id="d9fa6-131">De forma predeterminada, el nombre es \<*schema name*_*table name*> de la tabla de origen.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-131">By default, the name is \<*schema name*_*table name*> of the source table.</span></span> <span data-ttu-id="d9fa6-132">Para denominar su tabla de cambios asociada, se anexa `_CT` al nombre de la instancia de captura.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-132">Its associated change table is named by appending `_CT` to the capture instance name.</span></span> <span data-ttu-id="d9fa6-133">Para denominar la función que se utiliza para consultar todos los cambios se antepone `fn_cdc_get_all_changes_` al nombre de la instancia de captura.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-133">The function that is used to query for all changes is named by prepending `fn_cdc_get_all_changes_` to the capture instance name.</span></span> <span data-ttu-id="d9fa6-134">Si la instancia de captura está configurada para admitir `net changes` , la `net_changes` función de consulta también se crea y se denomina con \*\*fn_cdc_get_net_changes \_ \*\* del nombre de la instancia de captura.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-134">If the capture instance is configured to support `net changes`, the `net_changes` query function is also created and named by prepending **fn_cdc_get_net_changes\_** to the capture instance name.</span></span>  
  
## <a name="change-table"></a><span data-ttu-id="d9fa6-135">Tabla de cambios</span><span class="sxs-lookup"><span data-stu-id="d9fa6-135">Change Table</span></span>  
 <span data-ttu-id="d9fa6-136">Las primeras cinco columnas de una tabla de cambios de captura de datos modificados son las columnas de metadatos.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-136">The first five columns of a change data capture change table are metadata columns.</span></span> <span data-ttu-id="d9fa6-137">Proporcionan información adicional correspondiente al cambio registrado.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-137">These provide additional information that is relevant to the recorded change.</span></span> <span data-ttu-id="d9fa6-138">Las columnas restantes reflejan el nombre y, normalmente, también el tipo de las columnas capturadas identificadas de la tabla de origen.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-138">The remaining columns mirror the identified captured columns from the source table in name and, typically, in type.</span></span> <span data-ttu-id="d9fa6-139">Estas columnas contienen los datos de columnas capturadas que se recopilan en la tabla de origen.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-139">These columns hold the captured column data that is gathered from the source table.</span></span>  
  
 <span data-ttu-id="d9fa6-140">Cada operación de inserción o eliminación aplicada a una tabla de origen aparece como una fila única dentro de la tabla de cambios.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-140">Each insert or delete operation that is applied to a source table appears as a single row within the change table.</span></span> <span data-ttu-id="d9fa6-141">Las columnas de datos de la fila resultante de una operación de inserción contienen los valores de columna después de la inserción.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-141">The data columns of the row that results from an insert operation contain the column values after the insert.</span></span> <span data-ttu-id="d9fa6-142">Las columnas de datos de la fila resultante de una operación de eliminación contienen los valores de columna antes de la eliminación.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-142">The data columns of the row that results from a delete operation contain the column values before the delete.</span></span> <span data-ttu-id="d9fa6-143">Una operación de actualización requiere una entrada de fila para identificar los valores de columna antes de la actualización, y una segunda entrada de fila para identificar los valores de columna después de la actualización.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-143">An update operation requires one row entry to identify the column values before the update, and a second row entry to identify the column values after the update.</span></span>  
  
 <span data-ttu-id="d9fa6-144">Cada fila de una tabla de cambios también contiene metadatos adicionales que permiten interpretar los cambios realizados.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-144">Each row in a change table also contains additional metadata to allow interpretation of the change activity.</span></span> <span data-ttu-id="d9fa6-145">La columna __$start_lsn identifica el número de secuencia de registro (LSN) de confirmación que fue asignado al cambio.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-145">The column __$start_lsn identifies the commit log sequence number (LSN) that was assigned to the change.</span></span> <span data-ttu-id="d9fa6-146">El LSN de confirmación identifica tanto los cambios que se confirmaron dentro de la misma transacción como el orden de esas transacciones.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-146">The commit LSN both identifies changes that were committed within the same transaction, and orders those transactions.</span></span> <span data-ttu-id="d9fa6-147">La columna \_\_$seqval se puede usar para ordenar los cambios adicionales que se produzcan en la misma transacción.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-147">The column \_\_$seqval can be used to order more changes that occur in the same transaction.</span></span> <span data-ttu-id="d9fa6-148">En la columna \_\_$operation se registra la operación que está asociada al cambio: 1 = eliminación, 2 = inserción, 3 = actualización (antes de la imagen) y 4 = actualización (después de la imagen).</span><span class="sxs-lookup"><span data-stu-id="d9fa6-148">The column \_\_$operation records the operation that is associated with the change: 1 = delete, 2 = insert, 3 = update (before image), and 4 = update (after image).</span></span> <span data-ttu-id="d9fa6-149">La columna \_\_$update_mask es una máscara de bits variable con un bit definido para cada columna capturada.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-149">The column \_\_$update_mask is a variable bit mask with one defined bit for each captured column.</span></span> <span data-ttu-id="d9fa6-150">Para las entradas correspondientes a operaciones de inserción y eliminación, la máscara de actualización siempre tendrá todos los bits activados.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-150">For insert and delete entries, the update mask will always have all bits set.</span></span> <span data-ttu-id="d9fa6-151">Las filas correspondientes a operaciones de actualización, sin embargo, tendrán solo activados los bits que correspondan a las columnas cambiadas.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-151">Update rows, however, will only have those bits set that correspond to changed columns.</span></span>  
  
## <a name="change-data-capture-validity-interval-for-a-database"></a><span data-ttu-id="d9fa6-152">Intervalo de validez de la captura de datos modificados para una base de datos</span><span class="sxs-lookup"><span data-stu-id="d9fa6-152">Change Data Capture Validity Interval for a Database</span></span>  
 <span data-ttu-id="d9fa6-153">El intervalo de validez de la captura de datos modificados para una base de datos es el tiempo durante el cual los datos modificados están disponibles para las instancias de captura.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-153">The change data capture validity interval for a database is the time during which change data is available for capture instances.</span></span> <span data-ttu-id="d9fa6-154">El intervalo de validez comienza cuando se crea la primera instancia de captura para una tabla de base de datos y continúa hasta el momento actual.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-154">The validity interval begins when the first capture instance is created for a database table, and continues to the present time.</span></span>  
  
 <span data-ttu-id="d9fa6-155">Los datos que se depositan en las tablas de cambios crecerán hasta llegar a ser incontrolables si no se reduce su número de forma periódica y sistemática.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-155">Data that is deposited in change tables will grow unmanageably if you do not periodically and systematically prune the data.</span></span> <span data-ttu-id="d9fa6-156">El proceso de limpieza de la captura de datos modificados es responsable de que se aplique la directiva de limpieza basada en la retención.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-156">The change data capture cleanup process is responsible for enforcing the retention-based cleanup policy.</span></span> <span data-ttu-id="d9fa6-157">Primero, mueve el extremo inferior del intervalo de validez para satisfacer la restricción temporal.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-157">First, it moves the low endpoint of the validity interval to satisfy the time restriction.</span></span> <span data-ttu-id="d9fa6-158">A continuación, quita las entradas de las tablas de cambios que han expirado.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-158">Then, it removes expired change table entries.</span></span> <span data-ttu-id="d9fa6-159">De forma predeterminada, se conservan los datos de tres días.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-159">By default, three days of data is retained.</span></span>  
  
 <span data-ttu-id="d9fa6-160">En el extremo superior, a medida que el proceso de captura confirma cada nuevo lote de datos modificados, se agregan entradas nuevas a `cdc.lsn_time_mapping` para cada transacción que tenga entradas en la tabla de cambios.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-160">At the high end, as the capture process commits each new batch of change data, new entries are added to `cdc.lsn_time_mapping` for each transaction that has change table entries.</span></span> <span data-ttu-id="d9fa6-161">Dentro de la tabla de asignación se conservan tanto un número de flujo de registro (LSN) de confirmación como un tiempo de confirmación de la transacción (columnas start_lsn y tran_end_time, respectivamente).</span><span class="sxs-lookup"><span data-stu-id="d9fa6-161">Within the mapping table, both a commit Log Sequence Number (LSN) and a transaction commit time (columns start_lsn and tran_end_time, respectively) are retained.</span></span> <span data-ttu-id="d9fa6-162">El valor máximo de LSN que se encuentra en `cdc.lsn_time_mapping` representa la marca de límite superior de la ventana de validez de base de datos.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-162">The maximum LSN value that is found in `cdc.lsn_time_mapping` represents the high water mark of the database validity window.</span></span> <span data-ttu-id="d9fa6-163">La limpieza basada en la retención usa su tiempo de confirmación correspondiente como base para calcular una nueva marca de límite inferior.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-163">Its corresponding commit time is used as the base from which retention based cleanup computes a new low water mark.</span></span>  
  
 <span data-ttu-id="d9fa6-164">Dado que el proceso de captura extrae los datos modificados del registro de transacciones, hay una latencia integrada entre el momento en que un cambio se confirma en una tabla de origen y el momento en que el cambio aparece dentro de su tabla de cambios asociada.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-164">Because the capture process extracts change data from the transaction log, there is a built in latency between the time that a change is committed to a source table and the time that the change appears within its associated change table.</span></span> <span data-ttu-id="d9fa6-165">Aunque esta latencia suele ser pequeña, es importante recordar que los datos modificados no estarán disponibles hasta que el proceso de captura haya procesado las entradas de registro relacionadas.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-165">While this latency is typically small, it is nevertheless important to remember that change data is not available until the capture process has processed the related log entries.</span></span>  
  
## <a name="change-data-capture-validity-interval-for-a-capture-instance"></a><span data-ttu-id="d9fa6-166">Intervalo de validez de la captura de datos modificados para una instancia de captura</span><span class="sxs-lookup"><span data-stu-id="d9fa6-166">Change Data Capture Validity Interval for a Capture Instance</span></span>  
 <span data-ttu-id="d9fa6-167">Aunque es común que coincidan el intervalo de validez de la base de datos y el de la instancia de una captura individual, esto no siempre es así.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-167">Although it is common for the database validity interval and the validity interval of individual capture instance to coincide, this is not always true.</span></span> <span data-ttu-id="d9fa6-168">El intervalo de validez de la instancia de captura se inicia cuando el proceso de captura reconoce la instancia de captura y comienza a registrar los cambios asociados en su tabla de cambios.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-168">The validity interval of the capture instance starts when the capture process recognizes the capture instance and starts to log associated changes to its change table.</span></span> <span data-ttu-id="d9fa6-169">Como resultado, si las instancias de captura se crean en momentos diferentes, cada una tendrá inicialmente un extremo inferior diferente.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-169">As a result, if capture instances are created at different times, each will initially have a different low endpoint.</span></span> <span data-ttu-id="d9fa6-170">La columna start_lsn del conjunto de resultados devuelto por la instrucción [sys.sp_cdc_help_change_data_capture](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-change-data-capture-transact-sql) muestra el punto de conexión inferior actual de cada instancia de captura definida.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-170">The start_lsn column of the result set that is returned by [sys.sp_cdc_help_change_data_capture](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-change-data-capture-transact-sql) shows the current low endpoint for each defined capture instance.</span></span> <span data-ttu-id="d9fa6-171">Cuando el proceso de limpieza limpia las entradas de la tabla de cambios, ajusta los valores de start_lsn para que todas las instancias de captura reflejen la nueva marca de límite inferior para los datos modificados disponibles.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-171">When the cleanup process cleans up change table entries, it adjusts the start_lsn values for all capture instances to reflect the new low water mark for available change data.</span></span> <span data-ttu-id="d9fa6-172">Solo se ajustan las instancias de captura que tienen valores de start_lsn menores que la nueva marca de límite inferior en ese momento.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-172">Only those capture instances that have start_lsn values that are currently less than the new low water mark are adjusted.</span></span> <span data-ttu-id="d9fa6-173">Con el tiempo, si no se crea ninguna nueva instancia de captura, los intervalos de validez para todas las instancias individuales tenderán a coincidir con el intervalo de validez de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-173">Over time, if no new capture instances are created, the validity intervals for all individual instances will tend to coincide with the database validity interval.</span></span>  
  
 <span data-ttu-id="d9fa6-174">El intervalo de validez es importante para los consumidores de datos modificados porque el intervalo de extracción de una solicitud debe ser abarcado totalmente por el intervalo de validez de la captura de datos modificados actual para la instancia de captura.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-174">The validity interval is important to consumers of change data because the extraction interval for a request must be fully covered by the current change data capture validity interval for the capture instance.</span></span> <span data-ttu-id="d9fa6-175">Si el extremo inferior del intervalo de extracción está situado a la izquierda del extremo inferior del intervalo de validez, una limpieza enérgica puede provocar que se pierdan datos modificados.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-175">If the low endpoint of the extraction interval is to the left of the low endpoint of the validity interval, there could be missing change data due to aggressive cleanup.</span></span> <span data-ttu-id="d9fa6-176">Si el extremo superior del intervalo de extracción está a la derecha del extremo superior del intervalo de validez, el proceso de captura no ha procesado aún el período de tiempo representado por el intervalo de extracción, y también pueden perderse datos modificados.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-176">If the high endpoint of the extraction interval is to the right of the high endpoint of the validity interval, the capture process has not yet processed through the time period that is represented by the extraction interval, and change data could also be missing.</span></span>  
  
 <span data-ttu-id="d9fa6-177">La función [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) se usa para recuperar el valor mínimo actual de LSN para la instancia de una captura, mientras que [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) se usa para recuperar el valor máximo actual de LSN.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-177">The function [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) is used to retrieve the current minimum LSN for a capture instance, while [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) is used to retrieve the current maximum LSN value.</span></span> <span data-ttu-id="d9fa6-178">Al consultar los datos modificados, si el intervalo de LSN especificado no está incluido dentro de estos dos valores de LSN, se producirá un error en las funciones de consulta de captura de datos modificados.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-178">When querying for change data, if the specified LSN range does not lie within these two LSN values, the change data capture query functions will fail.</span></span>  
  
## <a name="handling-changes-to-source-tables"></a><span data-ttu-id="d9fa6-179">Administrar los cambios en las tablas de origen</span><span class="sxs-lookup"><span data-stu-id="d9fa6-179">Handling Changes to Source Tables</span></span>  
 <span data-ttu-id="d9fa6-180">El alojamiento de los cambios de columnas en las tablas de origen sometidas a seguimiento es un problema difícil para los consumidores de nivel inferior.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-180">To accommodate column changes in the source tables that are being tracked is a difficult issue for downstream consumers.</span></span> <span data-ttu-id="d9fa6-181">Aunque la habilitación de la captura de datos modificados en una tabla de origen no evita que se produzcan dichos cambios de DDL, la captura de datos modificados ayuda a mitigar el efecto en los consumidores al permitir que los conjuntos de resultados entregados que se devuelven a través de la API permanezcan inalterados incluso cuando cambia la estructura de columnas de la tabla de origen subyacente.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-181">Although enabling change data capture on a source table does not prevent such DDL changes from occurring, change data capture helps to mitigate the effect on consumers by allowing the delivered result sets that are returned through the API to remain unchanged even as the column structure of the underlying source table changes.</span></span> <span data-ttu-id="d9fa6-182">Esta estructura de columnas fija también se refleja en la tabla de cambios subyacente a la que tienen acceso las funciones de consulta definidas.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-182">This fixed column structure is also reflected in the underlying change table that the defined query functions access.</span></span>  
  
 <span data-ttu-id="d9fa6-183">Para hospedar una tabla de cambios con una estructura de columnas fija, el proceso de captura responsable de rellenar la tabla de cambios omitirá cualquier columna nueva que no se identifique para la captura cuando se habilite la tabla de origen para la captura de datos modificados.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-183">To accommodate a fixed column structure change table, the capture process responsible for populating the change table will ignore any new columns that are not identified for capture when the source table was enabled for change data capture.</span></span> <span data-ttu-id="d9fa6-184">Si se quita una columna sometida a seguimiento, se proporcionarán valores NULL para la columna en las entradas de cambios subsiguientes.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-184">If a tracked column is dropped, null values will be supplied for the column in the subsequent change entries.</span></span> <span data-ttu-id="d9fa6-185">Sin embargo, si una columna existente sufre un cambio en su tipo de datos, el cambio se propagará a la tabla de cambios para garantizar que el mecanismo de captura no provoca la pérdida de datos de las columnas sometidas a seguimiento.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-185">However, if an existing column undergoes a change in its data type, the change is propagated to the change table to ensure that the capture mechanism does not introduce data loss to tracked columns.</span></span> <span data-ttu-id="d9fa6-186">El proceso de captura también expone cualquier cambio detectado en la estructura de columnas de las tablas sometidas a seguimiento en la tabla cdc.ddl_history.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-186">The capture process also posts any detected changes to the column structure of tracked tables to the cdc.ddl_history table.</span></span> <span data-ttu-id="d9fa6-187">Los consumidores que quieran que se les avise de los ajustes que podrían tener que realizarse en las aplicaciones de nivel inferior, deberán usar el procedimiento almacenado [sys.sp_cdc_get_ddl_history](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-get-ddl-history-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d9fa6-187">Consumers wishing to be alerted of adjustments that might have to be made in downstream applications, use the stored procedure [sys.sp_cdc_get_ddl_history](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-get-ddl-history-transact-sql).</span></span>  
  
 <span data-ttu-id="d9fa6-188">Normalmente, la instancia de captura actual continuará conservando su forma cuando se apliquen los cambios de la DDL a su tabla de origen asociada.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-188">Typically, the current capture instance will continue to retain its shape when DDL changes are applied to its associated source table.</span></span> <span data-ttu-id="d9fa6-189">Sin embargo, es posible crear una segunda instancia de captura para la tabla que refleje la nueva estructura de columnas.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-189">However, it is possible to create a second capture instance for the table that reflects the new column structure.</span></span> <span data-ttu-id="d9fa6-190">Esto permite al proceso de captura realizar cambios en la misma tabla de origen en dos tablas de cambios distintas que tienen dos estructuras de columnas diferentes.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-190">This allows the capture process to make changes to the same source table into two distinct change tables having two different column structures.</span></span> <span data-ttu-id="d9fa6-191">Así, mientras una tabla de cambios puede continuar alimentando los programas funcionales actuales, la segunda puede controlar un entorno de desarrollo que esté intentando incorporar datos de columnas nuevas.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-191">Thus, while one change table can continue to feed current operational programs, the second one can drive a development environment that is trying to incorporate the new column data.</span></span> <span data-ttu-id="d9fa6-192">Permitir al mecanismo de captura rellenar ambas tablas de cambios a la vez implica que se puede llevar a cabo una transición de una a otra sin perder los datos modificados.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-192">Allowing the capture mechanism to populate both change tables in tandem means that a transition from one to the other can be accomplished without loss of change data.</span></span> <span data-ttu-id="d9fa6-193">Esto puede ocurrir siempre que se solapen dos escalas de tiempo de captura de datos modificados.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-193">This can happen any time the two change data capture timelines overlap.</span></span> <span data-ttu-id="d9fa6-194">Cuando se realiza la transición, se puede quitar la instancia de captura obsoleta.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-194">When the transition is effected, the obsolete capture instance can be removed.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d9fa6-195">Solo se pueden asociar dos instancias de captura a una única tabla de origen al mismo tiempo, como máximo.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-195">The maximum number of capture instances that can be concurrently associated with a single source table is two.</span></span>  
  
## <a name="relationship-between-the-capture-job-and-the-transactional-replication-logreader"></a><span data-ttu-id="d9fa6-196">Relación entre el trabajo de captura y el lector del registro de la replicación transaccional</span><span class="sxs-lookup"><span data-stu-id="d9fa6-196">Relationship Between the Capture Job and the Transactional Replication Logreader</span></span>  
 <span data-ttu-id="d9fa6-197">La lógica para el proceso de captura de datos modificados se incrusta en el procedimiento almacenado [sp_replcmds](/sql/relational-databases/system-stored-procedures/sp-replcmds-transact-sql), una función de servidor interna generada como parte de sqlservr.exe y que también se usa en la replicación transaccional para recopilar los cambios del registro de transacciones.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-197">The logic for change data capture process is embedded in the stored procedure [sp_replcmds](/sql/relational-databases/system-stored-procedures/sp-replcmds-transact-sql), an internal server function built as part of sqlservr.exe and also used by transactional replication to harvest changes from the transaction log.</span></span> <span data-ttu-id="d9fa6-198">Cuando la captura de datos modificados se habilita sola para una base de datos, se crea el trabajo Captura del Agente SQL Server de la captura de datos modificados como vehículo para llamar a sp_replcmds.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-198">When change data capture alone is enabled for a database, you create the change data capture SQL Server Agent capture job as the vehicle for invoking sp_replcmds.</span></span> <span data-ttu-id="d9fa6-199">Cuando la replicación también está presente, el lector del registro transaccional solo se utiliza para satisfacer las necesidades de datos modificados de ambos consumidores.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-199">When replication is also present, the transactional logreader alone is used to satisfy the change data needs for both of these consumers.</span></span> <span data-ttu-id="d9fa6-200">Esta estrategia reduce significativamente la contención del registro cuando se habilitan en la misma base de datos tanto la replicación como la captura de datos modificados.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-200">This strategy significantly reduces log contention when both replication and change data capture are enabled for the same database.</span></span>  
  
 <span data-ttu-id="d9fa6-201">El cambio entre estos dos modos funcionales para capturar los datos modificados se produce automáticamente cada vez que hay un cambio en el estado de replicación de una base de datos con la captura de datos modificados habilitada.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-201">The switch between these two operational modes for capturing change data occurs automatically whenever there is a change in the replication status of a change data capture enabled database.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="d9fa6-202">Ambas instancias de la lógica de captura requieren que el Agente [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] se esté ejecutando para que el proceso se ejecute.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-202">Both instances of the capture logic require [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent to be running for the process to execute.</span></span>  
  
 <span data-ttu-id="d9fa6-203">La tarea principal del proceso de captura es examinar el registro y escribir los datos de las columnas y la información relacionada de las transacciones en las tablas de cambios de la captura de datos modificados.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-203">The principal task of the capture process is to scan the log and write column data and transaction related information to the change data capture change tables.</span></span> <span data-ttu-id="d9fa6-204">Para asegurarse de que existe un límite coherente desde el punto de vista de las transacciones a través de todas las tablas de cambios de captura de datos modificados que rellene, el proceso de captura abre y confirma su propia transacción en cada ciclo de examen.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-204">To ensure a transactionally consistent boundary across all the change data capture change tables that it populates, the capture process opens and commits its own transaction on each scan cycle.</span></span> <span data-ttu-id="d9fa6-205">Detecta cuándo se terminan de habilitar las tablas para la captura de datos modificados, y las incluye automáticamente en el conjunto de tablas para las que se supervisa si hay entradas de cambios en el registro.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-205">It detects when tables are newly enabled for change data capture, and automatically includes them in the set of tables that are actively monitored for change entries in the log.</span></span> <span data-ttu-id="d9fa6-206">De igual modo, también se detectará si se deshabilita la captura de datos modificados, lo que provoca que la tabla de origen se quite del conjunto de tablas en las que se supervisa si hay datos modificados.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-206">Similarly, disabling change data capture will also be detected, causing the source table to be removed from the set of tables actively monitored for change data.</span></span> <span data-ttu-id="d9fa6-207">Cuando finaliza el procesamiento de una sección del registro, el proceso de captura señala la lógica de truncamiento del registro de servidor, que utiliza esta información para identificar las entradas del registro que pueden elegirse para el truncamiento.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-207">When processing for a section of the log is finished, the capture process signals the server log truncation logic, which uses this information to identify log entries eligible for truncation.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d9fa6-208">Cuando una base de datos está habilitada para la captura de datos modificados, incluso si el modo de recuperación está establecido como simple, el punto de truncamiento de registro no avanzará hasta que el proceso de captura haya recopilado todos los cambios que estén marcados para la captura.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-208">When a database is enabled for change data capture, even if the recovery mode is set to simple recovery the log truncation point will not advance until all the changes that are marked for capture have been gathered by the capture process.</span></span> <span data-ttu-id="d9fa6-209">Si el proceso de captura no se está ejecutando y hay cambios que recopilar, al ejecutar CHECKPOINT, no se truncará el registro.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-209">If the capture process is not running and there are changes to be gathered, executing CHECKPOINT will not truncate the log.</span></span>  
  
 <span data-ttu-id="d9fa6-210">El proceso de captura también se utiliza para mantener un historial de los cambios de la DDL en las tablas sometidas a seguimiento.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-210">The capture process is also used to maintain history on the DDL changes to tracked tables.</span></span> <span data-ttu-id="d9fa6-211">Las instrucciones de DDL que están asociadas a la captura de datos modificados anotan entradas en el registro de transacciones de la base de datos cada vez que se quita una tabla o base de datos habilitadas para la captura de datos modificados, o cada vez que se agregan, modifican o quitan columnas de una tabla habilitada para la captura de datos modificados.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-211">The DDL statements that are associated with change data capture make entries to the database transaction log whenever a change data capture-enabled database or table is dropped or columns of a change data capture-enabled table are added, modified, or dropped.</span></span> <span data-ttu-id="d9fa6-212">Estas entradas del registro son procesadas por el proceso de captura que, posteriormente, envía los eventos de DDL asociados a la tabla cdc.ddl_history.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-212">These log entries are processed by the capture process, which then posts the associated DDL events to the cdc.ddl_history table.</span></span> <span data-ttu-id="d9fa6-213">Puede obtener información sobre los eventos de DDL que afectan a las tablas sometidas a seguimiento al usar el procedimiento almacenado [sys.sp_cdc_get_ddl_history](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-get-ddl-history-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d9fa6-213">You can obtain information about DDL events that affect tracked tables by using the stored procedure [sys.sp_cdc_get_ddl_history](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-get-ddl-history-transact-sql).</span></span>  
  
## <a name="change-data-capture-agent-jobs"></a><span data-ttu-id="d9fa6-214">Trabajos del agente de captura de datos modificados</span><span class="sxs-lookup"><span data-stu-id="d9fa6-214">Change Data Capture Agent Jobs</span></span>  
 <span data-ttu-id="d9fa6-215">A una base de datos habilitada para la captura de datos modificados se le suele asociar dos trabajos del Agente [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] : uno que se utiliza para rellenar las tablas de cambios de base de datos y otro que es el responsable de la limpieza de la tabla de cambios.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-215">Two [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent jobs are typically associated with a change data capture enabled database: one that is used to populate the database change tables, and one that is responsible for change table cleanup.</span></span> <span data-ttu-id="d9fa6-216">Ambos trabajos están compuestos de un único paso que ejecuta un comando de [!INCLUDE[tsql](../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="d9fa6-216">Both jobs consist of a single step that runs a [!INCLUDE[tsql](../../includes/tsql-md.md)] command.</span></span> <span data-ttu-id="d9fa6-217">El comando de [!INCLUDE[tsql](../../includes/tsql-md.md)] que se invoca es un procedimiento almacenado definido de captura de datos modificados que implementa la lógica del trabajo.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-217">The [!INCLUDE[tsql](../../includes/tsql-md.md)] command that is invoked is a change data capture defined stored procedure that implements the logic of the job.</span></span> <span data-ttu-id="d9fa6-218">Los trabajos se crean cuando la primera tabla de la base de datos se habilita para la captura de datos modificados.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-218">The jobs are created when the first table of the database is enabled for change data capture.</span></span> <span data-ttu-id="d9fa6-219">El trabajo de limpieza se crea siempre.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-219">The Cleanup Job is always created.</span></span> <span data-ttu-id="d9fa6-220">El trabajo de captura se creará solo si no hay definida ninguna publicación transaccional para la base de datos.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-220">The capture job will only be created if there are no defined transactional publications for the database.</span></span> <span data-ttu-id="d9fa6-221">También se crea el trabajo de captura cuando se habilitan tanto la captura de datos modificados como la replicación transaccional para una base de datos, y el trabajo del lector de registro transaccional se quita porque la base de datos ya no tiene definidas publicaciones.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-221">The capture job is also created when both change data capture and transactional replication are enabled for a database, and the transactional logreader job is removed because the database no longer has defined publications.</span></span>  
  
 <span data-ttu-id="d9fa6-222">Tanto el trabajo de limpieza como el de captura se crean con los parámetros predeterminados.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-222">Both the capture and cleanup jobs are created by using default parameters.</span></span> <span data-ttu-id="d9fa6-223">El trabajo de captura se inicia inmediatamente.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-223">The capture job is started immediately.</span></span> <span data-ttu-id="d9fa6-224">Se ejecuta de forma continua y procesa 1000 transacciones por cada ciclo de búsqueda, como máximo, con una espera de 5 segundos entre ciclos.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-224">It runs continuously, processing a maximum of 1000 transactions per scan cycle with a wait of 5 seconds between cycles.</span></span> <span data-ttu-id="d9fa6-225">El trabajo de limpieza se ejecuta diariamente a las 2 a.m.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-225">The cleanup job runs daily at 2 A.M.</span></span> <span data-ttu-id="d9fa6-226">Retiene las entradas de la tabla de cambios durante 4320 minutos o 3 días, y quita 5000 entradas, como máximo, con una sola instrucción de eliminación.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-226">It retains change table entries for 4320 minutes or 3 days, removing a maximum of 5000 entries with a single delete statement.</span></span>  
  
 <span data-ttu-id="d9fa6-227">Los trabajos del agente de captura de datos modificados se quitan cuando la captura de datos modificados se deshabilita en una base de datos.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-227">The change data capture agent jobs are removed when change data capture is disabled for a database.</span></span> <span data-ttu-id="d9fa6-228">También se puede quitar el trabajo de captura cuando se agrega la primera publicación a una base de datos, y se habilitan tanto la captura de datos modificados como la replicación transaccional.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-228">The capture job can also be removed when the first publication is added to a database, and both change data capture and transactional replication are enabled.</span></span>  
  
 <span data-ttu-id="d9fa6-229">Internamente, los trabajos del agente de captura de datos modificados se crean y se quitan mediante los procedimientos almacenados [sys.sp_cdc_add_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-add-job-transact-sql) y [sys.sp_cdc_drop_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-drop-job-transact-sql), respectivamente.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-229">Internally, change data capture agent jobs are created and dropped by using the stored procedures [sys.sp_cdc_add_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-add-job-transact-sql) and [sys.sp_cdc_drop_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-drop-job-transact-sql), respectively.</span></span> <span data-ttu-id="d9fa6-230">Estos procedimientos almacenados también se exponen para que los administradores puedan controlar la creación y eliminación de estos trabajos.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-230">These stored procedures are also exposed so that administrators can control the creation and removal of these jobs.</span></span>  
  
 <span data-ttu-id="d9fa6-231">Un administrador no tiene ningún control explícito sobre la configuración predeterminada de los trabajos del agente de captura de datos modificados.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-231">An administrator has no explicit control over the default configuration of the change data capture agent jobs.</span></span> <span data-ttu-id="d9fa6-232">Se proporciona el procedimiento almacenado [sys.sp_cdc_change_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-change-job-transact-sql) para permitir la modificación de los parámetros de configuración predeterminados.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-232">The stored procedure [sys.sp_cdc_change_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-change-job-transact-sql) is provided to allow the default configuration parameters to be modified.</span></span> <span data-ttu-id="d9fa6-233">Además, el procedimiento almacenado [sys.sp_cdc_help_jobs](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-jobs-transact-sql) permite ver los parámetros de configuración actuales.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-233">In addition, the stored procedure [sys.sp_cdc_help_jobs](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-jobs-transact-sql) allows current configuration parameters to be viewed.</span></span> <span data-ttu-id="d9fa6-234">Tanto el trabajo de captura como el de limpieza extraen los parámetros de configuración de la tabla msdb.dbo.cdc_jobs en el inicio.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-234">Both the capture job and the cleanup job extract configuration parameters from the table msdb.dbo.cdc_jobs on startup.</span></span> <span data-ttu-id="d9fa6-235">Los cambios que se realicen en estos valores mediante [sys.sp_cdc_change_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-change-job-transact-sql) no surtirán efecto hasta que se detenga y se reinicie el trabajo.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-235">Any changes made to these values by using [sys.sp_cdc_change_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-change-job-transact-sql) will not take effect until the job is stopped and restarted.</span></span>  
  
 <span data-ttu-id="d9fa6-236">Se proporcionan dos procedimientos almacenados adicionales para permitir iniciar y detener los trabajos del agente de captura de datos modificados: [sys.sp_cdc_start_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-start-job-transact-sql) y [sys.sp_cdc_stop_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-stop-job-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d9fa6-236">Two additional stored procedures are provided to allow the change data capture agent jobs to be started and stopped: [sys.sp_cdc_start_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-start-job-transact-sql) and [sys.sp_cdc_stop_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-stop-job-transact-sql).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d9fa6-237">Al iniciar y detener el trabajo de captura, no se pierde ningún dato modificado.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-237">Starting and stopping the capture job does not result in a loss of change data.</span></span> <span data-ttu-id="d9fa6-238">Solo se evita que el proceso de captura busque si hay entradas de cambios en el registro y las deposite en las tablas de cambios.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-238">It only prevents the capture process from actively scanning the log for change entries to deposit in the change tables.</span></span> <span data-ttu-id="d9fa6-239">Una estrategia razonable para evitar que la búsqueda en el registro suponga una carga adicional durante los períodos de máxima demanda es detener el trabajo de captura y reiniciarlo cuando se reduzca la demanda.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-239">A reasonable strategy to prevent log scanning from adding load during periods of peak demand is to stop the capture job and restart it when demand is reduced.</span></span>  
  
 <span data-ttu-id="d9fa6-240">Ambos trabajos del Agente [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] se diseñaron con el fin de ser lo suficientemente flexibles y configurables como para satisfacer las necesidades básicas de los entornos de captura de datos modificados.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-240">Both [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent jobs were designed to be flexible enough and sufficiently configurable to meet the basic needs of change data capture environments.</span></span> <span data-ttu-id="d9fa6-241">Sin embargo, en ambos casos, los procedimientos almacenados subyacentes que proporcionan la funcionalidad básica se han expuesto para posibilitar una mayor personalización.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-241">In both cases, however, the underlying stored procedures that provide the core functionality have been exposed so that further customization is possible.</span></span>  
  
 <span data-ttu-id="d9fa6-242">La captura de datos modificados no puede funcionar correctamente cuando el servicio Motor de base de datos o el servicio Agente SQL Server se ejecuta con la cuenta NETWORK SERVICE.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-242">Change data capture cannot function properly when the Database Engine service or the SQL Server Agent service is running under the NETWORK SERVICE account.</span></span> <span data-ttu-id="d9fa6-243">Esto puede ocasionar el error 22832.</span><span class="sxs-lookup"><span data-stu-id="d9fa6-243">This can result in error 22832.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d9fa6-244">Consulte también</span><span class="sxs-lookup"><span data-stu-id="d9fa6-244">See Also</span></span>  
 <span data-ttu-id="d9fa6-245">[Seguimiento de cambios de datos &#40;SQL Server&#41;](../track-changes/track-data-changes-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="d9fa6-245">[Track Data Changes &#40;SQL Server&#41;](../track-changes/track-data-changes-sql-server.md) </span></span>  
 <span data-ttu-id="d9fa6-246">[Habilitar y deshabilitar la captura de datos modificados &#40;SQL Server&#41;](../track-changes/enable-and-disable-change-data-capture-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="d9fa6-246">[Enable and Disable Change Data Capture &#40;SQL Server&#41;](../track-changes/enable-and-disable-change-data-capture-sql-server.md) </span></span>  
 <span data-ttu-id="d9fa6-247">[Trabajar con datos modificados &#40;SQL Server&#41;](../track-changes/work-with-change-data-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="d9fa6-247">[Work with Change Data &#40;SQL Server&#41;](../track-changes/work-with-change-data-sql-server.md) </span></span>  
 [<span data-ttu-id="d9fa6-248">Administrar y supervisar la captura de datos modificados &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d9fa6-248">Administer and Monitor Change Data Capture &#40;SQL Server&#41;</span></span>](../track-changes/administer-and-monitor-change-data-capture-sql-server.md)  
  
  
