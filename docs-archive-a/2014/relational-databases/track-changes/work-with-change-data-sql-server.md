---
title: Trabajar con datos modificados (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- change data [SQL Server]
- change data capture [SQL Server], query function scenarios
- change data capture [SQL Server], LSN boundaries
- change data capture [SQL Server], query functions
ms.assetid: 5346b852-1af8-4080-b278-12efb9b735eb
author: rothja
ms.author: jroth
ms.openlocfilehash: 018d5add95e5d0936f6055e1c6710b6a8ddabdab
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87674673"
---
# <a name="work-with-change-data-sql-server"></a><span data-ttu-id="4aec1-102">Trabajar con datos modificados (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="4aec1-102">Work with Change Data (SQL Server)</span></span>
  <span data-ttu-id="4aec1-103">Los datos modificados están a disposición de los consumidores de capturas de datos modificados a través de las funciones con valores de tabla (TVF).</span><span class="sxs-lookup"><span data-stu-id="4aec1-103">Change data is made available to change data capture consumers through table-valued functions (TVFs).</span></span> <span data-ttu-id="4aec1-104">Todas las consultas de estas funciones requieren dos parámetros para definir el intervalo de números de flujo de registro (LSN) que se pueden elegir al desarrollar el conjunto de resultados devuelto.</span><span class="sxs-lookup"><span data-stu-id="4aec1-104">All queries of these functions require two parameters to define the range of Log Sequence Numbers (LSNs) that are eligible for consideration when developing the returned result set.</span></span> <span data-ttu-id="4aec1-105">Se considera que los valores superior e inferior de LSN que limitan el intervalo están incluidos dentro del intervalo.</span><span class="sxs-lookup"><span data-stu-id="4aec1-105">Both the upper and lower LSN values that bound the interval are considered to be included within the interval.</span></span>  
  
 <span data-ttu-id="4aec1-106">Se proporcionan varias funciones que ayudan a determinar los valores de LSN adecuados para utilizarse al consultar una función TVF.</span><span class="sxs-lookup"><span data-stu-id="4aec1-106">Several functions are provided to help determine appropriate LSN values for use in querying a TVF.</span></span> <span data-ttu-id="4aec1-107">La función [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) devuelve el LSN más pequeño asociado a un intervalo de validez de la instancia de captura.</span><span class="sxs-lookup"><span data-stu-id="4aec1-107">The function [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) returns the smallest LSN that is associated with a capture instance validity interval.</span></span> <span data-ttu-id="4aec1-108">El intervalo de validez es el intervalo de tiempo durante el cual los datos modificados están actualmente disponibles en sus instancias de captura.</span><span class="sxs-lookup"><span data-stu-id="4aec1-108">The validity interval is the time interval for which change data is currently available for its capture instances.</span></span> <span data-ttu-id="4aec1-109">La función [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) devuelve el LSN más grande del intervalo de validez.</span><span class="sxs-lookup"><span data-stu-id="4aec1-109">The function [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) returns the largest LSN in the validity interval.</span></span> <span data-ttu-id="4aec1-110">Las funciones [sys.fn_cdc_map_time_to_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-map-time-to-lsn-transact-sql) y [sys.fn_cdc_map_lsn_to_time](/sql/relational-databases/system-functions/sys-fn-cdc-map-lsn-to-time-transact-sql) están disponibles para ayudar a ubicar los valores LSN en una escala de tiempo convencional.</span><span class="sxs-lookup"><span data-stu-id="4aec1-110">The functions [sys.fn_cdc_map_time_to_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-map-time-to-lsn-transact-sql) and [sys.fn_cdc_map_lsn_to_time](/sql/relational-databases/system-functions/sys-fn-cdc-map-lsn-to-time-transact-sql) are available to help place LSN values on a conventional timeline.</span></span> <span data-ttu-id="4aec1-111">Dado que la captura de datos modificados utiliza intervalos de consulta cerrados, a veces es necesario generar el valor de LSN siguiente en un flujo para garantizar que los cambios no estén duplicados en ventanas de consulta consecutivas.</span><span class="sxs-lookup"><span data-stu-id="4aec1-111">Because change data capture uses closed query intervals, it is sometimes necessary to generate the next LSN value in a sequence to ensure that changes are not duplicated in consecutive query windows.</span></span> <span data-ttu-id="4aec1-112">Las funciones [sys.fn_cdc_increment_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-increment-lsn-transact-sql) y [sys.fn_cdc_decrement_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-decrement-lsn-transact-sql) son útiles cuando es necesario realizar un ajuste incremental en un valor LSN.</span><span class="sxs-lookup"><span data-stu-id="4aec1-112">The functions [sys.fn_cdc_increment_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-increment-lsn-transact-sql) and [sys.fn_cdc_decrement_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-decrement-lsn-transact-sql) are useful when an incremental adjustment to an LSN value is required.</span></span>  
  
##  <a name="validating-lsn-boundaries"></a><a name="LSN"></a> <span data-ttu-id="4aec1-113">Validar los límites de LSN</span><span class="sxs-lookup"><span data-stu-id="4aec1-113">Validating LSN Boundaries</span></span>  
 <span data-ttu-id="4aec1-114">Se recomienda validar los límites de LSN que se van a utilizar en una consulta de TVF antes de su uso.</span><span class="sxs-lookup"><span data-stu-id="4aec1-114">We recommend validating the LSN boundaries that are to be used in a TVF query before their use.</span></span> <span data-ttu-id="4aec1-115">Los extremos nulos o los que quedan fuera del intervalo de validez para una instancia de captura obligarán a la función TVF de captura de datos modificados a devolver un error.</span><span class="sxs-lookup"><span data-stu-id="4aec1-115">Null endpoints or endpoints that lie outside the validity interval for a capture instance will force an error to be returned by a change data capture TVF.</span></span>  
  
 <span data-ttu-id="4aec1-116">Por ejemplo, el error siguiente se devuelve en una consulta de todos los cambios cuando un parámetro que se utiliza para definir el intervalo de la consulta no es válido o está fuera del intervalo, o bien cuando la opción de filtro de filas no es válida.</span><span class="sxs-lookup"><span data-stu-id="4aec1-116">For example, the following error is returned for a query for all changes when a parameter that is used to define the query interval is not valid, or is out of range, or the row filter option is invalid.</span></span>  
  
 `Msg 313, Level 16, State 3, Line 1`  
  
 `An insufficient number of arguments were supplied for the procedure or function cdc.fn_cdc_get_all_changes_ ...`  
  
 <span data-ttu-id="4aec1-117">El error correspondiente devuelto para una consulta `net changes` es el siguiente:</span><span class="sxs-lookup"><span data-stu-id="4aec1-117">The corresponding error returned for a `net changes` query is the following:</span></span>  
  
 `Msg 313, Level 16, State 3, Line 1`  
  
 `An insufficient number of arguments were supplied for the procedure or function cdc.fn_cdc_get_net_changes_ ...`  
  
> [!NOTE]  
>  <span data-ttu-id="4aec1-118">Es obvio que el mensaje 313 es confuso y no comunica la causa real del error.</span><span class="sxs-lookup"><span data-stu-id="4aec1-118">It is recognized that the message for Msg 313 is misleading and does not convey the actual cause of the failure.</span></span> <span data-ttu-id="4aec1-119">Este uso inadecuado proviene de la incapacidad de generar un error explícito desde dentro de una función TVF.</span><span class="sxs-lookup"><span data-stu-id="4aec1-119">This awkward usage stems from the inability to raise an explicit error from within a TVF.</span></span> <span data-ttu-id="4aec1-120">No obstante, se consideró que era preferible devolver un error reconocible, aunque inexacto, a devolver simplemente un resultado vacío.</span><span class="sxs-lookup"><span data-stu-id="4aec1-120">Nevertheless, the value of returning a recognizable, if inaccurate, error was deemed preferable to simply returning an empty result.</span></span> <span data-ttu-id="4aec1-121">Un conjunto de resultados vacío no sería discernible de una consulta válida que no devolviese ningún cambio.</span><span class="sxs-lookup"><span data-stu-id="4aec1-121">An empty result set would not be distinguishable from a valid query returning no changes.</span></span>  
  
 <span data-ttu-id="4aec1-122">Los errores de autorización devolverán errores al consultar todos los cambios, como se muestra a continuación:</span><span class="sxs-lookup"><span data-stu-id="4aec1-122">Authorization failures will return failures when querying for all changes, as shown:</span></span>  
  
 `Msg 229, Level 14, State 5, Line 1`  
  
 `The SELECT permission was denied on the object 'fn_cdc_get_all_changes_...', database 'MyDB', schema 'cdc'.`  
  
 <span data-ttu-id="4aec1-123">Se da la misma circunstancia al consultar los cambios de red:</span><span class="sxs-lookup"><span data-stu-id="4aec1-123">The same is true when querying for net changes:</span></span>  
  
 `Msg 229, Level 14, State 5, Line 1`  
  
 `The SELECT permission was denied on the object fn_cdc_get_net_changes_...', database 'MyDB', schema 'cdc'.`  
  
 <span data-ttu-id="4aec1-124">Vea la plantilla para enumerar cambios netos con TRY CATCH, que contiene una demostración acerca de cómo se pueden interceptar estos errores de TVF conocidos y se puede devolver información más significativa sobre el error.</span><span class="sxs-lookup"><span data-stu-id="4aec1-124">See the template Enumerate Net Changes Using TRY CATCH for a demonstration of how to intercept these known TVF errors and return more meaningful information about the failure.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="4aec1-125">Para buscar las plantillas de captura de datos modificados en SQL Server Management Studio, en el menú **Ver** , haga clic en **Explorador de plantillas**, expanda **Plantillas de SQL Server** y, luego, la carpeta **Captura de datos modificados** .</span><span class="sxs-lookup"><span data-stu-id="4aec1-125">To locate change data capture templates in SQL Server Management Studio, on the **View** menu, click **Template Explorer**, expand **SQL Server Templates** and then expand the **Change Data Capture** folder.</span></span>  
  
##  <a name="query-functions"></a><a name="Functions"></a> <span data-ttu-id="4aec1-126">Funciones de consulta</span><span class="sxs-lookup"><span data-stu-id="4aec1-126">Query Functions</span></span>  
 <span data-ttu-id="4aec1-127">Según sean las características de la tabla de origen que se someta a seguimiento y la manera en que se configure su instancia de captura, se generarán una o las dos funciones TVF para la consulta de datos modificados.</span><span class="sxs-lookup"><span data-stu-id="4aec1-127">Depending on the characteristics of the source table being tracked and the way in which its capture instance is configured, either one or two TVFs for querying change data are generated.</span></span>  
  
-   <span data-ttu-id="4aec1-128">La función [cdc.fn_cdc_get_all_changes_<instancia_captura>](/sql/relational-databases/system-functions/cdc-fn-cdc-get-all-changes-capture-instance-transact-sql) devuelve todos los cambios producidos durante el intervalo especificado.</span><span class="sxs-lookup"><span data-stu-id="4aec1-128">The function [cdc.fn_cdc_get_all_changes_<capture_instance>](/sql/relational-databases/system-functions/cdc-fn-cdc-get-all-changes-capture-instance-transact-sql) returns all changes that occurred for the specified interval.</span></span> <span data-ttu-id="4aec1-129">Siempre se genera esta función.</span><span class="sxs-lookup"><span data-stu-id="4aec1-129">This function is always generated.</span></span> <span data-ttu-id="4aec1-130">Las entradas siempre se devuelven ordenadas, primero por el SLN de confirmación de la transacción del cambio y, a continuación, por un valor que secuencia el cambio dentro de su transacción.</span><span class="sxs-lookup"><span data-stu-id="4aec1-130">Entries are always returned sorted, first by the transaction commit LSN of the change, and then by a value that sequences the change within its transaction.</span></span> <span data-ttu-id="4aec1-131">Según sea la opción de filtro de filas elegida, se devuelve la fila final de la actualización (opción de filtro de filas "all") o los valores nuevo y antiguo de la actualización (opción de filtro de filas "all update old").</span><span class="sxs-lookup"><span data-stu-id="4aec1-131">Depending on the row filter option chosen, either the final row is returned on update (row filter option "all") or both the new and old values are returned on update (row filter option "all update old"').</span></span>  
  
-   <span data-ttu-id="4aec1-132">La función [cdc.fn_cdc_get_net_changes_<capture_instance>](/sql/relational-databases/system-functions/cdc-fn-cdc-get-net-changes-capture-instance-transact-sql) se genera si el parámetro @supports_net_changes se establece en 1 cuando la tabla de origen está habilitada.</span><span class="sxs-lookup"><span data-stu-id="4aec1-132">The function [cdc.fn_cdc_get_net_changes_<capture_instance>](/sql/relational-databases/system-functions/cdc-fn-cdc-get-net-changes-capture-instance-transact-sql) is generated when the parameter @supports_net_changes is set to 1 when the source table is enabled.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="4aec1-133">Solo se admite esta opción si la tabla de origen tiene definida una clave principal o si el parámetro @index_name se ha usado para identificar un índice único.</span><span class="sxs-lookup"><span data-stu-id="4aec1-133">This option is only supported if the source table has a defined primary key or if the parameter @index_name has been used to identify a unique index.</span></span>  
  
     <span data-ttu-id="4aec1-134">La función **netchanges** devuelve un cambio por cada fila de la tabla de origen modificada.</span><span class="sxs-lookup"><span data-stu-id="4aec1-134">The **netchanges** function returns one change per modified source table row.</span></span> <span data-ttu-id="4aec1-135">Si se registra más de un cambio para la fila durante el intervalo especificado, los valores de la columna reflejarán el contenido final de la fila.</span><span class="sxs-lookup"><span data-stu-id="4aec1-135">If more than one change is logged for the row during the specified interval, the column values will reflect the final contents of the row.</span></span> <span data-ttu-id="4aec1-136">Para identificar correctamente la operación necesaria para actualizar el entorno de destino, la función TVF debe considerar tanto la operación inicial en la fila durante el intervalo como la operación final en la fila.</span><span class="sxs-lookup"><span data-stu-id="4aec1-136">To correctly identify the operation that is necessary to update the target environment, the TVF must consider both the initial operation on the row during the interval and the final operation on the row.</span></span> <span data-ttu-id="4aec1-137">Cuando se especifica la opción de filtro de filas 'all', las operaciones devueltas por una consulta `net changes` podrán ser inserciones, eliminaciones o actualizaciones (valores nuevos).</span><span class="sxs-lookup"><span data-stu-id="4aec1-137">When the row filter option 'all' is specified, the operations that are returned by a `net changes` query will either be insert, delete, or update (new values).</span></span> <span data-ttu-id="4aec1-138">Esta opción siempre devuelve el valor NULL para la máscara de actualización porque hay un costo asociado al cálculo de una máscara agregada.</span><span class="sxs-lookup"><span data-stu-id="4aec1-138">This option always returns the update mask as null because there is a cost associated with computing an aggregate mask.</span></span> <span data-ttu-id="4aec1-139">Si necesita una máscara agregada que refleje todos los cambios efectuados en una fila, use la opción 'all with mask'.</span><span class="sxs-lookup"><span data-stu-id="4aec1-139">If you require an aggregate mask that reflects all changes to a row, use the 'all with mask' option.</span></span> <span data-ttu-id="4aec1-140">Si el procesamiento posterior no precisa distinguir entre inserciones y actualizaciones, use la opción 'all with merge'.</span><span class="sxs-lookup"><span data-stu-id="4aec1-140">If downstream processing does not require inserts and updates to be distinguished, use the 'all with merge' option.</span></span> <span data-ttu-id="4aec1-141">En este caso, el valor de la operación aceptará solo dos valores: 1 para la eliminación y 5 para una operación que podría ser una inserción o una actualización.</span><span class="sxs-lookup"><span data-stu-id="4aec1-141">In this case, the operation value will only take on two values: 1 for delete and 5 for an operation that could be either an insert or an update.</span></span> <span data-ttu-id="4aec1-142">Esta opción elimina el procesamiento adicional necesario para determinar si la operación derivada debía ser una inserción o una actualización, y puede mejorar el rendimiento de la consulta cuando no sea necesaria esta diferenciación.</span><span class="sxs-lookup"><span data-stu-id="4aec1-142">This option eliminates the additional processing needed to determine whether the derived operation should be an insert or an update, and can improve the performance of the query when this differentiation is not necessary.</span></span>  
  
 <span data-ttu-id="4aec1-143">La máscara de la actualización devuelta por una función de consulta es una representación compacta que identifica todas las columnas que han cambiado en una fila de datos modificados.</span><span class="sxs-lookup"><span data-stu-id="4aec1-143">The update mask that is returned from a query function is a compact representation that identifies all columns that changed in a row of change data.</span></span> <span data-ttu-id="4aec1-144">Normalmente, esta información solo es necesaria para un pequeño subconjunto de las columnas capturadas.</span><span class="sxs-lookup"><span data-stu-id="4aec1-144">Typically, this information is only required for a small subset of the captured columns.</span></span> <span data-ttu-id="4aec1-145">Hay funciones que se pueden usar para ayudar a extraer información de la máscara de una forma que sea más fácilmente utilizable por las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="4aec1-145">Functions are available to assist in extracting information from the mask in a form that is more directly usable by applications.</span></span> <span data-ttu-id="4aec1-146">La función [sys.fn_cdc_get_column_ordinal](/sql/relational-databases/system-functions/sys-fn-cdc-get-column-ordinal-transact-sql) devuelve la posición ordinal de una columna con nombre de una determinada instancia de captura, mientras que la función [sys.fn_cdc_is_bit_set](/sql/relational-databases/system-functions/sys-fn-cdc-is-bit-set-transact-sql) devuelve la paridad del bit de la máscara proporcionada en función del ordinal que se pasó en la llamada a la función.</span><span class="sxs-lookup"><span data-stu-id="4aec1-146">The function [sys.fn_cdc_get_column_ordinal](/sql/relational-databases/system-functions/sys-fn-cdc-get-column-ordinal-transact-sql) returns the ordinal position of a named column for a given capture instance, whereas the function [sys.fn_cdc_is_bit_set](/sql/relational-databases/system-functions/sys-fn-cdc-is-bit-set-transact-sql) returns the parity of the bit in the provided mask based on the ordinal that was passed in the function call.</span></span> <span data-ttu-id="4aec1-147">La combinación de estas dos funciones permite extraer eficazmente información de la máscara de actualización y devolverla con la solicitud de datos modificados.</span><span class="sxs-lookup"><span data-stu-id="4aec1-147">Together, these two functions allow information from the update mask to be efficiently extracted and returned with the request for change data.</span></span> <span data-ttu-id="4aec1-148">Vea la plantilla para enumerar cambios netos con 'All With Mask', que contiene una demostración acerca de cómo se utilizan estas funciones.</span><span class="sxs-lookup"><span data-stu-id="4aec1-148">See the template Enumerate Net Changes Using All With Mask for a demonstration of how these functions are used.</span></span>  
  
##  <a name="query-function-scenarios"></a><a name="Scenarios"></a> <span data-ttu-id="4aec1-149">Escenarios de funciones de consulta</span><span class="sxs-lookup"><span data-stu-id="4aec1-149">Query Function Scenarios</span></span>  
 <span data-ttu-id="4aec1-150">En las secciones siguientes se describen los escenarios comunes de consulta de los datos modificados de las capturas mediante las funciones de consulta cdc.fn_cdc_get_all_changes_<capture_instance> y cdc.fn_cdc_get_net_changes_<capture_instance>.</span><span class="sxs-lookup"><span data-stu-id="4aec1-150">The following sections describe common scenarios for querying change data capture data by using the query functions cdc.fn_cdc_get_all_changes_<capture_instance> and cdc.fn_cdc_get_net_changes_<capture_instance>.</span></span>  
  
### <a name="querying-for-all-changes-within-the-capture-instance-validity-interval"></a><span data-ttu-id="4aec1-151">Consultar todos los cambios del intervalo de validez de la instancia de captura</span><span class="sxs-lookup"><span data-stu-id="4aec1-151">Querying for All Changes Within the Capture Instance Validity Interval</span></span>  
 <span data-ttu-id="4aec1-152">La solicitud más sencilla de los datos modificados es la que devuelve todo los datos modificados actuales comprendidos en un intervalo de validez de una instancia de captura.</span><span class="sxs-lookup"><span data-stu-id="4aec1-152">The most straightforward request for change data is one that returns all of the current change data in a capture instance's validity interval.</span></span> <span data-ttu-id="4aec1-153">Para realizar esta solicitud, primero debe determinarse el límite inferior y el límite superior de LSN del intervalo de validez.</span><span class="sxs-lookup"><span data-stu-id="4aec1-153">To make this request, first determine the lower and upper LSN boundaries of the validity interval.</span></span> <span data-ttu-id="4aec1-154">Después, use estos valores para identificar los parámetros @from_lsn y @to_lsn pasados a la función de consulta cdc.fn_cdc_get_all_changes_<capture_instance> o cdc.fn_cdc_get_net_changes_<capture_instance>.</span><span class="sxs-lookup"><span data-stu-id="4aec1-154">Then, use these values to identify the parameters @from_lsn and @to_lsn passed to the query function cdc.fn_cdc_get_all_changes_<capture_instance> or cdc.fn_cdc_get_net_changes_<capture_instance>.</span></span> <span data-ttu-id="4aec1-155">Use la función [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) para obtener el límite inferior y la función [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) para obtener el límite superior.</span><span class="sxs-lookup"><span data-stu-id="4aec1-155">Use the function [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) to obtain the lower bound, and [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) to obtain the upper bound.</span></span> <span data-ttu-id="4aec1-156">Vea la plantilla para enumerar todos los cambios del rango válido, que contiene un ejemplo de código sobre una consulta de todos los cambios válidos actuales con la función de consulta cdc.fn_cdc_get_all_changes_<capture_instance>.</span><span class="sxs-lookup"><span data-stu-id="4aec1-156">See the template Enumerate All Changes for the Valid Range for sample code to query for all current valid changes by using the query function cdc.fn_cdc_get_all_changes_<capture_instance>.</span></span> <span data-ttu-id="4aec1-157">Vea la plantilla para enumerar cambios netos del rango válido, que contiene un ejemplo similar sobre el uso de la función cdc.fn_cdc_get_net_changes_<capture_instance>.</span><span class="sxs-lookup"><span data-stu-id="4aec1-157">See the template Enumerate Net Changes for the Valid Range for a similar example of using the function cdc.fn_cdc_get_net_changes_<capture_instance>.</span></span>  
  
### <a name="querying-for-all-new-changes-since-the-last-set-of-changes"></a><span data-ttu-id="4aec1-158">Consultar todos los cambios nuevos desde el último conjunto de cambios</span><span class="sxs-lookup"><span data-stu-id="4aec1-158">Querying for All New Changes Since the Last Set of Changes</span></span>  
 <span data-ttu-id="4aec1-159">En las aplicaciones típicas, la consulta de los datos modificados constituye un proceso continuo en el que se realizan solicitudes periódicas de todos los cambios acaecidos desde la última solicitud.</span><span class="sxs-lookup"><span data-stu-id="4aec1-159">For typical applications, querying for change data will be an ongoing process, making periodic requests for all of the changes that occurred since the last request.</span></span> <span data-ttu-id="4aec1-160">En este tipo de consultas, puede usar la función [sys.fn_cdc_increment_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-increment-lsn-transact-sql) para derivar el límite inferior de la consulta actual del límite superior de la consulta anterior.</span><span class="sxs-lookup"><span data-stu-id="4aec1-160">For such queries, you can use the function [sys.fn_cdc_increment_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-increment-lsn-transact-sql) to derive the lower bound of the current query from the upper bound of the previous query.</span></span> <span data-ttu-id="4aec1-161">Con este método se asegura de que ninguna fila se repite, porque el intervalo de búsqueda se trata siempre como un intervalo cerrado en el que se incluyen los dos extremos.</span><span class="sxs-lookup"><span data-stu-id="4aec1-161">This method ensures that no rows are repeated because the query interval is always treated as a closed interval where both end-points are included in the interval.</span></span> <span data-ttu-id="4aec1-162">Luego, use la función [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) para obtener el extremo superior del nuevo intervalo de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="4aec1-162">Then, use the function [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) to obtain the high end-point for the new request interval.</span></span> <span data-ttu-id="4aec1-163">Vea la plantilla para enumerar todos los cambios desde la solicitud anterior, que contiene un ejemplo de código en el que la ventana de consulta se mueve sistemáticamente para obtener todos los cambios desde la última solicitud.</span><span class="sxs-lookup"><span data-stu-id="4aec1-163">See the template Enumerate All Changes Since Previous Request for sample code to systematically move the query window to obtain all changes since the last request.</span></span>  
  
### <a name="querying-for-all-new-changes-up-until-now"></a><span data-ttu-id="4aec1-164">Consultar todos los cambios nuevos hasta este momento</span><span class="sxs-lookup"><span data-stu-id="4aec1-164">Querying for all New Changes Up Until Now</span></span>  
 <span data-ttu-id="4aec1-165">Una restricción habitual que se aplica a los cambios devueltos por una función de consulta es que solo se incluyen los cambios producidos entre la solicitud anterior y la fecha y hora actual.</span><span class="sxs-lookup"><span data-stu-id="4aec1-165">A typical constraint that is placed on the changes returned by a query function is to include only the changes that occurred between the previous request until the current date and time.</span></span> <span data-ttu-id="4aec1-166">En esta consulta, aplique la función sys.fn_cdc_increment_lsn al valor @from_lsn que se ha usado en la solicitud anterior para determinar el límite inferior.</span><span class="sxs-lookup"><span data-stu-id="4aec1-166">For this query, apply the function sys.fn_cdc_increment_lsn to the @from_lsn value that was used in the previous request to determine the lower bound.</span></span> <span data-ttu-id="4aec1-167">Dado que el límite superior del intervalo de tiempo se expresa como un punto concreto en el tiempo, debe convertirse en un valor LSN antes de poder utilizarse en una función de consulta.</span><span class="sxs-lookup"><span data-stu-id="4aec1-167">Because the upper bound on the time interval is expressed as a specific point in time, it must be converted to an LSN value before it can be used by a query function.</span></span> <span data-ttu-id="4aec1-168">Antes de que el valor de fecha y hora se pueda convertir en el valor LSN correspondiente, debe asegurarse de que el proceso de captura ha procesado todos los cambios que se confirmaron a través del límite superior especificado.</span><span class="sxs-lookup"><span data-stu-id="4aec1-168">Before the datetime value can be converted to a corresponding LSN value, you must ensure that the capture process has processed all changes that were committed through the specified upper bound.</span></span> <span data-ttu-id="4aec1-169">Esta operación es necesaria para asegurarse de que todos los cambios certificados se propagaron en la tabla de cambios.</span><span class="sxs-lookup"><span data-stu-id="4aec1-169">This is required to ensure that all the qualifying changes have been propagated to the change table.</span></span> <span data-ttu-id="4aec1-170">Un modo de hacerlo consiste en estructurar un bucle de espera que periódicamente compruebe si el LSN de confirmación registrado en una tabla de cambios de base de datos supera la hora de finalización deseada del intervalo de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="4aec1-170">One way to do this is to structure a wait loop that periodically checks to see if the current maximum commit lsn recorded for any database change table exceeds the desired end time of the request interval.</span></span>  
  
 <span data-ttu-id="4aec1-171">Una vez que el bucle de espera comprueba que el proceso de captura ha procesado todas las entradas de registro correspondientes, use la función [sys.fn_cdc_map_time_to_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-map-time-to-lsn-transact-sql) para determinar el nuevo extremo superior expresado con un valor LSN.</span><span class="sxs-lookup"><span data-stu-id="4aec1-171">After the delay loop verifies that the capture process has already processed all the relevant log entries, use the function [sys.fn_cdc_map_time_to_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-map-time-to-lsn-transact-sql) to determine the new high end-point expressed as an LSN value.</span></span> <span data-ttu-id="4aec1-172">Para asegurarse de que todas las entradas confirmadas en la hora especificada se recuperan, llame a la función sys.fn_cdc_map_time_to_lsn y utilice la opción 'largest less than or equal'.</span><span class="sxs-lookup"><span data-stu-id="4aec1-172">To ensure that all entries that were committed through the specified time are retrieved, call the function sys.fn_cdc_map_time_to_lsn, and use the option 'largest less than or equal'.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="4aec1-173">En períodos de inactividad, se agrega una entrada ficticia a la tabla cdc.lsn_time_mapping para marcar el hecho de que el proceso de captura ha procesado los cambios hasta una hora de confirmación establecida.</span><span class="sxs-lookup"><span data-stu-id="4aec1-173">In periods of inactivity, a dummy entry is added to the table cdc.lsn_time_mapping to mark the fact that the capture process has processed the changes up to a given commit time.</span></span> <span data-ttu-id="4aec1-174">De este modo, impide que parezca que el proceso de captura se ha retrasado cuando lo que ocurre es que simplemente no hay cambios que procesar.</span><span class="sxs-lookup"><span data-stu-id="4aec1-174">This prevents it from appearing that the capture process has fallen behind when there are simply no recent changes to process.</span></span>  
  
 <span data-ttu-id="4aec1-175">En la plantilla para enumerar todos los cambios hasta este momento se muestra cómo se utiliza la estrategia anterior para consultar los datos modificados.</span><span class="sxs-lookup"><span data-stu-id="4aec1-175">The template Enumerate All Changes Up Until Now demonstrates how to use the previous strategy to query for change data.</span></span>  
  
### <a name="adding-a-commit-time-to-an-all-changes-result-set"></a><span data-ttu-id="4aec1-176">Agregar una hora de confirmación a todos los cambios de un conjunto de resultados</span><span class="sxs-lookup"><span data-stu-id="4aec1-176">Adding a Commit Time to an All Changes Result Set</span></span>  
 <span data-ttu-id="4aec1-177">La hora de confirmación de cada transacción con una entrada asociada en una tabla de cambios de base de datos está disponible en la tabla [cdc.lsn_time_mapping](/sql/relational-databases/system-tables/cdc-lsn-time-mapping-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="4aec1-177">The commit time of each transaction with an associated entry in a database change table is available in the table [cdc.lsn_time_mapping](/sql/relational-databases/system-tables/cdc-lsn-time-mapping-transact-sql).</span></span> <span data-ttu-id="4aec1-178">Al unir el valor __$start_lsn devuelto en una solicitud de todos los cambios con el valor start_lsn de una entrada de la tabla cdc.lsn_time_mapping, puede devolver tran_end_time junto con los datos modificados para marcar el cambio con la hora de confirmación de la transacción en el origen.</span><span class="sxs-lookup"><span data-stu-id="4aec1-178">By joining the __$start_lsn value returned in a request for all changes with the start_lsn value of a cdc.lsn_time_mapping table entry, you can return the tran_end_time along with the change data to stamp the change with the commit time of the transaction at the source.</span></span> <span data-ttu-id="4aec1-179">En la plantilla para anexar una hora de confirmación a todos los cambios del conjunto de resultados se muestra cómo se realiza esta unión.</span><span class="sxs-lookup"><span data-stu-id="4aec1-179">The template Append Commit Time to All Changes Result Set demonstrates how to perform this join.</span></span>  
  
### <a name="joining-change-data-with-other-data-from-the-same-transaction"></a><span data-ttu-id="4aec1-180">Unir los datos modificados con otros datos de la misma transacción</span><span class="sxs-lookup"><span data-stu-id="4aec1-180">Joining Change Data with Other Data from the Same Transaction</span></span>  
 <span data-ttu-id="4aec1-181">En ocasiones, resulta útil unir los datos modificados con otra información recopilada sobre la transacción cuando se confirma en el origen.</span><span class="sxs-lookup"><span data-stu-id="4aec1-181">Occasionally, it is useful to join change data with other information gathered about the transaction when it committed at the source.</span></span> <span data-ttu-id="4aec1-182">En la columna tran_begin_lsn de la tabla cdc.lsn_time_mapping se proporciona la información necesaria para realizar este tipo de unión.</span><span class="sxs-lookup"><span data-stu-id="4aec1-182">The tran_begin_lsn column in the table cdc.lsn_time_mapping provides the information needed to perform such a join.</span></span> <span data-ttu-id="4aec1-183">Cuando se produce la actualización del origen, el valor de database_transaction_begin_lsn procedente de la vista dinámica del sistema [sys.dm_tran_database_transactions](/sql/relational-databases/system-dynamic-management-views/sys-dm-tran-database-transactions-transact-sql) debe guardarse junto con cualquier otra información que se vaya a unir a los datos modificados.</span><span class="sxs-lookup"><span data-stu-id="4aec1-183">When the update of the source occurs, the value for database_transaction_begin_lsn from the system dynamic view [sys.dm_tran_database_transactions](/sql/relational-databases/system-dynamic-management-views/sys-dm-tran-database-transactions-transact-sql) must be saved along with any other information to be joined with the change data.</span></span> <span data-ttu-id="4aec1-184">Utilice la función fn_convertnumericlsntobinary para comparar los valores database_transaction_begin_lsn y tran_begin_lsn.</span><span class="sxs-lookup"><span data-stu-id="4aec1-184">Use the function fn_convertnumericlsntobinary to compare the database_transaction_begin_lsn and tran_begin_lsn values.</span></span> <span data-ttu-id="4aec1-185">El código para generar esta función está disponible en la plantilla para la creación de la función fn_convertnumericlsntobinary.</span><span class="sxs-lookup"><span data-stu-id="4aec1-185">The code to create this function is available in the template Create Function fn_convertnumericlsntobinary.</span></span> <span data-ttu-id="4aec1-186">En la plantilla para devolver todos los cambios con un determinado valor tran_begin_lsn se muestra cómo se efectúa la unión.</span><span class="sxs-lookup"><span data-stu-id="4aec1-186">The template Return All Changes with a Given tran_begin_lsn demonstrates how to effect the join.</span></span>  
  
### <a name="querying-using-datetime-wrapper-functions"></a><span data-ttu-id="4aec1-187">Realizar consultas con funciones contenedoras de fecha y hora</span><span class="sxs-lookup"><span data-stu-id="4aec1-187">Querying Using Datetime Wrapper Functions</span></span>  
 <span data-ttu-id="4aec1-188">Un escenario de aplicación común para consultar los datos modificados consiste en solicitar periódicamente los datos modificados a través de una ventana deslizante enlazada a valores de fecha y hora.</span><span class="sxs-lookup"><span data-stu-id="4aec1-188">A typical application scenario for querying for change data is to periodically request change data by using a sliding window bounded by datetime values.</span></span> <span data-ttu-id="4aec1-189">En esta clase de consumidores, la captura de datos modificados proporciona el procedimiento almacenado [sys.sp_cdc_generate_wrapper_function](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-generate-wrapper-function-transact-sql) que genera scripts para crear funciones contenedoras personalizadas para las funciones de consulta de captura de datos modificados.</span><span class="sxs-lookup"><span data-stu-id="4aec1-189">For this class of consumers, change data capture provides the stored procedure [sys.sp_cdc_generate_wrapper_function](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-generate-wrapper-function-transact-sql) that generates scripts to create custom wrapper functions for the change data capture query functions.</span></span> <span data-ttu-id="4aec1-190">Estos contenedores personalizados permiten que el intervalo de la consulta se exprese como un par de fecha y hora.</span><span class="sxs-lookup"><span data-stu-id="4aec1-190">These custom wrappers allow the query interval to be expressed as a datetime pair.</span></span>  
  
 <span data-ttu-id="4aec1-191">Al llamar a las opciones del procedimiento almacenado, pueden generarse los contenedores de todas las instancias de captura a las que el autor de la llamada tiene acceso o solo de una instancia de captura determinada.</span><span class="sxs-lookup"><span data-stu-id="4aec1-191">Calling options for the stored procedure allow for wrappers to be generated for all capture instances that the caller has access to, or only a specified capture instance.</span></span> <span data-ttu-id="4aec1-192">Entre las opciones admitidas también se incluye la capacidad de especificar si el extremo superior del intervalo de captura debe estar abierto o cerrado, cuáles de las columnas capturadas disponibles deben incluirse en el conjunto de resultados y cuáles de las columnas incluidas deben asociarse a marcas de actualización.</span><span class="sxs-lookup"><span data-stu-id="4aec1-192">Supported options also include the ability to specify whether the high end-point of the capture interval should be open or closed, which of the available captured columns should be included in the result set and which of the included columns should have associated update flags.</span></span> <span data-ttu-id="4aec1-193">El procedimiento devuelve un conjunto de resultados con dos columnas: el nombre de la función generada, que se deriva del nombre de la instancia de captura, y la instrucción CREATE del procedimiento almacenado del contenedor.</span><span class="sxs-lookup"><span data-stu-id="4aec1-193">The procedure returns a result set with two columns: the generated function name, which is derivable from the capture instance name, and the create statement for the wrapper stored procedure.</span></span> <span data-ttu-id="4aec1-194">La función que va a contener la consulta de todos los cambios siempre se genera.</span><span class="sxs-lookup"><span data-stu-id="4aec1-194">The function to wrap the all changes query is always generated.</span></span> <span data-ttu-id="4aec1-195">Si el parámetro @supports_net_changes se ha definido al crear la instancia de captura, también se genera la función que va a contener los cambios netos.</span><span class="sxs-lookup"><span data-stu-id="4aec1-195">If the @supports_net_changes parameter was set when the capture instance was created, the function to wrap the net changes function is also generated.</span></span>  
  
 <span data-ttu-id="4aec1-196">Es responsabilidad del diseñador de la aplicación llamar al procedimiento almacenado de generación de scripts para generar las instrucciones CREATE de los procedimientos almacenados del contenedor y ejecutar los scripts CREATE resultantes para generar las funciones.</span><span class="sxs-lookup"><span data-stu-id="4aec1-196">It is the responsibility of the application designer to call the script generation stored procedure to generate the create statements for the wrapper stored procedures, and to execute the resulting create scripts to create the functions.</span></span> <span data-ttu-id="4aec1-197">Esto no se produce automáticamente cuando se crea una instancia de captura.</span><span class="sxs-lookup"><span data-stu-id="4aec1-197">This does not occur automatically when a capture instance is created.</span></span>  
  
 <span data-ttu-id="4aec1-198">El usuario es el propietario de los contenedores de fecha y hora, que no se crean en el esquema predeterminado del autor de la llamada.</span><span class="sxs-lookup"><span data-stu-id="4aec1-198">Datetime wrappers are owned by the user, and not are created in the default schema of the caller.</span></span> <span data-ttu-id="4aec1-199">La función generada resulta conveniente sin modificaciones para la mayoría de los usuarios.</span><span class="sxs-lookup"><span data-stu-id="4aec1-199">The generated function is suitable without modification for most users.</span></span> <span data-ttu-id="4aec1-200">No obstante, siempre puede aplicarse alguna personalización más extensa al script generado antes de crear la función.</span><span class="sxs-lookup"><span data-stu-id="4aec1-200">However, further customization can always be applied to the generated script prior to creating the function.</span></span>  
  
 <span data-ttu-id="4aec1-201">El nombre de la función que va a contener la consulta de todos los cambios es fn_all_changes_ seguido del nombre de la instancia de captura.</span><span class="sxs-lookup"><span data-stu-id="4aec1-201">The name of the function to wrap the all changes query is fn_all_changes_ followed by the capture instance name.</span></span> <span data-ttu-id="4aec1-202">El prefijo que se utiliza para el contenedor de los cambios netos es fn_net_changes_.</span><span class="sxs-lookup"><span data-stu-id="4aec1-202">The prefix that is used for the net changes wrapper is fn_net_changes_.</span></span> <span data-ttu-id="4aec1-203">Las dos funciones toman tres argumentos, al igual que sus TVF de captura de cambios modificados.</span><span class="sxs-lookup"><span data-stu-id="4aec1-203">Both functions take three arguments, just as their associated change data capture TVFs do.</span></span> <span data-ttu-id="4aec1-204">Sin embargo, el intervalo de la consulta de los contenedores está limitado por dos valores de fecha y hora y no por dos valores LSN.</span><span class="sxs-lookup"><span data-stu-id="4aec1-204">However, the query interval for the wrappers is bounded by two datetime values instead of than by two LSN values.</span></span> <span data-ttu-id="4aec1-205">El parámetro @row_filter_option es el mismo para los dos conjuntos de funciones.</span><span class="sxs-lookup"><span data-stu-id="4aec1-205">The @row_filter_option parameter for both sets of functions are the same.</span></span>  
  
 <span data-ttu-id="4aec1-206">Las funciones contenedoras generadas admiten la siguiente convención para recorrer de forma sistemática la escala de tiempo de captura de datos modificados: se espera que el parámetro @end_time del intervalo anterior se use como parámetro @start_time del intervalo siguiente.</span><span class="sxs-lookup"><span data-stu-id="4aec1-206">The generated wrapper functions support the following convention for systematically walking the change data capture timeline: It is expected that the @end_time parameter of the previous interval be used as the @start_time parameter of the subsequent interval.</span></span> <span data-ttu-id="4aec1-207">La función contenedora se encarga de asignar los valores de fecha y hora a los valores LSN y se asegura de que no se pierde ni se repite ningún dato si se sigue esta convención.</span><span class="sxs-lookup"><span data-stu-id="4aec1-207">The wrapper function takes care of mapping the datetime values to LSN values and ensuring that no data is lost or repeated if this convention is followed.</span></span>  
  
 <span data-ttu-id="4aec1-208">Los contenedores se pueden generar para admitir un límite superior cerrado o un límite superior abierto en la ventana de consulta especificada.</span><span class="sxs-lookup"><span data-stu-id="4aec1-208">The wrappers can be generated to support either a closed upper bound or an open upper bound on the specified query window.</span></span> <span data-ttu-id="4aec1-209">Es decir, al autor de la llamada puede especificar si las entradas que tienen un tiempo de confirmación igual al límite superior del intervalo de extracción se van a incluir en el intervalo.</span><span class="sxs-lookup"><span data-stu-id="4aec1-209">That is, the caller can specify whether entries having a commit time equal to the upper bound of the extraction interval are to be included within the interval.</span></span> <span data-ttu-id="4aec1-210">De forma predeterminada, se incluye el límite superior.</span><span class="sxs-lookup"><span data-stu-id="4aec1-210">By default, the upper bound is included.</span></span>  
  
 <span data-ttu-id="4aec1-211">Aunque se produzca un error en las TVF de consulta generadas si se proporciona un valor NULL para los valores @from_lsn o @to_lsn, las funciones contenedores de fecha y hora usan el valor NULL para permitir que los contenedores de fecha y hora devuelvan todos los cambios actuales.</span><span class="sxs-lookup"><span data-stu-id="4aec1-211">While the generated query TVFs fail if supplied a null value for either the @from_lsn value or the @to_lsn value, the datetime wrapper functions use null to allow the datetime wrappers to return all current changes.</span></span> <span data-ttu-id="4aec1-212">Es decir, si se pasa un valor NULL como extremo inferior de la ventana de consulta para el contenedor de fecha y hora, el extremo inferior del intervalo de validez de la instancia de captura se utiliza en la instrucción SELECT subyacente que se aplica a la TVF de consulta.</span><span class="sxs-lookup"><span data-stu-id="4aec1-212">That is, if null is passed as the low end-point of the query window to the datetime wrapper, the low end point of the capture instance validity interval is used in the underlying SELECT statement that is applied to the query TVF.</span></span> <span data-ttu-id="4aec1-213">Del mismo modo, si se pasa un valor NULL como extremo superior de la ventana de consulta, el extremo superior del intervalo de validez de la instancia de captura se utiliza al realizar la selección en la TVF de consulta.</span><span class="sxs-lookup"><span data-stu-id="4aec1-213">Similarly, if null is passed as the high end-point of the query window, the high end-point of the capture instance validity interval is used when selecting from the query TVF.</span></span>  
  
 <span data-ttu-id="4aec1-214">El conjunto de resultados devuelto por una función contenedora incluye todas las columnas solicitadas seguidas por una columna de operación, que se codifica de nuevo como uno o dos caracteres para identificar la operación que está asociada a la fila.</span><span class="sxs-lookup"><span data-stu-id="4aec1-214">The result set returned by a wrapper function includes all the requested columns followed by an operation column, recoded as one or two characters to identify the operation that is associated with the row.</span></span> <span data-ttu-id="4aec1-215">Si las marcas de actualización se han solicitado, aparecen como columnas de bits después del código de operación en el orden especificado en el parámetro @update_flag_list.</span><span class="sxs-lookup"><span data-stu-id="4aec1-215">If update flags have been requested, they appear as bit columns after the operation code, in the order specified in the @update_flag_list parameter.</span></span> <span data-ttu-id="4aec1-216">Para obtener información sobre la llamada de opciones para personalizar los contenedores de fecha y hora generados, vea [sys.sp_cdc_generate_wrapper_function &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-generate-wrapper-function-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="4aec1-216">For information about the calling options for customizing the generated datetime wrappers, see [sys.sp_cdc_generate_wrapper_function &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-generate-wrapper-function-transact-sql).</span></span>  
  
 <span data-ttu-id="4aec1-217">En la plantilla para la creación de instancias de una TVF contenedora con una marca de actualización, se muestra cómo se personaliza una función contenedora para anexar una marca de actualización de una determinada columna al conjunto de resultados devuelto por una consulta de cambios netos.</span><span class="sxs-lookup"><span data-stu-id="4aec1-217">The template Instantiate a Wrapper TVF With Update Flag shows how to customize a generated wrapper function to append an update flag for a specified column to the result set returned by a net changes query.</span></span> <span data-ttu-id="4aec1-218">En la plantilla para la creación de instancias de TVF contenedoras de CDC para un esquema, se muestra cómo se crean instancias de los contenedores de fecha y hora para las TVF de consulta de todas las instancias de captura creadas para las tablas de origen en un esquema de la base de datos específico.</span><span class="sxs-lookup"><span data-stu-id="4aec1-218">The template Instantiate CDC Wrapper TVFs for a Schema shows how to instantiate the Datetime Wrappers for the Query TVFs for all of the capture instances created for the source tables in a given database schema.</span></span>  
  
 <span data-ttu-id="4aec1-219">Para obtener un ejemplo en el que se utiliza un contenedor de fecha y hora para consultar los datos modificados, vea la plantilla para la obtención de cambios netos utilizando un contenedor con marcas de actualización.</span><span class="sxs-lookup"><span data-stu-id="4aec1-219">For an example that uses a datetime wrapper to query for change data, see the template Get Net Changes Using Wrapper With Update Flags.</span></span> <span data-ttu-id="4aec1-220">En esta plantilla se muestra cómo se consultan los cambios netos con una función contenedora cuando el contenedor está configurado para devolver marcas de actualización.</span><span class="sxs-lookup"><span data-stu-id="4aec1-220">This template demonstrates how to query for net changes with a wrapper function when the wrapper is configured to return update flags.</span></span> <span data-ttu-id="4aec1-221">Tenga en cuenta que la opción de filtro de filas 'all with mask' es necesaria para que la función de consulta subyacente devuelva una máscara de actualización que no sea NULL.</span><span class="sxs-lookup"><span data-stu-id="4aec1-221">Note that the row filter option 'all with mask' is required for the underlying query function to return a non-null update mask on update.</span></span> <span data-ttu-id="4aec1-222">Los valores NULL se pasan para los límites inferior y superior del intervalo de fecha y hora con el fin de señalar la función que va a utilizar los extremos inferior y superior del intervalo de validez de la instancia de captura cuando realice la consulta basada en LSN subyacente.</span><span class="sxs-lookup"><span data-stu-id="4aec1-222">Null values are passed for both the lower and upper datetime interval boundaries to signal the function to use the low end point and the high end point of the validity interval for the capture instance when performing the underlying LSN based query.</span></span> <span data-ttu-id="4aec1-223">La consulta devuelve una fila por cada modificación de una fila de origen que se produjo en el intervalo válido de la instancia de captura.</span><span class="sxs-lookup"><span data-stu-id="4aec1-223">The query returns one row for each modification to a source row that occurred within the valid range for the capture instance.</span></span>  
  
### <a name="using-the-datetime-wrapper-functions-to-transition-between-capture-instances"></a><span data-ttu-id="4aec1-224">Utilizar las funciones contenedoras de fecha y hora en transiciones entre instancias de captura</span><span class="sxs-lookup"><span data-stu-id="4aec1-224">Using the Datetime Wrapper Functions to Transition Between Capture Instances</span></span>  
 <span data-ttu-id="4aec1-225">La captura de datos modificados admite un máximo de dos instancias de captura para una única tabla de origen sometida a seguimiento.</span><span class="sxs-lookup"><span data-stu-id="4aec1-225">Change data capture supports up to two capture instances for a single tracked source table.</span></span> <span data-ttu-id="4aec1-226">El uso principal de esta capacidad consiste en alojar una transición entre varias instancias de captura cuando los cambios del lenguaje de definición de datos (DDL) efectuados en la tabla de origen amplían el conjunto de columnas disponibles para llevar a cabo el seguimiento.</span><span class="sxs-lookup"><span data-stu-id="4aec1-226">The principal use of this capability is to accommodate a transition between multiple capture instances when data definition language (DDL) changes to the source table expand the set of available columns for tracking.</span></span> <span data-ttu-id="4aec1-227">Cuando la transición se realiza a una nueva instancia de captura, un modo de proteger los niveles superiores de la aplicación para que no se produzcan cambios en los nombres de las funciones de consulta subyacentes consiste en utilizar una función contenedora que incluya la llamada subyacente.</span><span class="sxs-lookup"><span data-stu-id="4aec1-227">When transitioning to a new capture instance, one way to protect higher application levels from changes in the names of the underlying query functions is to use a wrapper function to wrap the underlying call.</span></span> <span data-ttu-id="4aec1-228">A continuación, asegúrese de que el nombre de la función contenedora sigue siendo el mismo.</span><span class="sxs-lookup"><span data-stu-id="4aec1-228">Then, ensure that the name of the wrapper function remains the same.</span></span> <span data-ttu-id="4aec1-229">Cuando vaya a producirse el cambio, la función contenedora antigua se puede quitar, pues se crea una nueva con el mismo nombre que hace referencia a las nuevas funciones de consulta.</span><span class="sxs-lookup"><span data-stu-id="4aec1-229">When the switch is to occur, the old wrapper function can be dropped, and a new one with the same name created that references the new query functions.</span></span> <span data-ttu-id="4aec1-230">Al modificar primero el script generado para crear una función contenedora con el mismo nombre, puede hacer el cambio a la nueva instancia de captura sin que esto afecte a los niveles superiores de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="4aec1-230">By first modifying the generated script to create a wrapper function of the same name, you can make the switch to a new capture instance without affecting higher application layers.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4aec1-231">Consulte también</span><span class="sxs-lookup"><span data-stu-id="4aec1-231">See Also</span></span>  
 <span data-ttu-id="4aec1-232">[Seguimiento de cambios de datos &#40;SQL Server&#41;](../track-changes/track-data-changes-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="4aec1-232">[Track Data Changes &#40;SQL Server&#41;](../track-changes/track-data-changes-sql-server.md) </span></span>  
 <span data-ttu-id="4aec1-233">[Acerca de la captura de datos modificados &#40;SQL Server&#41;](../track-changes/about-change-data-capture-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="4aec1-233">[About Change Data Capture &#40;SQL Server&#41;](../track-changes/about-change-data-capture-sql-server.md) </span></span>  
 <span data-ttu-id="4aec1-234">[Habilitar y deshabilitar la captura de datos modificados &#40;SQL Server&#41;](../track-changes/enable-and-disable-change-data-capture-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="4aec1-234">[Enable and Disable Change Data Capture &#40;SQL Server&#41;](../track-changes/enable-and-disable-change-data-capture-sql-server.md) </span></span>  
 [<span data-ttu-id="4aec1-235">Administrar y supervisar la captura de datos modificados &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="4aec1-235">Administer and Monitor Change Data Capture &#40;SQL Server&#41;</span></span>](../track-changes/administer-and-monitor-change-data-capture-sql-server.md)  
  
  
