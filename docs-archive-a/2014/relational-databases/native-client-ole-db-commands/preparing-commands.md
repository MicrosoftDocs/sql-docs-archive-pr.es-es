---
title: Preparar comandos | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- SQL Server Native Client OLE DB provider, commands
- prepared statements [SQL Server Native Client]
- commands [OLE DB]
- command preparation [SQL Server Native Client]
ms.assetid: 09ec0c6c-0a44-4766-b9b7-5092f676ee54
author: rothja
ms.author: jroth
ms.openlocfilehash: e06e6afab622953452a00751e3a55d49fc7b8ec7
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87744696"
---
# <a name="preparing-commands"></a><span data-ttu-id="467bf-102">Preparar comandos</span><span class="sxs-lookup"><span data-stu-id="467bf-102">Preparing Commands</span></span>
  <span data-ttu-id="467bf-103">El proveedor OLE DB de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client admite la preparación de comandos para la ejecución múltiple y optimizada de un único comando; sin embargo, la preparación de comandos genera una sobrecarga, y no es necesario que un consumidor prepare un comando para ejecutarlo más de una vez.</span><span class="sxs-lookup"><span data-stu-id="467bf-103">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports command preparation for optimized multiple execution of a single command; however, command preparation generates overhead, and a consumer does not need to prepare a command to execute it more than once.</span></span> <span data-ttu-id="467bf-104">En general, un comando debería prepararse si va a ejecutarse más de tres veces.</span><span class="sxs-lookup"><span data-stu-id="467bf-104">In general, a command should be prepared if it will be executed more than three times.</span></span>  
  
 <span data-ttu-id="467bf-105">Por razones de rendimiento, la preparación del comando se difiere hasta que se ejecuta el comando.</span><span class="sxs-lookup"><span data-stu-id="467bf-105">For performance reasons, the command preparation is deferred until the command is executed.</span></span> <span data-ttu-id="467bf-106">Este es el comportamiento predeterminado.</span><span class="sxs-lookup"><span data-stu-id="467bf-106">This is the default behavior.</span></span> <span data-ttu-id="467bf-107">Cualquier error que se produzca en el comando que se está preparando no se dará a conocer hasta que el comando se ejecute o hasta que se realice una operación de metapropiedad.</span><span class="sxs-lookup"><span data-stu-id="467bf-107">Any errors in the command being prepared are not known until the command is executed or a metaproperty operation is performed.</span></span> <span data-ttu-id="467bf-108">Establecer la propiedad SSPROP_DEFERPREPARE de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] en FALSE puede desactivar este comportamiento predeterminado.</span><span class="sxs-lookup"><span data-stu-id="467bf-108">Setting the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] property SSPROP_DEFERPREPARE to FALSE can turn off this default behavior.</span></span>  
  
 <span data-ttu-id="467bf-109">En [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], cuando un comando se ejecuta directamente (sin prepararlo antes), se crea un plan de ejecución y se almacena en la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="467bf-109">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], when a command is executed directly (without preparing it first), an execution plan is created and cached.</span></span> <span data-ttu-id="467bf-110">Si vuelve a ejecutarse la instrucción SQL, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] dispone de un algoritmo eficaz para hacer coincidir la nueva instrucción con el plan de ejecución existente en la memoria caché, y reutiliza el plan de ejecución para esa instrucción.</span><span class="sxs-lookup"><span data-stu-id="467bf-110">If the SQL statement is executed again, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] has an efficient algorithm to match the new statement with the existing execution plan in the cache, and reuses the execution plan for that statement.</span></span>  
  
 <span data-ttu-id="467bf-111">En el caso de los comandos preparados, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] proporciona compatibilidad nativa para preparar y ejecutar instrucciones de comandos.</span><span class="sxs-lookup"><span data-stu-id="467bf-111">For prepared commands, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] provides native support for preparing and executing command statements.</span></span> <span data-ttu-id="467bf-112">Cuando se prepara una instrucción, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] crea un plan de ejecución, lo almacena en la memoria caché y devuelve un identificador a este plan de ejecución al proveedor.</span><span class="sxs-lookup"><span data-stu-id="467bf-112">When you prepare a statement, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] creates an execution plan, caches it, and returns a handle to this execution plan to the provider.</span></span> <span data-ttu-id="467bf-113">A continuación, el proveedor utiliza este identificador para ejecutar repetidamente la instrucción.</span><span class="sxs-lookup"><span data-stu-id="467bf-113">The provider then uses this handle to execute the statement repeatedly.</span></span> <span data-ttu-id="467bf-114">No se crea ningún procedimiento almacenado.</span><span class="sxs-lookup"><span data-stu-id="467bf-114">No stored procedures are created.</span></span> <span data-ttu-id="467bf-115">Dado que el identificador identifica directamente el plan de ejecución de una instrucción SQL en lugar de hacer coincidir la instrucción con el plan de ejecución de la memoria caché (como ocurre con la ejecución directa), resulta más eficaz preparar una instrucción que ejecutarla directamente, si sabe que la instrucción se ejecutará bastantes veces.</span><span class="sxs-lookup"><span data-stu-id="467bf-115">Because the handle directly identifies the execution plan for an SQL statement instead of matching the statement to the execution plan in the cache (as is the case for direct execution), it is more efficient to prepare a statement than to execute it directly, if you know the statement will be executed more than a few times.</span></span>  
  
 <span data-ttu-id="467bf-116">En [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)], las instrucciones preparadas no pueden utilizarse para crear objetos temporales ni pueden hacer referencia a procedimientos almacenados del sistema que crean objetos temporales, como tablas temporales.</span><span class="sxs-lookup"><span data-stu-id="467bf-116">In [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)], the prepared statements cannot be used to create temporary objects and cannot reference system stored procedures that create temporary objects, such as temporary tables.</span></span> <span data-ttu-id="467bf-117">Estos procedimientos deben ejecutarse directamente.</span><span class="sxs-lookup"><span data-stu-id="467bf-117">These procedures must be executed directly.</span></span>  
  
 <span data-ttu-id="467bf-118">Algunos comandos no deberían prepararse nunca.</span><span class="sxs-lookup"><span data-stu-id="467bf-118">Some commands should never be prepared.</span></span> <span data-ttu-id="467bf-119">Por ejemplo, no deberían prepararse nunca los comandos que especifican la ejecución de procedimientos almacenados o los comandos que incluyen texto que no es válido para la creación de procedimientos almacenados de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="467bf-119">For example, commands that specify stored procedure execution or include invalid text for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] stored procedure creation should not be prepared.</span></span>  
  
 <span data-ttu-id="467bf-120">Si se crea un procedimiento almacenado temporal, el proveedor OLE DB de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client lo ejecuta y devuelve los resultados como si se hubiera ejecutado la propia instrucción.</span><span class="sxs-lookup"><span data-stu-id="467bf-120">If a temporary stored procedure is created, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider executes the temporary stored procedure, returning results as if the statement itself was executed.</span></span>  
  
 <span data-ttu-id="467bf-121">La propiedad de inicialización SSPROP_INIT_USEPROCFORPREP específica del proveedor OLE DB de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client controla la creación del procedimiento almacenado temporal.</span><span class="sxs-lookup"><span data-stu-id="467bf-121">Temporary stored procedure creation is controlled by the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider -specific initialization property SSPROP_INIT_USEPROCFORPREP.</span></span> <span data-ttu-id="467bf-122">Si el valor de la propiedad es SSPROPVAL_USEPROCFORPREP_ON o SSPROPVAL_USEPROCFORPREP_ON_DROP, el proveedor OLE DB de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client intenta crear un procedimiento almacenado cuando se prepara un comando.</span><span class="sxs-lookup"><span data-stu-id="467bf-122">If the property value is either SSPROPVAL_USEPROCFORPREP_ON or SSPROPVAL_USEPROCFORPREP_ON_DROP, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider attempts to create a stored procedure when a command is prepared.</span></span> <span data-ttu-id="467bf-123">La creación del procedimiento almacenado se realiza correctamente si el usuario de la aplicación tiene suficientes permisos de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="467bf-123">Stored procedure creation succeeds if the application user has sufficient [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] permissions.</span></span>  
  
 <span data-ttu-id="467bf-124">En el caso de los consumidores que se desconectan con poca frecuencia, la creación de procedimientos almacenados temporales puede requerir recursos significativos de **tempdb**, la base de datos del sistema de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] en la que se crean los objetos temporales.</span><span class="sxs-lookup"><span data-stu-id="467bf-124">For consumers that infrequently disconnect, creation of temporary stored procedures can require significant resources of **tempdb**, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] system database in which temporary objects are created.</span></span> <span data-ttu-id="467bf-125">Si el valor de SSPROP_INIT_USEPROCFORPREP es SSPROPVAL_USEPROCFORPREP_ ON, los procedimientos almacenados temporales creados por el proveedor OLE DB de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client solamente se quitan cuando la sesión que creó el comando pierde su conexión con la instancia de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="467bf-125">When the value of SSPROP_INIT_USEPROCFORPREP is SSPROPVAL_USEPROCFORPREP_ ON, temporary stored procedures created by the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider are dropped only when the session that created the command loses its connection to the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="467bf-126">Si esa conexión es la conexión predeterminada creada durante la inicialización del origen de datos, el procedimiento almacenado temporal solamente se quita cuando se cancela la inicialización del origen de datos.</span><span class="sxs-lookup"><span data-stu-id="467bf-126">If that connection is the default connection created on data source initialization, the temporary stored procedure is dropped only when the data source becomes uninitialized.</span></span>  
  
 <span data-ttu-id="467bf-127">Si el valor de SSPROP_INIT_USEPROCFORPREP es SSPROPVAL_USEPROCFORPREP_ON_DROP, los procedimientos almacenados temporales del proveedor OLE DB de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client se quitan cuando ocurre una de estas cosas:</span><span class="sxs-lookup"><span data-stu-id="467bf-127">When the value of SSPROP_INIT_USEPROCFORPREP is SSPROPVAL_USEPROCFORPREP_ON_DROP, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider temporary stored procedures are dropped when one of the following occurs:</span></span>  
  
-   <span data-ttu-id="467bf-128">El consumidor usa **ICommandText::SetCommandText** para indicar un nuevo comando.</span><span class="sxs-lookup"><span data-stu-id="467bf-128">The consumer uses **ICommandText::SetCommandText** to indicate a new command.</span></span>  
  
-   <span data-ttu-id="467bf-129">El consumidor usa **ICommandPrepare::Unprepare** para indicar que ya no requiere el texto del comando.</span><span class="sxs-lookup"><span data-stu-id="467bf-129">The consumer uses **ICommandPrepare::Unprepare** to indicate that it no longer requires the command text.</span></span>  
  
-   <span data-ttu-id="467bf-130">El consumidor libera todas las referencias al objeto de comando utilizando el procedimiento almacenado temporal.</span><span class="sxs-lookup"><span data-stu-id="467bf-130">The consumer releases all references to the command object using the temporary stored procedure.</span></span>  
  
 <span data-ttu-id="467bf-131">Un objeto de comando tiene a lo sumo un procedimiento almacenado temporal en **tempdb**.</span><span class="sxs-lookup"><span data-stu-id="467bf-131">A command object has at most one temporary stored procedure in **tempdb**.</span></span> <span data-ttu-id="467bf-132">Cualquier procedimiento almacenado temporal existente representa el texto de comando actual de un objeto de comando concreto.</span><span class="sxs-lookup"><span data-stu-id="467bf-132">Any existing temporary stored procedure represents the current command text of a specific command object.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="467bf-133">Consulte también</span><span class="sxs-lookup"><span data-stu-id="467bf-133">See Also</span></span>  
 [<span data-ttu-id="467bf-134">Comandos</span><span class="sxs-lookup"><span data-stu-id="467bf-134">Commands</span></span>](commands.md)  
  
  
