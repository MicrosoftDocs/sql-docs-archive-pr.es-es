---
title: Inserción de datos en parámetros con valores de tabla | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- table-valued parameters, inserting data into
ms.assetid: 9c1a3234-4675-40d3-b473-8df06208f880
author: rothja
ms.author: jroth
ms.openlocfilehash: 38e33c6e58bc2633591fa80e095ceafe46f67045
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87671030"
---
# <a name="inserting-data-into-table-valued-parameters"></a><span data-ttu-id="24a5a-102">Insertar datos en parámetros con valores de tabla</span><span class="sxs-lookup"><span data-stu-id="24a5a-102">Inserting Data into Table-Valued Parameters</span></span>
  <span data-ttu-id="24a5a-103">El [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] proveedor de OLE DB de Native Client admite dos modelos para que el consumidor especifique los datos de las filas de parámetros con valores de tabla: un modelo de inserción y un modelo de extracción.</span><span class="sxs-lookup"><span data-stu-id="24a5a-103">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider supports two models for the consumer to specify data for table valued parameter rows: a push model and a pull model.</span></span> <span data-ttu-id="24a5a-104">Hay disponible un ejemplo que muestra el modelo de extracción; vea [Ejemplos de programación de datos de SQL Server](https://msftdpprodsamples.codeplex.com/).</span><span class="sxs-lookup"><span data-stu-id="24a5a-104">A sample that demonstrates the pull model is available; see [SQL Server Data Programming Samples](https://msftdpprodsamples.codeplex.com/).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="24a5a-105">Una columna de parámetros con valores de tabla debe tener valores no predeterminados en todas las filas o valores predeterminados en todas las filas.</span><span class="sxs-lookup"><span data-stu-id="24a5a-105">A table-valued parameter column must have either non-default values in all rows or default values in all rows.</span></span> <span data-ttu-id="24a5a-106">No es posible tener valores predeterminados en algunas filas y en otras no.</span><span class="sxs-lookup"><span data-stu-id="24a5a-106">It is not possible to have default values in some rows but not others.</span></span> <span data-ttu-id="24a5a-107">Por lo tanto, en enlaces de parámetros con valores de tabla, los únicos valores de estado permitidos en datos de columnas de conjunto de filas de parámetros con valores de tabla son DBSTATUS_S_ISNULL y DBSTATUS_S_OK.</span><span class="sxs-lookup"><span data-stu-id="24a5a-107">Therefore, in table-valued parameter bindings, the only status values allowed for table-valued parameter rowset column data are DBSTATUS_S_ISNULL and DBSTATUS_S_OK.</span></span> <span data-ttu-id="24a5a-108">DBSTATUS_S_DEFAULT generará un error y el valor de estado enlazado se establecerá en DBSTATUS_E_BADSTATUS.</span><span class="sxs-lookup"><span data-stu-id="24a5a-108">DBSTATUS_S_DEFAULT will result in a failure and the bound status value will be set to DBSTATUS_E_BADSTATUS.</span></span>  
  
## <a name="push-model-loads-all-table-valued-paremeter-data-in-memory"></a><span data-ttu-id="24a5a-109">Modelo de inserción (carga todos los datos de parámetros con valores de tabla en memoria)</span><span class="sxs-lookup"><span data-stu-id="24a5a-109">Push Model (Loads All Table-Valued Paremeter Data in Memory)</span></span>  
 <span data-ttu-id="24a5a-110">El modelo de inserción es similar al uso de conjuntos de parámetros (es decir, el parámetro DBPARAMS de ICommand::Execute).</span><span class="sxs-lookup"><span data-stu-id="24a5a-110">The push model is similar to the use of parameter sets (that is, the DBPARAMS parameter in ICommand::Execute).</span></span> <span data-ttu-id="24a5a-111">El modelo de inserción solo se usa si los objetos de conjunto de filas de parámetros con valores de tabla se usan sin una implementación personalizada de las interfaces IRowset.</span><span class="sxs-lookup"><span data-stu-id="24a5a-111">The push model is only used if table-valued parameter rowset objects are used without a customized implementation of IRowset interfaces.</span></span> <span data-ttu-id="24a5a-112">Se recomienda usar el modelo de inserción cuando el número de filas del conjunto de filas de parámetros con valores de tabla sea pequeño y no se espere que vaya a haber un exceso de presión de memoria en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="24a5a-112">The push model is recommended when the number of rows in the table-valued parameter rowset is small and is not expected to put excessive memory pressure on the application.</span></span> <span data-ttu-id="24a5a-113">Este modelo es más sencillo que el modelo de extracción, ya que no requiere ninguna otra funcionalidad por parte de la aplicación del consumidor más que la actualmente común en aplicaciones OLE DB típicas.</span><span class="sxs-lookup"><span data-stu-id="24a5a-113">This is simpler than the pull model, because it does not require any more functionality from the consumer application than what is currently common in typical OLE DB applications.</span></span>  
  
 <span data-ttu-id="24a5a-114">Se espera que el consumidor proporcione todos los datos de parámetro con valores de tabla al proveedor antes de ejecutar un comando.</span><span class="sxs-lookup"><span data-stu-id="24a5a-114">The consumer is expected to provide all the table-valued parameter data to the provider before executing a command.</span></span> <span data-ttu-id="24a5a-115">Para proporcionar los datos, el consumidor rellena un objeto de conjunto de filas de parámetros con valores de tabla por cada parámetro con valores de tabla.</span><span class="sxs-lookup"><span data-stu-id="24a5a-115">To provide the data, the consumer populates a table-valued parameter rowset object for each table-valued parameter.</span></span> <span data-ttu-id="24a5a-116">El objeto de conjunto de filas de parámetro con valores de tabla expone las operaciones Insert, Set y Delete del conjunto de filas, que el consumidor usará para manipular los datos de parámetros con valores de tabla.</span><span class="sxs-lookup"><span data-stu-id="24a5a-116">The table-valued parameter rowset object exposes rowset Insert, Set, and Delete operations, which the consumer will use to manipulate the table-valued parameter data.</span></span> <span data-ttu-id="24a5a-117">El proveedor capturará los datos de este objeto de conjunto de filas de parámetros con valores de tabla en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="24a5a-117">The provider will fetch the data from this table-valued parameter rowset object at execution time.</span></span>  
  
 <span data-ttu-id="24a5a-118">Cuando se proporciona al consumidor un objeto de conjunto de filas de parámetros con valores de tabla, el consumidor puede procesarlo como un objeto de conjunto de filas.</span><span class="sxs-lookup"><span data-stu-id="24a5a-118">When a table-valued parameter rowset object is provided to the consumer, the consumer can process it as a rowset object.</span></span> <span data-ttu-id="24a5a-119">El consumidor puede obtener la información de tipo de cada columna (tipo, longitud máxima, precisión y escala) mediante el método de interfaz IColumnsInfo::GetColumnInfo o IColumnsRowset::GetColumnsRowset.</span><span class="sxs-lookup"><span data-stu-id="24a5a-119">The consumer can obtain the type information of each column (type, maximum length, precision, and scale) by using the IColumnsInfo::GetColumnInfo or IColumnsRowset::GetColumnsRowset interface method.</span></span> <span data-ttu-id="24a5a-120">A continuación, el consumidor crea un descriptor de acceso para especificar los enlaces de los datos.</span><span class="sxs-lookup"><span data-stu-id="24a5a-120">The consumer then creates an accessor to specify the bindings for the data.</span></span> <span data-ttu-id="24a5a-121">El paso siguiente consiste en insertar filas de datos en el conjunto de filas de parámetros con valores de tabla.</span><span class="sxs-lookup"><span data-stu-id="24a5a-121">The next step is to insert rows of data into the table-valued parameter rowset.</span></span> <span data-ttu-id="24a5a-122">Esto puede hacerse mediante IRowsetChange::InsertRow.</span><span class="sxs-lookup"><span data-stu-id="24a5a-122">This can be done by using IRowsetChange::InsertRow.</span></span> <span data-ttu-id="24a5a-123">IRowsetChange::SetData o IRowsetChange::DeleteRows también se pueden usar en el objeto de conjunto de filas de parámetros con valores de tabla si tiene que manipular los datos.</span><span class="sxs-lookup"><span data-stu-id="24a5a-123">IRowsetChange::SetData or IRowsetChange::DeleteRows can also be used on the table-valued parameter rowset object if you have to manipulate the data.</span></span> <span data-ttu-id="24a5a-124">Los objetos de conjunto de filas de parámetros con valores de tabla son objetos en los que se cuentan las referencias, similares a los objetos de flujo.</span><span class="sxs-lookup"><span data-stu-id="24a5a-124">Table-valued parameter rowset objects are reference counted, similar to stream objects.</span></span>  
  
 <span data-ttu-id="24a5a-125">Si se usa IColumnsRowset::GetColumnsRowset, habrá llamadas posteriores a los métodos IRowset::GetNextRows, IRowset::GetData y IRowset::ReleaseRows en el objeto de conjunto de filas de la columna resultante.</span><span class="sxs-lookup"><span data-stu-id="24a5a-125">If IColumnsRowset::GetColumnsRowset is used, there will be subsequent calls to IRowset::GetNextRows, IRowset::GetData, and IRowset::ReleaseRows methods on the rowset object of the resulting column.</span></span>  
  
 <span data-ttu-id="24a5a-126">Después de que el [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] proveedor de OLE DB de Native Client empiece a ejecutar el comando, los valores de parámetro con valores de tabla se capturarán de este objeto de conjunto de filas de parámetros con valores de tabla y se enviarán al servidor.</span><span class="sxs-lookup"><span data-stu-id="24a5a-126">After the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider begins executing the command, the table-valued parameter values will be fetched from this table-valued parameter rowset object and sent to the server.</span></span>  
  
 <span data-ttu-id="24a5a-127">El modelo de inserción requiere un trabajo mínimo por parte del consumidor pero usa más memoria que el modelo de extracción, porque todos los datos de parámetro con valores de tabla deben estar en memoria en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="24a5a-127">The push model requires minimal work by the consumer, but uses more memory than the pull model, because all the table-valued parameter data has to be in memory at execution time.</span></span>  
  
## <a name="pull-model-obtaining-table-valued-parameter-data-on-demand-from-the-consumer"></a><span data-ttu-id="24a5a-128">Modelo de extracción (obtener datos de parámetros con valores de tabla a petición del consumidor)</span><span class="sxs-lookup"><span data-stu-id="24a5a-128">Pull Model (Obtaining Table-Valued Parameter Data on Demand from the Consumer)</span></span>  
 <span data-ttu-id="24a5a-129">El modelo de extracción resulta útil en dos escenarios:</span><span class="sxs-lookup"><span data-stu-id="24a5a-129">The pull model is useful for two scenarios:</span></span>  
  
-   <span data-ttu-id="24a5a-130">Para transmitir filas por secuencias.</span><span class="sxs-lookup"><span data-stu-id="24a5a-130">To stream rows.</span></span>  
  
-   <span data-ttu-id="24a5a-131">Si se usa un conjunto de filas de otro proveedor como valor de parámetro con valores de tabla.</span><span class="sxs-lookup"><span data-stu-id="24a5a-131">If a rowset from another provider is being used as the table-valued parameter value.</span></span>  
  
 <span data-ttu-id="24a5a-132">En el modelo de extracción, el consumidor proporciona datos a petición al proveedor.</span><span class="sxs-lookup"><span data-stu-id="24a5a-132">In the pull model, the consumer provides data on demand to the provider.</span></span> <span data-ttu-id="24a5a-133">Use este enfoque si la aplicación tiene muchas inserciones de datos y los datos de conjunto de filas de parámetros con valores de tabla en memoria podrían dar lugar a un acceso excesivo a la memoria.</span><span class="sxs-lookup"><span data-stu-id="24a5a-133">Use this approach if your application has many data insertions, and table-valued parameter rowset data in memory would result in excessive memory access.</span></span> <span data-ttu-id="24a5a-134">Si se usan varios proveedores OLE DB, el modelo de extracción del consumidor permite que el consumidor proporcione cualquier objeto de conjunto de filas como valor de parámetro con valores de tabla.</span><span class="sxs-lookup"><span data-stu-id="24a5a-134">If multiple OLE DB providers are used, the consumer pull model enables the consumer to provide any rowset object as the table-valued parameter value.</span></span>  
  
 <span data-ttu-id="24a5a-135">Para usar el modelo de extracción, los consumidores deben proporcionar su propia implementación de un objeto de conjunto de filas.</span><span class="sxs-lookup"><span data-stu-id="24a5a-135">To use the pull model, consumers have to provide their own implementation of a rowset object.</span></span> <span data-ttu-id="24a5a-136">Al usar el modelo de extracción con conjuntos de filas de parámetros con valores de tabla (CLSID_ROWSET_TVP), el consumidor debe agregar el objeto de conjunto de filas de parámetros con valores de tabla que el proveedor expone mediante el método ITableDefinitionWithConstraints::CreateTableWithConstraints o el método IOpenRowset::OpenRowset.</span><span class="sxs-lookup"><span data-stu-id="24a5a-136">When using the pull model with table-valued parameter rowsets (CLSID_ROWSET_TVP), the consumer is required to aggregate the table-valued parameter rowset object that the provider exposes through the ITableDefinitionWithConstraints::CreateTableWithConstraints method or the IOpenRowset::OpenRowset method.</span></span> <span data-ttu-id="24a5a-137">Solo se espera que el objeto de consumidor invalide la implementación de la interfaz IRowset.</span><span class="sxs-lookup"><span data-stu-id="24a5a-137">The consumer object is only expected to override the IRowset interface implementation.</span></span> <span data-ttu-id="24a5a-138">Debe invalidar las funciones siguientes:</span><span class="sxs-lookup"><span data-stu-id="24a5a-138">You must override the following functions:</span></span>  
  
-   <span data-ttu-id="24a5a-139">IRowset::GetNextRows</span><span class="sxs-lookup"><span data-stu-id="24a5a-139">IRowset::GetNextRows</span></span>  
  
-   <span data-ttu-id="24a5a-140">IRowset::AddRefRows</span><span class="sxs-lookup"><span data-stu-id="24a5a-140">IRowset::AddRefRows</span></span>  
  
-   <span data-ttu-id="24a5a-141">IRowset::GetData</span><span class="sxs-lookup"><span data-stu-id="24a5a-141">IRowset::GetData</span></span>  
  
-   <span data-ttu-id="24a5a-142">IRowset::ReleaseRows</span><span class="sxs-lookup"><span data-stu-id="24a5a-142">IRowset::ReleaseRows</span></span>  
  
-   <span data-ttu-id="24a5a-143">IRowset::RestartPosition</span><span class="sxs-lookup"><span data-stu-id="24a5a-143">IRowset::RestartPosition</span></span>  
  
 <span data-ttu-id="24a5a-144">El proveedor OLE DB de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client leerá una o varias filas del objeto de conjunto de filas del consumidor a la vez para admitir el comportamiento de transmisión por secuencias en parámetros con valores de tabla.</span><span class="sxs-lookup"><span data-stu-id="24a5a-144">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider will read one or more rows at a time from the consumer rowset object to support streaming behavior in table-valued parameters.</span></span> <span data-ttu-id="24a5a-145">Por ejemplo, el usuario puede tener los datos de conjunto de filas de parámetros con valores de tabla en el disco (no en la memoria) e implementar la funcionalidad necesaria para leer datos del disco cuando así lo requiera el proveedor OLE DB de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client.</span><span class="sxs-lookup"><span data-stu-id="24a5a-145">For example, the user might have the table-valued parameter rowset data on disk (not in memory) and might implement the functionality to read data from the disk when required by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider.</span></span>  
  
 <span data-ttu-id="24a5a-146">El consumidor comunicará su formato de datos con [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] el proveedor de OLE DB de cliente nativo mediante IAccessor:: CreateAccessor en el objeto de conjunto de filas del parámetro con valores de tabla.</span><span class="sxs-lookup"><span data-stu-id="24a5a-146">The consumer will communicate its data format to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider by using IAccessor::CreateAccessor on the table-valued parameter rowset object.</span></span> <span data-ttu-id="24a5a-147">Al leer los datos del búfer del consumidor, el proveedor comprueba que todas las columnas de escritura no predeterminadas están disponibles a través de al menos un identificador de descriptor de acceso, y usa los identificadores correspondientes para leer los datos de las columnas.</span><span class="sxs-lookup"><span data-stu-id="24a5a-147">When reading data from the consumer buffer, the provider verifies that all the writable and non-default columns are available through at least one accessor handle, and uses the corresponding handles to read columns data.</span></span> <span data-ttu-id="24a5a-148">Para evitar la ambigüedad, tiene que existir una correspondencia de uno a uno entre una columna de conjunto de filas de parámetros con valores de tabla y un enlace.</span><span class="sxs-lookup"><span data-stu-id="24a5a-148">To avoid ambiguity, there should be a one-to-one correspondence between a table-valued parameter rowset column and a binding.</span></span> <span data-ttu-id="24a5a-149">Los enlaces duplicados a la misma columna generarán un error.</span><span class="sxs-lookup"><span data-stu-id="24a5a-149">Duplicate bindings to the same column will result in an error.</span></span> <span data-ttu-id="24a5a-150">Además, se espera que cada descriptor de acceso tenga el miembro *iOrdinal* de DBBindings en la secuencia.</span><span class="sxs-lookup"><span data-stu-id="24a5a-150">Also, each accessor is expected to have the *iOrdinal* member of DBBindings in sequence.</span></span> <span data-ttu-id="24a5a-151">Habrá tantas llamadas a IRowset::GetData como número de descriptores de acceso por fila y el orden de las llamadas se basará en el orden del valor *iOrdinal*, de menor a mayor.</span><span class="sxs-lookup"><span data-stu-id="24a5a-151">There will be as many calls to IRowset::GetData as the number of accessors per row, and the order of calls will be based on the order of *iOrdinal* value from lower to higher values.</span></span>  
  
 <span data-ttu-id="24a5a-152">Se espera que el proveedor implemente la mayoría de las interfaces expuestas por el objeto de conjunto de filas de parámetros con valores de tabla.</span><span class="sxs-lookup"><span data-stu-id="24a5a-152">The provider is expected to implement most of the interfaces exposed by the table-valued parameter rowset object.</span></span> <span data-ttu-id="24a5a-153">El consumidor implementará un objeto de conjunto de filas con interfaces mínimas (IRowset).</span><span class="sxs-lookup"><span data-stu-id="24a5a-153">The consumer will implement a rowset object with minimal interfaces (IRowset).</span></span> <span data-ttu-id="24a5a-154">Debido a la agregación oculta, el objeto de conjunto de filas de parámetros con valores de tabla implementará todas las demás interfaces obligatorias del objeto de conjunto de filas.</span><span class="sxs-lookup"><span data-stu-id="24a5a-154">Because of blind aggregation, the remaining mandatory rowset object interfaces will be implemented by the table-valued parameter rowset object.</span></span>  
  
 <span data-ttu-id="24a5a-155">En cualquier otro objeto de conjunto de filas, como los objetos de conjunto de filas que se obtienen para cualquier proveedor OLE DB, el conjunto de filas proporcionado por el consumidor debe implementar todas las interfaces obligatorias del objeto de conjunto de filas, tal y como se indica en la especificación de OLE DB.</span><span class="sxs-lookup"><span data-stu-id="24a5a-155">For any other rowset object, such as rowset objects obtained for any OLE DB provider, the consumer-provided rowset must implement all the mandatory rowset object interfaces as specified in the OLE DB specification.</span></span>  
  
 <span data-ttu-id="24a5a-156">En tiempo de ejecución, el proveedor OLE DB de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client volverá a llamar al objeto de conjunto de filas para capturar las filas y leer los datos de columna.</span><span class="sxs-lookup"><span data-stu-id="24a5a-156">At the time of execution, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider will call back to the rowset object to fetch rows and read column data.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="24a5a-157">Consulte también</span><span class="sxs-lookup"><span data-stu-id="24a5a-157">See Also</span></span>  
 <span data-ttu-id="24a5a-158">[Parámetros con valores de tabla &#40;OLE DB&#41;](table-valued-parameters-ole-db.md) </span><span class="sxs-lookup"><span data-stu-id="24a5a-158">[Table-Valued Parameters &#40;OLE DB&#41;](table-valued-parameters-ole-db.md) </span></span>  
 [<span data-ttu-id="24a5a-159">Usar parámetros con valores de tabla &#40;OLE DB&#41;</span><span class="sxs-lookup"><span data-stu-id="24a5a-159">Use Table-Valued Parameters &#40;OLE DB&#41;</span></span>](../native-client-ole-db-how-to/use-table-valued-parameters-ole-db.md)  
  
