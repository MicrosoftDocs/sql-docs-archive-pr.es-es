---
title: Requisitos para los agregados definidos por el usuario CLR | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: clr
ms.topic: reference
helpviewer_keywords:
- aggregate functions [CLR integration]
- user-defined types [CLR integration], user-defined aggregates
- CREATE AGGREGATE statement
- SqlUserDefinedAggregate attribute
- aggregate methods [CLR integration]
- assemblies [CLR integration], user-defined aggregate functions
- custom aggregates [CLR integration]
- user-defined functions [CLR integration]
- UDTs [CLR integration], user-defined aggregates
ms.assetid: dbf9eb5a-bd99-42f7-b275-556d0def045d
author: rothja
ms.author: jroth
ms.openlocfilehash: 8123f8324d43212007857dbb596a4fc61872bd2e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87673725"
---
# <a name="requirements-for-clr-user-defined-aggregates"></a><span data-ttu-id="08226-102">Requisitos para agregados definidos por el usuario de CLR</span><span class="sxs-lookup"><span data-stu-id="08226-102">Requirements for CLR User-Defined Aggregates</span></span>
  <span data-ttu-id="08226-103">Un tipo de un ensamblado CLR (Common Language Runtime) puede registrarse como una función de agregado definida por el usuario, siempre y cuando implemente el contrato de agregación necesario.</span><span class="sxs-lookup"><span data-stu-id="08226-103">A type in a common language runtime (CLR) assembly can be registered as a user-defined aggregate function, as long as it implements the required aggregation contract.</span></span> <span data-ttu-id="08226-104">Este contrato consta del atributo `SqlUserDefinedAggregate` y los métodos del contrato de agregación.</span><span class="sxs-lookup"><span data-stu-id="08226-104">This contract consists of the `SqlUserDefinedAggregate` attribute and the aggregation contract methods.</span></span> <span data-ttu-id="08226-105">El contrato de agregación incluye el mecanismo para guardar el estado intermedio de la agregación y el mecanismo para acumular nuevos valores, que consta de cuatro métodos: `Init`, `Accumulate`, `Merge` y `Terminate`.</span><span class="sxs-lookup"><span data-stu-id="08226-105">The aggregation contract includes the mechanism to save the intermediate state of the aggregation, and the mechanism to accumulate new values, which consists of four methods: `Init`, `Accumulate`, `Merge`, and `Terminate`.</span></span> <span data-ttu-id="08226-106">Una vez cumplidos estos requisitos, podrá sacar el máximo partido de los agregados definidos por el usuario en [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="08226-106">When you have met these requirements, you will be able to take full advantage of user-defined aggregates in [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="08226-107">En las siguientes secciones de este tema se proporcionan detalles adicionales sobre la forma de crear y trabajar con agregados definidos por el usuario.</span><span class="sxs-lookup"><span data-stu-id="08226-107">The following sections of this topic provide additional details about how to create and work with user-defined aggregates.</span></span> <span data-ttu-id="08226-108">Para obtener un ejemplo, vea [invocación de funciones de agregado definidas por el usuario CLR](clr-user-defined-aggregate-invoking-functions.md).</span><span class="sxs-lookup"><span data-stu-id="08226-108">For an example, see [Invoking CLR User-Defined Aggregate Functions](clr-user-defined-aggregate-invoking-functions.md).</span></span>  
  
## <a name="sqluserdefinedaggregate"></a><span data-ttu-id="08226-109">SqlUserDefinedAggregate</span><span class="sxs-lookup"><span data-stu-id="08226-109">SqlUserDefinedAggregate</span></span>  
 <span data-ttu-id="08226-110">Para obtener más información, vea [SqlUserDefinedAggregateAttribute](https://go.microsoft.com/fwlink/?LinkId=124626).</span><span class="sxs-lookup"><span data-stu-id="08226-110">For more information, see [SqlUserDefinedAggregateAttribute](https://go.microsoft.com/fwlink/?LinkId=124626).</span></span>  
  
## <a name="aggregation-methods"></a><span data-ttu-id="08226-111">Métodos de agregación</span><span class="sxs-lookup"><span data-stu-id="08226-111">Aggregation Methods</span></span>  
 <span data-ttu-id="08226-112">La clase registrada como un agregado definido por el usuario debe admitir los métodos de instancia siguientes.</span><span class="sxs-lookup"><span data-stu-id="08226-112">The class registered as a user-defined aggregate should support the following instance methods.</span></span> <span data-ttu-id="08226-113">Estos son los métodos que usa el procesador de consultas para calcular la agregación:</span><span class="sxs-lookup"><span data-stu-id="08226-113">These are the methods that the query processor uses to compute the aggregation:</span></span>  
  
|<span data-ttu-id="08226-114">Método</span><span class="sxs-lookup"><span data-stu-id="08226-114">Method</span></span>|<span data-ttu-id="08226-115">Sintaxis</span><span class="sxs-lookup"><span data-stu-id="08226-115">Syntax</span></span>|<span data-ttu-id="08226-116">Descripción</span><span class="sxs-lookup"><span data-stu-id="08226-116">Description</span></span>|  
|------------|------------|-----------------|  
|`Init`|<span data-ttu-id="08226-117">public void init ();</span><span class="sxs-lookup"><span data-stu-id="08226-117">public void Init();</span></span>|<span data-ttu-id="08226-118">El procesador de consultas usa este método para inicializar el cálculo de la agregación.</span><span class="sxs-lookup"><span data-stu-id="08226-118">The query processor uses this method to initialize the computation of the aggregation.</span></span> <span data-ttu-id="08226-119">Este método se invoca una vez para cada grupo que el procesador de consultas agrega.</span><span class="sxs-lookup"><span data-stu-id="08226-119">This method is invoked once for each group that the query processor is aggregating.</span></span> <span data-ttu-id="08226-120">El procesador de consultas puede optar por reutilizar la misma instancia de la clase de agregado para calcular los agregados de varios grupos.</span><span class="sxs-lookup"><span data-stu-id="08226-120">The query processor may choose to reuse the same instance of the aggregate class for computing aggregates of multiple groups.</span></span> <span data-ttu-id="08226-121">El método `Init` debe realizar cualquier operación limpieza necesaria con respecto a los usos anteriores de esta instancia y habilitarla para reiniciar un nuevo el cálculo de agregado.</span><span class="sxs-lookup"><span data-stu-id="08226-121">The `Init` method should perform any clean-up as necessary from previous uses of this instance, and enable it to re-start a new aggregate computation.</span></span>|  
|`Accumulate`|<span data-ttu-id="08226-122">public void ACCUMULATE (valor de tipo de entrada [, valor de tipo de entrada,...]);</span><span class="sxs-lookup"><span data-stu-id="08226-122">public void Accumulate ( input-type value[, input-type value, ...]);</span></span>|<span data-ttu-id="08226-123">Uno o varios parámetros que representan los parámetros de la función.</span><span class="sxs-lookup"><span data-stu-id="08226-123">One or more parameters representing the parameters of the function.</span></span> <span data-ttu-id="08226-124">*INPUT_TYPE* debe ser el [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] tipo de datos administrado equivalente al [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] tipo de datos nativo especificado por *input_sqltype* en la `CREATE AGGREGATE` instrucción.</span><span class="sxs-lookup"><span data-stu-id="08226-124">*input_type* should be the managed [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] data type equivalent to the native [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] data type specified by *input_sqltype* in the `CREATE AGGREGATE` statement.</span></span> <span data-ttu-id="08226-125">Para obtener más información, vea [asignar datos de parámetros CLR](../clr-integration-database-objects-types-net-framework/mapping-clr-parameter-data.md).</span><span class="sxs-lookup"><span data-stu-id="08226-125">For more information, see [Mapping CLR Parameter Data](../clr-integration-database-objects-types-net-framework/mapping-clr-parameter-data.md).</span></span><br /><br /> <span data-ttu-id="08226-126">En el caso de los tipos definidos por el usuario (UDT), el tipo de entrada es igual al tipo UDT.</span><span class="sxs-lookup"><span data-stu-id="08226-126">For user-defined types (UDTs), the input-type is the same as the UDT type.</span></span> <span data-ttu-id="08226-127">El procesador de consultas usa este método para acumular los valores de agregado.</span><span class="sxs-lookup"><span data-stu-id="08226-127">The query processor uses this method to accumulate the aggregate values.</span></span> <span data-ttu-id="08226-128">Debe invocarse una vez para cada valor en el grupo que se agrega.</span><span class="sxs-lookup"><span data-stu-id="08226-128">This is invoked once for each value in the group that is being aggregated.</span></span> <span data-ttu-id="08226-129">El procesador de consultas solamente realiza esta llamada después de llamar al método `Init` en la instancia dada de la clase de agregado.</span><span class="sxs-lookup"><span data-stu-id="08226-129">The query processor always calls this only after calling the `Init` method on the given instance of the aggregate-class.</span></span> <span data-ttu-id="08226-130">La implementación de este método debe actualizar el estado de la instancia para reflejar la acumulación del valor de argumento que se pasa.</span><span class="sxs-lookup"><span data-stu-id="08226-130">The implementation of this method should update the state of the instance to reflect the accumulation of the argument value being passed in.</span></span>|  
|`Merge`|<span data-ttu-id="08226-131">public void Merge (valor udagg_class);</span><span class="sxs-lookup"><span data-stu-id="08226-131">public void Merge( udagg_class value);</span></span>|<span data-ttu-id="08226-132">Este método puede usarse para combinar otra instancia de esta clase de agregado con la instancia actual.</span><span class="sxs-lookup"><span data-stu-id="08226-132">This method can be used to merge another instance of this aggregate class with the current instance.</span></span> <span data-ttu-id="08226-133">El procesador de consultas usa este método para combinar varios cálculos parciales de una agregación.</span><span class="sxs-lookup"><span data-stu-id="08226-133">The query processor uses this method to merge multiple partial computations of an aggregation.</span></span>|  
|`Terminate`|<span data-ttu-id="08226-134">Public return_type Terminate ();</span><span class="sxs-lookup"><span data-stu-id="08226-134">public return_type Terminate();</span></span>|<span data-ttu-id="08226-135">Este método completa el cálculo de agregado y devuelve el resultado de la agregación.</span><span class="sxs-lookup"><span data-stu-id="08226-135">This method completes the aggregate computation and returns the result of the aggregation.</span></span> <span data-ttu-id="08226-136">El *return_type* debe ser un [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] tipo de datos administrado que sea el equivalente administrado de *return_sqltype* especificado en la `CREATE AGGREGATE` instrucción.</span><span class="sxs-lookup"><span data-stu-id="08226-136">The *return_type* should be a managed [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] data type that is the managed equivalent of *return_sqltype* specified in the `CREATE AGGREGATE` statement.</span></span> <span data-ttu-id="08226-137">El *return_type* también puede ser un tipo definido por el usuario.</span><span class="sxs-lookup"><span data-stu-id="08226-137">The *return_type* can also be a user-defined type.</span></span>|  
  
### <a name="table-valued-parameters"></a><span data-ttu-id="08226-138">Parámetros con valores de tabla</span><span class="sxs-lookup"><span data-stu-id="08226-138">Table-Valued Parameters</span></span>  
 <span data-ttu-id="08226-139">Los parámetros con valores de tabla (TVP), tipos de tabla definidos por el usuario que se pasan a un procedimiento o función, proporcionan un modo eficaz de pasar varias filas de datos al servidor.</span><span class="sxs-lookup"><span data-stu-id="08226-139">Table-valued parameters (TVPs), user-defined table types that are passed into a procedure or function, provide an efficient way to pass multiple rows of data to the server.</span></span> <span data-ttu-id="08226-140">Los TVP presentan una funcionalidad similar a las matrices de parámetros, pero proporcionan más flexibilidad y una mayor integración con [!INCLUDE[tsql](../../includes/tsql-md.md)].</span><span class="sxs-lookup"><span data-stu-id="08226-140">TVPs provide similar functionality to parameter arrays, but offer greater flexibility and closer integration with [!INCLUDE[tsql](../../includes/tsql-md.md)].</span></span> <span data-ttu-id="08226-141">También proporcionan la posibilidad de obtener mayor rendimiento.</span><span class="sxs-lookup"><span data-stu-id="08226-141">They also provide the potential for better performance.</span></span> <span data-ttu-id="08226-142">Además, los TVP ayudan a reducir el número de ciclos de ida y vuelta al servidor.</span><span class="sxs-lookup"><span data-stu-id="08226-142">TVPs also help reduce the number of round trips to the server.</span></span> <span data-ttu-id="08226-143">En lugar de enviar varias solicitudes al servidor, como con una lista de parámetros escalares, los datos pueden enviarse al servidor como un TVP.</span><span class="sxs-lookup"><span data-stu-id="08226-143">Instead of sending multiple requests to the server, such as with a list of scalar parameters, data can be sent to the server as a TVP.</span></span> <span data-ttu-id="08226-144">Un tipo de tabla definido por el usuario no puede pasarse como un parámetro con valores de tabla a un procedimiento almacenado administrado o a una función que se ejecuta en el proceso de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , así como tampoco puede devolverse desde dicho procedimiento o función.</span><span class="sxs-lookup"><span data-stu-id="08226-144">A user-defined table type cannot be passed as a table-valued parameter to, or be returned from, a managed stored procedure or function executing in the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] process.</span></span> <span data-ttu-id="08226-145">Asimismo, los TVP no pueden usarse dentro del ámbito de una conexión de contexto.</span><span class="sxs-lookup"><span data-stu-id="08226-145">Also, TVPs cannot be used within the scope of a context connection.</span></span> <span data-ttu-id="08226-146">Sin embargo, un TVP puede usarse con SqlClient en procedimientos almacenados administrados o en funciones que se ejecutan en el proceso de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], si se usa en una conexión que no es de contexto.</span><span class="sxs-lookup"><span data-stu-id="08226-146">However, a TVP can be used with SqlClient in managed stored procedures or functions executing in the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] process, if it is used in a connection that is not a context connection.</span></span> <span data-ttu-id="08226-147">La conexión puede ser al mismo servidor que está ejecutando el procedimiento administrado o función.</span><span class="sxs-lookup"><span data-stu-id="08226-147">The connection can be to the same server that is executing the managed procedure or function.</span></span> <span data-ttu-id="08226-148">Para obtener más información sobre TVP, vea [usar parámetros con valores de tabla &#40;Motor de base de datos&#41;](../tables/use-table-valued-parameters-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="08226-148">For more information about TVPs, see [Use Table-Valued Parameters &#40;Database Engine&#41;](../tables/use-table-valued-parameters-database-engine.md).</span></span>  
  
## <a name="change-history"></a><span data-ttu-id="08226-149">Historial de cambios</span><span class="sxs-lookup"><span data-stu-id="08226-149">Change History</span></span>  
  
|<span data-ttu-id="08226-150">Contenido actualizado</span><span class="sxs-lookup"><span data-stu-id="08226-150">Updated content</span></span>|  
|---------------------|  
|<span data-ttu-id="08226-151">Se ha actualizado la descripción del método `Accumulate`; ahora acepta más de un parámetro.</span><span class="sxs-lookup"><span data-stu-id="08226-151">Updated the description of the `Accumulate` method; it now accepts more than one parameter.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="08226-152">Consulte también</span><span class="sxs-lookup"><span data-stu-id="08226-152">See Also</span></span>  
 <span data-ttu-id="08226-153">[Tipos definidos por el usuario CLR](../clr-integration-database-objects-user-defined-types/clr-user-defined-types.md) </span><span class="sxs-lookup"><span data-stu-id="08226-153">[CLR User-Defined Types](../clr-integration-database-objects-user-defined-types/clr-user-defined-types.md) </span></span>  
 [<span data-ttu-id="08226-154">Invocar funciones de agregado definidas por el usuario de CLR</span><span class="sxs-lookup"><span data-stu-id="08226-154">Invoking CLR User-Defined Aggregate Functions</span></span>](clr-user-defined-aggregate-invoking-functions.md)  
  
  
