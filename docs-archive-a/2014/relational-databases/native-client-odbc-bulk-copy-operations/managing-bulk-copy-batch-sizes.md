---
title: Administrar tamaños de lote de copia masiva | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- SQL Server Native Client ODBC driver, bulk copy
- ODBC, bulk copy operations
- batches [ODBC]
- bulk copy [ODBC], batch sizes
ms.assetid: 4b24139f-788b-45a6-86dc-ae835435d737
author: rothja
ms.author: jroth
ms.openlocfilehash: 1f24ece176cbb834e4162f9e516ff23013fd256a
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87675344"
---
# <a name="managing-bulk-copy-batch-sizes"></a><span data-ttu-id="6e543-102">Administrar tamaños de lote de copia masiva</span><span class="sxs-lookup"><span data-stu-id="6e543-102">Managing Bulk Copy Batch Sizes</span></span>
  <span data-ttu-id="6e543-103">El propósito principal de un lote en las operaciones de copia masiva consiste en definir el ámbito de una transacción.</span><span class="sxs-lookup"><span data-stu-id="6e543-103">The primary purpose of a batch in bulk copy operations is to define the scope of a transaction.</span></span> <span data-ttu-id="6e543-104">Si no se establece un tamaño de lote, las funciones de copia masiva consideran una copia masiva completa como una transacción.</span><span class="sxs-lookup"><span data-stu-id="6e543-104">If a batch size is not set, then bulk copy functions consider an entire bulk copy to be one transaction.</span></span> <span data-ttu-id="6e543-105">Si se establece un tamaño de lote, cada lote constituye una transacción que confirma cuando finaliza el lote.</span><span class="sxs-lookup"><span data-stu-id="6e543-105">If a batch size is set, then each batch constitutes a transaction that is committed when the batch finishes.</span></span>  
  
 <span data-ttu-id="6e543-106">Si una copia masiva se realiza sin especificar ningún tamaño de lote y se produce un error, se revierte la copia masiva completa.</span><span class="sxs-lookup"><span data-stu-id="6e543-106">If a bulk copy is performed with no batch size specified and an error is encountered, the entire bulk copy is rolled back.</span></span> <span data-ttu-id="6e543-107">La recuperación de una copia masiva de ejecución prolongada puede tardar mucho tiempo.</span><span class="sxs-lookup"><span data-stu-id="6e543-107">The recovery of a long-running bulk copy can take a long time.</span></span> <span data-ttu-id="6e543-108">Cuando se establece un tamaño de lote, la copia masiva considera cada lote como una transacción y confirma cada lote.</span><span class="sxs-lookup"><span data-stu-id="6e543-108">When a batch size is set, bulk copy considers each batch a transaction and commits each batch.</span></span> <span data-ttu-id="6e543-109">Si se produce un error, solo es necesario revertir el último lote pendiente.</span><span class="sxs-lookup"><span data-stu-id="6e543-109">If an error is encountered, only the last outstanding batch needs to be rolled back.</span></span>  
  
 <span data-ttu-id="6e543-110">El tamaño de lote también puede afectar a la sobrecarga de bloqueo.</span><span class="sxs-lookup"><span data-stu-id="6e543-110">The batch size can also affect locking overhead.</span></span> <span data-ttu-id="6e543-111">Al realizar una copia masiva en [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , se puede especificar la sugerencia TABLOCK mediante [bcp_control](../native-client-odbc-extensions-bulk-copy-functions/bcp-control.md) para adquirir un bloqueo de tabla en lugar de bloqueos de fila.</span><span class="sxs-lookup"><span data-stu-id="6e543-111">When performing a bulk copy against [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], the TABLOCK hint can be specified using [bcp_control](../native-client-odbc-extensions-bulk-copy-functions/bcp-control.md) to acquire a table lock instead of row locks.</span></span> <span data-ttu-id="6e543-112">El bloqueo de una única tabla se puede mantener con una sobrecarga mínima en una operación de copia masiva completa.</span><span class="sxs-lookup"><span data-stu-id="6e543-112">The single table lock can be held with minimal overhead for an entire bulk copy operation.</span></span> <span data-ttu-id="6e543-113">Si no se especifica TABLOCK, los bloqueos se mantienen en las filas individuales y la sobrecarga de mantener todos los bloqueos durante la copia masiva puede reducir el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="6e543-113">If TABLOCK is not specified then locks are held on individual rows and the overhead of maintaining all the locks for the duration of the bulk copy can slow performance.</span></span> <span data-ttu-id="6e543-114">Dado que los bloqueos solo se mantienen mientras dura una transacción, la especificación de un tamaño del lote resuelve este problema ya que se genera periódicamente una confirmación que libera los bloqueos actuales.</span><span class="sxs-lookup"><span data-stu-id="6e543-114">Because locks are only held for the length of a transaction, specifying a batch size addresses this problem by periodically generating a commit that frees the locks currently held.</span></span>  
  
 <span data-ttu-id="6e543-115">El número de filas que conforman un lote puede tener efectos significativos en el rendimiento cuando se realiza la copia masiva de un gran número de filas.</span><span class="sxs-lookup"><span data-stu-id="6e543-115">The number of rows making up a batch can have significant performance effects when bulk copying a large number of rows.</span></span> <span data-ttu-id="6e543-116">Las recomendaciones para el tamaño del lote dependen del tipo de copia masiva que se realiza.</span><span class="sxs-lookup"><span data-stu-id="6e543-116">The recommendations for batch size depend on the type of bulk copy being performed.</span></span>  
  
-   <span data-ttu-id="6e543-117">Cuando realice una copia masiva en [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], especifique la sugerencia TABLOCK de copia masiva y establezca un tamaño de lote grande.</span><span class="sxs-lookup"><span data-stu-id="6e543-117">When bulk copying to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], specify the TABLOCK bulk copy hint and set a large batch size.</span></span>  
  
-   <span data-ttu-id="6e543-118">Si no especifica TABLOCK, limite los tamaños de lote a un número menor que 1.000 filas.</span><span class="sxs-lookup"><span data-stu-id="6e543-118">When TABLOCK is not specified, limit batch sizes to less than 1,000 rows.</span></span>  
  
 <span data-ttu-id="6e543-119">Cuando se realiza una copia masiva desde un archivo de datos, el tamaño del lote se especifica mediante una llamada a **bcp_control** con la opción BCPBATCH antes de llamar a [bcp_exec](../native-client-odbc-extensions-bulk-copy-functions/bcp-exec.md).</span><span class="sxs-lookup"><span data-stu-id="6e543-119">When bulk copying in from a data file, the batch size is specified by calling **bcp_control** with the BCPBATCH option before calling [bcp_exec](../native-client-odbc-extensions-bulk-copy-functions/bcp-exec.md).</span></span> <span data-ttu-id="6e543-120">Cuando se realiza una copia masiva desde variables de programa mediante [bcp_bind](../native-client-odbc-extensions-bulk-copy-functions/bcp-bind.md) y [bcp_sendrow](../native-client-odbc-extensions-bulk-copy-functions/bcp-sendrow.md), el tamaño del lote se controla mediante una llamada a [bcp_batch](../native-client-odbc-extensions-bulk-copy-functions/bcp-batch.md) después de llamar a [bcp_sendrow](../native-client-odbc-extensions-bulk-copy-functions/bcp-sendrow.md) *x* veces, donde *x* es el número de filas de un lote.</span><span class="sxs-lookup"><span data-stu-id="6e543-120">When bulk copying from program variables using [bcp_bind](../native-client-odbc-extensions-bulk-copy-functions/bcp-bind.md) and [bcp_sendrow](../native-client-odbc-extensions-bulk-copy-functions/bcp-sendrow.md), the batch size is controlled by calling [bcp_batch](../native-client-odbc-extensions-bulk-copy-functions/bcp-batch.md) after calling [bcp_sendrow](../native-client-odbc-extensions-bulk-copy-functions/bcp-sendrow.md) *x* times, where *x* is the number of rows in a batch.</span></span>  
  
 <span data-ttu-id="6e543-121">Además de especificar el tamaño de una transacción, los lotes también afectan al envío de las filas al servidor a través de la red.</span><span class="sxs-lookup"><span data-stu-id="6e543-121">In addition to specifying the size of a transaction, batches also affect when rows are sent across the network to the server.</span></span> <span data-ttu-id="6e543-122">Las funciones de copia masiva suelen almacenar en caché las filas de **bcp_sendrow** hasta que se rellene un paquete de red y, a continuación, enviar el paquete completo al servidor.</span><span class="sxs-lookup"><span data-stu-id="6e543-122">Bulk copy functions normally cache the rows from **bcp_sendrow** until a network packet is filled, and then send the full packet to the server.</span></span> <span data-ttu-id="6e543-123">Sin embargo, cuando una aplicación llama a **bcp_batch**, el paquete actual se envía al servidor independientemente de si se ha rellenado.</span><span class="sxs-lookup"><span data-stu-id="6e543-123">When an application calls **bcp_batch**, however, the current packet is sent to the server regardless of whether it has been filled.</span></span> <span data-ttu-id="6e543-124">La utilización de un tamaño de lote muy bajo puede reducir el rendimiento si da lugar al envío de numerosos paquetes parcialmente rellenados al servidor.</span><span class="sxs-lookup"><span data-stu-id="6e543-124">Using a very low batch size can slow performance if it results in sending many partially filled packets to the server.</span></span> <span data-ttu-id="6e543-125">Por ejemplo, la llamada a **bcp_batch** después de cada **bcp_sendrow** hace que cada fila se envíe en un paquete independiente y, a menos que las filas sean muy grandes, desperdicia espacio en cada paquete.</span><span class="sxs-lookup"><span data-stu-id="6e543-125">For example, calling **bcp_batch** after every **bcp_sendrow** causes each row to be sent in a separate packet and, unless the rows are very large, wastes space in each packet.</span></span> <span data-ttu-id="6e543-126">El tamaño predeterminado de los paquetes de red para SQL Server es 4 KB, aunque una aplicación puede cambiar el tamaño mediante una llamada a [SQLSetConnectAttr](../native-client-odbc-api/sqlsetconnectattr.md) que especifique el atributo de SQL_ATTR_PACKET_SIZE.</span><span class="sxs-lookup"><span data-stu-id="6e543-126">The default size of network packets for SQL Server is 4 KB, although an application can change the size by calling [SQLSetConnectAttr](../native-client-odbc-api/sqlsetconnectattr.md) specifying the SQL_ATTR_PACKET_SIZE attribute.</span></span>  
  
 <span data-ttu-id="6e543-127">Otro efecto secundario de los lotes es que cada lote se considera un conjunto de resultados pendiente hasta que se completa con **bcp_batch**.</span><span class="sxs-lookup"><span data-stu-id="6e543-127">Another side effect of batches is that each batch is considered an outstanding result set until it is completed with **bcp_batch**.</span></span> <span data-ttu-id="6e543-128">Si se intenta realizar cualquier otra operación en un identificador de conexión mientras un lote está pendiente, el [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] controlador ODBC de Native Client emite un error con SQLSTATE = "HY000" y una cadena de mensaje de error de:</span><span class="sxs-lookup"><span data-stu-id="6e543-128">If any other operations are attempted on a connection handle while a batch is outstanding, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC driver issues an error with SQLState = "HY000" and an error message string of:</span></span>  
  
```  
"[Microsoft][SQL Server Native Client] Connection is busy with  
results for another hstmt."  
```  
  
## <a name="see-also"></a><span data-ttu-id="6e543-129">Consulte también</span><span class="sxs-lookup"><span data-stu-id="6e543-129">See Also</span></span>  
 <span data-ttu-id="6e543-130">[Realizar operaciones de copia masiva &#40;ODBC&#41;](performing-bulk-copy-operations-odbc.md) </span><span class="sxs-lookup"><span data-stu-id="6e543-130">[Performing Bulk Copy Operations &#40;ODBC&#41;](performing-bulk-copy-operations-odbc.md) </span></span>  
 [<span data-ttu-id="6e543-131">Importar y exportar datos en bloque &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="6e543-131">Bulk Import and Export of Data &#40;SQL Server&#41;</span></span>](../import-export/bulk-import-and-export-of-data-sql-server.md)  
  
  
