---
title: Estadísticas | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: performance
ms.topic: conceptual
helpviewer_keywords:
- statistical information [SQL Server], query optimization
- query performance [SQL Server], statistics
- query optimization statistics [SQL Server]
- statistical information [SQL Server], database options
- query optimization statistics [SQL Server], about query optimization statistics
- statistical information [SQL Server], guidelines
- statistical information [SQL Server]
- using statistics [SQL Server]
- statistical information [SQL Server], indexes
- index statistics [SQL Server]
- query optimizer [SQL Server], statistics
- statistics [SQL Server]
ms.assetid: b86a88ba-4f7c-4e19-9fbd-2f8bcd3be14a
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 0f0950e48245bed53581d2f91b120ab9555aa562
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87676406"
---
# <a name="statistics"></a><span data-ttu-id="f3d59-102">Estadísticas</span><span class="sxs-lookup"><span data-stu-id="f3d59-102">Statistics</span></span>
  <span data-ttu-id="f3d59-103">El optimizador de consultas utiliza las estadísticas para crear planes de consulta que mejoren el rendimiento de las consultas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-103">The query optimizer uses statistics to create query plans that improve query performance.</span></span> <span data-ttu-id="f3d59-104">Para la mayoría de las consultas, el optimizador de consultas genera ya las estadísticas necesarias para un plan de consulta de alta calidad; en algunos casos, para obtener los mejores resultados, necesita crear estadísticas adicionales o modificar el diseño de la consulta.</span><span class="sxs-lookup"><span data-stu-id="f3d59-104">For most queries, the query optimizer already generates the necessary statistics for a high quality query plan; in a few cases, you need to create additional statistics or modify the query design for best results.</span></span> <span data-ttu-id="f3d59-105">En este tema se explican los conceptos de estadísticas y se proporcionan directrices para usar las estadística de optimización de consultas de forma eficaz.</span><span class="sxs-lookup"><span data-stu-id="f3d59-105">This topic discusses statistics concepts and provides guidelines for using query optimization statistics effectively.</span></span>  
  
##  <a name="components-and-concepts"></a><a name="DefinitionQOStatistics"></a> <span data-ttu-id="f3d59-106">Componentes y conceptos</span><span class="sxs-lookup"><span data-stu-id="f3d59-106">Components and Concepts</span></span>  
 <span data-ttu-id="f3d59-107">Estadísticas</span><span class="sxs-lookup"><span data-stu-id="f3d59-107">Statistics</span></span>  
 <span data-ttu-id="f3d59-108">Las estadísticas para la optimización de consulta son objetos que contienen información estadística acerca de la distribución de valores en una o más columnas de una tabla o vista indizada.</span><span class="sxs-lookup"><span data-stu-id="f3d59-108">Statistics for query optimization are objects that contain statistical information about the distribution of values in one or more columns of a table or indexed view.</span></span> <span data-ttu-id="f3d59-109">El optimizador de consultas utiliza estas estadísticas para estimar la *cardinalidad*, o el número de filas, en el resultado de la consulta.</span><span class="sxs-lookup"><span data-stu-id="f3d59-109">The query optimizer uses these statistics to estimate the *cardinality*, or number of rows, in the query result.</span></span> <span data-ttu-id="f3d59-110">Estas *estimaciones de cardinalidad* permiten al optimizador de consultas crear un plan de consulta de alta calidad.</span><span class="sxs-lookup"><span data-stu-id="f3d59-110">These *cardinality estimates* enable the query optimizer to create a high-quality query plan.</span></span> <span data-ttu-id="f3d59-111">Por ejemplo, el optimizador de consultas podría utilizar las estimaciones de cardinalidad para elegir el operador Index Seek en lugar del operador Index Scan, con un uso más intensivo de los recursos, mejorando con ello el rendimiento de la consulta.</span><span class="sxs-lookup"><span data-stu-id="f3d59-111">For example, the query optimizer could use cardinality estimates to choose the index seek operator instead of the more resource-intensive index scan operator, and in doing so improve query performance.</span></span>  
  
 <span data-ttu-id="f3d59-112">Cada objeto de estadísticas se crea en una lista de una o más columnas de la tabla e incluye un histograma que muestra la distribución de valores en la primera columna.</span><span class="sxs-lookup"><span data-stu-id="f3d59-112">Each statistics object is created on a list of one or more table columns and includes a histogram displaying the distribution of values in the first column.</span></span> <span data-ttu-id="f3d59-113">Los objetos de estadísticas en varias columnas también almacenan la información estadística relativa a la correlación de valores entre las columnas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-113">Statistics objects on multiple columns also store statistical information about the correlation of values among the columns.</span></span> <span data-ttu-id="f3d59-114">Estas estadísticas de la correlación, o *densidades*, derivan del número de filas distintas de valores de columna.</span><span class="sxs-lookup"><span data-stu-id="f3d59-114">These correlation statistics, or *densities*, are derived from the number of distinct rows of column values.</span></span> <span data-ttu-id="f3d59-115">Para obtener más información sobre los objetos de estadísticas, vea [DBCC SHOW_STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/database-console-commands/dbcc-show-statistics-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f3d59-115">For more information about statistics objects, see [DBCC SHOW_STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/database-console-commands/dbcc-show-statistics-transact-sql).</span></span>  
  
 <span data-ttu-id="f3d59-116">Estadísticas filtradas</span><span class="sxs-lookup"><span data-stu-id="f3d59-116">Filtered Statistics</span></span>  
 <span data-ttu-id="f3d59-117">Las estadísticas filtradas pueden mejorar el rendimiento de las consultas que se seleccionan desde subconjuntos de datos bien definidos.</span><span class="sxs-lookup"><span data-stu-id="f3d59-117">Filtered statistics can improve query performance for queries that select from well-defined subsets of data.</span></span> <span data-ttu-id="f3d59-118">Las estadísticas filtradas utilizan un predicado de filtro para seleccionar el subconjunto de datos que se incluye en las estadísticas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-118">Filtered statistics use a filter predicate to select the subset of data that is included in the statistics.</span></span> <span data-ttu-id="f3d59-119">Las estadísticas filtradas bien diseñadas pueden mejorar el plan de ejecución de la consulta en comparación con las estadísticas de tabla completa.</span><span class="sxs-lookup"><span data-stu-id="f3d59-119">Well-designed filtered statistics can improve the query execution plan compared with full-table statistics.</span></span> <span data-ttu-id="f3d59-120">Para obtener más información sobre el predicado de filtro, vea [CREATE STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-statistics-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f3d59-120">For more information about the filter predicate, see [CREATE STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-statistics-transact-sql).</span></span> <span data-ttu-id="f3d59-121">Para obtener más información acerca de cuándo crear las estadísticas filtradas, vea la sección [Cuándo crear las estadísticas](#UpdateStatistics) en este tema.</span><span class="sxs-lookup"><span data-stu-id="f3d59-121">For more information about when to create filtered statistics, see the [When to Create Statistics](#UpdateStatistics) section in this topic.</span></span> <span data-ttu-id="f3d59-122">Para consultar un caso práctico, vea la entrada de blog sobre el [uso de estadísticas filtradas con tablas con particiones](https://go.microsoft.com/fwlink/?LinkId=178505), en el sitio web SQLCAT.</span><span class="sxs-lookup"><span data-stu-id="f3d59-122">For a case study, see the blog entry, [Using Filtered Statistics with Partitioned Tables](https://go.microsoft.com/fwlink/?LinkId=178505), on the SQLCAT Web site.</span></span>  
  
 <span data-ttu-id="f3d59-123">Opciones de estadísticas</span><span class="sxs-lookup"><span data-stu-id="f3d59-123">Statistics Options</span></span>  
 <span data-ttu-id="f3d59-124">Hay tres opciones que puede establecer que afectan al momento y al modo en que se crean y actualizan las estadísticas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-124">There are three options that you can set that affect when and how statistics are created and updated.</span></span> <span data-ttu-id="f3d59-125">Estas opciones se establecen únicamente en el nivel de base de datos.</span><span class="sxs-lookup"><span data-stu-id="f3d59-125">These options are set at the database level only.</span></span>  
  
 <span data-ttu-id="f3d59-126">Opción AUTO_CREATE_STATISTICS</span><span class="sxs-lookup"><span data-stu-id="f3d59-126">AUTO_CREATE_STATISTICS Option</span></span>  
 <span data-ttu-id="f3d59-127">Cuando está activada la opción automática de creación de estadísticas, AUTO_CREATE_STATISTICS, el optimizador de consultas crea las estadísticas en columnas individuales en el predicado de consulta, según sea necesario, para mejorar las estimaciones de cardinalidad para el plan de consulta.</span><span class="sxs-lookup"><span data-stu-id="f3d59-127">When the automatic create statistics option, AUTO_CREATE_STATISTICS, is on, the query optimizer creates statistics on individual columns in the query predicate, as necessary, to improve cardinality estimates for the query plan.</span></span> <span data-ttu-id="f3d59-128">Estas estadísticas de columna única se crean en las columnas que aún no tienen un histograma en un objeto de estadísticas existente.</span><span class="sxs-lookup"><span data-stu-id="f3d59-128">These single-column statistics are created on columns that do not already have a histogram in an existing statistics object.</span></span> <span data-ttu-id="f3d59-129">La opción AUTO_CREATE_STATISTICS no determina si las estadísticas se crean para los índices.</span><span class="sxs-lookup"><span data-stu-id="f3d59-129">The AUTO_CREATE_STATISTICS option does not determine whether statistics get created for indexes.</span></span> <span data-ttu-id="f3d59-130">Esta opción tampoco genera estadísticas filtradas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-130">This option also does not generate filtered statistics.</span></span> <span data-ttu-id="f3d59-131">Se aplica estrictamente a estadísticas de columna única para la tabla completa.</span><span class="sxs-lookup"><span data-stu-id="f3d59-131">It applies strictly to single-column statistics for the full table.</span></span>  
  
 <span data-ttu-id="f3d59-132">Cuando el optimizador de consultas crea las estadísticas como resultado de usar la opción AUTO_CREATE_STATISTICS, el nombre de las estadísticas comienza con `_WA`.</span><span class="sxs-lookup"><span data-stu-id="f3d59-132">When the query optimizer creates statistics as a result of using the AUTO_CREATE_STATISTICS option, the statistics name starts with `_WA`.</span></span> <span data-ttu-id="f3d59-133">Puede utilizar la consulta siguiente para determinar si el optimizador de consultas ha creado estadísticas para una columna de predicado de consulta.</span><span class="sxs-lookup"><span data-stu-id="f3d59-133">You can use the following query to determine if the query optimizer has created statistics for a query predicate column.</span></span>  
  
```  
SELECT OBJECT_NAME(s.object_id) AS object_name,  
    COL_NAME(sc.object_id, sc.column_id) AS column_name,  
    s.name AS statistics_name  
FROM sys.stats AS s JOIN sys.stats_columns AS sc  
    ON s.stats_id = sc.stats_id AND s.object_id = sc.object_id  
WHERE s.name like '_WA%'  
ORDER BY s.name;  
```  
  
 <span data-ttu-id="f3d59-134">Opción AUTO_UPDATE_STATISTICS</span><span class="sxs-lookup"><span data-stu-id="f3d59-134">AUTO_UPDATE_STATISTICS Option</span></span>  
 <span data-ttu-id="f3d59-135">Cuando está activada la opción automática de actualización de estadísticas, AUTO_UPDATE_STATISTICS, el optimizador de consultas determina cuándo las estadísticas pueden estar desfasadas y las actualiza cuando son usadas por una consulta.</span><span class="sxs-lookup"><span data-stu-id="f3d59-135">When the automatic update statistics option, AUTO_UPDATE_STATISTICS, is on, the query optimizer determines when statistics might be out-of-date and then updates them when they are used by a query.</span></span> <span data-ttu-id="f3d59-136">Las estadísticas se vuelven obsoletas después de que operaciones de inserción, actualización, eliminación o combinación cambien la distribución de los datos en la tabla o la vista indizada.</span><span class="sxs-lookup"><span data-stu-id="f3d59-136">Statistics become out-of-date after insert, update, delete, or merge operations change the data distribution in the table or indexed view.</span></span> <span data-ttu-id="f3d59-137">El optimizador de consultas determina cuándo han podido quedar obsoletas las estadísticas contando el número de modificaciones de datos desde la actualización más reciente de las estadísticas, comparando el número de modificaciones con respecto a un umbral.</span><span class="sxs-lookup"><span data-stu-id="f3d59-137">The query optimizer determines when statistics might be out-of-date by counting the number of data modifications since the last statistics update and comparing the number of modifications to a threshold.</span></span> <span data-ttu-id="f3d59-138">El umbral se basa en el número de filas de la tabla o la vista indizada.</span><span class="sxs-lookup"><span data-stu-id="f3d59-138">The threshold is based on the number of rows in the table or indexed view.</span></span>  
  
 <span data-ttu-id="f3d59-139">El optimizador de consultas comprueba que hay estadísticas obsoletas antes de compilar una consulta y antes de ejecutar un plan de consulta almacenado en la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="f3d59-139">The query optimizer checks for out-of-date statistics before compiling a query and before executing a cached query plan.</span></span> <span data-ttu-id="f3d59-140">Antes de compilar una consulta, el optimizador de consultas utiliza las columnas, tablas y vistas indizadas en el predicado de consulta, para determinar qué estadísticas podrían estar obsoletas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-140">Before compiling a query, the query optimizer uses the columns, tables, and indexed views in the query predicate to determine which statistics might be out-of-date.</span></span> <span data-ttu-id="f3d59-141">Antes de ejecutar un plan de consulta almacenado en la memoria caché, [!INCLUDE[ssDE](../../../includes/ssde-md.md)] comprueba que el plan de consulta hace referencia a las estadísticas actualizadas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-141">Before executing a cached query plan, the [!INCLUDE[ssDE](../../../includes/ssde-md.md)] verifies that the query plan references up-to-date statistics.</span></span>  
  
 <span data-ttu-id="f3d59-142">La opción AUTO_UPDATE_STATISTICS se aplica a los objetos de estadísticas creados para los índices, columnas únicas de predicados de consulta y las estadísticas creadas con la instrucción [CREATE STATISTICS](/sql/t-sql/statements/create-statistics-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="f3d59-142">The AUTO_UPDATE_STATISTICS option applies to statistics objects created for indexes, single-columns in query predicates, and statistics created with the [CREATE STATISTICS](/sql/t-sql/statements/create-statistics-transact-sql) statement.</span></span> <span data-ttu-id="f3d59-143">Esta opción también se aplica a las estadísticas filtradas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-143">This option also applies to filtered statistics.</span></span>  
  
 <span data-ttu-id="f3d59-144">AUTO_UPDATE_STATISTICS_ASYNC</span><span class="sxs-lookup"><span data-stu-id="f3d59-144">AUTO_UPDATE_STATISTICS_ASYNC</span></span>  
 <span data-ttu-id="f3d59-145">La opción de actualización asincrónica de estadísticas AUTO_UPDATE_STATISTICS_ASYNC determina si el optimizador de consultas utiliza actualizaciones sincrónicas o asincrónicas de las estadísticas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-145">The asynchronous statistics update option, AUTO_UPDATE_STATISTICS_ASYNC, determines whether the query optimizer uses synchronous or asynchronous statistics updates.</span></span> <span data-ttu-id="f3d59-146">De forma predeterminada, la opción de actualización asincrónica de las estadísticas está desactivada y el optimizador de consultas actualiza las estadísticas sincrónicamente.</span><span class="sxs-lookup"><span data-stu-id="f3d59-146">By default, the asynchronous statistics update option is off, and the query optimizer updates statistics synchronously.</span></span> <span data-ttu-id="f3d59-147">La opción AUTO_UPDATE_STATISTICS_ASYNC se aplica a los objetos de estadísticas creados para índices y columnas únicas de los predicados de consulta, así como a las estadísticas creadas con la instrucción [CREATE STATISTICS](/sql/t-sql/statements/create-statistics-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="f3d59-147">The AUTO_UPDATE_STATISTICS_ASYNC option applies to statistics objects created for indexes, single columns in query predicates, and statistics created with the [CREATE STATISTICS](/sql/t-sql/statements/create-statistics-transact-sql) statement.</span></span>  
  
 <span data-ttu-id="f3d59-148">Las actualizaciones de las estadísticas pueden ser sincrónicas (el valor predeterminado) o asincrónicas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-148">Statistics updates can be either synchronous (the default) or asynchronous.</span></span> <span data-ttu-id="f3d59-149">Con actualizaciones sincrónicas de las estadísticas, las consultas siempre se compilan y ejecutan con estadísticas actualizadas; cuando las estadísticas están desusadas, el optimizador de consultas espera a que las estadísticas estén actualizadas antes de compilar y ejecutar la consulta.</span><span class="sxs-lookup"><span data-stu-id="f3d59-149">With synchronous statistics updates, queries always compile and execute with up-to-date statistics; When statistics are out-of-date, the query optimizer waits for updated statistics before compiling and executing the query.</span></span> <span data-ttu-id="f3d59-150">Con actualizaciones asincrónicas de las estadísticas, las consultas se compilan con las estadísticas existentes incluso aunque estén anticuadas; el optimizador de consultas podría elegir un plan de consulta poco óptimo si las estadísticas están desusadas cuando se compila la consulta.</span><span class="sxs-lookup"><span data-stu-id="f3d59-150">With asynchronous statistics updates, queries compile with existing statistics even if the existing statistics are out-of-date; The query optimizer could choose a suboptimal query plan if statistics are out-of-date when the query compiles.</span></span> <span data-ttu-id="f3d59-151">Las consultas que se compilan cuando las actualizaciones asincrónicas han finalizado se beneficiarán del uso de estadísticas actualizadas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-151">Queries that compile after the asynchronous updates have completed will benefit from using the updated statistics.</span></span>  
  
 <span data-ttu-id="f3d59-152">Considere la posibilidad de usar las estadísticas sincrónicas al realizar las operaciones que cambian la distribución de los datos, como truncar una tabla o realizar una actualización masiva de un gran porcentaje de las filas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-152">Consider using synchronous statistics when you perform operations that change the distribution of data, such as truncating a table or performing a bulk update of a large percentage of the rows.</span></span> <span data-ttu-id="f3d59-153">Si no actualiza las estadísticas después de finalizar la operación, el uso de estadísticas sincrónicas garantizará que las estadísticas estén actualizadas antes de ejecutar las consultas en los datos cambiados.</span><span class="sxs-lookup"><span data-stu-id="f3d59-153">If you do not update the statistics after completing the operation, using synchronous statistics will ensure statistics are up-to-date before executing queries on the changed data.</span></span>  
  
 <span data-ttu-id="f3d59-154">Considere el uso de estadísticas asincrónicas para lograr tiempos de respuesta a la consulta más predecibles en los escenarios siguientes:</span><span class="sxs-lookup"><span data-stu-id="f3d59-154">Consider using asynchronous statistics to achieve more predictable query response times for the following scenarios:</span></span>  
  
-   <span data-ttu-id="f3d59-155">Su aplicación ejecuta frecuentemente la misma consulta, consultas similares o los planes de consulta almacenados en memoria caché similares.</span><span class="sxs-lookup"><span data-stu-id="f3d59-155">Your application frequently executes the same query, similar queries, or similar cached query plans.</span></span> <span data-ttu-id="f3d59-156">Sus tiempos de respuesta a la consulta podrían ser más predecibles con actualizaciones asincrónicas de las estadísticas que con actualizaciones sincrónicas, porque el optimizador de consultas puede ejecutar las consultas de entrada sin esperar a que las estadísticas se actualicen.</span><span class="sxs-lookup"><span data-stu-id="f3d59-156">Your query response times might be more predictable with asynchronous statistics updates than with synchronous statistics updates because the query optimizer can execute incoming queries without waiting for up-to-date statistics.</span></span> <span data-ttu-id="f3d59-157">Esto evita que se retrasen algunas consultas, pero no otras.</span><span class="sxs-lookup"><span data-stu-id="f3d59-157">This avoids delaying some queries and not others.</span></span>  
  
-   <span data-ttu-id="f3d59-158">Su aplicación ha experimentado tiempos de espera de solicitud de cliente causados por una o varias consultas que aguardaban la actualización de estadísticas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-158">Your application has experienced client request time outs caused by one or more queries waiting for updated statistics.</span></span> <span data-ttu-id="f3d59-159">En algunos casos, la espera por las estadísticas sincrónicas podría causar errores en aplicaciones con tiempos de espera agresivos.</span><span class="sxs-lookup"><span data-stu-id="f3d59-159">In some cases, waiting for synchronous statistics could cause applications with aggressive time outs to fail.</span></span>  
  
 <span data-ttu-id="f3d59-160">INCREMENTAL STATS</span><span class="sxs-lookup"><span data-stu-id="f3d59-160">INCREMENTAL STATS</span></span>  
 <span data-ttu-id="f3d59-161">Cuando se establece en ON, se crean estadísticas por cada partición.</span><span class="sxs-lookup"><span data-stu-id="f3d59-161">When ON, the statistics created are per partition statistics.</span></span> <span data-ttu-id="f3d59-162">Cuando se establece en OFF, se quita el árbol de estadísticas y [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] recalcula las estadísticas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-162">When OFF, the statistics tree is dropped and [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] re-computes the statistics.</span></span> <span data-ttu-id="f3d59-163">El valor predeterminado es OFF.</span><span class="sxs-lookup"><span data-stu-id="f3d59-163">The default is OFF.</span></span> <span data-ttu-id="f3d59-164">Este valor invalida la propiedad INCREMENTAL de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="f3d59-164">This setting overrides the database level INCREMENTAL property.</span></span>  
  
 <span data-ttu-id="f3d59-165">Cuando se agregan particiones a una tabla grande, las estadísticas deben actualizarse para que incluyan las particiones nuevas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-165">When new partitions are added to a large table, statistics should be updated to include the new partitions.</span></span> <span data-ttu-id="f3d59-166">Sin embargo, el tiempo necesario para examinar la tabla completa (opción FULLSCAN o SAMPLE) puede ser bastante largo.</span><span class="sxs-lookup"><span data-stu-id="f3d59-166">However the time required to scan the entire table (FULLSCAN or SAMPLE option) might be quite long.</span></span> <span data-ttu-id="f3d59-167">Además, no es necesario examinar toda la tabla porque puede que solo se necesiten las estadísticas de las particiones nuevas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-167">Also, scanning the entire table isn't necessary because only the statistics on the new partitions might be needed.</span></span> <span data-ttu-id="f3d59-168">La opción incremental crea y almacena estadísticas sobre cada partición y, cuando se actualiza, solo actualiza las estadísticas de las particiones que necesitan estadísticas nuevas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-168">The incremental option creates and stores statistics on a per partition basis, and when updated, only refreshes statistics on those partitions that need new statistics</span></span>  
  
 <span data-ttu-id="f3d59-169">Si no se admiten las estadísticas por partición, la opción se omite y se genera una advertencia.</span><span class="sxs-lookup"><span data-stu-id="f3d59-169">If per partition statistics are not supported the option is ignored and a warning is generated.</span></span> <span data-ttu-id="f3d59-170">Las estadísticas incrementales no se admiten para los siguientes tipos de estadísticas:</span><span class="sxs-lookup"><span data-stu-id="f3d59-170">Incremental stats are not supported for following statistics types:</span></span>  
  
-   <span data-ttu-id="f3d59-171">Estadísticas creadas con índices que no están alineados por partición con la tabla base.</span><span class="sxs-lookup"><span data-stu-id="f3d59-171">Statistics created with indexes that are not partition-aligned with the base table.</span></span>  
  
-   <span data-ttu-id="f3d59-172">Estadísticas creadas sobre bases de datos secundarias legibles AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="f3d59-172">Statistics created on AlwaysOn readable secondary databases.</span></span>  
  
-   <span data-ttu-id="f3d59-173">Estadísticas creadas sobre bases de datos de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="f3d59-173">Statistics created on read-only databases.</span></span>  
  
-   <span data-ttu-id="f3d59-174">Estadísticas creadas sobre índices filtrados.</span><span class="sxs-lookup"><span data-stu-id="f3d59-174">Statistics created on filtered indexes.</span></span>  
  
-   <span data-ttu-id="f3d59-175">Estadísticas creadas sobre vistas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-175">Statistics created on views.</span></span>  
  
-   <span data-ttu-id="f3d59-176">Estadísticas creadas sobre tablas internas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-176">Statistics created on internal tables.</span></span>  
  
-   <span data-ttu-id="f3d59-177">Estadísticas creadas con índices espaciales o índices XML.</span><span class="sxs-lookup"><span data-stu-id="f3d59-177">Statistics created with spatial indexes or XML indexes.</span></span>  
  
||  
|-|  
|<span data-ttu-id="f3d59-178">**Se aplica a**: desde [!INCLUDE[ssSQL14](../../includes/sssql14-md.md)] hasta [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f3d59-178">**Applies to**: [!INCLUDE[ssSQL14](../../includes/sssql14-md.md)] through [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span>|  
  
##  <a name="when-to-create-statistics"></a><a name="CreateStatistics"></a><span data-ttu-id="f3d59-179">Cuándo crear las estadísticas</span><span class="sxs-lookup"><span data-stu-id="f3d59-179">When to Create Statistics</span></span>  
 <span data-ttu-id="f3d59-180">El optimizador de consultas crea ya las estadísticas de las maneras siguientes:</span><span class="sxs-lookup"><span data-stu-id="f3d59-180">The query optimizer already creates statistics in the following ways:</span></span>  
  
1.  <span data-ttu-id="f3d59-181">El optimizador de consultas crea las estadísticas para índices en tablas o vistas cuando se crea el índice.</span><span class="sxs-lookup"><span data-stu-id="f3d59-181">The query optimizer creates statistics for indexes on tables or views when the index is created.</span></span> <span data-ttu-id="f3d59-182">Estas estadísticas se crean en las columnas de clave del índice.</span><span class="sxs-lookup"><span data-stu-id="f3d59-182">These statistics are created on the key columns of the index.</span></span> <span data-ttu-id="f3d59-183">Si el índice es un índice filtrado, el optimizador de consultas crea las estadísticas filtradas en el mismo subconjunto de filas especificado para el índice filtrado.</span><span class="sxs-lookup"><span data-stu-id="f3d59-183">If the index is a filtered index, the query optimizer creates filtered statistics on the same subset of rows specified for the filtered index.</span></span> <span data-ttu-id="f3d59-184">Para obtener más información sobre los índices filtrados, vea [Crear índices filtrados](../indexes/create-filtered-indexes.md) y [CREATE INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-index-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f3d59-184">For more information about filtered indexes, see [Create Filtered Indexes](../indexes/create-filtered-indexes.md) and [CREATE INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-index-transact-sql).</span></span>  
  
2.  <span data-ttu-id="f3d59-185">El optimizador de consultas crea las estadísticas para las columnas únicas de predicados de consulta cuando está activada AUTO_CREATE_STATISTICS.</span><span class="sxs-lookup"><span data-stu-id="f3d59-185">The query optimizer creates statistics for single columns in query predicates when AUTO_CREATE_STATISTICS is on.</span></span>  
  
 <span data-ttu-id="f3d59-186">En la mayoría de las consultas, estos dos métodos de creación de estadísticas aseguran un plan de consulta de alta calidad; en unos casos, puede mejorar los planes de consulta creando estadísticas adicionales con la instrucción [CREATE STATISTICS](/sql/t-sql/statements/create-statistics-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="f3d59-186">For most queries, these two methods for creating statistics ensure a high-quality query plan; in a few cases, you can improve query plans by creating additional statistics with the [CREATE STATISTICS](/sql/t-sql/statements/create-statistics-transact-sql) statement.</span></span> <span data-ttu-id="f3d59-187">Estas estadísticas adicionales pueden capturar correlaciones estadísticas que el optimizador de consultas no tiene en cuenta cuando crea estadísticas para índices o columnas únicas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-187">These additional statistics can capture statistical correlations that the query optimizer does not account for when it creates statistics for indexes or single columns.</span></span> <span data-ttu-id="f3d59-188">Su aplicación podría tener las correlaciones estadísticas adicionales en los datos de la tabla que, si se calcula en un objeto de estadísticas, podrían habilitar el optimizador de consultas para mejorar los planes de consulta.</span><span class="sxs-lookup"><span data-stu-id="f3d59-188">Your application might have additional statistical correlations in the table data that, if calculated into a statistics object, could enable the query optimizer to improve query plans.</span></span> <span data-ttu-id="f3d59-189">Por ejemplo, las estadísticas filtradas en un subconjunto de filas de datos o las estadísticas de varias columnas en columnas de predicado de consulta podrían mejorar el plan de consulta.</span><span class="sxs-lookup"><span data-stu-id="f3d59-189">For example, filtered statistics on a subset of data rows or multicolumn statistics on query predicate columns might improve the query plan.</span></span>  
  
 <span data-ttu-id="f3d59-190">Al crear las estadísticas con la instrucción CREATE STATISTICS, recomendamos mantener la opción AUTO_CREATE_STATISTICS para que el optimizador de consultas continúe creando rutinariamente estadísticas de columna única para las columnas de predicado de consulta.</span><span class="sxs-lookup"><span data-stu-id="f3d59-190">When creating statistics with the CREATE STATISTICS statement, we recommend keeping the AUTO_CREATE_STATISTICS option on so that the query optimizer continues to routinely create single-column statistics for query predicate columns.</span></span> <span data-ttu-id="f3d59-191">Para obtener más información sobre los predicados de consulta, vea [Condición de búsqueda &#40;Transact-SQL&#41;](/sql/t-sql/queries/search-condition-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f3d59-191">For more information about query predicates, see [Search Condition &#40;Transact-SQL&#41;](/sql/t-sql/queries/search-condition-transact-sql).</span></span>  
  
 <span data-ttu-id="f3d59-192">Considere la creación de estadísticas con la instrucción CREATE STATISTICS cuando se aplique cualquiera de los escenarios siguientes:</span><span class="sxs-lookup"><span data-stu-id="f3d59-192">Consider creating statistics with the CREATE STATISTICS statement when any of the following applies:</span></span>  
  
-   <span data-ttu-id="f3d59-193">El Asistente para la optimización de [!INCLUDE[ssDE](../../../includes/ssde-md.md)] sugiere crear las estadísticas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-193">The [!INCLUDE[ssDE](../../../includes/ssde-md.md)] Tuning Advisor suggests creating statistics.</span></span>  
  
-   <span data-ttu-id="f3d59-194">El predicado de consulta contiene varias columnas correlacionadas que ya no están en el mismo índice.</span><span class="sxs-lookup"><span data-stu-id="f3d59-194">The query predicate contains multiple correlated columns that are not already in the same index.</span></span>  
  
-   <span data-ttu-id="f3d59-195">La consulta realiza la selección entre un subconjunto de datos.</span><span class="sxs-lookup"><span data-stu-id="f3d59-195">The query selects from a subset of data.</span></span>  
  
-   <span data-ttu-id="f3d59-196">La consulta ha perdido estadísticas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-196">The query has missing statistics.</span></span>  
  
### <a name="query-predicate-contains-multiple-correlated-columns"></a><span data-ttu-id="f3d59-197">El predicado de consulta contiene varias columnas correlacionadas</span><span class="sxs-lookup"><span data-stu-id="f3d59-197">Query Predicate Contains Multiple Correlated Columns</span></span>  
 <span data-ttu-id="f3d59-198">Cuando un predicado de consulta contiene varias columnas que tienen relaciones y dependencias entre columnas, las estadísticas sobre esas columnas podrían mejorar el plan de consulta.</span><span class="sxs-lookup"><span data-stu-id="f3d59-198">When a query predicate contains multiple columns that have cross-column relationships and dependencies, statistics on the multiple columns might improve the query plan.</span></span> <span data-ttu-id="f3d59-199">Las estadísticas sobre varias columnas contienen estadísticas de correlación entre columnas, llamadas *densidades*, que no están disponibles en las estadísticas de columna única.</span><span class="sxs-lookup"><span data-stu-id="f3d59-199">Statistics on multiple columns contain cross-column correlation statistics, called *densities*, that are not available in single-column statistics.</span></span> <span data-ttu-id="f3d59-200">Las densidades pueden mejorar las estimaciones de cardinalidad cuando los resultados de la consulta dependen de relaciones de los datos entre varias columnas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-200">Densities can improve cardinality estimates when query results depend on data relationships among multiple columns.</span></span>  
  
 <span data-ttu-id="f3d59-201">Si las columnas ya están en el mismo índice, el objeto de estadísticas de varias columnas ya existe y no es necesario crearlo manualmente.</span><span class="sxs-lookup"><span data-stu-id="f3d59-201">If the columns are already in the same index, the multicolumn statistics object already exists and it is not necessary to create it manually.</span></span> <span data-ttu-id="f3d59-202">Si las columnas no están ya en el mismo índice, puede crear las estadísticas de varias columnas creando un índice en las columnas o utilizando la instrucción CREATE STATISTICS.</span><span class="sxs-lookup"><span data-stu-id="f3d59-202">If the columns are not already in the same index, you can create multicolumn statistics by creating an index on the columns or by using the CREATE STATISTICS statement.</span></span> <span data-ttu-id="f3d59-203">Se necesitan más recursos del sistema para mantener un índice que para mantener un objeto de estadísticas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-203">It requires more system resources to maintain an index than a statistics object.</span></span> <span data-ttu-id="f3d59-204">Si la aplicación no requiere el índice de varias columnas, puede economizar en recursos del sistema creando el objeto de estadísticas sin crear el índice.</span><span class="sxs-lookup"><span data-stu-id="f3d59-204">If the application does not require the multicolumn index, you can economize on system resources by creating the statistics object without creating the index.</span></span>  
  
 <span data-ttu-id="f3d59-205">Al crear las estadísticas de varias columnas, el orden de las columnas en la definición del objeto de estadísticas afecta a la efectividad de las densidades para realizar las estimaciones de cardinalidad.</span><span class="sxs-lookup"><span data-stu-id="f3d59-205">When creating multicolumn statistics, the order of the columns in the statistics object definition affects the effectiveness of densities for making cardinality estimates.</span></span> <span data-ttu-id="f3d59-206">El objeto de estadísticas almacena las densidades correspondientes a cada prefijo de las columnas de clave en la definición del objeto de estadísticas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-206">The statistics object stores densities for each prefix of key columns in the statistics object definition.</span></span> <span data-ttu-id="f3d59-207">Para obtener más información sobre las densidades, vea [DBCC SHOW_STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/database-console-commands/dbcc-show-statistics-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f3d59-207">For more information about densities, see [DBCC SHOW_STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/database-console-commands/dbcc-show-statistics-transact-sql).</span></span>  
  
 <span data-ttu-id="f3d59-208">Para crear densidades que sean útiles para las estimaciones de cardinalidad, las columnas del predicado de consulta deben coincidir con uno de los prefijos de columnas de la definición del objeto de estadísticas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-208">To create densities that are useful for cardinality estimates, the columns in the query predicate must match one of the prefixes of columns in the statistics object definition.</span></span> <span data-ttu-id="f3d59-209">Por ejemplo, lo siguiente crea un objeto de estadísticas de varias columnas en las columnas `LastName`, `MiddleName`y `FirstName`.</span><span class="sxs-lookup"><span data-stu-id="f3d59-209">For example, the following creates a multicolumn statistics object on the columns `LastName`, `MiddleName`, and `FirstName`.</span></span>  
  
```  
USE AdventureWorks2012;  
GO  
IF EXISTS (SELECT name FROM sys.stats  
    WHERE name = 'LastFirst'  
    AND object_ID = OBJECT_ID ('Person.Person'))  
DROP STATISTICS Person.Person.LastFirst;  
GO  
CREATE STATISTICS LastFirst ON Person.Person (LastName, MiddleName, FirstName);  
GO  
```  
  
 <span data-ttu-id="f3d59-210">En este ejemplo, el objeto de estadísticas `LastFirst` tiene densidades para los siguientes prefijos de columna: (`LastName`), (`LastName, MiddleName`) y (`LastName, MiddleName, FirstName`).</span><span class="sxs-lookup"><span data-stu-id="f3d59-210">In this example, the statistics object `LastFirst` has densities for the following column prefixes: (`LastName`), (`LastName, MiddleName`), and (`LastName, MiddleName, FirstName`).</span></span> <span data-ttu-id="f3d59-211">La densidad no está disponible para (`LastName, FirstName`).</span><span class="sxs-lookup"><span data-stu-id="f3d59-211">The density is not available for (`LastName, FirstName`).</span></span> <span data-ttu-id="f3d59-212">Si la consulta utiliza `LastName` y `FirstName` sin utilizar `MiddleName`, la densidad no está disponible para las estimaciones de cardinalidad.</span><span class="sxs-lookup"><span data-stu-id="f3d59-212">If the query uses `LastName` and `FirstName` without using `MiddleName`, the density is not available for cardinality estimates.</span></span>  
  
### <a name="query-selects-from-a-subset-of-data"></a><span data-ttu-id="f3d59-213">La consulta realiza la selección entre un subconjunto de datos</span><span class="sxs-lookup"><span data-stu-id="f3d59-213">Query Selects from a Subset of Data</span></span>  
 <span data-ttu-id="f3d59-214">Cuando el optimizador de consultas crea las estadísticas para las columnas únicas e índices, crea las estadísticas para los valores de todas las filas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-214">When the query optimizer creates statistics for single columns and indexes, it creates the statistics for the values in all rows.</span></span> <span data-ttu-id="f3d59-215">Cuando las consultas realizan la selección de entre un subconjunto de filas, y ese subconjunto de filas tiene una distribución de datos única, las estadísticas filtradas pueden mejorar los planes de consulta.</span><span class="sxs-lookup"><span data-stu-id="f3d59-215">When queries select from a subset of rows, and that subset of rows has a unique data distribution, filtered statistics can improve query plans.</span></span> <span data-ttu-id="f3d59-216">Puede crear estadísticas filtradas utilizando la instrucción CREATE STATISTICS con la cláusula WHERE para definir la expresión del predicado de filtro.</span><span class="sxs-lookup"><span data-stu-id="f3d59-216">You can create filtered statistics by using the CREATE STATISTICS statement with the WHERE clause to define the filter predicate expression.</span></span>  
  
 <span data-ttu-id="f3d59-217">Por ejemplo, utilizando [!INCLUDE[ssSampleDBnormal](../../includes/sssampledbnormal-md.md)], cada producto de la tabla Production.Product pertenece a una de las cuatro categorías de la tabla Production.ProductCategory: Bikes, Components, Clothing y Accessories.</span><span class="sxs-lookup"><span data-stu-id="f3d59-217">For example, using [!INCLUDE[ssSampleDBnormal](../../includes/sssampledbnormal-md.md)], each product in the Production.Product table belongs to one of four categories in the Production.ProductCategory table: Bikes, Components, Clothing, and Accessories.</span></span> <span data-ttu-id="f3d59-218">Cada una de las categorías tiene una distribución de datos diferente en función del peso: el peso de las bicicletas (bikes) va de 13,77 a 30,0, el de los componentes (components) de 2,12 a 1050,00 con algunos valores NULL, todos los pesos de la ropa (clothing) son NULL, lo mismo que los de los accesorios (accessories).</span><span class="sxs-lookup"><span data-stu-id="f3d59-218">Each of the categories has a different data distribution for weight: bike weights range from 13.77 to 30.0, component weights range from 2.12 to 1050.00 with some NULL values, clothing weights are all NULL, and accessory weights are also NULL.</span></span>  
  
 <span data-ttu-id="f3d59-219">Utilizando las bicicletas (Bikes) como un ejemplo, las estadísticas filtradas en todo los pesos de bicicleta proporcionarán estadísticas más precisas al optimizador de consultas y podrán mejorar la calidad del plan de consulta en comparación con las estadísticas de tabla completa o las estadísticas no existentes en la columna Weight.</span><span class="sxs-lookup"><span data-stu-id="f3d59-219">Using Bikes as an example, filtered statistics on all bike weights will provide more accurate statistics to the query optimizer and can improve the query plan quality compared with full-table statistics or nonexistent statistics on the Weight column.</span></span> <span data-ttu-id="f3d59-220">La columna de peso de bicicleta es una buena candidata para las estadísticas filtradas, pero no necesariamente para un índice filtrado si el número de búsquedas de peso es relativamente pequeño.</span><span class="sxs-lookup"><span data-stu-id="f3d59-220">The bike weight column is a good candidate for filtered statistics but not necessarily a good candidate for a filtered index if the number of weight lookups is relatively small.</span></span> <span data-ttu-id="f3d59-221">La ganancia de rendimiento para las búsquedas que proporciona un índice filtrado no podría ser mayor que el mantenimiento adicional y el costo de almacenamiento de agregar un índice filtrado a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="f3d59-221">The performance gain for lookups that a filtered index provides might not outweigh the additional maintenance and storage cost for adding a filtered index to the database.</span></span>  
  
 <span data-ttu-id="f3d59-222">La instrucción siguiente crea las estadísticas filtradas `BikeWeights` en todas las subcategorías de Bikes.</span><span class="sxs-lookup"><span data-stu-id="f3d59-222">The following statement creates the `BikeWeights` filtered statistics on all of the subcategories for Bikes.</span></span> <span data-ttu-id="f3d59-223">La expresión de predicado filtrado define las bicicletas enumerando todas las subcategorías de bicicleta con la comparación `Production.ProductSubcategoryID IN (1,2,3)`.</span><span class="sxs-lookup"><span data-stu-id="f3d59-223">The filtered predicate expression defines bikes by enumerating all of the bike subcategories with the comparison `Production.ProductSubcategoryID IN (1,2,3)`.</span></span> <span data-ttu-id="f3d59-224">El predicado no puede utilizar el nombre de categoría Bikes porque está almacenado en la tabla Production.ProductCategory, mientras que todas las columnas de la expresión del filtro deben estar en la misma tabla.</span><span class="sxs-lookup"><span data-stu-id="f3d59-224">The predicate cannot use the Bikes category name because it is stored in the Production.ProductCategory table, and all columns in the filter expression must be in the same table.</span></span>  
  
 [!code-sql[StatisticsDDL#FilteredStats2](../../snippets/tsql/SQL14/tsql/statisticsddl/transact-sql/filteredstats.sql#filteredstats2)]  
  
 <span data-ttu-id="f3d59-225">El optimizador de consultas puede utilizar estadísticas filtradas de `BikeWeights` para mejorar el plan de consulta para la consulta siguiente que selecciona todas las bicicletas cuyo peso es superior a `25`.</span><span class="sxs-lookup"><span data-stu-id="f3d59-225">The query optimizer can use the `BikeWeights` filtered statistics to improve the query plan for the following query that selects all of the bikes that weigh more than `25`.</span></span>  
  
```  
SELECT P.Weight AS Weight, S.Name AS BikeName  
FROM Production.Product AS P  
    JOIN Production.ProductSubcategory AS S   
    ON P.ProductSubcategoryID = S.ProductSubcategoryID  
WHERE P.ProductSubcategoryID IN (1,2,3) AND P.Weight > 25  
ORDER BY P.Weight;  
GO  
```  
  
### <a name="query-identifies-missing-statistics"></a><span data-ttu-id="f3d59-226">Consulta que identifica las estadísticas que faltan</span><span class="sxs-lookup"><span data-stu-id="f3d59-226">Query Identifies Missing Statistics</span></span>  
 <span data-ttu-id="f3d59-227">Si un error u otro evento evita que el optimizador de consultas cree las estadísticas, el optimizador de consultas crea el plan de consulta sin utilizar las estadísticas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-227">If an error or other event prevents the query optimizer from creating statistics, the query optimizer creates the query plan without using statistics.</span></span> <span data-ttu-id="f3d59-228">El optimizador de consultas marca las estadísticas como perdidas e intenta regenerar las estadísticas la siguiente vez que se ejecuta la consulta.</span><span class="sxs-lookup"><span data-stu-id="f3d59-228">The query optimizer marks the statistics as missing and attempts to regenerate the statistics the next time the query is executed.</span></span>  
  
 <span data-ttu-id="f3d59-229">Las estadísticas perdidas se indican mediante advertencias (el nombre de la tabla aparece en rojo) cuando el plan de ejecución de una consulta se representa gráficamente mediante [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f3d59-229">Missing statistics are indicated as warnings (table name in red text) when the execution plan of a query is graphically displayed using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span></span> <span data-ttu-id="f3d59-230">Además, la supervisión de la clase de eventos **Missing Column Statistics** con [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] indica cuándo se han perdido las estadísticas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-230">Additionally, monitoring the **Missing Column Statistics** event class by using [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] indicates when statistics are missing.</span></span> <span data-ttu-id="f3d59-231">Para obtener más información, vea [Errores y advertencias &#40;categoría de eventos del motor de base de datos&#41;](../event-classes/errors-and-warnings-event-category-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="f3d59-231">For more information, see [Errors and Warnings Event Category &#40;Database Engine&#41;](../event-classes/errors-and-warnings-event-category-database-engine.md).</span></span>  
  
 <span data-ttu-id="f3d59-232">Si se han perdido estadísticas, siga estos pasos:</span><span class="sxs-lookup"><span data-stu-id="f3d59-232">If statistics are missing, perform the following steps:</span></span>  
  
-   <span data-ttu-id="f3d59-233">Compruebe que AUTO_CREATE_STATISTICS y AUTO_UPDATE_STATISTICS están activadas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-233">Verify that AUTO_CREATE_STATISTICS and AUTO_UPDATE_STATISTICS are on.</span></span>  
  
-   <span data-ttu-id="f3d59-234">Compruebe que la base de datos no es de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="f3d59-234">Verify that the database is not read-only.</span></span> <span data-ttu-id="f3d59-235">Si la base de datos es de solo lectura, el optimizador de consultas no puede guardar las estadísticas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-235">If the database is read-only, the query optimizer cannot save statistics.</span></span>  
  
-   <span data-ttu-id="f3d59-236">Cree las estadísticas perdidas usando la instrucción CREATE STATISTICS.</span><span class="sxs-lookup"><span data-stu-id="f3d59-236">Create the missing statistics by using the CREATE STATISTICS statement.</span></span>  
  
 <span data-ttu-id="f3d59-237">Cuando faltan las estadísticas de una base de datos de solo lectura o de una instantánea de solo lectura o son obsoletas, [!INCLUDE[ssDE](../../../includes/ssde-md.md)] crea y mantiene estadísticas temporales en `tempdb`.</span><span class="sxs-lookup"><span data-stu-id="f3d59-237">When statistics on a read-only database or read-only snapshot are missing or stale, the [!INCLUDE[ssDE](../../../includes/ssde-md.md)] creates and maintains temporary statistics in `tempdb`.</span></span> <span data-ttu-id="f3d59-238">Cuando [!INCLUDE[ssDE](../../../includes/ssde-md.md)] crea estadísticas temporales, el nombre de las estadísticas se anexan con el sufijo suffix _readonly_database_statistic para diferenciar las estadísticas temporales de las permanentes.</span><span class="sxs-lookup"><span data-stu-id="f3d59-238">When the [!INCLUDE[ssDE](../../../includes/ssde-md.md)] creates temporary statistics, the statistics name is appended with the suffix _readonly_database_statistic to differentiate the temporary statistics from the permanent statistics.</span></span> <span data-ttu-id="f3d59-239">El sufijo _readonly_database_statistic está reservado para las estadísticas que genera [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f3d59-239">The suffix _readonly_database_statistic is reserved for statistics generated by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="f3d59-240">Los scripts para las estadísticas temporales se pueden crear y reproducir en una base de datos de lectura-escritura.</span><span class="sxs-lookup"><span data-stu-id="f3d59-240">Scripts for the temporary statistics can be created and reproduced on a read-write database.</span></span> <span data-ttu-id="f3d59-241">Cuando se crea el script, [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] cambia el sufijo del nombre de las estadísticas de _readonly_database_statistic a _readonly_database_statistic_scripted.</span><span class="sxs-lookup"><span data-stu-id="f3d59-241">When scripted, [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] changes the suffix of the statistics name from _readonly_database_statistic to _readonly_database_statistic_scripted.</span></span>  
  
 <span data-ttu-id="f3d59-242">Solo [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] puede crear y actualizar las estadísticas temporales.</span><span class="sxs-lookup"><span data-stu-id="f3d59-242">Only [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] can create and update temporary statistics.</span></span> <span data-ttu-id="f3d59-243">No obstante, puede eliminar las estadísticas temporales y supervisar las propiedades de estadísticas mediante las mismas herramientas que se usan para las estadísticas permanentes:</span><span class="sxs-lookup"><span data-stu-id="f3d59-243">However, you can delete temporary statistics and monitor statistics properties using the same tools that you use for permanent statistics:</span></span>  
  
-   <span data-ttu-id="f3d59-244">Elimine las estadísticas temporales con la instrucción [DROP STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/statements/drop-statistics-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="f3d59-244">Delete temporary statistics using the [DROP STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/statements/drop-statistics-transact-sql) statement.</span></span>  
  
-   <span data-ttu-id="f3d59-245">Supervise las estadísticas con las vistas de catálogo **sys.stats** y **sys.stats_columns** .</span><span class="sxs-lookup"><span data-stu-id="f3d59-245">Monitor statistics using the **sys.stats** and **sys.stats_columns** catalog views.</span></span> <span data-ttu-id="f3d59-246">**sys_stats** incluye la columna **is_temporary** para indicar las estadísticas que son permanentes y las que son temporales.</span><span class="sxs-lookup"><span data-stu-id="f3d59-246">**sys_stats** includes the **is_temporary** column, to indicate which statistics are permanent and which are temporary.</span></span>  
  
 <span data-ttu-id="f3d59-247">Debido a que las estadísticas temporales se almacenan en `tempdb`, el reinicio del servicio [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] provoca que desaparezcan todas las estadísticas temporales.</span><span class="sxs-lookup"><span data-stu-id="f3d59-247">Because temporary statistics are stored in `tempdb`, a restart of the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] service causes all temporary statistics to disappear.</span></span>  
  
##  <a name="when-to-update-statistics"></a><a name="UpdateStatistics"></a><span data-ttu-id="f3d59-248">Cuándo actualizar las estadísticas</span><span class="sxs-lookup"><span data-stu-id="f3d59-248">When to Update Statistics</span></span>  
 <span data-ttu-id="f3d59-249">El optimizador de consultas determina cuándo las estadísticas podrían estar desusadas y, a continuación, las actualiza cuando es necesario para un plan de consulta.</span><span class="sxs-lookup"><span data-stu-id="f3d59-249">The query optimizer determines when statistics might be out-of-date and then updates them when they are needed for a query plan.</span></span> <span data-ttu-id="f3d59-250">En algunos casos puede mejorar el plan de consulta y, por consiguiente, mejorar el rendimiento de la consulta, actualizando las estadísticas con más frecuencia que la que se produce cuando está activada AUTO_UPDATE_STATISTICS.</span><span class="sxs-lookup"><span data-stu-id="f3d59-250">In some cases you can improve the query plan and therefore improve query performance by updating statistics more frequently than occur when AUTO_UPDATE_STATISTICS is on.</span></span> <span data-ttu-id="f3d59-251">Puede actualizar las estadísticas con la instrucción UPDATE STATISTICS o con el procedimiento almacenado sp_updatestats.</span><span class="sxs-lookup"><span data-stu-id="f3d59-251">You can update statistics with the UPDATE STATISTICS statement or the stored procedure sp_updatestats.</span></span>  
  
 <span data-ttu-id="f3d59-252">La actualización de las estadísticas asegura que las consultas se compilan con estadísticas actualizadas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-252">Updating statistics ensures that queries compile with up-to-date statistics.</span></span> <span data-ttu-id="f3d59-253">Sin embargo, la actualización de las estadísticas hace que las consultas se vuelvan a compilar.</span><span class="sxs-lookup"><span data-stu-id="f3d59-253">However, updating statistics causes queries to recompile.</span></span> <span data-ttu-id="f3d59-254">Recomendamos no actualizar las estadísticas con demasiada frecuencia, porque hay que elegir el punto válido entre la mejora de los planes de consulta y el tiempo empleado en volver a compilar las consultas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-254">We recommend not updating statistics too frequently because there is a performance tradeoff between improving query plans and the time it takes to recompile queries.</span></span> <span data-ttu-id="f3d59-255">Las compensaciones específicas dependen de su aplicación.</span><span class="sxs-lookup"><span data-stu-id="f3d59-255">The specific tradeoffs depend on your application.</span></span>  
  
 <span data-ttu-id="f3d59-256">Al actualizar las estadísticas con UPDATE STATISTICS o con sp_updatestats, recomendamos mantener activada AUTO_UPDATE_STATISTICS, para que el optimizador de consultas continúe actualizando rutinariamente las estadísticas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-256">When updating statistics with UPDATE STATISTICS or sp_updatestats, we recommend keeping AUTO_UPDATE_STATISTICS set to ON so that the query optimizer continues to routinely update statistics.</span></span> <span data-ttu-id="f3d59-257">Para obtener más información sobre cómo actualizar las estadísticas en una columna, un índice, una tabla o una vista indexada, vea [UPDATE STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/statements/update-statistics-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f3d59-257">For more information about how to update statistics on a column, an index, a table, or an indexed view, see [UPDATE STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/statements/update-statistics-transact-sql).</span></span> <span data-ttu-id="f3d59-258">Para obtener más información sobre cómo actualizar las estadísticas para todas las tablas internas y definidas por el usuario de la base de datos, vea el procedimiento almacenado [sp_updatestats &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f3d59-258">For information about how to update statistics for all user-defined and internal tables in the database, see the stored procedure [sp_updatestats &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql).</span></span>  
  
 <span data-ttu-id="f3d59-259">Para saber cuándo se actualizaron las estadísticas por última vez, use la función [STATS_DATE](/sql/t-sql/functions/stats-date-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="f3d59-259">To determine when statistics were last updated, use the [STATS_DATE](/sql/t-sql/functions/stats-date-transact-sql) function.</span></span>  
  
 <span data-ttu-id="f3d59-260">Considere la actualización de las estadísticas en las condiciones siguientes:</span><span class="sxs-lookup"><span data-stu-id="f3d59-260">Consider updating statistics for the following conditions:</span></span>  
  
-   <span data-ttu-id="f3d59-261">Los tiempos de ejecución de la consulta son lentos.</span><span class="sxs-lookup"><span data-stu-id="f3d59-261">Query execution times are slow.</span></span>  
  
-   <span data-ttu-id="f3d59-262">Se producen operaciones de inserción en columnas de clave ascendentes o descendentes.</span><span class="sxs-lookup"><span data-stu-id="f3d59-262">Insert operations occur on ascending or descending key columns.</span></span>  
  
-   <span data-ttu-id="f3d59-263">Después de las operaciones de mantenimiento.</span><span class="sxs-lookup"><span data-stu-id="f3d59-263">After maintenance operations.</span></span>  
  
### <a name="query-execution-times-are-slow"></a><span data-ttu-id="f3d59-264">Los tiempos de ejecución de la consulta son lentos</span><span class="sxs-lookup"><span data-stu-id="f3d59-264">Query Execution Times Are Slow</span></span>  
 <span data-ttu-id="f3d59-265">Si los tiempos de respuesta de la consulta son lentos o impredecibles, asegúrese de que las consultas tienen estadísticas actualizadas antes de realizar los pasos adicionales de la solución de problemas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-265">If query response times are slow or unpredictable, ensure that queries have up-to-date statistics before performing additional troubleshooting steps.</span></span>  
  
### <a name="insert-operations-occur-on-ascending-or-descending-key-columns"></a><span data-ttu-id="f3d59-266">Se producen operaciones de inserción en columnas de clave ascendentes o descendentes</span><span class="sxs-lookup"><span data-stu-id="f3d59-266">Insert Operations Occur on Ascending or Descending Key Columns</span></span>  
 <span data-ttu-id="f3d59-267">Las estadísticas de columnas de clave ascendentes o descendentes, como IDENTITY o las columnas de marca de tiempo en tiempo real, podrían requerir actualizaciones de las estadísticas más frecuentes que las que realiza el optimizador de consultas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-267">Statistics on ascending or descending key columns, such as IDENTITY or real-time timestamp columns, might require more frequent statistics updates than the query optimizer performs.</span></span> <span data-ttu-id="f3d59-268">Las operaciones de inserción anexan nuevos valores a las columnas ascendentes o descendentes.</span><span class="sxs-lookup"><span data-stu-id="f3d59-268">Insert operations append new values to ascending or descending columns.</span></span> <span data-ttu-id="f3d59-269">El número de filas agregado podría ser demasiado pequeño para desencadenar una actualización de las estadísticas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-269">The number of rows added might be too small to trigger a statistics update.</span></span> <span data-ttu-id="f3d59-270">Si las estadísticas no están actualizadas y las consultas se seleccionan de las filas recientemente agregadas, las estadísticas actuales no tendrán estimaciones de cardinalidad para estos nuevos valores.</span><span class="sxs-lookup"><span data-stu-id="f3d59-270">If statistics are not up-to-date and queries select from the most recently added rows, the current statistics will not have cardinality estimates for these new values.</span></span> <span data-ttu-id="f3d59-271">Esto puede producir estimaciones de cardinalidad inexactas y un rendimiento lento de las consultas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-271">This can result in inaccurate cardinality estimates and slow query performance.</span></span>  
  
 <span data-ttu-id="f3d59-272">Por ejemplo, una consulta que selecciona entre las fechas de pedidos de venta más recientes tendrá estimaciones de cardinalidad inexactas si las estadísticas no se han actualizado para incluir las estimaciones de cardinalidad correspondientes a las fechas de pedidos de venta más recientes.</span><span class="sxs-lookup"><span data-stu-id="f3d59-272">For example, a query that selects from the most recent sales order dates will have inaccurate cardinality estimates if the statistics are not updated to include cardinality estimates for the most recent sales order dates.</span></span>  
  
### <a name="after-maintenance-operations"></a><span data-ttu-id="f3d59-273">Después de las operaciones de mantenimiento</span><span class="sxs-lookup"><span data-stu-id="f3d59-273">After Maintenance Operations</span></span>  
 <span data-ttu-id="f3d59-274">Considere la actualización de las estadísticas después de haber realizado procedimientos de mantenimiento que cambian la distribución de los datos, como truncar una tabla o realizar una inserción masiva de un porcentaje grande de las filas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-274">Consider updating statistics after performing maintenance procedures that change the distribution of data, such as truncating a table or performing a bulk insert of a large percentage of the rows.</span></span> <span data-ttu-id="f3d59-275">Esto puede evitar los retrasos futuros en el procesamiento de la consulta, mientras las consultas esperan las actualizaciones automáticas de las estadísticas.</span><span class="sxs-lookup"><span data-stu-id="f3d59-275">This can avoid future delays in query processing while queries wait for automatic statistics updates.</span></span>  
  
 <span data-ttu-id="f3d59-276">Otras operaciones, como regenerar, desfragmentar o reorganizar un índice, no cambian la distribución de los datos.</span><span class="sxs-lookup"><span data-stu-id="f3d59-276">Operations such as rebuilding, defragmenting, or reorganizing an index do not change the distribution of data.</span></span> <span data-ttu-id="f3d59-277">Por consiguiente, no necesita actualizar las estadísticas después de realizar las operaciones ALTER INDEX REBUILD, DBCC REINDEX, DBCC INDEXDEFRAG o ALTER INDEX REORGANIZE.</span><span class="sxs-lookup"><span data-stu-id="f3d59-277">Therefore, you do not need to update statistics after performing ALTER INDEX REBUILD, DBCC REINDEX, DBCC INDEXDEFRAG, or ALTER INDEX REORGANIZE operations.</span></span> <span data-ttu-id="f3d59-278">El optimizador de consultas actualiza las estadísticas cuando regenera un índice en una tabla o vista con ALTER INDEX REBUILD o DBCC DBREINDEX, sin embargo; esta actualización de las estadísticas es un subproducto de la recreación del índice.</span><span class="sxs-lookup"><span data-stu-id="f3d59-278">The query optimizer updates statistics when you rebuild an index on a table or view with ALTER INDEX REBUILD or DBCC DBREINDEX, however; this statistics update is a byproduct of re-creating the index.</span></span> <span data-ttu-id="f3d59-279">El optimizador de consultas no actualiza las estadísticas después de las operaciones DBCC INDEXDEFRAG o ALTER INDEX REORGANIZE.</span><span class="sxs-lookup"><span data-stu-id="f3d59-279">The query optimizer does not update statistics after DBCC INDEXDEFRAG or ALTER INDEX REORGANIZE operations.</span></span>  
  
##  <a name="queries-that-use-statistics-effectively"></a><a name="DesignStatistics"></a><span data-ttu-id="f3d59-280">Consultas que usan eficazmente las estadísticas</span><span class="sxs-lookup"><span data-stu-id="f3d59-280">Queries That Use Statistics Effectively</span></span>  
 <span data-ttu-id="f3d59-281">Algunas implementaciones de consulta, como las variables locales y las expresiones complejas en el predicado de consulta, pueden conducir a planes de consulta que no son óptimos.</span><span class="sxs-lookup"><span data-stu-id="f3d59-281">Certain query implementations, such as local variables and complex expressions in the query predicate, can lead to suboptimal query plans.</span></span> <span data-ttu-id="f3d59-282">Las siguientes instrucciones de diseño de consulta para el uso eficaz de las estadísticas pueden evitarlo.</span><span class="sxs-lookup"><span data-stu-id="f3d59-282">Following query design guidelines for using statistics effectively can help to avoid this.</span></span> <span data-ttu-id="f3d59-283">Para obtener más información sobre los predicados de consulta, vea [Condición de búsqueda &#40;Transact-SQL&#41;](/sql/t-sql/queries/search-condition-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f3d59-283">For more information about query predicates, see [Search Condition &#40;Transact-SQL&#41;](/sql/t-sql/queries/search-condition-transact-sql).</span></span>  
  
 <span data-ttu-id="f3d59-284">Puede mejorar los planes de consulta aplicando instrucciones de diseño de consulta que utilicen las estadísticas con eficacia para mejorar las *estimaciones de cardinalidad* en las expresiones, variables y funciones utilizadas en los predicados de consulta.</span><span class="sxs-lookup"><span data-stu-id="f3d59-284">You can improve query plans by applying query design guidelines that use statistics effectively to improve *cardinality estimates* for expressions, variables, and functions used in query predicates.</span></span> <span data-ttu-id="f3d59-285">Cuando el optimizador de consultas no conoce el valor de una expresión, variable o función, no conoce qué valor ha de buscar en el histograma y, por consiguiente, no puede recuperar del histograma la mejor estimación de cardinalidad.</span><span class="sxs-lookup"><span data-stu-id="f3d59-285">When the query optimizer does not know the value of an expression, variable, or function, it does not know which value to lookup in the histogram and therefore cannot retrieve the best cardinality estimate from the histogram.</span></span> <span data-ttu-id="f3d59-286">En cambio, el optimizador de consultas basa la estimación de cardinalidad en el número medio de filas por valor distinto para todas las filas buscadas en el histograma.</span><span class="sxs-lookup"><span data-stu-id="f3d59-286">Instead, the query optimizer bases the cardinality estimate on the average number of rows per distinct value for all of the sampled rows in the histogram.</span></span> <span data-ttu-id="f3d59-287">El resultado son estimaciones de cardinalidad poco óptimas, además de dañar el rendimiento de la consulta.</span><span class="sxs-lookup"><span data-stu-id="f3d59-287">This leads to suboptimal cardinality estimates and can hurt query performance.</span></span>  
  
 <span data-ttu-id="f3d59-288">Las instrucciones siguientes describen cómo escribir las consultas para mejorar los planes de consulta mediante la mejora de las estimaciones de cardinalidad.</span><span class="sxs-lookup"><span data-stu-id="f3d59-288">The following guidelines describe how to write queries to improve query plans by improving cardinality estimates.</span></span>  
  
### <a name="improving-cardinality-estimates-for-expressions"></a><span data-ttu-id="f3d59-289">Mejorar las estimaciones de cardinalidad en las expresiones</span><span class="sxs-lookup"><span data-stu-id="f3d59-289">Improving Cardinality Estimates for Expressions</span></span>  
 <span data-ttu-id="f3d59-290">Para mejorar las estimaciones de cardinalidad en las expresiones, siga estas instrucciones:</span><span class="sxs-lookup"><span data-stu-id="f3d59-290">To improve cardinality estimates for expressions, follow these guidelines:</span></span>  
  
-   <span data-ttu-id="f3d59-291">Siempre que sea posible, simplifique las expresiones utilizando constantes.</span><span class="sxs-lookup"><span data-stu-id="f3d59-291">Whenever possible, simplify expressions with constants in them.</span></span> <span data-ttu-id="f3d59-292">El optimizador de consultas no evalúa todas las funciones y expresiones que contienen constantes antes de determinar las estimaciones de cardinalidad.</span><span class="sxs-lookup"><span data-stu-id="f3d59-292">The query optimizer does not evaluate all functions and expressions containing constants prior to determining cardinality estimates.</span></span> <span data-ttu-id="f3d59-293">Por ejemplo, simplifique la expresión ABS (`-100) to 100`.</span><span class="sxs-lookup"><span data-stu-id="f3d59-293">For example, simplify the expression ABS(`-100) to 100`.</span></span>  
  
-   <span data-ttu-id="f3d59-294">Si la expresión utiliza varias variables, considere la creación de una columna calculada para la expresión y, a continuación, cree estadísticas o un índice en la columna calculada.</span><span class="sxs-lookup"><span data-stu-id="f3d59-294">If the expression uses multiple variables, consider creating a computed column for the expression and then create statistics or an index on the computed column.</span></span> <span data-ttu-id="f3d59-295">Por ejemplo, el predicado de consulta `WHERE PRICE + Tax > 100` podría tener una mejor estimación de cardinalidad si crea una columna calculada para la expresión `Price + Tax`.</span><span class="sxs-lookup"><span data-stu-id="f3d59-295">For example, the query predicate `WHERE PRICE + Tax > 100` might have a better cardinality estimate if you create a computed column for the expression `Price + Tax`.</span></span>  
  
### <a name="improving-cardinality-estimates-for-variables-and-functions"></a><span data-ttu-id="f3d59-296">Mejorar las estimaciones de cardinalidad en las variables y funciones</span><span class="sxs-lookup"><span data-stu-id="f3d59-296">Improving Cardinality Estimates for Variables and Functions</span></span>  
 <span data-ttu-id="f3d59-297">Para mejorar las estimaciones de cardinalidad en las variables y funciones, siga estas instrucciones:</span><span class="sxs-lookup"><span data-stu-id="f3d59-297">To improve the cardinality estimates for variables and functions, follow these guidelines:</span></span>  
  
-   <span data-ttu-id="f3d59-298">Si el predicado de consulta utiliza una variable local, considere volver a escribir la consulta usando un parámetro en lugar de una variable local.</span><span class="sxs-lookup"><span data-stu-id="f3d59-298">If the query predicate uses a local variable, consider rewriting the query to use a parameter instead of a local variable.</span></span> <span data-ttu-id="f3d59-299">No se conoce el valor de una variable local cuando el optimizador de consultas crea el plan de ejecución de la consulta.</span><span class="sxs-lookup"><span data-stu-id="f3d59-299">The value of a local variable is not known when the query optimizer creates the query execution plan.</span></span> <span data-ttu-id="f3d59-300">Cuando una consulta utiliza un parámetro, el optimizador de consultas utiliza la estimación de cardinalidad para el primer valor de parámetro real que se pasa al procedimiento almacenado.</span><span class="sxs-lookup"><span data-stu-id="f3d59-300">When a query uses a parameter, the query optimizer uses the cardinality estimate for the first actual parameter value that is passed to the stored procedure.</span></span>  
  
-   <span data-ttu-id="f3d59-301">Considere el uso de una tabla estándar o una tabla temporal para retener los resultados de las funciones con valores de tabla de múltiples instrucciones.</span><span class="sxs-lookup"><span data-stu-id="f3d59-301">Consider using a standard table or temporary table to hold the results of multi-statement table-valued functions.</span></span> <span data-ttu-id="f3d59-302">El optimizador de consultas no crea estadísticas para las funciones con valores de tabla de múltiples instrucciones.</span><span class="sxs-lookup"><span data-stu-id="f3d59-302">The query optimizer does not create statistics for multi-statement table-valued functions.</span></span> <span data-ttu-id="f3d59-303">Con este enfoque, el optimizador de consultas puede crear estadísticas sobre las columnas de tabla y utilizarlas para crear un plan de consulta mejor.</span><span class="sxs-lookup"><span data-stu-id="f3d59-303">With this approach the query optimizer can create statistics on the table columns and use them to create a better query plan.</span></span>  
  
-   <span data-ttu-id="f3d59-304">Considere el uso de una tabla estándar o una tabla temporal como un reemplazo para las variables de tabla.</span><span class="sxs-lookup"><span data-stu-id="f3d59-304">Consider using a standard table or temporary table as a replacement for table variables.</span></span> <span data-ttu-id="f3d59-305">El optimizador de consultas no crea estadísticas para las variables de tabla.</span><span class="sxs-lookup"><span data-stu-id="f3d59-305">The query optimizer does not create statistics for table variables.</span></span> <span data-ttu-id="f3d59-306">Con este enfoque, el optimizador de consultas puede crear estadísticas sobre las columnas de tabla y utilizarlas para crear un plan de consulta mejor.</span><span class="sxs-lookup"><span data-stu-id="f3d59-306">With this approach the query optimizer can create statistics on the table columns and use them to create a better query plan.</span></span> <span data-ttu-id="f3d59-307">Hay que determinar si se utilizar una tabla temporal o una variable de tabla; las variables de tabla utilizadas en los procedimientos almacenados causan menos recompilaciones del procedimiento almacenado que las tablas temporales.</span><span class="sxs-lookup"><span data-stu-id="f3d59-307">There are tradeoffs in determining whether to use a temporary table or a table variable; Table variables used in stored procedures cause fewer recompilations of the stored procedure than temporary tables.</span></span> <span data-ttu-id="f3d59-308">Dependiendo de la aplicación, el uso de una tabla temporal en lugar de una variable de tabla no mejora el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="f3d59-308">Depending on the application, using a temporary table instead of a table variable might not improve performance.</span></span>  
  
-   <span data-ttu-id="f3d59-309">Si un procedimiento almacenado contiene una consulta que utiliza un parámetro pasado, evite cambiar el valor del parámetro dentro del procedimiento almacenado antes de utilizarlo en la consulta.</span><span class="sxs-lookup"><span data-stu-id="f3d59-309">If a stored procedure contains a query that uses a passed-in parameter, avoid changing the parameter value within the stored procedure before using it in the query.</span></span> <span data-ttu-id="f3d59-310">Las estimaciones de cardinalidad para la consulta se basan en el valor de parámetro pasado y no en el valor actualizado.</span><span class="sxs-lookup"><span data-stu-id="f3d59-310">The cardinality estimates for the query are based on the passed-in parameter value and not the updated value.</span></span> <span data-ttu-id="f3d59-311">Para evitar cambiar el valor del parámetro, puede reescribir la consulta para utilizar los dos procedimientos almacenados.</span><span class="sxs-lookup"><span data-stu-id="f3d59-311">To avoid changing the parameter value, you can rewrite the query to use two stored procedures.</span></span>  
  
     <span data-ttu-id="f3d59-312">Por ejemplo, el procedimiento almacenado siguiente `Sales.GetRecentSales` cambia el valor del parámetro `@date` cuando `@date is NULL`.</span><span class="sxs-lookup"><span data-stu-id="f3d59-312">For example, the following stored procedure `Sales.GetRecentSales` changes the value of the parameter `@date` when `@date is NULL`.</span></span>  
  
    ```  
    USE AdventureWorks2012;  
    GO  
    IF OBJECT_ID ( 'Sales.GetRecentSales', 'P') IS NOT NULL  
        DROP PROCEDURE Sales.GetRecentSales;  
    GO  
    CREATE PROCEDURE Sales.GetRecentSales (@date datetime)  
    AS BEGIN  
        IF @date is NULL  
            SET @date = DATEADD(MONTH, -3, (SELECT MAX(ORDERDATE) FROM Sales.SalesOrderHeader))  
        SELECT * FROM Sales.SalesOrderHeader h, Sales.SalesOrderDetail d  
        WHERE h.SalesOrderID = d.SalesOrderID  
        AND h.OrderDate > @date  
    END  
    GO  
    ```  
  
     <span data-ttu-id="f3d59-313">Si la primera llamada al procedimiento almacenado `Sales.GetRecentSales` pasa un NULL para el parámetro `@date` , el optimizador de consultas compilará el procedimiento almacenado con la estimación de cardinalidad para `@date = NULL` aunque no se llame al predicado de consulta con `@date = NULL`.</span><span class="sxs-lookup"><span data-stu-id="f3d59-313">If the first call to the stored procedure `Sales.GetRecentSales` passes a NULL for the `@date` parameter, the query optimizer will compile the stored procedure with the cardinality estimate for `@date = NULL` even though the query predicate is not called with `@date = NULL`.</span></span> <span data-ttu-id="f3d59-314">Esta estimación de cardinalidad podría ser significativamente diferente del número de filas del resultado de la consulta real.</span><span class="sxs-lookup"><span data-stu-id="f3d59-314">This cardinality estimate might be significantly different than the number of rows in the actual query result.</span></span> <span data-ttu-id="f3d59-315">Como resultado, el optimizador de consultas podría elegir un plan de consulta poco óptimo.</span><span class="sxs-lookup"><span data-stu-id="f3d59-315">As a result, the query optimizer might choose a suboptimal query plan.</span></span> <span data-ttu-id="f3d59-316">Para ayudar a evitar esto, puede rescribir el procedimiento almacenado en dos procedimientos del modo siguiente:</span><span class="sxs-lookup"><span data-stu-id="f3d59-316">To help avoid this, you can rewrite the stored procedure into two procedures as follows:</span></span>  
  
    ```  
    USE AdventureWorks2012;  
    GO  
    IF OBJECT_ID ( 'Sales.GetNullRecentSales', 'P') IS NOT NULL  
        DROP PROCEDURE Sales.GetNullRecentSales;  
    GO  
    CREATE PROCEDURE Sales.GetNullRecentSales (@date datetime)  
    AS BEGIN  
        IF @date is NULL  
            SET @date = DATEADD(MONTH, -3, (SELECT MAX(ORDERDATE) FROM Sales.SalesOrderHeader))  
        EXEC Sales.GetNonNullRecentSales @date;  
    END  
    GO  
    IF OBJECT_ID ( 'Sales.GetNonNullRecentSales', 'P') IS NOT NULL  
        DROP PROCEDURE Sales.GetNonNullRecentSales;  
    GO  
    CREATE PROCEDURE Sales.GetNonNullRecentSales (@date datetime)  
    AS BEGIN  
        SELECT * FROM Sales.SalesOrderHeader h, Sales.SalesOrderDetail d  
        WHERE h.SalesOrderID = d.SalesOrderID  
        AND h.OrderDate > @date  
    END  
    GO  
    ```  
  
### <a name="improving-cardinality-estimates-with-query-hints"></a><span data-ttu-id="f3d59-317">Mejorar las estimaciones de cardinalidad con sugerencias de consulta</span><span class="sxs-lookup"><span data-stu-id="f3d59-317">Improving Cardinality Estimates with Query Hints</span></span>  
 <span data-ttu-id="f3d59-318">Para mejorar las estimaciones de cardinalidad para las variables locales, puede utilizar las sugerencias de consulta OPTIMIZE FOR u OPTIMIZE FOR UNKNOWN junto con RECOMPILE.</span><span class="sxs-lookup"><span data-stu-id="f3d59-318">To improve cardinality estimates for local variables, you can use the OPTIMIZE FOR or OPTIMIZE FOR UNKNOWN query hints with RECOMPILE.</span></span> <span data-ttu-id="f3d59-319">Para obtener más información, vea [Sugerencias de consulta &#40;Transact-SQL&#41;](/sql/t-sql/queries/hints-transact-sql-query).</span><span class="sxs-lookup"><span data-stu-id="f3d59-319">For more information, see [Query Hints &#40;Transact-SQL&#41;](/sql/t-sql/queries/hints-transact-sql-query).</span></span>  
  
 <span data-ttu-id="f3d59-320">En algunas aplicaciones, volver a compilar la consulta cada vez que la ejecuta podría tardar demasiado tiempo.</span><span class="sxs-lookup"><span data-stu-id="f3d59-320">For some applications, recompiling the query each time it executes might take too much time.</span></span> <span data-ttu-id="f3d59-321">La sugerencia de consulta OPTIMIZER FOR puede servir de ayuda incluso si no usa la opción RECOMPILE.</span><span class="sxs-lookup"><span data-stu-id="f3d59-321">The OPTIMIZER FOR query hint can help even if you don't use the RECOMPILE option.</span></span> <span data-ttu-id="f3d59-322">Por ejemplo, podría agregar una opción OPTIMIZER FOR al procedimiento almacenado Sales.GetRecentSales para especificar una fecha concreta.</span><span class="sxs-lookup"><span data-stu-id="f3d59-322">For example, you could add an OPTIMIZER FOR option to the stored procedure Sales.GetRecentSales to specify a specific date.</span></span> <span data-ttu-id="f3d59-323">En el ejemplo siguiente se agrega la opción OPTIMIZE FOR al procedimiento Sales.GetRecentSales.</span><span class="sxs-lookup"><span data-stu-id="f3d59-323">The following example adds the OPTIMIZE FOR option to the Sales.GetRecentSales procedure.</span></span>  
  
```sql
USE AdventureWorks2012;  
GO  
IF OBJECT_ID ( 'Sales.GetRecentSales', 'P') IS NOT NULL  
    DROP PROCEDURE Sales.GetRecentSales;  
GO  
CREATE PROCEDURE Sales.GetRecentSales (@date datetime)  
AS BEGIN  
    IF @date is NULL  
        SET @date = DATEADD(MONTH, -3, (SELECT MAX(ORDERDATE) FROM Sales.SalesOrderHeader))  
    SELECT * FROM Sales.SalesOrderHeader h, Sales.SalesOrderDetail d  
    WHERE h.SalesOrderID = d.SalesOrderID  
    AND h.OrderDate > @date  
    OPTION ( OPTIMIZE FOR ( @date = '2004-05-01 00:00:00.000'))  
END;  
GO  
```  
  
### <a name="improving-cardinality-estimates-with-plan-guides"></a><span data-ttu-id="f3d59-324">Mejorar las estimaciones de cardinalidad con guías de plan</span><span class="sxs-lookup"><span data-stu-id="f3d59-324">Improving Cardinality Estimates with Plan Guides</span></span>  
 <span data-ttu-id="f3d59-325">En algunas aplicaciones, podrían no aplicarse las instrucciones de diseño de consulta, porque no puede cambiar la consulta o porque usar la sugerencia de consulta RECOMPILE podría ser la causa de demasiadas recompilaciones.</span><span class="sxs-lookup"><span data-stu-id="f3d59-325">For some applications, query design guidelines might not apply because you cannot change the query or using the RECOMPILE query hint might be cause too many recompiles.</span></span> <span data-ttu-id="f3d59-326">Puede utilizar las guías de plan para especificar otras sugerencias, como USE PLAN, para controlar el comportamiento de la consulta mientras investiga los cambios de la aplicación con el proveedor de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="f3d59-326">You can use plan guides to specify other hints, such as USE PLAN, to control the behavior of the query while investigating application changes with the application vendor.</span></span> <span data-ttu-id="f3d59-327">Para obtener más información acerca de las guías de plan, vea [Plan Guides](../performance/plan-guides.md).</span><span class="sxs-lookup"><span data-stu-id="f3d59-327">For more information about plan guides, see [Plan Guides](../performance/plan-guides.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f3d59-328">Consulte también</span><span class="sxs-lookup"><span data-stu-id="f3d59-328">See Also</span></span>  
 <span data-ttu-id="f3d59-329">[CREATE STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-statistics-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="f3d59-329">[CREATE STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-statistics-transact-sql) </span></span>  
 <span data-ttu-id="f3d59-330">[UPDATE STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/statements/update-statistics-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="f3d59-330">[UPDATE STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/statements/update-statistics-transact-sql) </span></span>  
 <span data-ttu-id="f3d59-331">[sp_updatestats &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="f3d59-331">[sp_updatestats &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql) </span></span>  
 <span data-ttu-id="f3d59-332">[DBCC SHOW_STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/database-console-commands/dbcc-show-statistics-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="f3d59-332">[DBCC SHOW_STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/database-console-commands/dbcc-show-statistics-transact-sql) </span></span>  
 <span data-ttu-id="f3d59-333">[Opciones de ALTER DATABASE SET &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql-set-options) </span><span class="sxs-lookup"><span data-stu-id="f3d59-333">[ALTER DATABASE SET Options &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql-set-options) </span></span>  
 <span data-ttu-id="f3d59-334">[DROP STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/statements/drop-statistics-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="f3d59-334">[DROP STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/statements/drop-statistics-transact-sql) </span></span>  
 <span data-ttu-id="f3d59-335">[CREATE INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-index-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="f3d59-335">[CREATE INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-index-transact-sql) </span></span>  
 <span data-ttu-id="f3d59-336">[ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="f3d59-336">[ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql) </span></span>  
 [<span data-ttu-id="f3d59-337">Creación de índices filtrados</span><span class="sxs-lookup"><span data-stu-id="f3d59-337">Create Filtered Indexes</span></span>](../indexes/create-filtered-indexes.md)  
