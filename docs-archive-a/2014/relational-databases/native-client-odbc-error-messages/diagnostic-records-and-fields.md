---
title: Registros y campos de diagnóstico | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- header records [ODBC]
- SQL Server Native Client ODBC driver, errors
- messages [ODBC], diagnostic records
- ODBC error handling, diagnostic records
- SQLGetDiagField function
- diagnostic records [ODBC]
- errors [ODBC], diagnostic records
- fields [ODBC]
- status information [ODBC]
ms.assetid: 4949530c-62d1-4f1a-b592-144244444ce0
author: rothja
ms.author: jroth
ms.openlocfilehash: 4fe52b211eb6d5a0e4d875264609d036702b2b0b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87748773"
---
# <a name="diagnostic-records-and-fields"></a><span data-ttu-id="6a17a-102">Registros y campos de diagnóstico</span><span class="sxs-lookup"><span data-stu-id="6a17a-102">Diagnostic Records and Fields</span></span>
  <span data-ttu-id="6a17a-103">Los registros de diagnóstico se asocian a controladores de entorno, conexión, instrucción o descriptor de ODBC.</span><span class="sxs-lookup"><span data-stu-id="6a17a-103">Diagnostic records are associated with ODBC environment, connection, statement, or descriptor handles.</span></span> <span data-ttu-id="6a17a-104">Cuando una función de ODBC genera un código de retorno distinto de SQL_SUCCESS o SQL_INVALID_HANDLE, el identificador que llama la función incluye registros de diagnóstico asociados que contienen mensajes informativos o de error.</span><span class="sxs-lookup"><span data-stu-id="6a17a-104">When any ODBC function raises a return code other than SQL_SUCCESS or SQL_INVALID_HANDLE, the handle called by the function has associated diagnostic records that contain informational or error messages.</span></span> <span data-ttu-id="6a17a-105">Estos registros se conservan hasta que se llama a otra función con el mismo identificador, momento en el cual se descartan.</span><span class="sxs-lookup"><span data-stu-id="6a17a-105">These records are retained until another function is called using that handle, at which time they are discarded.</span></span> <span data-ttu-id="6a17a-106">No hay ningún límite al número de registros de diagnóstico que pueden estar asociados a un identificador en un momento determinado.</span><span class="sxs-lookup"><span data-stu-id="6a17a-106">There is no limit to the number of diagnostic records that can be associated with a handle at any one time.</span></span>  
  
 <span data-ttu-id="6a17a-107">Existen dos tipos de registros de diagnóstico: encabezado y estado.</span><span class="sxs-lookup"><span data-stu-id="6a17a-107">There are two types of diagnostic records: header and status.</span></span> <span data-ttu-id="6a17a-108">El registro de encabezado es el registro 0; cuando hay registros de estado, son registros 1 y posteriores.</span><span class="sxs-lookup"><span data-stu-id="6a17a-108">The header record is record 0; when there are status records, they are records 1 and later.</span></span> <span data-ttu-id="6a17a-109">Los registros de diagnóstico contienen diferentes campos para el registro de encabezado y los registros de estado.</span><span class="sxs-lookup"><span data-stu-id="6a17a-109">Diagnostic records contain different fields for the header record and the status records.</span></span> <span data-ttu-id="6a17a-110">Los componentes ODBC también pueden definir sus propios campos de registro de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="6a17a-110">ODBC components can also define their own diagnostic record fields.</span></span>  
  
 <span data-ttu-id="6a17a-111">Los campos del registro de encabezado contienen información general sobre la ejecución de una función, incluido el código de retorno, el recuento de filas, el número de registros de estado y tipo de instrucción ejecutada.</span><span class="sxs-lookup"><span data-stu-id="6a17a-111">Fields in the header record contain general information about a function's execution, including the return code, row count, number of status records, and type of statement executed.</span></span> <span data-ttu-id="6a17a-112">El registro de encabezado se crea siempre, a menos que una función de ODBC devuelva SQL_INVALID_HANDLE.</span><span class="sxs-lookup"><span data-stu-id="6a17a-112">The header record is always created unless an ODBC function returns SQL_INVALID_HANDLE.</span></span> <span data-ttu-id="6a17a-113">Para obtener una lista completa de los campos del registro de encabezado, vea [SQLGetDiagField](../native-client-odbc-api/sqlgetdiagfield.md).</span><span class="sxs-lookup"><span data-stu-id="6a17a-113">For a complete list of fields in the header record, see [SQLGetDiagField](../native-client-odbc-api/sqlgetdiagfield.md).</span></span>  
  
 <span data-ttu-id="6a17a-114">Los campos de los registros de estado contienen información sobre errores o advertencias concretos devueltos por el Administrador de controladores ODBC, el controlador o el origen de datos, incluidos SQLSTATE, el número de error nativo, el mensaje de diagnóstico, el número de columna y el número de fila.</span><span class="sxs-lookup"><span data-stu-id="6a17a-114">Fields in the status records contain information about specific errors or warnings returned by the ODBC Driver Manager, driver, or data source, including the SQLSTATE, native error number, diagnostic message, column number, and row number.</span></span> <span data-ttu-id="6a17a-115">Los registros de estado solamente se crean si la función devuelve SQL_ERROR, SQL_SUCCESS_WITH_INFO, SQL_NO_DATA, SQL_NEED_DATA o SQL_STILL_EXECUTING.</span><span class="sxs-lookup"><span data-stu-id="6a17a-115">Status records are created only if the function returns SQL_ERROR, SQL_SUCCESS_WITH_INFO, SQL_NO_DATA, SQL_NEED_DATA, or SQL_STILL_EXECUTING.</span></span> <span data-ttu-id="6a17a-116">Para obtener una lista completa de los campos de los registros de estado, vea **SQLGetDiagField**.</span><span class="sxs-lookup"><span data-stu-id="6a17a-116">For a complete list of fields in the status records, see **SQLGetDiagField**.</span></span>  
  
 <span data-ttu-id="6a17a-117">**SQLGetDiagRec** recupera un solo registro de diagnóstico junto con su SQLSTATE ODBC, el número de error nativo y los campos de mensaje de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="6a17a-117">**SQLGetDiagRec** retrieves a single diagnostic record along with its ODBC SQLSTATE, native error number, and diagnostic-message fields.</span></span> <span data-ttu-id="6a17a-118">Esta funcionalidad es similar a la de ODBC 2. _x_**SQLError** (función).</span><span class="sxs-lookup"><span data-stu-id="6a17a-118">This functionality is similar to the ODBC 2._x_**SQLError** function.</span></span> <span data-ttu-id="6a17a-119">La función de control de errores más sencilla en ODBC 3. *x* es llamar repetidamente a **SQLGetDiagRec** a partir del parámetro *RecNumber* establecido en 1 e incrementar *RecNumber* en 1 hasta que **SQLGetDiagRec** devuelva SQL_NO_DATA.</span><span class="sxs-lookup"><span data-stu-id="6a17a-119">The simplest error-handling function in ODBC 3.*x* is to repeatedly call **SQLGetDiagRec** starting with the *RecNumber* parameter set to 1 and incrementing *RecNumber* by 1 until **SQLGetDiagRec** returns SQL_NO_DATA.</span></span> <span data-ttu-id="6a17a-120">Esto es equivalente a ODBC 2. aplicación *x* que llama a **SQLError** hasta que devuelve SQL_NO_DATA_FOUND.</span><span class="sxs-lookup"><span data-stu-id="6a17a-120">This is equivalent to an ODBC 2.*x* application calling **SQLError** until it returns SQL_NO_DATA_FOUND.</span></span>  
  
 <span data-ttu-id="6a17a-121">ODBC 3. *x* admite mucha más información de diagnóstico que ODBC 2. *x*.</span><span class="sxs-lookup"><span data-stu-id="6a17a-121">ODBC 3.*x* supports much more diagnostic information than ODBC 2.*x*.</span></span> <span data-ttu-id="6a17a-122">Esta información se almacena en campos adicionales en los registros de diagnóstico recuperados mediante **SQLGetDiagField**.</span><span class="sxs-lookup"><span data-stu-id="6a17a-122">This information is stored in additional fields in diagnostic records retrieved by using **SQLGetDiagField**.</span></span>  
  
 <span data-ttu-id="6a17a-123">El [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] controlador ODBC de Native Client tiene campos de diagnóstico específicos del controlador que se pueden recuperar con **SQLGetDiagField**.</span><span class="sxs-lookup"><span data-stu-id="6a17a-123">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC driver has driver-specific diagnostic fields that can be retrieved with **SQLGetDiagField**.</span></span> <span data-ttu-id="6a17a-124">Las etiquetas de estos campos específicos de controlador se definen en sqlncli.h.</span><span class="sxs-lookup"><span data-stu-id="6a17a-124">Labels for these driver-specific fields are defined in sqlncli.h.</span></span> <span data-ttu-id="6a17a-125">Utilice estas etiquetas para recuperar el estado de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], el nivel de gravedad, el nombre de servidor, el nombre de procedimiento y el número de línea asociados a cada registro de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="6a17a-125">Use these labels to retrieve the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] state, severity level, server name, procedure name, and line number associated with each diagnostic record.</span></span> <span data-ttu-id="6a17a-126">Además, SQLNCLI. h contiene definiciones de los códigos que el controlador utiliza para identificar las instrucciones Transact-SQL si una aplicación llama a **SQLGetDiagField** con *DiagIdentifier* establecido en SQL_DIAG_DYNAMIC_FUNCTION_CODE.</span><span class="sxs-lookup"><span data-stu-id="6a17a-126">Also, sqlncli.h contains definitions of the codes the driver uses to identify Transact-SQL statements if an application calls **SQLGetDiagField** with *DiagIdentifier* set to SQL_DIAG_DYNAMIC_FUNCTION_CODE.</span></span>  
  
 <span data-ttu-id="6a17a-127">El administrador de controladores ODBC procesa **SQLGetDiagField** con la información de error que almacena en caché desde el controlador subyacente.</span><span class="sxs-lookup"><span data-stu-id="6a17a-127">**SQLGetDiagField** is processed by the ODBC Driver Manager using error information it caches from the underlying driver.</span></span> <span data-ttu-id="6a17a-128">El Administrador de controladores ODBC no almacena en caché los campos de diagnóstico específicos del controlador hasta que no se ha realizado una conexión correcta.</span><span class="sxs-lookup"><span data-stu-id="6a17a-128">The ODBC Driver Manager does not cache driver-specific diagnostic fields until after a successful connection has been made.</span></span> <span data-ttu-id="6a17a-129">**SQLGetDiagField** devuelve SQL_ERROR si se llama para obtener campos de diagnóstico específicos del controlador antes de que se haya completado una conexión correcta.</span><span class="sxs-lookup"><span data-stu-id="6a17a-129">**SQLGetDiagField** returns SQL_ERROR if it is called to get driver-specific diagnostic fields before a successful connection has been completed.</span></span> <span data-ttu-id="6a17a-130">Si una función de conexión de ODBC devuelve SQL_SUCCESS_WITH_INFO, los campos de diagnóstico específicos del controlador todavía no están disponibles en la función de conexión.</span><span class="sxs-lookup"><span data-stu-id="6a17a-130">If an ODBC connect function returns SQL_SUCCESS_WITH_INFO, the driver-specific diagnostic fields for the connect function are not yet available.</span></span> <span data-ttu-id="6a17a-131">Puede empezar a llamar a **SQLGetDiagField** para los campos de diagnóstico específicos del controlador solo después de haber realizado otra llamada a una función ODBC después de la función de conexión.</span><span class="sxs-lookup"><span data-stu-id="6a17a-131">You can start calling **SQLGetDiagField** for driver-specific diagnostic fields only after you have made another ODBC function call after the connect function.</span></span>  
  
 <span data-ttu-id="6a17a-132">La mayoría de los errores detectados por el [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] controlador ODBC de Native Client se pueden diagnosticar de forma eficaz usando únicamente la información devuelta por **SQLGetDiagRec**.</span><span class="sxs-lookup"><span data-stu-id="6a17a-132">Most errors reported by the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC driver can be effectively diagnosed using only the information returned by **SQLGetDiagRec**.</span></span> <span data-ttu-id="6a17a-133">En algunos casos, sin embargo, la información que devuelven los campos de diagnóstico específicos del controlador es importante para diagnosticar un error.</span><span class="sxs-lookup"><span data-stu-id="6a17a-133">In some cases, however, the information returned by the driver-specific diagnostic fields is important in diagnosing an error.</span></span> <span data-ttu-id="6a17a-134">Al codificar un controlador de errores ODBC para aplicaciones que usan el [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] controlador ODBC de Native Client, se recomienda usar también **SQLGetDiagField** para recuperar al menos los campos específicos del controlador SQL_DIAG_SS_MSGSTATE y SQL_DIAG_SS_SEVERITY.</span><span class="sxs-lookup"><span data-stu-id="6a17a-134">When coding an ODBC error handler for applications using the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC driver, it is a good idea to also use **SQLGetDiagField** to retrieve at least the SQL_DIAG_SS_MSGSTATE and SQL_DIAG_SS_SEVERITY driver-specific fields.</span></span> <span data-ttu-id="6a17a-135">Si un error determinado se puede producir en varias ubicaciones del código de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], SQL_DIAG_SS_MSGSTATE indica a un ingeniero de soporte técnico de Microsoft de forma específica dónde se ha producido el error, lo que en ocasiones ayuda a diagnosticar un problema.</span><span class="sxs-lookup"><span data-stu-id="6a17a-135">If a particular error can be raised at several locations in the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] code, SQL_DIAG_SS_MSGSTATE indicates to a Microsoft support engineer specifically where an error was raised, which sometimes aids in diagnosing a problem.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="6a17a-136">Consulte también</span><span class="sxs-lookup"><span data-stu-id="6a17a-136">See Also</span></span>  
 [<span data-ttu-id="6a17a-137">Controlar errores y mensajes</span><span class="sxs-lookup"><span data-stu-id="6a17a-137">Handling Errors and Messages</span></span>](handling-errors-and-messages.md)  
  
  
