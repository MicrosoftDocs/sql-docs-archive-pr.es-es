---
title: Índices de almacén de columnas descritos | Microsoft Docs
ms.custom: ''
ms.date: 03/07/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: table-view-index
ms.topic: conceptual
helpviewer_keywords:
- indexes creation, columnstore
- indexes [SQL Server], columnstore
- columnstore index
- columnstore index, described
- xVelocity, columnstore indexes
ms.assetid: f98af4a5-4523-43b1-be8d-1b03c3217839
author: mikeraymsft
ms.author: mikeray
ms.openlocfilehash: 80a29b8e8cc5b53c09369156a5cf5f717e9447a0
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87749858"
---
# <a name="columnstore-indexes-described"></a><span data-ttu-id="7898d-102">Columnstore Indexes Described</span><span class="sxs-lookup"><span data-stu-id="7898d-102">Columnstore Indexes Described</span></span>
  <span data-ttu-id="7898d-103">El [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] *Índice de almacén de columnas en memoria* almacena y administra los datos mediante el almacenamiento de datos basado en columnas y el procesamiento de consultas basado en columnas.</span><span class="sxs-lookup"><span data-stu-id="7898d-103">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] *in-memory columnstore index* stores and manages data by using column-based data storage and column-based query processing.</span></span> <span data-ttu-id="7898d-104">Los índices de almacén de columnas funcionan correctamente para las cargas de trabajo de almacenamiento de datos que ejecutan principalmente cargas masivas y consultas de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="7898d-104">Columnstore indexes work well for data warehousing workloads that primarily perform bulk loads and read-only queries.</span></span> <span data-ttu-id="7898d-105">Use el índice de almacén de columnas para aumentar **hasta en diez veces el rendimiento de las consultas** en relación con el almacenamiento tradicional orientado a filas, y hasta **en siete veces la compresión de datos** en relación con el tamaño de los datos sin comprimir.</span><span class="sxs-lookup"><span data-stu-id="7898d-105">Use the columnstore index to achieve up to **10x query performance** gains over traditional row-oriented storage, and up to **7x data compression** over the uncompressed data size.</span></span>

> [!NOTE]
>  <span data-ttu-id="7898d-106">Consideramos que el índice clúster de almacén de columnas es el estándar para el almacenamiento de grandes tablas de hechos de almacenamiento de datos, y esperamos que se use en la mayoría de los escenarios de almacenamiento de datos.</span><span class="sxs-lookup"><span data-stu-id="7898d-106">We view the clustered columnstore index as the standard for storing large data warehousing fact tables, and expect it will be used in most data warehousing scenarios.</span></span> <span data-ttu-id="7898d-107">Puesto que el índice de almacén de columnas clúster es actualizable, la carga de trabajo puede realizar un gran número operaciones de inserción, actualización y eliminación.</span><span class="sxs-lookup"><span data-stu-id="7898d-107">Since the clustered columnstore index is updateable, your workload can perform a large number of insert, update, and delete operations.</span></span>

## <a name="contents"></a><span data-ttu-id="7898d-108">Contenido</span><span class="sxs-lookup"><span data-stu-id="7898d-108">Contents</span></span>

-   [<span data-ttu-id="7898d-109">Conceptos básicos</span><span class="sxs-lookup"><span data-stu-id="7898d-109">Basics</span></span>](#basics)

-   [<span data-ttu-id="7898d-110">Cargar datos</span><span class="sxs-lookup"><span data-stu-id="7898d-110">Loading Data</span></span>](#dataload)

-   [<span data-ttu-id="7898d-111">Sugerencias para mejorar el rendimiento</span><span class="sxs-lookup"><span data-stu-id="7898d-111">Performance Tips</span></span>](#performance)

-   [<span data-ttu-id="7898d-112">Temas y tareas relacionados</span><span class="sxs-lookup"><span data-stu-id="7898d-112">Related Tasks and Topics</span></span>](#related)

##  <a name="basics"></a><a name="basics"></a><span data-ttu-id="7898d-113">Conceptos básicos</span><span class="sxs-lookup"><span data-stu-id="7898d-113">Basics</span></span>
 <span data-ttu-id="7898d-114">Un *columnstore index* es una tecnología de almacenamiento, recuperación y administración de datos que emplea un formato de datos en columnas denominado almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="7898d-114">A *columnstore index* is a technology for storing, retrieving and managing data by using a columnar data format, called a columnstore.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="7898d-115">admite índices clúster y no clúster de almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="7898d-115">supports both clustered and nonclustered columnstore indexes.</span></span> <span data-ttu-id="7898d-116">Ambos usan la misma tecnología de almacén de columnas en memoria, pero tienen algunas diferencias en cuanto a su propósito y las funciones que admiten.</span><span class="sxs-lookup"><span data-stu-id="7898d-116">Both use the same in-memory columnstore technology, but they do have differences in purpose and in features they support.</span></span>

###  <a name="benefits"></a><a name="benefits"></a> <span data-ttu-id="7898d-117">Ventajas</span><span class="sxs-lookup"><span data-stu-id="7898d-117">Benefits</span></span>
 <span data-ttu-id="7898d-118">Los índices de almacén de columnas funcionan correctamente con la mayoría de las consultas de solo lectura que realizan análisis en conjuntos de datos grandes.</span><span class="sxs-lookup"><span data-stu-id="7898d-118">Columnstore indexes work well for mostly read-only queries that perform analysis on large data sets.</span></span> <span data-ttu-id="7898d-119">A menudo, se trata de consultas de cargas de trabajo de almacenamiento de datos.</span><span class="sxs-lookup"><span data-stu-id="7898d-119">Often, these are queries for data warehousing workloads.</span></span> <span data-ttu-id="7898d-120">Los índices de almacén de columnas ofrecen alto rendimiento para las consultas que usan recorridos de tabla completos y no son adecuados para las consultas que buscan un valor concreto en los datos.</span><span class="sxs-lookup"><span data-stu-id="7898d-120">Columnstore indexes give high performance gains for queries that use full table scans, and are not well-suited for queries that seek into the data, searching for a particular value.</span></span>

 <span data-ttu-id="7898d-121">Ventajas de los índices de almacén de columnas:</span><span class="sxs-lookup"><span data-stu-id="7898d-121">Columnstore Index benefits:</span></span>

-   <span data-ttu-id="7898d-122">Las columnas a menudo tienen datos similares, lo que da como resultado factores de compresión altos.</span><span class="sxs-lookup"><span data-stu-id="7898d-122">Columns often have similar data, which results in high compression rates.</span></span>

-   <span data-ttu-id="7898d-123">Los factores de compresión altos mejoran el rendimiento de las consultas mediante la utilización de una superficie en memoria menor.</span><span class="sxs-lookup"><span data-stu-id="7898d-123">High compression rates improve query performance by using a smaller in-memory footprint.</span></span> <span data-ttu-id="7898d-124">A su vez, el rendimiento de las consultas puede mejorar porque [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] puede realizar más consultas y operaciones de datos en memoria.</span><span class="sxs-lookup"><span data-stu-id="7898d-124">In turn, query performance can improve because [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] can perform more query and data operations in-memory.</span></span>

-   <span data-ttu-id="7898d-125">Se ha agregado a SQL Server un nuevo mecanismo de ejecución de consultas denominado ejecución en modo por lotes que reduce considerablemente el uso de CPU.</span><span class="sxs-lookup"><span data-stu-id="7898d-125">A new query execution mechanism called batch-mode execution has been added to SQL Server that reduces CPU usage by a large amount.</span></span> <span data-ttu-id="7898d-126">La ejecución en modo por lotes está estrechamente integrada con el formato de almacenamiento de almacén de columnas y optimizada alrededor del mismo.</span><span class="sxs-lookup"><span data-stu-id="7898d-126">Batch-mode execution is closely integrated with, and optimized around, the columnstore storage format.</span></span> <span data-ttu-id="7898d-127">La ejecución en modo por lotes se conoce en ocasiones como ejecución basada en vectores o vectorizada.</span><span class="sxs-lookup"><span data-stu-id="7898d-127">Batch-mode execution is sometimes known as vector-based or vectorized execution.</span></span>

-   <span data-ttu-id="7898d-128">Con frecuencia, las consultas seleccionan únicamente unas pocas columnas de una tabla, lo que reduce la E/S total desde los medios físicos.</span><span class="sxs-lookup"><span data-stu-id="7898d-128">Queries often select only a few columns from a table, which reduces total I/O from the physical media.</span></span>

### <a name="columnstore-versions"></a><span data-ttu-id="7898d-129">Versiones de almacén de columnas</span><span class="sxs-lookup"><span data-stu-id="7898d-129">Columnstore Versions</span></span>
 <span data-ttu-id="7898d-130">SQL Server 2012, Almacenamiento de datos paralelos de SQL Server 2012 y SQL Server 2014 emplean índices de almacén de columnas para acelerar las consultas comunes de almacenamiento de datos.</span><span class="sxs-lookup"><span data-stu-id="7898d-130">SQL Server 2012, SQL Server 2012 Parallel Data Warehouse, and SQL Server 2014 all use columnstore indexes to accelerate common data warehouse queries.</span></span> <span data-ttu-id="7898d-131">SQL Server 2012 presentó dos nuevas características: un índice no clúster de almacén de columnas y una capacidad de ejecución basada en vectores que procesa los datos en unidades denominadas "lotes".</span><span class="sxs-lookup"><span data-stu-id="7898d-131">SQL Server 2012 introduced two new features: a nonclustered columnstore index and a vector-based query execution capability that processes data in units called "batches."</span></span> <span data-ttu-id="7898d-132">SQL Server 2014 cuenta con las características de SQL Server 2012, además de índices clúster de almacén de columnas actualizables.</span><span class="sxs-lookup"><span data-stu-id="7898d-132">SQL Server 2014 has the features of SQL Server 2012 plus updateable clustered columnstore indexes.</span></span>

### <a name="key-characteristics"></a><span data-ttu-id="7898d-133">Características clave</span><span class="sxs-lookup"><span data-stu-id="7898d-133">Key Characteristics</span></span>

||
|-|
|<span data-ttu-id="7898d-134">**Se aplica a**: desde [!INCLUDE[ssSQL14](../../includes/sssql14-md.md)] hasta [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="7898d-134">**Applies to**: [!INCLUDE[ssSQL14](../../includes/sssql14-md.md)] through [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span></span>|

 <span data-ttu-id="7898d-135">En [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], un índice clúster de almacén de columnas:</span><span class="sxs-lookup"><span data-stu-id="7898d-135">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], a clustered columnstore index:</span></span>

-   <span data-ttu-id="7898d-136">Está disponible en las ediciones Enterprise, Developer y Evaluation.</span><span class="sxs-lookup"><span data-stu-id="7898d-136">Is available in Enterprise, Developer, and Evaluation editions.</span></span>

-   <span data-ttu-id="7898d-137">Es actualizable.</span><span class="sxs-lookup"><span data-stu-id="7898d-137">Is updateable.</span></span>

-   <span data-ttu-id="7898d-138">Es el método de almacenamiento principal de toda la tabla.</span><span class="sxs-lookup"><span data-stu-id="7898d-138">Is the primary storage method for the entire table.</span></span>

-   <span data-ttu-id="7898d-139">No tiene ninguna columna de clave.</span><span class="sxs-lookup"><span data-stu-id="7898d-139">Has no key columns.</span></span> <span data-ttu-id="7898d-140">Todas las columnas son columnas incluidas.</span><span class="sxs-lookup"><span data-stu-id="7898d-140">All columns are included columns.</span></span>

-   <span data-ttu-id="7898d-141">Es el único índice de la tabla.</span><span class="sxs-lookup"><span data-stu-id="7898d-141">Is the only index on the table.</span></span> <span data-ttu-id="7898d-142">No se puede combinar con ningún otro índice.</span><span class="sxs-lookup"><span data-stu-id="7898d-142">It cannot be combined with any other indexes.</span></span>

-   <span data-ttu-id="7898d-143">Se puede configurar para usar almacén de columnas o compresión de archivo de almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="7898d-143">Can be configured to use columnstore or columnstore archival compression.</span></span>

-   <span data-ttu-id="7898d-144">No almacena físicamente las columnas de forma ordenada.</span><span class="sxs-lookup"><span data-stu-id="7898d-144">Does not physically store columns in a sorted order.</span></span> <span data-ttu-id="7898d-145">En su lugar, almacena los datos para mejorar la compresión y el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="7898d-145">Instead, it stores data to improve compression and performance.</span></span>

||
|-|
|<span data-ttu-id="7898d-146">**Se aplica a**: desde [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] hasta [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="7898d-146">**Applies to**: [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] through [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span></span>|

 <span data-ttu-id="7898d-147">En [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], un índice no clúster de almacén de columnas:</span><span class="sxs-lookup"><span data-stu-id="7898d-147">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], a nonclustered columnstore index:</span></span>

-   <span data-ttu-id="7898d-148">Puede indizar un subconjunto de columnas del índice clúster o el montón.</span><span class="sxs-lookup"><span data-stu-id="7898d-148">Can index a subset of columns in the clustered index or heap.</span></span> <span data-ttu-id="7898d-149">Por ejemplo, puede indizar las columnas usadas con frecuencia.</span><span class="sxs-lookup"><span data-stu-id="7898d-149">For example, it can index the frequently used columns.</span></span>

-   <span data-ttu-id="7898d-150">Necesita almacenamiento adicional para almacenar una copia de las columnas en el índice.</span><span class="sxs-lookup"><span data-stu-id="7898d-150">Requires extra storage to store a copy of the columns in the index.</span></span>

-   <span data-ttu-id="7898d-151">Se actualiza regenerando el índice o cambiando las particiones dentro y fuera. No se actualiza mediante el uso de las operaciones DML, como INSERT, Update y DELETE.</span><span class="sxs-lookup"><span data-stu-id="7898d-151">Is updated by rebuilding the index or switching partitions in and out. It is not updateable by using the DML operations such as insert, update, and delete.</span></span>

-   <span data-ttu-id="7898d-152">Se puede combinar con otros índices de la tabla.</span><span class="sxs-lookup"><span data-stu-id="7898d-152">Can be combined with other indexes on the table.</span></span>

-   <span data-ttu-id="7898d-153">Se puede configurar para usar almacén de columnas o compresión de archivo de almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="7898d-153">Can be configured to use columnstore or columnstore archival compression.</span></span>

-   <span data-ttu-id="7898d-154">No almacena físicamente las columnas de forma ordenada.</span><span class="sxs-lookup"><span data-stu-id="7898d-154">Does not physically store columns in a sorted order.</span></span> <span data-ttu-id="7898d-155">En su lugar, almacena los datos para mejorar la compresión y el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="7898d-155">Instead, it stores data to improve compression and performance.</span></span> <span data-ttu-id="7898d-156">No es necesario ordenar los datos antes de crear el índice de almacén de columnas, pero si se hace puede mejorar la compresión de almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="7898d-156">Pre-sorting the data before creating the columnstore index is not required, but can improve columnstore compression.</span></span>

###  <a name="key-concepts-and-terms"></a><a name="Concepts"></a><span data-ttu-id="7898d-157">Conceptos y términos clave</span><span class="sxs-lookup"><span data-stu-id="7898d-157">Key Concepts and Terms</span></span>
 <span data-ttu-id="7898d-158">Los términos y conceptos clave siguientes están asociados a los índices de almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="7898d-158">The following key terms and concepts are associated with columnstore indexes.</span></span>

 <span data-ttu-id="7898d-159">Índice de almacén de columnas un *Índice de almacén* de columnas es una tecnología para almacenar, recuperar y administrar datos mediante el uso de un formato de datos en columnas denominado almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="7898d-159">columnstore index A *columnstore index* is a technology for storing, retrieving and managing data by using a columnar data format, called a columnstore.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="7898d-160">admite índices clúster y no clúster de almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="7898d-160">supports both clustered and nonclustered columnstore indexes.</span></span> <span data-ttu-id="7898d-161">Ambos usan la misma tecnología de almacén de columnas en memoria, pero tienen algunas diferencias en cuanto a su propósito y las funciones que admiten.</span><span class="sxs-lookup"><span data-stu-id="7898d-161">Both use the same in-memory columnstore technology, but they do have differences in purpose and in features they support.</span></span>

 <span data-ttu-id="7898d-162">almacén de columnas: un *almacén* de columnas es datos organizados lógicamente como una tabla con filas y columnas, y almacenados físicamente en un formato de datos de columna.</span><span class="sxs-lookup"><span data-stu-id="7898d-162">columnstore A *columnstore* is data that is logically organized as a table with rows and columns, and physically stored in a column-wise data format.</span></span>

 <span data-ttu-id="7898d-163">almacén un *almacén* son datos organizados lógicamente como una tabla con filas y columnas, y almacenados físicamente en un formato de datos de modo de fila.</span><span class="sxs-lookup"><span data-stu-id="7898d-163">rowstore A *rowstore* is data that is logically organized as a table with rows and columns, and then physically stored in a row-wise data format.</span></span> <span data-ttu-id="7898d-164">Esta ha sido la forma tradicional de almacenar los datos de una tabla relacional.</span><span class="sxs-lookup"><span data-stu-id="7898d-164">This has been the traditional way to store relational table data.</span></span>

 <span data-ttu-id="7898d-165">filas y segmentos de columna para altas tasas de alto rendimiento y compresión, el índice de almacén de columnas segmenta la tabla en grupos de filas, denominados grupos de filas, y, a continuación, comprime cada grupo de filas de forma que sea de columna.</span><span class="sxs-lookup"><span data-stu-id="7898d-165">rowgroups and column segments For high performance and high compression rates, the columnstore index slices the table into groups of rows, called row groups, and then compresses each row group in a column-wise manner.</span></span> <span data-ttu-id="7898d-166">El número de filas del grupo de filas debe ser suficientemente grande como para mejorar las tasas de compresión y suficientemente pequeño como para beneficiarse de las operaciones en memoria.</span><span class="sxs-lookup"><span data-stu-id="7898d-166">The number of rows in the row group must be large enough to improve compression rates, and small enough to benefit from in-memory operations.</span></span>

 <span data-ttu-id="7898d-167">Grupo de filas un *filas* es un grupo de filas que se comprimen al mismo tiempo en el formato de almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="7898d-167">row group A *rowgroup* is a group of rows that are compressed into columnstore format at the same time.</span></span>

 <span data-ttu-id="7898d-168">segmento de columna: un *segmento de columna* es una columna de datos que se encuentra dentro de filas.</span><span class="sxs-lookup"><span data-stu-id="7898d-168">column segment A *column segment* is a column of data from within the rowgroup.</span></span>

-   <span data-ttu-id="7898d-169">Un grupo de filas suele contener el número máximo de filas por grupo, que es 1.048.576 filas.</span><span class="sxs-lookup"><span data-stu-id="7898d-169">A rowgroup usually contains the maximum number of rows per rowgroup which is 1,048,576 rows.</span></span>

-   <span data-ttu-id="7898d-170">Cada grupo de filas contiene un segmento de cada columna de la tabla.</span><span class="sxs-lookup"><span data-stu-id="7898d-170">Each rowgroup contains one column segment for every column in the table.</span></span>

-   <span data-ttu-id="7898d-171">Cada sector de columna se comprime junto y se almacena en un medio físico.</span><span class="sxs-lookup"><span data-stu-id="7898d-171">Each column segment is compressed together and stored on physical media.</span></span>

 <span data-ttu-id="7898d-172">![Segmento de columna](../../database-engine/media/sql-server-pdw-columnstore-columnsegment.gif "segmento de columna")</span><span class="sxs-lookup"><span data-stu-id="7898d-172">![Column segment](../../database-engine/media/sql-server-pdw-columnstore-columnsegment.gif "Column segment")</span></span>

 <span data-ttu-id="7898d-173">Índice de almacén de columnas no agrupado un índice de almacén de columnas no *agrupado* es un índice de solo lectura creado en una tabla de montón o índice clúster existente.</span><span class="sxs-lookup"><span data-stu-id="7898d-173">nonclustered columnstore index A *nonclustered columnstore index* is a read-only index created on an existing clustered index or heap table.</span></span> <span data-ttu-id="7898d-174">Contiene una copia de un subconjunto de columnas, hasta incluir todas las columnas de la tabla.</span><span class="sxs-lookup"><span data-stu-id="7898d-174">It contains a copy of a subset of columns, up to and including all of the columns in the table..</span></span> <span data-ttu-id="7898d-175">La tabla es de solo lectura mientras contiene un índice no clúster de almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="7898d-175">The table is read-only while it contains a nonclustered columnstore index.</span></span>

 <span data-ttu-id="7898d-176">Un índice no clúster de almacén de columnas proporciona una manera de tener un índice de almacén de columnas para ejecutar consultas de análisis al tiempo que se realizan operaciones de solo lectura en la tabla original.</span><span class="sxs-lookup"><span data-stu-id="7898d-176">A nonclustered columnstore index provides a way to have a columnstore index for running analysis queries while at the same time performing read-only operations on the original table.</span></span>

 <span data-ttu-id="7898d-177">![índice no clúster de almacén de columnas](../../database-engine/media/sql-server-pdw-columnstore-physicalstorage-nonclustered.gif "índice no clúster de almacén de columnas")</span><span class="sxs-lookup"><span data-stu-id="7898d-177">![Nonclustered columnstore index](../../database-engine/media/sql-server-pdw-columnstore-physicalstorage-nonclustered.gif "Nonclustered columnstore index")</span></span>

 <span data-ttu-id="7898d-178">Índice de almacén de columnas en clúster: un índice de almacén de columnas *agrupado* es el almacenamiento físico de toda la tabla y es el único índice de la tabla.</span><span class="sxs-lookup"><span data-stu-id="7898d-178">clustered columnstore index A *clustered columnstore index* is the physical storage for the entire table and is the only index for the table.</span></span> <span data-ttu-id="7898d-179">El índice clúster se puede actualizar.</span><span class="sxs-lookup"><span data-stu-id="7898d-179">The clustered index is updateable.</span></span> <span data-ttu-id="7898d-180">Puede realizar operaciones de inserción, eliminación y actualización del índice y puede cargar datos de forma masiva en el índice.</span><span class="sxs-lookup"><span data-stu-id="7898d-180">You can perform insert, delete, and update operations on the index and you can bulk load data into the index.</span></span>

 <span data-ttu-id="7898d-181">![Índice de almacén de columnas agrupado](../../database-engine/media/sql-server-pdw-columnstore-physicalstorage.gif "Índice de almacén de columnas agrupado")</span><span class="sxs-lookup"><span data-stu-id="7898d-181">![Clustered Columnstore Index](../../database-engine/media/sql-server-pdw-columnstore-physicalstorage.gif "Clustered Columnstore Index")</span></span>

 <span data-ttu-id="7898d-182">Para reducir la fragmentación de los segmentos de columna y mejorar el rendimiento, el índice de almacén de columnas puede almacenar temporalmente algunos datos en una tabla de almacén de filas, denominada almacén delta, así como un árbol B de los identificadores de las filas eliminadas.</span><span class="sxs-lookup"><span data-stu-id="7898d-182">To reduce fragmentation of the column segments and improve performance, the columnstore index might store some data temporarily into a rowstore table, called a deltastore, plus a B-Tree of IDs for deleted rows.</span></span> <span data-ttu-id="7898d-183">Las operaciones del almacén delta se administran en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="7898d-183">The deltastore operations are handled behind the scenes.</span></span> <span data-ttu-id="7898d-184">Para devolver los resultados correctos de la consulta, el índice clúster de almacén de columnas combina los resultados de la consulta tanto del almacén de columnas como del almacén delta.</span><span class="sxs-lookup"><span data-stu-id="7898d-184">To return the correct query results, the clustered columnstore index combines query results from both the columnstore and the deltastore.</span></span>

 <span data-ttu-id="7898d-185">almacén Delta solo se usa con índices de almacén de columnas en clúster, un *almacén Delta* es una tabla de almacén que almacena filas hasta que el número de filas es lo suficientemente grande como para moverse al almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="7898d-185">deltastore Used with clustered columnstore indexes only, a *deltastore* is a rowstore table that stores rows until the number of rows is large enough to be moved into the columnstore.</span></span> <span data-ttu-id="7898d-186">Un almacén delta se usa con índices clúster de almacén de columnas para mejorar el rendimiento de carga y de otras operaciones DML.</span><span class="sxs-lookup"><span data-stu-id="7898d-186">A deltastore is used with clustered columnstore indexes to improve performance for loading and other DML operations.</span></span>

 <span data-ttu-id="7898d-187">Durante una gran carga masiva, la mayoría de las filas van directamente al almacén de columnas sin pasar por el almacén delta.</span><span class="sxs-lookup"><span data-stu-id="7898d-187">During a large bulk load, most of the rows go directly to the columnstore without passing through the deltastore.</span></span> <span data-ttu-id="7898d-188">Al final de la carga masiva, podría quedar un número de filas menor que el tamaño mínimo de un grupo de filas, que es 102.400 filas.</span><span class="sxs-lookup"><span data-stu-id="7898d-188">Some rows at the end of the bulk load might be too few in number to meet the minimum size of a rowgroup which is 102,400 rows.</span></span> <span data-ttu-id="7898d-189">Cuando esto sucede, las últimas filas van al almacén delta en lugar de al almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="7898d-189">When this happens, the final rows go to the deltastore instead of the columnstore.</span></span> <span data-ttu-id="7898d-190">En el caso de cargas masivas pequeñas con menos de 102.400 filas, todas las filas van directamente al almacén delta.</span><span class="sxs-lookup"><span data-stu-id="7898d-190">For small bulk loads with less than 102,400 rows, all of the rows go directly to the deltastore.</span></span>

 <span data-ttu-id="7898d-191">Cuando el almacén delta alcanza el número máximo de filas, se cierra.</span><span class="sxs-lookup"><span data-stu-id="7898d-191">When the deltastore reaches the maximum number of rows, it becomes closed.</span></span> <span data-ttu-id="7898d-192">Un proceso de tupla motriz comprueba si hay grupos de filas cerrados.</span><span class="sxs-lookup"><span data-stu-id="7898d-192">A tuple-move process checks for closed row groups.</span></span> <span data-ttu-id="7898d-193">Cuando encuentra el grupo de filas cerrado, lo comprime y lo almacena en el almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="7898d-193">When it finds the closed rowgroup, it compresses it and stores it into the columnstore.</span></span>

##  <a name="loading-data"></a><a name="dataload"></a><span data-ttu-id="7898d-194">Cargar datos</span><span class="sxs-lookup"><span data-stu-id="7898d-194">Loading Data</span></span>

###  <a name="loading-data-into-a-nonclustered-columnstore-index"></a><a name="dataload_nci"></a><span data-ttu-id="7898d-195">Cargar datos en un índice de almacén de columnas no agrupado</span><span class="sxs-lookup"><span data-stu-id="7898d-195">Loading Data into a Nonclustered Columnstore Index</span></span>
 <span data-ttu-id="7898d-196">Para cargar datos en un índice de almacén de columnas no agrupado, cargue primero los datos en una tabla de almacén tradicional almacenada como un montón o un índice clúster y, a continuación, cree el índice de almacén de columnas no agrupado con [Create de índice de almacén de columnas &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="7898d-196">To load data into a nonclustered columnstore index, first load data into a traditional rowstore table stored as a heap or clustered index, and then create the nonclustered columnstore index with [CREATE COLUMNSTORE INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql).</span></span>

 <span data-ttu-id="7898d-197">![Cargar datos en un índice de almacén de columnas](../../database-engine/media/sql-server-pdw-columnstore-loadprocess-nonclustered.gif "Cargar datos en un índice de almacén de columnas")</span><span class="sxs-lookup"><span data-stu-id="7898d-197">![Loading data into a columnstore index](../../database-engine/media/sql-server-pdw-columnstore-loadprocess-nonclustered.gif "Loading data into a columnstore index")</span></span>

 <span data-ttu-id="7898d-198">Una tabla con un índice no clúster de almacén de columnas es de solo lectura hasta que se quita o se deshabilita el índice.</span><span class="sxs-lookup"><span data-stu-id="7898d-198">A table with a nonclustered columnstore index is read-only until the index is dropped or disabled.</span></span> <span data-ttu-id="7898d-199">Para actualizar la tabla y el índice de almacén de columnas no agrupado, puede cambiar las particiones dentro y fuera. También puede deshabilitar el índice, actualizar la tabla y, a continuación, volver a generar el índice.</span><span class="sxs-lookup"><span data-stu-id="7898d-199">To update the table and the nonclustered columnstore index you can switch partitions in and out. You can also disable the index, update the table, and then rebuild the index.</span></span>

 <span data-ttu-id="7898d-200">Para obtener más información, vea [Using Nonclustered Columnstore Indexes](indexes.md)</span><span class="sxs-lookup"><span data-stu-id="7898d-200">For more information see [Using Nonclustered Columnstore Indexes](indexes.md)</span></span>

###  <a name="loading-data-into-a-clustered-columnstore-index"></a><a name="dataload_cci"></a><span data-ttu-id="7898d-201">Cargar datos en un índice de almacén de columnas agrupado</span><span class="sxs-lookup"><span data-stu-id="7898d-201">Loading Data into a Clustered Columnstore Index</span></span>
 <span data-ttu-id="7898d-202">![Carga en un índice de almacén de columnas agrupado](../../database-engine/media/sql-server-pdw-columnstore-loadprocess.gif "Carga en un índice de almacén de columnas agrupado")</span><span class="sxs-lookup"><span data-stu-id="7898d-202">![Loading into a clustered columnstore index](../../database-engine/media/sql-server-pdw-columnstore-loadprocess.gif "Loading into a clustered columnstore index")</span></span>

 <span data-ttu-id="7898d-203">Como se muestra en el diagrama, para cargar datos en un índice clúster de almacén de columnas, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="7898d-203">As the diagram suggests, to load data into a clustered columnstore index, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:</span></span>

1.  <span data-ttu-id="7898d-204">Inserta grupos de filas con el tamaño máximo directamente en el almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="7898d-204">Inserts maximum-size rowgroups directly into the columnstore.</span></span> <span data-ttu-id="7898d-205">A medida que se cargan los datos, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] asigna las filas de datos a un grupo de filas abierto por orden de llegada.</span><span class="sxs-lookup"><span data-stu-id="7898d-205">As the data is loaded, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] assigns the data rows in a first-come first-serve order into an open rowgroup.</span></span>

2.  <span data-ttu-id="7898d-206">Cuando cada grupo de filas alcanza el tamaño máximo, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="7898d-206">For each rowgroup, after it reaches the maximum size, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:</span></span>

    1.  <span data-ttu-id="7898d-207">Lo marca como CLOSED.</span><span class="sxs-lookup"><span data-stu-id="7898d-207">Marks the rowgroup as CLOSED.</span></span>

    2.  <span data-ttu-id="7898d-208">Omite el almacén delta.</span><span class="sxs-lookup"><span data-stu-id="7898d-208">Bypasses the deltastore.</span></span>

    3.  <span data-ttu-id="7898d-209">Comprime cada segmento de columna del grupo de filas mediante la compresión Columnstore.</span><span class="sxs-lookup"><span data-stu-id="7898d-209">Compresses each column segment with the rowgroup with columnstore compression.</span></span>

    4.  <span data-ttu-id="7898d-210">Almacena físicamente cada segmento de columna comprimido en el almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="7898d-210">Physically stores each compressed column segment into the columnstore.</span></span>

3.  <span data-ttu-id="7898d-211">Inserta las filas restantes en el almacén de columnas o en el almacén delta del modo siguiente:</span><span class="sxs-lookup"><span data-stu-id="7898d-211">Inserts the remaining rows into the columnstore or the deltastore as follows:</span></span>

    1.  <span data-ttu-id="7898d-212">Si el número de filas coincide con el número mínimo de filas necesario para formar un grupo de filas, las filas se agregan al almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="7898d-212">If the number of rows meets the minimum rows per rowgroup requirement, the rows are added to the columnstore.</span></span>

    2.  <span data-ttu-id="7898d-213">Si el número de filas es menor que el número mínimo de filas necesario para formar un grupo de filas, las filas se agregan al almacén delta.</span><span class="sxs-lookup"><span data-stu-id="7898d-213">If the number of rows is less than the minimum rows per rowgroup, the rows are added to the deltastore.</span></span>

 <span data-ttu-id="7898d-214">Para obtener más información acerca de las tareas y los procesos de almacén delta, vea [Using Clustered Columnstore Indexes](../../database-engine/using-clustered-columnstore-indexes.md).</span><span class="sxs-lookup"><span data-stu-id="7898d-214">For more information about deltastore tasks and processes, see [Using Clustered Columnstore Indexes](../../database-engine/using-clustered-columnstore-indexes.md)</span></span>

##  <a name="performance-tips"></a><a name="performance"></a><span data-ttu-id="7898d-215">Sugerencias de rendimiento</span><span class="sxs-lookup"><span data-stu-id="7898d-215">Performance Tips</span></span>

### <a name="plan-for-enough-memory-to-create-columnstore-indexes-in-parallel"></a><span data-ttu-id="7898d-216">Planear para que haya suficiente memoria para crear índices de almacén de columnas en paralelo</span><span class="sxs-lookup"><span data-stu-id="7898d-216">Plan for enough memory to create columnstore indexes in parallel</span></span>
 <span data-ttu-id="7898d-217">La creación un índice de almacén de columnas es de forma predeterminada una operación paralela a menos que se restrinja la memoria.</span><span class="sxs-lookup"><span data-stu-id="7898d-217">Creating a columnstore index is by default a parallel operation unless memory is constrained.</span></span> <span data-ttu-id="7898d-218">Crear el índice en paralelo requiere más memoria que crear el índice en serie.</span><span class="sxs-lookup"><span data-stu-id="7898d-218">Creating the index in parallel requires more memory than creating the index serially.</span></span> <span data-ttu-id="7898d-219">Cuando hay suficiente memoria, la creación de un índice de almacén de columnas tarda aproximadamente 1,5 más que generar un árbol B en las mismas columnas.</span><span class="sxs-lookup"><span data-stu-id="7898d-219">When there is ample memory, creating a columnstore index takes on the order of 1.5 times as long as building a B-tree on the same columns.</span></span>

 <span data-ttu-id="7898d-220">La memoria necesaria para crear un índice de almacén de columnas depende del número de columnas, el número de columnas de cadena, el grado de paralelismo (DOP) y las características de los datos.</span><span class="sxs-lookup"><span data-stu-id="7898d-220">The memory required for creating a columnstore index depends on the number of columns, the number of string columns, the degree of parallelism (DOP), and the characteristics of the data.</span></span> <span data-ttu-id="7898d-221">Por ejemplo, si la tabla tiene menos de un millón de filas, SQL Server solo usará un subproceso para crear el índice de almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="7898d-221">For example, if your table has fewer than one million rows, SQL Server will use only one thread to create the columnstore index.</span></span>

 <span data-ttu-id="7898d-222">Si la tabla tiene más de un millón de filas pero SQL Server no puede obtener una concesión de memoria suficiente para crear el índice mediante MAXDOP, SQL Server reducirá automáticamente el valor de MAXDOP según sea necesario para ajustarse a la concesión de memoria disponible.</span><span class="sxs-lookup"><span data-stu-id="7898d-222">If your table has more than one million rows, but SQL Server cannot get a large enough memory grant to create the index using MAXDOP, SQL Server will automatically decrease MAXDOP as needed to fit into the available memory grant.</span></span>  <span data-ttu-id="7898d-223">En algunos casos, se debe reducir a uno el DOP para generar el índice cuando la memoria está restringida.</span><span class="sxs-lookup"><span data-stu-id="7898d-223">In some cases, DOP must be decreased to one in order to build the index under constrained memory.</span></span>

##  <a name="related-tasks-and-topics"></a><a name="related"></a><span data-ttu-id="7898d-224">Temas y tareas relacionados</span><span class="sxs-lookup"><span data-stu-id="7898d-224">Related Tasks and Topics</span></span>

### <a name="nonclustered-columnstore-indexes"></a><span data-ttu-id="7898d-225">Índices no clúster de almacén de columnas</span><span class="sxs-lookup"><span data-stu-id="7898d-225">Nonclustered Columnstore Indexes</span></span>
 <span data-ttu-id="7898d-226">Para las tareas comunes, vea [Using Nonclustered Columnstore Indexes](../../database-engine/using-nonclustered-columnstore-indexes.md).</span><span class="sxs-lookup"><span data-stu-id="7898d-226">For common tasks, see [Using Nonclustered Columnstore Indexes](../../database-engine/using-nonclustered-columnstore-indexes.md).</span></span>

-   [<span data-ttu-id="7898d-227">CREATE COLUMNSTORE INDEX &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="7898d-227">CREATE COLUMNSTORE INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-columnstore-index-transact-sql)

-   <span data-ttu-id="7898d-228">[ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql) con Rebuild.</span><span class="sxs-lookup"><span data-stu-id="7898d-228">[ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql) with REBUILD.</span></span>

-   [<span data-ttu-id="7898d-229">DROP INDEX &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="7898d-229">DROP INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/drop-index-transact-sql)

### <a name="clustered-columnstore-indexes"></a><span data-ttu-id="7898d-230">Índices clúster de almacén de columnas</span><span class="sxs-lookup"><span data-stu-id="7898d-230">Clustered Columnstore Indexes</span></span>
 <span data-ttu-id="7898d-231">Para las tareas comunes, vea [Using Clustered Columnstore Indexes](../../database-engine/using-clustered-columnstore-indexes.md).</span><span class="sxs-lookup"><span data-stu-id="7898d-231">For common tasks, see [Using Clustered Columnstore Indexes](../../database-engine/using-clustered-columnstore-indexes.md).</span></span>

-   [<span data-ttu-id="7898d-232">CREAR índice clúster de almacén de columnas &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="7898d-232">CREATE CLUSTERED COLUMNSTORE INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-columnstore-index-transact-sql)

-   <span data-ttu-id="7898d-233">[ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql) con Rebuild o reorganize.</span><span class="sxs-lookup"><span data-stu-id="7898d-233">[ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql) with REBUILD or REORGANIZE.</span></span>

-   [<span data-ttu-id="7898d-234">DROP INDEX &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="7898d-234">DROP INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/drop-index-transact-sql)

-   [<span data-ttu-id="7898d-235">INSERT &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="7898d-235">INSERT &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/insert-transact-sql)

-   [<span data-ttu-id="7898d-236">UPDATE &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="7898d-236">UPDATE &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/queries/update-transact-sql)

-   [<span data-ttu-id="7898d-237">DELETE &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="7898d-237">DELETE &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/delete-transact-sql)

### <a name="metadata"></a><span data-ttu-id="7898d-238">Metadatos</span><span class="sxs-lookup"><span data-stu-id="7898d-238">Metadata</span></span>
 <span data-ttu-id="7898d-239">Todas las columnas de un índice de almacén de columnas se almacenan en los metadatos como columnas incluidas.</span><span class="sxs-lookup"><span data-stu-id="7898d-239">All of the columns in a columnstore index are stored in the metadata as included columns.</span></span> <span data-ttu-id="7898d-240">El índice de almacén de columnas no tiene columnas de clave.</span><span class="sxs-lookup"><span data-stu-id="7898d-240">The columnstore index does not have key columns.</span></span>

-   [<span data-ttu-id="7898d-241">sys.indexes &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="7898d-241">sys.indexes &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-indexes-transact-sql)

-   [<span data-ttu-id="7898d-242">sys.index_columns &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="7898d-242">sys.index_columns &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-index-columns-transact-sql)

-   [<span data-ttu-id="7898d-243">sys.partitions &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="7898d-243">sys.partitions &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-partitions-transact-sql)

-   [<span data-ttu-id="7898d-244">sys.column_store_segments &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="7898d-244">sys.column_store_segments &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-column-store-segments-transact-sql)

-   [<span data-ttu-id="7898d-245">sys.column_store_dictionaries &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="7898d-245">sys.column_store_dictionaries &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-column-store-dictionaries-transact-sql)

-   [<span data-ttu-id="7898d-246">sys.column_store_row_groups &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="7898d-246">sys.column_store_row_groups &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-column-store-row-groups-transact-sql)


