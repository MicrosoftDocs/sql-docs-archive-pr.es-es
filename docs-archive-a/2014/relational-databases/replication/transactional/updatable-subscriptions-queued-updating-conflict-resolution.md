---
title: Detección y resolución de conflictos de actualización en cola | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- conflict resolution [SQL Server replication], queued updating subscriptions
- viewing queued updating conflicts
- conflict resolution [SQL Server replication]
- queued updating subscriptions [SQL Server replication]
- articles [SQL Server replication], conflict resolution
ms.assetid: 084ac587-25e7-4bd0-a385-556bbe07d02f
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 8c4608347ab119e25caa45b0ee4a592a953e34a4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87677529"
---
# <a name="queued-updating-conflict-detection-and-resolution"></a><span data-ttu-id="1f617-102">Queued Updating Conflict Detection and Resolution</span><span class="sxs-lookup"><span data-stu-id="1f617-102">Queued Updating Conflict Detection and Resolution</span></span>
  <span data-ttu-id="1f617-103">Como las suscripciones de actualización en cola permiten realizar modificaciones en los mismos datos en múltiples ubicaciones, pueden producirse conflictos cuando se sincronizan los datos en el publicador.</span><span class="sxs-lookup"><span data-stu-id="1f617-103">Because queued updating subscriptions allow modifications to the same data at multiple locations, there may be conflicts when data is synchronized at the Publisher.</span></span> <span data-ttu-id="1f617-104">La replicación detecta los conflictos cuando se sincronizan los cambios con el publicador y resuelve esos conflictos utilizando la directiva de resolución que ha seleccionado al crear la publicación.</span><span class="sxs-lookup"><span data-stu-id="1f617-104">Replication detects any conflicts when changes are synchronized with the Publisher and resolves those conflicts using the resolution policy you selected when creating the publication.</span></span> <span data-ttu-id="1f617-105">Pueden producirse los siguientes conflictos:</span><span class="sxs-lookup"><span data-stu-id="1f617-105">The following conflicts can occur:</span></span>  
  
-   <span data-ttu-id="1f617-106">Conflictos de actualización e inserción.</span><span class="sxs-lookup"><span data-stu-id="1f617-106">Update and insert conflicts.</span></span> <span data-ttu-id="1f617-107">Tienen lugar cuando se modifican los mismos datos en dos ubicaciones.</span><span class="sxs-lookup"><span data-stu-id="1f617-107">This conflict happens when the same data is changed at two locations.</span></span> <span data-ttu-id="1f617-108">Una de las modificaciones "gana", mientras que la otra "pierde".</span><span class="sxs-lookup"><span data-stu-id="1f617-108">One change wins, and the other one loses.</span></span>  
  
-   <span data-ttu-id="1f617-109">Conflictos de eliminación.</span><span class="sxs-lookup"><span data-stu-id="1f617-109">Delete conflicts.</span></span> <span data-ttu-id="1f617-110">Ocurren cuando se elimina una fila en una ubicación y se modifica la misma fila en otra.</span><span class="sxs-lookup"><span data-stu-id="1f617-110">This conflict occurs when the same row is deleted at one location and changed at the other.</span></span>  
  
 <span data-ttu-id="1f617-111">La detección y resolución de conflictos puede consumir mucho tiempo y muchos recursos y, por tanto, es mejor minimizar los conflictos de la aplicación creando particiones de datos de forma que los distintos suscriptores modifiquen distintos subconjuntos de datos.</span><span class="sxs-lookup"><span data-stu-id="1f617-111">Conflict detection and resolution can be a time-consuming and resource-intensive process; therefore, it is best to minimize conflicts in the application by creating data partitions so that different Subscribers modify different subsets of data.</span></span>  
  
## <a name="detecting-conflicts"></a><span data-ttu-id="1f617-112">Detectar conflictos</span><span class="sxs-lookup"><span data-stu-id="1f617-112">Detecting Conflicts</span></span>  
 <span data-ttu-id="1f617-113">Al crear una publicación y habilitar la actualización en cola, la replicación agrega una columna **uniqueidentifier** (**msrepl_tran_version**) con el valor predeterminado **newid()** en la tabla subyacente.</span><span class="sxs-lookup"><span data-stu-id="1f617-113">When creating a publication and enabling queued updating, replication adds a **uniqueidentifier** column (**msrepl_tran_version**) with the default of **newid()** to the underlying table.</span></span> <span data-ttu-id="1f617-114">Cuando se modifican los datos publicados en el publicador o el suscriptor, la fila recibe un identificador único global (GUID) para indicar que existe una nueva versión de la fila.</span><span class="sxs-lookup"><span data-stu-id="1f617-114">When published data is changed at either the Publisher or the Subscriber, the row receives a new globally unique identifier (GUID) to indicate that a new row version exists.</span></span> <span data-ttu-id="1f617-115">El Agente de lectura de cola utiliza esta columna durante la sincronización para determinar si existe un conflicto.</span><span class="sxs-lookup"><span data-stu-id="1f617-115">The Queue Reader Agent uses this column during synchronization to determine if a conflict exists.</span></span>  
  
 <span data-ttu-id="1f617-116">Una transacción en cola mantiene los valores de versión nuevo y antiguo.</span><span class="sxs-lookup"><span data-stu-id="1f617-116">A transaction in a queue maintains the old and new row version values.</span></span> <span data-ttu-id="1f617-117">Cuando la transacción se aplica en el publicador, se comparan los GUID de la transacción y el GUID de la publicación.</span><span class="sxs-lookup"><span data-stu-id="1f617-117">When the transaction is applied at the Publisher, the GUIDs from the transaction and the GUID in the publication are compared.</span></span> <span data-ttu-id="1f617-118">Si el GUID almacenado en la transacción coincide con el GUID de la publicación, la publicación se actualiza y se asigna a la fila el nuevo GUID generado por el suscriptor.</span><span class="sxs-lookup"><span data-stu-id="1f617-118">If the old GUID stored in the transaction matches the GUID in the publication, the publication is updated and the row is assigned the new GUID that was generated by the Subscriber.</span></span> <span data-ttu-id="1f617-119">Al actualizar la publicación con el GUID de la transacción, tendrá versiones de fila coincidentes en la publicación y en la transacción.</span><span class="sxs-lookup"><span data-stu-id="1f617-119">By updating the publication with the GUID from the transaction, you have matching row versions in the publication and in the transaction.</span></span>  
  
 <span data-ttu-id="1f617-120">Si el GUID antiguo almacenado en la transacción no coincide con el de la publicación, se detectará un conflicto.</span><span class="sxs-lookup"><span data-stu-id="1f617-120">If the old GUID stored in the transaction does not match the GUID in the publication, a conflict is detected.</span></span> <span data-ttu-id="1f617-121">El nuevo GUID de la publicación indica que existen dos versiones diferentes de la fila: una en la transacción enviada por el suscriptor y otra más reciente que existe en el publicador.</span><span class="sxs-lookup"><span data-stu-id="1f617-121">The new GUID in the publication indicates that two different row versions exist: one in the transaction being submitted by the Subscriber and a newer one that exists on the Publisher.</span></span> <span data-ttu-id="1f617-122">En este caso, otro suscriptor o publicador actualizó la misma fila en la publicación antes de la sincronización de esta transacción de suscriptor.</span><span class="sxs-lookup"><span data-stu-id="1f617-122">In this case, another Subscriber or the Publisher updated the same row in the publication before this Subscriber transaction was synchronized.</span></span>  
  
 <span data-ttu-id="1f617-123">A diferencia de la replicación de mezcla, no se utiliza una columna GUID para identificar la fila, sino para comprobar si la fila ha cambiado.</span><span class="sxs-lookup"><span data-stu-id="1f617-123">Unlike merge replication, the use of a GUID column is not used to identify the row itself, but is used to check if the row has changed.</span></span>  
  
## <a name="resolving-conflicts"></a><span data-ttu-id="1f617-124">Solucionar conflictos</span><span class="sxs-lookup"><span data-stu-id="1f617-124">Resolving Conflicts</span></span>  
 <span data-ttu-id="1f617-125">Al crear una publicación con la actualización en cola, se selecciona un solucionador de conflictos que se utilizará si se detectan conflictos.</span><span class="sxs-lookup"><span data-stu-id="1f617-125">When you create a publication using queued updating, you select a conflict resolver to be used if any conflicts are detected.</span></span> <span data-ttu-id="1f617-126">El solucionador de conflictos rige la forma en que el Agente de lectura de cola controla diferentes versiones de la misma fila que se encuentran durante la sincronización.</span><span class="sxs-lookup"><span data-stu-id="1f617-126">The conflict resolver governs how the Queue Reader Agent handles different versions of the same row encountered during synchronization.</span></span> <span data-ttu-id="1f617-127">Puede modificar la directiva de resolución de conflictos después de crear la publicación, con tal de que no haya suscripciones a la publicación.</span><span class="sxs-lookup"><span data-stu-id="1f617-127">You can change the conflict resolution policy after the publication is created as long as there are no subscriptions to the publication.</span></span> <span data-ttu-id="1f617-128">Las opciones del solucionador de conflictos son las siguientes:</span><span class="sxs-lookup"><span data-stu-id="1f617-128">The conflict resolver choices are the following:</span></span>  
  
-   <span data-ttu-id="1f617-129">El publicador gana (valor predeterminado)</span><span class="sxs-lookup"><span data-stu-id="1f617-129">Publisher wins (the default)</span></span>  
  
-   <span data-ttu-id="1f617-130">El publicador gana y se reinicializa la suscripción</span><span class="sxs-lookup"><span data-stu-id="1f617-130">Publisher wins and the subscription is reinitialized</span></span>  
  
-   <span data-ttu-id="1f617-131">El suscriptor gana</span><span class="sxs-lookup"><span data-stu-id="1f617-131">Subscriber wins</span></span>  
  
 <span data-ttu-id="1f617-132">Los conflictos se registran y se pueden ver con el Visor de conflictos.</span><span class="sxs-lookup"><span data-stu-id="1f617-132">Conflicts are recorded and can be viewed using the Conflict Viewer.</span></span>  
  
 <span data-ttu-id="1f617-133">**Para establecer la directiva de resolución de conflictos de actualización en cola**</span><span class="sxs-lookup"><span data-stu-id="1f617-133">**To set the queued updating conflict resolution policy**</span></span>  
  
-   [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]<span data-ttu-id="1f617-134">: [Establecer opciones de resolución de conflictos de actualización en cola &#40;SQL Server Management Studio&#41;](../publish/create-an-updatable-subscription-to-a-transactional-publication.md)</span><span class="sxs-lookup"><span data-stu-id="1f617-134">: [Set Queued Updating Conflict Resolution Options &#40;SQL Server Management Studio&#41;](../publish/create-an-updatable-subscription-to-a-transactional-publication.md)</span></span>  
  
-   <span data-ttu-id="1f617-135">Programación de la replicación con Transact-SQL: [Habilitar suscripciones actualizables para publicaciones transaccionales](../publish/enable-updating-subscriptions-for-transactional-publications.md)</span><span class="sxs-lookup"><span data-stu-id="1f617-135">Replication Transact-SQL programming: [Enable Updating Subscriptions for Transactional Publications](../publish/enable-updating-subscriptions-for-transactional-publications.md)</span></span>  
  
 <span data-ttu-id="1f617-136">**Para ver conflictos de datos**</span><span class="sxs-lookup"><span data-stu-id="1f617-136">**To view data conflicts**</span></span>  
  
-   [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]<span data-ttu-id="1f617-137">: [Ver conflictos de datos para publicaciones transaccionales &#40;SQL Server Management Studio&#41;](../view-data-conflicts-for-transactional-publications-sql-server-management-studio.md)</span><span class="sxs-lookup"><span data-stu-id="1f617-137">: [View Data Conflicts for Transactional Publications &#40;SQL Server Management Studio&#41;](../view-data-conflicts-for-transactional-publications-sql-server-management-studio.md)</span></span>  
  
### <a name="publisher-wins"></a><span data-ttu-id="1f617-138">El publicador gana</span><span class="sxs-lookup"><span data-stu-id="1f617-138">Publisher Wins</span></span>  
 <span data-ttu-id="1f617-139">Cuando la resolución de conflictos se establece en El publicador gana, se mantiene la coherencia transaccional en función de los datos del publicador.</span><span class="sxs-lookup"><span data-stu-id="1f617-139">When the conflict resolution is set to the Publisher wins, transactional consistency is maintained based on the data at the Publisher.</span></span> <span data-ttu-id="1f617-140">La transacción en conflicto se revierte en el suscriptor que la inició.</span><span class="sxs-lookup"><span data-stu-id="1f617-140">The conflicting transaction is rolled back at the Subscriber that initiated it.</span></span>  
  
 <span data-ttu-id="1f617-141">El Agente de lectura de cola detecta un conflicto y se generan y propagan al suscriptor comandos de compensación; para ello, se publican en la base de datos de distribución.</span><span class="sxs-lookup"><span data-stu-id="1f617-141">The Queue Reader Agent detects a conflict and compensating commands are generated and propagated to the Subscriber by posting them in the distribution database.</span></span> <span data-ttu-id="1f617-142">A continuación, el Agente de distribución aplica los comandos de compensación al suscriptor que originó la transacción en conflicto.</span><span class="sxs-lookup"><span data-stu-id="1f617-142">The Distribution Agent then applies the compensating commands to the Subscriber that originated the conflicting transaction.</span></span> <span data-ttu-id="1f617-143">Las acciones de compensación actualizan las filas en el suscriptor, de forma que coincidan con las filas del publicador.</span><span class="sxs-lookup"><span data-stu-id="1f617-143">The compensating actions update the rows on the Subscriber to match the rows on the Publisher.</span></span>  
  
 <span data-ttu-id="1f617-144">Hasta que se apliquen los comandos de compensación será posible leer los resultados de una transacción que finalmente se revertirá en el suscriptor.</span><span class="sxs-lookup"><span data-stu-id="1f617-144">Until the compensating commands are applied, it is possible to read the results of a transaction that will eventually be rolled back at the Subscriber.</span></span> <span data-ttu-id="1f617-145">Esto equivale a una lectura no actualizada (nivel de aislamiento de lectura no confirmada).</span><span class="sxs-lookup"><span data-stu-id="1f617-145">This is equivalent to a dirty read (read uncommitted isolation level).</span></span> <span data-ttu-id="1f617-146">No habrá compensación para las siguientes transacciones dependientes que puedan producirse.</span><span class="sxs-lookup"><span data-stu-id="1f617-146">There is no compensation for the subsequent dependent transactions that can occur.</span></span> <span data-ttu-id="1f617-147">Sin embargo, se garantizan los límites de la transacción y todas las acciones de una transacción se confirman o, en caso de conflicto, se revierten.</span><span class="sxs-lookup"><span data-stu-id="1f617-147">However, transaction boundaries are honored and all the actions within a transaction are either committed, or in the case of a conflict, rolled back.</span></span>  
  
### <a name="publisher-wins-and-the-subscription-is-reinitialized"></a><span data-ttu-id="1f617-148">El publicador gana y se reinicializa la suscripción</span><span class="sxs-lookup"><span data-stu-id="1f617-148">Publisher Wins and the Subscription Is Reinitialized</span></span>  
 <span data-ttu-id="1f617-149">La opción de reinicializar el suscriptor para solucionar conflictos mantiene una coherencia estricta en el suscriptor, pero puede consumir mucho tiempo si la publicación contiene grandes cantidades de datos.</span><span class="sxs-lookup"><span data-stu-id="1f617-149">Reinitializing the Subscriber to resolve conflicts maintains strict transactional consistency at the Subscriber, but it can be time consuming if the publication contains large amounts of data.</span></span>  
  
 <span data-ttu-id="1f617-150">Cuando el Agente de lectura de cola detecta un conflicto, se rechazan las demás transacciones de la cola (incluida la transacción en conflicto) y se marca el suscriptor para su reinicialización.</span><span class="sxs-lookup"><span data-stu-id="1f617-150">When the Queue Reader Agent detects a conflict, all remaining transactions in the queue (including the transaction in conflict) are rejected, and the Subscriber is marked for reinitialization.</span></span> <span data-ttu-id="1f617-151">El Agente de distribución aplica al suscriptor la siguiente instantánea generada para la publicación.</span><span class="sxs-lookup"><span data-stu-id="1f617-151">The next snapshot generated for the publication is applied by the Distribution Agent to the Subscriber.</span></span>  
  
### <a name="subscriber-wins"></a><span data-ttu-id="1f617-152">El suscriptor gana</span><span class="sxs-lookup"><span data-stu-id="1f617-152">Subscriber Wins</span></span>  
 <span data-ttu-id="1f617-153">La detección de conflictos con la directiva El suscriptor gana significa que la última transacción de suscriptor que actualice el publicador ganará.</span><span class="sxs-lookup"><span data-stu-id="1f617-153">Conflict detection under the Subscriber wins policy means the last Subscriber transaction to update the Publisher wins.</span></span> <span data-ttu-id="1f617-154">En este caso, cuando se detecte un conflicto, se seguirá utilizando la transacción enviada por el suscriptor y se actualizará el publicador.</span><span class="sxs-lookup"><span data-stu-id="1f617-154">In this case, when a conflict is detected, the transaction sent by the Subscriber is still used and the Publisher is updated.</span></span> <span data-ttu-id="1f617-155">Esta directiva es apropiada para las aplicaciones en que estos cambios no pongan en peligro la integridad de los datos.</span><span class="sxs-lookup"><span data-stu-id="1f617-155">This policy is suitable for applications where such changes do not compromise data integrity.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="1f617-156">Consulte también</span><span class="sxs-lookup"><span data-stu-id="1f617-156">See Also</span></span>  
 [<span data-ttu-id="1f617-157">Updatable Subscriptions for Transactional Replication</span><span class="sxs-lookup"><span data-stu-id="1f617-157">Updatable Subscriptions for Transactional Replication</span></span>](updatable-subscriptions-for-transactional-replication.md)  
  
  
