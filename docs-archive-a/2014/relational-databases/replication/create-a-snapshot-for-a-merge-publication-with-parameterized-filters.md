---
title: Creación de una instantánea de una publicación de mezcla mediante filtros con parámetros | Microsoft Docs
ms.custom: ''
ms.date: 06/30/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- parameterized filters [SQL Server replication], snapshots
- snapshots [SQL Server replication], parameterized filters and
- filters [SQL Server replication], parameterized
ms.assetid: 00dfb229-f1de-4d33-90b0-d7c99ab52dcb
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: dad6f1648cba44b38e37720f7e395687f769d91e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87745221"
---
# <a name="create-a-snapshot-for-a-merge-publication-with-parameterized-filters"></a><span data-ttu-id="7fc91-102">Crear una instantánea para una publicación de mezcla con filtros con parámetros</span><span class="sxs-lookup"><span data-stu-id="7fc91-102">Create a Snapshot for a Merge Publication with Parameterized Filters</span></span>
  <span data-ttu-id="7fc91-103">En este tema se describe cómo se crea una instantánea de una publicación de combinación con filtros con parámetros en [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] mediante [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)]o Replication Management Objects (RMO).</span><span class="sxs-lookup"><span data-stu-id="7fc91-103">This topic describes how to create a snapshot for a merge publication with parameterized filters in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span>  
  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="7fc91-104">Antes de comenzar</span><span class="sxs-lookup"><span data-stu-id="7fc91-104">Before You Begin</span></span>  
  
###  <a name="recommendations"></a><a name="Recommendations"></a> <span data-ttu-id="7fc91-105">Recomendaciones</span><span class="sxs-lookup"><span data-stu-id="7fc91-105">Recommendations</span></span>  
  
-   <span data-ttu-id="7fc91-106">Si desea generar una instantánea de una publicación de combinación mediante filtros con parámetros, debe generar primero una instantánea estándar (o de esquema) que contenga todos los datos publicados y los metadatos del Suscriptor para la suscripción.</span><span class="sxs-lookup"><span data-stu-id="7fc91-106">When generating a snapshot for a merge publication using parameterized filters, you must first generate a standard (schema) snapshot that contains all of the published data and Subscriber metadata for the subscription.</span></span> <span data-ttu-id="7fc91-107">Para más información, consulte [Crear y aplicar la instantánea inicial](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-107">For more information, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span> <span data-ttu-id="7fc91-108">Después de haber creado la instantánea del esquema, puede generar la instantánea que contiene la partición específica del Suscriptor de los datos publicados.</span><span class="sxs-lookup"><span data-stu-id="7fc91-108">After you have created the schema snapshot, you can generate the snapshot that contains the Subscriber-specific partition of the published data.</span></span>  
  
-   <span data-ttu-id="7fc91-109">Si el filtrado de uno o más artículos de la publicación produce particiones no superpuestas y únicas para cada suscripción, los metadatos se limpian cada vez que se ejecuta el Agente de mezcla.</span><span class="sxs-lookup"><span data-stu-id="7fc91-109">If the filtering for one or more articles in the publication yields non-overlapping partitions that are unique for each subscription, metadata is cleaned up whenever the Merge Agent runs.</span></span> <span data-ttu-id="7fc91-110">Esto significa que la instantánea con particiones expira antes.</span><span class="sxs-lookup"><span data-stu-id="7fc91-110">This means that the partitioned snapshot expires more quickly.</span></span> <span data-ttu-id="7fc91-111">Cuando utilice esta opción, puede ser conveniente permitir a los suscriptores que inicien la generación y entrega de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="7fc91-111">When using this option, you should consider allowing Subscribers to initiate snapshot generation and delivery.</span></span> <span data-ttu-id="7fc91-112">Para obtener más información sobre las opciones de filtrado, consulte la sección sobre cómo configurar opciones de partición del artículo [Instantáneas para publicaciones de combinación con filtros con parámetros](snapshots-for-merge-publications-with-parameterized-filters.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-112">For more information about filtering options, see the "Setting 'partition options'" section of [Snapshots for Merge Publications with Parameterized Filters](snapshots-for-merge-publications-with-parameterized-filters.md).</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="7fc91-113">Uso de SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="7fc91-113">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="7fc91-114">Genere instantáneas de particiones en la página **Particiones de datos** del cuadro de diálogo **Propiedades de la publicación: \<Publication>** .</span><span class="sxs-lookup"><span data-stu-id="7fc91-114">Generate snapshots for partitions on the **Data Partitions** page of the **Publication Properties - \<Publication>** dialog box.</span></span> <span data-ttu-id="7fc91-115">Para obtener más información sobre el acceso a este cuadro de diálogo, vea [View and Modify Publication Properties](publish/view-and-modify-publication-properties.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-115">For more information about accessing this dialog box, see [View and Modify Publication Properties](publish/view-and-modify-publication-properties.md).</span></span> <span data-ttu-id="7fc91-116">Puede permitir a los suscriptores iniciar la generación y entrega de instantáneas y/o generar instantáneas.</span><span class="sxs-lookup"><span data-stu-id="7fc91-116">You can allow Subscribers to initiate snapshot generation and delivery and/or generate snapshots.</span></span>  
  
 <span data-ttu-id="7fc91-117">Antes de generar instantáneas de una o varias particiones debe:</span><span class="sxs-lookup"><span data-stu-id="7fc91-117">Before generating snapshots for one or more partitions, you must:</span></span>  
  
1.  <span data-ttu-id="7fc91-118">Crear una publicación de combinación con el Asistente para nueva publicación y especificar uno o varios filtros de fila con parámetros en la página **Agregar filtro** del asistente.</span><span class="sxs-lookup"><span data-stu-id="7fc91-118">Create a merge publication with the New Publication Wizard, and specify one or more parameterized row filters on the **Add Filter** page of the wizard.</span></span> <span data-ttu-id="7fc91-119">Para más información, consulte [Definir y modificar un filtro de fila con parámetros para un artículo de mezcla](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-119">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
2.  <span data-ttu-id="7fc91-120">Generar una instantánea del esquema para la publicación.</span><span class="sxs-lookup"><span data-stu-id="7fc91-120">Generate a schema snapshot for the publication.</span></span> <span data-ttu-id="7fc91-121">De forma predeterminada, se genera una instantánea del esquema al completar el Asistente para nueva publicación, aunque también puede generar una instantánea del esquema desde [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span><span class="sxs-lookup"><span data-stu-id="7fc91-121">By default, a schema snapshot is generated when you complete the New Publication Wizard; you can also generate a schema snapshot from [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span></span>  
  
#### <a name="to-generate-a-schema-snapshot"></a><span data-ttu-id="7fc91-122">Para generar una instantánea del esquema</span><span class="sxs-lookup"><span data-stu-id="7fc91-122">To generate a schema snapshot</span></span>  
  
1.  <span data-ttu-id="7fc91-123">Conéctese al publicador en [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)]y luego expanda el nodo del servidor.</span><span class="sxs-lookup"><span data-stu-id="7fc91-123">Connect to the Publisher in [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="7fc91-124">Expanda la carpeta **Replicación** y, a continuación, la carpeta **Publicaciones** .</span><span class="sxs-lookup"><span data-stu-id="7fc91-124">Expand the **Replication** folder, and then expand the **Publications** folder.</span></span>  
  
3.  <span data-ttu-id="7fc91-125">Haga clic con el botón secundario en la publicación para la que desee crear una instantánea y, a continuación, haga clic en **Ver estado del agente de instantáneas**.</span><span class="sxs-lookup"><span data-stu-id="7fc91-125">Right-click the publication for which you want to create a snapshot, and then click **View Snapshot Agent Status**.</span></span>  
  
4.  <span data-ttu-id="7fc91-126">En el cuadro de diálogo **Ver estado del Agente de instantáneas: \<Publication>** , haga clic en **Iniciar**.</span><span class="sxs-lookup"><span data-stu-id="7fc91-126">In the **View Snapshot Agent Status - \<Publication>** dialog box, click **Start**.</span></span>  
  
     <span data-ttu-id="7fc91-127">Cuando el Agente de instantáneas termina de generar la instantánea, aparece un mensaje del tipo "[100%] Se ha generado una instantánea de 17 artículos".</span><span class="sxs-lookup"><span data-stu-id="7fc91-127">When the Snapshot Agent finishes generating the snapshot, a message will be displayed, such as "[100%] A snapshot of 17 article(s) was generated."</span></span>  
  
#### <a name="to-allow-subscribers-to-initiate-snapshot-generation-and-delivery"></a><span data-ttu-id="7fc91-128">Para permitir a los suscriptores inicializar la generación y distribución de instantáneas</span><span class="sxs-lookup"><span data-stu-id="7fc91-128">To allow Subscribers to initiate snapshot generation and delivery</span></span>  
  
1.  <span data-ttu-id="7fc91-129">En la página **Particiones de datos** del cuadro de diálogo **Propiedades de la publicación: \<Publication>** , seleccione **Definir automáticamente una partición y generar una instantánea si es necesario cuando un suscriptor nuevo intente sincronizarse**.</span><span class="sxs-lookup"><span data-stu-id="7fc91-129">On the **Data Partitions** page of the **Publication Properties - \<Publication>** dialog box, select **Automatically define a partition and generate a snapshot if needed when a new Subscriber tries to synchronize**.</span></span>  
  
2.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
#### <a name="to-generate-and-refresh-snapshots"></a><span data-ttu-id="7fc91-130">Para generar y actualizar instantáneas</span><span class="sxs-lookup"><span data-stu-id="7fc91-130">To generate and refresh snapshots</span></span>  
  
1.  <span data-ttu-id="7fc91-131">En la página **Particiones de datos** del cuadro de diálogo **Propiedades de la publicación: \<Publication>** , haga clic en **Agregar**.</span><span class="sxs-lookup"><span data-stu-id="7fc91-131">On the **Data Partitions** page of the **Publication Properties - \<Publication>** dialog box, click **Add**.</span></span>  
  
2.  <span data-ttu-id="7fc91-132">Escriba un valor para **HOST_NAME()** y/o el valor **SUSER_SNAME()** asociado con la partición para la que desea crear una instantánea.</span><span class="sxs-lookup"><span data-stu-id="7fc91-132">Enter a value for the **HOST_NAME()** and/or **SUSER_SNAME()** value associated with the partition for which you want to create a snapshot.</span></span>  
  
3.  <span data-ttu-id="7fc91-133">También puede especificar una programación para actualizar las instantáneas:</span><span class="sxs-lookup"><span data-stu-id="7fc91-133">Optionally specify a schedule for refreshing snapshots:</span></span>  
  
    1.  <span data-ttu-id="7fc91-134">Seleccione **Programar el Agente de instantáneas para que esta partición se ejecute a las horas siguientes**.</span><span class="sxs-lookup"><span data-stu-id="7fc91-134">Select **Schedule the Snapshot Agent for this partition to run at the following time(s)**</span></span>  
  
    2.  <span data-ttu-id="7fc91-135">Acepte la programación predeterminada para actualizar instantáneas o haga clic en **Cambiar** para especificar una programación diferente.</span><span class="sxs-lookup"><span data-stu-id="7fc91-135">Accept the default schedule for refreshing snapshots, or click **Change** to specify a different schedule.</span></span>  
  
4.  <span data-ttu-id="7fc91-136">Haga clic en **Aceptar**, que le lleva de vuelta al cuadro de diálogo **Propiedades de la publicación: \<Publication>** .</span><span class="sxs-lookup"><span data-stu-id="7fc91-136">Click **OK**, which returns you to the **Publication Properties - \<Publication>** dialog box.</span></span>  
  
5.  <span data-ttu-id="7fc91-137">Seleccione la partición en la cuadrícula de propiedades y, a continuación, haga clic en **Generar instantáneas seleccionadas ahora**.</span><span class="sxs-lookup"><span data-stu-id="7fc91-137">Select the partition in the property grid, and then click **Generate the selected snapshots now**.</span></span>  
  
6.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="7fc91-138">Usar Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="7fc91-138">Using Transact-SQL</span></span>  
 <span data-ttu-id="7fc91-139">Con los procedimientos almacenados y el Agente de instantáneas, podrá hacer lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="7fc91-139">Using stored procedures and the Snapshot Agent, you can perform the following:</span></span>  
  
-   <span data-ttu-id="7fc91-140">Permita a los suscriptores que soliciten la generación y aplicación de instantáneas la primera vez que se sincronicen.</span><span class="sxs-lookup"><span data-stu-id="7fc91-140">Allow Subscribers to request snapshot generation and application the first time they synchronize.</span></span>  
  
-   <span data-ttu-id="7fc91-141">Genere previamente las instantáneas para cada partición.</span><span class="sxs-lookup"><span data-stu-id="7fc91-141">Pre-generate snapshots for each partition.</span></span>  
  
-   <span data-ttu-id="7fc91-142">Generar manualmente una instantánea para cada Suscriptor.</span><span class="sxs-lookup"><span data-stu-id="7fc91-142">Manually generate a snapshot for each Subscriber.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="7fc91-143">Cuando sea posible, pida a los usuarios que proporcionen credenciales de seguridad en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="7fc91-143">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="7fc91-144">Si debe almacenar las credenciales en un archivo de script, proteja el archivo para evitar el acceso no autorizado.</span><span class="sxs-lookup"><span data-stu-id="7fc91-144">If you must store credentials in a script file, you must secure the file to prevent unauthorized access.</span></span>  
  
#### <a name="to-create-a-publication-that-allows-subscribers-to-initiate-snapshot-generation-and-delivery"></a><span data-ttu-id="7fc91-145">Para crear una publicación que permita a los suscriptores iniciar la generación y entrega de instantáneas</span><span class="sxs-lookup"><span data-stu-id="7fc91-145">To create a publication that allows Subscribers to initiate snapshot generation and delivery</span></span>  
  
1.  <span data-ttu-id="7fc91-146">En el publicador de la base de datos de publicación, ejecute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="7fc91-146">At the Publisher on the publication database, execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span></span> <span data-ttu-id="7fc91-147">Especifique los parámetros siguientes:</span><span class="sxs-lookup"><span data-stu-id="7fc91-147">Specify the following parameters:</span></span>  
  
    -   <span data-ttu-id="7fc91-148">El nombre de la base de datos de publicación para **\@publication**.</span><span class="sxs-lookup"><span data-stu-id="7fc91-148">The name of the publication for **\@publication**.</span></span>  
  
    -   <span data-ttu-id="7fc91-149">Un valor de `true` para \*\* \@ allow_subscriber_initiated_snapshot\*\*, que permite a los suscriptores iniciar el proceso de instantánea.</span><span class="sxs-lookup"><span data-stu-id="7fc91-149">A value of `true` for **\@allow_subscriber_initiated_snapshot**, which enables Subscribers to initiate the snapshot process.</span></span>  
  
    -   <span data-ttu-id="7fc91-150">(Opcional) El número de procesos de instantáneas dinámicas que se pueden ejecutar de manera simultánea para **\@max_concurrent_dynamic_snapshots**.</span><span class="sxs-lookup"><span data-stu-id="7fc91-150">(Optional) The number of dynamic snapshot processes that can run concurrently for **\@max_concurrent_dynamic_snapshots**.</span></span> <span data-ttu-id="7fc91-151">Si se está ejecutando el número máximo de procesos y un Suscriptor intenta generar una instantánea, el proceso se coloca en una cola.</span><span class="sxs-lookup"><span data-stu-id="7fc91-151">If the maximum number of processes is running and a Subscriber attempts to generate a snapshot, the process is placed in a queue.</span></span> <span data-ttu-id="7fc91-152">De forma predeterminada, no hay límite al número de procesos simultáneos.</span><span class="sxs-lookup"><span data-stu-id="7fc91-152">By default there is no limit to the number of concurrent processes.</span></span>  
  
2.  <span data-ttu-id="7fc91-153">En el publicador, ejecute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="7fc91-153">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="7fc91-154">Especifique el nombre de publicación usado en el paso 1 para la \*\* \@ publicación\*\* y las [!INCLUDE[msCoName](../../includes/msconame-md.md)] credenciales de Windows con las que la [replicación agente de instantáneas](agents/replication-snapshot-agent.md) la autenticación al conectarse al publicador, también debe especificar un valor de **0** para \*\* \@ publisher_security_mode\*\* y la [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] información de inicio de sesión de \*\* \@ publisher_login\*\* y \*\* \@ publisher_password\*\*.</span><span class="sxs-lookup"><span data-stu-id="7fc91-154">Specify the publication name used in step 1 for **\@publication** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows credentials under which the [Replication Snapshot Agent](agents/replication-snapshot-agent.md) Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="7fc91-155">Esto crea un trabajo de Agente de instantáneas para la publicación.</span><span class="sxs-lookup"><span data-stu-id="7fc91-155">This creates a Snapshot Agent job for the publication.</span></span> <span data-ttu-id="7fc91-156">Para obtener más información sobre cómo generar una instantánea inicial y definir una programación personalizada para el Agente de instantáneas, vea [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-156">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="7fc91-157">Al configurar un publicador con un distribuidor remoto, los valores suministrados para todos los parámetros, incluidos *job_login* y *job_password*, se envían al distribuidor como texto sin formato.</span><span class="sxs-lookup"><span data-stu-id="7fc91-157">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="7fc91-158">Antes de ejecutar este procedimiento almacenado, se recomienda cifrar la conexión entre el publicador y su distribuidor remoto.</span><span class="sxs-lookup"><span data-stu-id="7fc91-158">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="7fc91-159">Para obtener más información, vea [Habilitar conexiones cifradas en el motor de base de datos &#40;Administrador de configuración de SQL Server&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-159">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="7fc91-160">Ejecute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) para agregar artículos a la publicación.</span><span class="sxs-lookup"><span data-stu-id="7fc91-160">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) to add articles to the publication.</span></span> <span data-ttu-id="7fc91-161">Este procedimiento almacenado se debe ejecutar una vez para cada artículo de la publicación.</span><span class="sxs-lookup"><span data-stu-id="7fc91-161">This stored procedure must be executed once for each article in the publication.</span></span> <span data-ttu-id="7fc91-162">Al usar filtros con parámetros, debe especificar un filtro de fila con parámetros para uno o más artículos mediante el parámetro **\@subset_filterclause**.</span><span class="sxs-lookup"><span data-stu-id="7fc91-162">When using parameterized filters, you must specify a parameterized row filter for one or more articles using the **\@subset_filterclause** parameter.</span></span> <span data-ttu-id="7fc91-163">Para más información, consulte [Definir y modificar un filtro de fila con parámetros para un artículo de mezcla](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-163">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
4.  <span data-ttu-id="7fc91-164">Si se van a filtrar otros artículos según el filtro de fila con parámetros, ejecute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) para definir la combinación o las relaciones de registros lógicos entre los artículos.</span><span class="sxs-lookup"><span data-stu-id="7fc91-164">If other articles will be filtered based on the parameterized row filter, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) to define the join or logical record relationships between articles.</span></span> <span data-ttu-id="7fc91-165">Este procedimiento almacenado se debe ejecutar una vez para cada relación que se está definiendo.</span><span class="sxs-lookup"><span data-stu-id="7fc91-165">This stored procedure must be executed once for each relationship being defined.</span></span> <span data-ttu-id="7fc91-166">Para obtener más información, consulte [Definir y modificar un filtro de combinación entre artículos de mezcla](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-166">For more information, see [Define and Modify a Join Filter Between Merge Articles](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span></span>  
  
5.  <span data-ttu-id="7fc91-167">Cuando el Agente de mezcla solicita a la instantánea que inicialice el Suscriptor, se genera automáticamente la instantánea para la partición de la suscripción solicitante.</span><span class="sxs-lookup"><span data-stu-id="7fc91-167">When the Merge Agent requests the snapshot to initialize the Subscriber, the snapshot for the requesting subscription's partition is automatically generated.</span></span>  
  
#### <a name="to-create-a-publication-and-pre-generate-or-automatically-refresh-snapshots"></a><span data-ttu-id="7fc91-168">Para crear una publicación y pregenerar o actualizar automáticamente las instantáneas</span><span class="sxs-lookup"><span data-stu-id="7fc91-168">To create a publication and pre-generate or automatically refresh snapshots</span></span>  
  
1.  <span data-ttu-id="7fc91-169">Ejecute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) para crear la publicación.</span><span class="sxs-lookup"><span data-stu-id="7fc91-169">Execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) to create the publication.</span></span> <span data-ttu-id="7fc91-170">Para obtener más información, vea [Crear una suscripción](publish/create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-170">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="7fc91-171">En el publicador, ejecute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="7fc91-171">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="7fc91-172">Especifique el nombre de publicación usado en el paso 1 para **\@publication** y las credenciales de Windows con las que se ejecuta el Agente de instantáneas para **\@job_login** y **\@password**.</span><span class="sxs-lookup"><span data-stu-id="7fc91-172">Specify the publication name used in step 1 for **\@publication** and the Windows credentials under which the Snapshot Agent runs for **\@job_login** and **\@password**.</span></span> <span data-ttu-id="7fc91-173">Si el agente va a usar autenticación de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] al conectarse al publicador, también debe especificar un valor de **0** para **\@publisher_security_mode** y la información de inicio de sesión de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] para **\@publisher_login** y **\@publisher_password**.</span><span class="sxs-lookup"><span data-stu-id="7fc91-173">If the agent will use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="7fc91-174">Esto crea un trabajo de Agente de instantáneas para la publicación.</span><span class="sxs-lookup"><span data-stu-id="7fc91-174">This creates a Snapshot Agent job for the publication.</span></span> <span data-ttu-id="7fc91-175">Para obtener más información sobre cómo generar una instantánea inicial y definir una programación personalizada para el Agente de instantáneas, vea [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-175">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="7fc91-176">Al configurar un publicador con un distribuidor remoto, los valores suministrados para todos los parámetros, incluidos *job_login* y *job_password*, se envían al distribuidor como texto sin formato.</span><span class="sxs-lookup"><span data-stu-id="7fc91-176">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="7fc91-177">Antes de ejecutar este procedimiento almacenado, se recomienda cifrar la conexión entre el publicador y su distribuidor remoto.</span><span class="sxs-lookup"><span data-stu-id="7fc91-177">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="7fc91-178">Para obtener más información, vea [Habilitar conexiones cifradas en el motor de base de datos &#40;Administrador de configuración de SQL Server&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-178">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="7fc91-179">Ejecute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) para agregar artículos a la publicación.</span><span class="sxs-lookup"><span data-stu-id="7fc91-179">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) to add articles to the publication.</span></span> <span data-ttu-id="7fc91-180">Este procedimiento almacenado se debe ejecutar una vez para cada artículo de la publicación.</span><span class="sxs-lookup"><span data-stu-id="7fc91-180">This stored procedure must be executed once for each article in the publication.</span></span> <span data-ttu-id="7fc91-181">Al usar filtros con parámetros, debe especificar un filtro de fila con parámetros para un artículo mediante el parámetro **\@subset_filterclause**.</span><span class="sxs-lookup"><span data-stu-id="7fc91-181">When using parameterized filters, you must specify a parameterized row filter for one article using the **\@subset_filterclause** parameter.</span></span> <span data-ttu-id="7fc91-182">Para más información, consulte [Definir y modificar un filtro de fila con parámetros para un artículo de mezcla](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-182">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
4.  <span data-ttu-id="7fc91-183">Si se van a filtrar otros artículos según el filtro de fila con parámetros, ejecute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) para definir la combinación o las relaciones de registros lógicos entre los artículos.</span><span class="sxs-lookup"><span data-stu-id="7fc91-183">If other articles will be filtered based on the parameterized row filter, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) to define the join or logical record relationships between articles.</span></span> <span data-ttu-id="7fc91-184">Este procedimiento almacenado se debe ejecutar una vez para cada relación que se está definiendo.</span><span class="sxs-lookup"><span data-stu-id="7fc91-184">This stored procedure must be executed once for each relationship being defined.</span></span> <span data-ttu-id="7fc91-185">Para obtener más información, consulte [Definir y modificar un filtro de combinación entre artículos de mezcla](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-185">For more information, see [Define and Modify a Join Filter Between Merge Articles](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span></span>  
  
5.  <span data-ttu-id="7fc91-186">En el publicador de la base de datos de publicación, ejecute [sp_helpmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql) y especifique el valor de **\@publication** del paso 1.</span><span class="sxs-lookup"><span data-stu-id="7fc91-186">At the Publisher on the publication database, execute [sp_helpmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql), specifying the value of **\@publication** from step 1.</span></span> <span data-ttu-id="7fc91-187">Tenga en cuenta el valor de **snapshot_jobid** en el conjunto de resultados.</span><span class="sxs-lookup"><span data-stu-id="7fc91-187">Note the value of the **snapshot_jobid** in the result set.</span></span>  
  
6.  <span data-ttu-id="7fc91-188">Convierta el valor de **snapshot_jobid** obtenido en el paso 5 a **uniqueidentifier**.</span><span class="sxs-lookup"><span data-stu-id="7fc91-188">Convert the value of the **snapshot_jobid** obtained in step 5 to **uniqueidentifier**.</span></span>  
  
7.  <span data-ttu-id="7fc91-189">En el publicador en la base de datos **msdb**, ejecute [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql) y especifique el valor convertido obtenido en el paso 6 para **\@job_id**.</span><span class="sxs-lookup"><span data-stu-id="7fc91-189">At the Publisher on the **msdb** database, execute [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql), specifying the converted value obtained in step 6 for **\@job_id**.</span></span>  
  
8.  <span data-ttu-id="7fc91-190">En el publicador de la base de datos de publicación, ejecute [sp_addmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="7fc91-190">At the Publisher on the publication database, execute [sp_addmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql).</span></span> <span data-ttu-id="7fc91-191">Especifique el nombre de la publicación del paso 1 para **\@publication** y el valor usado para definir la partición para **\@suser_sname** si se ha usado [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) en la cláusula de filtro o para **\@host_name** si se ha usado [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="7fc91-191">Specify the name of the publication from step 1 for **\@publication** and the value used to define the partition for **\@suser_sname** if [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) is used in the filter clause or for **\@host_name** if [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) is used in the filter clause.</span></span>  
  
9. <span data-ttu-id="7fc91-192">En el publicador de la base de datos de publicación, ejecute [sp_adddynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="7fc91-192">At the publisher on the publication database, execute [sp_adddynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql).</span></span> <span data-ttu-id="7fc91-193">Especifique el nombre de la publicación del paso 1 para **\@publication**, el valor de **\@suser_sname** o **\@host_name** del paso 8, y una programación para el trabajo.</span><span class="sxs-lookup"><span data-stu-id="7fc91-193">Specify the name of the publication from step 1 for **\@publication**, the value of **\@suser_sname** or **\@host_name** from step 8, and a schedule for the job.</span></span> <span data-ttu-id="7fc91-194">Esto crea el trabajo que genera la instantánea con parámetros para la partición especificada.</span><span class="sxs-lookup"><span data-stu-id="7fc91-194">This creates the job that generates the parameterized snapshot for the specified partition.</span></span> <span data-ttu-id="7fc91-195">Para obtener más información, consulte [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-195">For more information, see [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="7fc91-196">Este trabajo se ejecuta usando la misma cuenta de Windows que el trabajo de la instantánea inicial definido en el paso 2.</span><span class="sxs-lookup"><span data-stu-id="7fc91-196">This job runs using the same Windows account as the initial snapshot job defined in step 2.</span></span> <span data-ttu-id="7fc91-197">Para quitar el trabajo de la instantánea con parámetros y su partición de datos relacionados, ejecute [sp_dropdynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-dropdynamicsnapshot-job-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="7fc91-197">To remove the parameterized snapshot job and its related data partition, execute [sp_dropdynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-dropdynamicsnapshot-job-transact-sql).</span></span>  
  
10. <span data-ttu-id="7fc91-198">En el publicador de la base de datos de publicación, ejecute [sp_helpmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepartition-transact-sql) y especifique el valor de **\@publication** del paso 1 y el valor de **\@suser_sname** o **\@host_name** del paso 8.</span><span class="sxs-lookup"><span data-stu-id="7fc91-198">At the Publisher on the publication database, execute [sp_helpmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepartition-transact-sql), specifying the value of **\@publication** from step 1 and the value of **\@suser_sname** or **\@host_name** from step 8.</span></span> <span data-ttu-id="7fc91-199">Tenga en cuenta el valor de **dynamic_snapshot_jobid** en el conjunto de resultados.</span><span class="sxs-lookup"><span data-stu-id="7fc91-199">Note the value of the **dynamic_snapshot_jobid** in the result set.</span></span>  
  
11. <span data-ttu-id="7fc91-200">En el distribuidor de la base de datos **msdb**, ejecute [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql) y especifique el valor obtenido en el paso 9 para **\@job_id**.</span><span class="sxs-lookup"><span data-stu-id="7fc91-200">At the Distributor on the **msdb** database, execute [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql), specifying the value obtained in step 9 for **\@job_id**.</span></span> <span data-ttu-id="7fc91-201">Esto inicia el trabajo de instantánea con parámetros para la partición.</span><span class="sxs-lookup"><span data-stu-id="7fc91-201">This starts the parameterized snapshot job for the partition.</span></span>  
  
12. <span data-ttu-id="7fc91-202">Repita los pasos 8-11 para generar una instantánea con particiones para cada suscripción.</span><span class="sxs-lookup"><span data-stu-id="7fc91-202">Repeat steps 8-11 to generate a partitioned snapshot for each subscription.</span></span>  
  
#### <a name="to-create-a-publication-and-manually-create-snapshots-for-each-partition"></a><span data-ttu-id="7fc91-203">Para crear una publicación y crear manualmente instantáneas para cada partición</span><span class="sxs-lookup"><span data-stu-id="7fc91-203">To create a publication and manually create snapshots for each partition</span></span>  
  
1.  <span data-ttu-id="7fc91-204">Ejecute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) para crear la publicación.</span><span class="sxs-lookup"><span data-stu-id="7fc91-204">Execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) to create the publication.</span></span> <span data-ttu-id="7fc91-205">Para obtener más información, vea [Crear una suscripción](publish/create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-205">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="7fc91-206">En el publicador, ejecute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="7fc91-206">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="7fc91-207">Especifique el nombre de publicación usado en el paso 1 para **\@publication** y las credenciales de Windows con las que se ejecuta el Agente de instantáneas para **\@job_login** y **\@password**.</span><span class="sxs-lookup"><span data-stu-id="7fc91-207">Specify the publication name used in step 1 for **\@publication** and the Windows credentials under which the Snapshot Agent runs for **\@job_login** and **\@password**.</span></span> <span data-ttu-id="7fc91-208">Si el agente va a usar autenticación de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] al conectarse al publicador, también debe especificar un valor de **0** para **\@publisher_security_mode** y la información de inicio de sesión de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] para **\@publisher_login** y **\@publisher_password**.</span><span class="sxs-lookup"><span data-stu-id="7fc91-208">If the agent will use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="7fc91-209">Esto crea un trabajo de Agente de instantáneas para la publicación.</span><span class="sxs-lookup"><span data-stu-id="7fc91-209">This creates a Snapshot Agent job for the publication.</span></span> <span data-ttu-id="7fc91-210">Para obtener más información sobre cómo generar una instantánea inicial y definir una programación personalizada para el Agente de instantáneas, vea [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-210">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="7fc91-211">Al configurar un publicador con un distribuidor remoto, los valores suministrados para todos los parámetros, incluidos *job_login* y *job_password*, se envían al distribuidor como texto sin formato.</span><span class="sxs-lookup"><span data-stu-id="7fc91-211">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="7fc91-212">Antes de ejecutar este procedimiento almacenado, se recomienda cifrar la conexión entre el publicador y su distribuidor remoto.</span><span class="sxs-lookup"><span data-stu-id="7fc91-212">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="7fc91-213">Para obtener más información, vea [Habilitar conexiones cifradas en el motor de base de datos &#40;Administrador de configuración de SQL Server&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-213">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="7fc91-214">Ejecute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) para agregar artículos a la publicación.</span><span class="sxs-lookup"><span data-stu-id="7fc91-214">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) to add articles to the publication.</span></span> <span data-ttu-id="7fc91-215">Este procedimiento almacenado se debe ejecutar una vez para cada artículo de la publicación.</span><span class="sxs-lookup"><span data-stu-id="7fc91-215">This stored procedure must be executed once for each article in the publication.</span></span> <span data-ttu-id="7fc91-216">Al usar filtros con parámetros, debe especificar un filtro de fila con parámetros para al menos un artículo mediante el parámetro **\@subset_filterclause**.</span><span class="sxs-lookup"><span data-stu-id="7fc91-216">When using parameterized filters, you must specify a parameterized row filter for at least one article using the **\@subset_filterclause** parameter.</span></span> <span data-ttu-id="7fc91-217">Para más información, consulte [Definir y modificar un filtro de fila con parámetros para un artículo de mezcla](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-217">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
4.  <span data-ttu-id="7fc91-218">Si se van a filtrar otros artículos según el filtro de fila con parámetros, ejecute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) para definir la combinación o las relaciones de registros lógicos entre los artículos.</span><span class="sxs-lookup"><span data-stu-id="7fc91-218">If other articles will be filtered based on the parameterized row filter, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) to define the join or logical record relationships between articles.</span></span> <span data-ttu-id="7fc91-219">Este procedimiento almacenado se debe ejecutar una vez para cada relación que se está definiendo.</span><span class="sxs-lookup"><span data-stu-id="7fc91-219">This stored procedure must be executed once for each relationship being defined.</span></span> <span data-ttu-id="7fc91-220">Para obtener más información, consulte [Definir y modificar un filtro de combinación entre artículos de mezcla](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-220">For more information, see [Define and Modify a Join Filter Between Merge Articles](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span></span>  
  
5.  <span data-ttu-id="7fc91-221">Inicie el trabajo de la instantánea o ejecute el Agente de instantáneas de replicación desde el símbolo del sistema para generar el esquema de instantáneas estándar y otros archivos.</span><span class="sxs-lookup"><span data-stu-id="7fc91-221">Start the snapshot job or run the Replication Snapshot Agent from the command prompt to generate the standard snapshot schema and other files.</span></span> <span data-ttu-id="7fc91-222">Para más información, consulte [Crear y aplicar la instantánea inicial](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-222">For more information, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
6.  <span data-ttu-id="7fc91-223">Ejecute de nuevo el Agente de instantáneas de replicación desde el símbolo del sistema para generar los archivos de copia masiva (.bcp), especificando la ubicación de la instantánea con particiones para **-DynamicSnapshotLocation** y una o ambas de las siguientes propiedades que define la partición:</span><span class="sxs-lookup"><span data-stu-id="7fc91-223">Run the Replication Snapshot Agent again from the command prompt to generate bulk copy (.bcp) files, specifying the location of the partitioned snapshot for **-DynamicSnapshotLocation** and one or both of the following properties that defines the partition:</span></span>  
  
    -   <span data-ttu-id="7fc91-224">**-DynamicFilterHostName**: el valor si se utiliza [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="7fc91-224">**-DynamicFilterHostName** - the value if [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) is used.</span></span>  
  
    -   <span data-ttu-id="7fc91-225">**-DynamicFilterLogin**: el valor si se utiliza [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="7fc91-225">**-DynamicFilterLogin** - the value if [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) is used.</span></span>  
  
7.  <span data-ttu-id="7fc91-226">Repita el paso 6 para generar una instantánea con particiones para cada suscripción.</span><span class="sxs-lookup"><span data-stu-id="7fc91-226">Repeat step 6 to generate a partitioned snapshot for each subscription.</span></span>  
  
8.  <span data-ttu-id="7fc91-227">Ejecute el Agente de mezcla para que cada suscripción aplique la instantánea con particiones inicial en los Suscriptores, especificando las propiedades siguientes:</span><span class="sxs-lookup"><span data-stu-id="7fc91-227">Run the Merge Agent for each subscription to apply the initial partitioned snapshot at the Subscribers, specifying the following properties:</span></span>  
  
    -   <span data-ttu-id="7fc91-228">**-Hostname** - el valor usado para definir la partición si se invalida el valor real de HOST_NAME.</span><span class="sxs-lookup"><span data-stu-id="7fc91-228">**-Hostname** - the value used to define the partition if the actual value of HOST_NAME is being overridden.</span></span>  
  
    -   <span data-ttu-id="7fc91-229">**-DynamicSnapshotLocation** - la ubicación de la instantánea dinámica para esta partición.</span><span class="sxs-lookup"><span data-stu-id="7fc91-229">**-DynamicSnapshotLocation** - the location of the dynamic snapshot for this partition.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="7fc91-230">Para obtener más información sobre cómo programar los agentes de replicación, consulte [Conceptos de los ejecutables del Agente de replicación](concepts/replication-agent-executables-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-230">For more information about programming replication agents, see [Replication Agent Executables Concepts](concepts/replication-agent-executables-concepts.md).</span></span>  
  
###  <a name="examples-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="7fc91-231">Ejemplos (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="7fc91-231">Examples (Transact-SQL)</span></span>  
 <span data-ttu-id="7fc91-232">Este ejemplo crea una publicación de combinación con filtros con parámetros donde los Suscriptores inician el proceso de generación de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="7fc91-232">This example creates a merge publication with parameterized filters where Subscribers initiate the snapshot generation process.</span></span> <span data-ttu-id="7fc91-233">Los valores para **\@job_login** y **\@job_password** se pasan mediante variables de scripting.</span><span class="sxs-lookup"><span data-stu-id="7fc91-233">Values for **\@job_login** and **\@job_password** are passed in using scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_MergeDynamicPub1](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubdynamic1.sql#sp_mergedynamicpub1)]  
  
 <span data-ttu-id="7fc91-234">Este ejemplo crea una publicación mediante un filtro con parámetros donde cada Suscriptor tiene su partición definida ejecutando [sp_addmergepartition](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql) y el trabajo de instantánea filtrado creado ejecutando [sp_adddynamicsnapshot_job](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql) que pasa la información de la partición.</span><span class="sxs-lookup"><span data-stu-id="7fc91-234">This example creates a publication using a parameterized filter where each Subscriber has its partition defined by executing [sp_addmergepartition](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql) and the filtered snapshot job created by executing [sp_adddynamicsnapshot_job](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql) passing the partitioning information.</span></span> <span data-ttu-id="7fc91-235">Los valores para **\@job_login** y **\@job_password** se pasan mediante variables de scripting.</span><span class="sxs-lookup"><span data-stu-id="7fc91-235">Values for **\@job_login** and **\@job_password** are passed in using scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_MergeDynamicPubPlusPartition](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubdynamic2.sql#sp_mergedynamicpubpluspartition)]  
  
 <span data-ttu-id="7fc91-236">Este ejemplo crea una publicación mediante un filtro con parámetros donde cada Suscriptor debe tener su partición de datos y el trabajo de instantánea filtrado creado proporcionando la información de la partición.</span><span class="sxs-lookup"><span data-stu-id="7fc91-236">This example creates a publication using a parameterized filter where each Subscriber must have its data partition and filtered snapshot job created by supplying the partitioning information.</span></span> <span data-ttu-id="7fc91-237">Un Suscriptor proporciona información de la partición mediante los parámetros de línea de comandos al ejecutar manualmente los agentes de replicación.</span><span class="sxs-lookup"><span data-stu-id="7fc91-237">A Subscriber supplies partitioning information using command-line parameters when manually running the replication agents.</span></span> <span data-ttu-id="7fc91-238">Este ejemplo supone que también se ha creado una suscripción a la publicación.</span><span class="sxs-lookup"><span data-stu-id="7fc91-238">This example assumes that a subscription to the publication has also been created.</span></span>  
  
 [!code-sql[HowTo#sp_MergeDynamicPubPartitionManual](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubdynamic3.sql#sp_mergedynamicpubpartitionmanual)]  
  
 
```
REM Line breaks are added to improve readability.   
REM In a batch file, commands must be made in a single line.  
REM Run the Snapshot agent from the command line to generate the standard snapshot   
REM schema and other files.   
SET DistPub=%computername%  
SET PubDB=AdventureWorks2012   
SET PubName=AdvWorksSalesPersonMerge  
  
"C:\Program Files\Microsoft SQL Server\120\COM\SNAPSHOT.EXE" -Publication %PubName%    
-Publisher %DistPub% -Distributor  %DistPub%  -PublisherDB %PubDB%  -ReplicationType 2    
-OutputVerboseLevel 1  -DistributorSecurityMode 1  
  
PAUSE  
```

```
REM Run the Snapshot agent from the command line, this time to generate   
REM the bulk copy (.bcp) data for each Subscriber partition.    
SET DistPub=%computername%  
SET PubDB=AdventureWorks2012   
SET PubName=AdvWorksSalesPersonMerge  
SET SnapshotDir=\\%DistPub%\repldata\unc\fernando  
  
MD %SnapshotDir%  
  
"C:\Program Files\Microsoft SQL Server\120\COM\SNAPSHOT.EXE" -Publication %PubName%    
-Publisher %DistPub%  -Distributor  %DistPub%  -PublisherDB %PubDB%  -ReplicationType 2    
-OutputVerboseLevel 1  -DistributorSecurityMode 1  -DynamicFilterHostName "adventure-works\Fernando"    
-DynamicSnapshotLocation %SnapshotDir%  
  
PAUSE  
```

```
REM Run the Merge Agent for each subscription to apply the partitioned   
REM snapshot for each Subscriber.    
SET Publisher = %computername%  
SET Subscriber = %computername%  
SET PubDB = AdventureWorks2012   
SET SubDB = AdventureWorks2012Replica   
SET PubName = AdvWorksSalesPersonMerge   
SET SnapshotDir=\\%DistPub%\repldata\unc\fernando  
  
"C:\Program Files\Microsoft SQL Server\120\COM\REPLMERG.EXE" -Publisher  %Publisher%    
-Subscriber  %Subscriber%  -Distributor %Publisher%  -PublisherDB %PubDB%    
-SubscriberDB %SubDB% -Publication %PubName%  -PublisherSecurityMode 1  -OutputVerboseLevel 3    
-Output -SubscriberSecurityMode 1  -SubscriptionType 3 -DistributorSecurityMode 1    
-Hostname "adventure-works\Fernando"  -DynamicSnapshotLocation %SnapshotDir%  
  
PAUSE
```
  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="7fc91-239">Uso de Replication Management Objects (RMO)</span><span class="sxs-lookup"><span data-stu-id="7fc91-239">Using Replication Management Objects (RMO)</span></span>  
 <span data-ttu-id="7fc91-240">Puede utilizar Replication Management Objects (RMO) para generar mediante programación instantáneas con particiones de las maneras siguientes:</span><span class="sxs-lookup"><span data-stu-id="7fc91-240">You can use Replication Management Objects (RMO) to generate partitioned snapshots programmatically in the following ways:</span></span>  
  
-   <span data-ttu-id="7fc91-241">Permita a los suscriptores que soliciten la generación y aplicación de instantáneas la primera vez que se sincronicen.</span><span class="sxs-lookup"><span data-stu-id="7fc91-241">Allow Subscribers to request snapshot generation and application the first time they synchronize.</span></span>  
  
-   <span data-ttu-id="7fc91-242">Genere previamente las instantáneas para cada partición.</span><span class="sxs-lookup"><span data-stu-id="7fc91-242">Pre-generate snapshots for each partition.</span></span>  
  
-   <span data-ttu-id="7fc91-243">Genere manualmente una instantánea para cada suscriptor ejecutando el Agente de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="7fc91-243">Manually generate a snapshot for each Subscriber by running the Snapshot Agent.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="7fc91-244">Si al filtrar un artículo se producen particiones no superpuestas que son únicas para cada suscripción (especificando el valor <xref:Microsoft.SqlServer.Replication.PartitionOptions.NonOverlappingSingleSubscription> para <xref:Microsoft.SqlServer.Replication.MergeArticle.PartitionOption%2A> al crear un artículo de mezcla), cada vez que se ejecuta el Agente de mezcla se limpian los metadatos.</span><span class="sxs-lookup"><span data-stu-id="7fc91-244">When filtering for an article yields non-overlapping partitions that are unique for each subscription (by specifying a value of <xref:Microsoft.SqlServer.Replication.PartitionOptions.NonOverlappingSingleSubscription> for <xref:Microsoft.SqlServer.Replication.MergeArticle.PartitionOption%2A> when creating a merge article), metadata is cleaned up whenever the Merge Agent runs.</span></span> <span data-ttu-id="7fc91-245">Esto significa que la instantánea con particiones expira antes.</span><span class="sxs-lookup"><span data-stu-id="7fc91-245">This means that the partitioned snapshot expires more quickly.</span></span> <span data-ttu-id="7fc91-246">Cuando utilice esta opción, puede ser conveniente permitir a los suscriptores que soliciten la generación de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="7fc91-246">When you use this option, you should consider allowing Subscribers to request snapshot generation.</span></span> <span data-ttu-id="7fc91-247">Para obtener más información, vea la sección Usar las opciones de filtrado apropiadas del tema [Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-247">For more information, see the section Using the Appropriate Filtering Options in the topic [Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="7fc91-248">Cuando sea posible, pida a los usuarios que proporcionen credenciales de seguridad en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="7fc91-248">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="7fc91-249">Si debe almacenar credenciales, use los [servicios de cifrado](https://go.microsoft.com/fwlink/?LinkId=34733) (en inglés) proporcionados por [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="7fc91-249">If you must store credentials, use the [cryptographic services](https://go.microsoft.com/fwlink/?LinkId=34733) provided by the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows .NET Framework.</span></span>  
  
#### <a name="to-create-a-publication-that-allows-subscribers-to-initiate-snapshot-generation-and-delivery"></a><span data-ttu-id="7fc91-250">Para crear una publicación que permita a los suscriptores iniciar la generación y entrega de instantáneas</span><span class="sxs-lookup"><span data-stu-id="7fc91-250">To create a publication that allows Subscribers to initiate snapshot generation and delivery</span></span>  
  
1.  <span data-ttu-id="7fc91-251">Cree una conexión al publicador mediante la clase <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="7fc91-251">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="7fc91-252">Cree una instancia de la clase <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> para la base de datos de publicación, establezca la propiedad <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> en la instancia de <xref:Microsoft.SqlServer.Management.Common.ServerConnection> del paso 1 y llame al método <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> .</span><span class="sxs-lookup"><span data-stu-id="7fc91-252">Create an instance of the <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> class for the publication database, set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the instance of <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1, and call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="7fc91-253">Si <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> devuelve `false`, confirme que la base de datos existe.</span><span class="sxs-lookup"><span data-stu-id="7fc91-253">If <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> returns `false`, confirm that the database exists.</span></span>  
  
3.  <span data-ttu-id="7fc91-254">Si la propiedad <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledMergePublishing%2A> está establecida en `false`, cámbiela a `true` y llame a <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A>.</span><span class="sxs-lookup"><span data-stu-id="7fc91-254">If <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledMergePublishing%2A> property is `false`, set it to `true` and call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A>.</span></span>  
  
4.  <span data-ttu-id="7fc91-255">Cree una instancia de la clase <xref:Microsoft.SqlServer.Replication.MergePublication> y establezca las propiedades siguientes para este objeto:</span><span class="sxs-lookup"><span data-stu-id="7fc91-255">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class, and set the following properties for this object:</span></span>  
  
    -   <span data-ttu-id="7fc91-256">La <xref:Microsoft.SqlServer.Management.Common.ServerConnection> del paso 1 para <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span><span class="sxs-lookup"><span data-stu-id="7fc91-256">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="7fc91-257">El nombre de la base de datos publicada para <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>.</span><span class="sxs-lookup"><span data-stu-id="7fc91-257">The name of the published database for <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="7fc91-258">Un nombre de publicación para <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>.</span><span class="sxs-lookup"><span data-stu-id="7fc91-258">A name for the publication for <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>.</span></span>  
  
    -   <span data-ttu-id="7fc91-259">El número máximo de trabajos de instantáneas dinámicas que se van a ejecutar para <xref:Microsoft.SqlServer.Replication.MergePublication.MaxConcurrentDynamicSnapshots%2A>.</span><span class="sxs-lookup"><span data-stu-id="7fc91-259">The maximum number of dynamic snapshot jobs to run for <xref:Microsoft.SqlServer.Replication.MergePublication.MaxConcurrentDynamicSnapshots%2A>.</span></span> <span data-ttu-id="7fc91-260">Dado que las solicitudes de instantáneas iniciadas por el suscriptor pueden producirse en cualquier momento, esta propiedad limita el número de trabajos del Agente de instantáneas que se pueden ejecutar simultáneamente cuando varios suscriptores solicitan al mismo tiempo su instantánea con particiones.</span><span class="sxs-lookup"><span data-stu-id="7fc91-260">Because Subscriber initiated snapshot requests can occur at any time, this property limits the number of Snapshot Agent jobs that can run simultaneously when multiple Subscribers request their partitioned snapshot at the same time.</span></span> <span data-ttu-id="7fc91-261">Cuando se está ejecutando el número máximo de trabajos, las demás solicitudes de instantáneas con particiones se ponen en la cola hasta que se completa uno de los trabajos en ejecución.</span><span class="sxs-lookup"><span data-stu-id="7fc91-261">When the maximum number of jobs are running, additional partitioned snapshot requests are queued until one of the running jobs is completed.</span></span>  
  
    -   <span data-ttu-id="7fc91-262">Utilice el operador lógico OR bit a bit (`|` en Visual C# y `Or` en Visual Basic) para agregar el valor <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowSubscriberInitiatedSnapshot> a <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A>.</span><span class="sxs-lookup"><span data-stu-id="7fc91-262">Use the bitwise logical OR (`|` in Visual C# and `Or` in Visual Basic) operator to add the value <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowSubscriberInitiatedSnapshot> to <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A>.</span></span>  
  
    -   <span data-ttu-id="7fc91-263">Los campos <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> y <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> de <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> para proporcionar las credenciales de la cuenta de [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows con la que se ejecuta el trabajo del Agente de mezcla.</span><span class="sxs-lookup"><span data-stu-id="7fc91-263">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> fields of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account under which the Snapshot Agent job runs.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="7fc91-264">Se recomienda establecer <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> cuando un miembro del rol fijo de servidor `sysadmin` crea la publicación.</span><span class="sxs-lookup"><span data-stu-id="7fc91-264">Setting <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> is recommended when the publication is created by a member of the `sysadmin` fixed server role.</span></span> <span data-ttu-id="7fc91-265">Para más información, consulte [Modelo de seguridad del agente de replicación](security/replication-agent-security-model.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-265">For more information, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
5.  <span data-ttu-id="7fc91-266">Llame al método <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> para crear la publicación.</span><span class="sxs-lookup"><span data-stu-id="7fc91-266">Call the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method to create the publication.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="7fc91-267">Cuando se configura un Publicador con un Distribuidor remoto, los valores suministrados para todas las propiedades, incluidos <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>, se envían al Distribuidor como texto simple.</span><span class="sxs-lookup"><span data-stu-id="7fc91-267">When configuring a Publisher with a remote Distributor, the values supplied for all properties, including <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="7fc91-268">Debe cifrar la conexión entre el publicador y su distribuidor remoto antes de llamar al método <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> .</span><span class="sxs-lookup"><span data-stu-id="7fc91-268">You should encrypt the connection between the Publisher and its remote Distributor before calling the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method.</span></span> <span data-ttu-id="7fc91-269">Para obtener más información, vea [Habilitar conexiones cifradas en el motor de base de datos &#40;Administrador de configuración de SQL Server&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-269">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
6.  <span data-ttu-id="7fc91-270">Utilice la propiedad <xref:Microsoft.SqlServer.Replication.MergeArticle> para agregar artículos a la publicación.</span><span class="sxs-lookup"><span data-stu-id="7fc91-270">Use the <xref:Microsoft.SqlServer.Replication.MergeArticle> property to add articles to the publication.</span></span> <span data-ttu-id="7fc91-271">Especifique la propiedad <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> al menos para un artículo que defina el filtro con parámetros.</span><span class="sxs-lookup"><span data-stu-id="7fc91-271">Specify the <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> property for at least one article that defines the parameterized filter.</span></span> <span data-ttu-id="7fc91-272">(Opcional) Cree objetos <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> que definan filtros de combinación entre artículos.</span><span class="sxs-lookup"><span data-stu-id="7fc91-272">(Optional) Create <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> objects that define join filters between articles.</span></span> <span data-ttu-id="7fc91-273">Para más información, consulte [Define an Article](publish/define-an-article.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-273">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
7.  <span data-ttu-id="7fc91-274">Si el valor de <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> es `false`, llame a <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> para crear el trabajo inicial de Agente de instantáneas para esta publicación.</span><span class="sxs-lookup"><span data-stu-id="7fc91-274">If the value of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> is `false`, call <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> to create the initial Snapshot Agent job for this publication.</span></span>  
  
8.  <span data-ttu-id="7fc91-275">Llame al método <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> del objeto <xref:Microsoft.SqlServer.Replication.MergePublication> creado en el paso 4.</span><span class="sxs-lookup"><span data-stu-id="7fc91-275">Call the <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> method of the <xref:Microsoft.SqlServer.Replication.MergePublication> object created in step 4.</span></span> <span data-ttu-id="7fc91-276">Esto inicia el trabajo de agente que genera la instantánea inicial.</span><span class="sxs-lookup"><span data-stu-id="7fc91-276">This starts the agent job that generates the initial snapshot.</span></span> <span data-ttu-id="7fc91-277">Para obtener más información sobre cómo generar una instantánea inicial y definir una programación personalizada para el Agente de instantáneas, vea [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-277">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
9. <span data-ttu-id="7fc91-278">(Opcional) Compruebe que hay establecido un valor `true` en la propiedad <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> para que determine cuándo está lista para usarse la instantánea inicial.</span><span class="sxs-lookup"><span data-stu-id="7fc91-278">(Optional) Check for a value of `true` for the <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> property to determine when the initial snapshot is ready for use.</span></span>  
  
10. <span data-ttu-id="7fc91-279">Cuando el Agente de mezcla de un suscriptor se conecta por primera vez, se genera automáticamente una instantánea con particiones.</span><span class="sxs-lookup"><span data-stu-id="7fc91-279">When the Merge Agent for a Subscriber connects for the first time, a partitioned snapshot is generated automatically.</span></span>  
  
#### <a name="to-create-a-publication-and-pregenerate-or-automatically-refresh-snapshots"></a><span data-ttu-id="7fc91-280">Para crear una publicación y pregenerar o actualizar automáticamente las instantáneas</span><span class="sxs-lookup"><span data-stu-id="7fc91-280">To create a publication and pregenerate or automatically refresh snapshots</span></span>  
  
1.  <span data-ttu-id="7fc91-281">Utilice una instancia de la clase <xref:Microsoft.SqlServer.Replication.MergePublication> para definir una publicación de combinación.</span><span class="sxs-lookup"><span data-stu-id="7fc91-281">Use an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class to define a merge publication.</span></span> <span data-ttu-id="7fc91-282">Para obtener más información, vea [Crear una suscripción](publish/create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-282">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="7fc91-283">Utilice la propiedad <xref:Microsoft.SqlServer.Replication.MergeArticle> para agregar artículos a la publicación.</span><span class="sxs-lookup"><span data-stu-id="7fc91-283">Use the <xref:Microsoft.SqlServer.Replication.MergeArticle> property to add articles to the publication.</span></span> <span data-ttu-id="7fc91-284">Especifique la propiedad <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> al menos para un artículo que defina el filtro con parámetros y cree objetos <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> que definan filtros de unión entre artículos.</span><span class="sxs-lookup"><span data-stu-id="7fc91-284">Specify the <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> property for at least one article that defines the parameterized filter, and create any <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> objects that define join filters between articles.</span></span> <span data-ttu-id="7fc91-285">Para más información, consulte [Define an Article](publish/define-an-article.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-285">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
3.  <span data-ttu-id="7fc91-286">Si el valor de <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> es `false`, llame a <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> para crear el trabajo de Agente de instantáneas para esta publicación.</span><span class="sxs-lookup"><span data-stu-id="7fc91-286">If the value of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> is `false`, call <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> to create the snapshot agent job for this publication.</span></span>  
  
4.  <span data-ttu-id="7fc91-287">Llame al método <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> del objeto <xref:Microsoft.SqlServer.Replication.MergePublication> creado en el paso 1.</span><span class="sxs-lookup"><span data-stu-id="7fc91-287">Call the <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> method of the <xref:Microsoft.SqlServer.Replication.MergePublication> object created in step 1.</span></span> <span data-ttu-id="7fc91-288">Este método inicia el trabajo de agente que genera la instantánea inicial.</span><span class="sxs-lookup"><span data-stu-id="7fc91-288">This method starts the agent job that generates the initial snapshot.</span></span> <span data-ttu-id="7fc91-289">Para obtener más información sobre cómo generar una instantánea inicial y definir una programación personalizada para el Agente de instantáneas, vea [Crear y aplicar la instantánea inicial](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-289">For more information on generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
5.  <span data-ttu-id="7fc91-290">Compruebe que hay establecido un valor `true` en la propiedad <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> para que determine cuándo está lista para usarse la instantánea inicial.</span><span class="sxs-lookup"><span data-stu-id="7fc91-290">Check for a value of `true` for the <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> property to determine when the initial snapshot is ready for use.</span></span>  
  
6.  <span data-ttu-id="7fc91-291">Cree una instancia de la clase <xref:Microsoft.SqlServer.Replication.MergePartition> y establezca los criterios de filtro con parámetros para el suscriptor utilizando una o ambas de las propiedades siguientes:</span><span class="sxs-lookup"><span data-stu-id="7fc91-291">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePartition> class, and set the parameterized filtering criteria for the Subscriber by using one or both of the following properties:</span></span>  
  
    -   <span data-ttu-id="7fc91-292">Si el resultado de [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) define la partición del suscriptor, use <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterLogin%2A>.</span><span class="sxs-lookup"><span data-stu-id="7fc91-292">If the Subscriber's partition is defined by the result of [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), use <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterLogin%2A>.</span></span>  
  
    -   <span data-ttu-id="7fc91-293">Si el resultado de [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) o una sobrecarga de esta función definen la partición del suscriptor, use <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterHostName%2A>.</span><span class="sxs-lookup"><span data-stu-id="7fc91-293">If the Subscriber's partition is defined by the result of [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) or an overload of this function, use <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterHostName%2A>.</span></span>  
  
7.  <span data-ttu-id="7fc91-294">Cree una instancia de la clase <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> y establezca la misma propiedad como en el paso 6.</span><span class="sxs-lookup"><span data-stu-id="7fc91-294">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> class, and set the same property as in step 6.</span></span>  
  
8.  <span data-ttu-id="7fc91-295">Utilice la clase <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> para definir una programación para generar la instantánea filtrada para la partición del suscriptor.</span><span class="sxs-lookup"><span data-stu-id="7fc91-295">Use the <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> class to define a schedule for generating the filtered snapshot for the Subscriber partition.</span></span>  
  
9. <span data-ttu-id="7fc91-296">Utilizando la instancia de <xref:Microsoft.SqlServer.Replication.MergePublication> del paso 1, llame a <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergePartition%2A>.</span><span class="sxs-lookup"><span data-stu-id="7fc91-296">Using the instance of <xref:Microsoft.SqlServer.Replication.MergePublication> from step 1, call <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergePartition%2A>.</span></span> <span data-ttu-id="7fc91-297">Pase el objeto <xref:Microsoft.SqlServer.Replication.MergePartition> del paso 6.</span><span class="sxs-lookup"><span data-stu-id="7fc91-297">Pass the <xref:Microsoft.SqlServer.Replication.MergePartition> object from step 6.</span></span>  
  
10. <span data-ttu-id="7fc91-298">Utilizando la instancia de <xref:Microsoft.SqlServer.Replication.MergePublication> del paso 1, llame al método <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergeDynamicSnapshotJob%2A> .</span><span class="sxs-lookup"><span data-stu-id="7fc91-298">Using the instance of <xref:Microsoft.SqlServer.Replication.MergePublication> from step 1, call the <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergeDynamicSnapshotJob%2A> method.</span></span> <span data-ttu-id="7fc91-299">Pase el objeto <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> del paso 7 y el objeto <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> del paso 8.</span><span class="sxs-lookup"><span data-stu-id="7fc91-299">Pass the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> object from step 7 and the <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> object from step 8.</span></span>  
  
11. <span data-ttu-id="7fc91-300">Llame a <xref:Microsoft.SqlServer.Replication.MergePublication.EnumMergeDynamicSnapshotJobs%2A>y busque el objeto <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> para el trabajo de instantánea con particiones recientemente agregado en la matriz devuelta.</span><span class="sxs-lookup"><span data-stu-id="7fc91-300">Call <xref:Microsoft.SqlServer.Replication.MergePublication.EnumMergeDynamicSnapshotJobs%2A>, and locate the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> object for the newly added partitioned snapshot job in the returned array.</span></span>  
  
12. <span data-ttu-id="7fc91-301">Obtenga la propiedad <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob.Name%2A> de la tarea.</span><span class="sxs-lookup"><span data-stu-id="7fc91-301">Get the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob.Name%2A> property for the job.</span></span>  
  
13. <span data-ttu-id="7fc91-302">Cree una conexión al distribuidor mediante la clase <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="7fc91-302">Create a connection to the Distributor by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
14. <span data-ttu-id="7fc91-303">Cree una instancia de la clase de Objetos de administración de SQL Server (SMO) <xref:Microsoft.SqlServer.Management.Smo.Server> , pasando el objeto <xref:Microsoft.SqlServer.Management.Common.ServerConnection> del paso 13.</span><span class="sxs-lookup"><span data-stu-id="7fc91-303">Create an instance of the SQL Server Management Objects (SMO) <xref:Microsoft.SqlServer.Management.Smo.Server> class, passing the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> object from step 13.</span></span>  
  
15. <span data-ttu-id="7fc91-304">Cree una instancia de la clase <xref:Microsoft.SqlServer.Management.Smo.Agent.Job> , pasando la propiedad <xref:Microsoft.SqlServer.Management.Smo.Server.JobServer%2A> del objeto <xref:Microsoft.SqlServer.Management.Smo.Server> del paso 14 y el nombre de trabajo del paso 12.</span><span class="sxs-lookup"><span data-stu-id="7fc91-304">Create an instance of the <xref:Microsoft.SqlServer.Management.Smo.Agent.Job> class, passing the <xref:Microsoft.SqlServer.Management.Smo.Server.JobServer%2A> property of the <xref:Microsoft.SqlServer.Management.Smo.Server> object from step 14 and the job name from step 12.</span></span>  
  
16. <span data-ttu-id="7fc91-305">Llame al método <xref:Microsoft.SqlServer.Management.Smo.Agent.Job.Start%2A> para iniciar el trabajo de instantánea con particiones.</span><span class="sxs-lookup"><span data-stu-id="7fc91-305">Call the <xref:Microsoft.SqlServer.Management.Smo.Agent.Job.Start%2A> method to start the partitioned snapshot job.</span></span>  
  
17. <span data-ttu-id="7fc91-306">Repita los pasos 6-16 para cada suscriptor.</span><span class="sxs-lookup"><span data-stu-id="7fc91-306">Repeat steps 6-16 for each Subscriber.</span></span>  
  
#### <a name="to-create-a-publication-and-manually-create-snapshots-for-each-partition"></a><span data-ttu-id="7fc91-307">Para crear una publicación y crear manualmente instantáneas para cada partición</span><span class="sxs-lookup"><span data-stu-id="7fc91-307">To create a publication and manually create snapshots for each partition</span></span>  
  
1.  <span data-ttu-id="7fc91-308">Utilice una instancia de la clase <xref:Microsoft.SqlServer.Replication.MergePublication> para definir una publicación de combinación.</span><span class="sxs-lookup"><span data-stu-id="7fc91-308">Use an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class to define a merge publication.</span></span> <span data-ttu-id="7fc91-309">Para obtener más información, vea [Crear una suscripción](publish/create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-309">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="7fc91-310">Utilice la propiedad <xref:Microsoft.SqlServer.Replication.MergeArticle> para agregar artículos a la publicación. Especifique la propiedad <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> al menos para un artículo que defina el filtro con parámetros y cree objetos <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> que definan filtros de combinanción entre artículos.</span><span class="sxs-lookup"><span data-stu-id="7fc91-310">Use the <xref:Microsoft.SqlServer.Replication.MergeArticle> property to add articles to the publication Specify the <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> property for at least one article that defines the parameterized filter, and create any <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> objects that define join filters between articles.</span></span> <span data-ttu-id="7fc91-311">Para más información, consulte [Define an Article](publish/define-an-article.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-311">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
3.  <span data-ttu-id="7fc91-312">Genere la instantánea inicial.</span><span class="sxs-lookup"><span data-stu-id="7fc91-312">Generate the initial snapshot.</span></span> <span data-ttu-id="7fc91-313">Para más información, consulte [Crear y aplicar la instantánea inicial](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="7fc91-313">For more information, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
4.  <span data-ttu-id="7fc91-314">Cree una instancia de la clase <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> y establezca las propiedades necesarias siguientes:</span><span class="sxs-lookup"><span data-stu-id="7fc91-314">Create an instance of the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> class, and set the following required properties:</span></span>  
  
    -   <span data-ttu-id="7fc91-315"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> - nombre del publicador</span><span class="sxs-lookup"><span data-stu-id="7fc91-315"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> - name of the Publisher</span></span>  
  
    -   <span data-ttu-id="7fc91-316"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> - nombre de la base de datos de publicación</span><span class="sxs-lookup"><span data-stu-id="7fc91-316"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> - name of the publication database</span></span>  
  
    -   <span data-ttu-id="7fc91-317"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> - nombre de la publicación</span><span class="sxs-lookup"><span data-stu-id="7fc91-317"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> - name of the publication</span></span>  
  
    -   <span data-ttu-id="7fc91-318"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> - nombre del distribuidor</span><span class="sxs-lookup"><span data-stu-id="7fc91-318"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> - name of the Distributor</span></span>  
  
    -   <span data-ttu-id="7fc91-319"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> - el valor <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> para utilizar autenticación integrada de Windows o un valor <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> para usar autenticación de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="7fc91-319"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to used Windows Integrated Authentication or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> to use SQL Server Authentication.</span></span>  
  
    -   <span data-ttu-id="7fc91-320"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> - el valor <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> para utilizar autenticación integrada de Windows o un valor <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> para usar autenticación de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="7fc91-320"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to used Windows Integrated Authentication or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> to use SQL Server Authentication.</span></span>  
  
5.  <span data-ttu-id="7fc91-321">Establezca un valor <xref:Microsoft.SqlServer.Replication.ReplicationType.Merge> para <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>.</span><span class="sxs-lookup"><span data-stu-id="7fc91-321">Set a value of <xref:Microsoft.SqlServer.Replication.ReplicationType.Merge> for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>.</span></span>  
  
6.  <span data-ttu-id="7fc91-322">Establezca una o más de las propiedades siguientes para definir los parámetros del particionamiento:</span><span class="sxs-lookup"><span data-stu-id="7fc91-322">Set one or more of the following properties to define the partitioning parameters:</span></span>  
  
    -   <span data-ttu-id="7fc91-323">Si el resultado de [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) define la partición del suscriptor, use <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterLogin%2A>.</span><span class="sxs-lookup"><span data-stu-id="7fc91-323">If the Subscriber's partition is defined by the result of [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), use <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterLogin%2A>.</span></span>  
  
    -   <span data-ttu-id="7fc91-324">Si el resultado de [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) o una sobrecarga de esta función definen la partición del suscriptor, use <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterHostName%2A>.</span><span class="sxs-lookup"><span data-stu-id="7fc91-324">If the Subscriber's partition is defined by the result of [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) or an overload of this function, use <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterHostName%2A>.</span></span>  
  
7.  <span data-ttu-id="7fc91-325">Llame al método <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> .</span><span class="sxs-lookup"><span data-stu-id="7fc91-325">Call the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> method.</span></span>  
  
8.  <span data-ttu-id="7fc91-326">Repita los pasos 4-7 para cada suscriptor.</span><span class="sxs-lookup"><span data-stu-id="7fc91-326">Repeat steps 4-7 for each Subscriber.</span></span>  
  
###  <a name="examples-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="7fc91-327">Ejemplos (RMO)</span><span class="sxs-lookup"><span data-stu-id="7fc91-327">Examples (RMO)</span></span>  
 <span data-ttu-id="7fc91-328">En este ejemplo se crea una publicación de combinación que permite a los suscriptores solicitar la generación de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="7fc91-328">This example creates a merge publication that allows Subscribers to requested snapshot generation.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepub)]  
  
 <span data-ttu-id="7fc91-329">En este ejemplo se crea manualmente la partición del suscriptor y la instantánea filtrada para una publicación de combinación con filtros de filas con parámetros.</span><span class="sxs-lookup"><span data-stu-id="7fc91-329">This example manually creates the Subscriber partition and the filtered snapshot for a merge publication with parameterized row filters.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePartition](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepartition)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePartition](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepartition)]  
  
 <span data-ttu-id="7fc91-330">En este ejemplo se inicia manualmente el Agente de instantáneas para generar la instantánea de datos filtrados de un suscriptor para una publicación de combinación con filtros de filas con parámetros.</span><span class="sxs-lookup"><span data-stu-id="7fc91-330">This example manually starts the Snapshot Agent to generate the filtered data snapshot for a Subscriber to a merge publication with parameterized row filters.</span></span>  
  
 [!code-csharp[HowTo#rmo_GenerateFilteredSnapshot](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_generatefilteredsnapshot)]  
  
 [!code-vb[HowTo#rmo_vb_GenerateFilteredSnapshot](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_generatefilteredsnapshot)]  
  
## <a name="see-also"></a><span data-ttu-id="7fc91-331">Consulte también</span><span class="sxs-lookup"><span data-stu-id="7fc91-331">See Also</span></span>  
 <span data-ttu-id="7fc91-332">[Filtros de fila con parámetros](merge/parameterized-filters-parameterized-row-filters.md) </span><span class="sxs-lookup"><span data-stu-id="7fc91-332">[Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md) </span></span>  
 <span data-ttu-id="7fc91-333">[Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="7fc91-333">[Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md) </span></span>  
 <span data-ttu-id="7fc91-334">[Instantáneas para publicaciones de combinación con filtros con parámetros](snapshots-for-merge-publications-with-parameterized-filters.md) </span><span class="sxs-lookup"><span data-stu-id="7fc91-334">[Snapshots for Merge Publications with Parameterized Filters](snapshots-for-merge-publications-with-parameterized-filters.md) </span></span>  
 [<span data-ttu-id="7fc91-335">Procedimientos recomendados de seguridad de replicación</span><span class="sxs-lookup"><span data-stu-id="7fc91-335">Replication Security Best Practices</span></span>](security/replication-security-best-practices.md)  
  
  
