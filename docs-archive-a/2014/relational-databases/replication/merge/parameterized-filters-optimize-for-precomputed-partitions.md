---
title: Optimización del rendimiento de los filtros con parámetros con particiones calculadas previamente | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- precomputed partitions [SQL Server replication]
- merge replication precomputed partitions [SQL Server replication]
- merge replication precomputed partitions [SQL Server replication], about precomputed partitions
ms.assetid: 85654bf4-e25f-4f04-8e34-bbbd738d60fa
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 4ad0a33f0a5951256ff94bc78e7f09a88c05f227
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87749737"
---
# <a name="optimize-parameterized-filter-performance-with-precomputed-partitions"></a><span data-ttu-id="e6ac0-102">Optimizar el rendimiento de los filtros con parámetros con particiones calculadas previamente</span><span class="sxs-lookup"><span data-stu-id="e6ac0-102">Optimize Parameterized Filter Performance with Precomputed Partitions</span></span>
  <span data-ttu-id="e6ac0-103">Las particiones precalculadas son una optimización del rendimiento que se puede utilizar con publicaciones de combinación filtradas.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-103">Precomputed partitions is a performance optimization that can be used with filtered merge publications.</span></span> <span data-ttu-id="e6ac0-104">Las particiones precalculadas son también un requisito para utilizar registros locales en publicaciones filtradas.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-104">Precomputed partitions is also a requirement for using logical records on filtered publications.</span></span> <span data-ttu-id="e6ac0-105">Para obtener más información sobre los registros lógicos, vea [Agrupar cambios en filas relacionadas con registros lógicos](group-changes-to-related-rows-with-logical-records.md).</span><span class="sxs-lookup"><span data-stu-id="e6ac0-105">For more information about logical records, see [Group Changes to Related Rows with Logical Records](group-changes-to-related-rows-with-logical-records.md).</span></span>  
  
 <span data-ttu-id="e6ac0-106">Cuando un suscriptor se sincroniza con un publicador, el publicador debe evaluar los filtros del suscriptor para determinar qué filas pertenecen a la partición, o conjunto de datos, de ese suscriptor.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-106">When a Subscriber synchronizes with a Publisher, the Publisher must evaluate the Subscriber's filters to determine which rows belong to that Subscriber's partition, or data set.</span></span> <span data-ttu-id="e6ac0-107">Este proceso de determinar la pertenencia a particiones de los cambios en el publicador para cada suscriptor que recibe un conjunto de datos filtrados se denomina *evaluación de particiones*.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-107">This process of determining partition membership of changes at the Publisher for each Subscriber receiving a filtered dataset is referred to as *partition evaluation*.</span></span> <span data-ttu-id="e6ac0-108">Sin las particiones precalculadas, la evaluación de particiones debe realizarse para cada cambio efectuado en una columna filtrada del publicador desde la última vez que se ejecutó el Agente de mezcla para un suscriptor concreto, y este proceso tiene que repetirse para cada suscriptor que se sincroniza con el publicador.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-108">Without precomputed partitions, partition evaluation must be performed for each change made to a filtered column at the Publisher since the last time the Merge Agent ran for a specific Subscriber, and this process has to be repeated for every Subscriber that synchronizes with the Publisher.</span></span>  
  
 <span data-ttu-id="e6ac0-109">Sin embargo, si el publicador y el suscriptor se están ejecutando en [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] o una versión posterior y utiliza particiones precalculadas, la pertenencia a particiones de todos los cambios en el publicador se calcula previamente y se conserva en el momento en que se realizan los cambios.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-109">However, if the Publisher and Subscriber are running on [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version and you use precomputed partitions, partition membership for all changes at the Publisher is precomputed and persisted at the time that the changes are made.</span></span> <span data-ttu-id="e6ac0-110">Como resultado, cuando un suscriptor se sincroniza con el publicador, puede empezar a descargar inmediatamente los cambios relativos a su partición sin tener que pasar por el proceso de evaluación de particiones.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-110">As a result, when a Subscriber synchronizes with the Publisher, it can immediately start to download changes relevant to its partition without having to go through the partition evaluation process.</span></span> <span data-ttu-id="e6ac0-111">Esto puede producir importantes mejoras de rendimiento cuando una publicación tiene un número elevado de cambios, suscriptores o artículos.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-111">This can lead to significant performance gains when a publication has a large number of changes, Subscribers, or articles in the publication.</span></span>  
  
 <span data-ttu-id="e6ac0-112">Además de utilizar particiones precalculadas, genere instantáneas previamente o permita a los suscriptores que soliciten la generación y aplicación de instantáneas la primera vez que se sincronizan.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-112">In addition to using precomputed partitions, pre-generate snapshots and/or allow Subscribers to request snapshot generation and application the first time they synchronize.</span></span> <span data-ttu-id="e6ac0-113">Utilice una de estas opciones o las dos para proporcionar instantáneas para publicaciones que utilicen filtros con parámetros.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-113">Use one or both of these options to provide snapshots for publications that use parameterized filters.</span></span> <span data-ttu-id="e6ac0-114">Si no especifica una de estas opciones, las suscripciones se inicializan utilizando una serie de instrucciones SELECT e INSERT, en lugar de la utilidad **bcp** ; este proceso es mucho más lento.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-114">If you do not specify one of these options, subscriptions are initialized using a series of SELECT and INSERT statements, rather than using the **bcp** utility; this process is much slower.</span></span> <span data-ttu-id="e6ac0-115">Para más información, consulte [Instantáneas para publicaciones de combinación con filtros con parámetros](../snapshots-for-merge-publications-with-parameterized-filters.md).</span><span class="sxs-lookup"><span data-stu-id="e6ac0-115">For more information, see [Snapshots for Merge Publications with Parameterized Filters](../snapshots-for-merge-publications-with-parameterized-filters.md).</span></span>  
  
 <span data-ttu-id="e6ac0-116">**Para utilizar particiones precalculadas**</span><span class="sxs-lookup"><span data-stu-id="e6ac0-116">**To use precomputed partitions**</span></span>  
  
 <span data-ttu-id="e6ac0-117">Las particiones precalculadas están habilitadas de forma predeterminada en todas las publicaciones nuevas y existentes que se ajustan a las directrices indicadas anteriormente.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-117">Precomputed partitions are enabled by default on all new and existing publications that adhere to the guidelines described above.</span></span> <span data-ttu-id="e6ac0-118">La configuración se puede cambiar a través de [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] o mediante programación.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-118">The setting can be changed through [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] or programmatically.</span></span> <span data-ttu-id="e6ac0-119">Para más información, consulte [Optimize Parameterized Row Filters](../publish/optimize-parameterized-row-filters.md).</span><span class="sxs-lookup"><span data-stu-id="e6ac0-119">For more information, see [Optimize Parameterized Row Filters](../publish/optimize-parameterized-row-filters.md).</span></span>  
  
## <a name="requirements-for-using-precomputed-partitions"></a><span data-ttu-id="e6ac0-120">Requisitos para utilizar particiones precalculadas</span><span class="sxs-lookup"><span data-stu-id="e6ac0-120">Requirements for Using Precomputed Partitions</span></span>  
 <span data-ttu-id="e6ac0-121">Si se reúnen los siguientes requisitos, las publicaciones de combinación nuevas se crean, de forma predeterminada, con las particiones precalculadas habilitadas, y las publicaciones existentes se actualizan de forma automática para utilizar esta característica.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-121">If the following requirements are met, new merge publications are, by default, created with precomputed partitions enabled, and existing publications are automatically upgraded to use the feature.</span></span> <span data-ttu-id="e6ac0-122">Si una publicación no reúne los requisitos se puede cambiar y, a continuación, habilitar las particiones precalculadas.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-122">If a publication does not meet the requirements, it can be changed, and then precomputed partitions can be enabled.</span></span> <span data-ttu-id="e6ac0-123">Si algunos artículos satisfacen estos requisitos y otros no, considere la posibilidad de crear dos publicaciones, una de ellas habilitada para particiones precalculadas.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-123">If some articles meet these requirements and some do not, consider creating two publications, with one enabled for precomputed partitions.</span></span>  
  
### <a name="requirements-for-filter-clauses"></a><span data-ttu-id="e6ac0-124">Requisitos para cláusulas de filtro</span><span class="sxs-lookup"><span data-stu-id="e6ac0-124">Requirements for Filter Clauses</span></span>  
  
-   <span data-ttu-id="e6ac0-125">Cualquier función utilizada en los filtros de fila con parámetros, como HOST_NAME() y SUSER_SNAME(), debe aparecer directamente en la cláusula de filtro con parámetros en lugar de anidarse dentro de una vista o función dinámica.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-125">Any functions used in parameterized row filters, such as HOST_NAME() and SUSER_SNAME(), should appear directly in the parameterized filter clause and not be nested inside of a view or dynamic function.</span></span> <span data-ttu-id="e6ac0-126">Para obtener más información sobre estas funciones, consulte [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql), [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) y [Filtros de fila con parámetros](parameterized-filters-parameterized-row-filters.md).</span><span class="sxs-lookup"><span data-stu-id="e6ac0-126">For more information about these functions, see [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql), [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), and [Parameterized Row Filters](parameterized-filters-parameterized-row-filters.md).</span></span>  
  
-   <span data-ttu-id="e6ac0-127">Los valores devueltos para cada suscriptor no deben cambiarse una vez creada la partición.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-127">The values returned for each Subscriber should not change after the partition is created.</span></span> <span data-ttu-id="e6ac0-128">Por ejemplo, si utiliza HOST_NAME() en un filtro, y no reemplaza el valor de HOST_NAME(), no cambie el nombre del equipo en el suscriptor.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-128">For example, if you use HOST_NAME() in a filter (and do not override the HOST_NAME() value) do not change the computer name at the Subscriber.</span></span>  
  
-   <span data-ttu-id="e6ac0-129">Los filtros de combinación no deben contener funciones dinámicas (funciones como HOST_NAME() y SUSER_SNAME() que evalúan a un valor diferente dependiendo del suscriptor que se está sincronizando).</span><span class="sxs-lookup"><span data-stu-id="e6ac0-129">Join filters should not contain dynamic functions (functions such as HOST_NAME() and SUSER_SNAME() that evaluate to a different value depending upon the Subscriber that is synchronizing).</span></span> <span data-ttu-id="e6ac0-130">Solo los filtros de fila con parámetros deben contener funciones dinámicas.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-130">Only parameterized row filters should contain dynamic functions.</span></span>  
  
-   <span data-ttu-id="e6ac0-131">No se pueden usar funciones no deterministas en una cláusula de filtro.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-131">Nondeterministic functions cannot be used in a filter clause.</span></span> <span data-ttu-id="e6ac0-132">Para obtener más información acerca de las funciones no deterministas, vea [Deterministic and Nondeterministic Functions](../../user-defined-functions/deterministic-and-nondeterministic-functions.md).</span><span class="sxs-lookup"><span data-stu-id="e6ac0-132">For more information about nondeterministic functions, see [Deterministic and Nondeterministic Functions](../../user-defined-functions/deterministic-and-nondeterministic-functions.md).</span></span>  
  
-   <span data-ttu-id="e6ac0-133">Las vistas a las que se hace referencia en las cláusulas de filtro de combinación o cláusulas de filtro con parámetros no deben contener funciones dinámicas.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-133">Views referenced in join filter clauses or parameterized filter clauses should not contain dynamic functions.</span></span>  
  
-   <span data-ttu-id="e6ac0-134">No deben existir relaciones de filtro de combinación circulares en la publicación.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-134">There should be no circular join filter relationships in the publication.</span></span>  
  
### <a name="database-collation"></a><span data-ttu-id="e6ac0-135">Intercalación de base de datos</span><span class="sxs-lookup"><span data-stu-id="e6ac0-135">Database Collation</span></span>  
  
-   <span data-ttu-id="e6ac0-136">Cuando se utilizan las particiones precalculadas, siempre se utiliza la intercalación de la base de datos al realizar comparaciones, en lugar de la intercalación de la tabla o columna.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-136">When precomputed partitions are used, the collation of the database is always used when making comparisons, rather than the collation of the table or column.</span></span> <span data-ttu-id="e6ac0-137">Considere el caso siguiente:</span><span class="sxs-lookup"><span data-stu-id="e6ac0-137">Consider the following scenario:</span></span>  
  
    -   <span data-ttu-id="e6ac0-138">Una base de datos con una intercalación que distingue entre mayúsculas y minúsculas contiene una tabla con una intercalación que no distingue entre mayúsculas y minúsculas.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-138">A database with a case-sensitive collation contains a table with a case-insensitive collation.</span></span>  
  
    -   <span data-ttu-id="e6ac0-139">La tabla contiene una columna **ComputerName**que se compara con el nombre de host del suscriptor en un filtro con parámetros.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-139">The table contains a column **ComputerName**, which is compared against the host name of the Subscriber in a parameterized filter.</span></span>  
  
    -   <span data-ttu-id="e6ac0-140">La tabla contiene una fila con el valor "MYCOMPUTER" y otra fila con el valor "mycomputer" en esta columna.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-140">The table contains one row with the value "MYCOMPUTER" and one row with the value "mycomputer" in this column.</span></span>  
  
     <span data-ttu-id="e6ac0-141">Si el suscriptor se sincroniza con un nombre de host de "mycomputer", el suscriptor recibe solamente una fila porque la comparación distingue entre mayúsculas y minúsculas (la intercalación de la base de datos).</span><span class="sxs-lookup"><span data-stu-id="e6ac0-141">If the Subscriber synchronizes with a host name of "mycomputer", the Subscriber receives only one row because the comparison is case-sensitive (the collation of the database).</span></span> <span data-ttu-id="e6ac0-142">Si no se utilizan particiones precalculadas, el suscriptor recibe ambas filas porque la tabla tiene una intercalación que no distingue entre mayúsculas y minúsculas.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-142">If precomputed partitions are not used, the Subscriber receives both rows, because the table has a case-insensitive collation.</span></span>  
  
## <a name="performance-of-precomputed-partitions"></a><span data-ttu-id="e6ac0-143">Rendimiento de las particiones precalculadas</span><span class="sxs-lookup"><span data-stu-id="e6ac0-143">Performance of Precomputed Partitions</span></span>  
 <span data-ttu-id="e6ac0-144">Existe un pequeño costo de rendimiento con las particiones precalculadas cuando se cargan cambios desde el suscriptor al publicador, pero la mayor parte del tiempo de procesamiento de mezcla se dedica a evaluar las particiones y descargar los cambios del publicador al suscriptor, por lo que la ganancia neta puede ser importante.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-144">There is a small performance cost with precomputed partitions when changes are uploaded from the Subscriber to the Publisher, but the bulk of merge processing time is spent evaluating partitions and downloading changes from the Publisher to the Subscriber, so the net gain can still be significant.</span></span> <span data-ttu-id="e6ac0-145">La ventaja en cuanto al rendimiento variará dependiendo del número de suscriptores que se sincronicen de forma simultánea y del número de actualizaciones por sincronización que desplacen filas de una partición a otra.</span><span class="sxs-lookup"><span data-stu-id="e6ac0-145">The performance benefit will vary, depending on the number of Subscribers synchronizing concurrently and the number of updates per synchronization that move rows from one partition to another.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e6ac0-146">Consulte también</span><span class="sxs-lookup"><span data-stu-id="e6ac0-146">See Also</span></span>  
 [<span data-ttu-id="e6ac0-147">Filtros de fila con parámetros</span><span class="sxs-lookup"><span data-stu-id="e6ac0-147">Parameterized Row Filters</span></span>](parameterized-filters-parameterized-row-filters.md)  
  
  
