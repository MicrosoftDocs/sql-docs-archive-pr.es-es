---
title: Procedimientos recomendados para filtros de fila basados en el tiempo | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- best practices
ms.assetid: 773c5c62-fd44-44ab-9c6b-4257dbf8ffdb
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: ccaafe71d4137fd4b31eec412c1e35595861bdd0
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87661968"
---
# <a name="best-practices-for-time-based-row-filters"></a><span data-ttu-id="b2b20-102">Prácticas recomendadas para filtros de fila basados en el tiempo</span><span class="sxs-lookup"><span data-stu-id="b2b20-102">Best Practices for Time-Based Row Filters</span></span>
  <span data-ttu-id="b2b20-103">Los usuarios de aplicaciones requieren con frecuencia un subconjunto de datos de una tabla basado en el tiempo.</span><span class="sxs-lookup"><span data-stu-id="b2b20-103">Users of applications often require a time-based subset of data from a table.</span></span> <span data-ttu-id="b2b20-104">Por ejemplo, un vendedor puede requerir datos para pedidos de la semana pasada o un programador de eventos puede requerir datos para eventos de la semana próxima.</span><span class="sxs-lookup"><span data-stu-id="b2b20-104">For instance, a salesperson might require data for orders in the last week, or an event planner might require data for events in the upcoming week.</span></span> <span data-ttu-id="b2b20-105">En muchos casos, las aplicaciones usan consultas que contienen la función `GETDATE()` para llevar esto a cabo.</span><span class="sxs-lookup"><span data-stu-id="b2b20-105">In many cases, applications use queries containing the `GETDATE()` function to accomplish this.</span></span> <span data-ttu-id="b2b20-106">Considere la siguiente instrucción de filtro de fila:</span><span class="sxs-lookup"><span data-stu-id="b2b20-106">Consider the following row filter statement:</span></span>  
  
```  
WHERE SalesPersonID = CONVERT(INT,HOST_NAME()) AND OrderDate >= (GETDATE()-6)  
```  
  
 <span data-ttu-id="b2b20-107">Con un filtro de este tipo, se suele asumir que siempre ocurren dos cosas cuando se ejecuta el agente de mezcla: las filas que cumplen este filtro se replican en los suscriptores y las filas que no lo cumplen se borran en los suscriptores.</span><span class="sxs-lookup"><span data-stu-id="b2b20-107">With a filter of this type, it is usually assumed that two things always occur when the Merge Agent runs: rows that satisfy this filter are replicated to Subscribers; and rows that no longer satisfy this filter are cleaned up at Subscribers.</span></span> <span data-ttu-id="b2b20-108">(Para obtener más información sobre cómo filtrar con `HOST_NAME()` , vea [filtros de fila con parámetros](parameterized-filters-parameterized-row-filters.md)). Sin embargo, la replicación de mezcla solo replica y limpia los datos que han cambiado desde la última sincronización, independientemente de cómo defina un filtro de fila para esos datos.</span><span class="sxs-lookup"><span data-stu-id="b2b20-108">(For more information about filtering with `HOST_NAME()`, see [Parameterized Row Filters](parameterized-filters-parameterized-row-filters.md).) However, merge replication only replicates and cleans up data that has changed since the last synchronization, regardless of how you define a row filter for that data.</span></span>  
  
 <span data-ttu-id="b2b20-109">Para que la replicación de mezcla procese una fila, los datos de la fila deben cumplir el filtro de fila y haber cambiado desde la última sincronización.</span><span class="sxs-lookup"><span data-stu-id="b2b20-109">For merge replication to process a row, the data in the row must satisfy the row filter, and it must have changed since the last synchronization.</span></span> <span data-ttu-id="b2b20-110">En el caso de la tabla **SalesOrderHeader** , se incluye **OrderDate** cuando se inserta una fila.</span><span class="sxs-lookup"><span data-stu-id="b2b20-110">In the case of the **SalesOrderHeader** table, **OrderDate** is entered when a row is inserted.</span></span> <span data-ttu-id="b2b20-111">Las filas se replican en el suscriptor como se espera porque la inserción es un cambio en los datos.</span><span class="sxs-lookup"><span data-stu-id="b2b20-111">Rows are replicated to the Subscriber as expected because the insert is a data change.</span></span> <span data-ttu-id="b2b20-112">Sin embargo, si hay filas en el suscriptor que ya no cumplen el filtro (son para pedidos con más de siete días de antigüedad), no se quitan del suscriptor a menos que se actualicen por alguna otra razón.</span><span class="sxs-lookup"><span data-stu-id="b2b20-112">However, if there are rows at the Subscriber that no longer satisfy the filter (they are for orders older than seven days), they are not removed from the Subscriber unless they were updated for some other reason.</span></span>  
  
 <span data-ttu-id="b2b20-113">El caso del programador de eventos muestra mejor aún el problema con este tipo de filtro.</span><span class="sxs-lookup"><span data-stu-id="b2b20-113">The case of the event planner further highlights the issue with this type of filtering.</span></span> <span data-ttu-id="b2b20-114">Considere el siguiente filtro para una tabla **Events** :</span><span class="sxs-lookup"><span data-stu-id="b2b20-114">Consider the following filter for an **Events** table:</span></span>  
  
```  
WHERE EventCoordID = CONVERT(INT,HOST_NAME()) AND EventDate <= (GETDATE()+6)  
```  
  
 <span data-ttu-id="b2b20-115">Para una tabla que contiene eventos, se pueden realizar inserciones mucho antes de la fecha del evento.</span><span class="sxs-lookup"><span data-stu-id="b2b20-115">For a table that contains events, inserts might be made well ahead of the event date.</span></span> <span data-ttu-id="b2b20-116">Si la inserción de un evento de la semana próxima se realizó hace un mes y la fila no se actualizó por alguna razón, no se replica la fila en el suscriptor aunque cumpla el filtro de fila.</span><span class="sxs-lookup"><span data-stu-id="b2b20-116">If the insert for an event in the coming week was made a month ago and the row was not updated for another reason, the row is not replicated to the Subscriber even if it satisfies the row filter.</span></span>  
  
 <span data-ttu-id="b2b20-117">Además, según cómo esté configurada la publicación, la replicación de mezcla evalúa los filtros en momentos diferentes:</span><span class="sxs-lookup"><span data-stu-id="b2b20-117">In addition, depending on how the publication is configured, merge replication evaluates filters at different times:</span></span>  
  
-   <span data-ttu-id="b2b20-118">Si una publicación utiliza particiones precalculadas (opción predeterminada), los filtros se evalúan cuando se inserta o actualiza una fila.</span><span class="sxs-lookup"><span data-stu-id="b2b20-118">If a publication uses precomputed partitions (the default), filters are evaluated when a row is inserted or updated.</span></span>  
  
-   <span data-ttu-id="b2b20-119">Si la publicación no utiliza particiones precalculadas, los filtros se evalúan cuando se ejecuta el agente de mezcla.</span><span class="sxs-lookup"><span data-stu-id="b2b20-119">If the publication does not use precomputed partitions, filters are evaluated when the Merge Agent runs.</span></span>  
  
 <span data-ttu-id="b2b20-120">Para obtener más información sobre particiones precalculadas, vea [Optimize Parameterized Filter Performance with Precomputed Partitions](parameterized-filters-optimize-for-precomputed-partitions.md) (Optimización del rendimiento de los filtros con parámetros con particiones calculadas previamente).</span><span class="sxs-lookup"><span data-stu-id="b2b20-120">For more information about precomputed partitions, see [Optimize Parameterized Filter Performance with Precomputed Partitions](parameterized-filters-optimize-for-precomputed-partitions.md).</span></span> <span data-ttu-id="b2b20-121">El momento en que se evalúa el filtro afecta a los datos que cumplen el filtro.</span><span class="sxs-lookup"><span data-stu-id="b2b20-121">The time at which the filter is evaluated affects what data satisfies the filter.</span></span> <span data-ttu-id="b2b20-122">Por ejemplo, si una publicación utiliza particiones precalculadas y sincroniza datos cada dos días, el subconjunto de datos del vendedor podría incluir filas hasta dos días más antiguas de lo esperado.</span><span class="sxs-lookup"><span data-stu-id="b2b20-122">For example, if a publication uses precomputed partitions, and you synchronize data every two days, the subset of data for the salesperson could include rows up to two days older than expected.</span></span>  
  
## <a name="recommendations-for-using-time-based-row-filters"></a><span data-ttu-id="b2b20-123">Recomendaciones para usar filtros de fila basados en el tiempo</span><span class="sxs-lookup"><span data-stu-id="b2b20-123">Recommendations for Using Time-Based Row Filters</span></span>  
 <span data-ttu-id="b2b20-124">El método siguiente proporciona una buena solución para filtrar en función del tiempo:</span><span class="sxs-lookup"><span data-stu-id="b2b20-124">The following method provides a robust and straightforward approach to filtering based on time:</span></span>  
  
-   <span data-ttu-id="b2b20-125">Agregue una columna a la tabla con el tipo de datos `bit`.</span><span class="sxs-lookup"><span data-stu-id="b2b20-125">Add a column to the table of data type `bit`.</span></span> <span data-ttu-id="b2b20-126">Esta columna se usa para indicar si se debe replicar una fila.</span><span class="sxs-lookup"><span data-stu-id="b2b20-126">This column is used to indicate whether a row should be replicated.</span></span>  
  
-   <span data-ttu-id="b2b20-127">Utilice un filtro de fila que haga referencia a la nueva columna en lugar de una columna basada en el tiempo.</span><span class="sxs-lookup"><span data-stu-id="b2b20-127">Use a row filter that references the new column rather than a time-based column.</span></span>  
  
-   <span data-ttu-id="b2b20-128">Cree un trabajo del Agente SQL Server (o un trabajo programado con otro mecanismo) que actualice la columna antes de que se ejecute el agente de mezcla según esté programado.</span><span class="sxs-lookup"><span data-stu-id="b2b20-128">Create a SQL Server Agent job (or a job scheduled through another mechanism) that updates the column before the Merge Agent is scheduled to run.</span></span>  
  
 <span data-ttu-id="b2b20-129">Este enfoque soluciona los inconvenientes del uso de `GETDATE()` u otro método basado en el tiempo, y evita el problema de tener que determinar cuándo se evalúan los filtros para las particiones.</span><span class="sxs-lookup"><span data-stu-id="b2b20-129">This approach addresses the shortcomings of using `GETDATE()` or another time-based method and avoids the problem of having to determine when filters are evaluated for partitions.</span></span> <span data-ttu-id="b2b20-130">Considere el siguiente ejemplo de una tabla **Events** :</span><span class="sxs-lookup"><span data-stu-id="b2b20-130">Consider the following example of an **Events** table:</span></span>  
  
|<span data-ttu-id="b2b20-131">**EventID**</span><span class="sxs-lookup"><span data-stu-id="b2b20-131">**EventID**</span></span>|<span data-ttu-id="b2b20-132">**EventName**</span><span class="sxs-lookup"><span data-stu-id="b2b20-132">**EventName**</span></span>|<span data-ttu-id="b2b20-133">**EventCoordID**</span><span class="sxs-lookup"><span data-stu-id="b2b20-133">**EventCoordID**</span></span>|<span data-ttu-id="b2b20-134">**EventDate**</span><span class="sxs-lookup"><span data-stu-id="b2b20-134">**EventDate**</span></span>|<span data-ttu-id="b2b20-135">**Replicar**</span><span class="sxs-lookup"><span data-stu-id="b2b20-135">**Replicate**</span></span>|  
|-----------------|-------------------|----------------------|-------------------|-------------------|  
|<span data-ttu-id="b2b20-136">1</span><span class="sxs-lookup"><span data-stu-id="b2b20-136">1</span></span>|<span data-ttu-id="b2b20-137">Reception</span><span class="sxs-lookup"><span data-stu-id="b2b20-137">Reception</span></span>|<span data-ttu-id="b2b20-138">112</span><span class="sxs-lookup"><span data-stu-id="b2b20-138">112</span></span>|<span data-ttu-id="b2b20-139">2006-10-04</span><span class="sxs-lookup"><span data-stu-id="b2b20-139">2006-10-04</span></span>|<span data-ttu-id="b2b20-140">1</span><span class="sxs-lookup"><span data-stu-id="b2b20-140">1</span></span>|  
|<span data-ttu-id="b2b20-141">2</span><span class="sxs-lookup"><span data-stu-id="b2b20-141">2</span></span>|<span data-ttu-id="b2b20-142">Cena</span><span class="sxs-lookup"><span data-stu-id="b2b20-142">Dinner</span></span>|<span data-ttu-id="b2b20-143">112</span><span class="sxs-lookup"><span data-stu-id="b2b20-143">112</span></span>|<span data-ttu-id="b2b20-144">2006-10-10</span><span class="sxs-lookup"><span data-stu-id="b2b20-144">2006-10-10</span></span>|<span data-ttu-id="b2b20-145">0</span><span class="sxs-lookup"><span data-stu-id="b2b20-145">0</span></span>|  
|<span data-ttu-id="b2b20-146">3</span><span class="sxs-lookup"><span data-stu-id="b2b20-146">3</span></span>|<span data-ttu-id="b2b20-147">Party</span><span class="sxs-lookup"><span data-stu-id="b2b20-147">Party</span></span>|<span data-ttu-id="b2b20-148">112</span><span class="sxs-lookup"><span data-stu-id="b2b20-148">112</span></span>|<span data-ttu-id="b2b20-149">2006-10-11</span><span class="sxs-lookup"><span data-stu-id="b2b20-149">2006-10-11</span></span>|<span data-ttu-id="b2b20-150">0</span><span class="sxs-lookup"><span data-stu-id="b2b20-150">0</span></span>|  
|<span data-ttu-id="b2b20-151">4</span><span class="sxs-lookup"><span data-stu-id="b2b20-151">4</span></span>|<span data-ttu-id="b2b20-152">Wedding</span><span class="sxs-lookup"><span data-stu-id="b2b20-152">Wedding</span></span>|<span data-ttu-id="b2b20-153">112</span><span class="sxs-lookup"><span data-stu-id="b2b20-153">112</span></span>|<span data-ttu-id="b2b20-154">2006-10-12</span><span class="sxs-lookup"><span data-stu-id="b2b20-154">2006-10-12</span></span>|<span data-ttu-id="b2b20-155">0</span><span class="sxs-lookup"><span data-stu-id="b2b20-155">0</span></span>|  
  
 <span data-ttu-id="b2b20-156">El filtro de fila para esta tabla tendría este aspecto:</span><span class="sxs-lookup"><span data-stu-id="b2b20-156">The row filter for this table would then look like this:</span></span>  
  
```  
WHERE EventCoordID = CONVERT(INT,HOST_NAME()) AND Replicate = 1  
```  
  
 <span data-ttu-id="b2b20-157">El trabajo del Agente SQL Server podría ejecutar instrucciones [!INCLUDE[tsql](../../../includes/tsql-md.md)] similares a las siguientes antes de que se ejecute cada agente de mezcla:</span><span class="sxs-lookup"><span data-stu-id="b2b20-157">The SQL Server Agent job could execute [!INCLUDE[tsql](../../../includes/tsql-md.md)] statements similar to the following before each Merge Agent run:</span></span>  
  
```  
UPDATE Events SET Replicate = 0 WHERE Replicate = 1  
GO  
UPDATE Events SET Replicate = 1 WHERE EventDate <= GETDATE()+6  
GO  
```  
  
 <span data-ttu-id="b2b20-158">La primera línea restablece la columna **Replicate** en **0**y la segunda línea establece la columna en **1** para los eventos que tienen lugar en los siete días siguientes.</span><span class="sxs-lookup"><span data-stu-id="b2b20-158">The first line resets the **Replicate** column to **0**, and the second line sets the column to **1** for events that occur in the next seven days.</span></span> <span data-ttu-id="b2b20-159">Si esta instrucción [!INCLUDE[tsql](../../../includes/tsql-md.md)] se ejecuta el 7 de octubre de 2006, la tabla se actualiza a:</span><span class="sxs-lookup"><span data-stu-id="b2b20-159">If this [!INCLUDE[tsql](../../../includes/tsql-md.md)] statement runs on 10/07/2006, the table is updated to:</span></span>  
  
|<span data-ttu-id="b2b20-160">**EventID**</span><span class="sxs-lookup"><span data-stu-id="b2b20-160">**EventID**</span></span>|<span data-ttu-id="b2b20-161">**EventName**</span><span class="sxs-lookup"><span data-stu-id="b2b20-161">**EventName**</span></span>|<span data-ttu-id="b2b20-162">**EventCoordID**</span><span class="sxs-lookup"><span data-stu-id="b2b20-162">**EventCoordID**</span></span>|<span data-ttu-id="b2b20-163">**EventDate**</span><span class="sxs-lookup"><span data-stu-id="b2b20-163">**EventDate**</span></span>|<span data-ttu-id="b2b20-164">**Replicar**</span><span class="sxs-lookup"><span data-stu-id="b2b20-164">**Replicate**</span></span>|  
|-----------------|-------------------|----------------------|-------------------|-------------------|  
|<span data-ttu-id="b2b20-165">1</span><span class="sxs-lookup"><span data-stu-id="b2b20-165">1</span></span>|<span data-ttu-id="b2b20-166">Reception</span><span class="sxs-lookup"><span data-stu-id="b2b20-166">Reception</span></span>|<span data-ttu-id="b2b20-167">112</span><span class="sxs-lookup"><span data-stu-id="b2b20-167">112</span></span>|<span data-ttu-id="b2b20-168">2006-10-04</span><span class="sxs-lookup"><span data-stu-id="b2b20-168">2006-10-04</span></span>|<span data-ttu-id="b2b20-169">0</span><span class="sxs-lookup"><span data-stu-id="b2b20-169">0</span></span>|  
|<span data-ttu-id="b2b20-170">2</span><span class="sxs-lookup"><span data-stu-id="b2b20-170">2</span></span>|<span data-ttu-id="b2b20-171">Cena</span><span class="sxs-lookup"><span data-stu-id="b2b20-171">Dinner</span></span>|<span data-ttu-id="b2b20-172">112</span><span class="sxs-lookup"><span data-stu-id="b2b20-172">112</span></span>|<span data-ttu-id="b2b20-173">2006-10-10</span><span class="sxs-lookup"><span data-stu-id="b2b20-173">2006-10-10</span></span>|<span data-ttu-id="b2b20-174">1</span><span class="sxs-lookup"><span data-stu-id="b2b20-174">1</span></span>|  
|<span data-ttu-id="b2b20-175">3</span><span class="sxs-lookup"><span data-stu-id="b2b20-175">3</span></span>|<span data-ttu-id="b2b20-176">Party</span><span class="sxs-lookup"><span data-stu-id="b2b20-176">Party</span></span>|<span data-ttu-id="b2b20-177">112</span><span class="sxs-lookup"><span data-stu-id="b2b20-177">112</span></span>|<span data-ttu-id="b2b20-178">2006-10-11</span><span class="sxs-lookup"><span data-stu-id="b2b20-178">2006-10-11</span></span>|<span data-ttu-id="b2b20-179">1</span><span class="sxs-lookup"><span data-stu-id="b2b20-179">1</span></span>|  
|<span data-ttu-id="b2b20-180">4</span><span class="sxs-lookup"><span data-stu-id="b2b20-180">4</span></span>|<span data-ttu-id="b2b20-181">Wedding</span><span class="sxs-lookup"><span data-stu-id="b2b20-181">Wedding</span></span>|<span data-ttu-id="b2b20-182">112</span><span class="sxs-lookup"><span data-stu-id="b2b20-182">112</span></span>|<span data-ttu-id="b2b20-183">2006-10-12</span><span class="sxs-lookup"><span data-stu-id="b2b20-183">2006-10-12</span></span>|<span data-ttu-id="b2b20-184">1</span><span class="sxs-lookup"><span data-stu-id="b2b20-184">1</span></span>|  
  
 <span data-ttu-id="b2b20-185">Los eventos para la semana siguiente se marcan ahora como listos para replicación.</span><span class="sxs-lookup"><span data-stu-id="b2b20-185">The events for the next week are now flagged as being ready to replicate.</span></span> <span data-ttu-id="b2b20-186">La próxima vez que se ejecute el agente de mezcla para la suscripción que utiliza el coordinador de eventos 112, se descargarán las filas 2, 3 y 4 en el suscriptor y se quitará la fila 1 del suscriptor.</span><span class="sxs-lookup"><span data-stu-id="b2b20-186">The next time the Merge Agent runs for the subscription that event coordinator 112 uses, rows 2, 3, and 4 will be downloaded to the Subscriber and row 1 will be removed from the Subscriber.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b2b20-187">Consulte también</span><span class="sxs-lookup"><span data-stu-id="b2b20-187">See Also</span></span>  
 <span data-ttu-id="b2b20-188">[GETDATE &#40;Transact-SQL&#41;](/sql/t-sql/functions/getdate-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="b2b20-188">[GETDATE &#40;Transact-SQL&#41;](/sql/t-sql/functions/getdate-transact-sql) </span></span>  
 <span data-ttu-id="b2b20-189">[Implementar trabajos](../../../ssms/agent/implement-jobs.md) </span><span class="sxs-lookup"><span data-stu-id="b2b20-189">[Implement Jobs](../../../ssms/agent/implement-jobs.md) </span></span>  
 [<span data-ttu-id="b2b20-190">Filtros de fila con parámetros</span><span class="sxs-lookup"><span data-stu-id="b2b20-190">Parameterized Row Filters</span></span>](parameterized-filters-parameterized-row-filters.md)  
  
  
