---
title: Replicación de instantáneas | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- snapshot replication [SQL Server], about snapshot replication
- snapshot replication [SQL Server]
ms.assetid: 5d745f22-9c6b-4e11-8c62-bc50e9a8bf38
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 6192c196e31c4c5772099074c79b3c6c4ca7aeed
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87752122"
---
# <a name="snapshot-replication"></a><span data-ttu-id="4a356-102">Replicación de instantáneas</span><span class="sxs-lookup"><span data-stu-id="4a356-102">Snapshot Replication</span></span>
  <span data-ttu-id="4a356-103">La replicación de instantáneas distribuye los datos exactamente como aparecen en un momento específico en el tiempo y no supervisa las actualizaciones de los datos.</span><span class="sxs-lookup"><span data-stu-id="4a356-103">Snapshot replication distributes data exactly as it appears at a specific moment in time and does not monitor for updates to the data.</span></span> <span data-ttu-id="4a356-104">Cuando se produce la sincronización, se genera la instantánea completa y se envía a los suscriptores.</span><span class="sxs-lookup"><span data-stu-id="4a356-104">When synchronization occurs, the entire snapshot is generated and sent to Subscribers.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="4a356-105">La replicación de instantáneas se puede utilizar por sí sola, pero el proceso de instantáneas (que crea una copia de todos los objetos y datos especificados por una publicación) se utiliza habitualmente para proporcionar el conjunto inicial de datos y objetos de base de datos para las publicaciones transaccionales y de combinación.</span><span class="sxs-lookup"><span data-stu-id="4a356-105">Snapshot replication can be used by itself, but the snapshot process (which creates a copy of all of the objects and data specified by a publication) is also commonly used to provide the initial set of data and database objects for transactional and merge publications.</span></span>  
  
 <span data-ttu-id="4a356-106">El uso independiente de la replicación de instantáneas es más apropiado cuando se cumple una o más de las siguientes condiciones:</span><span class="sxs-lookup"><span data-stu-id="4a356-106">Using snapshot replication by itself is most appropriate when one or more of the following is true:</span></span>  
  
-   <span data-ttu-id="4a356-107">Los datos no cambian con frecuencia.</span><span class="sxs-lookup"><span data-stu-id="4a356-107">Data changes infrequently.</span></span>  
  
-   <span data-ttu-id="4a356-108">Es aceptable disponer de copias de datos desfasados respecto al publicador durante un período de tiempo.</span><span class="sxs-lookup"><span data-stu-id="4a356-108">It is acceptable to have copies of data that are out of date with respect to the Publisher for a period of time.</span></span>  
  
-   <span data-ttu-id="4a356-109">se duplican pequeñas cantidades de datos.</span><span class="sxs-lookup"><span data-stu-id="4a356-109">Replicating small volumes of data.</span></span>  
  
-   <span data-ttu-id="4a356-110">Hay un gran volumen de cambios en un corto período de tiempo.</span><span class="sxs-lookup"><span data-stu-id="4a356-110">A large volume of changes occurs over a short period of time.</span></span>  
  
 <span data-ttu-id="4a356-111">La replicación de instantáneas es más apropiada cuando los cambios de datos son importantes, pero poco frecuentes.</span><span class="sxs-lookup"><span data-stu-id="4a356-111">Snapshot replication is most appropriate when data changes are substantial but infrequent.</span></span> <span data-ttu-id="4a356-112">Por ejemplo, si una organización de ventas mantiene una lista de precios de productos y todos los precios se actualizan al mismo tiempo una o dos veces al año, es recomendable replicar la instantánea completa de los datos una vez que han cambiado.</span><span class="sxs-lookup"><span data-stu-id="4a356-112">For example, if a sales organization maintains a product price list and the prices are all updated at the same time once or twice each year, replicating the entire snapshot of data after it has changed is recommended.</span></span> <span data-ttu-id="4a356-113">Para determinados tipos de datos pueden ser adecuadas también instantáneas más frecuentes.</span><span class="sxs-lookup"><span data-stu-id="4a356-113">Given certain types of data, more frequent snapshots may also be appropriate.</span></span> <span data-ttu-id="4a356-114">Por ejemplo, si una tabla relativamente pequeña se actualiza en el publicador durante el día pero es aceptable cierta latencia, los cambios se pueden entregar por la noche como una instantánea.</span><span class="sxs-lookup"><span data-stu-id="4a356-114">For example, if a relatively small table is updated at the Publisher during the day, but some latency is acceptable, changes can be delivered nightly as a snapshot.</span></span>  
  
 <span data-ttu-id="4a356-115">La replicación de instantáneas tiene una carga continua más reducida en el publicador que la replicación transaccional, ya que no se realiza ningún seguimiento de los cambios incrementales.</span><span class="sxs-lookup"><span data-stu-id="4a356-115">Snapshot replication has a lower continuous overhead on the Publisher than transactional replication, because incremental changes are not tracked.</span></span> <span data-ttu-id="4a356-116">No obstante, si el conjunto de datos que se está replicando es muy grande, será necesaria una cantidad importante de recursos para generar y aplicar la instantánea.</span><span class="sxs-lookup"><span data-stu-id="4a356-116">However, if the dataset set being replicated is very large, it will require substantial resources to generate and apply the snapshot.</span></span> <span data-ttu-id="4a356-117">Tenga en cuenta el tamaño del conjunto de datos entero y la frecuencia de los cambios en los datos al evaluar si utiliza o no la replicación de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="4a356-117">Consider the size of the entire data set and the frequency of changes to the data when evaluating whether to utilize snapshot replication.</span></span>  
  
 <span data-ttu-id="4a356-118">**En este tema**</span><span class="sxs-lookup"><span data-stu-id="4a356-118">**In this topic**</span></span>  
  
 [<span data-ttu-id="4a356-119">Cómo funciona la replicación de instantáneas</span><span class="sxs-lookup"><span data-stu-id="4a356-119">How Snapshot Replication Works</span></span>](#HowWorks)  
  
 [<span data-ttu-id="4a356-120">Agente de instantáneas</span><span class="sxs-lookup"><span data-stu-id="4a356-120">Snapshot Agent</span></span>](#SnapshotAgent)  
  
 [<span data-ttu-id="4a356-121">Agente de distribución y Agente de mezcla</span><span class="sxs-lookup"><span data-stu-id="4a356-121">Distribution and Merge Agents</span></span>](#DistAgent)  
  
##  <a name="how-snapshot-replication-works"></a><a name="HowWorks"></a> <span data-ttu-id="4a356-122">Cómo funciona la replicación de instantáneas</span><span class="sxs-lookup"><span data-stu-id="4a356-122">How Snapshot Replication Works</span></span>  
 <span data-ttu-id="4a356-123">De forma predeterminada, los tres tipos de replicación utilizan una instantánea para inicializar suscriptores.</span><span class="sxs-lookup"><span data-stu-id="4a356-123">By default, all three types of replication use a snapshot to initialize Subscribers.</span></span> <span data-ttu-id="4a356-124">El Agente de instantáneas de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] siempre genera los archivos de instantáneas, pero el agente que entrega los archivos varía según el tipo de replicación que se utilice.</span><span class="sxs-lookup"><span data-stu-id="4a356-124">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Snapshot Agent always generates the snapshot files, but the agent that delivers the files differs depending on the type of replication being used.</span></span> <span data-ttu-id="4a356-125">La replicación de instantáneas y la replicación transaccional utilizan el Agente de distribución para entregar los archivos, mientras que la replicación de mezcla utiliza el Agente de mezcla de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="4a356-125">Snapshot replication and transactional replication use the Distribution Agent to deliver the files, whereas merge replication uses the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Merge Agent.</span></span> <span data-ttu-id="4a356-126">El Agente de instantáneas se ejecuta en el distribuidor.</span><span class="sxs-lookup"><span data-stu-id="4a356-126">The Snapshot Agent runs at the Distributor.</span></span> <span data-ttu-id="4a356-127">El Agente de distribución y el Agente de mezcla se ejecutan en el distribuidor para las suscripciones de inserción o en los suscriptores para las suscripciones de extracción.</span><span class="sxs-lookup"><span data-stu-id="4a356-127">The Distribution Agent and Merge Agent run at the Distributor for push subscriptions, or at Subscribers for pull subscriptions.</span></span>  
  
 <span data-ttu-id="4a356-128">Las instantáneas se pueden generar y aplicar inmediatamente tras la creación de la suscripción o de acuerdo con una programación establecida en el momento de crear la publicación.</span><span class="sxs-lookup"><span data-stu-id="4a356-128">Snapshots can be generated and applied either immediately after the subscription is created or according to a schedule set at the time the publication is created.</span></span> <span data-ttu-id="4a356-129">El Agente de instantáneas prepara archivos de instantáneas que contienen el esquema y los datos de las tablas y objetos de base de datos publicados, almacena los archivos en la carpeta de instantáneas del publicador y registra la información de seguimiento en la base de datos de distribución del distribuidor.</span><span class="sxs-lookup"><span data-stu-id="4a356-129">The Snapshot Agent prepares snapshot files containing the schema and data of published tables and database objects, stores the files in the snapshot folder for the Publisher, and records tracking information in the distribution database on the Distributor.</span></span> <span data-ttu-id="4a356-130">Al configurar un distribuidor se especifica la carpeta de instantáneas predeterminada, pero puede especificar una ubicación alternativa para una publicación en lugar de, o además de, la predeterminada.</span><span class="sxs-lookup"><span data-stu-id="4a356-130">You specify a default snapshot folder when you configure a Distributor, but you can specify an alternate location for a publication instead of or in addition to the default.</span></span>  
  
 <span data-ttu-id="4a356-131">Además del proceso de instantáneas estándar descrito en este tema, se utiliza un proceso de dos partes para las publicaciones de combinación con filtros con parámetros.</span><span class="sxs-lookup"><span data-stu-id="4a356-131">In addition to the standard snapshot process described in this topic, a two-part snapshot process is used for merge publications with parameterized filters.</span></span>  
  
 <span data-ttu-id="4a356-132">En la ilustración siguiente se muestran los componentes principales de la replicación de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="4a356-132">The following illustration shows the principal components of snapshot replication.</span></span>  
  
 <span data-ttu-id="4a356-133">![Componentes y flujo de datos de replicación de instantáneas](media/snapshot.gif "Componentes y flujo de datos de replicación de instantáneas")</span><span class="sxs-lookup"><span data-stu-id="4a356-133">![Snapshot replication components and data flow](media/snapshot.gif "Snapshot replication components and data flow")</span></span>  
  
##  <a name="snapshot-agent"></a><a name="SnapshotAgent"></a> <span data-ttu-id="4a356-134">Agente de instantáneas</span><span class="sxs-lookup"><span data-stu-id="4a356-134">Snapshot Agent</span></span>  
 <span data-ttu-id="4a356-135">Para la replicación de mezcla se genera una instantánea cada vez que se ejecuta el Agente de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="4a356-135">For merge replication, a snapshot is generated every time the Snapshot Agent runs.</span></span> <span data-ttu-id="4a356-136">Para la replicación transaccional, la generación de instantáneas depende de la configuración de la propiedad de publicación **immediate_sync**.</span><span class="sxs-lookup"><span data-stu-id="4a356-136">For transactional replication, snapshot generation depends on the setting of the publication property **immediate_sync**.</span></span> <span data-ttu-id="4a356-137">Si la propiedad se define como TRUE (la opción predeterminada cuando se utiliza el Asistente para nueva publicación), se genera una instantánea cada vez que se ejecuta el Agente de instantáneas, y puede aplicarse a un suscriptor en cualquier momento.</span><span class="sxs-lookup"><span data-stu-id="4a356-137">If the property is set to TRUE (the default when using the New Publication Wizard), a snapshot is generated every time the Snapshot Agent runs, and it can be applied to a Subscriber at any time.</span></span> <span data-ttu-id="4a356-138">Si la propiedad se define como FALSE (la opción predeterminada cuando se utiliza **sp_addpublication**), la instantánea se genera solo si se ha agregado una nueva suscripción desde la última ejecución del Agente de instantáneas; los suscriptores deberán esperar a que el Agente de instantáneas finalice para poder sincronizarse.</span><span class="sxs-lookup"><span data-stu-id="4a356-138">If the property is set to FALSE (the default when using **sp_addpublication**), the snapshot is generated only if a new subscription has been added since the last Snapshot Agent run; Subscribers must wait for the Snapshot Agent to complete before they can synchronize.</span></span>  
  
 <span data-ttu-id="4a356-139">El Agente de instantáneas ejecuta los pasos siguientes:</span><span class="sxs-lookup"><span data-stu-id="4a356-139">The Snapshot Agent performs the following steps:</span></span>  
  
1.  <span data-ttu-id="4a356-140">Establece una conexión del distribuidor al publicador y, a continuación, si fuera necesario, adopta bloqueos en las tablas publicadas:</span><span class="sxs-lookup"><span data-stu-id="4a356-140">Establishes a connection from the Distributor to the Publisher, and then takes locks on published tables if necessary:</span></span>  
  
    -   <span data-ttu-id="4a356-141">Para las publicaciones de combinación, el Agente de instantáneas no adopta ningún bloqueo.</span><span class="sxs-lookup"><span data-stu-id="4a356-141">For merge publications, the Snapshot Agent does not take any locks.</span></span>  
  
    -   <span data-ttu-id="4a356-142">Para las publicaciones transaccionales, el Agente de instantáneas adopta bloqueos de manera predeterminada únicamente durante la fase inicial de la generación de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="4a356-142">For transactional publications, by default the Snapshot Agent take locks only during the initial phase of snapshot generation.</span></span>  
  
    -   <span data-ttu-id="4a356-143">Para las publicaciones de instantáneas, adopta bloqueos durante todo el proceso de generación de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="4a356-143">For snapshot publications, locks are held during the entire snapshot generation process.</span></span>  
  
2.  <span data-ttu-id="4a356-144">Escribe una copia del esquema de la tabla para cada artículo en un archivo .sch.</span><span class="sxs-lookup"><span data-stu-id="4a356-144">Writes a copy of the table schema for each article to a .sch file.</span></span> <span data-ttu-id="4a356-145">Si se publican otros objetos de base de datos, como índices, restricciones, procedimientos almacenados, vistas, funciones definidas por el usuario, etc., se generan archivos de script adicionales.</span><span class="sxs-lookup"><span data-stu-id="4a356-145">If other database objects are published, such as indexes, constraints, stored procedures, views, user-defined functions, and so on, additional script files are generated.</span></span>  
  
3.  <span data-ttu-id="4a356-146">Copia los datos de la tabla publicada en el publicador y escribe los datos en la carpeta de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="4a356-146">Copies the data from the published table at the Publisher and writes the data to the snapshot folder.</span></span> <span data-ttu-id="4a356-147">La instantánea se genera como un conjunto de archivos de programa de copia masiva (BCP).</span><span class="sxs-lookup"><span data-stu-id="4a356-147">The snapshot is generated as a set of bulk copy program (BCP) files.</span></span>  
  
4.  <span data-ttu-id="4a356-148">En las publicaciones de instantáneas y transaccionales, el Agente de instantáneas anexa filas a las tablas **MSrepl_commands** y **MSrepl_transactions** de la base de datos de distribución.</span><span class="sxs-lookup"><span data-stu-id="4a356-148">For snapshot and transactional publications, the Snapshot Agent appends rows to the **MSrepl_commands** and **MSrepl_transactions** tables in the distribution database.</span></span> <span data-ttu-id="4a356-149">Las entradas de la tabla **MSrepl_commands** son comandos que indican la ubicación de los archivos .sch y .bcp, de cualquier otro archivo de instantáneas y de las referencias a cualquier script anterior o posterior a la instantánea.</span><span class="sxs-lookup"><span data-stu-id="4a356-149">The entries in the **MSrepl_commands** table are commands indicating the location of .sch and .bcp files, any other snapshot files, and references to any pre- or post-snapshot scripts.</span></span> <span data-ttu-id="4a356-150">Las entradas de la tabla **MSrepl_transactions** son comandos importantes para sincronizar el suscriptor.</span><span class="sxs-lookup"><span data-stu-id="4a356-150">The entries in the **MSrepl_transactions** table are commands relevant to synchronizing the Subscriber.</span></span>  
  
     <span data-ttu-id="4a356-151">En las publicaciones de combinación, el Agente de instantáneas realiza pasos adicionales.</span><span class="sxs-lookup"><span data-stu-id="4a356-151">For merge publications, the Snapshot Agent performs additional steps.</span></span>  
  
5.  <span data-ttu-id="4a356-152">Libera los bloqueos de las tablas publicadas.</span><span class="sxs-lookup"><span data-stu-id="4a356-152">Releases any locks on published tables.</span></span>  
  
 <span data-ttu-id="4a356-153">Durante la generación de instantáneas, no es posible realizar cambios en el esquema de las tablas publicadas.</span><span class="sxs-lookup"><span data-stu-id="4a356-153">During snapshot generation, you cannot make schema changes on published tables.</span></span> <span data-ttu-id="4a356-154">Después de generar los archivos de instantáneas, podrá verlos en la carpeta de instantáneas mediante el Explorador de Windows.</span><span class="sxs-lookup"><span data-stu-id="4a356-154">After the snapshot files are generated, you can view them in the snapshot folder using Windows Explorer.</span></span>  
  
##  <a name="distribution-agent-and-merge-agent"></a><a name="DistAgent"></a> <span data-ttu-id="4a356-155">Agente de distribución y Agente de mezcla</span><span class="sxs-lookup"><span data-stu-id="4a356-155">Distribution Agent and Merge Agent</span></span>  
 <span data-ttu-id="4a356-156">En las publicaciones de instantáneas, cada vez que el Agente de distribución se ejecuta para la publicación, mueve una nueva instantánea a cada suscriptor que aún no se ha sincronizado, se ha marcado para volver a inicializarse o incluye nuevos artículos.</span><span class="sxs-lookup"><span data-stu-id="4a356-156">For snapshot publications, each time the Distribution Agent runs for the publication, it moves a new snapshot to each Subscriber that has not yet been synchronized, has been marked for reinitialization, or includes new articles.</span></span>  
  
 <span data-ttu-id="4a356-157">En la replicación de instantáneas y transaccional, el Agente de distribución realiza los siguientes pasos:</span><span class="sxs-lookup"><span data-stu-id="4a356-157">For snapshot and transactional replication, the Distribution Agent performs the following steps:</span></span>  
  
1.  <span data-ttu-id="4a356-158">Establece una conexión con el distribuidor.</span><span class="sxs-lookup"><span data-stu-id="4a356-158">Establishes a connection to the Distributor.</span></span>  
  
2.  <span data-ttu-id="4a356-159">Examina las tablas **MSrepl_commands** y **MSrepl_transactions** de la base de datos de distribución del distribuidor.</span><span class="sxs-lookup"><span data-stu-id="4a356-159">Examines the **MSrepl_commands** and **MSrepl_transactions** tables in the distribution database on the Distributor.</span></span> <span data-ttu-id="4a356-160">El agente lee la ubicación de los archivos de instantáneas de la primera tabla y los comandos de sincronización del suscriptor de ambas tablas.</span><span class="sxs-lookup"><span data-stu-id="4a356-160">The agent reads the location of the snapshot files from the first table and Subscriber synchronization commands from both tables.</span></span>  
  
3.  <span data-ttu-id="4a356-161">Aplica el esquema y los comandos a la base de datos de suscripciones.</span><span class="sxs-lookup"><span data-stu-id="4a356-161">Applies the schema and commands to the subscription database.</span></span>  
  
 <span data-ttu-id="4a356-162">En una publicación de replicación de mezcla sin filtrar, el Agente de mezcla realiza los siguientes pasos:</span><span class="sxs-lookup"><span data-stu-id="4a356-162">For an unfiltered merge replication publication, the Merge Agent performs the following steps:</span></span>  
  
1.  <span data-ttu-id="4a356-163">Establece una conexión con el publicador.</span><span class="sxs-lookup"><span data-stu-id="4a356-163">Establishes a connection to the Publisher.</span></span>  
  
2.  <span data-ttu-id="4a356-164">Examina la tabla **sysmergeschemachange** del publicador y determina si existe una nueva instantánea que deba aplicarse a éste.</span><span class="sxs-lookup"><span data-stu-id="4a356-164">Examines the **sysmergeschemachange** table on the Publisher and determines whether there is a new snapshot that should be applied at the Subscriber.</span></span>  
  
3.  <span data-ttu-id="4a356-165">Si hay una nueva instantánea disponible, el Agente de mezcla aplica los archivos de instantáneas de la ubicación especificada en **sysmergeschemachange**a la base de datos de suscripciones.</span><span class="sxs-lookup"><span data-stu-id="4a356-165">If a new snapshot is available, the Merge Agent applies to the subscription database the snapshot files from the location specified in **sysmergeschemachange**.</span></span>  
  
  
