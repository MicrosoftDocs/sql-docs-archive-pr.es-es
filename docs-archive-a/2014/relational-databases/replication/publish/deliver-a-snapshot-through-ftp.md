---
title: Entrega de una instantánea mediante FTP | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- snapshots [SQL Server replication], FTP snapshots
- FTP snapshots [SQL Server replication]
- snapshot replication [SQL Server], FTP
ms.assetid: 99872c4f-40ce-4405-8fd4-44052d3bd827
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 2e6700e6989a5a7e32202a0710bc663978a136cf
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87669610"
---
# <a name="deliver-a-snapshot-through-ftp"></a><span data-ttu-id="43fec-102">Entregar una instantánea mediante FTP</span><span class="sxs-lookup"><span data-stu-id="43fec-102">Deliver a Snapshot Through FTP</span></span>
  <span data-ttu-id="43fec-103">En este tema se describe cómo entregar una instantánea a través de FTP en [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] mediante [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] o [!INCLUDE[tsql](../../../includes/tsql-md.md)].</span><span class="sxs-lookup"><span data-stu-id="43fec-103">This topic describes how to deliver a snapshot through FTP in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] or [!INCLUDE[tsql](../../../includes/tsql-md.md)].</span></span>  
  
##  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="43fec-104">Limitaciones y restricciones</span><span class="sxs-lookup"><span data-stu-id="43fec-104">Limitations and Restrictions</span></span>  
  
-   <span data-ttu-id="43fec-105">El Agente de instantáneas debe tener permisos de escritura para el directorio especificado y el Agente de distribución o de mezcla debe tener permisos de lectura.</span><span class="sxs-lookup"><span data-stu-id="43fec-105">The Snapshot Agent must have write permissions for the directory you specify, and the Distribution Agent or Merge Agent must have read permissions.</span></span> <span data-ttu-id="43fec-106">Si usa suscripciones de extracción, debe especificar un directorio compartido como una ruta de acceso UNC (Convención de nomenclatura universal), por ejemplo, \\\servidorFTP\inicio\instantáneas.</span><span class="sxs-lookup"><span data-stu-id="43fec-106">If pull subscriptions are used, you must specify a shared directory as a universal naming convention (UNC) path, such as \\\ftpserver\home\snapshots.</span></span> <span data-ttu-id="43fec-107">Para obtener más información, vea [Proteger la carpeta de instantáneas](../security/secure-the-snapshot-folder.md).</span><span class="sxs-lookup"><span data-stu-id="43fec-107">For more information, see [Secure the Snapshot Folder](../security/secure-the-snapshot-folder.md).</span></span>  
  
###  <a name="prerequisites"></a><a name="Prerequisites"></a> <span data-ttu-id="43fec-108">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="43fec-108">Prerequisites</span></span>  
  
-   <span data-ttu-id="43fec-109">Para transferir archivos de instantáneas con el Protocolo de transferencia de archivos (FTP), primero debe configurar un servidor de FTP.</span><span class="sxs-lookup"><span data-stu-id="43fec-109">To transfer snapshot files using File Transfer Protocol (FTP), you must first configure an FTP server.</span></span> <span data-ttu-id="43fec-110">Para obtener más información, vea la documentación de [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Internet Information Services (IIS).</span><span class="sxs-lookup"><span data-stu-id="43fec-110">For more information, see the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Internet Information Services (IIS) documentation.</span></span>  
  
###  <a name="security"></a><a name="Security"></a> <span data-ttu-id="43fec-111">Seguridad</span><span class="sxs-lookup"><span data-stu-id="43fec-111">Security</span></span>  
 <span data-ttu-id="43fec-112">Para contribuir a mejorar la seguridad, se recomienda implementar una red privada virtual (VPN) al utilizar la entrega de instantáneas a través de FTP por Internet.</span><span class="sxs-lookup"><span data-stu-id="43fec-112">To help improve security, we recommend that you implement a virtual private network (VPN) when using FTP snapshot delivery over the Internet.</span></span> <span data-ttu-id="43fec-113">Para más información, vea [Publicar datos a través de Internet mediante VPN](../publish-data-over-the-internet-using-vpn.md).</span><span class="sxs-lookup"><span data-stu-id="43fec-113">For more information, see [Publish Data over the Internet Using VPN](../publish-data-over-the-internet-using-vpn.md).</span></span>  
  
 <span data-ttu-id="43fec-114">Por seguridad, se recomienda no permitir el inicio de sesión anónimo en el servidor de FTP.</span><span class="sxs-lookup"><span data-stu-id="43fec-114">As a security best practice, do not allow anonymous logins to the FTP server.</span></span> <span data-ttu-id="43fec-115">El Agente de instantáneas debe tener permisos de escritura para el directorio especificado y el Agente de distribución o de mezcla debe tener permisos de lectura.</span><span class="sxs-lookup"><span data-stu-id="43fec-115">The Snapshot Agent must have write permissions for the directory you specify, and the Distribution Agent or Merge Agent must have read permissions.</span></span> <span data-ttu-id="43fec-116">Si usa suscripciones de extracción, debe especificar un directorio compartido como una ruta de acceso UNC (Convención de nomenclatura universal), por ejemplo, \\\servidorFTP\inicio\instantáneas.</span><span class="sxs-lookup"><span data-stu-id="43fec-116">If pull subscriptions are used, you must specify a shared directory as a universal naming convention (UNC) path, such as \\\ftpserver\home\snapshots.</span></span> <span data-ttu-id="43fec-117">Para obtener más información, vea [Proteger la carpeta de instantáneas](../security/secure-the-snapshot-folder.md).</span><span class="sxs-lookup"><span data-stu-id="43fec-117">For more information, see [Secure the Snapshot Folder](../security/secure-the-snapshot-folder.md).</span></span>  
  
 <span data-ttu-id="43fec-118">Cuando sea posible, pida a los usuarios que proporcionen sus credenciales en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="43fec-118">When possible, prompt users to enter their credentials at runtime.</span></span> <span data-ttu-id="43fec-119">Si almacena las credenciales en un archivo de script, debe proteger el archivo.</span><span class="sxs-lookup"><span data-stu-id="43fec-119">If you store credentials in a script file, you must secure the file.</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="43fec-120">Uso de SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="43fec-120">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="43fec-121">Después de configurar el servidor FTP, especifique la información de directorios y seguridad para este servidor en el cuadro de diálogo **Propiedades de la publicación \<Publication>** .</span><span class="sxs-lookup"><span data-stu-id="43fec-121">After the FTP server is configured, specify directory and security information for this server in the **Publication Properties \<Publication>** dialog box.</span></span> <span data-ttu-id="43fec-122">Para obtener más información sobre el acceso a este cuadro de diálogo, vea [View and Modify Publication Properties](view-and-modify-publication-properties.md).</span><span class="sxs-lookup"><span data-stu-id="43fec-122">For more information about accessing this dialog box, see [View and Modify Publication Properties](view-and-modify-publication-properties.md).</span></span>  
  
#### <a name="to-specify-ftp-information"></a><span data-ttu-id="43fec-123">Para especificar la información de FTP</span><span class="sxs-lookup"><span data-stu-id="43fec-123">To specify FTP information</span></span>  
  
1.  <span data-ttu-id="43fec-124">En el cuadro de diálogo **Propiedades de la publicación: \<Publication>** , seleccione **Permitir a los suscriptores descargar archivos de instantánea usando FTP** en una de las páginas siguientes:</span><span class="sxs-lookup"><span data-stu-id="43fec-124">In the **Publication Properties - \<Publication>** dialog box, select **Allow Subscribers to download snapshot files using FTP** from one of the following pages:</span></span>   
    -   <span data-ttu-id="43fec-125">La página **Instantánea de FTP**, para las publicaciones transaccionales y de instantáneas, y las publicaciones de combinación para los publicadores que ejecuten versiones anteriores a [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span><span class="sxs-lookup"><span data-stu-id="43fec-125">The **FTP Snapshot** page, for snapshot and transactional publications, and merge publications for Publishers running versions prior to [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span>    
    -   <span data-ttu-id="43fec-126">La página **Instantánea de FTP e Internet** , para las publicaciones de combinación de los publicadores que ejecuten [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] o posterior.</span><span class="sxs-lookup"><span data-stu-id="43fec-126">The **FTP Snapshot and Internet** page, for merge publications from Publishers running [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or later.</span></span>    
2.  <span data-ttu-id="43fec-127">Especifique valores para **Nombre del servidor FTP**, **Número de puerto**, **Ruta de acceso de la carpeta raíz del servidor FTP**, **Inicio de sesión**y **Contraseña**.</span><span class="sxs-lookup"><span data-stu-id="43fec-127">Specify values for **FTP server name**, **Port number**, **Path from the FTP root folder**, **Login**, and **Password**.</span></span>    
     <span data-ttu-id="43fec-128">Por ejemplo, si el directorio raíz del servidor de FTP es \\\servidorFTP\inicio y desea almacenar las instantáneas en \\\servidorFTP\inicio\instantáneas, especifique \instantáneas\ftp para la propiedad **Ruta de acceso de la carpeta raíz del servidor FTP** (la replicación adjunta 'ftp' a la ruta de acceso de la carpeta de instantáneas al crear los archivos de instantáneas).</span><span class="sxs-lookup"><span data-stu-id="43fec-128">For example, if the FTP server root is \\\ftpserver\home and you want snapshots to be stored at \\\ftpserver\home\snapshots, specify \snapshots\ftp for the property **Path from the FTP root folder** (replication appends 'ftp' to the snapshot folder path when it creates snapshot files).</span></span>    
3.  <span data-ttu-id="43fec-129">Especifique que el Agente de instantáneas copie los archivos de instantáneas en el directorio especificado en el paso 2.</span><span class="sxs-lookup"><span data-stu-id="43fec-129">Specify that the Snapshot Agent should write the snapshot files to the directory specified in step 2.</span></span> <span data-ttu-id="43fec-130">Por ejemplo, para que el Agente de instantáneas copie los archivos de instantáneas en \\\servidorFTP\inicio\instantáneas\ftp, debe especificar la ruta de acceso \\\servidorFTP\inicio\instantáneas en uno de estos dos lugares:</span><span class="sxs-lookup"><span data-stu-id="43fec-130">For example, to have the Snapshot Agent write the snapshot files to \\\ftpserver\home\snapshots\ftp, you must specify the path \\\ftpserver\home\snapshots in one of two places:</span></span>    
    -   <span data-ttu-id="43fec-131">La ubicación de instantáneas predeterminada en el distribuidor asociado con esta publicación.</span><span class="sxs-lookup"><span data-stu-id="43fec-131">The default snapshot location for the Distributor associated with this publication.</span></span>    
         <span data-ttu-id="43fec-132">Para obtener más información sobre cómo especificar la ubicación de instantáneas predeterminada, vea [especificar la ubicación de instantáneas predeterminada](../snapshot-options.md#snapshot-folder-locations).</span><span class="sxs-lookup"><span data-stu-id="43fec-132">For more information about specifying the default snapshot location, see [Specify the Default Snapshot Location](../snapshot-options.md#snapshot-folder-locations).</span></span>    
    -   <span data-ttu-id="43fec-133">Una carpeta de instantáneas alternativa para esta publicación.</span><span class="sxs-lookup"><span data-stu-id="43fec-133">An alternate snapshot folder location for this publication.</span></span> <span data-ttu-id="43fec-134">Se necesita una ubicación alternativa si la instantánea está comprimida.</span><span class="sxs-lookup"><span data-stu-id="43fec-134">An alternate location is required if the snapshot is compressed.</span></span>    
         <span data-ttu-id="43fec-135">Escriba la ruta de acceso en el cuadro de texto **colocar archivos en la siguiente carpeta** en la página instantánea del cuadro de diálogo Propiedades de la \*\*publicación: \<Publication> \*\* .</span><span class="sxs-lookup"><span data-stu-id="43fec-135">Enter the path in the **Put files in the following folder** textbox on the Snapshot page of the **Publication Properties - \<Publication>** dialog box.</span></span>   
4.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="43fec-136">Usar Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="43fec-136">Using Transact-SQL</span></span>  
 <span data-ttu-id="43fec-137">Se puede establecer la opción para que los archivos de instantáneas estén disponibles en un servidor FTP y se puede modificar esta configuración mediante programación empleando los procedimientos almacenados de replicación.</span><span class="sxs-lookup"><span data-stu-id="43fec-137">The option to make snapshot files available on an FTP server can be set and these FTP settings can be modified programmatically using replication stored procedures.</span></span> <span data-ttu-id="43fec-138">El procedimiento usado depende del tipo de publicación.</span><span class="sxs-lookup"><span data-stu-id="43fec-138">The procedure used depends on the type of publication.</span></span> <span data-ttu-id="43fec-139">La entrega de instantáneas a través de FTP solamente se usa con suscripciones de extracción.</span><span class="sxs-lookup"><span data-stu-id="43fec-139">FTP snapshot delivery is only used with pull subscriptions.</span></span>  
  
#### <a name="to-enable-ftp-snapshot-delivery-for-a-snapshot-or-transactional-publication"></a><span data-ttu-id="43fec-140">Para habilitar la entrega de instantáneas a través de FTP para una publicación transaccional o de instantáneas</span><span class="sxs-lookup"><span data-stu-id="43fec-140">To enable FTP snapshot delivery for a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="43fec-141">En la base de datos de publicación del Publicador, ejecute [sp_addpublication](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="43fec-141">At the Publisher on the publication database, execute [sp_addpublication](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql).</span></span> <span data-ttu-id="43fec-142">Especifique **@publication** , un valor de `true` para **@enabled_for_internet** y los valores adecuados para los parámetros siguientes:</span><span class="sxs-lookup"><span data-stu-id="43fec-142">Specify **@publication**, a value of `true` for **@enabled_for_internet**, and appropriate values for the following parameters:</span></span>    
    -   <span data-ttu-id="43fec-143">**@ftp_address**: la dirección del servidor FTP que se usa para proporcionar la instantánea.</span><span class="sxs-lookup"><span data-stu-id="43fec-143">**@ftp_address** - the address of the FTP server used to deliver the snapshot.</span></span>    
    -   <span data-ttu-id="43fec-144">(Opcional) **@ftp_port** : el puerto usado por el servidor FTP.</span><span class="sxs-lookup"><span data-stu-id="43fec-144">(Optional) **@ftp_port** - the port used by the FTP server.</span></span>    
    -   <span data-ttu-id="43fec-145">(Opcional) **@ftp_subdirectory** : el subdirectorio del directorio FTP predeterminado asignado a un inicio de sesión FTP.</span><span class="sxs-lookup"><span data-stu-id="43fec-145">(Optional) **@ftp_subdirectory** - the subdirectory of the default FTP directory assigned to an FTP login.</span></span> <span data-ttu-id="43fec-146">Por ejemplo, si la raíz del servidor FTP es \\ \servidorftp\inicio y desea que las instantáneas se almacenen en \\ \ftpserver\home\snapshots, especifique **\snapshots\ftp** para **@ftp_subdirectory** (la replicación anexa ' ftp ' a la ruta de acceso de la carpeta de instantáneas al crear archivos de instantáneas).</span><span class="sxs-lookup"><span data-stu-id="43fec-146">For example, if the FTP server root is \\\ftpserver\home and you want snapshots to be stored at \\\ftpserver\home\snapshots, specify **\snapshots\ftp** for **@ftp_subdirectory** (replication appends 'ftp' to the snapshot folder path when it creates snapshot files).</span></span>    
    -   <span data-ttu-id="43fec-147">(Opcional) **@ftp_login** : una cuenta de inicio de sesión que se usa al conectarse al servidor FTP.</span><span class="sxs-lookup"><span data-stu-id="43fec-147">(Optional) **@ftp_login** - a login account used when connecting to the FTP server.</span></span>    
    -   <span data-ttu-id="43fec-148">(Opcional) **@ftp_password** -la contraseña para el inicio de sesión de FTP.</span><span class="sxs-lookup"><span data-stu-id="43fec-148">(Optional) **@ftp_password** - the password for the FTP login.</span></span>  
  
     <span data-ttu-id="43fec-149">Esto crea una publicación que usa FTP.</span><span class="sxs-lookup"><span data-stu-id="43fec-149">This creates a publication that uses FTP.</span></span> <span data-ttu-id="43fec-150">Para obtener más información, vea [Crear una suscripción](create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="43fec-150">For more information, see [Create a Publication](create-a-publication.md).</span></span>  
  
#### <a name="to-enable-ftp-snapshot-delivery-for-a-merge-publication"></a><span data-ttu-id="43fec-151">Para habilitar la entrega de instantáneas a través de FTP para una publicación de combinación</span><span class="sxs-lookup"><span data-stu-id="43fec-151">To enable FTP snapshot delivery for a merge publication</span></span>  
  
1.  <span data-ttu-id="43fec-152">En la base de datos de publicación del publicador, ejecute [sp_addmergepublication](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="43fec-152">At the Publisher on the publication database, execute [sp_addmergepublication](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span></span> <span data-ttu-id="43fec-153">Especifique **@publication** , un valor de `true` para **@enabled_for_internet** y los valores adecuados para los parámetros siguientes:</span><span class="sxs-lookup"><span data-stu-id="43fec-153">Specify **@publication**, a value of `true` for **@enabled_for_internet** and appropriate values for the following parameters:</span></span>  
  
    -   <span data-ttu-id="43fec-154">**@ftp_address**: la dirección del servidor FTP que se usa para proporcionar la instantánea.</span><span class="sxs-lookup"><span data-stu-id="43fec-154">**@ftp_address** - the address of the FTP server used to deliver the snapshot.</span></span>    
    -   <span data-ttu-id="43fec-155">(Opcional) **@ftp_port** : el puerto usado por el servidor FTP.</span><span class="sxs-lookup"><span data-stu-id="43fec-155">(Optional) **@ftp_port** - the port used by the FTP server.</span></span>    
    -   <span data-ttu-id="43fec-156">(Opcional) **@ftp_subdirectory** : el subdirectorio del directorio FTP predeterminado asignado a un inicio de sesión FTP.</span><span class="sxs-lookup"><span data-stu-id="43fec-156">(Optional) **@ftp_subdirectory** - the subdirectory of the default FTP directory assigned to an FTP login.</span></span> <span data-ttu-id="43fec-157">Por ejemplo, si la raíz del servidor FTP es \\ \servidorftp\inicio y desea que las instantáneas se almacenen en \\ \ftpserver\home\snapshots, especifique **\snapshots\ftp** para **@ftp_subdirectory** (la replicación anexa ' ftp ' a la ruta de acceso de la carpeta de instantáneas al crear archivos de instantáneas).</span><span class="sxs-lookup"><span data-stu-id="43fec-157">For example, if the FTP server root is \\\ftpserver\home and you want snapshots to be stored at \\\ftpserver\home\snapshots, specify **\snapshots\ftp** for **@ftp_subdirectory** (replication appends 'ftp' to the snapshot folder path when it creates snapshot files).</span></span>    
    -   <span data-ttu-id="43fec-158">(Opcional) **@ftp_login** : una cuenta de inicio de sesión que se usa al conectarse al servidor FTP.</span><span class="sxs-lookup"><span data-stu-id="43fec-158">(Optional) **@ftp_login** - a login account used when connecting to the FTP server.</span></span>    
    -   <span data-ttu-id="43fec-159">(Opcional) **@ftp_password** -la contraseña para el inicio de sesión de FTP.</span><span class="sxs-lookup"><span data-stu-id="43fec-159">(Optional) **@ftp_password** - the password for the FTP login.</span></span>  
  
     <span data-ttu-id="43fec-160">Esto crea una publicación que usa FTP.</span><span class="sxs-lookup"><span data-stu-id="43fec-160">This creates a publication that uses FTP.</span></span> <span data-ttu-id="43fec-161">Para obtener más información, vea [Crear una suscripción](create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="43fec-161">For more information, see [Create a Publication](create-a-publication.md).</span></span>  
  
#### <a name="to-create-a-pull-subscription-to-a-snapshot-or-transactional-publication-that-uses-ftp-snapshot-delivery"></a><span data-ttu-id="43fec-162">Para crear una suscripción de extracción a una publicación transaccional o de instantáneas que usa la entrega de instantáneas a través de FTP</span><span class="sxs-lookup"><span data-stu-id="43fec-162">To create a pull subscription to a snapshot or transactional publication that uses FTP snapshot delivery</span></span>  
  
1.  <span data-ttu-id="43fec-163">En el publicador de la base de datos de suscripciones, ejecute [sp_addpullsubscription](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="43fec-163">At the Subscriber on the subscription database, execute [sp_addpullsubscription](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-transact-sql).</span></span> <span data-ttu-id="43fec-164">Especifique **@publisher** y **@publication** .</span><span class="sxs-lookup"><span data-stu-id="43fec-164">Specify **@publisher** and **@publication**.</span></span>  
  
    -   <span data-ttu-id="43fec-165">En el suscriptor de la base de datos de suscripciones, ejecute [sp_addpullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="43fec-165">At the Subscriber on the subscription database, execute [sp_addpullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql).</span></span> <span data-ttu-id="43fec-166">Especifique **@publisher** , **@publisher_db** , **@publication** , las [!INCLUDE[msCoName](../../../includes/msconame-md.md)] credenciales de Windows con las que se ejecuta el agente de distribución en el suscriptor para **@job_login** y **@job_password** , y un valor de `true` para **@use_ftp** .</span><span class="sxs-lookup"><span data-stu-id="43fec-166">Specify **@publisher**, **@publisher_db**, **@publication**, the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows credentials under which the Distribution Agent at the Subscriber runs for **@job_login** and **@job_password**, and a value of `true` for **@use_ftp**.</span></span>  
  
2.  <span data-ttu-id="43fec-167">En la base de datos de publicación del publicador, ejecute [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql) para registrar la suscripción de extracción.</span><span class="sxs-lookup"><span data-stu-id="43fec-167">At the Publisher on the publication database, execute [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql) to register the pull subscription.</span></span> <span data-ttu-id="43fec-168">Para obtener más información, consulte [Create a Pull Subscription](../create-a-pull-subscription.md).</span><span class="sxs-lookup"><span data-stu-id="43fec-168">For more information, see [Create a Pull Subscription](../create-a-pull-subscription.md).</span></span>  
  
#### <a name="to-create-a-pull-subscription-to-a-merge-publication-that-uses-ftp-snapshot-delivery"></a><span data-ttu-id="43fec-169">Para crear una suscripción de extracción a una publicación de combinación que use la entrega de instantáneas a través de FTP</span><span class="sxs-lookup"><span data-stu-id="43fec-169">To create a pull subscription to a merge publication that uses FTP snapshot delivery</span></span>  
  
1.  <span data-ttu-id="43fec-170">En la base de datos de suscripciones del suscriptor, ejecute [sp_addmergepullsubscription](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="43fec-170">At the Subscriber on the subscription database, execute [sp_addmergepullsubscription](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-transact-sql).</span></span> <span data-ttu-id="43fec-171">Especifique **@publisher** y **@publication** .</span><span class="sxs-lookup"><span data-stu-id="43fec-171">Specify **@publisher** and **@publication**.</span></span>   
2.  <span data-ttu-id="43fec-172">En el suscriptor de la base de datos de suscripciones, ejecute [sp_addmergepullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="43fec-172">At the Subscriber on the subscription database, execute [sp_addmergepullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql).</span></span> <span data-ttu-id="43fec-173">Especifique **@publisher** , **@publisher_db** , **@publication** , las credenciales de Windows con las que se ejecuta el agente de distribución en el suscriptor para **@job_login** y **@job_password** , y un valor de `true` para **@use_ftp** .</span><span class="sxs-lookup"><span data-stu-id="43fec-173">Specify **@publisher**, **@publisher_db**, **@publication**, the Windows credentials under which the Distribution Agent at the Subscriber runs for **@job_login** and **@job_password**, and a value of `true` for **@use_ftp**.</span></span>    
3.  <span data-ttu-id="43fec-174">En la base de datos de publicación del publicador, ejecute [sp_addmergesubscription](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql) para registrar la suscripción de extracción.</span><span class="sxs-lookup"><span data-stu-id="43fec-174">At the Publisher on the publication database, execute [sp_addmergesubscription](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql) to register the pull subscription.</span></span> <span data-ttu-id="43fec-175">Para obtener más información, consulte [Create a Pull Subscription](../create-a-pull-subscription.md).</span><span class="sxs-lookup"><span data-stu-id="43fec-175">For more information, see [Create a Pull Subscription](../create-a-pull-subscription.md).</span></span>  
  
#### <a name="to-change-one-or-more-ftp-snapshot-delivery-settings-for-a-snapshot-or-transactional-publication"></a><span data-ttu-id="43fec-176">Para cambiar una o más configuraciones de entrega de instantáneas a través de FTP para una publicación transaccional o de instantáneas</span><span class="sxs-lookup"><span data-stu-id="43fec-176">To change one or more FTP snapshot delivery settings for a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="43fec-177">En la base de datos de publicación del publicador, ejecute [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="43fec-177">At the Publisher on the publication database, execute [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql).</span></span> <span data-ttu-id="43fec-178">Especifique uno de los valores siguientes para **@property** y un nuevo valor de esta configuración para **@value** :</span><span class="sxs-lookup"><span data-stu-id="43fec-178">Specify one of the following values for **@property** and a new value of this setting for **@value**:</span></span>    
    -   <span data-ttu-id="43fec-179">`ftp_address`: la dirección del servidor FTP usada para entregar la instantánea</span><span class="sxs-lookup"><span data-stu-id="43fec-179">`ftp_address` - the address of the FTP server used to deliver the snapshot.</span></span>    
    -   <span data-ttu-id="43fec-180">`ftp_port`: el puerto usado por el servidor FTP</span><span class="sxs-lookup"><span data-stu-id="43fec-180">`ftp_port` - the port used by the FTP server.</span></span>    
    -   <span data-ttu-id="43fec-181">`ftp_subdirectory`: el subdirectorio del directorio FTP predeterminado usado para la instantánea de FTP</span><span class="sxs-lookup"><span data-stu-id="43fec-181">`ftp_subdirectory` - the subdirectory of the default FTP directory used for the FTP snapshot.</span></span>    
    -   <span data-ttu-id="43fec-182">`ftp_login`: un inicio de sesión para conectar al servidor de FTP</span><span class="sxs-lookup"><span data-stu-id="43fec-182">`ftp_login` - a login used to connect to the FTP server.</span></span>    
    -   <span data-ttu-id="43fec-183">`ftp_password`: la contraseña del inicio de sesión de FTP</span><span class="sxs-lookup"><span data-stu-id="43fec-183">`ftp_password` - the password for the FTP login.</span></span>  
  
2.  <span data-ttu-id="43fec-184">(Opcional) Repita el paso 1 para cada configuración de FTP que se está cambiando.</span><span class="sxs-lookup"><span data-stu-id="43fec-184">(Optional) Repeat step 1 for each FTP setting being changed.</span></span>    
3.  <span data-ttu-id="43fec-185">(Opcional) Para deshabilitar la entrega de instantáneas a través de FTP, ejecute [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql) en el Publicador de la base de datos de publicación.</span><span class="sxs-lookup"><span data-stu-id="43fec-185">(Optional) To disable FTP snapshot delivery, execute [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql) at the Publisher on the publication database.</span></span> <span data-ttu-id="43fec-186">Especifique un valor de `enabled_for_internet` para **@property** y un valor de `false` para **@value** .</span><span class="sxs-lookup"><span data-stu-id="43fec-186">Specify a value of `enabled_for_internet` for **@property** and a value of `false` for **@value**.</span></span>  
  
#### <a name="to-change-ftp-snapshot-delivery-settings-for-a-merge-publication"></a><span data-ttu-id="43fec-187">Para cambiar la configuración de entrega de instantáneas a través de FTP para una publicación de combinación</span><span class="sxs-lookup"><span data-stu-id="43fec-187">To change FTP snapshot delivery settings for a merge publication</span></span>  
  
1.  <span data-ttu-id="43fec-188">En la base de datos de publicación del publicador, ejecute [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="43fec-188">At the Publisher on the publication database, execute [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql).</span></span> <span data-ttu-id="43fec-189">Especifique uno de los valores siguientes para **@property** y un nuevo valor de esta configuración para **@value** :</span><span class="sxs-lookup"><span data-stu-id="43fec-189">Specify one of the following values for **@property** and a new value of this setting for **@value**:</span></span>  
  
    -   <span data-ttu-id="43fec-190">`ftp_address`: la dirección del servidor FTP usada para entregar la instantánea</span><span class="sxs-lookup"><span data-stu-id="43fec-190">`ftp_address` - the address of the FTP server used to deliver the snapshot.</span></span>    
    -   <span data-ttu-id="43fec-191">`ftp_port`: el puerto usado por el servidor FTP</span><span class="sxs-lookup"><span data-stu-id="43fec-191">`ftp_port` - the port used by the FTP server.</span></span>    
    -   <span data-ttu-id="43fec-192">`ftp_subdirectory`: el subdirectorio del directorio FTP predeterminado usado para la instantánea de FTP</span><span class="sxs-lookup"><span data-stu-id="43fec-192">`ftp_subdirectory` - the subdirectory of the default FTP directory used for the FTP snapshot.</span></span>   
    -   <span data-ttu-id="43fec-193">`ftp_login`: un inicio de sesión para conectar al servidor de FTP</span><span class="sxs-lookup"><span data-stu-id="43fec-193">`ftp_login` - a login used to connect to the FTP server.</span></span>    
    -   <span data-ttu-id="43fec-194">`ftp_password`: la contraseña del inicio de sesión de FTP</span><span class="sxs-lookup"><span data-stu-id="43fec-194">`ftp_password` - the password for the FTP login.</span></span>    
2.  <span data-ttu-id="43fec-195">(Opcional) Repita el paso 1 para cada configuración de FTP que se está cambiando.</span><span class="sxs-lookup"><span data-stu-id="43fec-195">(Optional) Repeat step 1 for each FTP setting being changed.</span></span>    
3.  <span data-ttu-id="43fec-196">(Opcional) Para deshabilitar la entrega de instantáneas a través de FTP, ejecute [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql) en el Publicador de la base de datos de publicación.</span><span class="sxs-lookup"><span data-stu-id="43fec-196">(Optional) To disable FTP snapshot delivery, execute [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql) at the Publisher on the publication database.</span></span> <span data-ttu-id="43fec-197">Especifique un valor de `enabled_for_internet` para **@property** y un valor de `false` para **@value** .</span><span class="sxs-lookup"><span data-stu-id="43fec-197">Specify a value of `enabled_for_internet` for **@property** and a value of `false` for **@value**.</span></span>  
  
###  <a name="examples-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="43fec-198">Ejemplos (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="43fec-198">Examples (Transact-SQL)</span></span>  
 <span data-ttu-id="43fec-199">El ejemplo siguiente crea una publicación de combinación que permite a los Suscriptores tener acceso a los datos de instantánea usando FTP.</span><span class="sxs-lookup"><span data-stu-id="43fec-199">The following example creates a merge publication that allows Subscribers to access the snapshot data using FTP.</span></span> <span data-ttu-id="43fec-200">El suscriptor debe usar una conexión VPN segura al obtener acceso al recurso compartido de FTP.</span><span class="sxs-lookup"><span data-stu-id="43fec-200">The Subscriber should use a secure VPN connection when accessing the FTP share.</span></span> <span data-ttu-id="43fec-201">Las variables de scripting de**sqlcmd** se usan para proporcionar valores de inicio de sesión y de contraseña.</span><span class="sxs-lookup"><span data-stu-id="43fec-201">**sqlcmd** scripting variables are used to supply login and password values.</span></span> <span data-ttu-id="43fec-202">Para obtener más información, vea [Usar sqlcmd con variables de script](../../scripting/sqlcmd-use-with-scripting-variables.md).</span><span class="sxs-lookup"><span data-stu-id="43fec-202">For more information, see [Use sqlcmd with Scripting Variables](../../scripting/sqlcmd-use-with-scripting-variables.md).</span></span>  
  
 [!code-sql[HowTo#sp_createmergepub_ftp](../../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubftp.sql#sp_createmergepub_ftp)]  
  
 <span data-ttu-id="43fec-203">El ejemplo siguiente crea una suscripción a una publicación de combinación, donde el Suscriptor obtiene la instantánea mediante FTP.</span><span class="sxs-lookup"><span data-stu-id="43fec-203">The following example creates a subscription to a merge publication, where the Subscriber obtains the snapshot using FTP.</span></span> <span data-ttu-id="43fec-204">El suscriptor debe usar una conexión VPN segura al obtener acceso al recurso compartido de FTP.</span><span class="sxs-lookup"><span data-stu-id="43fec-204">The Subscriber should use a secure VPN connection when accessing the FTP share.</span></span> <span data-ttu-id="43fec-205">Las variables de scripting de**sqlcmd** se usan para proporcionar valores de inicio de sesión y de contraseña.</span><span class="sxs-lookup"><span data-stu-id="43fec-205">**sqlcmd** scripting variables are used to supply login and password values.</span></span> <span data-ttu-id="43fec-206">Para obtener más información, vea [Usar sqlcmd con variables de script](../../scripting/sqlcmd-use-with-scripting-variables.md).</span><span class="sxs-lookup"><span data-stu-id="43fec-206">For more information, see [Use sqlcmd with Scripting Variables](../../scripting/sqlcmd-use-with-scripting-variables.md).</span></span>  
  
 [!code-sql[HowTo#sp_createmergepullsub_ftp](../../../snippets/tsql/SQL15/replication/howto/tsql/createmergepullsubftp.sql#sp_createmergepullsub_ftp)]  
  
 [!code-sql[HowTo#sp_createmergepullsubagent_ftp](../../../snippets/tsql/SQL15/replication/howto/tsql/createmergepullsubftp.sql#sp_createmergepullsubagent_ftp)]  
  
## <a name="see-also"></a><span data-ttu-id="43fec-207">Consulte también</span><span class="sxs-lookup"><span data-stu-id="43fec-207">See Also</span></span>  
 <span data-ttu-id="43fec-208">[Replication System Stored Procedures Concepts](../concepts/replication-system-stored-procedures-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="43fec-208">[Replication System Stored Procedures Concepts](../concepts/replication-system-stored-procedures-concepts.md) </span></span>  
 <span data-ttu-id="43fec-209">[Transferir instantáneas a través de FTP](../transfer-snapshots-through-ftp.md) </span><span class="sxs-lookup"><span data-stu-id="43fec-209">[Transfer Snapshots Through FTP](../transfer-snapshots-through-ftp.md) </span></span>  
 <span data-ttu-id="43fec-210">[Cambiar las propiedades de la publicación y de los artículos](change-publication-and-article-properties.md) </span><span class="sxs-lookup"><span data-stu-id="43fec-210">[Change Publication and Article Properties](change-publication-and-article-properties.md) </span></span>  
 [<span data-ttu-id="43fec-211">Inicializar una suscripción con una instantánea</span><span class="sxs-lookup"><span data-stu-id="43fec-211">Initialize a Subscription with a Snapshot</span></span>](../initialize-a-subscription-with-a-snapshot.md)  
  
  
