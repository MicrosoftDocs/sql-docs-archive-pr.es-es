---
title: Replicación de columnas de identidad | Microsoft Docs
ms.custom: ''
ms.date: 10/04/2016
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- identities [SQL Server replication]
- identity values [SQL Server replication]
- merge replication [SQL Server replication], identity range management
- publishing [SQL Server replication], identity columns
- transactional replication, identity range management
- identity columns [SQL Server], replication
ms.assetid: eb2f23a8-7ec2-48af-9361-0e3cb87ebaf7
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: c899d902e403e9f7cdbdfd1a83cde110e627ab11
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87669594"
---
# <a name="replicate-identity-columns"></a><span data-ttu-id="f4f3a-102">Replicar columnas de identidad</span><span class="sxs-lookup"><span data-stu-id="f4f3a-102">Replicate Identity Columns</span></span>
  <span data-ttu-id="f4f3a-103">Al asignar una propiedad IDENTITY a una columna, [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] genera automáticamente números que se incrementan secuencialmente para las nuevas filas insertadas en la tabla que contiene la columna de identidad.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-103">When you assign an IDENTITY property to a column, [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] automatically generates sequential numbers for new rows inserted in the table containing the identity column.</span></span> <span data-ttu-id="f4f3a-104">Para obtener más información, vea [IDENTITY &#40;propiedad &#41; &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-table-transact-sql-identity-property).</span><span class="sxs-lookup"><span data-stu-id="f4f3a-104">For more information, see [IDENTITY &#40;Property&#41; &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-table-transact-sql-identity-property).</span></span> <span data-ttu-id="f4f3a-105">Debido a que las columnas de identidad pueden estar incluidas como parte de la clave principal, resulta importante evitar los valores duplicados en las columnas de identidad.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-105">Because identity columns might be included as a part of the primary key, it is important to avoid duplicate values in the identity columns.</span></span> <span data-ttu-id="f4f3a-106">Para utilizar columnas de identidad en una topología de replicación que tenga actualizaciones en más de un nodo, cada nodo de la topología de replicación debe usar diferentes valores en el intervalo de identidad con el fin de que no se produzcan duplicados.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-106">To use identity columns in a replication topology that has updates at more than one node, each node in the replication topology must use a different range of identity values, so that duplicates do not occur.</span></span>  
  
 <span data-ttu-id="f4f3a-107">Por ejemplo, podría asignarse el rango 1-100 al Publicador, el rango 101-200 al Suscriptor A y el rango 201-300 al Suscriptor B.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-107">For example, the Publisher could be assigned the range 1-100, Subscriber A the range 101-200, and Subscriber B the range 201-300.</span></span> <span data-ttu-id="f4f3a-108">Si se inserta una fila en el Publicador y el valor de identidad es, por ejemplo, 65, ese valor se replica en cada Suscriptor.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-108">If a row is inserted at the Publisher and the identity value is, for example, 65, that value is replicated to each Subscriber.</span></span> <span data-ttu-id="f4f3a-109">Cuando la replicación inserta datos en cada suscriptor, no incrementa el valor de la columna de identidad en la tabla del suscriptor; en su lugar, se inserta el valor literal 65.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-109">When replication inserts data at each Subscriber, it does not increment the identity column value in the Subscriber table; instead, the literal value 65 is inserted.</span></span> <span data-ttu-id="f4f3a-110">Son solo las inserciones del usuario y no las del agente de replicación las que hacen que se incremente el valor de la columna de identidad.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-110">Only user inserts, but not replication agent inserts cause the identity column value to be incremented.</span></span>  
  
 <span data-ttu-id="f4f3a-111">La replicación controla las columnas de identidad en todos los tipos de publicaciones y suscripciones, permitiéndole a usted administrar las columnas manualmente o hacer que la replicación las administre automáticamente.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-111">Replication handles identity columns across all publication and subscription types, allowing you to manage the columns manually or have replication manage them automatically.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="f4f3a-112">No se admite la posibilidad de agregar una columna de identidad a una tabla publicada porque puede dar como resultado la falta de convergencia cuando la columna se replica en el suscriptor.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-112">Adding an identity column to a published table is not supported, because it can result in non-convergence when the column is replicated to the Subscriber.</span></span> <span data-ttu-id="f4f3a-113">Los valores de la columna de identidad en el publicador dependen del orden en que se almacenen físicamente las filas de la tabla afectada.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-113">The values in the identity column at the Publisher depend on the order in which the rows for the affected table are physically stored.</span></span> <span data-ttu-id="f4f3a-114">Las filas se pueden almacenar de forma diferente en el suscriptor; por tanto, el valor de la columna de identidad puede ser diferente para las mismas filas.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-114">The rows might be stored differently at the Subscriber; therefore the value for the identity column can be different for the same rows.</span></span>  
  
## <a name="specifying-an-identity-range-management-option"></a><span data-ttu-id="f4f3a-115">Especificar una opción de administración del intervalo de identidad</span><span class="sxs-lookup"><span data-stu-id="f4f3a-115">Specifying an Identity Range Management Option</span></span>  
 <span data-ttu-id="f4f3a-116">La replicación ofrece tres opciones de administración del intervalo de identidad:</span><span class="sxs-lookup"><span data-stu-id="f4f3a-116">Replication offers three identity range management options:</span></span>  
  
-   <span data-ttu-id="f4f3a-117">Automático.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-117">Automatic.</span></span> <span data-ttu-id="f4f3a-118">Se utiliza para replicación de mezcla y replicación transaccional con actualizaciones en el suscriptor.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-118">Used for merge replication and transactional replication with updates at the Subscriber.</span></span> <span data-ttu-id="f4f3a-119">Especifique intervalos de tamaño para el publicador y los suscriptores, y la replicación automáticamente administrará las asignaciones de los nuevos intervalos.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-119">Specify size ranges for the Publisher and Subscribers, and replication automatically manages the assignment of new ranges.</span></span> <span data-ttu-id="f4f3a-120">La replicación establece la opción NOT FOR REPLICATION en la columna de identidad en el suscriptor, con el fin de que solo las inserciones del usuario hagan que el valor se incremente en el suscriptor.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-120">Replication sets the NOT FOR REPLICATION option on the identity column at the Subscriber, so that only user inserts cause the value to be incremented at the Subscriber.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="f4f3a-121">Los suscriptores deben estar sincronizados con el publicador para recibir nuevos intervalos.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-121">Subscribers must synchronize with the Publisher to receive new ranges.</span></span> <span data-ttu-id="f4f3a-122">Como a los suscriptores se les asignan intervalos de identidad automáticamente, es posible que cualquier suscriptor agote todo el suministro de intervalos de identidad si solicita repetidas veces nuevos intervalos.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-122">Because Subscribers are assigned identity ranges automatically, it is possible for any Subscriber to exhaust the entire supply of identity ranges if it repeatedly requests new ranges.</span></span>  
  
-   <span data-ttu-id="f4f3a-123">Manual.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-123">Manual.</span></span> <span data-ttu-id="f4f3a-124">Se utiliza para replicación de instantáneas y transaccional sin actualizaciones en el suscriptor, replicación transaccional punto a punto o en los casos en los que la aplicación deba controlar los intervalos de identidad mediante programación.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-124">Used for snapshot and transactional replication without updates at the Subscriber, peer-to-peer transactional replication, or if your application must control identity ranges programmatically.</span></span> <span data-ttu-id="f4f3a-125">Si especifica la administración manual, debe asegurarse de que los intervalos se asignan al publicador y a cada suscriptor y que los nuevos intervalos se asignan si se utilizan los intervalos iniciales.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-125">If you specify manual management, you must ensure that ranges are assigned to the Publisher and each Subscriber and that new ranges are assigned if the initial ranges are used.</span></span> <span data-ttu-id="f4f3a-126">La replicación establece la opción NOT FOR REPLICATION en la columna de identidad en el suscriptor.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-126">Replication sets the NOT FOR REPLICATION option on the identity column at the Subscriber.</span></span>  
  
-   <span data-ttu-id="f4f3a-127">Ninguno.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-127">None.</span></span> <span data-ttu-id="f4f3a-128">Esta opción solo se recomienda para lograr la compatibilidad con versiones anteriores de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] y solo está disponible desde la interfaz de procedimientos almacenados de publicaciones transaccionales.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-128">This option is recommended only for backwards compatibility with earlier versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and is available only from the stored procedure interface for transactional publications.</span></span>  
  
 <span data-ttu-id="f4f3a-129">Para especificar una opción de administración del intervalo de identidad, vea [Administrar columnas de identidad](manage-identity-columns.md).</span><span class="sxs-lookup"><span data-stu-id="f4f3a-129">To specify an identity range management option, see [Manage Identity Columns](manage-identity-columns.md).</span></span>  
  
## <a name="assigning-identity-ranges"></a><span data-ttu-id="f4f3a-130">Asignar intervalos de identidad</span><span class="sxs-lookup"><span data-stu-id="f4f3a-130">Assigning Identity Ranges</span></span>  
 <span data-ttu-id="f4f3a-131">La replicación de mezcla y la replicación transaccional utilizan métodos diferentes para asignar intervalos. Estos métodos se describen en esta sección.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-131">Merge replication and transactional replication use different methods for assigning ranges; these methods are described in this section.</span></span>  
  
 <span data-ttu-id="f4f3a-132">Existen dos tipos de intervalos que deben tenerse en cuenta a la hora de replicar columnas de identidad: los intervalos asignados al publicador y a los suscriptores, y el intervalo del tipo de datos de la columna.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-132">There are two types of ranges to take into account when replicating identity columns: the ranges assigned to the Publisher and Subscribers, and the range of the data type in the column.</span></span> <span data-ttu-id="f4f3a-133">En la siguiente tabla se muestran los intervalos disponibles para los tipos de datos que se utilizan normalmente en las columnas de identidad.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-133">The following table shows the ranges available for the data types typically used in identity columns.</span></span> <span data-ttu-id="f4f3a-134">El intervalo se utiliza en todos los nodos de una topología.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-134">The range is used across all nodes in a topology.</span></span> <span data-ttu-id="f4f3a-135">Por ejemplo, si usa `smallint` a partir de 1 con un incremento de 1, el número máximo de inserciones es de 32.767 para el publicador y todos los suscriptores.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-135">For example, if you use `smallint` starting at 1 with an increment of 1, the maximum number of inserts is 32,767 for the Publisher and all Subscribers.</span></span> <span data-ttu-id="f4f3a-136">El número real de inserciones depende de si hay espacios en los valores utilizados y de si se ha utilizado un valor de umbral.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-136">The actual number of inserts depends on whether there are gaps in the values used and whether a threshold value is used.</span></span> <span data-ttu-id="f4f3a-137">Para obtener más información acerca de los umbrales, vea las secciones "Replicación de mezcla" y "Replicación transaccional con suscripciones de actualización en cola" más adelante.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-137">For more information about thresholds, see the following sections "Merge Replication" and "Transactional Replication with Queued Updating Subscriptions".</span></span>  
  
 <span data-ttu-id="f4f3a-138">Si el publicador agota su intervalo de identidad después de una inserción, puede asignar automáticamente un nuevo intervalo si la inserción la realizó un miembro del rol fijo de base de datos **db_owner** .</span><span class="sxs-lookup"><span data-stu-id="f4f3a-138">If the Publisher exhausts its identity range after an insert, it can automatically assign a new range if the insert was performed by a member of the **db_owner** fixed database role.</span></span> <span data-ttu-id="f4f3a-139">Si la inserción la realizó un usuario con otro rol, el Agente de registro del LOG, el Agente de mezcla o un usuario miembro del rol **db_owner**, deberá ejecutar [sp_adjustpublisheridentityrange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adjustpublisheridentityrange-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f4f3a-139">If the insert was performed by a user not in that role, the Log Reader Agent, Merge Agent, or a user who is a member of the **db_owner** role must run [sp_adjustpublisheridentityrange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adjustpublisheridentityrange-transact-sql).</span></span> <span data-ttu-id="f4f3a-140">Para las publicaciones transaccionales, el Agente de registro del LOG debe estar ejecutándose para asignar automáticamente un nuevo intervalo (la opción predeterminada es que el agente se ejecute continuamente).</span><span class="sxs-lookup"><span data-stu-id="f4f3a-140">For transactional publications, the Log Reader Agent must be running to automatically allocate a new range (the default is for the agent to run continuously).</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="f4f3a-141">Durante una inserción por lotes grande, el desencadenador de replicación se desencadena una sola vez, no para cada fila de la inserción.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-141">During a large batch insert the replication trigger is fired only once, not for each row of the insert.</span></span> <span data-ttu-id="f4f3a-142">Esto puede provocar un error en la instrucción de inserción si se agota un intervalo de identidad durante una inserción grande, como una instrucción `INSERT INTO`.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-142">This can lead to a failure of the insert statement if an identity range is exhausted during an large insert, such as an `INSERT INTO` statement.</span></span>  
  
|<span data-ttu-id="f4f3a-143">Tipo de datos</span><span class="sxs-lookup"><span data-stu-id="f4f3a-143">Data type</span></span>|<span data-ttu-id="f4f3a-144">Intervalo</span><span class="sxs-lookup"><span data-stu-id="f4f3a-144">Range</span></span>|  
|---------------|-----------|  
|`tinyint`|<span data-ttu-id="f4f3a-145">No se admite para la administración automática</span><span class="sxs-lookup"><span data-stu-id="f4f3a-145">Not supported for automatic management</span></span>|  
|`smallint`|<span data-ttu-id="f4f3a-146">De -2^15 (-32.768) a 2^15-1 (32.767)</span><span class="sxs-lookup"><span data-stu-id="f4f3a-146">-2^15 (-32,768) to 2^15-1 (32,767)</span></span>|  
|`int`|<span data-ttu-id="f4f3a-147">De -2^31 (-2.147.483.648) a 2^31-1 (2.147.483.647)</span><span class="sxs-lookup"><span data-stu-id="f4f3a-147">-2^31 (-2,147,483,648) to 2^31-1 (2,147,483,647)</span></span>|  
|`bigint`|<span data-ttu-id="f4f3a-148">De -2^63 (-9.223.372.036.854.775.808) a 2^63-1 (9.223.372.036.854.775.807)</span><span class="sxs-lookup"><span data-stu-id="f4f3a-148">-2^63 (-9,223,372,036,854,775,808) to 2^63-1 (9,223,372,036,854,775,807)</span></span>|  
|<span data-ttu-id="f4f3a-149">`decimal` y `numeric`</span><span class="sxs-lookup"><span data-stu-id="f4f3a-149">`decimal` and `numeric`</span></span>|<span data-ttu-id="f4f3a-150">De -10^38+1 a 10^38-1</span><span class="sxs-lookup"><span data-stu-id="f4f3a-150">-10^38+1 through 10^38-1</span></span>|  
  
> [!NOTE]  
>  <span data-ttu-id="f4f3a-151">Para crear un número que se incremente automáticamente y que se pueda usar en varias tablas, o que se pueda llamar desde las aplicaciones sin hacer referencia a ninguna tabla, vea [Números de secuencia](../../sequence-numbers/sequence-numbers.md).</span><span class="sxs-lookup"><span data-stu-id="f4f3a-151">To create an automatically incrementing number that can be used in multiple tables or that can be called from applications without referencing any table, see [Sequence Numbers](../../sequence-numbers/sequence-numbers.md).</span></span>  
  
### <a name="merge-replication"></a><span data-ttu-id="f4f3a-152">Replicación de mezcla</span><span class="sxs-lookup"><span data-stu-id="f4f3a-152">Merge Replication</span></span>  
 <span data-ttu-id="f4f3a-153">Los intervalos de identidad los administra el publicador y se propagan a los suscriptores mediante el Agente de mezcla (en una jerarquía de republicación, los intervalos los administra el publicador raíz y los republicadores).</span><span class="sxs-lookup"><span data-stu-id="f4f3a-153">Identity ranges are managed by the Publisher and propagated to Subscribers by the Merge Agent (in a republishing hierarchy, ranges are managed by the root Publisher and the republishers).</span></span> <span data-ttu-id="f4f3a-154">Los valores de identidad se asignan a partir de un grupo en el publicador.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-154">The identity values are assigned from a pool at the Publisher.</span></span> <span data-ttu-id="f4f3a-155">Cuando agregue un artículo con una columna de identidad a una publicación en el Asistente para nueva publicación o mediante [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql), especifique valores para:</span><span class="sxs-lookup"><span data-stu-id="f4f3a-155">When you add an article with an identity column to a publication in the New Publication Wizard or by using [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql), you specify values for:</span></span>  
  
-   <span data-ttu-id="f4f3a-156">El parámetro \*\* \@ identity_range\*\* , que controla el tamaño del intervalo de identidad inicialmente asignado al publicador y a los suscriptores con suscripciones de cliente.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-156">The **\@identity_range** parameter, which controls the identity range size initially allocated both to the Publisher and to Subscribers with client subscriptions.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="f4f3a-157">En el caso de los suscriptores que ejecutan versiones anteriores de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , este parámetro (en lugar del parámetro \*\* \@ pub_identity_range\*\* ) también controla el tamaño del intervalo de identidad en los suscriptores de republicación.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-157">For Subscribers running previous versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], this parameter (rather than the **\@pub_identity_range** parameter) also controls the identity range size at republishing Subscribers.</span></span>  
  
-   <span data-ttu-id="f4f3a-158">El parámetro \*\* \@ pub_identity_range\*\* , que controla el tamaño del intervalo de identidad para la republicación asignada a los suscriptores con suscripciones de servidor (requerido para volver a publicar datos).</span><span class="sxs-lookup"><span data-stu-id="f4f3a-158">The **\@pub_identity_range** parameter, which controls the identity range size for republishing allocated to Subscribers with server subscriptions (required for republishing data).</span></span> <span data-ttu-id="f4f3a-159">Todos los suscriptores con suscripciones de servidor reciben un intervalo para volver a publicar, incluso si no han vuelto a publicar ningún dato.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-159">All Subscribers with server subscriptions receive a range for republishing, even if they don't actually republish data.</span></span>  
  
-   <span data-ttu-id="f4f3a-160">El parámetro \*\* \@ Threshold\*\* , que se utiliza para determinar cuándo se requiere un nuevo intervalo de identidades para una suscripción a [!INCLUDE[ssEW](../../../includes/ssew-md.md)] o a una versión anterior de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="f4f3a-160">The **\@threshold** parameter, which is used to determine when a new range of identities is required for a subscription to [!INCLUDE[ssEW](../../../includes/ssew-md.md)] or a previous version of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
 <span data-ttu-id="f4f3a-161">Por ejemplo, puede especificar 10000 para \*\* \@ identity_range\*\* y 500000 para \*\* \@ pub_identity_range\*\*.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-161">For example, you could specify 10000 for **\@identity_range** and 500000 for **\@pub_identity_range**.</span></span> <span data-ttu-id="f4f3a-162">El publicador y todos los suscriptores que ejecutan [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] o una versión posterior, incluido el suscriptor con la suscripción de servidor, están asignados un intervalo principal de 10000.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-162">The Publisher and all Subscribers running [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version, including the Subscriber with the server subscription, are assigned a primary range of 10000.</span></span> <span data-ttu-id="f4f3a-163">Al suscriptor con la suscripción de servidor también se le asigna un intervalo principal de 500000, que pueden usar los suscriptores que se sincronizan con el suscriptor de republicación (también debe especificar \*\* \@ identity_range**, \*\* \@ pub_identity_range**y \*\* \@ umbral\*\* para los artículos de la publicación en el suscriptor de republicación).</span><span class="sxs-lookup"><span data-stu-id="f4f3a-163">The Subscriber with the server subscription is also assigned a primary range of 500000, which can be used by Subscribers that synchronize with the republishing Subscriber (you must also specify **\@identity_range**, **\@pub_identity_range**, and **\@threshold** for the articles in the publication at the republishing Subscriber).</span></span>  
  
 <span data-ttu-id="f4f3a-164">Todos los suscriptores que se ejecutan en [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] o una versión posterior también reciben un intervalo de identidad secundario.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-164">Each Subscriber running [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version also receives a secondary identity range.</span></span> <span data-ttu-id="f4f3a-165">El intervalo secundario tiene el mismo tamaño que el intervalo principal. Cuando se agota el intervalo principal, se utiliza el intervalo secundario y el Agente de mezcla asigna un nuevo intervalo en el suscriptor.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-165">The secondary range is equal in size to the primary range; when the primary range is exhausted, the secondary range is used, and the Merge Agent assigns a new range to the Subscriber.</span></span> <span data-ttu-id="f4f3a-166">El nuevo intervalo se convierte en el intervalo secundario y el proceso continúa a medida que el suscriptor utiliza valores de identidad.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-166">The new range becomes the secondary range, and the process continues as the Subscriber uses identity values.</span></span>  
  
  
### <a name="transactional-replication-with-queued-updating-subscriptions"></a><span data-ttu-id="f4f3a-167">Replicación transaccional con suscripciones de actualización en cola</span><span class="sxs-lookup"><span data-stu-id="f4f3a-167">Transactional Replication with Queued Updating Subscriptions</span></span>  
 <span data-ttu-id="f4f3a-168">El distribuidor administra los intervalos de identidad y el Agente de distribución los propaga a los suscriptores.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-168">Identity ranges are managed by the Distributor and propagated to Subscribers by the Distribution Agent.</span></span> <span data-ttu-id="f4f3a-169">Los valores de identidad se asignan a partir de un grupo en el distribuidor.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-169">The identity values are assigned from a pool at the Distributor.</span></span> <span data-ttu-id="f4f3a-170">El tamaño del grupo se basa en el tamaño del tipo de datos y en el incremento utilizado para la columna de identidad.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-170">The pool size is based on the size of the data type and the increment used for the identity column.</span></span> <span data-ttu-id="f4f3a-171">Cuando agregue un artículo con una columna de identidad a una publicación en el Asistente para nueva publicación o mediante [sp_addarticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql), especifique valores para:</span><span class="sxs-lookup"><span data-stu-id="f4f3a-171">When you add an article with an identity column to a publication in the New Publication Wizard or by using [sp_addarticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql), you specify values for:</span></span>  
  
-   <span data-ttu-id="f4f3a-172">El parámetro \*\* \@ identity_range\*\* , que controla el tamaño del intervalo de identidad inicialmente asignado a todos los suscriptores.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-172">The **\@identity_range** parameter, which controls the identity range size initially allocated to all Subscribers.</span></span>  
  
-   <span data-ttu-id="f4f3a-173">El parámetro \*\* \@ pub_identity_range\*\* , que controla el tamaño del intervalo de identidad asignado al publicador.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-173">The **\@pub_identity_range** parameter, which controls the identity range size allocated to the Publisher.</span></span>  
  
-   <span data-ttu-id="f4f3a-174">El parámetro \*\* \@ Threshold\*\* , que se utiliza para determinar cuándo se requiere un nuevo intervalo de identidades para una suscripción.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-174">The **\@threshold** parameter, which is used to determine when a new range of identities is required for a subscription.</span></span>  
  
 <span data-ttu-id="f4f3a-175">Por ejemplo, puede especificar 10000 para \*\* \@ pub_identity_range**, 1000 para \*\* \@ identity_range** (suponiendo menos actualizaciones en el suscriptor) y el 80 por ciento para el \*\* \@ umbral\*\*.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-175">For example, you could specify 10000 for **\@pub_identity_range**, 1000 for **\@identity_range** (assuming fewer updates at the Subscriber), and 80 percent for **\@threshold**.</span></span> <span data-ttu-id="f4f3a-176">Después de 800 inserciones en el suscriptor (80 por ciento de 1000), al suscriptor se le asigna un nuevo intervalo.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-176">After 800 inserts at a Subscriber (80 percent of 1000), a Subscriber is assigned a new range.</span></span> <span data-ttu-id="f4f3a-177">Después de 8000 inserciones en el publicador, al publicador se le asigna un nuevo intervalo.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-177">After 8000 inserts at the Publisher, the Publisher is assigned a new range.</span></span> <span data-ttu-id="f4f3a-178">Cuando se asigne un nuevo intervalo, habrá un espacio en los valores del intervalo de identidad de la tabla.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-178">When a new range is assigned, there will be a gap in the identity range values in the table.</span></span> <span data-ttu-id="f4f3a-179">Si se especifica un umbral mayor, se obtienen menos espacios pero el sistema es menos tolerante a los errores: si el Agente de distribución no se puede ejecutar por alguna razón, es más fácil que un suscriptor se quede sin identidades.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-179">Specifying a higher threshold results in smaller gaps, but the system is less fault-tolerant: if the Distribution Agent cannot run for some reason, a Subscriber could more easily run out of identities.</span></span>  
  
## <a name="assigning-ranges-for-manual-identity-range-management"></a><span data-ttu-id="f4f3a-180">Asignar intervalos para la administración manual del intervalo de identidad</span><span class="sxs-lookup"><span data-stu-id="f4f3a-180">Assigning ranges for manual identity range management</span></span>  
 <span data-ttu-id="f4f3a-181">Si especifica la administración manual del intervalo de identidad, debe asegurarse de que el publicador y todos los suscriptores utilizan intervalos de identidad diferentes.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-181">If you specify manual identity range management, you must ensure that the Publisher and each Subscriber use different identity ranges.</span></span> <span data-ttu-id="f4f3a-182">Por ejemplo, imagine una tabla en el publicador con una columna de identidad definida como `IDENTITY(1,1)`: la columna de identidad comienza en 1 y se incrementa en 1 cada vez que se inserta una fila.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-182">For example, consider a table at the Publisher with an identity column defined as `IDENTITY(1,1)`: the identity column starts at 1 and is incremented by 1 each time a row is inserted.</span></span> <span data-ttu-id="f4f3a-183">Si la tabla del publicador tiene 5.000 filas y prevé que aumentará durante la vida de la aplicación, el publicador podría utilizar el rango 1-10.000.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-183">If the table at the Publisher has 5,000 rows, and you expect some growth in the table over the life of the application, the Publisher could use the range 1-10,000.</span></span> <span data-ttu-id="f4f3a-184">Si hay dos suscriptores, el Suscriptor A podría usar el rango 10.001-20.000 y el Suscriptor B, el rango 20.001-30.000.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-184">Given two Subscribers, Subscriber A could use 10,001-20,000, and Subscriber B could use 20,001-30,000.</span></span>  
  
 <span data-ttu-id="f4f3a-185">Después de inicializar un suscriptor mediante una instantánea u otro medio, ejecute DBCC CHECKIDENT para asignarle al suscriptor un punto de partida para este intervalo de identidad.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-185">After a Subscriber is initialized with a snapshot or through another means, execute DBCC CHECKIDENT to assign the Subscriber a starting point for its identity range.</span></span> <span data-ttu-id="f4f3a-186">Por ejemplo, en el suscriptor A, ejecutaría `DBCC CHECKIDENT('<TableName>','reseed',10001)`.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-186">For example, at Subscriber A, you would execute `DBCC CHECKIDENT('<TableName>','reseed',10001)`.</span></span> <span data-ttu-id="f4f3a-187">En el suscriptor B, ejecutaría `CHECKIDENT('<TableName>','reseed',20001)`.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-187">At Subscriber B, you would execute `CHECKIDENT('<TableName>','reseed',20001)`.</span></span>  
  
 <span data-ttu-id="f4f3a-188">Para asignar nuevos intervalos en el publicador o en los suscriptores, ejecute DBCC CHECKIDENT y especifique un valor nuevo para regenerar la tabla.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-188">To assign new ranges to the Publisher or Subscribers, execute DBCC CHECKIDENT and specify a new value to reseed the table.</span></span> <span data-ttu-id="f4f3a-189">Debería encontrar una manera de determinar cuándo se debe asignar un intervalo nuevo.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-189">You should have some way to determine when a new range must be assigned.</span></span> <span data-ttu-id="f4f3a-190">Por ejemplo, su aplicación podría tener un mecanismo que detectara si un nodo va a consumir su intervalo y asignarle uno nuevo utilizando DBCC CHECKIDENT.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-190">For example, your application could have a mechanism that detects when a node is about to use up its range and assign a new range using DBCC CHECKIDENT.</span></span> <span data-ttu-id="f4f3a-191">También puede agregar una restricción CHECK para asegurarse de que no se pueda agregar una fila si va a ocasionar el uso de un valor fuera del intervalo de identidad.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-191">You can also add a check constraint to ensure that a row cannot be added if it would cause an out of range identity value to be used.</span></span>  
  
## <a name="handling-identity-ranges-after-a-database-restore"></a><span data-ttu-id="f4f3a-192">Controlar los intervalos de identidad tras la restauración de una base de datos</span><span class="sxs-lookup"><span data-stu-id="f4f3a-192">Handling Identity Ranges after a Database Restore</span></span>  
 <span data-ttu-id="f4f3a-193">Si está utilizando la administración automática del intervalo de identidad, cuando un suscriptor se restaura de una copia de seguridad, automáticamente solicita un nuevo intervalo de valores de identidad.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-193">If you are using automatic identity range management, when a Subscriber is restored from a backup, it automatically requests a new range of identity values.</span></span> <span data-ttu-id="f4f3a-194">Si un publicador se restaura de una copia de seguridad, debe asegurarse de que al publicador se le ha asignado un intervalo adecuado.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-194">If a Publisher is restored from a backup, you must ensure that the Publisher is assigned an appropriate range.</span></span> <span data-ttu-id="f4f3a-195">Para la replicación de mezcla, asigne un nuevo intervalo con [sp_restoremergeidentityrange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-restoremergeidentityrange-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f4f3a-195">For merge replication, assign a new range using [sp_restoremergeidentityrange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-restoremergeidentityrange-transact-sql).</span></span> <span data-ttu-id="f4f3a-196">En la replicación transaccional, determine el valor más alto que se ha utilizado y después establezca el punto de partida para nuevos intervalos.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-196">For transactional replication, determine the highest value that has been used and then set the starting point for new ranges.</span></span> <span data-ttu-id="f4f3a-197">Utilice el siguiente procedimiento después de la restauración de la base de datos de publicaciones:</span><span class="sxs-lookup"><span data-stu-id="f4f3a-197">Use the following procedure after the publication database has been restored:</span></span>  
  
1.  <span data-ttu-id="f4f3a-198">Detenga todas las actividades en todos los suscriptores.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-198">Stop all activity on all Subscribers.</span></span>  
  
2.  <span data-ttu-id="f4f3a-199">Por cada tabla publicada que incluya una columna de identidad:</span><span class="sxs-lookup"><span data-stu-id="f4f3a-199">For each published table that includes an identity column:</span></span>  
  
    1.  <span data-ttu-id="f4f3a-200">En la base de datos de suscripciones en cada suscriptor, ejecute `IDENT_CURRENT('<TableName>')`.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-200">In the subscription database at each Subscriber, execute `IDENT_CURRENT('<TableName>')`.</span></span>  
  
    2.  <span data-ttu-id="f4f3a-201">Registre el valor más alto encontrado en todos los suscriptores.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-201">Record the highest value found across all Subscribers.</span></span>  
  
    3.  <span data-ttu-id="f4f3a-202">En la base de datos de publicaciones en el publicador, ejecute `DBCC CHECKIDENT(<TableName>','reseed',<HighestValueFound+1>`.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-202">In the publication database at the Publisher, execute `DBCC CHECKIDENT(<TableName>','reseed',<HighestValueFound+1>`).</span></span>  
  
    4.  <span data-ttu-id="f4f3a-203">En la base de datos de publicaciones en el publicador, ejecute `sp_adjustpublisheridentityrange <PublicationName>, <TableName>`.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-203">In the publication database at the Publisher, execute `sp_adjustpublisheridentityrange <PublicationName>, <TableName>`.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="f4f3a-204">Si el valor de la columna de identidad está establecido para que se reduzca y no para que se incremente, registre el valor más bajo encontrado y regenere con ese valor.</span><span class="sxs-lookup"><span data-stu-id="f4f3a-204">If the value in the identity column is set to decrement rather than increment, record the lowest value found, and then reseed with that value.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f4f3a-205">Consulte también</span><span class="sxs-lookup"><span data-stu-id="f4f3a-205">See Also</span></span>  
 <span data-ttu-id="f4f3a-206">[BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="f4f3a-206">[BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql) </span></span>  
 <span data-ttu-id="f4f3a-207">[DBCC CHECKIDENT &#40;Transact-SQL&#41;](/sql/t-sql/database-console-commands/dbcc-checkident-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="f4f3a-207">[DBCC CHECKIDENT &#40;Transact-SQL&#41;](/sql/t-sql/database-console-commands/dbcc-checkident-transact-sql) </span></span>  
 <span data-ttu-id="f4f3a-208">[IDENT_CURRENT &#40;Transact-SQL&#41;](/sql/t-sql/functions/ident-current-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="f4f3a-208">[IDENT_CURRENT &#40;Transact-SQL&#41;](/sql/t-sql/functions/ident-current-transact-sql) </span></span>  
 <span data-ttu-id="f4f3a-209">[IDENTITY &#40;propiedad&#41; &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-table-transact-sql-identity-property) </span><span class="sxs-lookup"><span data-stu-id="f4f3a-209">[IDENTITY &#40;Property&#41; &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-table-transact-sql-identity-property) </span></span>  
 [<span data-ttu-id="f4f3a-210">sp_adjustpublisheridentityrange &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="f4f3a-210">sp_adjustpublisheridentityrange &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-stored-procedures/sp-adjustpublisheridentityrange-transact-sql)  
  
  
