---
title: Restaurar una base de datos de SQL Server a un momento dado (modelo de recuperación completa) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- STOPAT clause [RESTORE LOG statement]
- point in time recovery [SQL Server]
- restoring databases [SQL Server], point in time
ms.assetid: 3a5daefd-08a8-4565-b54f-28ad01a47d32
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 0c71ff6e75cbbf27042c1eac70b1f97076290865
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87675458"
---
# <a name="restore-a-sql-server-database-to-a-point-in-time-full-recovery-model"></a><span data-ttu-id="a72bb-102">Restaurar una base de datos de SQL Server a un momento dado (modelo de recuperación completa)</span><span class="sxs-lookup"><span data-stu-id="a72bb-102">Restore a SQL Server Database to a Point in Time (Full Recovery Model)</span></span>
  <span data-ttu-id="a72bb-103">En este tema se describe cómo restaurar una base de datos a un momento dado en [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] mediante [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] o [!INCLUDE[tsql](../../includes/tsql-md.md)].</span><span class="sxs-lookup"><span data-stu-id="a72bb-103">This topic describes how to restore a database to a point in time in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] or [!INCLUDE[tsql](../../includes/tsql-md.md)].</span></span> <span data-ttu-id="a72bb-104">Este tema solo es pertinente para las bases de datos de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] que usan los modelos de recuperación optimizados para cargas masivas de registros.</span><span class="sxs-lookup"><span data-stu-id="a72bb-104">This topic is relevant only for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] databases that use the full or bulk-logged recovery models.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="a72bb-105">En el modelo de recuperación optimizado para cargas masivas de registros, si la copia de seguridad de registros contiene cambios registrados de forma masiva, no es posible la recuperación a un momento dado de la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="a72bb-105">Under the bulk-logged recovery model, if a log backup contains bulk-logged changes, point-in-time recovery is not possible to a point within that backup.</span></span> <span data-ttu-id="a72bb-106">La base de datos debe recuperarse al final de la copia de seguridad del registro de transacciones.</span><span class="sxs-lookup"><span data-stu-id="a72bb-106">The database must be recovered to the end of the transaction log backup.</span></span>  
  
-   <span data-ttu-id="a72bb-107">**Antes de empezar:**</span><span class="sxs-lookup"><span data-stu-id="a72bb-107">**Before you begin:**</span></span>  
  
     [<span data-ttu-id="a72bb-108">Recomendaciones</span><span class="sxs-lookup"><span data-stu-id="a72bb-108">Recommendations</span></span>](#Recommendations)  
  
     [<span data-ttu-id="a72bb-109">Seguridad</span><span class="sxs-lookup"><span data-stu-id="a72bb-109">Security</span></span>](#Security)  
  
-   <span data-ttu-id="a72bb-110">**Para restaurar una base de datos de SQL Server a un momento dado, mediante:**</span><span class="sxs-lookup"><span data-stu-id="a72bb-110">**To restore a SQL Server database to a point in time, using:**</span></span>  
  
     [<span data-ttu-id="a72bb-111">SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="a72bb-111">SQL Server Management Studio</span></span>](#SSMSProcedure)  
  
     [<span data-ttu-id="a72bb-112">Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="a72bb-112">Transact-SQL</span></span>](#TsqlProcedure)  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="a72bb-113">Antes de comenzar</span><span class="sxs-lookup"><span data-stu-id="a72bb-113">Before You Begin</span></span>  
  
###  <a name="recommendations"></a><a name="Recommendations"></a> <span data-ttu-id="a72bb-114">Recomendaciones</span><span class="sxs-lookup"><span data-stu-id="a72bb-114">Recommendations</span></span>  
  
-   <span data-ttu-id="a72bb-115">Usar STANDBY para encontrar un momento dado desconocido.</span><span class="sxs-lookup"><span data-stu-id="a72bb-115">Use STANDBY to find unknown point in time.</span></span>  
  
-   <span data-ttu-id="a72bb-116">Especificar el momento dado al principio de una secuencia de restauración.</span><span class="sxs-lookup"><span data-stu-id="a72bb-116">Specify the point in time early in a restore sequence</span></span>  
  
###  <a name="security"></a><a name="Security"></a> <span data-ttu-id="a72bb-117">Seguridad</span><span class="sxs-lookup"><span data-stu-id="a72bb-117">Security</span></span>  
  
####  <a name="permissions"></a><a name="Permissions"></a> <span data-ttu-id="a72bb-118">Permisos</span><span class="sxs-lookup"><span data-stu-id="a72bb-118">Permissions</span></span>  
 <span data-ttu-id="a72bb-119">Si la base de datos que se va a restaurar no existe, el usuario debe tener permisos CREATE DATABASE para poder ejecutar RESTORE.</span><span class="sxs-lookup"><span data-stu-id="a72bb-119">If the database being restored does not exist, the user must have CREATE DATABASE permissions to be able to execute RESTORE.</span></span> <span data-ttu-id="a72bb-120">Si la base de datos existe, los permisos RESTORE corresponden de forma predeterminada a los miembros de los roles fijos de servidor **sysadmin** y **dbcreator** , y al propietario (**dbo**) de la base de datos (para la opción FROM DATABASE_SNAPSHOT, la base de datos siempre existe).</span><span class="sxs-lookup"><span data-stu-id="a72bb-120">If the database exists, RESTORE permissions default to members of the **sysadmin** and **dbcreator** fixed server roles and the owner (**dbo**) of the database (for the FROM DATABASE_SNAPSHOT option, the database always exists).</span></span>  
  
 <span data-ttu-id="a72bb-121">Los permisos RESTORE se conceden a los roles en los que la información acerca de la pertenencia está siempre disponible para el servidor.</span><span class="sxs-lookup"><span data-stu-id="a72bb-121">RESTORE permissions are given to roles in which membership information is always readily available to the server.</span></span> <span data-ttu-id="a72bb-122">Debido a que la pertenencia a un rol fijo de base de datos solo se puede comprobar cuando la base de datos es accesible y no está dañada, lo que no siempre ocurre cuando se ejecuta RESTORE, los miembros del rol fijo de base de datos **db_owner** no tienen permisos RESTORE.</span><span class="sxs-lookup"><span data-stu-id="a72bb-122">Because fixed database role membership can be checked only when the database is accessible and undamaged, which is not always the case when RESTORE is executed, members of the **db_owner** fixed database role do not have RESTORE permissions.</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="a72bb-123">Uso de SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="a72bb-123">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="a72bb-124">**Para restaurar una base de datos a un momento dado**</span><span class="sxs-lookup"><span data-stu-id="a72bb-124">**To restore a database to a point in time**</span></span>  
  
1.  <span data-ttu-id="a72bb-125">En el Explorador de objetos, conéctese a la instancia adecuada de [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)]y expanda el árbol de servidores.</span><span class="sxs-lookup"><span data-stu-id="a72bb-125">In Object Explorer, connect to the appropriate instance of the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)], and expand the server tree.</span></span>  
  
2.  <span data-ttu-id="a72bb-126">Expanda **Bases de datos**.</span><span class="sxs-lookup"><span data-stu-id="a72bb-126">Expand **Databases**.</span></span> <span data-ttu-id="a72bb-127">En función de la base de datos, seleccione una base de datos de usuario o expanda **Bases de datos del sistema**y, a continuación, seleccione una base de datos del sistema.</span><span class="sxs-lookup"><span data-stu-id="a72bb-127">Depending on the database, either select a user database or expand **System Databases**, and then select a system database.</span></span>  
  
3.  <span data-ttu-id="a72bb-128">Haga clic con el botón derecho en la base de datos, seleccione **Tareas**, **Restaurar**y luego haga clic en **Base de datos**.</span><span class="sxs-lookup"><span data-stu-id="a72bb-128">Right-click the database, point to **Tasks**, point to **Restore**, and then click **Database**.</span></span>  
  
4.  <span data-ttu-id="a72bb-129">En la página **General** , use la sección **Origen** para especificar el origen y la ubicación de los conjuntos de copias de seguridad que se deben restaurar.</span><span class="sxs-lookup"><span data-stu-id="a72bb-129">On the **General** page, use the **Source** section to specify the source and location of the backup sets to restore.</span></span> <span data-ttu-id="a72bb-130">Seleccione una de las siguientes opciones:</span><span class="sxs-lookup"><span data-stu-id="a72bb-130">Select one of the following options:</span></span>  
  
    -   <span data-ttu-id="a72bb-131">**Base de datos**</span><span class="sxs-lookup"><span data-stu-id="a72bb-131">**Database**</span></span>  
  
         <span data-ttu-id="a72bb-132">Seleccione la base de datos que desea restaurar en la lista desplegable.</span><span class="sxs-lookup"><span data-stu-id="a72bb-132">Select the database to restore from the drop-down list.</span></span> <span data-ttu-id="a72bb-133">La lista solo contiene las bases de datos de las que se han realizado copias de seguridad de acuerdo con el historial de copias de seguridad de **msdb** .</span><span class="sxs-lookup"><span data-stu-id="a72bb-133">The list contains only databases that have been backed up according to the **msdb** backup history.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="a72bb-134">Si la copia de seguridad se toma desde un servidor diferente, el servidor de destino no tendrá la información del historial de copia de seguridad de la base de datos especificada.</span><span class="sxs-lookup"><span data-stu-id="a72bb-134">If the backup is taken from a different server, the destination server will not have the backup history information for the specified database.</span></span> <span data-ttu-id="a72bb-135">En este caso, seleccione **Dispositivo** para especificar manualmente el archivo o dispositivo que se va a restaurar.</span><span class="sxs-lookup"><span data-stu-id="a72bb-135">In this case, select **Device** to manually specify the file or device to restore.</span></span>  
  
    -   <span data-ttu-id="a72bb-136">**Dispositivo**</span><span class="sxs-lookup"><span data-stu-id="a72bb-136">**Device**</span></span>  
  
         <span data-ttu-id="a72bb-137">Haga clic en el botón de exploración ( **...** ) para abrir el cuadro de diálogo **Seleccionar dispositivos de copia de seguridad** .</span><span class="sxs-lookup"><span data-stu-id="a72bb-137">Click the browse (**...**) button to open the **Select backup devices** dialog box.</span></span> <span data-ttu-id="a72bb-138">En el cuadro **Tipo de medio de copia de seguridad** , seleccione uno de los tipos de dispositivo.</span><span class="sxs-lookup"><span data-stu-id="a72bb-138">In the **Backup media type** box, select one of the listed device types.</span></span> <span data-ttu-id="a72bb-139">Para seleccionar uno o varios dispositivos del cuadro **Medio de copia de seguridad** , haga clic en **Agregar**.</span><span class="sxs-lookup"><span data-stu-id="a72bb-139">To select one or more devices for the **Backup media** box, click **Add**.</span></span>  
  
         <span data-ttu-id="a72bb-140">Después de agregar los dispositivos que desee al cuadro de lista **Medio de copia de seguridad** , haga clic en **Aceptar** para volver a la página **General** .</span><span class="sxs-lookup"><span data-stu-id="a72bb-140">After you add the devices you want to the **Backup media** list box, click **OK** to return to the **General** page.</span></span>  
  
         <span data-ttu-id="a72bb-141">En el cuadro de lista **Origen: Dispositivo: Base de datos** , seleccione el nombre de la base de datos que se debe restaurar.</span><span class="sxs-lookup"><span data-stu-id="a72bb-141">In the **Source: Device: Database** list box, select the name of the database which should be restored.</span></span>  
  
         <span data-ttu-id="a72bb-142">**Nota** : esta lista solo está disponible cuando se selecciona **Dispositivo** .</span><span class="sxs-lookup"><span data-stu-id="a72bb-142">**Note** This list is only available when **Device** is selected.</span></span> <span data-ttu-id="a72bb-143">Solo estarán disponibles las bases de datos que tienen copias de seguridad en el dispositivo seleccionado.</span><span class="sxs-lookup"><span data-stu-id="a72bb-143">Only databases that have backups on the selected device will be available.</span></span>  
  
5.  <span data-ttu-id="a72bb-144">En la sección **Destino** , el cuadro **Base de datos** se rellena automáticamente con el nombre de la base de datos que se va a restaurar.</span><span class="sxs-lookup"><span data-stu-id="a72bb-144">In the **Destination** section, the **Database** box is automatically populated with the name of the database to be restored.</span></span> <span data-ttu-id="a72bb-145">Para cambiar el nombre de la base de datos, especifique el nuevo nombre en el cuadro **Base de datos** .</span><span class="sxs-lookup"><span data-stu-id="a72bb-145">To change the name of the database, enter the new name in the **Database** box.</span></span>  
  
6.  <span data-ttu-id="a72bb-146">Haga clic **Escala de tiempo** para tener acceso al cuadro de diálogo **Escala de tiempo de la copia de seguridad** .</span><span class="sxs-lookup"><span data-stu-id="a72bb-146">Click **Timeline** to access the **Backup Timeline** dialog box.</span></span>  
  
7.  <span data-ttu-id="a72bb-147">En la sección **Restaurar en** , haga clic **Fecha y hora específicas**.</span><span class="sxs-lookup"><span data-stu-id="a72bb-147">In the **Restore to** section, click **Specific date and time**.</span></span>  
  
8.  <span data-ttu-id="a72bb-148">Use los cuadros **Fecha** y **Hora** o la barra deslizante para especificar una fecha y una hora en las que debe detenerse la restauración.</span><span class="sxs-lookup"><span data-stu-id="a72bb-148">Use either the **Date** and **Time** boxes or the slider bar to specify a specific date and time to where the restore should stop.</span></span> [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
    > [!NOTE]  
    >  <span data-ttu-id="a72bb-149">Use el cuadro **Intervalo de escala de tiempo** para cambiar la cantidad de tiempo que se muestra en la escala de tiempo.</span><span class="sxs-lookup"><span data-stu-id="a72bb-149">Use the **Timeline Interval** box to change the amount of time displayed on the timeline.</span></span>  
  
9. <span data-ttu-id="a72bb-150">Tras especificar un momento específico, el Asesor para recuperación de base de datos se asegura de que solo estén seleccionadas en la columna **Restaurar** de la cuadrícula **Conjuntos de copia de seguridad para restaurar** las copias de seguridad necesarias para restaurar a ese momento dado.</span><span class="sxs-lookup"><span data-stu-id="a72bb-150">After you have specified a specific point in time, the Database Recovery Advisor ensures that only backups that are required for restoring to that point in time are selected in the **Restore** column of the **Backup sets to restore** grid.</span></span> <span data-ttu-id="a72bb-151">Estas copias de seguridad seleccionadas componen el plan de restauraciones recomendado para la restauración a un momento dado.</span><span class="sxs-lookup"><span data-stu-id="a72bb-151">These selected backups make up the recommended restore plan for your point-in-time restore.</span></span> <span data-ttu-id="a72bb-152">Solo deben utilizarse las copias de seguridad seleccionadas para la operación de restauración a un momento dado.</span><span class="sxs-lookup"><span data-stu-id="a72bb-152">You should use only the selected backups for your point-in-time restore operation.</span></span>  
  
     <span data-ttu-id="a72bb-153">Para obtener información sobre las columnas de la cuadrícula **Conjuntos de copia de seguridad que se van a restaurar** , vea [Restaurar la base de datos &#40;página General&#41;](../../integration-services/general-page-of-integration-services-designers-options.md)).</span><span class="sxs-lookup"><span data-stu-id="a72bb-153">For information about the columns in the **Backup sets to restore** grid, see [Restore Database &#40;General Page&#41;](../../integration-services/general-page-of-integration-services-designers-options.md).</span></span> <span data-ttu-id="a72bb-154">Para obtener más información sobre el Asistente para recuperación de base de datos, vea [Información general sobre restauración y recuperación &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="a72bb-154">For information about the Database Recovery Advisor, see [Restore and Recovery Overview &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md).</span></span>  
  
10. <span data-ttu-id="a72bb-155">En la página **Opciones** , en el panel **Opciones de restauración** , puede seleccionar una de las opciones siguientes si son apropiadas para su situación:</span><span class="sxs-lookup"><span data-stu-id="a72bb-155">On the **Options** page, in the **Restore options** panel, you can select any of the following options, if appropriate for your situation:</span></span>  
  
    -   <span data-ttu-id="a72bb-156">**Sobrescribir la base de datos existente (WITH REPLACE)**</span><span class="sxs-lookup"><span data-stu-id="a72bb-156">**Overwrite the existing database (WITH REPLACE)**</span></span>  
  
    -   <span data-ttu-id="a72bb-157">**Conservar la configuración de replicación (WITH KEEP_REPLICATION)**</span><span class="sxs-lookup"><span data-stu-id="a72bb-157">**Preserve the replication settings (WITH KEEP_REPLICATION)**</span></span>  
  
    -   <span data-ttu-id="a72bb-158">**Restringir el acceso a la base de datos restaurada (WITH RESTRICTED_USER)**</span><span class="sxs-lookup"><span data-stu-id="a72bb-158">**Restrict access to the restored database (WITH RESTRICTED_USER)**</span></span>  
  
     <span data-ttu-id="a72bb-159">Para obtener más información sobre estas opciones, vea [Restaurar base de datos &#40;página Opciones&#41;](restore-database-options-page.md).</span><span class="sxs-lookup"><span data-stu-id="a72bb-159">For more information about these options, see [Restore Database &#40;Options Page&#41;](restore-database-options-page.md).</span></span>  
  
11. <span data-ttu-id="a72bb-160">Seleccione una opción en el cuadro **Estado de recuperación** .</span><span class="sxs-lookup"><span data-stu-id="a72bb-160">Select an option for the **Recovery state** box.</span></span> <span data-ttu-id="a72bb-161">Este cuadro determina el estado de la base de datos después de la operación de restauración.</span><span class="sxs-lookup"><span data-stu-id="a72bb-161">This box determines the state of the database after the restore operation.</span></span>  
  
    -   <span data-ttu-id="a72bb-162">**RESTORE WITH RECOVERY** es el comportamiento predeterminado que deja la base de datos lista para usarse mediante la reversión de las transacciones no confirmadas.</span><span class="sxs-lookup"><span data-stu-id="a72bb-162">**RESTORE WITH RECOVERY** is the default behavior which leaves the database ready for use by rolling back the uncommitted transactions.</span></span> <span data-ttu-id="a72bb-163">No pueden restaurarse registros de transacciones adicionales.</span><span class="sxs-lookup"><span data-stu-id="a72bb-163">Additional transaction logs cannot be restored.</span></span> <span data-ttu-id="a72bb-164">Seleccione esta opción si va a restaurar ahora todas las copias de seguridad necesarias.</span><span class="sxs-lookup"><span data-stu-id="a72bb-164">Select this option if you are restoring all of the necessary backups now.</span></span>  
  
    -   <span data-ttu-id="a72bb-165">**RESTORE WITH NORECOVERY** deja la base de datos no operativa y no revierte las transacciones no confirmadas.</span><span class="sxs-lookup"><span data-stu-id="a72bb-165">**RESTORE WITH NORECOVERY** which leaves the database non-operational, and does not roll back the uncommitted transactions.</span></span> <span data-ttu-id="a72bb-166">Pueden restaurarse registros de transacciones adicionales.</span><span class="sxs-lookup"><span data-stu-id="a72bb-166">Additional transaction logs can be restored.</span></span> <span data-ttu-id="a72bb-167">La base de datos no puede se usar hasta que se recupera.</span><span class="sxs-lookup"><span data-stu-id="a72bb-167">The database cannot be used until it is recovered.</span></span>  
  
    -   <span data-ttu-id="a72bb-168">**RESTORE WITH STANDBY** deja la base de datos en modo de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="a72bb-168">**RESTORE WITH STANDBY** which leaves the database in read-only mode.</span></span> <span data-ttu-id="a72bb-169">Deshace las transacciones sin confirmar, pero guarda las acciones de deshacer en un archivo en espera para que los efectos de la recuperación puedan revertirse.</span><span class="sxs-lookup"><span data-stu-id="a72bb-169">It undoes uncommitted transactions, but saves the undo actions in a standby file so that recovery effects can be reverted.</span></span>  
  
     <span data-ttu-id="a72bb-170">Para obtener descripciones de las opciones, consulte [Restaurar base de datos &#40;página Opciones&#41;](restore-database-options-page.md).</span><span class="sxs-lookup"><span data-stu-id="a72bb-170">For descriptions of the options, see [Restore Database &#40;Options Page&#41;](restore-database-options-page.md).</span></span>  
  
12. <span data-ttu-id="a72bb-171">**Realizar copia del final del registro de la cola antes de la restauración** se seleccionará si es necesario en el momento dado que ha seleccionado.</span><span class="sxs-lookup"><span data-stu-id="a72bb-171">**Take tail-log backup before restore** will be selected if it is necessary for the point in time that you have selected.</span></span> <span data-ttu-id="a72bb-172">No es necesario modificar este valor, pero puede optar por realizar la copia del final del registro incluso si no es necesario.</span><span class="sxs-lookup"><span data-stu-id="a72bb-172">You do not need to modify this setting, but you can choose to backup the tail of the log even if it is not required.</span></span>  
  
13. <span data-ttu-id="a72bb-173">Puede haber errores en las operaciones de restauración si hay conexiones activas con la base de datos.</span><span class="sxs-lookup"><span data-stu-id="a72bb-173">Restore operations may fail if there are active connections to the database.</span></span> <span data-ttu-id="a72bb-174">Active la opción **Cerrar conexiones existentes** para asegurarse de que se cierren todas las conexiones activas entre [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] y la base de datos.</span><span class="sxs-lookup"><span data-stu-id="a72bb-174">Check the **Close existing connections option** to ensure that all active connections between [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] and the database are closed.</span></span> <span data-ttu-id="a72bb-175">Esta casilla establece la base de datos en modo de usuario único antes de realizar las operaciones de restauración, y establece la base de datos en modo multiusuario una vez completadas.</span><span class="sxs-lookup"><span data-stu-id="a72bb-175">This check box sets the database to single user mode before performing the restore operations, and sets the database to multi-user mode when complete.</span></span>  
  
14. <span data-ttu-id="a72bb-176">Seleccione **Preguntar antes de restaurar cada copia de seguridad** si desea que se le pregunte en cada operación de restauración.</span><span class="sxs-lookup"><span data-stu-id="a72bb-176">Select **Prompt before restoring each backup** if you wish to be prompted between each restore operation.</span></span> <span data-ttu-id="a72bb-177">No suele ser necesario a menos que la base de datos sea grande y desee supervisar el estado de la operación de restauración.</span><span class="sxs-lookup"><span data-stu-id="a72bb-177">This is not usually necessary unless the database is large and you wish to monitor the status of the restore operation.</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="a72bb-178">Usar Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="a72bb-178">Using Transact-SQL</span></span>  
 <span data-ttu-id="a72bb-179">**Antes de empezar**</span><span class="sxs-lookup"><span data-stu-id="a72bb-179">**Before you begin**</span></span>  
  
 <span data-ttu-id="a72bb-180">La restauración a un momento específico siempre se realiza a partir de una copia de seguridad de registros.</span><span class="sxs-lookup"><span data-stu-id="a72bb-180">A specified time is always restored from a log backup.</span></span> <span data-ttu-id="a72bb-181">En cada instrucción RESTORE LOG de la secuencia de restauración, debe especificar el momento de destino o transacción en una cláusula STOPAT idéntica.</span><span class="sxs-lookup"><span data-stu-id="a72bb-181">In every RESTORE LOG statement of the restore sequence, you must specify your target time or transaction in an identical STOPAT clause.</span></span> <span data-ttu-id="a72bb-182">Como requisito previo para la restauración a un momento específico, debe restaurar primero una copia de seguridad completa de la base de datos cuyo punto final sea anterior al momento de restauración de destino.</span><span class="sxs-lookup"><span data-stu-id="a72bb-182">As a prerequisite to a point-in-time restore, you must first restore a full database backup whose end point is earlier than your target restore time.</span></span> <span data-ttu-id="a72bb-183">La copia de seguridad completa de la base de datos puede ser anterior a la copia de seguridad completa de la base de datos más reciente siempre y cuando restaure cada copia de seguridad del registro siguiente, hasta la copia de seguridad del registro que contiene el momento específico de destino, inclusive.</span><span class="sxs-lookup"><span data-stu-id="a72bb-183">That full database backup can be older than the most recent full database backup as long as you then restore every subsequent log backup, up to and including the log backup that contains your target point in time.</span></span>  
  
 <span data-ttu-id="a72bb-184">Para ayudarle a identificar qué copia de seguridad de base de datos debe restaurar, puede especificar opcionalmente la cláusula WITH STOPAT en la instrucción RESTORE DATABASE para que se produzca un error si una copia de seguridad de los datos es demasiado reciente para el momento específico de destino.</span><span class="sxs-lookup"><span data-stu-id="a72bb-184">To help you identify which database backup to restore, you can optionally specify your WITH STOPAT clause in your RESTORE DATABASE statement to raise an error if a data backup is too recent for the specified target time.</span></span> <span data-ttu-id="a72bb-185">La copia de seguridad completa de los datos se restaura siempre, aunque contenga el momento de destino.</span><span class="sxs-lookup"><span data-stu-id="a72bb-185">The complete data backup is always restored, even if it contains the target time.</span></span>  
  
 <span data-ttu-id="a72bb-186">**Sintaxis básica de [!INCLUDE[tsql](../../includes/tsql-md.md)]**</span><span class="sxs-lookup"><span data-stu-id="a72bb-186">**Basic [!INCLUDE[tsql](../../includes/tsql-md.md)] syntax**</span></span>  
  
 <span data-ttu-id="a72bb-187">Restaurar *database_name* de registro desde <backup_device> con STOPAT \*\* = *`time`* ,\*\* Recovery...</span><span class="sxs-lookup"><span data-stu-id="a72bb-187">RESTORE LOG *database_name* FROM <backup_device> WITH STOPAT **=*`time`*,** RECOVERY...</span></span>  
  
 <span data-ttu-id="a72bb-188">El punto de recuperación es la última confirmación de transacción que se produjo en o antes del `datetime` valor especificado por *Time*.</span><span class="sxs-lookup"><span data-stu-id="a72bb-188">The recovery point is the latest transaction commit that occurred at or before the `datetime` value that is specified by *time*.</span></span>  
  
 <span data-ttu-id="a72bb-189">Para restaurar únicamente las modificaciones realizadas antes de un momento concreto, especifique WITH STOPAT **=** *hora* para cada copia de seguridad que restaure.</span><span class="sxs-lookup"><span data-stu-id="a72bb-189">To restore only the modifications that were made before a specific point in time, specify WITH STOPAT **=** *time* for each backup you restore.</span></span> <span data-ttu-id="a72bb-190">Esto garantiza que no se pasará el momento de destino.</span><span class="sxs-lookup"><span data-stu-id="a72bb-190">This makes sure that you do not go past the target time.</span></span>  
  
 <span data-ttu-id="a72bb-191">**Para restaurar una base de datos a un momento dado**</span><span class="sxs-lookup"><span data-stu-id="a72bb-191">**To restore a database to a point in time**</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="a72bb-192">Para ver un ejemplo de este procedimiento, vea [Ejemplo (Transact-SQL)](#TsqlExample)más adelante en esta sección.</span><span class="sxs-lookup"><span data-stu-id="a72bb-192">For an example of this procedure, see [Example (Transact-SQL)](#TsqlExample), later in this section.</span></span>  
  
1.  <span data-ttu-id="a72bb-193">Conéctese a la instancia de servidor en la que desea restaurar la base de datos.</span><span class="sxs-lookup"><span data-stu-id="a72bb-193">Connect to server instance on which you want to restore the database.</span></span>  
  
2.  <span data-ttu-id="a72bb-194">Ejecute la instrucción RESTORE DATABASE con la opción NORECOVERY.</span><span class="sxs-lookup"><span data-stu-id="a72bb-194">Execute the RESTORE DATABASE statement using the NORECOVERY option.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="a72bb-195">Si una secuencia de restauración parcial excluye cualquier grupo de archivos [FILESTREAM](../blob/filestream-sql-server.md) , no se admite la restauración a un momento dado.</span><span class="sxs-lookup"><span data-stu-id="a72bb-195">If a partial restore sequence excludes any [FILESTREAM](../blob/filestream-sql-server.md) filegroup, point-in-time restore is not supported.</span></span> <span data-ttu-id="a72bb-196">Puede forzarse la continuación de la secuencia de restauración.</span><span class="sxs-lookup"><span data-stu-id="a72bb-196">You can force the restore sequence to continue.</span></span> <span data-ttu-id="a72bb-197">Sin embargo, no se podrán restaurar los grupos de archivos FILESTREAM omitidos en la instrucción RESTORE.</span><span class="sxs-lookup"><span data-stu-id="a72bb-197">However the FILESTREAM filegroups that are omitted from your RESTORE statement can never be restored.</span></span> <span data-ttu-id="a72bb-198">Para forzar una restauración a un momento específico, especifique la opción CONTINUE_AFTER_ERROR junto con la opción STOPAT, STOPATMARK o STOPBEFOREMARK, que debe especificar también en las instrucciones RESTORE LOG siguientes.</span><span class="sxs-lookup"><span data-stu-id="a72bb-198">To force a point-in-time restore, specify the CONTINUE_AFTER_ERROR option together with the STOPAT, STOPATMARK, or STOPBEFOREMARK option, which you must also specify in your subsequent RESTORE LOG statements.</span></span> <span data-ttu-id="a72bb-199">Si se especifica CONTINUE_AFTER_ERROR, la secuencia de restauración parcial será correcta y el grupo de archivos FILESTREAM no será recuperable.</span><span class="sxs-lookup"><span data-stu-id="a72bb-199">If you specify CONTINUE_AFTER_ERROR, the partial restore sequence succeeds and the FILESTREAM filegroup becomes unrecoverable.</span></span>  
  
3.  <span data-ttu-id="a72bb-200">Restaure la última copia de seguridad de base de datos diferencial, si la hubiera, sin recuperar la base de datos (RESTORE DATABASE *database_name* FROM *backup_device* WITH NORECOVERY).</span><span class="sxs-lookup"><span data-stu-id="a72bb-200">Restore the last differential database backup, if any,  without recovering the database (RESTORE DATABASE *database_name* FROM *backup_device* WITH NORECOVERY).</span></span>  
  
4.  <span data-ttu-id="a72bb-201">Aplique cada copia de seguridad del registro de transacciones en la misma secuencia en la que se crearon, especificando la hora a la que desea detener la restauración del registro (restore database *database_name* de <backup_device> con STOPAT\*\* = *`time`* ,\*\* Recovery).</span><span class="sxs-lookup"><span data-stu-id="a72bb-201">Apply each transaction log backup in the same sequence in which they were created, specifying the time at which you intend to stop restoring log (RESTORE DATABASE *database_name* FROM <backup_device> WITH STOPAT**=*`time`*,** RECOVERY).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="a72bb-202">Las opciones RECOVERY y STOPAT.</span><span class="sxs-lookup"><span data-stu-id="a72bb-202">The RECOVERY and STOPAT options.</span></span> <span data-ttu-id="a72bb-203">Si la copia de seguridad de registros de transacciones no contiene la hora solicitada (por ejemplo, si la hora especificada está fuera de los límites del intervalo cubierto por el registro de transacciones), se genera una advertencia y no se recupera la base de datos.</span><span class="sxs-lookup"><span data-stu-id="a72bb-203">If the transaction log backup does not contain the requested time (for example, if the time specified is beyond the end of the time covered by the transaction log), a warning is generated and the database remains unrecovered.</span></span>  
  
###  <a name="example-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="a72bb-204">Ejemplo (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="a72bb-204">Example (Transact-SQL)</span></span>  
 <span data-ttu-id="a72bb-205">En el ejemplo siguiente se restaura una base de datos al estado en que se encontraba a las `12:00 AM` del `April 15, 2020` y se muestra una operación de restauración que implica varias copias de seguridad de registros.</span><span class="sxs-lookup"><span data-stu-id="a72bb-205">The following example restores a database to its state as of `12:00 AM` on `April 15, 2020` and shows a restore operation that involves multiple log backups.</span></span> <span data-ttu-id="a72bb-206">En el dispositivo de copia de seguridad, `AdventureWorksBackups`, la copia de seguridad de base de datos completa que se va a restaurar es el tercer conjunto de copia de seguridad en el dispositivo (`FILE = 3`), la primera copia de seguridad de registros es el cuarto conjunto de copia de seguridad (`FILE = 4`) y la segunda copia de seguridad de registros es el quinto conjunto de copia de seguridad (`FILE = 5`).</span><span class="sxs-lookup"><span data-stu-id="a72bb-206">On the backup device, `AdventureWorksBackups`, the full database backup to be restored is the third backup set on the device (`FILE = 3`), the first log backup is the fourth backup set (`FILE = 4`), and the second log backup is the fifth backup set (`FILE = 5`).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="a72bb-207">La base de datos [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] utiliza el modelo de recuperación simple.</span><span class="sxs-lookup"><span data-stu-id="a72bb-207">The [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] database uses the simple recovery model.</span></span> <span data-ttu-id="a72bb-208">Con el fin de permitir copias de seguridad de registros, antes de realizar una copia de seguridad completa de la base de datos, la base de datos se ha configurado para usar el modelo de recuperación completa mediante `ALTER DATABASE AdventureWorks SET RECOVERY FULL`.</span><span class="sxs-lookup"><span data-stu-id="a72bb-208">To permit log backups, before taking a full database backup, the database was set to use the full recovery model, using `ALTER DATABASE AdventureWorks SET RECOVERY FULL`.</span></span>  
  
```  
RESTORE DATABASE AdventureWorks  
   FROM AdventureWorksBackups  
   WITH FILE=3, NORECOVERY;  
  
RESTORE LOG AdventureWorks  
   FROM AdventureWorksBackups  
   WITH FILE=4, NORECOVERY, STOPAT = 'Apr 15, 2020 12:00 AM';  
  
RESTORE LOG AdventureWorks  
   FROM AdventureWorksBackups  
   WITH FILE=5, NORECOVERY, STOPAT = 'Apr 15, 2020 12:00 AM';  
RESTORE DATABASE AdventureWorks WITH RECOVERY;   
GO  
  
```  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="a72bb-209">Tareas relacionadas</span><span class="sxs-lookup"><span data-stu-id="a72bb-209">Related Tasks</span></span>  
  
-   [<span data-ttu-id="a72bb-210">Restaurar una copia de seguridad de base de datos &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="a72bb-210">Restore a Database Backup &#40;SQL Server Management Studio&#41;</span></span>](restore-a-database-backup-using-ssms.md)  
  
-   [<span data-ttu-id="a72bb-211">Realizar una copia de seguridad de un registro de transacciones &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="a72bb-211">Back Up a Transaction Log &#40;SQL Server&#41;</span></span>](back-up-a-transaction-log-sql-server.md)  
  
-   [<span data-ttu-id="a72bb-212">Restaurar una base de datos según el punto de error en el modelo de recuperación completa &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="a72bb-212">Restore a Database to the Point of Failure Under the Full Recovery Model &#40;Transact-SQL&#41;</span></span>](restore-database-to-point-of-failure-full-recovery.md)  
  
-   [<span data-ttu-id="a72bb-213">Restaurar una base de datos en una transacción marcada &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="a72bb-213">Restore a Database to a Marked Transaction &#40;SQL Server Management Studio&#41;</span></span>](restore-a-database-to-a-marked-transaction-sql-server-management-studio.md)  
  
-   [<span data-ttu-id="a72bb-214">Recuperar a un número de secuencia de registro &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="a72bb-214">Recover to a Log Sequence Number &#40;SQL Server&#41;</span></span>](recover-to-a-log-sequence-number-sql-server.md)  
  
## <a name="see-also"></a><span data-ttu-id="a72bb-215">Consulte también</span><span class="sxs-lookup"><span data-stu-id="a72bb-215">See Also</span></span>  
 <span data-ttu-id="a72bb-216">[backupset &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/backupset-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="a72bb-216">[backupset &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/backupset-transact-sql) </span></span>  
 <span data-ttu-id="a72bb-217">[RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="a72bb-217">[RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql) </span></span>  
 [<span data-ttu-id="a72bb-218">RESTORE HEADERONLY &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="a72bb-218">RESTORE HEADERONLY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/restore-statements-headeronly-transact-sql)  
  
  
