---
title: Restauraciones por etapas (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- partial updates [SQL Server]
- staged restores [SQL Server]
- piecemeal restores [SQL Server]
- restoring [SQL Server], piecemeal restore scenario
ms.assetid: 208f55e0-0762-4cfb-85c4-d36a76ea0f5b
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: ebc4ea11780908f847946a01338571211b57678a
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87745833"
---
# <a name="piecemeal-restores-sql-server"></a><span data-ttu-id="22244-102">Restauraciones por etapas (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="22244-102">Piecemeal Restores (SQL Server)</span></span>
  <span data-ttu-id="22244-103">Este tema es pertinente solo para las bases de datos de la edición Enterprise de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] que incluyen varios archivos o grupos de archivos y, en el modelo simple, únicamente para grupos de archivos de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="22244-103">This topic is relevant only for databases in the Enterprise edition of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that contain multiple files or filegroups; and, under the simple model, only for read-only filegroups.</span></span>  
  
 <span data-ttu-id="22244-104">Para obtener información sobre la restauración por etapas y las tablas optimizadas para memoria, vea [Restauración por etapas de bases de datos con tablas optimizadas para memoria](../in-memory-oltp/memory-optimized-tables.md).</span><span class="sxs-lookup"><span data-stu-id="22244-104">For information about piecemeal restore and memory-optimized tables, see [Piecemeal Restore of Databases With Memory-Optimized Tables](../in-memory-oltp/memory-optimized-tables.md).</span></span>  
  
 <span data-ttu-id="22244-105">La*restauración por etapas* , permite la restauración y recuperación en fases de las bases de datos que contienen varios grupos de archivos.</span><span class="sxs-lookup"><span data-stu-id="22244-105">*Piecemeal restore* allows databases that contain multiple filegroups to be restored and recovered in stages.</span></span> <span data-ttu-id="22244-106">Este tipo de restauración implica una serie de secuencias de restauración, empezando por el grupo de archivos principal y, en algunos casos, uno o varios grupos de archivos secundarios.</span><span class="sxs-lookup"><span data-stu-id="22244-106">Piecemeal restore involves a series of restore sequences, starting with the primary filegroup and, in some cases, one or more secondary filegroups.</span></span> <span data-ttu-id="22244-107">La restauración por etapas mantiene comprobaciones para garantizar que, al final, la base de datos será coherente.</span><span class="sxs-lookup"><span data-stu-id="22244-107">Piecemeal restore maintains checks to ensure that the database will be consistent in the end.</span></span> <span data-ttu-id="22244-108">Una vez completada la secuencia de restauración, los archivos recuperados (si son válidos y coherentes con la base de datos) pueden ponerse en línea directamente.</span><span class="sxs-lookup"><span data-stu-id="22244-108">After the restore sequence is completed, recovered files, if they are valid and consistent with the database, can be brought online directly.</span></span>  
  
 <span data-ttu-id="22244-109">La restauración por etapas funciona con todos los modelos de recuperación, pero su flexibilidad es mayor para los modelos de recuperación optimizado para cargas masivas de registros y completo que para el modelo de recuperación simple.</span><span class="sxs-lookup"><span data-stu-id="22244-109">Piecemeal restore works with all recovery models, but is more flexible for the full and bulk-logged models than for the simple model.</span></span>  
  
 <span data-ttu-id="22244-110">Las restauraciones por etapas empiezan con una secuencia de restauración inicial que se denomina *secuencia de restauración parcial*.</span><span class="sxs-lookup"><span data-stu-id="22244-110">Every piecemeal restore starts with an initial restore sequence called the *partial-restore sequence*.</span></span> <span data-ttu-id="22244-111">Como mínimo, la secuencia de restauración parcial restaura y recupera el grupo de archivos principal y, con el modelo de recuperación simple, todos los grupos de archivos de lectura/escritura.</span><span class="sxs-lookup"><span data-stu-id="22244-111">Minimally, the partial-restore sequence restores and recovers the primary filegroup and, under the simple recovery model, all read/write filegroups.</span></span> <span data-ttu-id="22244-112">Durante la secuencia de restauración por etapas, toda la base de datos debe ponerse en modo sin conexión.</span><span class="sxs-lookup"><span data-stu-id="22244-112">During the piecemeal-restore sequence, the whole database must go offline.</span></span> <span data-ttu-id="22244-113">Después de este momento, la base de datos estará en línea y los grupos de archivos restaurados estarán disponibles.</span><span class="sxs-lookup"><span data-stu-id="22244-113">Thereafter, the database is online and restored filegroups are available.</span></span> <span data-ttu-id="22244-114">Sin embargo, los grupos de archivos no restaurados permanecerán sin conexión y no estarán disponibles.</span><span class="sxs-lookup"><span data-stu-id="22244-114">However, any unrestored filegroups remain offline and are not accessible.</span></span> <span data-ttu-id="22244-115">No obstante, los grupos de archivos sin conexión se pueden restaurar y poner en línea más adelante mediante una restauración de archivos.</span><span class="sxs-lookup"><span data-stu-id="22244-115">Any offline filegroups, however, can be restored and brought online later by a file restore.</span></span>  
  
 <span data-ttu-id="22244-116">Independientemente del modelo de recuperación utilizado por la base de datos, la secuencia de restauración parcial se inicia con una instrucción RESTORE DATABASE que restaura una copia de seguridad completa y especifica la opción PARTIAL.</span><span class="sxs-lookup"><span data-stu-id="22244-116">Regardless of the recovery model that is used by the database, the partial-restore sequence starts with a RESTORE DATABASE statement that restores a full backup and specifies the PARTIAL option.</span></span> <span data-ttu-id="22244-117">La opción PARTIAL siempre inicia una nueva restauración por etapas; por lo tanto, se debe especificar PARTIAL únicamente una vez en la instrucción inicial de la secuencia de restauración parcial.</span><span class="sxs-lookup"><span data-stu-id="22244-117">The PARTIAL option always starts a new piecemeal restore; therefore, you must specify PARTIAL only one time in the initial statement of the partial-restore sequence.</span></span> <span data-ttu-id="22244-118">Cuando la secuencia de restauración parcial finaliza y la base de datos está en línea, a los archivos restantes se les asigna el estado "pendiente de recuperación" porque su recuperación se ha pospuesto.</span><span class="sxs-lookup"><span data-stu-id="22244-118">When the partial restore sequence finishes and the database is brought online, the state of the remaining files becomes "recovery pending" because their recovery has been postponed.</span></span>  
  
 <span data-ttu-id="22244-119">Posteriormente, una restauración por etapas suele incluir una o varias secuencias de restauración, que se denominan *secuencias de restauración de grupos de archivos*.</span><span class="sxs-lookup"><span data-stu-id="22244-119">Subsequently, a piecemeal restore typically includes one or more restore sequences, which are called *filegroup-restore sequences*.</span></span> <span data-ttu-id="22244-120">Se puede retrasar la realización de una secuencia de restauración de grupos de archivos concreta el tiempo que desee.</span><span class="sxs-lookup"><span data-stu-id="22244-120">You can wait to perform a specific filegroup-restore sequence for as long as you want.</span></span> <span data-ttu-id="22244-121">Estas secuencias restauran y recuperan uno o varios grupos de archivos sin conexión a un punto coherente con la base de datos.</span><span class="sxs-lookup"><span data-stu-id="22244-121">Each filegroup-restore sequence restores and recovers one or more offline filegroups to a point consistent with the database.</span></span> <span data-ttu-id="22244-122">La planeación y el número de secuencias de restauración de grupos de archivos depende del objetivo de recuperación, del número de grupos de archivos sin conexión que se desea restaurar y de cuántos de estos se restaurarán por secuencia de restauración de grupos de archivos.</span><span class="sxs-lookup"><span data-stu-id="22244-122">The timing and number of filegroup-restore sequences depends on your recovery goal, the number of offline filegroups you want to restore, and on how many of them you restore per filegroup-restore sequence.</span></span>  
  
 <span data-ttu-id="22244-123">Los requisitos concretos para realizar una restauración por etapas dependen del modelo de recuperación de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="22244-123">The exact requirements for performing a piecemeal restore depend on the recovery model of the database.</span></span> <span data-ttu-id="22244-124">Para obtener información, vea "	Restauración por etapas con el modelo de recuperación simple" y "Restauración por etapas con el modelo de recuperación completa", más adelante en este tema.</span><span class="sxs-lookup"><span data-stu-id="22244-124">For more information, see "Piecemeal Restore Under the Simple Recovery Model" and "Piecemeal Restore Under the Full Recovery Model," later in this topic.</span></span>  
  
## <a name="piecemeal-restore-scenarios"></a><span data-ttu-id="22244-125">Escenarios de restauración por etapas</span><span class="sxs-lookup"><span data-stu-id="22244-125">Piecemeal Restore Scenarios</span></span>  
 <span data-ttu-id="22244-126">Todas las ediciones de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] admiten restauraciones por etapas sin conexión.</span><span class="sxs-lookup"><span data-stu-id="22244-126">All editions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] support offline piecemeal restores.</span></span> <span data-ttu-id="22244-127">En la edición Enterprise, una restauración por etapas puede realizarse en línea o sin conexión.</span><span class="sxs-lookup"><span data-stu-id="22244-127">In the Enterprise edition, a piecemeal restore can be either online or offline.</span></span> <span data-ttu-id="22244-128">Las implicaciones de las restauraciones por etapas en línea y sin conexión son las siguientes:</span><span class="sxs-lookup"><span data-stu-id="22244-128">The implications of offline and online piecemeal restores are as follows:</span></span>  
  
-   <span data-ttu-id="22244-129">Escenario de restauración por etapas sin conexión</span><span class="sxs-lookup"><span data-stu-id="22244-129">Offline piecemeal restore scenario</span></span>  
  
     <span data-ttu-id="22244-130">En una restauración por etapas sin conexión, la base de datos está en línea después de la secuencia de restauración parcial.</span><span class="sxs-lookup"><span data-stu-id="22244-130">In an offline piecemeal restore, the database is online after the partial-restore sequence.</span></span> <span data-ttu-id="22244-131">Los grupos de archivos que aún no se han restaurado permanecen sin conexión, pero pueden restaurarse a medida que sean necesarios después de dejar la base de datos sin conexión.</span><span class="sxs-lookup"><span data-stu-id="22244-131">Filegroups that have not yet been restored remain offline, but they can be restored as you need them after taking the database offline.</span></span>  
  
-   <span data-ttu-id="22244-132">Escenario de restauración por etapas en línea</span><span class="sxs-lookup"><span data-stu-id="22244-132">Online piecemeal restore scenario</span></span>  
  
     <span data-ttu-id="22244-133">En una restauración por etapas en línea, tras secuencia de restauración parcial, la base de datos está en línea y el grupo de archivos principal y los grupos de archivos secundarios recuperados están disponibles.</span><span class="sxs-lookup"><span data-stu-id="22244-133">In an online piecemeal restore, after the partial-restore sequence, the database is online, and the primary filegroup and any recovered secondary filegroups are available.</span></span> <span data-ttu-id="22244-134">Los grupos de archivos que todavía no se han restaurado permanecen sin conexión, pero se pueden restaurar cuando sea necesario mientras la base de datos se encuentre en línea.</span><span class="sxs-lookup"><span data-stu-id="22244-134">Filegroups that have not yet been restored remain offline, but they can be restored as needed while the database remains online.</span></span>  
  
     <span data-ttu-id="22244-135">Las restauraciones por etapas en línea pueden incluir transacciones diferidas.</span><span class="sxs-lookup"><span data-stu-id="22244-135">Online piecemeal restores can involve deferred transactions.</span></span> <span data-ttu-id="22244-136">Cuando solo se restaura un subconjunto de grupos de archivos, puede que se difieran las transacciones de la base de datos que dependan de los grupos de archivos en línea.</span><span class="sxs-lookup"><span data-stu-id="22244-136">When only a subset of filegroups has been restored, transactions in the database that depend on online filegroups might become deferred.</span></span> <span data-ttu-id="22244-137">Esto es normal, porque toda la base de datos debe ser coherente.</span><span class="sxs-lookup"><span data-stu-id="22244-137">This is typical, because the whole database must be consistent.</span></span> <span data-ttu-id="22244-138">Para obtener más información, vea [Transacciones diferidas &#40;SQL Server&#41;](deferred-transactions-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="22244-138">For more information, see [Deferred Transactions &#40;SQL Server&#41;](deferred-transactions-sql-server.md).</span></span>  
  
-   [!INCLUDE[hek_1](../../includes/hek-1-md.md)] <span data-ttu-id="22244-139">escenario de restauración por etapas</span><span class="sxs-lookup"><span data-stu-id="22244-139">piecemeal restore scenario</span></span>  
  
     <span data-ttu-id="22244-140">Para obtener información sobre las restauraciones por etapas de bases de datos de OLTP en memoria, vea [Copias de seguridad y restauración por etapas de bases de datos con tablas con optimización para memoria](../in-memory-oltp/memory-optimized-tables.md).</span><span class="sxs-lookup"><span data-stu-id="22244-140">For information on Piecemeal Restores of In-Memory OLTP databases see [Piecemeal Backup and Restore of Databases With Memory-Optimized Tables](../in-memory-oltp/memory-optimized-tables.md).</span></span>  
  
## <a name="restrictions"></a><span data-ttu-id="22244-141">Restricciones</span><span class="sxs-lookup"><span data-stu-id="22244-141">Restrictions</span></span>  
 <span data-ttu-id="22244-142">Si una secuencia de restauración parcial excluye cualquier grupo de archivos [FILESTREAM](../blob/filestream-sql-server.md) , no se admite la restauración a un momento dado.</span><span class="sxs-lookup"><span data-stu-id="22244-142">If a partial restore sequence excludes any [FILESTREAM](../blob/filestream-sql-server.md) filegroup, point-in-time restore is not supported.</span></span> <span data-ttu-id="22244-143">Puede forzarse la continuación de la secuencia de restauración.</span><span class="sxs-lookup"><span data-stu-id="22244-143">You can force the restore sequence to continue.</span></span> <span data-ttu-id="22244-144">Sin embargo, no se podrán restaurar los grupos de archivos FILESTREAM omitidos en la instrucción RESTORE.</span><span class="sxs-lookup"><span data-stu-id="22244-144">However the FILESTREAM filegroups that are omitted from your RESTORE statement can never be restored.</span></span> <span data-ttu-id="22244-145">Para forzar una restauración a un momento específico, especifique la opción CONTINUE_AFTER_ERROR junto con la opción STOPAT, STOPATMARK o STOPBEFOREMARK, que debe especificar también en las instrucciones RESTORE LOG siguientes.</span><span class="sxs-lookup"><span data-stu-id="22244-145">To force a point-in-time restore, specify the CONTINUE_AFTER_ERROR option together with the STOPAT, STOPATMARK, or STOPBEFOREMARK option, which you must also specify in your subsequent RESTORE LOG statements.</span></span> <span data-ttu-id="22244-146">Si se especifica CONTINUE_AFTER_ERROR, la secuencia de restauración parcial será correcta y el grupo de archivos FILESTREAM no será recuperable.</span><span class="sxs-lookup"><span data-stu-id="22244-146">If you specify CONTINUE_AFTER_ERROR, the partial restore sequence succeeds and the FILESTREAM filegroup becomes unrecoverable.</span></span>  
  
## <a name="piecemeal-restore-under-the-simple-recovery-model"></a><span data-ttu-id="22244-147">Restauración por etapas con el modelo de recuperación simple</span><span class="sxs-lookup"><span data-stu-id="22244-147">Piecemeal Restore Under the Simple Recovery Model</span></span>  
 <span data-ttu-id="22244-148">Con el modelo de recuperación simple, la secuencia de restauración por etapas debe comenzar con una copia de seguridad completa o parcial de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="22244-148">Under the simple recovery model, the piecemeal restore sequence must start with a full database or partial backup.</span></span> <span data-ttu-id="22244-149">A continuación, si la copia de seguridad restaurada es una base diferencial, restaure la copia de seguridad diferencial más reciente.</span><span class="sxs-lookup"><span data-stu-id="22244-149">Then, if the restored backup is a differential base, restore the latest differential backup next.</span></span>  
  
 <span data-ttu-id="22244-150">Durante la primera secuencia de restauración parcial, si solo se restaura un subconjunto de grupos de archivos de lectura/escritura, todos los grupos de archivos no restaurados quedan inactivos al recuperar la base de datos restaurada parcialmente.</span><span class="sxs-lookup"><span data-stu-id="22244-150">During the first partial restore sequence, if you restore only a subset of read/write filegroups, any unrestored filegroups become defunct when you recover the partially restored database.</span></span> <span data-ttu-id="22244-151">La exclusión de un grupo de archivos de lectura/escritura de una secuencia de restauración parcial solo es apropiada en los siguientes casos:</span><span class="sxs-lookup"><span data-stu-id="22244-151">Omitting a read/write filegroup from the partial-restore sequence is appropriate only in the following cases:</span></span>  
  
-   <span data-ttu-id="22244-152">Desea que los grupos de archivos no restaurados queden inactivos.</span><span class="sxs-lookup"><span data-stu-id="22244-152">You intend for the unrestored filegroups to become defunct.</span></span>  
  
-   <span data-ttu-id="22244-153">La secuencia de restauración alcanzará un punto de recuperación en el que cada grupo de archivos no restaurado ha pasado a ser de solo lectura, se ha eliminada o ha quedado inactivo (durante una restauración anterior de la secuencia de restauración parcial).</span><span class="sxs-lookup"><span data-stu-id="22244-153">The restore sequence will arrive at a recovery point at which each unrestored filegroup has become read-only, dropped, or defunct (during a previous restore in the partial-restore sequence).</span></span>  
  
-   <span data-ttu-id="22244-154">La copia de seguridad completa se realizó mientras la base de datos utilizaba el modelo de recuperación simple, pero el punto de recuperación es de un momento cuando la base de datos utilizaba el modelo de recuperación completa.</span><span class="sxs-lookup"><span data-stu-id="22244-154">The full backup was taken while the database was using the simple recovery model, but the recovery point is at a time when the database is using the full recovery model.</span></span> <span data-ttu-id="22244-155">Para obtener información, vea "Realizar una restauración por etapas de una base de datos cuyo modelo de recuperación ha cambiado de simple a completo", más adelante en este tema.</span><span class="sxs-lookup"><span data-stu-id="22244-155">For more information, see "Performing a Piecemeal Restore of a Database Whose Recovery Model Has Been Switched from Simple to Full," later in this topic.</span></span>  
  
### <a name="requirements-for-piecemeal-restore-under-the-simple-recovery-model"></a><span data-ttu-id="22244-156">Requisitos de la restauración por etapas con el modelo de recuperación simple</span><span class="sxs-lookup"><span data-stu-id="22244-156">Requirements for Piecemeal Restore Under the Simple Recovery Model</span></span>  
 <span data-ttu-id="22244-157">Con el modelo de recuperación simple, la fase inicial restaura y recupera el grupo de archivos principal y todos los grupos de archivos de lectura/escritura secundarios.</span><span class="sxs-lookup"><span data-stu-id="22244-157">Under the simple recovery model, the initial stage restores and recovers the primary filegroup and all read/write secondary filegroups.</span></span> <span data-ttu-id="22244-158">Una vez terminada la fase inicial, los archivos recuperados (si son válidos y coherentes con la base de datos) pueden ponerse en línea directamente.</span><span class="sxs-lookup"><span data-stu-id="22244-158">After the initial stage is completed, recovered files, if they are valid and consistent with the database, can be brought online directly.</span></span>  
  
 <span data-ttu-id="22244-159">A partir de ese momento, se pueden restaurar los grupos de archivos de solo lectura en una o varias fases adicionales.</span><span class="sxs-lookup"><span data-stu-id="22244-159">Thereafter, read-only filegroups can be restored in one or more additional stages.</span></span>  
  
 <span data-ttu-id="22244-160">La restauración por etapas está disponible para un grupo de archivos secundarios de solo lectura únicamente si se cumple lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="22244-160">Piecemeal restore is available for a read-only secondary filegroup only if the following are true:</span></span>  
  
-   <span data-ttu-id="22244-161">Era de solo lectura cuando se hizo su copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="22244-161">Was read-only when backed up.</span></span>  
  
-   <span data-ttu-id="22244-162">Ha permanecido como solo lectura (y se mantiene la coherencia lógica con el grupo de archivos principal).</span><span class="sxs-lookup"><span data-stu-id="22244-162">Has remained read-only (keeping it logically consistent with the primary filegroup).</span></span>  
  
 <span data-ttu-id="22244-163">Para realizar una restauración por etapas, se deben seguir estas directrices:</span><span class="sxs-lookup"><span data-stu-id="22244-163">To perform a piecemeal restore, the following guidelines must be followed:</span></span>  
  
-   <span data-ttu-id="22244-164">Un conjunto de copias de seguridad completo para la restauración por etapas de una base de datos con el modelo de recuperación simple debe contener lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="22244-164">A complete set of backups for the piecemeal restore of a simple recovery model database must contain the following:</span></span>  
  
    -   <span data-ttu-id="22244-165">Una copia de seguridad de base de datos parcial o completa que contenga el grupo de archivos principal y todos los grupos de archivos que tenían acceso de lectura/escritura al hacer la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="22244-165">A partial or full database backup that contains the primary filegroup and all filegroups that were read/write at the time of the backup.</span></span>  
  
    -   <span data-ttu-id="22244-166">Una copia de seguridad de cada archivo de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="22244-166">A backup of each read-only file.</span></span>  
  
-   <span data-ttu-id="22244-167">Para que la copia de seguridad de un archivo de solo lectura sea coherente con el grupo de archivos principal, el grupo de archivos secundario debe haber sido de solo lectura desde que se hizo la copia de seguridad hasta que se completó la copia de seguridad que incluye el grupo de archivos principal.</span><span class="sxs-lookup"><span data-stu-id="22244-167">For the backup of a read-only file to be consistent with the primary filegroup, the secondary filegroup must have been read-only from when it was backed up until the backup that contains the primary filegroup was completed.</span></span> <span data-ttu-id="22244-168">Puede usar copias de seguridad diferenciales de archivos si se hicieron después de que el grupo de archivos pasara a ser de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="22244-168">You can use differential file backups, if they were taken after the filegroup became read-only.</span></span>  
  
### <a name="piecemeal-restore-stages-simple-recovery-model"></a><span data-ttu-id="22244-169">Fases de la restauración por etapas (modelo de recuperación simple)</span><span class="sxs-lookup"><span data-stu-id="22244-169">Piecemeal Restore Stages (Simple Recovery Model)</span></span>  
 <span data-ttu-id="22244-170">El escenario de restauración por etapas implica las siguientes etapas:</span><span class="sxs-lookup"><span data-stu-id="22244-170">The piecemeal restore scenario involves the following stages:</span></span>  
  
-   <span data-ttu-id="22244-171">Fase inicial (restauración y recuperación del grupo de archivos principal y de todos los grupos de archivos de lectura/escritura)</span><span class="sxs-lookup"><span data-stu-id="22244-171">Initial stage (restore and recover the primary filegroup and all read/write filegroups)</span></span>  
  
     <span data-ttu-id="22244-172">La etapa inicial realiza una restauración parcial.</span><span class="sxs-lookup"><span data-stu-id="22244-172">The initial stage performs a partial restore.</span></span> <span data-ttu-id="22244-173">La secuencia de restauración parcial restaura el grupo de archivos principal, todos los grupos de archivos secundarios de lectura/escritura y, opcionalmente, algunos grupos de archivos de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="22244-173">The partial restore sequence restores the primary filegroup, all read/write secondary filegroups, and (optionally) some of the read-only filegroups.</span></span> <span data-ttu-id="22244-174">Durante la fase inicial, toda la base de datos debe pasar a modo sin conexión.</span><span class="sxs-lookup"><span data-stu-id="22244-174">During the initial stage, the whole database must go offline.</span></span> <span data-ttu-id="22244-175">Después de la etapa inicial, la base de datos está en línea y los grupos de archivos restaurados estarán disponibles.</span><span class="sxs-lookup"><span data-stu-id="22244-175">After the initial stage, the database is online, and restored filegroups are available.</span></span> <span data-ttu-id="22244-176">Sin embargo, los grupos de archivos de solo lectura que aún no se han restaurado permanecen sin conexión.</span><span class="sxs-lookup"><span data-stu-id="22244-176">However, any read-only filegroups that have not yet been restored, remain offline.</span></span>  
  
     <span data-ttu-id="22244-177">La primera instrucción RESTORE de la fase inicial debe realizar lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="22244-177">The first RESTORE statement in the initial stage must do the following:</span></span>  
  
    -   <span data-ttu-id="22244-178">Usar una copia de seguridad parcial o completa de la base de datos que incluya el grupo de archivos principal y todos los grupos de archivos que eran de lectura/escritura al hacer la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="22244-178">Use a partial or full database backup that contains the primary filegroup and all filegroups that were read/write at the time of the backup.</span></span> <span data-ttu-id="22244-179">Es normal comenzar una secuencia de restauración parcial mediante la restauración de una copia de seguridad parcial.</span><span class="sxs-lookup"><span data-stu-id="22244-179">It is common to start a partial restore sequence by restoring a partial backup.</span></span>  
  
    -   <span data-ttu-id="22244-180">Especificar la opción PARTIAL, que indica el inicio de una restauración por etapas.</span><span class="sxs-lookup"><span data-stu-id="22244-180">Specify the PARTIAL option, which indicates the start of a piecemeal restore.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="22244-181">La opción PARTIAL realiza comprobaciones de seguridad que garantizan que la base de datos resultante es adecuada para su uso como base de datos de producción.</span><span class="sxs-lookup"><span data-stu-id="22244-181">The PARTIAL option performs safety checks that ensure that the resulting database is suited for use as a production database.</span></span>  
  
    -   <span data-ttu-id="22244-182">Especificar la opción READ_WRITE_FILEGROUPS si la copia de seguridad es una copia de seguridad de base de datos completa.</span><span class="sxs-lookup"><span data-stu-id="22244-182">Specify the READ_WRITE_FILEGROUPS option if the backup is a full database backup.</span></span>  
  
-   <span data-ttu-id="22244-183">Mientras la base de datos esté en línea, se pueden usar una o varias restauraciones de archivos en línea para restaurar y recuperar archivos de solo lectura sin conexión que eran de solo lectura cuando se realizó la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="22244-183">While the database is online, you can use one or more online file restores to restore and recover offline read-only files that were read-only at the time of backup.</span></span> <span data-ttu-id="22244-184">La programación de la restauración de archivos en línea depende de cuándo desee que los datos tengan conexión.</span><span class="sxs-lookup"><span data-stu-id="22244-184">The timing of the online file restores depends on when you want to have the data online.</span></span>  
  
     <span data-ttu-id="22244-185">La restauración de los datos a un archivo depende de lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="22244-185">Whether you must restore data to a file depends on the following:</span></span>  
  
    -   <span data-ttu-id="22244-186">Los archivos válidos de solo lectura que son coherentes con la base de datos pueden ponerse en línea directamente si se recuperan sin restaurar ningún dato.</span><span class="sxs-lookup"><span data-stu-id="22244-186">Valid read-only files that are consistent with the database can be brought online directly by recovering them without restoring any data.</span></span>  
  
    -   <span data-ttu-id="22244-187">Los archivos dañados o incoherentes con la base de datos se deben restaurar antes de recuperarlos.</span><span class="sxs-lookup"><span data-stu-id="22244-187">Files that are damaged or inconsistent with the database must be restored before they are recovered.</span></span>  
  
### <a name="examples"></a><span data-ttu-id="22244-188">Ejemplos</span><span class="sxs-lookup"><span data-stu-id="22244-188">Examples</span></span>  
  
-   [<span data-ttu-id="22244-189">Ejemplo: restauración por etapas de la base de datos &#40;modelo de recuperación simple&#41;</span><span class="sxs-lookup"><span data-stu-id="22244-189">Example: Piecemeal Restore of Database &#40;Simple Recovery Model&#41;</span></span>](example-piecemeal-restore-of-database-simple-recovery-model.md)  
  
-   [<span data-ttu-id="22244-190">Ejemplo: restauración por etapas exclusiva para algunos grupos de archivos &#40;modelo de recuperación simple&#41;</span><span class="sxs-lookup"><span data-stu-id="22244-190">Example: Piecemeal Restore of Only Some Filegroups &#40;Simple Recovery Model&#41;</span></span>](example-piecemeal-restore-of-only-some-filegroups-simple-recovery-model.md)  
  
## <a name="piecemeal-restore-under-the-full-recovery-model"></a><span data-ttu-id="22244-191">Restauración por etapas con el modelo de recuperación completa</span><span class="sxs-lookup"><span data-stu-id="22244-191">Piecemeal Restore Under the Full Recovery Model</span></span>  
 <span data-ttu-id="22244-192">Con el modelo de recuperación completa o el modelo de recuperación optimizado para cargas masivas de registros, se puede realizar una restauración por etapas de cualquier base de datos que incluya varios grupos de archivos y se puede restaurar una base de datos a cualquier momento dado en el tiempo.</span><span class="sxs-lookup"><span data-stu-id="22244-192">Under the full recovery model or bulk-logged recovery model, piecemeal restore is available for any database that contains multiple filegroups and you can restore a database to any point in time.</span></span> <span data-ttu-id="22244-193">Las secuencias de la restauración por etapas son las siguientes:</span><span class="sxs-lookup"><span data-stu-id="22244-193">The restore sequences of a piecemeal restore behave as follows:</span></span>  
  
-   <span data-ttu-id="22244-194">secuencia de restauración parcial</span><span class="sxs-lookup"><span data-stu-id="22244-194">Partial-restore sequence</span></span>  
  
     <span data-ttu-id="22244-195">La secuencia de restauración parcial restaura el grupo de archivos principal y, opcionalmente, algunos de los grupos de archivos secundarios.</span><span class="sxs-lookup"><span data-stu-id="22244-195">The partial restore sequence restores the primary filegroup and, optionally, some of the secondary filegroups.</span></span>  
  
     <span data-ttu-id="22244-196">La primera instrucción RESTORE DATABASE debe realizar lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="22244-196">The first RESTORE DATABASE statement must do the following:</span></span>  
  
    -   <span data-ttu-id="22244-197">Especificar la opción PARTIAL,</span><span class="sxs-lookup"><span data-stu-id="22244-197">Specify the PARTIAL option.</span></span> <span data-ttu-id="22244-198">que indica el inicio de una restauración por etapas.</span><span class="sxs-lookup"><span data-stu-id="22244-198">This indicates the start of a piecemeal restore.</span></span>  
  
    -   <span data-ttu-id="22244-199">Utilizar cualquier copia de seguridad completa que contenga el grupo de archivos principal.</span><span class="sxs-lookup"><span data-stu-id="22244-199">Use any full database backup that contains the primary filegroup.</span></span> <span data-ttu-id="22244-200">La práctica normal es comenzar una secuencia de restauración parcial mediante la restauración de una copia de seguridad parcial.</span><span class="sxs-lookup"><span data-stu-id="22244-200">The common practice is to start a partial restore sequence by restoring a partial backup.</span></span>  
  
    -   <span data-ttu-id="22244-201">Para restaurar a un momento específico, se debe especificar este momento en la secuencia de restauración parcial.</span><span class="sxs-lookup"><span data-stu-id="22244-201">To restore to a specific point in time, you must specify the time in the partial restore sequence.</span></span> <span data-ttu-id="22244-202">Las fases sucesivas de la secuencia de restauración deberán especificar el mismo momento.</span><span class="sxs-lookup"><span data-stu-id="22244-202">Every successive step of the restore sequence must specify the same point in time.</span></span>  
  
-   <span data-ttu-id="22244-203">Las secuencias de restauración de grupos de archivos ponen en línea los grupos de archivos adicionales en un punto coherente con la base de datos.</span><span class="sxs-lookup"><span data-stu-id="22244-203">Filegroup-restore sequences bring additional filegroups online to a point consistent with the database.</span></span>  
  
     <span data-ttu-id="22244-204">En la edición Enterprise, se puede restaurar y recuperar cualquier grupo de archivos secundario sin conexión mientras la base de datos permanece en línea.</span><span class="sxs-lookup"><span data-stu-id="22244-204">In the Enterprise edition, any offline secondary filegroup can be restored and recovered while the database remains online.</span></span> <span data-ttu-id="22244-205">Si un determinado archivo de solo lectura está dañado o no es coherente con la base de datos, no necesita restauración.</span><span class="sxs-lookup"><span data-stu-id="22244-205">If a specific read-only file is undamaged and consistent with the database, the file does not have to be restored.</span></span> <span data-ttu-id="22244-206">Para obtener más información, vea [Recuperar una base de datos sin restaurar los datos &#40;Transact-SQL&#41;](recover-a-database-without-restoring-data-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="22244-206">For more information, see [Recover a Database Without Restoring Data &#40;Transact-SQL&#41;](recover-a-database-without-restoring-data-transact-sql.md).</span></span>  
  
### <a name="applying-log-backups"></a><span data-ttu-id="22244-207">Aplicar copias de seguridad de registros</span><span class="sxs-lookup"><span data-stu-id="22244-207">Applying Log Backups</span></span>  
 <span data-ttu-id="22244-208">Si un grupo de archivos de solo lectura ha sido de solo lectura desde antes de la creación de la copia de seguridad de archivos, no es necesario aplicar las copias de seguridad de registros al grupo de archivos y éstas se omiten en la restauración de archivos.</span><span class="sxs-lookup"><span data-stu-id="22244-208">If a read-only filegroup has been read-only since before the file backup was created, applying log backups to the filegroup is unnecessary and is skipped by file restore.</span></span> <span data-ttu-id="22244-209">Si el grupo de archivos es de lectura/escritura, debe aplicarse una cadena ininterrumpida de copias de seguridad de registros a la última recuperación completa o diferencial para actualizar el grupo de archivos al archivo de registro actual.</span><span class="sxs-lookup"><span data-stu-id="22244-209">If the filegroup is read/write, an unbroken chain of log backups must be applied to the last full or differential restore to bring the filegroup forward to the current log file.</span></span>  
  
### <a name="examples"></a><span data-ttu-id="22244-210">Ejemplos</span><span class="sxs-lookup"><span data-stu-id="22244-210">Examples</span></span>  
  
-   [<span data-ttu-id="22244-211">Ejemplo: restauración por etapas de la base de datos &#40;modelo de recuperación completa&#41;</span><span class="sxs-lookup"><span data-stu-id="22244-211">Example: Piecemeal Restore of Database &#40;Full Recovery Model&#41;</span></span>](example-piecemeal-restore-of-database-full-recovery-model.md)  
  
-   [<span data-ttu-id="22244-212">Ejemplo: restauración por etapas exclusiva para algunos grupos de archivos &#40;modelo de recuperación completa&#41;</span><span class="sxs-lookup"><span data-stu-id="22244-212">Example: Piecemeal Restore of Only Some Filegroups &#40;Full Recovery Model&#41;</span></span>](example-piecemeal-restore-of-only-some-filegroups-full-recovery-model.md)  
  
## <a name="performing-a-piecemeal-restore-of-a-database-whose-recovery-model-has-been-switched-from-simple-to-full"></a><span data-ttu-id="22244-213">Realizar una restauración por etapas de una base de datos cuyo modelo de recuperación ha cambiado de simple a completo</span><span class="sxs-lookup"><span data-stu-id="22244-213">Performing a Piecemeal Restore of a Database Whose Recovery Model Has Been Switched from Simple to Full</span></span>  
 <span data-ttu-id="22244-214">Puede realizar una restauración por etapas de una base de datos cuyo modelo de recuperación haya cambiado de un modelo de recuperación simple a uno completo desde la creación de la copia de seguridad parcial, completa o de base de datos.</span><span class="sxs-lookup"><span data-stu-id="22244-214">You can perform a piecemeal restore of a database that has been switched from the simple recovery model to the full recovery model since the full partial or database backup.</span></span> <span data-ttu-id="22244-215">Por ejemplo, supongamos que realiza los siguientes pasos para una base de datos:</span><span class="sxs-lookup"><span data-stu-id="22244-215">For example, consider a database for which you take the following steps:</span></span>  
  
1.  <span data-ttu-id="22244-216">Crea una copia de seguridad parcial (copia_1) de una base de datos de modelo simple.</span><span class="sxs-lookup"><span data-stu-id="22244-216">Create a partial backup (backup_1) of a simple-model database.</span></span>  
  
2.  <span data-ttu-id="22244-217">Al cabo de un tiempo, cambia el modelo de recuperación a completo.</span><span class="sxs-lookup"><span data-stu-id="22244-217">After some time, change the recovery model to full.</span></span>  
  
3.  <span data-ttu-id="22244-218">Crea una copia de seguridad diferencial.</span><span class="sxs-lookup"><span data-stu-id="22244-218">Create a differential backup.</span></span>  
  
4.  <span data-ttu-id="22244-219">Comienza a realizar copias de seguridad de registros.</span><span class="sxs-lookup"><span data-stu-id="22244-219">Start taking log backups.</span></span>  
  
 <span data-ttu-id="22244-220">A partir de este punto, la siguiente secuencia será válida:</span><span class="sxs-lookup"><span data-stu-id="22244-220">Thereafter, the following sequence is valid:</span></span>  
  
1.  <span data-ttu-id="22244-221">Una restauración parcial que omite algunos grupos de archivos secundarios.</span><span class="sxs-lookup"><span data-stu-id="22244-221">A partial restore that omits some secondary filegroups.</span></span>  
  
2.  <span data-ttu-id="22244-222">Una restauración diferencial seguida de otras restauraciones necesarias.</span><span class="sxs-lookup"><span data-stu-id="22244-222">A differential restore followed by any other needed restores.</span></span>  
  
3.  <span data-ttu-id="22244-223">Más adelante, una restauración de un grupo de archivos secundarios de lectura/escritura con WITH NORECOVERY de la copia de seguridad parcial copia_1.</span><span class="sxs-lookup"><span data-stu-id="22244-223">Later, a file restore of a read/write secondary filegroup WITH NORECOVERY from the backup_1 partial backup</span></span>  
  
4.  <span data-ttu-id="22244-224">Una copia de seguridad diferencial se realiza después de otras copias de seguridad restauradas en la secuencia de restauración por etapas original para restaurar los datos hasta el punto de recuperación original.</span><span class="sxs-lookup"><span data-stu-id="22244-224">The differential backup followed by any other backups that were restored in the original piecemeal restore sequence to restore the data up to the original recovery point.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="22244-225">Consulte también</span><span class="sxs-lookup"><span data-stu-id="22244-225">See Also</span></span>  
 <span data-ttu-id="22244-226">[Aplicar copias de seguridad del registro de transacciones &#40;SQL Server&#41;](transaction-log-backups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="22244-226">[Apply Transaction Log Backups &#40;SQL Server&#41;](transaction-log-backups-sql-server.md) </span></span>  
 <span data-ttu-id="22244-227">[RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="22244-227">[RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql) </span></span>  
 <span data-ttu-id="22244-228">[Restaurar una base de datos de SQL Server a un momento dado &#40;modelo de recuperación completa&#41;](restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md) </span><span class="sxs-lookup"><span data-stu-id="22244-228">[Restore a SQL Server Database to a Point in Time &#40;Full Recovery Model&#41;](restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md) </span></span>  
 <span data-ttu-id="22244-229">[Información general sobre restauración y recuperación &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="22244-229">[Restore and Recovery Overview &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md) </span></span>  
 [<span data-ttu-id="22244-230">Planear y realizar secuencias de restauración &#40;modelo de recuperación completa&#41;</span><span class="sxs-lookup"><span data-stu-id="22244-230">Plan and Perform Restore Sequences &#40;Full Recovery Model&#41;</span></span>](plan-and-perform-restore-sequences-full-recovery-model.md)  
  
  
