---
title: Restauración con conexión (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- online restores [SQL Server]
- online restores [SQL Server], about online restores
ms.assetid: 7982a687-980a-4eb8-8e9f-6894148e7d8c
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 4db4d5b5ce08c50646857099d82964bb944bc8af
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87675476"
---
# <a name="online-restore-sql-server"></a><span data-ttu-id="e1998-102">Restauración en línea (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="e1998-102">Online Restore (SQL Server)</span></span>
  <span data-ttu-id="e1998-103">La restauración en línea solo se admite en la edición Enterprise de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="e1998-103">Online restore is supported only on [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise edition.</span></span> <span data-ttu-id="e1998-104">En esta versión, la restauración de un archivo, una página o por etapas es en línea de manera predeterminada.</span><span class="sxs-lookup"><span data-stu-id="e1998-104">In this edition, a file, page, or piecemeal restore is online by default.</span></span> <span data-ttu-id="e1998-105">Este tema es pertinente para las bases de datos que incluyen varios archivos o grupos de archivos y, en el modelo de recuperación simple, solo para grupos de archivos de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="e1998-105">This topic is relevant for databases that contain multiple files or filegroups (and, under the simple recovery model, only for read-only filegroups).</span></span>  
  
 <span data-ttu-id="e1998-106">La restauración de datos mientras la base de datos está en línea se denomina *restauración en línea*.</span><span class="sxs-lookup"><span data-stu-id="e1998-106">Restoring data while the database is online is called an *online restore*.</span></span> <span data-ttu-id="e1998-107">Se considera que una base de datos está en línea siempre que el grupo de archivos principal esté en línea, aunque alguno de los grupos de archivos secundarios esté sin conexión.</span><span class="sxs-lookup"><span data-stu-id="e1998-107">A database is considered to be online whenever the primary filegroup is online, even if one or more of its secondary filegroups are offline.</span></span> <span data-ttu-id="e1998-108">En todos los modelos de recuperación se puede restaurar un archivo sin conexión mientras la base de datos está en línea.</span><span class="sxs-lookup"><span data-stu-id="e1998-108">Under any recovery model, you can restore a file that is offline while the database is online.</span></span> <span data-ttu-id="e1998-109">En el modelo de recuperación completa, también se pueden restaurar páginas mientras la base de datos está en línea.</span><span class="sxs-lookup"><span data-stu-id="e1998-109">Under the full recovery model, you can also restore pages while the database is online.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="e1998-110">La restauración en línea tiene lugar automáticamente en [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise y no requiere ninguna acción por parte del usuario.</span><span class="sxs-lookup"><span data-stu-id="e1998-110">Online restore occurs automatically on [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise and requires no user action.</span></span> <span data-ttu-id="e1998-111">Si no desea utilizar la restauración en línea, puede dejar una base de datos sin conexión antes de iniciar la restauración.</span><span class="sxs-lookup"><span data-stu-id="e1998-111">If you do not want to use online restore, you can take a database offline before you start a restore.</span></span> <span data-ttu-id="e1998-112">Para obtener más información, vea [Dejar sin conexión una base de datos o un archivo](#taking_db_or_file_offline)más adelante en este tema.</span><span class="sxs-lookup"><span data-stu-id="e1998-112">For more information, see [Taking a Database or File Offline](#taking_db_or_file_offline), later in this topic.</span></span>  
  
 <span data-ttu-id="e1998-113">Durante una operación de restauración de archivos en línea, los archivos que se estén restaurando y su grupo de archivos están sin conexión.</span><span class="sxs-lookup"><span data-stu-id="e1998-113">During an online file restore, any file being restored and its filegroup are offline.</span></span> <span data-ttu-id="e1998-114">Si algunos de dichos archivos está en línea cuando se inicia una restauración en línea, la primera instrucción de la restauración deja sin conexión el grupo de archivos al que pertenece el archivo.</span><span class="sxs-lookup"><span data-stu-id="e1998-114">If any of these files is online when an online restore starts, the first restore statement takes the filegroup of the file offline.</span></span> <span data-ttu-id="e1998-115">Por el contrario, durante una restauración en línea de una página, solo esa página está sin conexión.</span><span class="sxs-lookup"><span data-stu-id="e1998-115">In contrast, during an online page restore, only the page is offline.</span></span>  
  
 <span data-ttu-id="e1998-116">El escenario de restauración en línea implica los siguientes pasos básicos:</span><span class="sxs-lookup"><span data-stu-id="e1998-116">Every online restore scenario involves the following basic steps:</span></span>  
  
1.  <span data-ttu-id="e1998-117">Restaure los datos.</span><span class="sxs-lookup"><span data-stu-id="e1998-117">Restore the data.</span></span>  
  
2.  <span data-ttu-id="e1998-118">Restaure el registro utilizando WITH RECOVERY para la última restauración del registro.</span><span class="sxs-lookup"><span data-stu-id="e1998-118">Restore the log by using WITH RECOVERY for the last log restore.</span></span> <span data-ttu-id="e1998-119">Así, se ponen en línea los datos restaurados.</span><span class="sxs-lookup"><span data-stu-id="e1998-119">This brings the restored data online.</span></span>  
  
 <span data-ttu-id="e1998-120">A veces, una transacción sin confirmar no se puede revertir porque los datos necesarios para la operación de reversión están sin conexión durante el inicio.</span><span class="sxs-lookup"><span data-stu-id="e1998-120">Occasionally, an uncommitted transaction cannot be rolled back because the data that is required by rollback is offline during startup.</span></span> <span data-ttu-id="e1998-121">En ese caso, la transacción se difiere.</span><span class="sxs-lookup"><span data-stu-id="e1998-121">In this case, the transaction is deferred.</span></span> <span data-ttu-id="e1998-122">Para obtener más información, vea [Transacciones diferidas &#40;SQL Server&#41;](deferred-transactions-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="e1998-122">For more information, see [Deferred Transactions &#40;SQL Server&#41;](deferred-transactions-sql-server.md).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="e1998-123">Si la base de datos está usando en ese momento el modelo de recuperación optimizado para cargas masivas de registros, es recomendable cambiar al modelo de recuperación completa antes de iniciar la restauración en línea.</span><span class="sxs-lookup"><span data-stu-id="e1998-123">If the database is currently using the bulk-logged recovery model, we recommend that you switch to the full recovery model before you start an online restore.</span></span> <span data-ttu-id="e1998-124">Para obtener más información, vea [Ver o cambiar el modelo de recuperación de una base de datos &#40;SQL Server&#41;](view-or-change-the-recovery-model-of-a-database-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="e1998-124">For more information, see [View or Change the Recovery Model of a Database &#40;SQL Server&#41;](view-or-change-the-recovery-model-of-a-database-sql-server.md).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="e1998-125">Si las copias de seguridad se realizaron con varios dispositivos conectados al servidor, será necesario que los mismos dispositivos estén disponibles durante una restauración en línea.</span><span class="sxs-lookup"><span data-stu-id="e1998-125">If the backups were taken with multiple devices that were attached to the server, the same number of devices must be available during an online restore.</span></span>  
  
## <a name="log-backups-for-online-restore"></a><span data-ttu-id="e1998-126">Copias de seguridad de registros para una restauración en línea</span><span class="sxs-lookup"><span data-stu-id="e1998-126">Log Backups for Online Restore</span></span>  
 <span data-ttu-id="e1998-127">En el caso de una restauración en línea, el punto de recuperación es el punto donde se dejaron sin conexión los datos que se van a restaurar o se convirtieron en datos de solo lectura por última vez.</span><span class="sxs-lookup"><span data-stu-id="e1998-127">In an online restore, the recovery point is the point when the data being restored was taken offline or made read-only for the last time.</span></span> <span data-ttu-id="e1998-128">Las copias de seguridad del registro de transacciones que llevan a este punto de recuperación y lo incluyen deben estar todas disponibles.</span><span class="sxs-lookup"><span data-stu-id="e1998-128">The transaction log backups leading up to and including this recovery point must all be available.</span></span> <span data-ttu-id="e1998-129">Normalmente, es necesario hacer una copia de seguridad de registros después de ese punto para cubrir el punto de recuperación del archivo.</span><span class="sxs-lookup"><span data-stu-id="e1998-129">Generally, a log backup is required after that point to cover the recovery point for the file.</span></span> <span data-ttu-id="e1998-130">La única excepción tiene lugar durante una restauración en línea de datos de solo lectura a partir de una copia de seguridad de datos que se realizó después de que los datos pasaran a ser de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="e1998-130">The only exception is during an online restore of read-only data from a data backup that was taken after the data became read-only.</span></span> <span data-ttu-id="e1998-131">En ese caso, no es necesario disponer de una copia de seguridad de registros.</span><span class="sxs-lookup"><span data-stu-id="e1998-131">In this case, you do not have to have a log backup.</span></span>  
  
 <span data-ttu-id="e1998-132">En general, puede realizar copias de seguridad del registro de transacciones mientras la base de datos esté en línea, incluso después de iniciar la secuencia de restauración.</span><span class="sxs-lookup"><span data-stu-id="e1998-132">Generally, you may take transaction log backups while the database is online, even after the start of the restore sequence.</span></span> <span data-ttu-id="e1998-133">El momento oportuno para la realización de la última copia de seguridad de registros depende de las propiedades del archivo que se va a restaurar:</span><span class="sxs-lookup"><span data-stu-id="e1998-133">The timing of the last log backup depends on the properties of the file being restored:</span></span>  
  
-   <span data-ttu-id="e1998-134">En el caso de un archivo en línea de solo lectura, puede realizar la última copia de seguridad de registros necesaria para la recuperación antes o durante la primera secuencia de restauración.</span><span class="sxs-lookup"><span data-stu-id="e1998-134">For an online read-only file, you can take the last log backup that is required for recovery before or during the first restore sequence.</span></span> <span data-ttu-id="e1998-135">Un grupo de archivos de solo lectura no necesita copias de seguridad de registros si se realizó una copia de seguridad de datos o diferencial después de haber configurado el grupo de archivos como de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="e1998-135">A read-only filegroup may not require log backups if a data or differential backup was taken after the filegroup became read-only.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="e1998-136">La información anterior se puede aplicar también a todos los archivos sin conexión.</span><span class="sxs-lookup"><span data-stu-id="e1998-136">The preceding information also applies to every offline file.</span></span>  
  
-   <span data-ttu-id="e1998-137">Un caso especial es un archivo de lectura/escritura que estaba en línea cuando se emitió la primera instrucción de restauración y que, a continuación, dicha instrucción dejó sin conexión automáticamente.</span><span class="sxs-lookup"><span data-stu-id="e1998-137">A special case exists for a read/write file that was online when the first restore statement was issued and that was then automatically taken offline by that restore statement.</span></span> <span data-ttu-id="e1998-138">En este caso, debe realizar una copia de seguridad de registros durante la primera *secuencia de restauración* (secuencia de una o varias instrucciones RESTORE que restauran, ponen al día y recuperan los datos).</span><span class="sxs-lookup"><span data-stu-id="e1998-138">In this case, you must take a log backup during the first *restore sequence* (the sequence of one or more RESTORE statements that restore, roll forward, and recover data).</span></span> <span data-ttu-id="e1998-139">Por lo general, esta copia de seguridad de registros debe tener lugar después de que se hayan restaurado todas las copias de seguridad completas y antes de recuperar los datos.</span><span class="sxs-lookup"><span data-stu-id="e1998-139">Generally, this log backup must occur after you restore all the full backups and before you recover the data.</span></span> <span data-ttu-id="e1998-140">No obstante, si hay varias copias de seguridad de archivos para un grupo de archivos concreto, el punto mínimo de copia de seguridad de registros es después de que el grupo de archivos quede sin conexión.</span><span class="sxs-lookup"><span data-stu-id="e1998-140">However, if there are multiple file backups for a specific filegroup, the minimal point of log backup is the time after the filegroup is offline.</span></span> <span data-ttu-id="e1998-141">Esta copia de seguridad de registros posterior a la restauración de datos capta el punto en el que se dejó el archivo sin conexión</span><span class="sxs-lookup"><span data-stu-id="e1998-141">This post-data-restore log backup captures the point at which the file was taken offline.</span></span> <span data-ttu-id="e1998-142">y es necesaria porque [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] no puede utilizar un registro en línea para una restauración en línea.</span><span class="sxs-lookup"><span data-stu-id="e1998-142">The post-data-restore log backup is necessary because the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] cannot use online log for an online restore.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="e1998-143">Como alternativa, puede dejar el archivo sin conexión manualmente antes de la secuencia de restauración.</span><span class="sxs-lookup"><span data-stu-id="e1998-143">Alternatively, you can manually take the file offline before the restore sequence.</span></span> <span data-ttu-id="e1998-144">Para obtener más información, vea "Dejar sin conexión una base de datos o un archivo" más adelante en este tema.</span><span class="sxs-lookup"><span data-stu-id="e1998-144">For more information, see "Taking a Database or File Offline" later in this topic.</span></span>  
  
##  <a name="taking-a-database-or-file-offline"></a><a name="taking_db_or_file_offline"></a> <span data-ttu-id="e1998-145">Dejar sin conexión una base de datos o un archivo</span><span class="sxs-lookup"><span data-stu-id="e1998-145">Taking a Database or File Offline</span></span>  
 <span data-ttu-id="e1998-146">Si no desea utilizar la restauración en línea, puede dejar sin conexión la base de datos antes de iniciar la secuencia de restauración; para ello, puede usar uno de los métodos siguientes:</span><span class="sxs-lookup"><span data-stu-id="e1998-146">If you do not want to use online restore, you can take the database offline before you start the restore sequence by using one of the following methods:</span></span>  
  
-   <span data-ttu-id="e1998-147">En todos los modelos de recuperación puede dejar sin conexión la base de datos con la siguiente instrucción [ALTER DATABASE](/sql/t-sql/statements/alter-database-transact-sql) :</span><span class="sxs-lookup"><span data-stu-id="e1998-147">Under any recovery model, you can take the database offline by using the following [ALTER DATABASE](/sql/t-sql/statements/alter-database-transact-sql) statement:</span></span>  
  
     <span data-ttu-id="e1998-148">ALTER DATABASE *nombre_base_de_datos* SET OFFLINE</span><span class="sxs-lookup"><span data-stu-id="e1998-148">ALTER DATABASE *database_name* SET OFFLINE</span></span>  
  
-   <span data-ttu-id="e1998-149">Si lo desea, en el modelo de recuperación completa, puede forzar que la restauración de un archivo o una página sea sin conexión; para ello, use la siguiente instrucción [BACKUP LOG](/sql/t-sql/statements/backup-transact-sql) la base de datos se pone en el estado de restauración:</span><span class="sxs-lookup"><span data-stu-id="e1998-149">Alternatively, under the full recovery model, you can force a file or page restore to be offline, by using the following [BACKUP LOG](/sql/t-sql/statements/backup-transact-sql) statement put the database in to the restoring state:</span></span>  
  
     <span data-ttu-id="e1998-150">BACKUP LOG *nombre_base_de_datos* WITH NORECOVERY.</span><span class="sxs-lookup"><span data-stu-id="e1998-150">BACKUP LOG *database_name* WITH NORECOVERY.</span></span>  
  
 <span data-ttu-id="e1998-151">Siempre que la base de datos permanezca sin conexión, todas las restauraciones serán sin conexión.</span><span class="sxs-lookup"><span data-stu-id="e1998-151">As long as a database remains offline, all restores are offline restores.</span></span>  
  
## <a name="examples"></a><span data-ttu-id="e1998-152">Ejemplos</span><span class="sxs-lookup"><span data-stu-id="e1998-152">Examples</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="e1998-153">La sintaxis de un flujo de restauración en línea es la misma que la de un flujo de restauración sin conexión.</span><span class="sxs-lookup"><span data-stu-id="e1998-153">The syntax for an online restore sequence is the same as for an offline restore sequence.</span></span>  
  
-   [<span data-ttu-id="e1998-154">Ejemplo: restauración por etapas de la base de datos &#40;modelo de recuperación simple&#41;</span><span class="sxs-lookup"><span data-stu-id="e1998-154">Example: Piecemeal Restore of Database &#40;Simple Recovery Model&#41;</span></span>](example-piecemeal-restore-of-database-simple-recovery-model.md)  
  
-   [<span data-ttu-id="e1998-155">Ejemplo: restauración por etapas exclusiva para algunos grupos de archivos &#40;modelo de recuperación simple&#41;</span><span class="sxs-lookup"><span data-stu-id="e1998-155">Example: Piecemeal Restore of Only Some Filegroups &#40;Simple Recovery Model&#41;</span></span>](example-piecemeal-restore-of-only-some-filegroups-simple-recovery-model.md)  
  
-   [<span data-ttu-id="e1998-156">Ejemplo: restauración con conexión de un archivo de solo lectura &#40;modelo de recuperación simple&#41;</span><span class="sxs-lookup"><span data-stu-id="e1998-156">Example: Online Restore of a Read-Only File &#40;Simple Recovery Model&#41;</span></span>](example-online-restore-of-a-read-only-file-simple-recovery-model.md)  
  
-   [<span data-ttu-id="e1998-157">Ejemplo: restauración por etapas de la base de datos &#40;modelo de recuperación completa&#41;</span><span class="sxs-lookup"><span data-stu-id="e1998-157">Example: Piecemeal Restore of Database &#40;Full Recovery Model&#41;</span></span>](example-piecemeal-restore-of-database-full-recovery-model.md)  
  
-   [<span data-ttu-id="e1998-158">Ejemplo: restauración por etapas exclusiva para algunos grupos de archivos &#40;modelo de recuperación completa&#41;</span><span class="sxs-lookup"><span data-stu-id="e1998-158">Example: Piecemeal Restore of Only Some Filegroups &#40;Full Recovery Model&#41;</span></span>](example-piecemeal-restore-of-only-some-filegroups-full-recovery-model.md)  
  
-   [<span data-ttu-id="e1998-159">Ejemplo: restauración con conexión de un archivo de lectura/escritura &#40;modelo de recuperación completa&#41;</span><span class="sxs-lookup"><span data-stu-id="e1998-159">Example: Online Restore of a Read-Write File &#40;Full Recovery Model&#41;</span></span>](example-online-restore-of-a-read-write-file-full-recovery-model.md)  
  
-   [<span data-ttu-id="e1998-160">Ejemplo: restauración con conexión de un archivo de solo lectura &#40;modelo de recuperación completa&#41;</span><span class="sxs-lookup"><span data-stu-id="e1998-160">Example: Online Restore of a Read-Only File &#40;Full Recovery Model&#41;</span></span>](example-online-restore-of-a-read-only-file-full-recovery-model.md)  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="e1998-161">Tareas relacionadas</span><span class="sxs-lookup"><span data-stu-id="e1998-161">Related Tasks</span></span>  
  
-   [<span data-ttu-id="e1998-162">Restaurar archivos y grupos de archivos &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="e1998-162">Restore Files and Filegroups &#40;SQL Server&#41;</span></span>](restore-files-and-filegroups-sql-server.md)  
  
-   [<span data-ttu-id="e1998-163">Restaurar páginas &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="e1998-163">Restore Pages &#40;SQL Server&#41;</span></span>](restore-pages-sql-server.md)  
  
-   [<span data-ttu-id="e1998-164">Administrar la tabla suspect_pages &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="e1998-164">Manage the suspect_pages Table &#40;SQL Server&#41;</span></span>](manage-the-suspect-pages-table-sql-server.md)  
  
-   [<span data-ttu-id="e1998-165">Recuperar una base de datos sin restaurar los datos &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="e1998-165">Recover a Database Without Restoring Data &#40;Transact-SQL&#41;</span></span>](recover-a-database-without-restoring-data-transact-sql.md)  
  
-   [<span data-ttu-id="e1998-166">Quitar grupos de archivos inactivos &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="e1998-166">Remove Defunct Filegroups &#40;SQL Server&#41;</span></span>](remove-defunct-filegroups-sql-server.md)  
  
## <a name="see-also"></a><span data-ttu-id="e1998-167">Consulte también</span><span class="sxs-lookup"><span data-stu-id="e1998-167">See Also</span></span>  
 <span data-ttu-id="e1998-168">[Restauraciones de archivos &#40;modelo de recuperación completa&#41;](file-restores-full-recovery-model.md) </span><span class="sxs-lookup"><span data-stu-id="e1998-168">[File Restores &#40;Full Recovery Model&#41;](file-restores-full-recovery-model.md) </span></span>  
 <span data-ttu-id="e1998-169">[Restauraciones de archivos &#40;modelo de recuperación simple&#41;](file-restores-simple-recovery-model.md) </span><span class="sxs-lookup"><span data-stu-id="e1998-169">[File Restores &#40;Simple Recovery Model&#41;](file-restores-simple-recovery-model.md) </span></span>  
 <span data-ttu-id="e1998-170">[Restaurar páginas &#40;SQL Server&#41;](restore-pages-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="e1998-170">[Restore Pages &#40;SQL Server&#41;](restore-pages-sql-server.md) </span></span>  
 <span data-ttu-id="e1998-171">[Restauraciones por etapas &#40;SQL Server&#41;](piecemeal-restores-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="e1998-171">[Piecemeal Restores &#40;SQL Server&#41;](piecemeal-restores-sql-server.md) </span></span>  
 [<span data-ttu-id="e1998-172">Información general sobre restauración y recuperación &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="e1998-172">Restore and Recovery Overview &#40;SQL Server&#41;</span></span>](restore-and-recovery-overview-sql-server.md)  
  
  
