---
title: Transacciones diferidas (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- I/O [SQL Server], database recovery
- restoring pages [SQL Server]
- deferred transactions
- modifying transaction deferred state
ms.assetid: 6fc0f9b6-d3ea-4971-9f27-d0195d1ff718
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 188a0409fbad3f12283adacafbfcb5f176650b72
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87672134"
---
# <a name="deferred-transactions-sql-server"></a><span data-ttu-id="c975d-102">Transacciones diferidas (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="c975d-102">Deferred Transactions (SQL Server)</span></span>
  <span data-ttu-id="c975d-103">En [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise, una transacción dañada puede ser diferida si los datos necesarios para la reversión se encuentran sin conexión durante el inicio de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c975d-103">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise, a corrupted transaction can become deferred if data required by rollback (undo) is offline during database startup.</span></span> <span data-ttu-id="c975d-104">Una *transacción diferida* es aquella que está sin confirmar cuando termina la fase de puesta al día y que se encuentra con un error que impide que se revierta.</span><span class="sxs-lookup"><span data-stu-id="c975d-104">A *deferred transaction* is a transaction that is uncommitted when the roll forward phase finishes and that has encountered an error that prevents it from being rolled back.</span></span> <span data-ttu-id="c975d-105">Si la transacción no se puede revertir, se convierte en una transacción diferida.</span><span class="sxs-lookup"><span data-stu-id="c975d-105">Because the transaction cannot be rolled back, it is deferred.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="c975d-106">Las transacciones dañadas solo se difieren en [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise.</span><span class="sxs-lookup"><span data-stu-id="c975d-106">Corrupted transactions are deferred only in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise.</span></span> <span data-ttu-id="c975d-107">En otras versiones de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], una transacción dañada hace que se produzca un error de inicio.</span><span class="sxs-lookup"><span data-stu-id="c975d-107">In other editions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], a corrupted transaction causes startup to fail.</span></span>  
  
 <span data-ttu-id="c975d-108">Normalmente, las transacciones diferidas se producen porque, cuando la base de datos se estaba poniendo al día, un error de E/S impidió que se leyera una página necesaria para la transacción.</span><span class="sxs-lookup"><span data-stu-id="c975d-108">Generally, a deferred transaction occurs because, while the database was being rolled forward, an I/O error prevented reading a page that was required by the transaction.</span></span> <span data-ttu-id="c975d-109">Sin embargo, un error en el nivel de archivo también puede provocar transacciones diferidas.</span><span class="sxs-lookup"><span data-stu-id="c975d-109">However, an error at the file level can also cause deferred transactions.</span></span> <span data-ttu-id="c975d-110">También puede producirse una transacción diferida cuando una secuencia de restauración parcial se detiene en un punto donde se requiere la reversión de transacciones y una transacción necesita datos que se encuentran sin conexión.</span><span class="sxs-lookup"><span data-stu-id="c975d-110">A deferred transaction can also occur when a partial restore sequence stops at a point at which transaction rollback is necessary and a transaction requires data that is offline.</span></span>  
  
 <span data-ttu-id="c975d-111">Las transacciones de usuario que se están revirtiendo y se encuentran un error de E/S hacen que toda la base de datos se quede sin conexión.</span><span class="sxs-lookup"><span data-stu-id="c975d-111">User transactions that are rolling back and hit an I/O error cause the whole database to go offline.</span></span> <span data-ttu-id="c975d-112">Cuando la base de datos está en línea de nuevo, la acción de rehacer vuelve a adquirir todos los bloqueos que tenía e intenta revertir todas las transacciones no confirmadas.</span><span class="sxs-lookup"><span data-stu-id="c975d-112">When the database is brought back online, the redo reacquires all the locks it had and tries to roll back all the uncommitted transactions.</span></span> <span data-ttu-id="c975d-113">Todos los datos modificados por una transacción permanecen adecuadamente bloqueados hasta que la transacción se puede revertir.</span><span class="sxs-lookup"><span data-stu-id="c975d-113">All data modified by a transaction remains appropriately locked until the transaction can roll back.</span></span> <span data-ttu-id="c975d-114">Las transacciones que no pueden revertirse renuncian a sus bloqueos cuando los daños se arreglan y la base de datos se reinicia o, después de una restauración en línea, cuando las transacciones diferidas se resuelven mientras la base de datos está en línea.</span><span class="sxs-lookup"><span data-stu-id="c975d-114">Transactions that cannot be rolled back will give up their locks when the corruption is fixed and the database restarted or, after an online restore, when the deferred transactions are resolved while the database remains online.</span></span> <span data-ttu-id="c975d-115">Hasta ese momento, una transacción diferida puede mantener los bloqueos que impiden ciertas operaciones en la base de datos en su totalidad.</span><span class="sxs-lookup"><span data-stu-id="c975d-115">Until that point, a deferred transaction can hold locks that prevent certain operations on the database as a whole.</span></span> <span data-ttu-id="c975d-116">Por ejemplo, si una transacción diferida contiene una instrucción CREATE TABLE, ningún usuario puede crear una tabla hasta que la transacción diferida se haya resuelto.</span><span class="sxs-lookup"><span data-stu-id="c975d-116">For example, if a deferred transaction contains a CREATE TABLE instruction, no user can create a table until the deferred transaction has been resolved.</span></span>  
  
 <span data-ttu-id="c975d-117">Las transacciones diferidas pueden producirse también porque una restauración por etapas recupera una base de datos a un punto en que una o varias transacciones activas afectan a un grupo de archivos que todavía no se ha restaurado y sigue estando sin conexión.</span><span class="sxs-lookup"><span data-stu-id="c975d-117">Deferred transaction can also occur because a piecemeal restore recovers a database to a point at which one or more active transactions are affecting a filegroup that has not yet been restored and is offline.</span></span> <span data-ttu-id="c975d-118">Como las transacciones no se pueden revertir, se convierten en transacciones diferidas.</span><span class="sxs-lookup"><span data-stu-id="c975d-118">Because the transactions cannot be rolled back, they become deferred.</span></span>  
  
 <span data-ttu-id="c975d-119">En la siguiente tabla se enumeran las acciones que hacen que una base de datos lleve a cabo la recuperación y el resultado si se produce un problema de E/S.</span><span class="sxs-lookup"><span data-stu-id="c975d-119">The following table lists the actions that cause a database to perform recovery and the outcome if an I/O problem occurs.</span></span>  
  
|<span data-ttu-id="c975d-120">Acción</span><span class="sxs-lookup"><span data-stu-id="c975d-120">Action</span></span>|<span data-ttu-id="c975d-121">Resolución (si se producen problemas de E/S o los datos necesarios están sin conexión)</span><span class="sxs-lookup"><span data-stu-id="c975d-121">Resolution (if I/O problems occur or required data is offline)</span></span>|  
|------------|-----------------------------------------------------------------------|  
|<span data-ttu-id="c975d-122">Iniciar el servidor</span><span class="sxs-lookup"><span data-stu-id="c975d-122">Server start</span></span>|<span data-ttu-id="c975d-123">transacción diferida</span><span class="sxs-lookup"><span data-stu-id="c975d-123">Deferred transaction</span></span>|  
|<span data-ttu-id="c975d-124">Restauración</span><span class="sxs-lookup"><span data-stu-id="c975d-124">Restore</span></span>|<span data-ttu-id="c975d-125">transacción diferida</span><span class="sxs-lookup"><span data-stu-id="c975d-125">Deferred transaction</span></span>|  
|<span data-ttu-id="c975d-126">Attach</span><span class="sxs-lookup"><span data-stu-id="c975d-126">Attach</span></span>|<span data-ttu-id="c975d-127">Error en la operación de adjuntar</span><span class="sxs-lookup"><span data-stu-id="c975d-127">Attach fails</span></span>|  
|<span data-ttu-id="c975d-128">Reinicio automático</span><span class="sxs-lookup"><span data-stu-id="c975d-128">Autorestart</span></span>|<span data-ttu-id="c975d-129">transacción diferida</span><span class="sxs-lookup"><span data-stu-id="c975d-129">Deferred transaction</span></span>|  
|<span data-ttu-id="c975d-130">Crear una base de datos o una instantánea de base de datos</span><span class="sxs-lookup"><span data-stu-id="c975d-130">Create database or database snapshot</span></span>|<span data-ttu-id="c975d-131">Error en la creación</span><span class="sxs-lookup"><span data-stu-id="c975d-131">Creation fails</span></span>|  
|<span data-ttu-id="c975d-132">Puesta al día en la creación de reflejo de la base de datos</span><span class="sxs-lookup"><span data-stu-id="c975d-132">Redo on database mirroring</span></span>|<span data-ttu-id="c975d-133">transacción diferida</span><span class="sxs-lookup"><span data-stu-id="c975d-133">Deferred transaction</span></span>|  
|<span data-ttu-id="c975d-134">Grupo de archivos sin conexión</span><span class="sxs-lookup"><span data-stu-id="c975d-134">Filegroup is offline</span></span>|<span data-ttu-id="c975d-135">transacción diferida</span><span class="sxs-lookup"><span data-stu-id="c975d-135">Deferred transaction</span></span>|  
  
## <a name="moving-a-transaction-out-of-the-deferred-state"></a><span data-ttu-id="c975d-136">Eliminar el estado DEFERRED de una transacción</span><span class="sxs-lookup"><span data-stu-id="c975d-136">Moving a Transaction Out of the DEFERRED State</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="c975d-137">Las transacciones diferidas hacen que el registro de transacciones esté activo.</span><span class="sxs-lookup"><span data-stu-id="c975d-137">Deferred transactions keep the transaction log active.</span></span> <span data-ttu-id="c975d-138">Un archivo de registro virtual que contenga transacciones diferidas no se puede truncar hasta que dichas transacciones salen del estado diferido.</span><span class="sxs-lookup"><span data-stu-id="c975d-138">A virtual log file that contains any deferred transactions cannot be truncated until those transactions are moved out of the deferred state.</span></span> <span data-ttu-id="c975d-139">Para obtener más información sobre el truncamiento de registros, vea [El registro de transacciones &#40;SQL Server&#41;](../logs/the-transaction-log-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="c975d-139">For more information about log truncation, see [The Transaction Log &#40;SQL Server&#41;](../logs/the-transaction-log-sql-server.md).</span></span>  
  
 <span data-ttu-id="c975d-140">Para hacer que la transacción salga del estado diferido, la base de datos debe iniciarse correctamente, sin ningún error de E/S.</span><span class="sxs-lookup"><span data-stu-id="c975d-140">To move the transaction out of the deferred state, the database must start cleanly without any I/O errors.</span></span> <span data-ttu-id="c975d-141">Si existen transacciones diferidas, debe corregir el origen de los errores de E/S.</span><span class="sxs-lookup"><span data-stu-id="c975d-141">If deferred transactions exist, you must fix the source of the I/O errors.</span></span> <span data-ttu-id="c975d-142">Las soluciones disponibles, que aparecen en la lista en el orden en que se suelen aplicar, son las siguientes:</span><span class="sxs-lookup"><span data-stu-id="c975d-142">The available solutions, listed in the order in which they are typically tried, are as follows:</span></span>  
  
-   <span data-ttu-id="c975d-143">Reinicie la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c975d-143">Restart the database.</span></span> <span data-ttu-id="c975d-144">Si el problema fue transitorio, la base de datos se iniciará sin transacciones diferidas.</span><span class="sxs-lookup"><span data-stu-id="c975d-144">If the problem was transient, the database should start without deferred transactions.</span></span>  
  
-   <span data-ttu-id="c975d-145">Si las transacciones se aplazaron debido a que el grupo de archivos estaba sin conexión, vuelva a ponerlo en línea.</span><span class="sxs-lookup"><span data-stu-id="c975d-145">If the transactions were deferred because a filegroup was offline, bring the filegroup back online.</span></span>  
  
     <span data-ttu-id="c975d-146">Para volver poner en línea un grupo de archivos sin conexión utilice la siguiente instrucción [!INCLUDE[tsql](../../includes/tsql-md.md)] :</span><span class="sxs-lookup"><span data-stu-id="c975d-146">To bring an offline filegroup back online, use the following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement:</span></span>  
  
    ```  
    RESTORE DATABASE database_name FILEGROUP=<filegroup_name>  
    ```  
  
-   <span data-ttu-id="c975d-147">Restaure la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c975d-147">Restore the database.</span></span> <span data-ttu-id="c975d-148">Después de una restauración en línea, se resuelven todas las transacciones diferidas.</span><span class="sxs-lookup"><span data-stu-id="c975d-148">After an online restore, any deferred transactions are resolved.</span></span>  
  
     <span data-ttu-id="c975d-149">En el modelo de recuperación completa o el modelo de recuperación optimizado para cargas masivas de registros, si las transacciones diferidas se deben a unas pocas páginas dañadas, es posible que una restauración de las páginas en línea resuelva los errores (donde se admita).</span><span class="sxs-lookup"><span data-stu-id="c975d-149">Under the full or bulk-logged recovery model, if the deferred transactions were caused by only a few corrupted pages, an online page restore might resolve the errors (where supported).</span></span>  
  
-   <span data-ttu-id="c975d-150">Si ya no necesita un grupo de archivos cuyo estado sin conexión crea transacciones diferidas, haga que el grupo de archivos sin conexión pase a estar inactivo.</span><span class="sxs-lookup"><span data-stu-id="c975d-150">If you are no longer require a filegroup whose offline status is causing deferred transactions, make the offline filegroup defunct.</span></span> <span data-ttu-id="c975d-151">Las transacciones que estaban diferidas porque el grupo de archivos estaba sin conexión salen del estado diferido una vez que el grupo de archivos queda inactivo.</span><span class="sxs-lookup"><span data-stu-id="c975d-151">Transactions that were deferred because the filegroup was offline are moved out of the deferred state after the filegroup becomes defunct.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="c975d-152">Un grupo de archivos inactivo no puede recuperarse.</span><span class="sxs-lookup"><span data-stu-id="c975d-152">A defunct filegroup can never be recovered.</span></span>  
  
     <span data-ttu-id="c975d-153">Para obtener más información, vea [Quitar grupos de archivos inactivos &#40;SQL Server&#41;](remove-defunct-filegroups-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="c975d-153">For more information, see [Remove Defunct Filegroups &#40;SQL Server&#41;](remove-defunct-filegroups-sql-server.md).</span></span>  
  
-   <span data-ttu-id="c975d-154">Si las transacciones estaban diferidas a causa de de una página dañada y no se dispone de buena copia de seguridad correcta de la base de datos, siga este procedimiento para reparar la base de datos:</span><span class="sxs-lookup"><span data-stu-id="c975d-154">If transactions were deferred because of a bad page and if a good backup of the database does not exist, use the following process to repair the database:</span></span>  
  
    -   <span data-ttu-id="c975d-155">Ponga la base de datos en modo de emergencia mediante la ejecución de la siguiente instrucción [!INCLUDE[tsql](../../includes/tsql-md.md)] :</span><span class="sxs-lookup"><span data-stu-id="c975d-155">First put the database into emergency mode by executing the following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement:</span></span>  
  
        ```  
        ALTER DATABASE <database_name> SET EMERGENCY  
        ```  
  
         <span data-ttu-id="c975d-156">Para obtener información acerca del modo de emergencia, vea [Database States](../databases/database-states.md).</span><span class="sxs-lookup"><span data-stu-id="c975d-156">For information about emergency mode, see [Database States](../databases/database-states.md).</span></span>  
  
    -   <span data-ttu-id="c975d-157">Después, repare la base de datos mediante la opción DBCC REPAIR_ALLOW_DATA_LOSS de una de las siguientes instrucciones DBCC: [DBCC CHECKDB](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql), [DBCC CHECKALLOC](/sql/t-sql/database-console-commands/dbcc-checkalloc-transact-sql) o [DBCC CHECKTABLE](/sql/t-sql/database-console-commands/dbcc-checktable-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="c975d-157">Then, repair the database by using the DBCC REPAIR_ALLOW_DATA_LOSS option in one of the following DBCC statements: [DBCC CHECKDB](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql), [DBCC CHECKALLOC](/sql/t-sql/database-console-commands/dbcc-checkalloc-transact-sql), or [DBCC CHECKTABLE](/sql/t-sql/database-console-commands/dbcc-checktable-transact-sql).</span></span>  
  
         <span data-ttu-id="c975d-158">Cuando encuentre la página dañada, DBCC la desasignará y reparará cualquier error relacionado.</span><span class="sxs-lookup"><span data-stu-id="c975d-158">When DBCC encounters the bad page, DBCC deallocates it and repairs any related errors.</span></span> <span data-ttu-id="c975d-159">Este enfoque permite volver a poner en línea la base de datos en un estado físicamente coherente.</span><span class="sxs-lookup"><span data-stu-id="c975d-159">This approach enables the database to be brought back online in a physically consistent state.</span></span> <span data-ttu-id="c975d-160">Sin embargo, también podrían perderse otros datos, por lo que este enfoque debe ser el último recurso.</span><span class="sxs-lookup"><span data-stu-id="c975d-160">However, additional data might also be lost; therefore, this approach should be used as a last resort.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="c975d-161">Consulte también</span><span class="sxs-lookup"><span data-stu-id="c975d-161">See Also</span></span>  
 <span data-ttu-id="c975d-162">[Información general sobre restauración y recuperación &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="c975d-162">[Restore and Recovery Overview &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md) </span></span>  
 <span data-ttu-id="c975d-163">[Quitar grupos de archivos inactivos &#40;SQL Server&#41;](remove-defunct-filegroups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="c975d-163">[Remove Defunct Filegroups &#40;SQL Server&#41;](remove-defunct-filegroups-sql-server.md) </span></span>  
 <span data-ttu-id="c975d-164">[Restauraciones de archivos &#40;modelo de recuperación completa&#41;](file-restores-full-recovery-model.md) </span><span class="sxs-lookup"><span data-stu-id="c975d-164">[File Restores &#40;Full Recovery Model&#41;](file-restores-full-recovery-model.md) </span></span>  
 <span data-ttu-id="c975d-165">[Restauraciones de archivos &#40;modelo de recuperación simple&#41;](file-restores-simple-recovery-model.md) </span><span class="sxs-lookup"><span data-stu-id="c975d-165">[File Restores &#40;Simple Recovery Model&#41;](file-restores-simple-recovery-model.md) </span></span>  
 <span data-ttu-id="c975d-166">[Restaurar páginas &#40;SQL Server&#41;](restore-pages-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="c975d-166">[Restore Pages &#40;SQL Server&#41;](restore-pages-sql-server.md) </span></span>  
 <span data-ttu-id="c975d-167">[Restauraciones por etapas &#40;SQL Server&#41;](piecemeal-restores-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="c975d-167">[Piecemeal Restores &#40;SQL Server&#41;](piecemeal-restores-sql-server.md) </span></span>  
 <span data-ttu-id="c975d-168">[ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="c975d-168">[ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql) </span></span>  
 [<span data-ttu-id="c975d-169">RESTORE &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="c975d-169">RESTORE &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/restore-statements-transact-sql)  
  
  
