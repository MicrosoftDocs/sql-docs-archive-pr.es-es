---
title: Restauración a partir de copias de seguridad almacenadas en Azure | Microsoft Docs
ms.custom: ''
ms.date: 03/07/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
ms.assetid: 6ae358b2-6f6f-46e0-a7c8-f9ac6ce79a0e
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 68b270f18cb4dbc2724c5a062afae54fa711acec
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87675447"
---
# <a name="restoring-from-backups-stored-in-azure"></a><span data-ttu-id="52887-102">Restauración de las copias de seguridad almacenadas en Azure</span><span class="sxs-lookup"><span data-stu-id="52887-102">Restoring From Backups Stored in Azure</span></span>
  <span data-ttu-id="52887-103">En este tema se describen las consideraciones al restaurar una base de datos mediante una copia de seguridad almacenada en el servicio Azure Blob Storage.</span><span class="sxs-lookup"><span data-stu-id="52887-103">This topic outlines the considerations when restoring a database using a backup stored in the Azure Blob storage service.</span></span> <span data-ttu-id="52887-104">Esto se aplica a las copias de seguridad creadas mediante Copia de seguridad en URL de SQL Server o con [!INCLUDE[ss_smartbackup](../../includes/ss-smartbackup-md.md)].</span><span class="sxs-lookup"><span data-stu-id="52887-104">This applies to backups created either by using SQL Server Backup to URL backup or by [!INCLUDE[ss_smartbackup](../../includes/ss-smartbackup-md.md)].</span></span>  
  
 <span data-ttu-id="52887-105">Se recomienda revisar este tema si tiene copias de seguridad almacenadas en el servicio Azure Blob Storage que vaya a restaurar y luego revisar los temas que describen los pasos para restaurar una base de datos, que es igual para las copias de seguridad locales y de Azure.</span><span class="sxs-lookup"><span data-stu-id="52887-105">We recommend reviewing this topic if you have backups stored in the Azure Blob storage service that you plan to restore, and then review the topics that describe the steps on how to restore a database which is the same for both on-premises and azure backups.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="52887-106">Información general</span><span class="sxs-lookup"><span data-stu-id="52887-106">Overview</span></span>  
 <span data-ttu-id="52887-107">Las herramientas y los métodos que se utilizan para restaurar una base de datos a partir de una copia de seguridad local son válidos para restaurar una base de datos a partir de una copia de seguridad en la nube.</span><span class="sxs-lookup"><span data-stu-id="52887-107">The tools and methods that are used to restore a database from an on-premises backup apply to restoring a database from a cloud backup.</span></span>  <span data-ttu-id="52887-108">En las siguientes secciones se describen estas consideraciones y las diferencias que debe saber si utiliza las copias de seguridad almacenadas en el servicio Azure Blob Storage.</span><span class="sxs-lookup"><span data-stu-id="52887-108">The following sections describe these considerations and any differences you should know about when you use backups stored in the Azure Blob storage service.</span></span>  
  
### <a name="using-transact-sql"></a><span data-ttu-id="52887-109">Usar Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="52887-109">Using Transact-SQL</span></span>  
  
-   <span data-ttu-id="52887-110">Dado que SQL Server debe conectarse a un origen externo para recuperar los archivos de copia de seguridad, la credencial de SQL se utiliza para autenticarse en la cuenta de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="52887-110">Since SQL Server must connect to an external source to retrieve the backup files, SQL Credential is used to authenticate to the storage account.</span></span> <span data-ttu-id="52887-111">Por consiguiente, la instrucción RESTORE requiere la opción WITH CREDENTIAL.</span><span class="sxs-lookup"><span data-stu-id="52887-111">Consequently, the RESTORE statement requires WITH CREDENTIAL option.</span></span> <span data-ttu-id="52887-112">Para obtener más información, vea [Copia de seguridad y restauración de SQL Server con el servicio Azure Blob Storage](sql-server-backup-and-restore-with-microsoft-azure-blob-storage-service.md).</span><span class="sxs-lookup"><span data-stu-id="52887-112">For more information, see [SQL Server Backup and Restore with Azure Blob Storage Service](sql-server-backup-and-restore-with-microsoft-azure-blob-storage-service.md).</span></span>  
  
-   <span data-ttu-id="52887-113">Si usa [!INCLUDE[ss_smartbackup](../../includes/ss-smartbackup-md.md)] para administrar las copias de seguridad en la nube, podrá revisar todas las copias de seguridad disponibles en el almacén mediante la función del sistema **smart_admin.fn_available_backups** .</span><span class="sxs-lookup"><span data-stu-id="52887-113">If you are using the [!INCLUDE[ss_smartbackup](../../includes/ss-smartbackup-md.md)] to manage your backups to the cloud, you can review all the available backups in the storage, by using the **smart_admin.fn_available_backups** system function.</span></span> <span data-ttu-id="52887-114">Esta función del sistema devuelve todas las copias de seguridad disponibles para una base de datos en una tabla.</span><span class="sxs-lookup"><span data-stu-id="52887-114">This system function returns all the available backups for a database in a table.</span></span> <span data-ttu-id="52887-115">Como los resultados se devuelven en una tabla, puede filtrarlos u ordenarlos.</span><span class="sxs-lookup"><span data-stu-id="52887-115">As the results are returned in a table, you can filter or sort the results.</span></span> <span data-ttu-id="52887-116">Para obtener más información, vea [smart_admin. fn_available_backups &#40;&#41;de Transact-SQL ](/sql/relational-databases/system-functions/managed-backup-fn-available-backups-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="52887-116">For more information, see [smart_admin.fn_available_backups &#40;Transact-SQL&#41;](/sql/relational-databases/system-functions/managed-backup-fn-available-backups-transact-sql).</span></span>  
  
### <a name="using-sql-server-management-studio"></a><span data-ttu-id="52887-117">Uso de SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="52887-117">Using SQL Server Management Studio</span></span>  
  
-   <span data-ttu-id="52887-118">Se utiliza la tarea de restauración para restaurar una base de datos con SQL Server Management Studio.</span><span class="sxs-lookup"><span data-stu-id="52887-118">The restore task is used to restore a database using the SQL Server Management Studio.</span></span> <span data-ttu-id="52887-119">La página de medios de copia de seguridad incluye ahora la opción **Dirección URL** para mostrar los archivos de copia de seguridad almacenados en el servicio Azure Blob Storage.</span><span class="sxs-lookup"><span data-stu-id="52887-119">The backup media page now includes the **URL** option to show backup files stored in the Azure Blob storage service.</span></span> <span data-ttu-id="52887-120">También debe proporcionar la credencial SQL que se usa para autenticarse en la cuenta de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="52887-120">You also must provide the SQL Credential that is used to authenticate to the storage account.</span></span> <span data-ttu-id="52887-121">La cuadrícula **Conjuntos de copia de seguridad para restaurar** se rellena con las copias de seguridad disponibles en Azure Blob Storage.</span><span class="sxs-lookup"><span data-stu-id="52887-121">The **Backup sets to restore** grid is then populated with the available backups in the Azure Blob storage.</span></span> <span data-ttu-id="52887-122">Para más información, consulte [Restaurar desde el almacenamiento de Microsoft Azure con SQL Server Management Studio](sql-server-backup-to-url.md#RestoreSSMS).</span><span class="sxs-lookup"><span data-stu-id="52887-122">For more information, see [Restoring from Azure storage Using SQL Server Management Studio](sql-server-backup-to-url.md#RestoreSSMS).</span></span>  
  
### <a name="optimizing-restores"></a><span data-ttu-id="52887-123">Optimizar restauraciones</span><span class="sxs-lookup"><span data-stu-id="52887-123">Optimizing Restores</span></span>  
 <span data-ttu-id="52887-124">Para reducir el tiempo de escritura de restauración, agregue el derecho de usuario **Realizar tareas de mantenimiento del volumen** a la cuenta de usuario de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="52887-124">To reduce restore write time, Add **perform volume maintenance tasks** user right to the SQL Server user account.</span></span> <span data-ttu-id="52887-125">Para obtener más información, vea [Inicialización de archivos de base de datos](https://go.microsoft.com/fwlink/?LinkId=271622).</span><span class="sxs-lookup"><span data-stu-id="52887-125">For more information, see [Database File Initialization](https://go.microsoft.com/fwlink/?LinkId=271622).</span></span> <span data-ttu-id="52887-126">Si la restauración sigue siendo lenta con la inicialización de archivos instantánea activada, examine el tamaño del archivo de registro en la instancia donde se hizo copia de seguridad de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="52887-126">If restore is still slow with instant file initialization turned on, look at the size of the log file on the instance where the database was backed up.</span></span> <span data-ttu-id="52887-127">Si el registro es muy grande (varios GB), cabe esperar que la restauración sea lenta.</span><span class="sxs-lookup"><span data-stu-id="52887-127">If the log is very large in size (multiple GBs), it would be expected that restore would be slow.</span></span> <span data-ttu-id="52887-128">Durante la restauración, el archivo de registro se debe poner a cero, lo que lleva una cantidad considerable de tiempo.</span><span class="sxs-lookup"><span data-stu-id="52887-128">During restore the log file must be zeroed which takes a significant amount of time.</span></span>  
  
 <span data-ttu-id="52887-129">Para reducir los tiempos de restauración, se recomienda usar copias de seguridad comprimidas.</span><span class="sxs-lookup"><span data-stu-id="52887-129">To reduce restore times it is recommended that you use compressed backups.</span></span>  <span data-ttu-id="52887-130">Para los tamaños de copia de seguridad que sobrepasen los 25 GB, use la [utilidad AzCopy](https://docs.microsoft.com/archive/blogs/windowsazurestorage/azcopy-uploadingdownloading-files-for-windows-azure-blobs) para realizar la descarga en la unidad local y, después, realizar la restauración.</span><span class="sxs-lookup"><span data-stu-id="52887-130">For backup sizes exceeding 25 GB, use [AzCopy utility](https://docs.microsoft.com/archive/blogs/windowsazurestorage/azcopy-uploadingdownloading-files-for-windows-azure-blobs) to download to the local drive and then perform the restore.</span></span> <span data-ttu-id="52887-131">Para obtener información sobre otros procedimientos recomendados y sugerencias para copias de seguridad, vea [SQL Server Backup to URL Best Practices and Troubleshooting](sql-server-backup-to-url-best-practices-and-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="52887-131">For other backup best practices and recommendations, see [SQL Server Backup to URL Best Practices and Troubleshooting](sql-server-backup-to-url-best-practices-and-troubleshooting.md).</span></span>  
  
 <span data-ttu-id="52887-132">También puede activar la marca de seguimiento 3051 al realizar la restauración para generar un registro detallado.</span><span class="sxs-lookup"><span data-stu-id="52887-132">You can also turn on Trace Flag 3051 when doing the restore to generate a detailed log.</span></span> <span data-ttu-id="52887-133">Este archivo de registro se coloca en el directorio de registros y se le asigna un nombre de acuerdo al formato: BackupToUrl-\<instancename>-\<dbname>-action-\<PID>.log.</span><span class="sxs-lookup"><span data-stu-id="52887-133">This log file is placed in the log directory, and is named using the format: BackupToUrl-\<instancename>-\<dbname>-action-\<PID>.log.</span></span> <span data-ttu-id="52887-134">El archivo de registro incluye información sobre cada recorrido de ida y vuelta a Azure Storage, incluido el tiempo que puede resultar útil para diagnosticar el problema.</span><span class="sxs-lookup"><span data-stu-id="52887-134">The log file includes information about each round trip to Azure Storage including timing that can be helpful in diagnosing the issue.</span></span>  
  
### <a name="topics-on-performing-restore-operations"></a><span data-ttu-id="52887-135">Temas sobre las operaciones de restauración</span><span class="sxs-lookup"><span data-stu-id="52887-135">Topics on Performing Restore Operations</span></span>  
  
-   [<span data-ttu-id="52887-136">Restauraciones de base de datos completas &#40;modelo de recuperación simple&#41;</span><span class="sxs-lookup"><span data-stu-id="52887-136">Complete Database Restores &#40;Simple Recovery Model&#41;</span></span>](complete-database-restores-simple-recovery-model.md)  
  
-   [<span data-ttu-id="52887-137">RESTORE &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="52887-137">RESTORE &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/restore-statements-transact-sql)  
  
-   [<span data-ttu-id="52887-138">Restauraciones de base de datos completas &#40;modelo de recuperación completa&#41;</span><span class="sxs-lookup"><span data-stu-id="52887-138">Complete Database Restores &#40;Full Recovery Model&#41;</span></span>](complete-database-restores-full-recovery-model.md)  
  
-   [<span data-ttu-id="52887-139">Restauraciones de archivos &#40;modelo de recuperación simple&#41;</span><span class="sxs-lookup"><span data-stu-id="52887-139">File Restores &#40;Simple Recovery Model&#41;</span></span>](file-restores-simple-recovery-model.md)  
  
-   [<span data-ttu-id="52887-140">Restauraciones de archivos &#40;modelo de recuperación completa&#41;</span><span class="sxs-lookup"><span data-stu-id="52887-140">File Restores &#40;Full Recovery Model&#41;</span></span>](file-restores-full-recovery-model.md)  
  
-   [<span data-ttu-id="52887-141">Restauraciones por etapas &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="52887-141">Piecemeal Restores &#40;SQL Server&#41;</span></span>](piecemeal-restores-sql-server.md)  
  
  
