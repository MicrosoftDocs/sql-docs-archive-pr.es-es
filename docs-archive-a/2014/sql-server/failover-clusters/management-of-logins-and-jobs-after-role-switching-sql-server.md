---
title: Administración de inicios de sesión y trabajos tras la conmutación de roles (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- role switching [SQL Server]
ms.assetid: fc2fc949-746f-40c7-b5d4-3fd51ccfbd7b
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 9c099bf9ea271b5ea93fdebfe8f35c98864bca09
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87672575"
---
# <a name="management-of-logins-and-jobs-after-role-switching-sql-server"></a><span data-ttu-id="8a767-102">Administración de inicios de sesión y trabajos tras la conmutación de roles (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="8a767-102">Management of Logins and Jobs After Role Switching (SQL Server)</span></span>
  <span data-ttu-id="8a767-103"> Al implementar una solución de alta disponibilidad o de recuperación ante desastres para una base de datos de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], es importante reproducir información relevante que se almacena para dicha base de datos en las bases de datos **master** o **msdb**.</span><span class="sxs-lookup"><span data-stu-id="8a767-103">When deploying a high-availability or disaster-recovery solution for a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database, it is important to reproduce relevant information that is stored for the database in the **master** or **msdb** databases.</span></span> <span data-ttu-id="8a767-104">Generalmente, la información relevante incluye los trabajos de la base de datos principal y los inicios de sesión de los usuarios o los procesos que necesitan conectarse con la base de datos.</span><span class="sxs-lookup"><span data-stu-id="8a767-104">Typically, the relevant information includes the jobs of the primary/principal database and the logins of users or processes that need to connect to the database.</span></span> <span data-ttu-id="8a767-105">Debe duplicar esta información en las instancias de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] que hospeden una base de datos reflejada o secundaria.</span><span class="sxs-lookup"><span data-stu-id="8a767-105">You should duplicate this information on any instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that hosts a secondary/mirror database.</span></span> <span data-ttu-id="8a767-106">Si es posible, tras la conmutación de roles es mejor reproducir mediante programación la información en la nueva base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="8a767-106">If possible after roles are switched, it is best to programmatically reproduce the information on the new primary/principal database.</span></span>  
  
## <a name="logins"></a><span data-ttu-id="8a767-107">Inicios de sesión</span><span class="sxs-lookup"><span data-stu-id="8a767-107">Logins</span></span>  
 <span data-ttu-id="8a767-108">En las instancias de servidor que hospeden una copia de la base de datos, debe reproducir los inicios de sesión que tengan permiso de acceso a la base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="8a767-108">On every server instances that hosts a copy of the database, you should reproduce the logins that have permission to access the principal database.</span></span> <span data-ttu-id="8a767-109">Cuando cambie el rol principal, solo los usuarios cuyos inicios de sesión existan en la nueva instancia del servidor principal podrán tener acceso la nueva base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="8a767-109">When the primary/principal role switches, only users whose logins exist on the new primary/principal server instance can access the new primary/principal database.</span></span> <span data-ttu-id="8a767-110">Los usuarios cuyos inicios de sesión no estén definidos en la nueva instancia del servidor principal se quedarán huérfanos y no podrán tener acceso a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="8a767-110">Users whose logins are not defined on the new primary/principal server instance are orphaned and cannot access the database.</span></span>  
  
 <span data-ttu-id="8a767-111">Si un usuario se queda huérfano, cree el inicio de sesión en la nueva instancia del servidor principal y ejecute [sp_change_users_login](/sql/relational-databases/system-stored-procedures/sp-change-users-login-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="8a767-111">If a user is orphaned, create the login on the new primary/principal server instance and run [sp_change_users_login](/sql/relational-databases/system-stored-procedures/sp-change-users-login-transact-sql).</span></span> <span data-ttu-id="8a767-112">Para obtener más información, vea [Solucionar problemas de usuarios huérfanos &#40;SQL Server&#41;](troubleshoot-orphaned-users-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="8a767-112">For more information, see [Troubleshoot Orphaned Users &#40;SQL Server&#41;](troubleshoot-orphaned-users-sql-server.md).</span></span>  
  
###  <a name="logins-of-applications-that-use-sql-server-authentication-or-a-local-windows-login"></a><a name="SSauthentication"></a> <span data-ttu-id="8a767-113">Inicios de sesión de aplicaciones que usan la autenticación de SQL Server o un inicio de sesión local de Windows</span><span class="sxs-lookup"><span data-stu-id="8a767-113">Logins Of Applications That Use SQL Server Authentication or a Local Windows Login</span></span>  
 <span data-ttu-id="8a767-114">Si una aplicación usa la Autenticación de SQL Server o un inicio de sesión local de Windows, los SID que no coinciden pueden impedir que el inicio de sesión de la aplicación se resuelva en una instancia remota de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8a767-114">If an application uses SQL Server Authentication or a local Windows login, mismatched SIDs can prevent the application's login from resolving on a remote instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="8a767-115">Los SID que no coincidan harán que el inicio de sesión sea un usuario huérfano en la instancia del servidor remoto.</span><span class="sxs-lookup"><span data-stu-id="8a767-115">The mismatched SIDs cause the login to become an orphaned user on the remote server instance.</span></span> <span data-ttu-id="8a767-116">Este problema puede producirse cuando una aplicación se conecta con una base de datos reflejada o de trasvase de registros después de una conmutación por error o con una base de datos Suscriptor de replicación que se inicializó desde una copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="8a767-116">This issue can occur when an application connects to a mirrored or log shipping database after a failover or to a replication subscriber database that was initialized from a backup.</span></span>  
  
 <span data-ttu-id="8a767-117">Para evitar que se produzca este problema, se recomienda tomar medidas preventivas al configurar una aplicación de este tipo para que utilice una base de datos hospedada por una instancia remota de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8a767-117">To prevent this issue, we recommend that you take preventative measures when you set up such an application to use a database that is hosted by a remote instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="8a767-118">La prevención implica la transferencia de los inicios de sesión y las contraseñas de la instancia local de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] a la instancia remota de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8a767-118">Prevention involves transferring the logins and the passwords from the local instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to the remote instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="8a767-119">Para obtener más información acerca de cómo evitar este problema, vea el artículo de KB 918992:[Cómo transferir inicios de sesión y contraseñas entre instancias de SQL Server](https://support.microsoft.com/kb/918992/)).</span><span class="sxs-lookup"><span data-stu-id="8a767-119">For more information about how to prevent this issue, see KB article 918992 -[How to transfer logins and passwords between instances of SQL Server](https://support.microsoft.com/kb/918992/)).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="8a767-120">Este problema afecta a las cuentas locales de Windows en distintos equipos.</span><span class="sxs-lookup"><span data-stu-id="8a767-120">This problem affects Windows local accounts on different computers.</span></span> <span data-ttu-id="8a767-121">Sin embargo, este problema no ocurre en las cuentas de dominio debido a que el SID es el mismo en todos los equipos.</span><span class="sxs-lookup"><span data-stu-id="8a767-121">However, this problem does not occur for domain accounts because the SID is the same on each of the computers.</span></span>  
  
 <span data-ttu-id="8a767-122">Para obtener más información, vea [Usuarios huérfanos con creación de reflejo de la base de datos y trasvase de registros](https://blogs.msdn.com/b/sqlserverfaq/archive/2009/04/13/orphaned-users-with-database-mirroring-and-log-shipping.aspx) (un blog del motor de base de datos).</span><span class="sxs-lookup"><span data-stu-id="8a767-122">For more information, see [Orphaned Users with Database Mirroring and Log Shipping](https://blogs.msdn.com/b/sqlserverfaq/archive/2009/04/13/orphaned-users-with-database-mirroring-and-log-shipping.aspx) (a Database Engine blog).</span></span>  
  
## <a name="jobs"></a><span data-ttu-id="8a767-123">Trabajos</span><span class="sxs-lookup"><span data-stu-id="8a767-123">Jobs</span></span>  
 <span data-ttu-id="8a767-124">Los trabajos, como, por ejemplo, los trabajos de copia de seguridad, requieren una consideración especial.</span><span class="sxs-lookup"><span data-stu-id="8a767-124">Jobs, such as backup jobs, require special consideration.</span></span> <span data-ttu-id="8a767-125">Normalmente, tras una conmutación de roles, el propietario de la base de datos o el administrador del sistema deben volver a crear los trabajos de la nueva base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="8a767-125">Typically, after a role switch, the database owner or system administrator must re-create the jobs for the new primary/principal database.</span></span>  
  
 <span data-ttu-id="8a767-126">Cuando esté disponible la que antes era la instancia del servidor principal, debería eliminar los trabajos originales en dicha instancia de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8a767-126">When the former primary/principal server instance is available, you should delete the original jobs on that instanceof [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="8a767-127">Observe que los trabajos de la base de datos reflejada actual generan un error porque la base de datos se encuentra en el estado RESTORING y, por lo tanto, no está disponible.</span><span class="sxs-lookup"><span data-stu-id="8a767-127">Note that jobs on the current mirror database fail because it is in the RESTORING state, making it unavailable.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="8a767-128">Las distintas instancias de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] pueden configurarse de forma diferente, con distintas letras de unidad, por ejemplo.</span><span class="sxs-lookup"><span data-stu-id="8a767-128">Different instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] might be configured differently, with different drive letters or such.</span></span> <span data-ttu-id="8a767-129">Los trabajos para cada asociado deben permitir tales diferencias.</span><span class="sxs-lookup"><span data-stu-id="8a767-129">The jobs for each partner must allow for any such differences.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="8a767-130">Consulte también</span><span class="sxs-lookup"><span data-stu-id="8a767-130">See Also</span></span>  
 <span data-ttu-id="8a767-131">[Administrar los metadatos cuando una base de datos pasa a estar disponible en otra instancia del servidor &#40;SQL Server&#41;](../../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md) </span><span class="sxs-lookup"><span data-stu-id="8a767-131">[Manage Metadata When Making a Database Available on Another Server Instance &#40;SQL Server&#41;](../../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md) </span></span>  
 [<span data-ttu-id="8a767-132">Solucionar problemas de usuarios huérfanos &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="8a767-132">Troubleshoot Orphaned Users &#40;SQL Server&#41;</span></span>](troubleshoot-orphaned-users-sql-server.md)  
  
  
