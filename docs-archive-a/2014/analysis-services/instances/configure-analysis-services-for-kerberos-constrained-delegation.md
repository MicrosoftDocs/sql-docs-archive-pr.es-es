---
title: Configurar Analysis Services para la delegación restringida de Kerberos | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
ms.assetid: 6d751477-6bf1-48b4-8833-5a631bbe7650
author: minewiskan
ms.author: owend
ms.openlocfilehash: 03b852acb4868cd384ef34948c6aff70541638a0
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87745570"
---
# <a name="configure-analysis-services-for-kerberos-constrained-delegation"></a><span data-ttu-id="fa05d-102">Configurar Analysis Services para la delegación restringida de Kerberos</span><span class="sxs-lookup"><span data-stu-id="fa05d-102">Configure Analysis Services for Kerberos constrained delegation</span></span>
  <span data-ttu-id="fa05d-103">Al configurar Analysis Services para la autenticación Kerberos, lo más probable es que le interese conseguir uno de los resultados siguientes o ambos: hacer que Analysis Services suplante una identidad de usuario al consultar datos o hacer que Analysis Services delegue una identidad de usuario a un servicio de nivel inferior.</span><span class="sxs-lookup"><span data-stu-id="fa05d-103">When configuring Analysis Services for Kerberos authentication, you are most likely interested in achieving one or both of the following outcomes: having Analysis Services impersonate a user identity when querying data; or having Analysis Services delegate a user identity to a down-level service.</span></span> <span data-ttu-id="fa05d-104">Cada escenario necesita requisitos de configuración ligeramente diferentes.</span><span class="sxs-lookup"><span data-stu-id="fa05d-104">Each scenario calls for slightly different configuration requirements.</span></span> <span data-ttu-id="fa05d-105">En ambos escenarios es necesario asegurarse de que la configuración se ha realizado correctamente.</span><span class="sxs-lookup"><span data-stu-id="fa05d-105">Both scenarios require verification to ensure configuration was done properly.</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="fa05d-106">**[!INCLUDE[msCoName](../../includes/msconame-md.md)] Administrador de configuración de Kerberos para [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]** es una herramienta de diagnóstico que sirve para solucionar problemas de conectividad de Kerberos relacionados con [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="fa05d-106">**[!INCLUDE[msCoName](../../includes/msconame-md.md)] Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]** is a diagnostic tool that helps troubleshoot Kerberos related connectivity issues with [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="fa05d-107">Para obtener más información, vea [Administrador de configuración de Microsoft Kerberos para SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span><span class="sxs-lookup"><span data-stu-id="fa05d-107">For more information, see [Microsoft Kerberos Configuration Manager for SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span></span>  
  
 <span data-ttu-id="fa05d-108">Este tema contiene las siguientes secciones:</span><span class="sxs-lookup"><span data-stu-id="fa05d-108">This topic contains the following sections:</span></span>  
  
-   [<span data-ttu-id="fa05d-109">Permitir que Analysis Services suplante una identidad de usuario</span><span class="sxs-lookup"><span data-stu-id="fa05d-109">Allow Analysis Services to impersonate a user identity</span></span>](#bkmk_impersonate)  
  
-   [<span data-ttu-id="fa05d-110">Configurar Analysis Services para la delegación de confianza</span><span class="sxs-lookup"><span data-stu-id="fa05d-110">Configure Analysis Services for trusted delegation</span></span>](#bkmk_delegate)  
  
-   [<span data-ttu-id="fa05d-111">Probar la identidad suplantada o delegada</span><span class="sxs-lookup"><span data-stu-id="fa05d-111">Test for impersonated or delegated identity</span></span>](#bkmk_test)  
  
> [!NOTE]  
>  <span data-ttu-id="fa05d-112">La delegación no es necesaria si la conexión con Analysis Services es un solo salto, o si la solución usa credenciales almacenadas proporcionadas por el Servicio de almacenamiento seguro de SharePoint o por Reporting Services.</span><span class="sxs-lookup"><span data-stu-id="fa05d-112">Delegation is not required if the connection to Analysis Services is a single hop, or your solution uses stored credentials provided by SharePoint Secure Store Service or Reporting Services.</span></span> <span data-ttu-id="fa05d-113">Si todas las conexiones son conexiones directas desde Excel a una base de datos de Analysis Services, o se basan en credenciales almacenadas, puede utilizar Kerberos (o NTLM) sin tener que configurar la delegación restringida.</span><span class="sxs-lookup"><span data-stu-id="fa05d-113">If all connections are direct connections from Excel to an Analysis Services database, or based on stored credentials, you can use Kerberos (or NTLM) without having to configure constrained delegation.</span></span>  
>   
>  <span data-ttu-id="fa05d-114">La delegación restringida de Kerberos es necesaria si la identidad del usuario tiene que fluir en varias conexiones de equipo (lo que se conoce como "salto doble").</span><span class="sxs-lookup"><span data-stu-id="fa05d-114">Kerberos constrained delegation is required if the user identity has to flow over multiple computer connections (known as "double-hop").</span></span> <span data-ttu-id="fa05d-115">Cuando el acceso de datos de Analysis Services depende de la identidad de usuario y la solicitud de conexión procede de un servicio de delegación, use la lista de comprobación de la sección siguiente para asegurarse de que Analysis Services puede suplantar al autor de la llamada original.</span><span class="sxs-lookup"><span data-stu-id="fa05d-115">When Analysis Services data access is contingent upon user identity, and the connection request is from a delegating service, use the checklist in the next section to ensure that Analysis Services is able to impersonate the original caller.</span></span> <span data-ttu-id="fa05d-116">Para obtener más información sobre los flujos de autenticación de Analysis Services, vea [Autenticación y delegación de identidad de Microsoft BI](https://go.microsoft.com/fwlink/?LinkID=286576).</span><span class="sxs-lookup"><span data-stu-id="fa05d-116">For more information about Analysis Services authentication flows, see [Microsoft BI Authentication and Identity Delegation](https://go.microsoft.com/fwlink/?LinkID=286576).</span></span>  
>   
>  <span data-ttu-id="fa05d-117">Por seguridad, Microsoft siempre recomienda la delegación restringida más que la no restringida.</span><span class="sxs-lookup"><span data-stu-id="fa05d-117">As a security best practice, Microsoft always recommends constrained delegation over unconstrained delegation.</span></span> <span data-ttu-id="fa05d-118">La delegación no restringida supone un riesgo de seguridad mayor, porque permite que la identidad del servicio suplante a otros usuarios en *cualquier* equipo, servicio o aplicación de nivel inferior (en oposición a los servicios explícitamente definidos mediante delegación restringida).</span><span class="sxs-lookup"><span data-stu-id="fa05d-118">Unconstrained delegation is a major security risk because it allows the service identity to impersonate another user on *any* downstream computer, service, or application (as opposed to just those services explicitly defined via constrained delegation).</span></span>  
  
##  <a name="allow-analysis-services-to-impersonate-a-user-identity"></a><a name="bkmk_impersonate"></a><span data-ttu-id="fa05d-119">Permitir que Analysis Services suplante una identidad de usuario</span><span class="sxs-lookup"><span data-stu-id="fa05d-119">Allow Analysis Services to impersonate a user identity</span></span>  
 <span data-ttu-id="fa05d-120">Para permitir que los servicios de nivel superior como Reporting Services, IIS o SharePoint suplanten una identidad de usuario en Analysis Services, debe configurar la delegación restringida de Kerberos para dichos servicios.</span><span class="sxs-lookup"><span data-stu-id="fa05d-120">To allow up-level services such as Reporting Services, IIS, or SharePoint to impersonate a user identity on Analysis Services, you must configure Kerberos constrained delegation for those services.</span></span> <span data-ttu-id="fa05d-121">En este escenario, Analysis Services suplanta al usuario actual usando la identidad que proporciona el servicio de delegación, devolviendo resultados según la pertenencia a roles de esa identidad de usuario.</span><span class="sxs-lookup"><span data-stu-id="fa05d-121">In this scenario, Analysis Services impersonates the current user using the identity provided by the delegating service, returning results based on role membership of that user identity.</span></span>  
  
|<span data-ttu-id="fa05d-122">Tarea</span><span class="sxs-lookup"><span data-stu-id="fa05d-122">Task</span></span>|<span data-ttu-id="fa05d-123">Descripción</span><span class="sxs-lookup"><span data-stu-id="fa05d-123">Description</span></span>|  
|----------|-----------------|  
|<span data-ttu-id="fa05d-124">Paso 1: Comprobación de que las cuentas son adecuadas para la delegación</span><span class="sxs-lookup"><span data-stu-id="fa05d-124">Step 1: Verify that accounts are suitable for delegation</span></span>|<span data-ttu-id="fa05d-125">Asegúrese de que las cuentas empleadas para ejecutar los servicios tienen las propiedades correctas en Active Directory.</span><span class="sxs-lookup"><span data-stu-id="fa05d-125">Ensure that the accounts used to run the services have the correct properties in Active Directory.</span></span> <span data-ttu-id="fa05d-126">Las cuentas de servicio de Active Directory no se deben marcar como cuentas confidenciales ni excluir específicamente de los escenarios de delegación.</span><span class="sxs-lookup"><span data-stu-id="fa05d-126">Service accounts in Active Directory must not be marked as sensitive accounts, or specifically excluded from delegation scenarios.</span></span> <span data-ttu-id="fa05d-127">Para obtener más información, vea [Información acerca de las cuentas de usuario](https://go.microsoft.com/fwlink/?LinkId=235818).</span><span class="sxs-lookup"><span data-stu-id="fa05d-127">For more information, see [Understanding User Accounts](https://go.microsoft.com/fwlink/?LinkId=235818).</span></span><br /><br /> <span data-ttu-id="fa05d-128">Importante en general, todas las cuentas y servidores deben pertenecer al mismo Active Directory dominio o a dominios de confianza del mismo bosque. \*\* \* \* \* \* \*\*</span><span class="sxs-lookup"><span data-stu-id="fa05d-128">**\*\* Important \*\*** Generally, all accounts and servers must belong to the same Active Directory domain or to trusted domains in the same forest.</span></span> <span data-ttu-id="fa05d-129">Sin embargo, dado que Windows Server 2012 admite la delegación entre límites de dominio, podrá configurar la delegación limitada de Kerberos en un límite de dominio si el nivel funcional de este dominio es Windows Server 2012.</span><span class="sxs-lookup"><span data-stu-id="fa05d-129">However, because Windows Server 2012 supports delegation across domain boundaries, you can configure Kerberos constrained delegation across a domain boundary if the domain functional level is Windows Server 2012.</span></span> <span data-ttu-id="fa05d-130">O bien, puede configurar Analysis Services para tener acceso HTTP y usar métodos de autenticación de IIS en la conexión de cliente.</span><span class="sxs-lookup"><span data-stu-id="fa05d-130">Another alternative is to configure Analysis Services for HTTP access and use IIS authentication methods on the client connection.</span></span> <span data-ttu-id="fa05d-131">Para obtener más información, vea [Configurar el acceso HTTP a Analysis Services en Internet Information Services &#40;IIS&#41; 8.0](configure-http-access-to-analysis-services-on-iis-8-0.md).</span><span class="sxs-lookup"><span data-stu-id="fa05d-131">For more information, see [Configure HTTP Access to Analysis Services on Internet Information Services &#40;IIS&#41; 8.0](configure-http-access-to-analysis-services-on-iis-8-0.md).</span></span>|  
|<span data-ttu-id="fa05d-132">Paso 2: Registro del SPN</span><span class="sxs-lookup"><span data-stu-id="fa05d-132">Step 2: Register the SPN</span></span>|<span data-ttu-id="fa05d-133">Antes de configurar una delegación, es preciso que registre un nombre principal de servicio (SPN) para la instancia de Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="fa05d-133">Before setting up constrained delegation, you must register a Service Principle Name (SPN) for the Analysis Services instance.</span></span> <span data-ttu-id="fa05d-134">Necesitará configurar el SPN de Analysis Services en el momento que configure la delegación restringida de Kerberos para servicios de nivel intermedio.</span><span class="sxs-lookup"><span data-stu-id="fa05d-134">You will need the Analysis Services SPN when configuring Kerberos constrained delegation for middle tier services.</span></span> <span data-ttu-id="fa05d-135">Para obtener instrucciones, vea [SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md) .</span><span class="sxs-lookup"><span data-stu-id="fa05d-135">See [SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md) for instructions.</span></span><br /><br /> <span data-ttu-id="fa05d-136">Un nombre principal del servicio (SPN) especifica la identidad única de un servicio en un dominio configurado para la autenticación Kerberos.</span><span class="sxs-lookup"><span data-stu-id="fa05d-136">A Service Principle Name (SPN) specifies the unique identity of a service in a domain configured for Kerberos authentication.</span></span> <span data-ttu-id="fa05d-137">Las conexiones de cliente que usan seguridad integrada suelen solicitar un SPN como parte de la autenticación SSPI.</span><span class="sxs-lookup"><span data-stu-id="fa05d-137">Client connections using integrated security often request an SPN as part of SSPI authentication.</span></span> <span data-ttu-id="fa05d-138">La solicitud se reenvía a un controlador de dominio (DC) de Active Directory y el KDC concede un vale si el SPN presentado por el cliente tiene un registro SPN coincidente en Active Directory.</span><span class="sxs-lookup"><span data-stu-id="fa05d-138">The request is forwarded to an Active Directory Domain Controller (DC), with the KDC granting a ticket if the SPN presented by the client has a matching SPN registration in Active Directory.</span></span>|  
|<span data-ttu-id="fa05d-139">Paso 3: Configuración de la delegación restringida</span><span class="sxs-lookup"><span data-stu-id="fa05d-139">Step 3: Configure constrained delegation</span></span>|<span data-ttu-id="fa05d-140">Tras validar las cuentas que desea usar y registrar los SPN para esas cuentas, el siguiente paso es configurar los servicios de nivel superior, como IIS, Reporting Services o servicios Web de SharePoint para la delegación restringida, para lo cual, hay que especificar el SPN de Analysis Services como el servicio específico para el que se permite la delegación.</span><span class="sxs-lookup"><span data-stu-id="fa05d-140">After validating the accounts you want to use and registering SPNs for those accounts, your next step is to configure up-level services, such as IIS, Reporting Services, or SharePoint web services for constrained delegation, specifying the Analysis Services SPN as the specific service for which delegation is allowed.</span></span><br /><br /> <span data-ttu-id="fa05d-141">Los servicios que se ejecutan en SharePoint, como Excel Services o Reporting Services en modo de SharePoint, suelen hospedar libros e informes que usan datos multidimensionales o tabulares de Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="fa05d-141">Services that run in SharePoint, such as Excel Services or Reporting Services in SharePoint mode, often host workbooks and reports that consume Analysis Services multidimensional or tabular data.</span></span> <span data-ttu-id="fa05d-142">La configuración de la delegación restringida para estos servicios es una tarea de configuración frecuente y es necesaria para admitir la actualización de datos desde Excel Services.</span><span class="sxs-lookup"><span data-stu-id="fa05d-142">Configuring constrained delegation for these services is a common configuration task, and necessary for supporting data refresh from Excel Services.</span></span> <span data-ttu-id="fa05d-143">Los vínculos siguientes proporcionan instrucciones para los servicios de SharePoint así como otros que es probable que presenten una conexión de flujo de datos de nivel inferior para los datos de Analysis Services:</span><span class="sxs-lookup"><span data-stu-id="fa05d-143">The following links provide instructions for SharePoint services, as well as other services likely to present a downstream data connection request for Analysis Services data:</span></span><br /><br /> <span data-ttu-id="fa05d-144">[Delegación de identidad para Servicios de Excel (SharePoint Server 2010)](https://go.microsoft.com/fwlink/?LinkId=299826) o [Cómo configurar Excel Services en SharePoint Server 2010 para la autenticación Kerberos](https://support.microsoft.com/kb/2466519)</span><span class="sxs-lookup"><span data-stu-id="fa05d-144">[Identity delegation for Excel Services (SharePoint Server 2010)](https://go.microsoft.com/fwlink/?LinkId=299826) or [How to configure Excel Services in SharePoint Server 2010 for Kerberos authentication](https://support.microsoft.com/kb/2466519)</span></span><br /><br /> [<span data-ttu-id="fa05d-145">Delegación de identidad para PerformancePoint Services (SharePoint Server 2010)</span><span class="sxs-lookup"><span data-stu-id="fa05d-145">Identity delegation for PerformancePoint Services (SharePoint Server 2010)</span></span>](https://go.microsoft.com/fwlink/?LinkId=299827)<br /><br /> [<span data-ttu-id="fa05d-146">Delegación de identidad de SQL Server Reporting Services (SharePoint Server 2010)</span><span class="sxs-lookup"><span data-stu-id="fa05d-146">Identity delegation for SQL Server Reporting Services (SharePoint Server 2010)</span></span>](https://go.microsoft.com/fwlink/?LinkId=299828)<br /><br /> <span data-ttu-id="fa05d-147">Para IIS 7.0, vea [Configurar la autenticación de Windows (IIS 7.0)](https://technet.microsoft.com/library/cc754628\(v=ws.10\).aspx) o [Cómo configurar SQL Server 2008 Analysis Services y SQL Server 2005 Analysis Services para utilizar autenticación Kerberos](https://support.microsoft.com/kb/917409).</span><span class="sxs-lookup"><span data-stu-id="fa05d-147">For IIS 7.0 see [Configure Windows Authentication (IIS 7.0)](https://technet.microsoft.com/library/cc754628\(v=ws.10\).aspx) or [How to configure SQL Server 2008 Analysis Services and SQL Server 2005 Analysis Services to use Kerberos authentication](https://support.microsoft.com/kb/917409).</span></span>|  
|<span data-ttu-id="fa05d-148">Paso 4: Prueba de conexiones</span><span class="sxs-lookup"><span data-stu-id="fa05d-148">Step 4: Test connections</span></span>|<span data-ttu-id="fa05d-149">Cuando lo pruebe, conéctese desde equipos remotos, con distintas identidades y haga consultas a Analysis Services con las mismas aplicaciones como usuario empresarial.</span><span class="sxs-lookup"><span data-stu-id="fa05d-149">When testing, connect from remote computers, under different identities, and query Analysis Services using the same applications as business users.</span></span> <span data-ttu-id="fa05d-150">Puede servirse de SQL Server Profiler para supervisar la conexión.</span><span class="sxs-lookup"><span data-stu-id="fa05d-150">You can use SQL Server Profiler to monitor the connection.</span></span> <span data-ttu-id="fa05d-151">En la solicitud, se debe ver la identidad del usuario.</span><span class="sxs-lookup"><span data-stu-id="fa05d-151">You should see the user identity on the request.</span></span> <span data-ttu-id="fa05d-152">Para obtener más información, vea [Probar la identidad suplantada o delegada](#bkmk_test) en esta sección.</span><span class="sxs-lookup"><span data-stu-id="fa05d-152">For more information, see [Test for impersonated or delegated identity](#bkmk_test) in this section.</span></span>|  
  
##  <a name="configure-analysis-services-for-trusted-delegation"></a><a name="bkmk_delegate"></a><span data-ttu-id="fa05d-153">Configurar Analysis Services para la delegación de confianza</span><span class="sxs-lookup"><span data-stu-id="fa05d-153">Configure Analysis Services for trusted delegation</span></span>  
 <span data-ttu-id="fa05d-154">La configuración de Analysis Services para delegación restringida de Kerberos permite al servicio suplantar una identidad de cliente en un servicio de nivel inferior, como el motor de base de datos relacional, para poder consultar datos como si el cliente se conectara directamente.</span><span class="sxs-lookup"><span data-stu-id="fa05d-154">Configuring Analysis Services for Kerberos constrained delegation allows the service to impersonate a client identity on a down-level service, such as the relational database engine, so that data can be queried as if the client was connected directly.</span></span>  
  
 <span data-ttu-id="fa05d-155">Los escenarios de delegación para Analysis Services están limitados a los modelos tabulares configurados para el modo `DirectQuery`.</span><span class="sxs-lookup"><span data-stu-id="fa05d-155">Delegation scenarios for Analysis Services are limited to tabular models configured for `DirectQuery` mode.</span></span> <span data-ttu-id="fa05d-156">Este es el único escenario en el que Analysis Services puede pasar credenciales delegadas a otro servicio.</span><span class="sxs-lookup"><span data-stu-id="fa05d-156">This is the only scenario in which Analysis Services can pass delegated credentials to another service.</span></span> <span data-ttu-id="fa05d-157">En el resto de situaciones, como en las situaciones de SharePoint mencionadas en la sección anterior, Analysis Services está en el lado receptor de la cadena de delegación.</span><span class="sxs-lookup"><span data-stu-id="fa05d-157">In all other scenarios, such as SharePoint scenarios mentioned in the previous section, Analysis Services is on the receiving end of the delegation chain.</span></span> <span data-ttu-id="fa05d-158">Para obtener más información sobre DirectQuery, vea [Modo DirectQuery &#40;SSAS tabular&#41;](../tabular-models/directquery-mode-ssas-tabular.md).</span><span class="sxs-lookup"><span data-stu-id="fa05d-158">For more information about DirectQuery, see [DirectQuery Mode &#40;SSAS Tabular&#41;](../tabular-models/directquery-mode-ssas-tabular.md).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="fa05d-159">Una idea equivocada habitual es que el almacenamiento ROLAP, las operaciones de procesamiento o el acceso a particiones remotas de alguna manera añaden requisitos para la delegación restringida.</span><span class="sxs-lookup"><span data-stu-id="fa05d-159">A common misconception is that ROLAP storage, processing operations, or access to remote partitions somehow introduce requirements for constrained delegation.</span></span> <span data-ttu-id="fa05d-160">Esto no es así.</span><span class="sxs-lookup"><span data-stu-id="fa05d-160">This is not the case.</span></span> <span data-ttu-id="fa05d-161">Todas estas operaciones las ejecuta directamente la cuenta de servicio (también llamada cuenta de procesamiento) en su propio nombre.</span><span class="sxs-lookup"><span data-stu-id="fa05d-161">All of these operations are executed directly by the service account (also referred to as the processing account), on its own behalf.</span></span> <span data-ttu-id="fa05d-162">No se requiere delegación para estas operaciones en Analysis Services, ya que los permisos para estas operaciones se otorgan directamente a la cuenta de servicio (por ejemplo, otorgar permisos db_datareader en la base de datos relacional para que el servicio pueda procesar los datos).</span><span class="sxs-lookup"><span data-stu-id="fa05d-162">Delegation is not required for these operations in Analysis Services, given that permissions for such operations are granted directly to the service account (for example, granting db_datareader permissions on the relational database so that the service can process data).</span></span> <span data-ttu-id="fa05d-163">Para obtener más información sobre las operaciones del servidor y los permisos, vea [Configurar las cuentas de servicio &#40;Analysis Services&#41;](configure-service-accounts-analysis-services.md).</span><span class="sxs-lookup"><span data-stu-id="fa05d-163">For more information about server operations and permissions, see [Configure Service Accounts &#40;Analysis Services&#41;](configure-service-accounts-analysis-services.md).</span></span>  
  
 <span data-ttu-id="fa05d-164">En esta sección se explica cómo configurar Analysis Services para la delegación de confianza.</span><span class="sxs-lookup"><span data-stu-id="fa05d-164">This section explains how to set up Analysis Services for trusted delegation.</span></span> <span data-ttu-id="fa05d-165">Después de completar esta tarea, Analysis Services podrá pasar credenciales delegadas a SQL Server, en apoyo al modo DirectQuery usado en las soluciones tabulares.</span><span class="sxs-lookup"><span data-stu-id="fa05d-165">After you complete this task, Analysis Services will be able to pass delegated credentials to SQL Server, in support of DirectQuery mode used in Tabular solutions.</span></span>  
  
 <span data-ttu-id="fa05d-166">Antes de comenzar:</span><span class="sxs-lookup"><span data-stu-id="fa05d-166">Before you start:</span></span>  
  
-   <span data-ttu-id="fa05d-167">Compruebe que Analysis Services se ha iniciado.</span><span class="sxs-lookup"><span data-stu-id="fa05d-167">Verify that Analysis Services is started.</span></span>  
  
-   <span data-ttu-id="fa05d-168">Compruebe que el SPN para Analysis Services es válido.</span><span class="sxs-lookup"><span data-stu-id="fa05d-168">Verify the SPN registered for Analysis Services is valid.</span></span> <span data-ttu-id="fa05d-169">Para obtener instrucciones, vea [SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md).</span><span class="sxs-lookup"><span data-stu-id="fa05d-169">For instructions, see [SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md)</span></span>  
  
 <span data-ttu-id="fa05d-170">Cuando se cumplan ambos requisitos previos, continúe con los pasos siguientes.</span><span class="sxs-lookup"><span data-stu-id="fa05d-170">When both prerequisites are satisfied, continue with the following steps.</span></span> <span data-ttu-id="fa05d-171">Tenga en cuenta que debe ser administrador de dominio para poder configurar la delegación restringida.</span><span class="sxs-lookup"><span data-stu-id="fa05d-171">Note that you must be a domain administrator to set up constrained delegation.</span></span>  
  
1.  <span data-ttu-id="fa05d-172">En Usuarios y equipos de Active Directory, busque la cuenta de servicio bajo la que se ejecuta Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="fa05d-172">In Active Directory Users and Computers, find the service account under which Analysis Services runs.</span></span> <span data-ttu-id="fa05d-173">Haga clic con el botón derecho en la cuenta de servicio y elija **Propiedades**.</span><span class="sxs-lookup"><span data-stu-id="fa05d-173">Right-click the service account and choose **Properties**.</span></span>  
  
     <span data-ttu-id="fa05d-174">Con fines ilustrativos, las capturas de pantalla siguientes usan OlapSvc y SQLSvc para representar Analysis Services y SQL Server, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="fa05d-174">For illustrative purposes, the following screenshots use OlapSvc and SQLSvc to represent Analysis Services and SQL Server, respectively.</span></span>  
  
     <span data-ttu-id="fa05d-175">OlapSvc es la cuenta que se configurará para la delegación restringida en SQLSvc.</span><span class="sxs-lookup"><span data-stu-id="fa05d-175">OlapSvc is the account that will be configured for constrained delegation to SQLSvc.</span></span> <span data-ttu-id="fa05d-176">Al completar esta tarea, OlapSvc tendrá permiso para pasar credenciales delegadas en un vale de servicio a SQLSvc, suplantando al autor de la llamada original cuando se soliciten datos.</span><span class="sxs-lookup"><span data-stu-id="fa05d-176">When you complete this task, OlapSvc will have permission to pass delegated credentials on a service ticket to SQLSvc, impersonating the original caller when requesting data.</span></span>  
  
2.  <span data-ttu-id="fa05d-177">En la pestaña Delegación, seleccione **Confiar en este usuario para la delegación solo a los servicios especificados**y, después, seleccione **Usar solamente Kerberos**.</span><span class="sxs-lookup"><span data-stu-id="fa05d-177">On the Delegation tab, select **Trust this user for delegation to specified services only**, followed by **Use Kerberos only**.</span></span> <span data-ttu-id="fa05d-178">Haga clic en **Agregar** para especificar el servicio para el que Analysis Services tiene permiso para delegar credenciales.</span><span class="sxs-lookup"><span data-stu-id="fa05d-178">Click **Add** to specify which service Analysis Services is permitted to delegate credentials.</span></span>  
  
     <span data-ttu-id="fa05d-179">La pestaña Delegación solo aparece cuando la cuenta de usuario (OlapSvc) está asignada a un servicio (Analysis Services) y el servicio tiene un SPN registrado para él.</span><span class="sxs-lookup"><span data-stu-id="fa05d-179">Delegation tab appears only when the user account (OlapSvc) is assigned to a service (Analysis Services), and the service has an SPN registered for it.</span></span> <span data-ttu-id="fa05d-180">El registro de SPN necesita que el servicio esté en ejecución.</span><span class="sxs-lookup"><span data-stu-id="fa05d-180">SPN registration requires that the service is running.</span></span>  
  
     <span data-ttu-id="fa05d-181">![SSAS_Kerberos_1_AccountProperties](../media/ssas-kerberos-1-accountproperties.gif "SSAS_Kerberos_1_AccountProperties")</span><span class="sxs-lookup"><span data-stu-id="fa05d-181">![SSAS_Kerberos_1_AccountProperties](../media/ssas-kerberos-1-accountproperties.gif "SSAS_Kerberos_1_AccountProperties")</span></span>  
  
3.  <span data-ttu-id="fa05d-182">En la página Agregar servicios, haga clic en **Usuarios o equipos**.</span><span class="sxs-lookup"><span data-stu-id="fa05d-182">On the Add Services page, click **Users or Computers**.</span></span>  
  
     <span data-ttu-id="fa05d-183">![SSAS_Kerberos_2_](../media/ssas-kerberos-2.gif "SSAS_Kerberos_2_")</span><span class="sxs-lookup"><span data-stu-id="fa05d-183">![SSAS_Kerberos_2_](../media/ssas-kerberos-2.gif "SSAS_Kerberos_2_")</span></span>  
  
4.  <span data-ttu-id="fa05d-184">En la página Seleccionar usuarios o equipos, escriba la cuenta usada para ejecutar la instancia de SQL Server que proporciona datos a bases de datos de modelos tabulares de Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="fa05d-184">On the Select Users or Computer page, enter the account used to run the SQL Server instance providing data to Analysis Services tabular model databases.</span></span> <span data-ttu-id="fa05d-185">Haga clic en **Aceptar** para aceptar la cuenta de servicio.</span><span class="sxs-lookup"><span data-stu-id="fa05d-185">Click **OK** to accept the service account.</span></span>  
  
     <span data-ttu-id="fa05d-186">Si no puede seleccionar la cuenta que desea, compruebe que SQL Server está en ejecución y tiene un SPN registrado para esta cuenta.</span><span class="sxs-lookup"><span data-stu-id="fa05d-186">If you cannot select the account you want, verify that SQL Server is running and has an SPN registered for that account.</span></span> <span data-ttu-id="fa05d-187">Para obtener más información acerca de los SPN para el motor de base de datos, vea [Registrar un nombre principal de servicio para las conexiones con Kerberos](../../database-engine/configure-windows/register-a-service-principal-name-for-kerberos-connections.md).</span><span class="sxs-lookup"><span data-stu-id="fa05d-187">For more information about SPNs for the database engine, see [Register a Service Principal Name for Kerberos Connections](../../database-engine/configure-windows/register-a-service-principal-name-for-kerberos-connections.md).</span></span>  
  
     <span data-ttu-id="fa05d-188">![SSAS_Kerberos_3_SelectUsers](../media/ssas-kerberos-3-selectusers.gif "SSAS_Kerberos_3_SelectUsers")</span><span class="sxs-lookup"><span data-stu-id="fa05d-188">![SSAS_Kerberos_3_SelectUsers](../media/ssas-kerberos-3-selectusers.gif "SSAS_Kerberos_3_SelectUsers")</span></span>  
  
5.  <span data-ttu-id="fa05d-189">La instancia de SQL Server debe aparecer ahora en Agregar servicios.</span><span class="sxs-lookup"><span data-stu-id="fa05d-189">The SQL Server instance should now appear in Add Services.</span></span> <span data-ttu-id="fa05d-190">En la lista también aparecerán todos los servicios que usan también esa cuenta.</span><span class="sxs-lookup"><span data-stu-id="fa05d-190">Any service also using that account will also appear in the list.</span></span> <span data-ttu-id="fa05d-191">Elija la instancia de SQL Server que desee usar.</span><span class="sxs-lookup"><span data-stu-id="fa05d-191">Choose the SQL Server instance you want to use.</span></span> <span data-ttu-id="fa05d-192">Haga clic en **Aceptar** para aceptar la instancia.</span><span class="sxs-lookup"><span data-stu-id="fa05d-192">Click **OK** to accept the instance.</span></span>  
  
     <span data-ttu-id="fa05d-193">![SSAS_Kerberos_4_](../media/ssas-kerberos-4.gif "SSAS_Kerberos_4_")</span><span class="sxs-lookup"><span data-stu-id="fa05d-193">![SSAS_Kerberos_4_](../media/ssas-kerberos-4.gif "SSAS_Kerberos_4_")</span></span>  
  
6.  <span data-ttu-id="fa05d-194">La página de propiedades del servicio Analysis Services debe ser similar ahora a la captura de pantalla siguiente.</span><span class="sxs-lookup"><span data-stu-id="fa05d-194">The properties page of the Analysis Services service account should now look similar to the following screenshot.</span></span> <span data-ttu-id="fa05d-195">Haga clic en **Aceptar** para guardar los cambios.</span><span class="sxs-lookup"><span data-stu-id="fa05d-195">Click **OK** to save your changes.</span></span>  
  
     <span data-ttu-id="fa05d-196">![SSAS_Kerberos_5_Finished](../media/ssas-kerberos-5-finished.gif "SSAS_Kerberos_5_Finished")</span><span class="sxs-lookup"><span data-stu-id="fa05d-196">![SSAS_Kerberos_5_Finished](../media/ssas-kerberos-5-finished.gif "SSAS_Kerberos_5_Finished")</span></span>  
  
7.  <span data-ttu-id="fa05d-197">Pruebe si la delegación se ha realizado correctamente conectándose desde un equipo cliente remoto, con una identidad diferente, y consulte el modelo tabular.</span><span class="sxs-lookup"><span data-stu-id="fa05d-197">Test for successful delegation by connecting from a remote client computer, under a different identity, and query the tabular model.</span></span> <span data-ttu-id="fa05d-198">Debe ver la identidad de usuario de la solicitud en SQL Server Profiler.</span><span class="sxs-lookup"><span data-stu-id="fa05d-198">You should see the user identity on the request in SQL Server Profiler.</span></span>  
  
##  <a name="test-for-impersonated-or-delegated-identity"></a><a name="bkmk_test"></a><span data-ttu-id="fa05d-199">Prueba de la identidad suplantada o delegada</span><span class="sxs-lookup"><span data-stu-id="fa05d-199">Test for impersonated or delegated identity</span></span>  
 <span data-ttu-id="fa05d-200">Use SQL Server Profiler para supervisar la identidad del usuario que está consultando datos.</span><span class="sxs-lookup"><span data-stu-id="fa05d-200">Use SQL Server Profiler to monitor the identity of the user who is querying data.</span></span>  
  
1.  <span data-ttu-id="fa05d-201">Inicie **SQL Server Profiler** en la instancia de Analysis Services e inicie después un nuevo seguimiento.</span><span class="sxs-lookup"><span data-stu-id="fa05d-201">Start **SQL Server Profiler** on the Analysis Services instance and then start a new trace.</span></span>  
  
2.  <span data-ttu-id="fa05d-202">En Selección de eventos, compruebe que `Audit Login` y `Audit Logout` están activadas en la sección Auditoría de seguridad.</span><span class="sxs-lookup"><span data-stu-id="fa05d-202">In Events Selection, verify that `Audit Login` and `Audit Logout` are checked in the Security Audit section.</span></span>  
  
3.  <span data-ttu-id="fa05d-203">Conéctese a Analysis Services a través de un servicio de aplicación (como SharePoint o Reporting Services) desde un equipo cliente remoto.</span><span class="sxs-lookup"><span data-stu-id="fa05d-203">Connect to Analysis Services via an application service (such as SharePoint or Reporting Services) from a remote client computer.</span></span> <span data-ttu-id="fa05d-204">El evento Audit Login mostrará la identidad del usuario que se conecta a Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="fa05d-204">The Audit Login event will show the identity of the user connecting to Analysis Services.</span></span>  
  
 <span data-ttu-id="fa05d-205">Para realizar una prueba completa será necesario usar herramientas de supervisión de red que puedan capturar las solicitudes y respuestas de Kerberos en la red.</span><span class="sxs-lookup"><span data-stu-id="fa05d-205">Thorough testing will require the use of network monitoring tools that can capture Kerberos requests and responses on the network.</span></span> <span data-ttu-id="fa05d-206">Para esta tarea se puede emplear la utilidad Monitor de red (netmon.exe), filtrada para Kerberos.</span><span class="sxs-lookup"><span data-stu-id="fa05d-206">The Network Monitor utility (netmon.exe), filtered for Kerberos, can be used for this task.</span></span> <span data-ttu-id="fa05d-207">Para obtener más información sobre cómo usar Netmon 3.4 y otras herramientas para probar la autenticación de Kerberos, vea [Configuración de la autenticación Kerberos: Configuración principal (SharePoint Server 2010)](https://technet.microsoft.com/library/gg502602\(v=office.14\).aspx).</span><span class="sxs-lookup"><span data-stu-id="fa05d-207">For more information about using Netmon 3.4 and other tools for testing Kerberos authentication, see [Configuring Kerberos authentication: Core configuration (SharePoint Server 2010)](https://technet.microsoft.com/library/gg502602\(v=office.14\).aspx).</span></span>  
  
 <span data-ttu-id="fa05d-208">Vea también [El cuadro de diálogo más confuso de Active Directory](https://www.itprotoday.com/active-directory/most-confusing-dialog-box-active-directory) para obtener una descripción detallada de cada opción de la pestaña Delegación del cuadro de diálogo de la propiedad del objeto Active Directory.</span><span class="sxs-lookup"><span data-stu-id="fa05d-208">Additionally, see [The Most Confusing Dialog Box in Active Directory](https://www.itprotoday.com/active-directory/most-confusing-dialog-box-active-directory) for a thorough description of each option in the Delegation tab of the Active Directory object's property dialog box.</span></span> <span data-ttu-id="fa05d-209">Este artículo también explica cómo utilizar el LDP para comprobar e interpretar los resultados de la prueba.</span><span class="sxs-lookup"><span data-stu-id="fa05d-209">This article also explains how to use LDP to test and interpret test results.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="fa05d-210">Consulte también</span><span class="sxs-lookup"><span data-stu-id="fa05d-210">See Also</span></span>  
 <span data-ttu-id="fa05d-211">[Autenticación y delegación de identidad de Microsoft BI](https://go.microsoft.com/fwlink/?LinkID=286576) </span><span class="sxs-lookup"><span data-stu-id="fa05d-211">[Microsoft BI Authentication and Identity Delegation](https://go.microsoft.com/fwlink/?LinkID=286576) </span></span>  
 <span data-ttu-id="fa05d-212">[Autenticación mutua con Kerberos](https://go.microsoft.com/fwlink/?LinkId=299283) </span><span class="sxs-lookup"><span data-stu-id="fa05d-212">[Mutual Authentication Using Kerberos](https://go.microsoft.com/fwlink/?LinkId=299283) </span></span>  
 <span data-ttu-id="fa05d-213">[Conectarse a Analysis Services](connect-to-analysis-services.md) </span><span class="sxs-lookup"><span data-stu-id="fa05d-213">[Connect to Analysis Services](connect-to-analysis-services.md) </span></span>  
 <span data-ttu-id="fa05d-214">[Registro de SPN para una instancia de Analysis Services](spn-registration-for-an-analysis-services-instance.md) </span><span class="sxs-lookup"><span data-stu-id="fa05d-214">[SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md) </span></span>  
 [<span data-ttu-id="fa05d-215">Propiedades de cadena de conexión &#40;Analysis Services&#41;</span><span class="sxs-lookup"><span data-stu-id="fa05d-215">Connection String Properties &#40;Analysis Services&#41;</span></span>](connection-string-properties-analysis-services.md)  
  
  
