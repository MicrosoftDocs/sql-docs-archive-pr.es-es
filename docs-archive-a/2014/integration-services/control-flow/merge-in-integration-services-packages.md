---
title: MERGE en paquetes de Integration Services | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
helpviewer_keywords:
- MERGE statement [SQL Server]
ms.assetid: 7e44a5c2-e6d6-4fe2-a079-4f95ccdb147b
author: chugugrace
ms.author: chugu
ms.openlocfilehash: cc6de738d44b91a9e2a4885978ba4a46dfede8cf
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87671610"
---
# <a name="merge-in-integration-services-packages"></a><span data-ttu-id="1eeae-102">MERGE en paquetes de Integration Services</span><span class="sxs-lookup"><span data-stu-id="1eeae-102">MERGE in Integration Services Packages</span></span>
  <span data-ttu-id="1eeae-103">En la versión actual de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)][!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)], la instrucción SQL de una tarea Ejecutar SQL puede contener una instrucción MERGE.</span><span class="sxs-lookup"><span data-stu-id="1eeae-103">In the current release of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)][!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)], the SQL statement in an Execute SQL task can contain a MERGE statement.</span></span> <span data-ttu-id="1eeae-104">Esta instrucción MERGE permite llevar a cabo varias operaciones INSERT, UPDATE y DELETE en una única instrucción.</span><span class="sxs-lookup"><span data-stu-id="1eeae-104">This MERGE statement enables you to accomplish multiple INSERT, UPDATE, and DELETE operations in a single statement.</span></span>  
  
 <span data-ttu-id="1eeae-105">Para utilizar la instrucción MERGE en un paquete, siga estos pasos:</span><span class="sxs-lookup"><span data-stu-id="1eeae-105">To use the MERGE statement in a package, follow these steps:</span></span>  
  
-   <span data-ttu-id="1eeae-106">Cree una tarea Flujo de datos que cargue, transforme y guarde los datos de origen en una tabla temporal o de ensayo.</span><span class="sxs-lookup"><span data-stu-id="1eeae-106">Create a Data Flow task that loads, transforms, and saves the source data to a temporary or staging table.</span></span>  
  
-   <span data-ttu-id="1eeae-107">Cree una tarea Ejecutar SQL que incluya la instrucción MERGE.</span><span class="sxs-lookup"><span data-stu-id="1eeae-107">Create an Execute SQL task that contains the MERGE statement.</span></span>  
  
-   <span data-ttu-id="1eeae-108">Conecte la tarea Flujo de datos a la tarea Ejecutar SQL, y use los datos de la tabla de ensayo como entrada para la instrucción MERGE.</span><span class="sxs-lookup"><span data-stu-id="1eeae-108">Connect the Data Flow task to the Execute SQL task, and use the data in the staging table as the input for the MERGE statement.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="1eeae-109">Aunque una instrucción MERGE normalmente requiere una tabla de ensayo en este escenario, generalmente ofrece un mayor rendimiento que el de la búsqueda fila por fila realizada por la transformación Búsqueda.</span><span class="sxs-lookup"><span data-stu-id="1eeae-109">Although a MERGE statement typically requires a staging table in this scenario, the performance of the MERGE statement usually exceeds that of the row-by-row lookup performed by the Lookup transformation.</span></span> <span data-ttu-id="1eeae-110">La instrucción MERGE también resulta útil cuando el gran tamaño de una tabla de búsqueda pondría a prueba la memoria que la transformación de búsquedas puede usar para almacenar en caché su tabla de referencia.</span><span class="sxs-lookup"><span data-stu-id="1eeae-110">MERGE is also useful when the large size of a lookup table would test the memory that is available to the Lookup transformation for caching its reference table.</span></span>  
  
 <span data-ttu-id="1eeae-111">El resto de este tema explica algunos usos adicionales de la instrucción MERGE.</span><span class="sxs-lookup"><span data-stu-id="1eeae-111">The remainder of this topic discusses some additional uses for the MERGE statement.</span></span>  
  
 <span data-ttu-id="1eeae-112">Para obtener un componente de destino de ejemplo que admite el uso de la instrucción MERGE, vea el ejemplo de la comunidad de CodePlex, [MERGE Destination](https://go.microsoft.com/fwlink/?LinkId=141215).</span><span class="sxs-lookup"><span data-stu-id="1eeae-112">For a sample destination component that supports the use of the MERGE statement, see the CodePlex community sample, [MERGE Destination](https://go.microsoft.com/fwlink/?LinkId=141215).</span></span>  
  
## <a name="using-merge"></a><span data-ttu-id="1eeae-113">Usar MERGE</span><span class="sxs-lookup"><span data-stu-id="1eeae-113">Using MERGE</span></span>  
 <span data-ttu-id="1eeae-114">Normalmente, la instrucción MERGE se usa cuando se desea aplicar ciertos cambios, como inserciones, actualizaciones y eliminaciones, de una tabla a otra.</span><span class="sxs-lookup"><span data-stu-id="1eeae-114">Typically, you use the MERGE statement when you want to apply changes that include inserts, updates, and deletions from one table to another table.</span></span> <span data-ttu-id="1eeae-115">En las versiones anteriores a [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)], este proceso requería una transformación Búsqueda y varias transformaciones Comando de OLE DB.</span><span class="sxs-lookup"><span data-stu-id="1eeae-115">Prior to [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)], this process required both a Lookup transformation and multiple OLE DB Command transformations.</span></span> <span data-ttu-id="1eeae-116">La transformación Búsqueda realizaba una búsqueda fila por fila para determinar si la fila era nueva o se había modificado.</span><span class="sxs-lookup"><span data-stu-id="1eeae-116">The Lookup transformation performed a row-by-row lookup to determine whether each row was new or changed.</span></span> <span data-ttu-id="1eeae-117">A continuación, las transformaciones Comando de OLE DB llevaban a cabo las operaciones INSERT, UPDATE y DELETE necesarias.</span><span class="sxs-lookup"><span data-stu-id="1eeae-117">The OLE DB Command transformations then performed the necessary INSERT, UPDATE, and DELETE operations.</span></span> <span data-ttu-id="1eeae-118">A partir de [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)], una única instrucción MERGE puede reemplazar la transformación Búsqueda y las transformaciones Comando de OLE DB correspondientes.</span><span class="sxs-lookup"><span data-stu-id="1eeae-118">Beginning in [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)], a single MERGE statement can replace both the Lookup transformation and the corresponding OLE DB Command transformations.</span></span>  
  
### <a name="merge-with-incremental-loads"></a><span data-ttu-id="1eeae-119">MERGE con cargas incrementales</span><span class="sxs-lookup"><span data-stu-id="1eeae-119">MERGE with Incremental Loads</span></span>  
 <span data-ttu-id="1eeae-120">La nueva función de [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] de captura de datos modificados facilita la realización confiable de cargas incrementales durante el almacenamiento de datos.</span><span class="sxs-lookup"><span data-stu-id="1eeae-120">The change data capture functionality that is new in [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] makes it easier to perform incremental loads reliably to a data warehouse.</span></span> <span data-ttu-id="1eeae-121">Como alternativa al uso de transformaciones Comando de OLE DB con parámetros para realizar inserciones y actualizaciones, se puede usar la instrucción MERGE para combinar ambas operaciones.</span><span class="sxs-lookup"><span data-stu-id="1eeae-121">As an alternative to using parameterized OLE DB Command transformations to perform the inserts and the updates, you can use the MERGE statement to combine both operations.</span></span>  
  
 <span data-ttu-id="1eeae-122">Para más información, vea [Aplicar los cambios al destino](../change-data-capture/apply-the-changes-to-the-destination.md).</span><span class="sxs-lookup"><span data-stu-id="1eeae-122">For more information, see [Apply the Changes to the Destination](../change-data-capture/apply-the-changes-to-the-destination.md).</span></span>  
  
#### <a name="merge-in-other-scenarios"></a><span data-ttu-id="1eeae-123">MERGE en otros escenarios</span><span class="sxs-lookup"><span data-stu-id="1eeae-123">MERGE in Other Scenarios</span></span>  
 <span data-ttu-id="1eeae-124">En los escenarios siguientes, se puede utilizar la instrucción MERGE fuera o dentro de un paquete de [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="1eeae-124">In the following scenarios, you can use the MERGE statement either outside or inside an [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] package.</span></span> <span data-ttu-id="1eeae-125">Sin embargo, a menudo se requiere un paquete de [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] para cargar estos datos desde varios orígenes heterogéneos, así como para combinarlos y limpiarlos posteriormente.</span><span class="sxs-lookup"><span data-stu-id="1eeae-125">However, an [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] package is often required to load this data from multiple heterogeneous sources, and then to combine and cleanse the data.</span></span> <span data-ttu-id="1eeae-126">Por lo tanto, puede ser interesante usar la instrucción MERGE en un paquete por su comodidad y su facilidad de mantenimiento.</span><span class="sxs-lookup"><span data-stu-id="1eeae-126">Therefore, you might consider using the MERGE statement in a package for convenience and ease of maintenance.</span></span>  
  
##### <a name="track-buying-habits"></a><span data-ttu-id="1eeae-127">Realizar un seguimiento de los hábitos de compra</span><span class="sxs-lookup"><span data-stu-id="1eeae-127">Track Buying Habits</span></span>  
 <span data-ttu-id="1eeae-128">La tabla FactBuyingHabits del almacenamiento de datos realiza un seguimiento de la última fecha en la que un cliente adquirió un determinado producto.</span><span class="sxs-lookup"><span data-stu-id="1eeae-128">The FactBuyingHabits table in the data warehouse tracks the last date on which a customer bought a given product.</span></span> <span data-ttu-id="1eeae-129">Dicha tabla consta de las columnas ProductID, CustomerID y PurchaseDate.</span><span class="sxs-lookup"><span data-stu-id="1eeae-129">The table consists of ProductID, CustomerID and PurchaseDate columns.</span></span> <span data-ttu-id="1eeae-130">Todas las semanas, la base de datos transaccional genera una tabla PurchaseRecords que incluye las compras realizadas durante la semana.</span><span class="sxs-lookup"><span data-stu-id="1eeae-130">Every week, the transactional database generates a PurchaseRecords table that includes the purchases made during that week.</span></span> <span data-ttu-id="1eeae-131">El objetivo es usar una única instrucción MERGE para combinar la información de la tabla PurchaseRecords con la de la tabla FactBuyingHabits.</span><span class="sxs-lookup"><span data-stu-id="1eeae-131">The objective is to use a single MERGE statement to merge the information in the PurchaseRecords table into the FactBuyingHabits table.</span></span> <span data-ttu-id="1eeae-132">Para los pares de producto-cliente que no existen, la instrucción MERGE inserta nuevas filas.</span><span class="sxs-lookup"><span data-stu-id="1eeae-132">For product-customer pairs that do not exist, the MERGE statement inserts new rows.</span></span> <span data-ttu-id="1eeae-133">Para los pares de producto-cliente existentes, la instrucción MERGE actualiza la fecha de compra más reciente.</span><span class="sxs-lookup"><span data-stu-id="1eeae-133">For product-customer pairs that exist, the MERGE statement updates the most recent date-of-purchase.</span></span>  
  
###### <a name="track-price-history"></a><span data-ttu-id="1eeae-134">Realizar un seguimiento del historial de precios</span><span class="sxs-lookup"><span data-stu-id="1eeae-134">Track Price History</span></span>  
 <span data-ttu-id="1eeae-135">La tabla DimBook representa la lista de libros en el inventario de un vendedor de libros e identifica el historial de precios de cada libro.</span><span class="sxs-lookup"><span data-stu-id="1eeae-135">The DimBook table represents the list of books in the inventory of a book seller and identifies the price history of each book.</span></span> <span data-ttu-id="1eeae-136">Esta tabla tiene las siguientes columnas: ISBN, ProductID, Price, Shelf e IsCurrent.</span><span class="sxs-lookup"><span data-stu-id="1eeae-136">This table has these columns: ISBN, ProductID, Price, Shelf, and IsCurrent.</span></span> <span data-ttu-id="1eeae-137">También incluye una fila para cada precio que ha tenido el libro.</span><span class="sxs-lookup"><span data-stu-id="1eeae-137">This table also has one row for each price the book has had.</span></span> <span data-ttu-id="1eeae-138">Una de estas filas contiene el precio actual.</span><span class="sxs-lookup"><span data-stu-id="1eeae-138">One of these rows contains the current price.</span></span> <span data-ttu-id="1eeae-139">Para indicar la fila que contiene el precio actual, el valor de la columna IsCurrent para dicha fila se establece en 1.</span><span class="sxs-lookup"><span data-stu-id="1eeae-139">To indicate which row contains the current price, the value of the IsCurrent column for that row is set to 1.</span></span>  
  
 <span data-ttu-id="1eeae-140">Todas las semanas, la base de datos genera una tabla denominada WeeklyChanges que contiene los cambios de precio para la semana y los libros que se han agregado durante la misma.</span><span class="sxs-lookup"><span data-stu-id="1eeae-140">Every week, the database generates a WeeklyChanges table that contains price changes for the week and new books that were added during the week.</span></span> <span data-ttu-id="1eeae-141">Una única instrucción MERGE permitirá aplicar los cambios de la tabla WeeklyChanges a la tabla DimBook.</span><span class="sxs-lookup"><span data-stu-id="1eeae-141">By using a single MERGE statement, you can apply the changes in the WeeklyChanges table to the DimBook table.</span></span> <span data-ttu-id="1eeae-142">Esta instrucción MERGE inserta nuevas filas para las nuevas adquisiciones de libros, y actualiza la columna IsCurrent a 0 en las filas de libros existentes cuyos precios han cambiado.</span><span class="sxs-lookup"><span data-stu-id="1eeae-142">The MERGE statement inserts new rows for newly-added books, and updates the IsCurrent column to 0 for rows of existing books whose prices have changed.</span></span> <span data-ttu-id="1eeae-143">Dicha instrucción también inserta nuevas filas para los libros cuyos precios han cambiado, y establece el valor de la columna IsCurrent en 1 para estas filas.</span><span class="sxs-lookup"><span data-stu-id="1eeae-143">The MERGE statement also inserts new rows for books whose prices have changed, and for these new rows, sets the value of the IsCurrent column to 1.</span></span>  
  
### <a name="merge-a-table-with-new-data-against-the-old-table"></a><span data-ttu-id="1eeae-144">Combinar una tabla que tiene nuevos datos con la tabla antigua</span><span class="sxs-lookup"><span data-stu-id="1eeae-144">Merge a Table with New Data Against the Old Table</span></span>  
 <span data-ttu-id="1eeae-145">La base de datos modela las propiedades de un objeto mediante un “esquema abierto” (es decir, una tabla que contiene pares de nombre-valor para cada propiedad).</span><span class="sxs-lookup"><span data-stu-id="1eeae-145">The database models the properties of an object by using an "open schema," that is, a table contains name-value pairs for each property.</span></span> <span data-ttu-id="1eeae-146">La tabla Properties tiene tres columnas: EntityID, PropertyID y Value.</span><span class="sxs-lookup"><span data-stu-id="1eeae-146">The Properties table has three columns: EntityID, PropertyID, and Value.</span></span> <span data-ttu-id="1eeae-147">La tabla NewProperties, que es una versión más reciente de dicha tabla, se debe sincronizar con la tabla Properties.</span><span class="sxs-lookup"><span data-stu-id="1eeae-147">A NewProperties table that is a newer version of the table has to be synchronized with the Properties table.</span></span> <span data-ttu-id="1eeae-148">Para sincronizar ambas tablas, puede utilizar una única instrucción MERGE que realice las operaciones siguientes:</span><span class="sxs-lookup"><span data-stu-id="1eeae-148">To synchronize these two tables, you can use a single MERGE statement to perform the following operations:</span></span>  
  
-   <span data-ttu-id="1eeae-149">Eliminar las propiedades de la tabla Properties que no aparezcan en la tabla NewProperties.</span><span class="sxs-lookup"><span data-stu-id="1eeae-149">Delete properties from the Properties table if they are absent from the NewProperties table.</span></span>  
  
-   <span data-ttu-id="1eeae-150">Actualizar los valores de las propiedades que aparecen en la tabla Properties con los nuevos valores incluidos en la tabla NewProperties.</span><span class="sxs-lookup"><span data-stu-id="1eeae-150">Update values for properties that are in the Properties table with new values found in the NewProperties table.</span></span>  
  
-   <span data-ttu-id="1eeae-151">Insertar nuevas propiedades para las propiedades existentes en la tabla NewProperties pero que no aparecen en la tabla Properties.</span><span class="sxs-lookup"><span data-stu-id="1eeae-151">Insert new properties for properties that are in the NewProperties table but are not found in the Properties table.</span></span>  
  
 <span data-ttu-id="1eeae-152">Este enfoque es útil en escenarios similares a los escenarios de replicación, en los que el objetivo es mantener sincronizados los datos de dos tablas ubicadas en dos servidores.</span><span class="sxs-lookup"><span data-stu-id="1eeae-152">This approach is useful in scenarios that resemble replication scenarios, where the objective is to keep data in two tables on two servers synchronized.</span></span>  
  
### <a name="track-inventory"></a><span data-ttu-id="1eeae-153">Realizar un seguimiento del inventario</span><span class="sxs-lookup"><span data-stu-id="1eeae-153">Track Inventory</span></span>  
 <span data-ttu-id="1eeae-154">La base de datos Inventory incluye una tabla ProductsInventory con las columnas ProductID y StockOnHand.</span><span class="sxs-lookup"><span data-stu-id="1eeae-154">The Inventory database has a ProductsInventory table that has ProductID and StockOnHand columns.</span></span> <span data-ttu-id="1eeae-155">La tabla Shipments, que contiene las columnas ProductID, CustomerID y Quantity, realiza un seguimiento de los envíos de los productos a los clientes.</span><span class="sxs-lookup"><span data-stu-id="1eeae-155">A Shipments table with ProductID, CustomerID, and Quantity columns tracks shipments of products to customers.</span></span> <span data-ttu-id="1eeae-156">La tabla ProductInventory debe actualizarse diariamente basándose en la información de la tabla Shipments.</span><span class="sxs-lookup"><span data-stu-id="1eeae-156">The ProductInventory table has to be updated daily based on information in the Shipments table.</span></span> <span data-ttu-id="1eeae-157">Una única instrucción MERGE puede reducir el inventario en la tabla ProductInventory sobre la base de los envíos realizados.</span><span class="sxs-lookup"><span data-stu-id="1eeae-157">A single MERGE statement can reduce the inventory in the ProductInventory table based on the shipments made.</span></span> <span data-ttu-id="1eeae-158">Si el inventario de un producto se ha reducido a 0, dicha instrucción MERGE también puede eliminar la fila del producto de la tabla ProductInventory.</span><span class="sxs-lookup"><span data-stu-id="1eeae-158">If the inventory for a product has been reduced to 0, that MERGE statement can also delete that product row from the ProductInventory table.</span></span>  
  
  
