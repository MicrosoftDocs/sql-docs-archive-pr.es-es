---
title: Crear bucles entre archivos y tablas de Excel mediante un contenedor de bucles Para cada uno | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
helpviewer_keywords:
- connections [Integration Services], Excel
- Excel [Integration Services]
- connection managers [Integration Services], Excel
ms.assetid: a5393c1a-cc37-491a-a260-7aad84dbff68
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 51de779b6869d80245302741035e6169aa750c83
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87671618"
---
# <a name="loop-through-excel-files-and-tables-by-using-a-foreach-loop-container"></a><span data-ttu-id="15bb6-102">Crear bucles entre archivos y tablas de Excel usando un contenedor de bucles Foreach</span><span class="sxs-lookup"><span data-stu-id="15bb6-102">Loop through Excel Files and Tables by Using a Foreach Loop Container</span></span>
  <span data-ttu-id="15bb6-103">Los procedimientos de este tema explican cómo crear bucles entre libros de Excel en una carpeta o entre tablas en un libro de Excel, mediante el contenedor de bucles Foreach con el enumerador correspondiente.</span><span class="sxs-lookup"><span data-stu-id="15bb6-103">The procedures in this topic describe how to loop through the Excel workbooks in a folder, or through the tables in an Excel workbook, by using the Foreach Loop container with the appropriate enumerator.</span></span>  
  
### <a name="to-loop-through-excel-files-by-using-the-foreach-file-enumerator"></a><span data-ttu-id="15bb6-104">Para crear un bucle entre libros de Excel con el enumerador de archivos para Foreach</span><span class="sxs-lookup"><span data-stu-id="15bb6-104">To loop through Excel files by using the Foreach File enumerator</span></span>  
  
1.  <span data-ttu-id="15bb6-105">Cree una variable de cadena que recibirá la ruta de acceso y nombre de archivo de Excel actuales en cada iteración del bucle.</span><span class="sxs-lookup"><span data-stu-id="15bb6-105">Create a string variable that will receive the current Excel path and file name on each iteration of the loop.</span></span> <span data-ttu-id="15bb6-106">Para evitar problemas de validación, asigne una ruta de acceso y un nombre de archivo de Excel válidos como valor inicial de la variable</span><span class="sxs-lookup"><span data-stu-id="15bb6-106">To avoid validation issues, assign a valid Excel path and file name as the initial value of the variable.</span></span> <span data-ttu-id="15bb6-107">(la expresión de ejemplo que se muestra más adelante en este procedimiento utiliza el nombre de variable `ExcelFile`).</span><span class="sxs-lookup"><span data-stu-id="15bb6-107">(The sample expression shown later in this procedure uses the variable name, `ExcelFile`.)</span></span>  
  
2.  <span data-ttu-id="15bb6-108">También puede crear otra variable de cadena que mantendrá el valor del argumento Propiedades extendidas de la cadena de conexión de Excel.</span><span class="sxs-lookup"><span data-stu-id="15bb6-108">Optionally, create another string variable that will hold the value for the Extended Properties argument of the Excel connection string.</span></span> <span data-ttu-id="15bb6-109">Este argumento contiene una serie de valores que especifican la versión de Excel y determinan si la primera fila contiene nombres de columna, y si se utiliza un modo de importación</span><span class="sxs-lookup"><span data-stu-id="15bb6-109">This argument contains a series of values that specify the Excel version and determine whether the first row contains column names, and whether import mode is used.</span></span> <span data-ttu-id="15bb6-110">(la expresión de ejemplo que se muestra más adelante en este procedimiento utiliza el nombre de variable `ExtProperties`, con un valor inicial de "`Excel 8.0;HDR=Yes`").</span><span class="sxs-lookup"><span data-stu-id="15bb6-110">(The sample expression shown later in this procedure uses the variable name `ExtProperties`, with an initial value of "`Excel 8.0;HDR=Yes`".)</span></span>  
  
     <span data-ttu-id="15bb6-111">Si no usa una variable para el argumento Propiedades extendidas, debe agregarlo manualmente a la expresión que contiene la cadena de conexión.</span><span class="sxs-lookup"><span data-stu-id="15bb6-111">If you do not use a variable for the Extended Properties argument, then you must add it manually to the expression that contains the connection string.</span></span>  
  
3.  <span data-ttu-id="15bb6-112">Agregue un contenedor de bucles foreach a la pestaña **flujo de control** . Para obtener información sobre cómo configurar el contenedor de bucles foreach, vea [configurar un contenedor de bucles foreach](foreach-loop-container.md).</span><span class="sxs-lookup"><span data-stu-id="15bb6-112">Add a Foreach Loop container to the **Control Flow** tab. For information about how to configure the Foreach Loop Container, see [Configure a Foreach Loop Container](foreach-loop-container.md).</span></span>  
  
4.  <span data-ttu-id="15bb6-113">En la página **Colección** del **Editor de bucles Foreach**, seleccione el enumerador de archivos para Foreach, especifique la carpeta en la que se encuentran los libros de Excel e indique el filtro de archivos (generalmente \*.xls).</span><span class="sxs-lookup"><span data-stu-id="15bb6-113">On the **Collection** page of the **Foreach Loop Editor**, select the Foreach File enumerator, specify the folder in which the Excel workbooks are located, and specify the file filter (ordinarily \*.xls).</span></span>  
  
5.  <span data-ttu-id="15bb6-114">En la página **Asignaciones de variables** , asigne Índice 0 a una variable de cadena definida por el usuario que recibirá la ruta de acceso y el nombre de archivo de Excel actuales en cada iteración del bucle.</span><span class="sxs-lookup"><span data-stu-id="15bb6-114">On the **Variable Mapping** page, map Index 0 to a user-defined string variable that will receive the current Excel path and file name on each iteration of the loop.</span></span> <span data-ttu-id="15bb6-115">(La expresión de ejemplo que se muestra más adelante en este procedimiento utiliza el nombre de variable `ExcelFile`.)</span><span class="sxs-lookup"><span data-stu-id="15bb6-115">(The sample expression shown later in this procedure uses the variable name `ExcelFile`.)</span></span>  
  
6.  <span data-ttu-id="15bb6-116">Cierre el **Editor de bucles Foreach**.</span><span class="sxs-lookup"><span data-stu-id="15bb6-116">Close the **Foreach Loop Editor**.</span></span>  
  
7.  <span data-ttu-id="15bb6-117">Agregue un administrador de conexiones con Excel al paquete como se describe en [Agregar, eliminar o compartir un administrador de conexiones en un paquete](../add-delete-or-share-a-connection-manager-in-a-package.md).</span><span class="sxs-lookup"><span data-stu-id="15bb6-117">Add an Excel connection manager to the package as described in [Add, Delete, or Share a Connection Manager in a Package](../add-delete-or-share-a-connection-manager-in-a-package.md).</span></span> <span data-ttu-id="15bb6-118">Seleccione un libro de Excel existente para la conexión a fin de evitar que se produzcan errores de validación.</span><span class="sxs-lookup"><span data-stu-id="15bb6-118">Select an existing Excel workbook file for the connection to avoid validation errors.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="15bb6-119">Para evitar que se produzcan errores de validación al configurar tareas y componentes de flujo de datos que utilizan este administrador de conexiones con Excel, seleccione un libro de Excel existente en el **Editor del Administrador de conexiones con Excel**.</span><span class="sxs-lookup"><span data-stu-id="15bb6-119">To avoid validation errors as you configure tasks and data flow components that use this Excel connection manager, select an existing Excel workbook in the **Excel Connection Manager Editor**.</span></span> <span data-ttu-id="15bb6-120">El administrador de conexiones no utilizará ese libro en tiempo de ejecución después de configurar una expresión para la propiedad `ConnectionString` como se describe en los pasos siguientes.</span><span class="sxs-lookup"><span data-stu-id="15bb6-120">The connection manager will not use this workbook at run time after you configure an expression for the `ConnectionString` property as described in the following steps.</span></span> <span data-ttu-id="15bb6-121">Tras crear y configurar el paquete, puede borrar el valor de la propiedad `ConnectionString` en la ventana Propiedades.</span><span class="sxs-lookup"><span data-stu-id="15bb6-121">After you create and configure the package, you can clear the value of the `ConnectionString` property in the Properties window.</span></span> <span data-ttu-id="15bb6-122">Sin embargo, si borra este valor, la propiedad de cadena de conexión del administrador de conexiones de Excel deja de ser válido hasta que se ejecuta el bucle Foreach.</span><span class="sxs-lookup"><span data-stu-id="15bb6-122">However, if you clear this value, the connection string property of the Excel connection manager is no longer valid until the Foreach Loop runs.</span></span> <span data-ttu-id="15bb6-123">Por lo tanto, debe establecer la propiedad `DelayValidation` en `True` en las tareas en las que se utiliza el administrador de conexiones, o bien en el paquete, para evitar errores de validación.</span><span class="sxs-lookup"><span data-stu-id="15bb6-123">Therefore you must set the `DelayValidation` property to `True` on the tasks in which the connection manager is used, or on the package, to avoid validation errors.</span></span>  
    >   
    >  <span data-ttu-id="15bb6-124">También debe utilizar el valor predeterminado de `False` para la propiedad `RetainSameConnection` del administrador de conexiones de Excel.</span><span class="sxs-lookup"><span data-stu-id="15bb6-124">You must also use the default value of `False` for the `RetainSameConnection` property of the Excel connection manager.</span></span> <span data-ttu-id="15bb6-125">Si cambia este valor a `True`, cada iteración del bucle continuará abriendo el primer libro de Excel.</span><span class="sxs-lookup"><span data-stu-id="15bb6-125">If you change this value to `True`, each iteration of the loop will continue to open the first Excel workbook.</span></span>  
  
8.  <span data-ttu-id="15bb6-126">Seleccione el nuevo administrador de conexiones de Excel, haga clic en la propiedad **Expresiones** en la ventana Propiedades y luego haga clic en los puntos suspensivos.</span><span class="sxs-lookup"><span data-stu-id="15bb6-126">Select the new Excel connection manager, click the **Expressions** property in the Properties window, and then click the ellipsis.</span></span>  
  
9. <span data-ttu-id="15bb6-127">En el **Editor de expresiones de propiedad**, seleccione la `ConnectionString` propiedad y, a continuación, haga clic en los puntos suspensivos.</span><span class="sxs-lookup"><span data-stu-id="15bb6-127">In the **Property Expressions Editor**, select the `ConnectionString` property, and then click the ellipsis.</span></span>  
  
10. <span data-ttu-id="15bb6-128">En el Generador de expresiones, escriba la siguiente expresión:</span><span class="sxs-lookup"><span data-stu-id="15bb6-128">In the Expression Builder, enter the following expression:</span></span>  
  
    ```  
    "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" +  @[User::ExcelFile] + ";Extended Properties=\"" + @[User::ExtProperties] + "\""  
    ```  
  
     <span data-ttu-id="15bb6-129">Observe el uso del carácter de escape "\\" para las comillas internas necesarias en el valor del argumento Propiedades extendidas.</span><span class="sxs-lookup"><span data-stu-id="15bb6-129">Note the use of the escape character "\\" to escape the inner quotation marks required around the value of the Extended Properties argument.</span></span>  
  
     <span data-ttu-id="15bb6-130">El argumento Propiedades extendidas no es opcional.</span><span class="sxs-lookup"><span data-stu-id="15bb6-130">The Extended Properties argument is not optional.</span></span> <span data-ttu-id="15bb6-131">Si no usa una variable para contener su valor, debe agregarlo manualmente a la expresión, como en el ejemplo siguiente correspondiente a un archivo de Excel 2003:</span><span class="sxs-lookup"><span data-stu-id="15bb6-131">If you do not use a variable to contain its value, then you must add it manually to the expression, as in the following example for an Excel 2003 file:</span></span>  
  
    ```  
    "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" +  @[User::ExcelFile] + ";Extended Properties=Excel 8.0"  
    ```  
  
11. <span data-ttu-id="15bb6-132">Cree tareas en el contenedor de bucles Foreach que utilicen el administrador de conexiones con Excel para realizar las mismas operaciones en cada libro de Excel que coincida con la ubicación y el patrón del archivo especificados.</span><span class="sxs-lookup"><span data-stu-id="15bb6-132">Create tasks in the Foreach Loop container that use the Excel connection manager to perform the same operations on each Excel workbook that matches the specified file location and pattern.</span></span>  
  
### <a name="to-loop-through-excel-tables-by-using-the-foreach-adonet-schema-rowset-enumerator"></a><span data-ttu-id="15bb6-133">Para crear un bucle entre tablas de Excel con el enumerador de conjunto de filas del esquema para Foreach de ADO.NET</span><span class="sxs-lookup"><span data-stu-id="15bb6-133">To loop through Excel tables by using the Foreach ADO.NET Schema Rowset enumerator</span></span>  
  
1.  <span data-ttu-id="15bb6-134">Cree un administrador de conexiones de ADO.NET que utilice el proveedor OLE DB para Microsoft Jet para conectarse al libro de Excel.</span><span class="sxs-lookup"><span data-stu-id="15bb6-134">Create an ADO.NET connection manager that uses the Microsoft Jet OLE DB Provider to connect to an Excel workbook.</span></span> <span data-ttu-id="15bb6-135">En la página Todas del cuadro de diálogo **Administrador de conexiones** , asegúrese de especificar Excel 8.0 como valor para la propiedad Propiedades extendidas.</span><span class="sxs-lookup"><span data-stu-id="15bb6-135">On the All page of the **Connection Manager** dialog box, make sure that you enter Excel 8.0 as the value of the Extended Properties property.</span></span> <span data-ttu-id="15bb6-136">Para obtener más información, consulte [agregar, eliminar o compartir un administrador de conexiones en un paquete](../add-delete-or-share-a-connection-manager-in-a-package.md).</span><span class="sxs-lookup"><span data-stu-id="15bb6-136">For more information, see [Add, Delete, or Share a Connection Manager in a Package](../add-delete-or-share-a-connection-manager-in-a-package.md).</span></span>  
  
2.  <span data-ttu-id="15bb6-137">Cree una variable de cadena que recibirá el nombre de la tabla actual en cada iteración del bucle.</span><span class="sxs-lookup"><span data-stu-id="15bb6-137">Create a string variable that will receive the name of the current table on each iteration of the loop.</span></span>  
  
3.  <span data-ttu-id="15bb6-138">Agregue un contenedor de bucles foreach a la pestaña **flujo de control** . Para obtener información sobre cómo configurar el contenedor de bucles foreach, vea [configurar un contenedor de bucles foreach](foreach-loop-container.md).</span><span class="sxs-lookup"><span data-stu-id="15bb6-138">Add a Foreach Loop container to the **Control Flow** tab. For information about how to configure the Foreach Loop container, see [Configure a Foreach Loop Container](foreach-loop-container.md).</span></span>  
  
4.  <span data-ttu-id="15bb6-139">En la página **Colección** del **Editor de bucles Foreach**, seleccione el enumerador de conjunto de filas del esquema para Foreach de ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="15bb6-139">On the **Collection** page of the **Foreach Loop Editor**, select the Foreach ADO.NET Schema Rowset enumerator.</span></span>  
  
5.  <span data-ttu-id="15bb6-140">Como valor de **Conexión**, seleccione el administrador de conexiones de ADO.NET que creó previamente.</span><span class="sxs-lookup"><span data-stu-id="15bb6-140">As the value of **Connection**, select the ADO.NET connection manager that you created previously.</span></span>  
  
6.  <span data-ttu-id="15bb6-141">Como valor de **Esquema**, seleccione Tablas.</span><span class="sxs-lookup"><span data-stu-id="15bb6-141">As the value of **Schema**, select Tables.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="15bb6-142">La lista de tablas de un libro de Excel incluye tanto hojas (que tienen el sufijo $) como rangos con nombre.</span><span class="sxs-lookup"><span data-stu-id="15bb6-142">The list of tables in an Excel workbook includes both worksheets (which have the $ suffix) and named ranges.</span></span> <span data-ttu-id="15bb6-143">Si tiene que filtrar la lista para obtener solo las hojas o solo los rangos con nombre, escriba código personalizado en una tarea Script para este fin.</span><span class="sxs-lookup"><span data-stu-id="15bb6-143">If you have to filter the list for only worksheets or only named ranges, you may have to write custom code in a Script task for this purpose.</span></span> <span data-ttu-id="15bb6-144">Para obtener más información, consulte [trabajar con archivos de Excel con la tarea de secuencia de comandos](script-task.md).</span><span class="sxs-lookup"><span data-stu-id="15bb6-144">For more information, see [Working with Excel Files with the Script Task](script-task.md).</span></span>  
  
7.  <span data-ttu-id="15bb6-145">En la página **Asignaciones de variables** , asigne Índice 2 a la variable de cadena que creó antes para albergar el nombre de la tabla actual.</span><span class="sxs-lookup"><span data-stu-id="15bb6-145">On the **Variable Mappings** page, map Index 2 to the string variable created earlier to hold the name of the current table.</span></span>  
  
8.  <span data-ttu-id="15bb6-146">Cierre el **Editor de bucles Foreach**.</span><span class="sxs-lookup"><span data-stu-id="15bb6-146">Close the **Foreach Loop Editor**.</span></span>  
  
9. <span data-ttu-id="15bb6-147">Cree tareas en el contenedor de bucles Foreach que utilicen el administrador de conexiones con Excel para realizar las mismas operaciones en cada tabla de Excel en el libro especificado.</span><span class="sxs-lookup"><span data-stu-id="15bb6-147">Create tasks in the Foreach Loop container that use the Excel connection manager to perform the same operations on each Excel table in the specified workbook.</span></span> <span data-ttu-id="15bb6-148">Si usa una tarea Script para examinar el nombre de la tabla enumerada o para trabajar con cada tabla, recuerde agregar la variable de cadena a la propiedad ReadOnlyVariables de la tarea Script.</span><span class="sxs-lookup"><span data-stu-id="15bb6-148">If you use a Script Task to examine the enumerated table name or to work with each table, remember to add the string variable to the ReadOnlyVariables property of the Script task.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="15bb6-149">Consulte también</span><span class="sxs-lookup"><span data-stu-id="15bb6-149">See Also</span></span>  
 <span data-ttu-id="15bb6-150">[Importar datos desde Excel o exportar datos a Excel con SQL Server Integration Services (SSIS)](../load-data-to-from-excel-with-ssis.md) [configurar un contenedor de bucles foreach](foreach-loop-container.md) </span><span class="sxs-lookup"><span data-stu-id="15bb6-150">[Import data from Excel or export data to Excel with SQL Server Integration Services (SSIS)](../load-data-to-from-excel-with-ssis.md) [Configure a Foreach Loop Container](foreach-loop-container.md) </span></span>  
 <span data-ttu-id="15bb6-151">[Agregar o cambiar una expresión de propiedad](../expressions/add-or-change-a-property-expression.md) </span><span class="sxs-lookup"><span data-stu-id="15bb6-151">[Add or Change a Property Expression](../expressions/add-or-change-a-property-expression.md) </span></span>  
 <span data-ttu-id="15bb6-152">[Administrador de conexiones con Excel](../connection-manager/excel-connection-manager.md) </span><span class="sxs-lookup"><span data-stu-id="15bb6-152">[Excel Connection Manager](../connection-manager/excel-connection-manager.md) </span></span>  
 <span data-ttu-id="15bb6-153">[Origen de Excel](../data-flow/excel-source.md) </span><span class="sxs-lookup"><span data-stu-id="15bb6-153">[Excel Source](../data-flow/excel-source.md) </span></span>  
 <span data-ttu-id="15bb6-154">[Destino de Excel](../data-flow/excel-destination.md) </span><span class="sxs-lookup"><span data-stu-id="15bb6-154">[Excel Destination](../data-flow/excel-destination.md) </span></span>  
 [<span data-ttu-id="15bb6-155">Trabajar con archivos de Excel con la tarea Script</span><span class="sxs-lookup"><span data-stu-id="15bb6-155">Working with Excel Files with the Script Task</span></span>](script-task.md)  
  
  
