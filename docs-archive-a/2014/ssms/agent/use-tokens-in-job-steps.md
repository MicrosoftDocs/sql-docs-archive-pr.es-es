---
title: Usar tokens en pasos de trabajo | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ssms
ms.topic: conceptual
helpviewer_keywords:
- job steps [SQL Server Agent]
- security [SQL Server Agent], enabling alert job step tokens
- SQL Server Agent jobs, job steps
- tokens [SQL Server]
- escape macros [SQL Server Agent]
ms.assetid: 105bbb66-0ade-4b46-b8e4-f849e5fc4d43
author: stevestein
ms.author: sstein
ms.openlocfilehash: 9d90b6660dd4b65e4e1d9b832b39ffaa275c83bc
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87751629"
---
# <a name="use-tokens-in-job-steps"></a><span data-ttu-id="5fa2e-102">Usar tokens en pasos de trabajo</span><span class="sxs-lookup"><span data-stu-id="5fa2e-102">Use Tokens in Job Steps</span></span>
  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="5fa2e-103">El Agente le permite usar tokens en scripts de pasos de trabajo de [!INCLUDE[tsql](../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="5fa2e-103">Agent allows you to use tokens in [!INCLUDE[tsql](../../includes/tsql-md.md)] job step scripts.</span></span> <span data-ttu-id="5fa2e-104">La utilización de tokens al escribir pasos de trabajo ofrece la misma flexibilidad que las variables al escribir programas de software.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-104">Using tokens when you write your job steps gives you the same flexibility that variables provide when you write software programs.</span></span> <span data-ttu-id="5fa2e-105">Una vez que se inserta un token en un script de pasos de trabajo, el Agente [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] sustituye el token en tiempo de ejecución, antes de que el subsistema de [!INCLUDE[tsql](../../includes/tsql-md.md)] ejecute el paso de trabajo.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-105">After you insert a token in a job step script, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent replaces the token at run time, before the job step is executed by the [!INCLUDE[tsql](../../includes/tsql-md.md)] subsystem.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="5fa2e-106">A partir de [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] Service Pack 1, la sintaxis del token del paso de trabajo del Agente [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ha cambiado.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-106">Starting with [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] Service Pack 1, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent job step token syntax changed.</span></span> <span data-ttu-id="5fa2e-107">Como resultado, todos los tokens que se usan en pasos de trabajo deben adjuntar ahora una macro de escape; de lo contrario, esos pasos de trabajo producirán un error.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-107">As a result, an escape macro must now accompany all tokens used in job steps, or else those job steps will fail.</span></span> <span data-ttu-id="5fa2e-108">El uso de las macros de escape y la actualización de pasos de trabajo del Agente [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] que usa tokens se describen en las secciones siguientes, "Descripción del uso de tokens", "Tokens y macros del Agente[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] " y "Actualizar pasos de trabajo para usar macros".</span><span class="sxs-lookup"><span data-stu-id="5fa2e-108">Using escape macros and updating your [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent job steps that use tokens are described in the following sections, "Understanding Using Tokens," "[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent Tokens and Macros," and "Updating Job Steps to Use Macros."</span></span> <span data-ttu-id="5fa2e-109">Además, también ha cambiado la sintaxis de [!INCLUDE[ssVersion2000](../../includes/ssversion2000-md.md)] , que usaba corchetes para llamar a los tokens de pasos de trabajo del Agente [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (por ejemplo, "`[DATE]`").</span><span class="sxs-lookup"><span data-stu-id="5fa2e-109">In addition, the [!INCLUDE[ssVersion2000](../../includes/ssversion2000-md.md)] syntax, which used square brackets to call out [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent job step tokens (for example, "`[DATE]`") has also changed.</span></span> <span data-ttu-id="5fa2e-110">Ahora debe delimitar los nombres de los tokens entre paréntesis y colocar un signo de dólar (`$`) al principio de la sintaxis del token.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-110">You must now enclose token names in parentheses and place a dollar sign (`$`) at the beginning of the token syntax.</span></span> <span data-ttu-id="5fa2e-111">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="5fa2e-111">For example:</span></span>  
>   
>  <span data-ttu-id="5fa2e-112">`$(ESCAPE_` *nombreDeMacro* `(DATE))`</span><span class="sxs-lookup"><span data-stu-id="5fa2e-112">`$(ESCAPE_` *macro name* `(DATE))`</span></span>  
  
## <a name="understanding-using-tokens"></a><span data-ttu-id="5fa2e-113">Descripción del uso de tokens</span><span class="sxs-lookup"><span data-stu-id="5fa2e-113">Understanding Using Tokens</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="5fa2e-114">Todos los usuarios de Windows que tengan permisos de escritura en el Registro de eventos de Windows pueden tener acceso a los pasos de trabajo activados por alertas del Agente [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] o de WMI.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-114">Any Windows user with write permissions on the Windows Event Log can access job steps that are activated by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent alerts or WMI alerts.</span></span> <span data-ttu-id="5fa2e-115">Para evitar este riesgo de seguridad, se deshabilitan de manera predeterminada los tokens del Agente [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] que pueden utilizarse en trabajos activados por alertas.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-115">To avoid this security risk, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent tokens that can be used in jobs activated by alerts are disabled by default.</span></span> <span data-ttu-id="5fa2e-116">Estos tokens son: **a-DBN**, **a-SVR**, **a-Err**, **a-gravedad**, **a-MSG**y **WMI ( *`property`* )**.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-116">These tokens are: **A-DBN**, **A-SVR**, **A-ERR**, **A-SEV**, **A-MSG**., and **WMI(*`property`*)**.</span></span> <span data-ttu-id="5fa2e-117">Tenga en cuenta que en esta versión el uso de los tokens se ha ampliado a todas las alertas.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-117">Note that in this release, use of tokens is extended to all alerting.</span></span>  
>   
>  <span data-ttu-id="5fa2e-118">Si necesita usar estos tokens, asegúrese primero de que solo los miembros de los grupos de seguridad de Windows de confianza, como el grupo Administradores, tienen permisos de escritura en el registro de eventos del equipo donde reside [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="5fa2e-118">If you need to use these tokens, first ensure that only members of trusted Windows security groups, such as the Administrators group, have write permissions on the Event Log of the computer where [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] resides.</span></span> <span data-ttu-id="5fa2e-119">A continuación, para habilitar estos tokens, haga clic con el botón derecho en **Agente SQL Server** en el Explorador de objetos, elija **Propiedades**y, en la página **Sistema de alerta** , active la casilla **Reemplazar tokens para todas las respuestas de trabajos a alertas** .</span><span class="sxs-lookup"><span data-stu-id="5fa2e-119">Then, right-click **SQL Server Agent** in Object Explorer, select **Properties**, and on the **Alert System** page, select **Replace tokens for all job responses to alerts** to enable these tokens.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="5fa2e-120">La sustitución del token del Agente es sencilla y eficaz: el Agente [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] reemplaza el token por un valor literal de cadena exacto.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-120">Agent token replacement is simple and efficient: [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent replaces an exact literal string value for the token.</span></span> <span data-ttu-id="5fa2e-121">Todos los tokens distinguen mayúsculas de minúsculas.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-121">All tokens are case-sensitive.</span></span> <span data-ttu-id="5fa2e-122">Los pasos de trabajo deben tenerlo en cuenta y citar correctamente los tokens utilizados o convertir la cadena de reemplazo al tipo de datos correcto.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-122">Your job steps must take this into account and correctly quote the tokens you use or convert the replacement string to the correct data type.</span></span>  
  
 <span data-ttu-id="5fa2e-123">Por ejemplo, se puede usar la siguiente instrucción para imprimir el nombre de la base de datos en un paso de trabajo:</span><span class="sxs-lookup"><span data-stu-id="5fa2e-123">For example, you might use the following statement to print the name of the database in a job step:</span></span>  
  
 `PRINT N'Current database name is $(ESCAPE_SQUOTE(A-DBN))' ;`  
  
 <span data-ttu-id="5fa2e-124">En este ejemplo, la macro **ESCAPE_SQUOTE** se inserta con el token **A-DBN** .</span><span class="sxs-lookup"><span data-stu-id="5fa2e-124">In this example, the **ESCAPE_SQUOTE** macro is inserted with the **A-DBN** token.</span></span> <span data-ttu-id="5fa2e-125">En tiempo de ejecución, el nombre de la base de datos apropiada sustituirá al token **A-DBN** .</span><span class="sxs-lookup"><span data-stu-id="5fa2e-125">At run time, the **A-DBN** token will be replaced with the appropriate database name.</span></span> <span data-ttu-id="5fa2e-126">La macro de escape convierte cualquier comilla simple que se pueda pasar de forma inadvertida en la cadena de reemplazo del token.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-126">The escape macro escapes any single quotation marks that may be inadvertently passed in the token replacement string.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="5fa2e-127">El Agente reemplazará una comilla simple con dos comillas simples en la cadena final.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-127">Agent will replace one single quotation mark with two single quotation marks in the final string.</span></span>  
  
 <span data-ttu-id="5fa2e-128">Por ejemplo, si la cadena que se pasa para reemplazar al token es `AdventureWorks2012'SELECT @@VERSION --`, el comando que ejecuta el paso de trabajo del Agente [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] será:</span><span class="sxs-lookup"><span data-stu-id="5fa2e-128">For example, if the string passed to replace the token is `AdventureWorks2012'SELECT @@VERSION --`, the command executed by the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent job step will be:</span></span>  
  
 `PRINT N'Current database name is AdventureWorks2012''SELECT @@VERSION --' ;`  
  
 <span data-ttu-id="5fa2e-129">En este caso, la instrucción insertada, `SELECT @@VERSION`, no se ejecuta.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-129">In this case, the inserted statement, `SELECT @@VERSION`, does not execute.</span></span> <span data-ttu-id="5fa2e-130">En su lugar, la comilla simple adicional hace que el servidor analice la instrucción insertada como una cadena.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-130">Instead, the extra single quotation mark causes the server to parse the inserted statement as a string.</span></span> <span data-ttu-id="5fa2e-131">Si la cadena de reemplazo del token no contiene una comilla simple, no se convierte ninguno de los caracteres y el paso de trabajo que contiene el token se ejecutará como se espera.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-131">If the token replacement string does not contain a single quotation mark, no characters are escaped and the job step containing the token executes as intended.</span></span>  
  
 <span data-ttu-id="5fa2e-132">Para depurar el uso de tokens en pasos de trabajo, utilice instrucciones de impresión como, por ejemplo, `PRINT N'$(ESCAPE_SQUOTE(SQLDIR))'` y guarde la salida del paso de trabajo en un archivo o una tabla.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-132">To debug token usage in your job steps, use print statements such as `PRINT N'$(ESCAPE_SQUOTE(SQLDIR))'` and save job step output to a file or table.</span></span> <span data-ttu-id="5fa2e-133">Use la página **Avanzadas** del cuadro de diálogo **Propiedades de paso de trabajo** para especificar un archivo o tabla de salida del paso de trabajo.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-133">Use the **Advanced** page of the **Job Step Properties** dialog box to specify a job step output file or table.</span></span>  
  
## <a name="sql-server-agent-tokens-and-macros"></a><span data-ttu-id="5fa2e-134">Tokens y macros del Agente SQL Server</span><span class="sxs-lookup"><span data-stu-id="5fa2e-134">SQL Server Agent Tokens and Macros</span></span>  
 <span data-ttu-id="5fa2e-135">En las siguientes tablas se indican y describen los tokens y macros compatibles con el Agente [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="5fa2e-135">The following tables list and describe the tokens and macros that [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent supports.</span></span>  
  
### <a name="sql-server-agent-tokens"></a><span data-ttu-id="5fa2e-136">Tokens del Agente SQL Server</span><span class="sxs-lookup"><span data-stu-id="5fa2e-136">SQL Server Agent Tokens</span></span>  
  
|<span data-ttu-id="5fa2e-137">Token</span><span class="sxs-lookup"><span data-stu-id="5fa2e-137">Token</span></span>|<span data-ttu-id="5fa2e-138">Descripción</span><span class="sxs-lookup"><span data-stu-id="5fa2e-138">Description</span></span>|  
|-----------|-----------------|  
|<span data-ttu-id="5fa2e-139">**(A-DBN)**</span><span class="sxs-lookup"><span data-stu-id="5fa2e-139">**(A-DBN)**</span></span>|<span data-ttu-id="5fa2e-140">nombre de base de datos.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-140">Database name.</span></span> <span data-ttu-id="5fa2e-141">Si el trabajo se ejecuta a causa de una alerta, el valor del nombre de la base de datos sustituye automáticamente a este token en el paso de trabajo.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-141">If the job is run by an alert, the database name value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="5fa2e-142">**(A-SVR)**</span><span class="sxs-lookup"><span data-stu-id="5fa2e-142">**(A-SVR)**</span></span>|<span data-ttu-id="5fa2e-143">Nombre de servidor.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-143">Server name.</span></span> <span data-ttu-id="5fa2e-144">Si el trabajo se ejecuta a causa de una alerta, el valor del nombre del servidor sustituye automáticamente a este token en el paso de trabajo.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-144">If the job is run by an alert, the server name value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="5fa2e-145">**(A-ERR)**</span><span class="sxs-lookup"><span data-stu-id="5fa2e-145">**(A-ERR)**</span></span>|<span data-ttu-id="5fa2e-146">Número de error.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-146">Error number.</span></span> <span data-ttu-id="5fa2e-147">Si el trabajo se ejecuta a causa de una alerta, el valor del número de error sustituye automáticamente a este token en el paso de trabajo.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-147">If the job is run by an alert, the error number value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="5fa2e-148">**(A-SEV)**</span><span class="sxs-lookup"><span data-stu-id="5fa2e-148">**(A-SEV)**</span></span>|<span data-ttu-id="5fa2e-149">Gravedad del error.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-149">Error severity.</span></span> <span data-ttu-id="5fa2e-150">Si el trabajo se ejecuta a causa de una alerta, el valor de la gravedad del error sustituye automáticamente a este token en el paso de trabajo.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-150">If the job is run by an alert, the error severity value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="5fa2e-151">**(A-MSG)**</span><span class="sxs-lookup"><span data-stu-id="5fa2e-151">**(A-MSG)**</span></span>|<span data-ttu-id="5fa2e-152">Texto del mensaje.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-152">Message text.</span></span> <span data-ttu-id="5fa2e-153">Si el trabajo se ejecuta a causa de una alerta, el valor del texto del mensaje sustituye automáticamente a este token en el paso de trabajo.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-153">If the job is run by an alert, the message text value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="5fa2e-154">**Posteriormente**</span><span class="sxs-lookup"><span data-stu-id="5fa2e-154">**(DATE)**</span></span>|<span data-ttu-id="5fa2e-155">Fecha actual (en formato AAAAMMDD).</span><span class="sxs-lookup"><span data-stu-id="5fa2e-155">Current date (in YYYYMMDD format).</span></span>|  
|<span data-ttu-id="5fa2e-156">**Trim**</span><span class="sxs-lookup"><span data-stu-id="5fa2e-156">**(INST)**</span></span>|<span data-ttu-id="5fa2e-157">Nombre de instancia.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-157">Instance name.</span></span> <span data-ttu-id="5fa2e-158">Para una instancia predeterminada, este token tendrá el nombre de instancia predeterminado: MSSQLSERVER.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-158">For a default instance, this token will have the default instance name: MSSQLSERVER.</span></span>|  
|<span data-ttu-id="5fa2e-159">**JOBID**</span><span class="sxs-lookup"><span data-stu-id="5fa2e-159">**(JOBID)**</span></span>|<span data-ttu-id="5fa2e-160">Id. del trabajo.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-160">Job ID.</span></span>|  
|<span data-ttu-id="5fa2e-161">**(MACH)**</span><span class="sxs-lookup"><span data-stu-id="5fa2e-161">**(MACH)**</span></span>|<span data-ttu-id="5fa2e-162">Nombre del equipo.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-162">Computer name.</span></span>|  
|<span data-ttu-id="5fa2e-163">**(MSSA)**</span><span class="sxs-lookup"><span data-stu-id="5fa2e-163">**(MSSA)**</span></span>|<span data-ttu-id="5fa2e-164">Nombre del servicio SQLServerAgent maestro.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-164">Master SQLServerAgent service name.</span></span>|  
|<span data-ttu-id="5fa2e-165">**(OSCMD)**</span><span class="sxs-lookup"><span data-stu-id="5fa2e-165">**(OSCMD)**</span></span>|<span data-ttu-id="5fa2e-166">Prefijo del programa usado para ejecutar los pasos de trabajo de **CmdExec** .</span><span class="sxs-lookup"><span data-stu-id="5fa2e-166">Prefix for the program used to run **CmdExec** job steps.</span></span>|  
|<span data-ttu-id="5fa2e-167">**(SQLDIR)**</span><span class="sxs-lookup"><span data-stu-id="5fa2e-167">**(SQLDIR)**</span></span>|<span data-ttu-id="5fa2e-168">Directorio en el que se instala [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="5fa2e-168">The directory in which [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is installed.</span></span> <span data-ttu-id="5fa2e-169">El directorio predeterminado es C:\Archivos de programa\Microsoft SQL Server\MSSQL.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-169">By default, this value is C:\Program Files\Microsoft SQL Server\MSSQL.</span></span>|  
|<span data-ttu-id="5fa2e-170">**(SQLLOGDIR)**</span><span class="sxs-lookup"><span data-stu-id="5fa2e-170">**(SQLLOGDIR)**</span></span>|<span data-ttu-id="5fa2e-171">Token de reemplazo para la ruta de la carpeta de registro de errores de SQL Server; por ejemplo, $(ESCAPE_SQUOTE(SQLLOGDIR)).</span><span class="sxs-lookup"><span data-stu-id="5fa2e-171">Replacement token for the SQL Server error log folder path - for example, $(ESCAPE_SQUOTE(SQLLOGDIR)).</span></span>|  
|<span data-ttu-id="5fa2e-172">**(STEPCT)**</span><span class="sxs-lookup"><span data-stu-id="5fa2e-172">**(STEPCT)**</span></span>|<span data-ttu-id="5fa2e-173">Contador del número de veces que se ha ejecutado este paso (sin incluir los reintentos).</span><span class="sxs-lookup"><span data-stu-id="5fa2e-173">A count of the number of times this step has executed (excluding retries).</span></span> <span data-ttu-id="5fa2e-174">Lo puede utilizar el comando del paso para forzar la terminación de un bucle de múltiples pasos.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-174">Can be used by the step command to force termination of a multistep loop.</span></span>|  
|<span data-ttu-id="5fa2e-175">**(STEPID)**</span><span class="sxs-lookup"><span data-stu-id="5fa2e-175">**(STEPID)**</span></span>|<span data-ttu-id="5fa2e-176">Id. del paso.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-176">Step ID.</span></span>|  
|<span data-ttu-id="5fa2e-177">**(SRVR)**</span><span class="sxs-lookup"><span data-stu-id="5fa2e-177">**(SRVR)**</span></span>|<span data-ttu-id="5fa2e-178">Nombre del equipo en el que se ejecuta [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="5fa2e-178">Name of the computer running [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="5fa2e-179">Si la instancia de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] es una instancia con nombre, incluye el nombre.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-179">If the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance is a named instance, this includes the instance name.</span></span>|  
|<span data-ttu-id="5fa2e-180">**TIEMPO**</span><span class="sxs-lookup"><span data-stu-id="5fa2e-180">**(TIME)**</span></span>|<span data-ttu-id="5fa2e-181">Hora actual (en formato HHMMSS).</span><span class="sxs-lookup"><span data-stu-id="5fa2e-181">Current time (in HHMMSS format).</span></span>|  
|<span data-ttu-id="5fa2e-182">**(STRTTM)**</span><span class="sxs-lookup"><span data-stu-id="5fa2e-182">**(STRTTM)**</span></span>|<span data-ttu-id="5fa2e-183">La hora (en formato HHMMSS) en la que el trabajo empezó a ejecutarse.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-183">The time (in HHMMSS format) that the job began executing.</span></span>|  
|<span data-ttu-id="5fa2e-184">**(STRTDT)**</span><span class="sxs-lookup"><span data-stu-id="5fa2e-184">**(STRTDT)**</span></span>|<span data-ttu-id="5fa2e-185">La fecha (en formato AAAAMMDD) en la que el trabajo empezó a ejecutarse.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-185">The date (in YYYYMMDD format) that the job began executing.</span></span>|  
|<span data-ttu-id="5fa2e-186">**(WMI(** *propiedad* **))**</span><span class="sxs-lookup"><span data-stu-id="5fa2e-186">**(WMI(** *property* **))**</span></span>|<span data-ttu-id="5fa2e-187">Para los trabajos que se ejecutan en respuesta a las alertas de WMI, es el valor de la propiedad especificada por *property*.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-187">For jobs that run in response to WMI alerts, the value of the property specified by *property*.</span></span> <span data-ttu-id="5fa2e-188">Por ejemplo, `$(WMI(DatabaseName))` proporciona el valor de la propiedad **DatabaseName** del evento WMI que provocó la ejecución de la alerta.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-188">For example, `$(WMI(DatabaseName))` provides the value of the **DatabaseName** property for the WMI event that caused the alert to run.</span></span>|  
  
### <a name="sql-server-agent-escape-macros"></a><span data-ttu-id="5fa2e-189">Macros de escape del Agente SQL Server</span><span class="sxs-lookup"><span data-stu-id="5fa2e-189">SQL Server Agent Escape Macros</span></span>  
  
|<span data-ttu-id="5fa2e-190">Macros de escape</span><span class="sxs-lookup"><span data-stu-id="5fa2e-190">Escape Macros</span></span>|<span data-ttu-id="5fa2e-191">Descripción</span><span class="sxs-lookup"><span data-stu-id="5fa2e-191">Description</span></span>|  
|-------------------|-----------------|  
|<span data-ttu-id="5fa2e-192">**$(ESCAPE_SQUOTE(** *nombre_de_token* **))**</span><span class="sxs-lookup"><span data-stu-id="5fa2e-192">**$(ESCAPE_SQUOTE(** *token_name* **))**</span></span>|<span data-ttu-id="5fa2e-193">Convierte las comillas simples (') en la cadena de reemplazo del token.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-193">Escapes single quotation marks (') in the token replacement string.</span></span> <span data-ttu-id="5fa2e-194">Sustituye una comilla simple por dos comillas simples.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-194">Replaces one single quotation mark with two single quotation marks.</span></span>|  
|<span data-ttu-id="5fa2e-195">**$(ESCAPE_DQUOTE(** *nombre_de_token* **))**</span><span class="sxs-lookup"><span data-stu-id="5fa2e-195">**$(ESCAPE_DQUOTE(** *token_name* **))**</span></span>|<span data-ttu-id="5fa2e-196">Convierte las comillas dobles ('') en la cadena de reemplazo del token.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-196">Escapes double quotation marks (") in the token replacement string.</span></span> <span data-ttu-id="5fa2e-197">Sustituye una comilla doble por dos comillas dobles.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-197">Replaces one double quotation mark with two double quotation marks.</span></span>|  
|<span data-ttu-id="5fa2e-198">**$(ESCAPE_RBRACKET(** *nombre_de_token* **))**</span><span class="sxs-lookup"><span data-stu-id="5fa2e-198">**$(ESCAPE_RBRACKET(** *token_name* **))**</span></span>|<span data-ttu-id="5fa2e-199">Convierte los corchetes de cierre (]) en la cadena de reemplazo del token.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-199">Escapes right brackets (]) in the token replacement string.</span></span> <span data-ttu-id="5fa2e-200">Sustituye un corchete de cierre por dos corchetes de cierre.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-200">Replaces one right bracket with two right brackets.</span></span>|  
|<span data-ttu-id="5fa2e-201">**$(ESCAPE_NONE(** *nombre_de_token* **))**</span><span class="sxs-lookup"><span data-stu-id="5fa2e-201">**$(ESCAPE_NONE(** *token_name* **))**</span></span>|<span data-ttu-id="5fa2e-202">Sustituye el token sin convertir ninguno de los caracteres de la cadena.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-202">Replaces token without escaping any characters in the string.</span></span> <span data-ttu-id="5fa2e-203">Se incluye esta macro para la compatibilidad con versiones anteriores en entornos donde las cadenas de reemplazo de tokens se esperan únicamente de usuarios de confianza.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-203">This macro is provided to support backward compatibility in environments where token replacement strings are only expected from trusted users.</span></span> <span data-ttu-id="5fa2e-204">Para obtener más información, vea "Actualizar pasos de trabajo para usar macros" más adelante en este tema.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-204">For more information, see "Updating Job Steps to Use Macros," later in this topic.</span></span>|  
  
## <a name="updating-job-steps-to-use-macros"></a><span data-ttu-id="5fa2e-205">Actualizar pasos de trabajo para usar macros</span><span class="sxs-lookup"><span data-stu-id="5fa2e-205">Updating Job Steps to Use Macros</span></span>  
 <span data-ttu-id="5fa2e-206">A partir de [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] Service Pack 1, los pasos de trabajo que contienen tokens sin macros de escape producirán un error y devolverán un mensaje de error indicando que el paso de trabajo contiene uno o más tokens que deben actualizarse con una macro antes de poder ejecutar el trabajo.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-206">Beginning with [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] Service Pack 1, job steps that contain tokens without escape macros will fail and return an error message indicating the job step contains one or more tokens that must be updated with a macro before the job can run.</span></span>  
  
 <span data-ttu-id="5fa2e-207">El artículo 915845 de [!INCLUDE[msCoName](../../includes/msconame-md.md)] Knowledge Base [SQL Server Agent Job Steps That Use Tokens Fail in SQL Server 2005 Service Pack 1](https://support.microsoft.com/kb/915845)proporciona un script que puede usar para actualizar todos los pasos de trabajo que usan tokens con la macro **ESCAPE_NONE** .</span><span class="sxs-lookup"><span data-stu-id="5fa2e-207">A script is provided with [!INCLUDE[msCoName](../../includes/msconame-md.md)] Knowledge Base article 915845: [SQL Server Agent Job Steps That Use Tokens Fail in SQL Server 2005 Service Pack 1](https://support.microsoft.com/kb/915845).You can use this script to update all of your job steps that use tokens with the **ESCAPE_NONE** macro.</span></span> <span data-ttu-id="5fa2e-208">Después de usar el script, se recomienda revisar cuanto antes los pasos de trabajo que usan tokens y sustituir la macro **ESCAPE_NONE** por una macro de escape apropiada para el contexto del paso de trabajo.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-208">After using this script, we recommend that you review your job steps that use tokens as soon as possible, and replace the **ESCAPE_NONE** macro with an escape macro that is appropriate for the job step context.</span></span>  
  
 <span data-ttu-id="5fa2e-209">La tabla siguiente describe cómo el Agente [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] administra el reemplazo de los tokens.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-209">The following table describes how token replacement is handled by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent.</span></span> <span data-ttu-id="5fa2e-210">Para habilitar o deshabilitar la alerta de sustitución de los tokens, haga clic con el botón derecho en **Agente SQL Server** en el Explorador de objetos, seleccione **Propiedades**y, en la página **Sistema de alerta** , active o desactive la casilla **Reemplazar tokens para todas las respuestas de trabajos a alertas** .</span><span class="sxs-lookup"><span data-stu-id="5fa2e-210">To turn alert token replacement on or off, right-click **SQL Server Agent** in Object Explorer, select **Properties**, and on the **Alert System** page, select or clear the **Replace tokens for all job responses to alerts** check box.</span></span>  
  
|<span data-ttu-id="5fa2e-211">Sintaxis de los tokens</span><span class="sxs-lookup"><span data-stu-id="5fa2e-211">Token syntax</span></span>|<span data-ttu-id="5fa2e-212">Alerta de sustitución de tokens activada</span><span class="sxs-lookup"><span data-stu-id="5fa2e-212">Alert token replacement on</span></span>|<span data-ttu-id="5fa2e-213">Alerta de sustitución de tokens desactivada</span><span class="sxs-lookup"><span data-stu-id="5fa2e-213">Alert token replacement off</span></span>|  
|------------------|--------------------------------|---------------------------------|  
|<span data-ttu-id="5fa2e-214">Macro ESCAPE utilizada</span><span class="sxs-lookup"><span data-stu-id="5fa2e-214">ESCAPE macro used</span></span>|<span data-ttu-id="5fa2e-215">Todos los tokens de los trabajos se han sustituido correctamente.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-215">All tokens in jobs are successfully replaced.</span></span>|<span data-ttu-id="5fa2e-216">Los tokens activados por alertas no se han sustituido.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-216">Tokens activated by alerts are not replaced.</span></span> <span data-ttu-id="5fa2e-217">Estos tokens son **a-DBN**, **a-SVR**, **a-Err**, **a-gravedad**, **a-MSG**y **WMI ( *`property`* )**.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-217">These tokens are **A-DBN**, **A-SVR**, **A-ERR**, **A-SEV**, **A-MSG**, and **WMI(*`property`*)**.</span></span> <span data-ttu-id="5fa2e-218">Otros tokens estáticos se han sustituido correctamente.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-218">Other static tokens are replaced successfully.</span></span>|  
|<span data-ttu-id="5fa2e-219">Macro ESCAPE no utilizada</span><span class="sxs-lookup"><span data-stu-id="5fa2e-219">No ESCAPE macro used</span></span>|<span data-ttu-id="5fa2e-220">Los trabajos que contienen tokens producen un error.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-220">Any jobs containing tokens fail.</span></span>|<span data-ttu-id="5fa2e-221">Los trabajos que contienen tokens producen un error.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-221">Any jobs containing tokens fail.</span></span>|  
  
## <a name="token-syntax-update-examples"></a><span data-ttu-id="5fa2e-222">Ejemplos de actualización de la sintaxis del token</span><span class="sxs-lookup"><span data-stu-id="5fa2e-222">Token Syntax Update Examples</span></span>  
  
### <a name="a-using-tokens-in-non-nested-strings"></a><span data-ttu-id="5fa2e-223">A.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-223">A.</span></span> <span data-ttu-id="5fa2e-224">Usar tokens en cadenas no anidadas</span><span class="sxs-lookup"><span data-stu-id="5fa2e-224">Using tokens in non-nested strings</span></span>  
 <span data-ttu-id="5fa2e-225">En el siguiente ejemplo se muestra cómo actualizar un script simple no anidado con la macro de escape apropiada.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-225">The following example shows how to update a simple non-nested script with the appropriate escape macro.</span></span> <span data-ttu-id="5fa2e-226">Antes de ejecutar el script de actualización, el siguiente script de paso de trabajo usa un token de paso de trabajo para imprimir el nombre de la base de datos apropiada:</span><span class="sxs-lookup"><span data-stu-id="5fa2e-226">Before running the update script, the following job step script uses a job step token to print the appropriate database name:</span></span>  
  
 `PRINT N'Current database name is $(A-DBN)' ;`  
  
 <span data-ttu-id="5fa2e-227">Después de ejecutar el script de actualización, se inserta una macro `ESCAPE_NONE` antes del token `A-DBN` .</span><span class="sxs-lookup"><span data-stu-id="5fa2e-227">After running the update script, an `ESCAPE_NONE` macro is inserted before the `A-DBN` token.</span></span> <span data-ttu-id="5fa2e-228">Debido a que se utilizan comillas simples para delimitar la cadena de impresión, se debe actualizar el paso de trabajo mediante la inserción de la macro `ESCAPE_SQUOTE` , del siguiente modo:</span><span class="sxs-lookup"><span data-stu-id="5fa2e-228">Because single quotation marks are used to delimit the print string, you must update the job step by inserting the `ESCAPE_SQUOTE` macro as follows:</span></span>  
  
 `PRINT N'Current database name is $(ESCAPE_SQUOTE(A-DBN))' ;`  
  
### <a name="b-using-tokens-in-nested-strings"></a><span data-ttu-id="5fa2e-229">B.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-229">B.</span></span> <span data-ttu-id="5fa2e-230">Usar tokens en cadenas anidadas</span><span class="sxs-lookup"><span data-stu-id="5fa2e-230">Using tokens in nested strings</span></span>  
 <span data-ttu-id="5fa2e-231">En scripts de pasos de trabajo donde se utilizan tokens en cadenas o instrucciones anidadas, éstas deben volver a escribirse como varias instrucciones antes de insertarse en las macros de escape apropiadas.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-231">In job step scripts where tokens are used in nested strings or statements, the nested statements should be rewritten as multiple statements before inserting the appropriate escape macros.</span></span>  
  
 <span data-ttu-id="5fa2e-232">Por ejemplo, considere el siguiente paso de trabajo, que utiliza el token `A-MSG` y no se ha actualizado con una macro de escape:</span><span class="sxs-lookup"><span data-stu-id="5fa2e-232">For example, consider the following job step, which uses the `A-MSG` token and has not been updated with an escape macro:</span></span>  
  
 `PRINT N'Print ''$(A-MSG)''' ;`  
  
 <span data-ttu-id="5fa2e-233">Después de ejecutar el script de actualización, se inserta una macro `ESCAPE_NONE` con el token.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-233">After running the update script, an `ESCAPE_NONE` macro is inserted with the token.</span></span> <span data-ttu-id="5fa2e-234">No obstante, en este caso, se debería volver a escribir el script sin usar anidamiento e insertar la macro `ESCAPE_SQUOTE` para convertir los delimitadores que se puedan haber pasado en la cadena de reemplazo del token:</span><span class="sxs-lookup"><span data-stu-id="5fa2e-234">However, in this case, you would have to rewrite the script without using nesting as follows and insert the `ESCAPE_SQUOTE` macro to properly escape delimiters that may be passed in the token replacement string:</span></span>  
  
 `DECLARE @msgString nvarchar(max)`  
  
 `SET @msgString = '$(ESCAPE_SQUOTE(A-MSG))'`  
  
 `SET @msgString = QUOTENAME(@msgString,'''')`  
  
 `PRINT N'Print ' + @msgString ;`  
  
 <span data-ttu-id="5fa2e-235">Además, tenga en cuenta que en este ejemplo la función QUOTENAME establece el carácter de cita.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-235">Note also in this example that the QUOTENAME function sets the quote character.</span></span>  
  
### <a name="c-using-tokens-with-the-escape_none-macro"></a><span data-ttu-id="5fa2e-236">C.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-236">C.</span></span> <span data-ttu-id="5fa2e-237">Usar tokens con la macro ESCAPE_NONE</span><span class="sxs-lookup"><span data-stu-id="5fa2e-237">Using tokens with the ESCAPE_NONE macro</span></span>  
 <span data-ttu-id="5fa2e-238">El siguiente ejemplo es parte de un script que recupera el `job_id` de la tabla `sysjobs` y utiliza el token `JOBID` para rellenar la variable `@JobID` , que se declaró previamente en el script como un tipo de datos binario.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-238">The following example is part of a script that retrieves the `job_id` from the `sysjobs` table and uses the `JOBID` token to populate the `@JobID` variable, which was declared earlier in the script as a binary data type.</span></span> <span data-ttu-id="5fa2e-239">Tenga en cuenta que, debido a que no se requieren delimitadores para los tipos de datos binarios, la macro `ESCAPE_NONE` se usa con el token `JOBID` .</span><span class="sxs-lookup"><span data-stu-id="5fa2e-239">Note that because no delimiters are required for binary data types, the `ESCAPE_NONE` macro is used with the `JOBID` token.</span></span> <span data-ttu-id="5fa2e-240">Una vez que se ejecute el script de actualización, no debería ser necesario actualizar este paso de trabajo.</span><span class="sxs-lookup"><span data-stu-id="5fa2e-240">You would not need to update this job step after running the update script.</span></span>  
  
 `SELECT * FROM msdb.dbo.sysjobs`  
  
 `WHERE @JobID = CONVERT(uniqueidentifier, $(ESCAPE_NONE(JOBID))) ;`  
  
## <a name="see-also"></a><span data-ttu-id="5fa2e-241">Consulte también</span><span class="sxs-lookup"><span data-stu-id="5fa2e-241">See Also</span></span>  
 <span data-ttu-id="5fa2e-242">[Implementar trabajos](implement-jobs.md) </span><span class="sxs-lookup"><span data-stu-id="5fa2e-242">[Implement Jobs](implement-jobs.md) </span></span>  
 [<span data-ttu-id="5fa2e-243">Administrar pasos de trabajo</span><span class="sxs-lookup"><span data-stu-id="5fa2e-243">Manage Job Steps</span></span>](manage-job-steps.md)  
  
  
