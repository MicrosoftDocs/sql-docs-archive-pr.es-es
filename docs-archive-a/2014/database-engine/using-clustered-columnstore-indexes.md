---
title: Usar índices clúster de almacén de columnas | Microsoft Docs
ms.custom: ''
ms.date: 04/27/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: table-view-index
ms.topic: conceptual
ms.assetid: 5af6b91c-724f-45ac-aff1-7555014914f4
author: mashamsft
ms.author: mathoma
ms.openlocfilehash: afc7da4e28ef7f32ca4a2b4ea762e5a5af442471
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87663056"
---
# <a name="using-clustered-columnstore-indexes"></a><span data-ttu-id="5af35-102">Usar índices clúster de almacén de columnas</span><span class="sxs-lookup"><span data-stu-id="5af35-102">Using Clustered Columnstore Indexes</span></span>
  <span data-ttu-id="5af35-103">Tareas para utilizar índices clúster de almacén de columnas en [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="5af35-103">Tasks for using clustered columnstore indexes in [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span>

 <span data-ttu-id="5af35-104">Para obtener información general acerca de los índices de almacén de columnas, vea [Columnstore Indexes Described](../relational-databases/indexes/columnstore-indexes-described.md).</span><span class="sxs-lookup"><span data-stu-id="5af35-104">For an overview of columnstore indexes, see [Columnstore Indexes Described](../relational-databases/indexes/columnstore-indexes-described.md).</span></span>

 <span data-ttu-id="5af35-105">Para obtener información acerca de los índices clúster de almacén de columnas, vea [Using Clustered Columnstore Indexes](../relational-databases/indexes/indexes.md).</span><span class="sxs-lookup"><span data-stu-id="5af35-105">For information about clustered columnstore indexes, see [Using Clustered Columnstore Indexes](../relational-databases/indexes/indexes.md).</span></span>

## <a name="contents"></a><span data-ttu-id="5af35-106">Contenido</span><span class="sxs-lookup"><span data-stu-id="5af35-106">Contents</span></span>

-   [<span data-ttu-id="5af35-107">Crear un índice clúster de almacén de columnas</span><span class="sxs-lookup"><span data-stu-id="5af35-107">Create a Clustered Columnstore Index</span></span>](#create)

-   [<span data-ttu-id="5af35-108">Quitar un índice clúster de almacén de columnas</span><span class="sxs-lookup"><span data-stu-id="5af35-108">Drop a Clustered Columnstore Index</span></span>](#drop)

-   [<span data-ttu-id="5af35-109">Cargar los datos en un índice clúster de almacén de columnas</span><span class="sxs-lookup"><span data-stu-id="5af35-109">Load Data into a Clustered Columnstore Index</span></span>](#load)

-   [<span data-ttu-id="5af35-110">Cambiar los datos de un índice clúster de almacén de columnas</span><span class="sxs-lookup"><span data-stu-id="5af35-110">Change Data in a Clustered Columnstore Index</span></span>](#change)

-   [<span data-ttu-id="5af35-111">Volver a generar un índice clúster de almacén de columnas</span><span class="sxs-lookup"><span data-stu-id="5af35-111">Rebuild a Clustered Columnstore Index</span></span>](#rebuild)

-   [<span data-ttu-id="5af35-112">Reorganizar un índice clúster de almacén de columnas</span><span class="sxs-lookup"><span data-stu-id="5af35-112">Reorganize a Clustered Columnstore Index</span></span>](#reorganize)

##  <a name="create-a-clustered-columnstore-index"></a><a name="create"></a><span data-ttu-id="5af35-113">Crear un índice de almacén de columnas agrupado</span><span class="sxs-lookup"><span data-stu-id="5af35-113">Create a Clustered Columnstore Index</span></span>
 <span data-ttu-id="5af35-114">Para crear un índice clúster de almacén de columnas, cree primero una tabla almacén como un montón o un índice clúster y, a continuación, use la instrucción [Create Clustered almacén de columnas &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql) para convertir la tabla en un índice de almacén de columnas agrupado.</span><span class="sxs-lookup"><span data-stu-id="5af35-114">To create a clustered columnstore index, first create a rowstore table as a heap or clustered index, and then use the [CREATE CLUSTERED COLUMNSTORE INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql) statement to convert the table to a clustered columnstore index.</span></span> <span data-ttu-id="5af35-115">Si desea que el índice clúster de almacén de columnas tenga el mismo nombre que el índice clúster, use la opción DROP_EXISTING.</span><span class="sxs-lookup"><span data-stu-id="5af35-115">If you want the clustered columnstore index to have the same name as the clustered index, use the DROP_EXISTING option.</span></span>

 <span data-ttu-id="5af35-116">En este ejemplo se crea una tabla como un montón y después se convierte en un índice clúster de almacén de columnas denominado cci_Simple.</span><span class="sxs-lookup"><span data-stu-id="5af35-116">This example creates a table as a heap and then converts it to a clustered columnstore index named cci_Simple.</span></span> <span data-ttu-id="5af35-117">Esto cambia el almacenamiento de la tabla de un almacén de filas a un almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="5af35-117">This changes the storage for the entire table from rowstore to columnstore.</span></span>

```
CREATE TABLE T1(
    ProductKey [int] NOT NULL, 
    OrderDateKey [int] NOT NULL, 
    DueDateKey [int] NOT NULL, 
    ShipDateKey [int] NOT NULL);
GO
CREATE CLUSTERED COLUMNSTORE INDEX cci_T1 ON T1;
GO
```

 <span data-ttu-id="5af35-118">Para obtener más ejemplos, vea la sección ejemplos del tema sobre cómo [crear un índice de almacén de columnas en clúster &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="5af35-118">For more examples, see the Examples section in [CREATE CLUSTERED COLUMNSTORE INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql).</span></span>

##  <a name="drop-a-clustered-columnstore-index"></a><a name="drop"></a><span data-ttu-id="5af35-119">Quitar un índice de almacén de columnas agrupado</span><span class="sxs-lookup"><span data-stu-id="5af35-119">Drop a Clustered Columnstore Index</span></span>
 <span data-ttu-id="5af35-120">Use la instrucción [DROP INDEX &#40;&#41;de Transact-SQL](/sql/t-sql/statements/drop-index-transact-sql) para quitar un índice de almacén de columnas agrupado.</span><span class="sxs-lookup"><span data-stu-id="5af35-120">Use the [DROP INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/drop-index-transact-sql) statement to drop a clustered columnstore index.</span></span> <span data-ttu-id="5af35-121">Esta operación quitará el índice y convertirá la tabla de almacén de columnas en un montón de almacenes de filas.</span><span class="sxs-lookup"><span data-stu-id="5af35-121">This operation will drop the index and convert the columnstore table to a rowstore heap.</span></span>

##  <a name="load-data-into-a-clustered-columnstore-index"></a><a name="load"></a><span data-ttu-id="5af35-122">Carga de datos en un índice de almacén de columnas agrupado</span><span class="sxs-lookup"><span data-stu-id="5af35-122">Load Data into a Clustered Columnstore Index</span></span>
 <span data-ttu-id="5af35-123">Puede agregar datos a un índice clúster de almacén de columnas existente mediante cualquiera de los métodos estándar de carga.</span><span class="sxs-lookup"><span data-stu-id="5af35-123">You can add data to an existing clustered columnstore index by using any of the standard loading methods.</span></span>  <span data-ttu-id="5af35-124">Por ejemplo, la herramienta de carga masiva BCP, Integration Services e INSERT... Seleccione puede cargar todos los datos en un índice de almacén de columnas agrupado.</span><span class="sxs-lookup"><span data-stu-id="5af35-124">For example, the bcp bulk loading tool, Integration Services, and INSERT ... SELECT can all load data into a clustered columnstore index.</span></span>

 <span data-ttu-id="5af35-125">Los índices clúster de almacén de columnas aprovechan el almacén delta para evitar la fragmentación de segmentos de columna en el almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="5af35-125">Clustered columnstore indexes leverage the deltastore in order to prevent fragmentation of column segments in the columnstore.</span></span>

### <a name="loading-into-a-partitioned-table"></a><span data-ttu-id="5af35-126">Carga en una tabla con particiones</span><span class="sxs-lookup"><span data-stu-id="5af35-126">Loading into a partitioned table</span></span>
 <span data-ttu-id="5af35-127">Para los datos con particiones, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] primero asigna cada fila a una partición y después realiza operaciones del almacén de columnas con los datos de la partición.</span><span class="sxs-lookup"><span data-stu-id="5af35-127">For partitioned data, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] first assigns each row to a partition, and then performs columnstore operations on the data within the partition.</span></span> <span data-ttu-id="5af35-128">Cada partición tiene sus propios grupos de filas y un almacén delta por lo menos.</span><span class="sxs-lookup"><span data-stu-id="5af35-128">Each partition has its own rowgroups and at least one deltastore.</span></span>

### <a name="deltastore-loading-scenarios"></a><span data-ttu-id="5af35-129">Escenarios de carga de almacén delta</span><span class="sxs-lookup"><span data-stu-id="5af35-129">Deltastore loading scenarios</span></span>
 <span data-ttu-id="5af35-130">Las filas se acumulan en el almacén delta hasta que su número alcanza el máximo permitido para formar un grupo de filas.</span><span class="sxs-lookup"><span data-stu-id="5af35-130">Rows accumulate in the deltastore until the number of rows is the maximum number of rows allowed for a rowgroup.</span></span> <span data-ttu-id="5af35-131">Cuando almacén Delta contiene el número máximo de filas por filas, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] marca filas como "closed".</span><span class="sxs-lookup"><span data-stu-id="5af35-131">When the deltastore contains the maximum number of rows per rowgroup, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] marks the rowgroup as "CLOSED".</span></span> <span data-ttu-id="5af35-132">Un proceso en segundo plano, denominado "Tuple-Movers", busca el filas cerrado y se mueve al almacén de columnas, donde filas se comprime en segmentos de columna y los segmentos de columna se almacenan en el almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="5af35-132">A background process, called the "tuple-mover", finds the CLOSED rowgroup and moves into the columnstore, where the rowgroup is compressed into column segments and the column segments are stored in the columnstore.</span></span>

 <span data-ttu-id="5af35-133">Para cada índice clúster del almacén de columnas puede haber varios almacenes delta.</span><span class="sxs-lookup"><span data-stu-id="5af35-133">For each clustered columnstore index there can be multiple deltastores.</span></span>

-   <span data-ttu-id="5af35-134">Si un almacén delta está bloqueado, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] intentará obtener un bloqueo en otro almacén delta.</span><span class="sxs-lookup"><span data-stu-id="5af35-134">If a deltastore is locked, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] will try to obtain a lock on a different deltastore.</span></span> <span data-ttu-id="5af35-135">Si no hay almacenes delta disponibles, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] creará uno nuevo.</span><span class="sxs-lookup"><span data-stu-id="5af35-135">If there are no deltastores available, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] will create a new deltastore.</span></span>

-   <span data-ttu-id="5af35-136">En una tabla con particiones, puede haber uno o varios almacenes delta para cada partición.</span><span class="sxs-lookup"><span data-stu-id="5af35-136">For a partitioned table, there can be one or more deltastores for each partition.</span></span>

 <span data-ttu-id="5af35-137">Para los índices clúster de almacén de columnas solo, en los escenarios siguientes se describe cuándo las filas cargadas pasan directamente al almacén de columnas o cuándo van al almacén delta.</span><span class="sxs-lookup"><span data-stu-id="5af35-137">For clustered columnstore indexes only, the following scenarios describe when loaded rows go directly to the columnstore or when they go to the deltastore.</span></span>

 <span data-ttu-id="5af35-138">En este ejemplo, cada grupo de filas puede tener de 102.400 a 1.048.576 filas.</span><span class="sxs-lookup"><span data-stu-id="5af35-138">In the example, each rowgroup can have 102,400-1,048,576 rows per rowgroup.</span></span>

|<span data-ttu-id="5af35-139">Filas que se cargarán de forma masiva</span><span class="sxs-lookup"><span data-stu-id="5af35-139">Rows to Bulk Load</span></span>|<span data-ttu-id="5af35-140">Filas agregadas al almacén de columnas</span><span class="sxs-lookup"><span data-stu-id="5af35-140">Rows Added to the Columnstore</span></span>|<span data-ttu-id="5af35-141">Filas agregadas al almacén delta</span><span class="sxs-lookup"><span data-stu-id="5af35-141">Rows Added to the Deltastore</span></span>|
|-----------------------|-----------------------------------|----------------------------------|
|<span data-ttu-id="5af35-142">102 000</span><span class="sxs-lookup"><span data-stu-id="5af35-142">102,000</span></span>|<span data-ttu-id="5af35-143">0</span><span class="sxs-lookup"><span data-stu-id="5af35-143">0</span></span>|<span data-ttu-id="5af35-144">102 000</span><span class="sxs-lookup"><span data-stu-id="5af35-144">102,000</span></span>|
|<span data-ttu-id="5af35-145">145,000</span><span class="sxs-lookup"><span data-stu-id="5af35-145">145,000</span></span>|<span data-ttu-id="5af35-146">145,000</span><span class="sxs-lookup"><span data-stu-id="5af35-146">145,000</span></span><br /><br /> <span data-ttu-id="5af35-147">Tamaño del grupo de filas: 145,000</span><span class="sxs-lookup"><span data-stu-id="5af35-147">Rowgroup size: 145,000</span></span>|<span data-ttu-id="5af35-148">0</span><span class="sxs-lookup"><span data-stu-id="5af35-148">0</span></span>|
|<span data-ttu-id="5af35-149">1,048,577</span><span class="sxs-lookup"><span data-stu-id="5af35-149">1,048,577</span></span>|<span data-ttu-id="5af35-150">1,048,576</span><span class="sxs-lookup"><span data-stu-id="5af35-150">1,048,576</span></span><br /><br /> <span data-ttu-id="5af35-151">Tamaño del grupo de filas: 1 048 576.</span><span class="sxs-lookup"><span data-stu-id="5af35-151">Rowgroup size: 1,048,576.</span></span>|<span data-ttu-id="5af35-152">1</span><span class="sxs-lookup"><span data-stu-id="5af35-152">1</span></span>|
|<span data-ttu-id="5af35-153">2,252,152</span><span class="sxs-lookup"><span data-stu-id="5af35-153">2,252,152</span></span>|<span data-ttu-id="5af35-154">2,252,152</span><span class="sxs-lookup"><span data-stu-id="5af35-154">2,252,152</span></span><br /><br /> <span data-ttu-id="5af35-155">Tamaños de los grupos de filas: 1 048 576, 1 048 576, 155 000.</span><span class="sxs-lookup"><span data-stu-id="5af35-155">Rowgroup sizes: 1,048,576, 1,048,576, 155,000.</span></span>|<span data-ttu-id="5af35-156">0</span><span class="sxs-lookup"><span data-stu-id="5af35-156">0</span></span>|

 <span data-ttu-id="5af35-157">En el ejemplo siguiente se muestran los resultados de cargar 1.048.577 filas en una partición.</span><span class="sxs-lookup"><span data-stu-id="5af35-157">The following example shows the results of loading 1,048,577 rows into a partition.</span></span> <span data-ttu-id="5af35-158">Los resultados muestran un grupo de filas COMPRESSED en el almacén de columnas (como segmentos de columna comprimidos) y una fila en el almacén delta.</span><span class="sxs-lookup"><span data-stu-id="5af35-158">The results show that one COMPRESSED rowgroup in the columnstore (as compressed column segments), and 1 row in the deltastore.</span></span>

```sql
SELECT * FROM sys.column_store_row_groups;
```

 <span data-ttu-id="5af35-159">![Grupo de filas y almacenamiento delta para una carga por lotes](../../2014/database-engine/media/sql-server-pdw-columnstore-batchload.gif "Grupo de filas y almacenamiento delta para una carga por lotes")</span><span class="sxs-lookup"><span data-stu-id="5af35-159">![Rowgroup and deltastore for a batch load](../../2014/database-engine/media/sql-server-pdw-columnstore-batchload.gif "Rowgroup and deltastore for a batch load")</span></span>



##  <a name="change-data-in-a-clustered-columnstore-index"></a><a name="change"></a><span data-ttu-id="5af35-160">Cambiar datos en un índice de almacén de columnas agrupado</span><span class="sxs-lookup"><span data-stu-id="5af35-160">Change Data in a Clustered Columnstore Index</span></span>
 <span data-ttu-id="5af35-161">Los índices clúster de almacén de columnas admiten las operaciones del DML INSERT, UPDATE y DELETE.</span><span class="sxs-lookup"><span data-stu-id="5af35-161">Clustered columnstore indexes support insert, update, and delete DML operations.</span></span>

 <span data-ttu-id="5af35-162">Utilice [insert &#40;Transact-SQL&#41;](/sql/t-sql/statements/insert-transact-sql) para insertar una fila.</span><span class="sxs-lookup"><span data-stu-id="5af35-162">Use [INSERT &#40;Transact-SQL&#41;](/sql/t-sql/statements/insert-transact-sql) to insert a row.</span></span> <span data-ttu-id="5af35-163">Se agregará la fila al almacén delta.</span><span class="sxs-lookup"><span data-stu-id="5af35-163">The row will be added to the deltastore.</span></span>

 <span data-ttu-id="5af35-164">Use [DELETE &#40;Transact-SQL&#41;](/sql/t-sql/statements/delete-transact-sql) para eliminar una fila.</span><span class="sxs-lookup"><span data-stu-id="5af35-164">Use [DELETE &#40;Transact-SQL&#41;](/sql/t-sql/statements/delete-transact-sql) to delete a row.</span></span>

-   <span data-ttu-id="5af35-165">Si la fila se encuentra en el almacén de columnas, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] marca la fila como eliminada lógicamente, pero no recupera el almacenamiento físico de la fila hasta que se vuelve a generar el índice.</span><span class="sxs-lookup"><span data-stu-id="5af35-165">If the row is in the columnstore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] marks the row as logically deleted but does not reclaim the physical storage for the row until the index is rebuilt.</span></span>

-   <span data-ttu-id="5af35-166">Si la fila se encuentra en el almacén delta, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] elimina la fila lógica y físicamente.</span><span class="sxs-lookup"><span data-stu-id="5af35-166">If the row is in the deltastore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] logically and physically deletes the row.</span></span>

 <span data-ttu-id="5af35-167">Use [UPDATE &#40;Transact-SQL&#41;](/sql/t-sql/queries/update-transact-sql) para actualizar una fila.</span><span class="sxs-lookup"><span data-stu-id="5af35-167">Use [UPDATE &#40;Transact-SQL&#41;](/sql/t-sql/queries/update-transact-sql) to update a row.</span></span>

-   <span data-ttu-id="5af35-168">Si la fila se encuentra en el almacén de columnas, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] marca la fila como eliminada lógicamente y, a continuación, inserta la fila actualizada en el almacén delta.</span><span class="sxs-lookup"><span data-stu-id="5af35-168">If the row is in the columnstore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] marks the row as logically deleted, and then inserts the updated row into the deltastore.</span></span>

-   <span data-ttu-id="5af35-169">Si la fila se encuentra en el almacén delta, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] la actualiza en ese almacén.</span><span class="sxs-lookup"><span data-stu-id="5af35-169">If the row is in the deltastore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] updates the row in the deltastore.</span></span>

##  <a name="rebuild-a-clustered-columnstore-index"></a><a name="rebuild"></a><span data-ttu-id="5af35-170">Volver a generar un índice clúster de almacén de columnas</span><span class="sxs-lookup"><span data-stu-id="5af35-170">Rebuild a Clustered Columnstore Index</span></span>
 <span data-ttu-id="5af35-171">Use [crear índice clúster de almacén de columnas &#40;Transact-sql&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql) o [ALTER index &#40;transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql) para realizar una recompilación completa de un índice clúster de almacén de columnas existente.</span><span class="sxs-lookup"><span data-stu-id="5af35-171">Use [CREATE CLUSTERED COLUMNSTORE INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql) or [ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql) to perform a full rebuild of an existing clustered columnstore index.</span></span> <span data-ttu-id="5af35-172">Además, puede usar ALTER INDEX... Rebuild para volver a generar una partición específica.</span><span class="sxs-lookup"><span data-stu-id="5af35-172">Additionally, you can use ALTER INDEX ... REBUILD to rebuild a specific partition.</span></span>

### <a name="rebuild-process"></a><span data-ttu-id="5af35-173">Proceso de regeneración</span><span class="sxs-lookup"><span data-stu-id="5af35-173">Rebuild Process</span></span>
 <span data-ttu-id="5af35-174">Para volver a generar un índice de almacén de columnas clúster, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="5af35-174">To rebuild a clustered columnstore index, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]:</span></span>

-   <span data-ttu-id="5af35-175">Adquiere un bloqueo exclusivo en la tabla o la partición mientras se produce la regeneración.</span><span class="sxs-lookup"><span data-stu-id="5af35-175">Acquires an exclusive lock on the table or partition while the rebuild occurs.</span></span>  <span data-ttu-id="5af35-176">Los datos están “sin conexión” y no disponibles durante la regeneración.</span><span class="sxs-lookup"><span data-stu-id="5af35-176">The data is "offline" and unavailable during the rebuild.</span></span>

-   <span data-ttu-id="5af35-177">Desfragmenta el almacén de columnas físicamente eliminando filas que se han eliminado lógicamente de la tabla; los bytes eliminados se reclaman en los medios físicos.</span><span class="sxs-lookup"><span data-stu-id="5af35-177">Defragments the columnstore by physically deleting rows that have been logically deleted from the table; the deleted bytes are reclaimed on the physical media.</span></span>

-   <span data-ttu-id="5af35-178">Antes de volver a generar el índice, combina los datos del almacén de filas del almacén delta con los datos del almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="5af35-178">Merges the rowstore data in the deltastore with the data in the columnstore before it rebuilds the index.</span></span> <span data-ttu-id="5af35-179">Una vez finalizada la regeneración, todos los datos se almacenan en el almacén de columnas y el almacén delta se queda vacío.</span><span class="sxs-lookup"><span data-stu-id="5af35-179">When the rebuild is finished, all data is stored in columnstore format, and the deltastore is empty.</span></span>

-   <span data-ttu-id="5af35-180">Vuelve a comprimir todos los datos del almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="5af35-180">Re-compresses all data into the columnstore.</span></span> <span data-ttu-id="5af35-181">Hay dos copias del índice de almacén de columnas mientras se está produciendo la regeneración.</span><span class="sxs-lookup"><span data-stu-id="5af35-181">Two copies of the columnstore index exist while the rebuild is taking place.</span></span> <span data-ttu-id="5af35-182">Cuando se finaliza la recopilación, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] elimina el índice original del almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="5af35-182">When the rebuild is finished, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] deletes the original columnstore index.</span></span>

### <a name="recommendations-for-rebuilding-a-clustered-columnstore-index"></a><span data-ttu-id="5af35-183">Recomendaciones para volver a generar un índice clúster de almacén de columnas</span><span class="sxs-lookup"><span data-stu-id="5af35-183">Recommendations for Rebuilding a Clustered Columnstore Index</span></span>
 <span data-ttu-id="5af35-184">Volver a generar un índice clúster de almacén de columnas es útil para quitar la fragmentación y para mover todas las filas al almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="5af35-184">Rebuilding a clustered columnstore index is useful for removing fragmentation, and for moving all rows into the columnstore.</span></span> <span data-ttu-id="5af35-185">Siga estas recomendaciones:</span><span class="sxs-lookup"><span data-stu-id="5af35-185">We have the following recommendations:</span></span>

-   <span data-ttu-id="5af35-186">Vuelva a generar una partición en lugar de la tabla completa.</span><span class="sxs-lookup"><span data-stu-id="5af35-186">Rebuild a partition instead of the entire table.</span></span>

    1.  <span data-ttu-id="5af35-187">Volver a generar la tabla completa tarda mucho si el índice es grande y requiere el espacio en disco suficiente para almacenar una copia adicional del índice durante la regeneración.</span><span class="sxs-lookup"><span data-stu-id="5af35-187">Rebuilding the entire table takes a long time if the index is large, and it requires enough disk space to store an additional copy of the index during the rebuild.</span></span> <span data-ttu-id="5af35-188">Por lo general, solo es necesario volver a generar la partición que se ha usado más recientemente.</span><span class="sxs-lookup"><span data-stu-id="5af35-188">Usually it is only necessary to rebuild the most recently used partition.</span></span>

    2.  <span data-ttu-id="5af35-189">Para las tablas con particiones, no es necesario que vuelva a generar el índice de almacén de columnas completo, ya que es probable que se produzca la fragmentación solo en las particiones que se han modificado recientemente.</span><span class="sxs-lookup"><span data-stu-id="5af35-189">For partitioned tables, you do not need to rebuild the entire columnstore index because fragmentation is likely to occur in only the partitions that have been modified recently.</span></span> <span data-ttu-id="5af35-190">Las tablas de hechos y las tablas de dimensiones de gran tamaño normalmente tienen particiones para poder realizar operaciones de copia de seguridad y de administración con los fragmentos de la tabla.</span><span class="sxs-lookup"><span data-stu-id="5af35-190">Fact tables and large dimension tables are usually partitioned in order to perform backup and management operations on chunks of the table.</span></span>

-   <span data-ttu-id="5af35-191">Vuelva a generar una partición después de haber realizado operaciones DML intensivas.</span><span class="sxs-lookup"><span data-stu-id="5af35-191">Rebuild a partition after heavy DML operations.</span></span>

     <span data-ttu-id="5af35-192">La regeneración de una partición desfragmentará la partición y reducirá el almacenamiento de disco.</span><span class="sxs-lookup"><span data-stu-id="5af35-192">Rebuilding a partition will defragment the partition and reduce disk storage.</span></span> <span data-ttu-id="5af35-193">La regeneración eliminará todas las filas del almacén de columnas que están marcadas para eliminación y trasladará todas las filas de almacén delta al almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="5af35-193">Rebuilding will delete all rows from the columnstore that are marked for deletion, and it will move all rows from the deltastore into the columnstore.</span></span>

-   <span data-ttu-id="5af35-194">Vuelva a generar una partición después de cargar los datos.</span><span class="sxs-lookup"><span data-stu-id="5af35-194">Rebuild a partition after loading data.</span></span>

     <span data-ttu-id="5af35-195">Esto garantiza que todos los datos se almacenan en el almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="5af35-195">This ensures all data is stored in the columnstore.</span></span> <span data-ttu-id="5af35-196">Si se producen varias cargas al mismo tiempo, cada partición puede acabar teniendo varios almacenes delta.</span><span class="sxs-lookup"><span data-stu-id="5af35-196">If multiple loads occur at the same time, each partition could end up having multiple deltastores.</span></span> <span data-ttu-id="5af35-197">La regeneración trasladará todas las filas del almacén delta al almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="5af35-197">Rebuilding will move all deltastore rows into the columnstore.</span></span>

##  <a name="reorganize-a-clustered-columnstore-index"></a><a name="reorganize"></a><span data-ttu-id="5af35-198">Reorganizar un índice de almacén de columnas agrupado</span><span class="sxs-lookup"><span data-stu-id="5af35-198">Reorganize a Clustered Columnstore Index</span></span>
 <span data-ttu-id="5af35-199">La reorganización de un índice clúster de almacén de columnas desplaza todos los grupos de columnas marcados como CLOSED al almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="5af35-199">Reorganizing a clustered columnstore index moves all CLOSED rowgroups into the columnstore.</span></span> <span data-ttu-id="5af35-200">Para realizar una reorganización, use [ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql)con la opción reorganize.</span><span class="sxs-lookup"><span data-stu-id="5af35-200">To perform a reorganize, use [ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql)with the REORGANIZE option.</span></span>

 <span data-ttu-id="5af35-201">No es necesario llevar a cabo la reorganización para mover grupos de filas CLOSED al almacén de columnas.</span><span class="sxs-lookup"><span data-stu-id="5af35-201">Reorganizing is not required in order to move CLOSED rowgroups into the columnstore.</span></span> <span data-ttu-id="5af35-202">El proceso de tupla motriz encontrará finalmente todos los grupos de filas CLOSED y los moverá.</span><span class="sxs-lookup"><span data-stu-id="5af35-202">The tuple-mover process will eventually find all CLOSED rowgroups and move them.</span></span> <span data-ttu-id="5af35-203">Sin embargo, la tupla motriz es de un solo subproceso y los grupos de filas pueden no moverse lo suficientemente rápido para la carga de trabajo.</span><span class="sxs-lookup"><span data-stu-id="5af35-203">However, the tuple-mover is single-threaded and might not move rowgroups fast enough for your workload.</span></span>

### <a name="recommendations-for-reorganizing"></a><span data-ttu-id="5af35-204">Recomendaciones para reorganizar</span><span class="sxs-lookup"><span data-stu-id="5af35-204">Recommendations for Reorganizing</span></span>
 <span data-ttu-id="5af35-205">Cuándo se debe reorganizar un índice clúster de almacén de columnas:</span><span class="sxs-lookup"><span data-stu-id="5af35-205">When to reorganize a clustered columnstore index:</span></span>

-   <span data-ttu-id="5af35-206">Reorganice un índice clúster de almacén de columnas después de una o varias cargas de datos para obtener mejoras en el rendimiento de las consultas lo más rápidamente posible.</span><span class="sxs-lookup"><span data-stu-id="5af35-206">Reorganize a clustered columnstore index after one or more data loads to achieve query performance benefits as quickly as possible.</span></span> <span data-ttu-id="5af35-207">Inicialmente, el proceso de reorganización requerirá recursos de CPU adicionales para comprimir los datos, lo que podría reducir el rendimiento general del sistema.</span><span class="sxs-lookup"><span data-stu-id="5af35-207">Reorganizing will initially require additional CPU resources to compress the data, which could slow overall system performance.</span></span> <span data-ttu-id="5af35-208">Sin embargo, tan pronto como los datos están comprimidos, el rendimiento de las consultas puede mejorar.</span><span class="sxs-lookup"><span data-stu-id="5af35-208">However, as soon as the data is compressed, query performance can improve.</span></span>


