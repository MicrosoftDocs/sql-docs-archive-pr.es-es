---
title: affinity mask (opción de configuración del servidor) | Microsoft Docs
ms.custom: ''
ms.date: 10/20/2016
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: configuration
ms.topic: conceptual
helpviewer_keywords:
- default affinity mask option
- reloading processor cache
- processor cache [SQL Server]
- CPU [SQL Server], licensing
- deferred process call
- affinity mask option
- processor affinity [SQL Server]
- SMP
- DPC
ms.assetid: 5823ba29-a75d-4b3e-ba7b-421c07ab3ac1
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: dfebde8a9431026e8faedb2a1e76eb2f2d82e207
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87674347"
---
# <a name="affinity-mask-server-configuration-option"></a><span data-ttu-id="131ac-102">affinity mask (opción de configuración del servidor)</span><span class="sxs-lookup"><span data-stu-id="131ac-102">affinity mask Server Configuration Option</span></span>
    
> [!NOTE]  
>  [!INCLUDE[ssNoteDepFutureDontUse](../../includes/ssnotedepfuturedontuse-md.md)] <span data-ttu-id="131ac-103">Use [ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-server-configuration-transact-sql) en su lugar.</span><span class="sxs-lookup"><span data-stu-id="131ac-103">Use [ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-server-configuration-transact-sql) instead.</span></span>  
  
 <span data-ttu-id="131ac-104">Para realizar varias tareas, [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows a veces mueve subprocesos del proceso entre diferentes procesadores.</span><span class="sxs-lookup"><span data-stu-id="131ac-104">To carry out multitasking, [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows sometimes move process threads among different processors.</span></span> <span data-ttu-id="131ac-105">Aunque esta actividad es eficaz desde el punto de vista del sistema operativo, puede reducir el rendimiento de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] cuando la carga del sistema es grande, ya que la memoria caché de cada procesador se carga repetidamente con datos.</span><span class="sxs-lookup"><span data-stu-id="131ac-105">Although efficient from an operating system point of view, this activity can reduce [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] performance under heavy system loads, as each processor cache is repeatedly reloaded with data.</span></span> <span data-ttu-id="131ac-106">La asignación de procesadores a subprocesos específicos puede mejorar el rendimiento en estas condiciones al eliminar las operaciones de repetición de carga del procesador y reducir la migración de subprocesos entre procesadores (con lo que se reduce el cambio de contexto); dicha asociación entre un subproceso y un procesador se denomina afinidad del procesador.</span><span class="sxs-lookup"><span data-stu-id="131ac-106">Assigning processors to specific threads can improve performance under these conditions by eliminating processor reloads and reducing thread migration across processors (thereby reducing context switching); such an association between a thread and a processor is called processor affinity.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]<span data-ttu-id="131ac-107">admite la afinidad del procesador por medio de dos opciones de máscara de afinidad: affinity mask (también conocida como **CPU affinity mask**) y Affinity I/o Mask.</span><span class="sxs-lookup"><span data-stu-id="131ac-107">supports processor affinity by means of two affinity mask options: affinity mask (also known as **CPU affinity mask**) and affinity I/O mask.</span></span> <span data-ttu-id="131ac-108">Para obtener más información sobre la opción de máscara de afinidad de E/S, vea [affinity I/O mask (opción de configuración del servidor)](affinity-input-output-mask-server-configuration-option.md).</span><span class="sxs-lookup"><span data-stu-id="131ac-108">For more information on the affinity I/O maskoption, see [affinity Input-Output mask Server Configuration Option](affinity-input-output-mask-server-configuration-option.md).</span></span> <span data-ttu-id="131ac-109">La compatibilidad de afinidad de CPU y E/S con servidores con entre 33 y 64 procesadores exige el uso adicional de las opciones [affinity64 mask (opción de configuración del servidor)](affinity64-mask-server-configuration-option.md) y [affinity64 I/O mask (opción de configuración del servidor)](affinity64-input-output-mask-server-configuration-option.md), respectivamente.</span><span class="sxs-lookup"><span data-stu-id="131ac-109">CPU and I/O affinity support for servers with 33 to 64 processors requires the additional use of the [affinity64 mask Server Configuration Option](affinity64-mask-server-configuration-option.md) and [affinity64 Input-Output mask Server Configuration Option](affinity64-input-output-mask-server-configuration-option.md), respectively.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="131ac-110">La compatibilidad de la afinidad con servidores que tienen entre 33 y 64 procesadores solo está disponible en sistemas operativos de 64 bits.</span><span class="sxs-lookup"><span data-stu-id="131ac-110">Affinity support for servers with 33 to 64 processors is only available on 64-bit operating systems.</span></span>  
  
 <span data-ttu-id="131ac-111">La opción affinity mask, que existía en versiones anteriores de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], controla la afinidad de la CPU de forma dinámica.</span><span class="sxs-lookup"><span data-stu-id="131ac-111">The affinity mask option, which existed in earlier releases of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], dynamically controls CPU affinity.</span></span>  
  
 <span data-ttu-id="131ac-112">En [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], la opción affinity mask se puede configurar sin necesidad de reiniciar la instancia de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="131ac-112">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], the affinity mask option can be configured without requiring a restart of the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="131ac-113">Si usa sp_configure, debe ejecutar RECONFIGURE o RECONFIGURE WITH OVERRIDE después de establecer una opción de configuración.</span><span class="sxs-lookup"><span data-stu-id="131ac-113">When you are using sp_configure, you must run either RECONFIGURE or RECONFIGURE WITH OVERRIDE after setting a configuration option.</span></span> <span data-ttu-id="131ac-114">Cuando se utiliza [!INCLUDE[ssExpress](../../includes/ssexpress-md.md)], es necesario reiniciar después de modificar la opción affinity mask.</span><span class="sxs-lookup"><span data-stu-id="131ac-114">When you are using [!INCLUDE[ssExpress](../../includes/ssexpress-md.md)], changing the affinity mask option does require a restart.</span></span>  
  
 <span data-ttu-id="131ac-115">Los cambios en las máscaras de afinidad se producen de forma dinámica, lo que permite el inicio y cierre a petición de los programadores de CPU que enlazan los subprocesos en [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="131ac-115">Changes to the affinity masks occur dynamically, allowing for on-demand startup and shutdown of the CPU schedulers that bind process threads within [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="131ac-116">Esto puede ocurrir cuando cambien las condiciones del servidor.</span><span class="sxs-lookup"><span data-stu-id="131ac-116">This can occur as conditions change on the server.</span></span> <span data-ttu-id="131ac-117">Por ejemplo, si se agrega al servidor una nueva instancia de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , puede ser necesario realizar ajustes en la opción affinity mask para redistribuir la carga del procesador.</span><span class="sxs-lookup"><span data-stu-id="131ac-117">For example, if a new instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is added to the server, it may be necessary to make adjustments to the affinity mask option to redistribute processor load.</span></span>  
  
 <span data-ttu-id="131ac-118">Las modificaciones de las máscaras de bits de afinidad requieren que [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] habilite un nuevo programador de CPU y deshabilite el programador de CPU existente.</span><span class="sxs-lookup"><span data-stu-id="131ac-118">Modifications to the affinity bitmasks require [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to enable a new CPU scheduler and disable the existing CPU scheduler.</span></span> <span data-ttu-id="131ac-119">A continuación se pueden procesar otros lotes en los programadores nuevos o restantes.</span><span class="sxs-lookup"><span data-stu-id="131ac-119">New batches can then be processed on the new or remaining schedulers.</span></span>  
  
 <span data-ttu-id="131ac-120">Para iniciar un nuevo programador de CPU, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] crea un nuevo programador y lo agrega a la lista de programadores estándar.</span><span class="sxs-lookup"><span data-stu-id="131ac-120">To start a new CPU scheduler, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] creates a new scheduler and adds it to the list of its standard schedulers.</span></span> <span data-ttu-id="131ac-121">El nuevo programador solo se tiene en cuenta para los nuevos procesos por lotes entrantes.</span><span class="sxs-lookup"><span data-stu-id="131ac-121">The new scheduler is considered only for the new incoming batches.</span></span> <span data-ttu-id="131ac-122">Los procesos por lotes actuales continúan ejecutándose en el mismo programador.</span><span class="sxs-lookup"><span data-stu-id="131ac-122">Current batches continue to run on the same scheduler.</span></span> <span data-ttu-id="131ac-123">Los subprocesos de trabajo migran al nuevo programador cuando se liberan o cuando se crean nuevos subprocesos de trabajo.</span><span class="sxs-lookup"><span data-stu-id="131ac-123">The workers migrate to the new scheduler as they free up, or as new workers are created.</span></span>  
  
 <span data-ttu-id="131ac-124">Para cerrar un programador, es necesario que todos los procesos por lotes del programador finalicen sus actividades y se cierren.</span><span class="sxs-lookup"><span data-stu-id="131ac-124">Shutting down a scheduler requires all batches on the scheduler to complete their activities and exit.</span></span> <span data-ttu-id="131ac-125">Los programadores que se han cerrado se marcan como sin conexión para que no se programe ningún proceso por lotes nuevo en ellos.</span><span class="sxs-lookup"><span data-stu-id="131ac-125">A scheduler that has been shut down is marked as offline so that no new batch is scheduled on it.</span></span>  
  
 <span data-ttu-id="131ac-126">Tanto si se agrega un nuevo programador como si se quita, las tareas permanentes del sistema, como lockmonitor, checkpoint, subproceso de tarea del sistema (DTC en procesamiento) y el proceso de señal, continúan ejecutándose en el programador mientras el servidor esté operativo.</span><span class="sxs-lookup"><span data-stu-id="131ac-126">Whether a new scheduler is added or removed, the permanent system tasks such as lockmonitor, checkpoint, system task thread (processing DTC), and signal process continue to run on the scheduler while the server is operational.</span></span> <span data-ttu-id="131ac-127">Estas tareas permanentes del sistema no se migran de forma dinámica.</span><span class="sxs-lookup"><span data-stu-id="131ac-127">These permanent system tasks do not dynamically migrate.</span></span> <span data-ttu-id="131ac-128">Para redistribuir la carga del procesador para estas tareas del sistema entre los programadores, es necesario reiniciar la instancia de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="131ac-128">To redistribute processor load for these system tasks across schedulers, it is necessary to restart the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="131ac-129">Si [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] intenta cerrar un programador asociado con una tarea permanente del sistema, ésta continúa ejecutándose en el programador sin conexión (sin migración).</span><span class="sxs-lookup"><span data-stu-id="131ac-129">If [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] attempts to shut down a scheduler associated with a permanent system task, the task continues to run on the offline scheduler (no migration).</span></span> <span data-ttu-id="131ac-130">Este programador está enlazado a los procesadores de la máscara de afinidad modificada y no debe imponer ninguna carga en el procesador con el que se estableció la afinidad antes del cambio.</span><span class="sxs-lookup"><span data-stu-id="131ac-130">This scheduler is bound to the processors in the modified affinity mask and should not put any load on the processor it was affinitized with before the change.</span></span> <span data-ttu-id="131ac-131">La existencia de programadores sin conexión adicionales no debería afectar significativamente a la carga del sistema.</span><span class="sxs-lookup"><span data-stu-id="131ac-131">Having extra offline schedulers, should not significantly affect the load of the system.</span></span> <span data-ttu-id="131ac-132">En caso contrario, es necesario reiniciar el servidor de base de datos para volver a configurar las tareas.</span><span class="sxs-lookup"><span data-stu-id="131ac-132">If this is not the case, a database server reboot is required to reconfigure these tasks.</span></span>  
  
 <span data-ttu-id="131ac-133">La máscara de afinidad de E/S afecta directamente a las tareas de afinidad de E/S (como lazywriter y logwriter).</span><span class="sxs-lookup"><span data-stu-id="131ac-133">The I/O affinity tasks (such as lazywriter and logwriter) are directly affected by the I/O affinity mask.</span></span> <span data-ttu-id="131ac-134">Si no se ha establecido la afinidad para las tareas lazywriter y logwriter, siguen las mismas reglas definidas para las demás tareas permanentes, como lockmonitor o checkpoint.</span><span class="sxs-lookup"><span data-stu-id="131ac-134">If the lazywriter and logwriter tasks are not affinitized, they follow the same rules defined for the other permanent tasks such as lockmonitor or checkpoint.</span></span>  
  
 <span data-ttu-id="131ac-135">Para asegurarse de que la nueva máscara de afinidad es válida, el comando RECONFIGURE comprueba que las afinidades normales de CPU y E/S se excluyen mutuamente.</span><span class="sxs-lookup"><span data-stu-id="131ac-135">To ensure that the new affinity mask is valid, the RECONFIGURE command verifies that the normal CPU and I/O affinities are mutually exclusive.</span></span> <span data-ttu-id="131ac-136">En caso contrario, se envía un mensaje de error a la sesión de cliente y al registro de errores de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] para indicar que no se recomienda dicha configuración.</span><span class="sxs-lookup"><span data-stu-id="131ac-136">If this is not the case, an error message is reported to the client session and to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log, indicating that such a setting is not recommended.</span></span> <span data-ttu-id="131ac-137">La ejecución de la opción RECONFIGURE WITH OVERRIDE permite afinidades de CPU y E/S que no se excluyen mutuamente.</span><span class="sxs-lookup"><span data-stu-id="131ac-137">Running RECONFIGURE WITH OVERRIDE options allows CPU and I/O affinities that are not mutually exclusive.</span></span>  
  
 <span data-ttu-id="131ac-138">Si especifica una máscara de afinidad que intenta asignarse a una CPU inexistente, el comando RECONFIGURE envía un mensaje de error a la sesión de cliente y al registro de errores de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="131ac-138">If you specify an affinity mask that attempts to map to a nonexistent CPU, the RECONFIGURE command reports an error message to both the client session and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log.</span></span> <span data-ttu-id="131ac-139">El uso de la opción RECONFIGURE WITH OVERRIDE no tiene efecto en este caso y se vuelve a enviar el mismo error de configuración.</span><span class="sxs-lookup"><span data-stu-id="131ac-139">Using the RECONFIGURE WITH OVERRIDE option has no effect in this case, and the same configuration error is reported again.</span></span>  
  
 <span data-ttu-id="131ac-140">También puede excluir la actividad de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] de los procesadores a los que el sistema operativo Windows 2000 o Windows Server 2003 han asignado cargas de trabajo específicas.</span><span class="sxs-lookup"><span data-stu-id="131ac-140">You can also exclude [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] activity from processors assigned specific workload assignments by the Windows 2000 or Windows Server 2003 operating system.</span></span> <span data-ttu-id="131ac-141">Si establece el valor 1 para un bit que representa un procesador, el motor de base de datos de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] selecciona dicho procesador para la asignación de subprocesos.</span><span class="sxs-lookup"><span data-stu-id="131ac-141">If you set a bit representing a processor to 1, that processor is selected by the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Database Engine for thread assignment.</span></span> <span data-ttu-id="131ac-142">Cuando se establece `affinity mask` en 0 (valor predeterminado), los algoritmos de programación de Microsoft windows 2000 o Windows Server 2003 establecen la afinidad del subproceso.</span><span class="sxs-lookup"><span data-stu-id="131ac-142">When you set `affinity mask` to 0 (the default), the Microsoft Windows 2000 or Windows Server 2003 scheduling algorithms set the thread's affinity.</span></span> <span data-ttu-id="131ac-143">Si establece `affinity mask` en cualquier valor distinto de cero, la afinidad de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] interpreta el valor como una máscara de bits que especifica los procesadores que se pueden seleccionar.</span><span class="sxs-lookup"><span data-stu-id="131ac-143">When you set `affinity mask` to any nonzero value, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] affinity interprets the value as a bitmask that specifies those processors eligible for selection.</span></span>  
  
 <span data-ttu-id="131ac-144">Mediante la separación de los subprocesos de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] para que se ejecuten en determinados procesadores, Microsoft Windows 2000 o Windows Server 2003 pueden evaluar mejor el control de los procesos específicos de Windows por parte del sistema.</span><span class="sxs-lookup"><span data-stu-id="131ac-144">By segregating [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] threads from running on particular processors, Microsoft Windows 2000 or Windows Server 2003 can better evaluate the system's handling of processes specific to Windows.</span></span> <span data-ttu-id="131ac-145">Por ejemplo, en un servidor de 8 CPU en el que se ejecutan dos instancias de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (instancias A y B), el administrador del sistema puede utilizar la opción affinity mask para asignar el primer conjunto de 4 CPU a la instancia A y el segundo conjunto de 4 CPU a la instancia B. Para configurar más de 32 procesadores, establezca las opciones affinity mask y affinity64 mask.</span><span class="sxs-lookup"><span data-stu-id="131ac-145">For example, on an 8-CPU server running two instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (instance A and B), the system administrator could use the affinity mask option to assign the first set of 4 CPUs to instance A and the second set of 4 to instance B. To configure more than 32 processors, set both the affinity mask and the affinity64 mask.</span></span> <span data-ttu-id="131ac-146">Estos son los valores para `affinity mask`:</span><span class="sxs-lookup"><span data-stu-id="131ac-146">The values for `affinity mask` are as follows:</span></span>  
  
-   <span data-ttu-id="131ac-147">Una opción `affinity mask` de un byte cubre hasta 8 CPU en un equipo con varios procesadores.</span><span class="sxs-lookup"><span data-stu-id="131ac-147">A one-byte `affinity mask` covers up to 8 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="131ac-148">Una opción `affinity mask` de dos bytes cubre hasta 8 CPU en un equipo con varios procesadores.</span><span class="sxs-lookup"><span data-stu-id="131ac-148">A two-byte `affinity mask` covers up to 16 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="131ac-149">Una opción `affinity mask` de tres bytes cubre hasta 24 CPU en un equipo con varios procesadores.</span><span class="sxs-lookup"><span data-stu-id="131ac-149">A three-byte `affinity mask` covers up to 24 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="131ac-150">Una opción `affinity mask` de cuatro bytes cubre hasta 32 CPU en un equipo con varios procesadores.</span><span class="sxs-lookup"><span data-stu-id="131ac-150">A four-byte `affinity mask` covers up to 32 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="131ac-151">Para cubrir más de 32 CPU, configure una opción affinity mask de cuatro bytes para las primeras 32 CPU y una opción affinity64 mask de hasta cuatro bytes para las restantes CPU.</span><span class="sxs-lookup"><span data-stu-id="131ac-151">To cover more than 32 CPUs, configure a four-byte affinity mask for the first 32 CPUs and up to a four-byte affinity64 mask for the remaining CPUs.</span></span>  
  
 <span data-ttu-id="131ac-152">Como la configuración de la afinidad del procesador de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] es una operación especial, se recomienda utilizarla solo cuando sea necesario.</span><span class="sxs-lookup"><span data-stu-id="131ac-152">Because setting [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] processor affinity is a specialized operation, it is recommended that it be used only when necessary.</span></span> <span data-ttu-id="131ac-153">En la mayor parte de los casos, el mejor rendimiento se obtiene con la afinidad predeterminada de Microsoft Windows 2000 o Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="131ac-153">In most cases, the Microsoft Windows 2000 or Windows Server 2003 default affinity provides the best performance.</span></span> <span data-ttu-id="131ac-154">Al configurar las máscaras de afinidad, también debe considerar los requisitos de CPU para otras aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="131ac-154">You should also consider the CPU requirements for other applications when setting the affinity masks.</span></span> <span data-ttu-id="131ac-155">Para obtener más información, vea la documentación del sistema operativo Windows.</span><span class="sxs-lookup"><span data-stu-id="131ac-155">For more information, see your Windows operating system documentation.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="131ac-156">Puede utilizar el Monitor de sistema de Windows para ver y analizar el uso individual del procesador.</span><span class="sxs-lookup"><span data-stu-id="131ac-156">You can use the Windows System Monitor to view and analyze individual processor usage.</span></span>  
  
 <span data-ttu-id="131ac-157">Al especificar la opción affinity I/O mask, debe usarla en conexión con la opción de configuración affinity mask.</span><span class="sxs-lookup"><span data-stu-id="131ac-157">When specifying the affinity I/O mask option, you must use it in connection with the affinity mask configuration option.</span></span> <span data-ttu-id="131ac-158">No habilite la misma CPU en el modificador `affinity mask` y la opción affinity I/O mask.</span><span class="sxs-lookup"><span data-stu-id="131ac-158">Do not enable the same CPU in both the `affinity mask` switch and the affinity I/O mask option.</span></span> <span data-ttu-id="131ac-159">Los bits correspondientes a cada CPU deben estar en uno de los tres estados siguientes:</span><span class="sxs-lookup"><span data-stu-id="131ac-159">The bits corresponding to each CPU should be in one of these three states:</span></span>  
  
-   <span data-ttu-id="131ac-160">0 tanto en la opción affinity mask como en la opción affinity I/O mask.</span><span class="sxs-lookup"><span data-stu-id="131ac-160">0 in both the affinity mask option and the affinity I/O mask option.</span></span>  
  
-   <span data-ttu-id="131ac-161">1 en la opción affinity mask y 0 en la opción affinity I/O mask.</span><span class="sxs-lookup"><span data-stu-id="131ac-161">1 in the affinity mask option and 0 in the affinity I/O mask option.</span></span>  
  
-   <span data-ttu-id="131ac-162">0 en la opción affinity mask y 1 en la opción affinity I/O mask.</span><span class="sxs-lookup"><span data-stu-id="131ac-162">0 in the affinity mask option and 1 in the affinity I/O mask option.</span></span>  
  
> [!CAUTION]  
>  <span data-ttu-id="131ac-163">No configure la afinidad de CPU en el sistema operativo Windows y la máscara de afinidad en [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="131ac-163">Do not configure CPU affinity in the Windows operating system and also configure the affinity mask in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="131ac-164">Esta configuración intenta lograr el mismo resultado y, si las configuraciones no son coherentes, puede obtener resultados impredecibles.</span><span class="sxs-lookup"><span data-stu-id="131ac-164">These settings are attempting to achieve the same result, and if the configurations are inconsistent, you may have unpredictable results.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="131ac-165">La afinidad de CPU se configura mejor mediante la opción sp_configure de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="131ac-165">CPU affinity is best configured using the sp_configure option in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
## <a name="example"></a><span data-ttu-id="131ac-166">Ejemplo</span><span class="sxs-lookup"><span data-stu-id="131ac-166">Example</span></span>  
 <span data-ttu-id="131ac-167">Como ejemplo de configuración de la opción affinity mask, si los procesadores 1, 2 y 5 están seleccionados como disponibles con el valor 1 para los bits 1, 2 y 5, y el valor 0 para los bits 0, 3, 4, 6 y 7, se especifica el valor hexadecimal 0x26 o el valor decimal equivalente `38` .</span><span class="sxs-lookup"><span data-stu-id="131ac-167">As an example of setting the affinity mask option, if processors 1, 2, and 5 are selected as available with bits 1, 2, and 5 set to 1 and bits 0, 3, 4, 6, and 7 set to 0, a hexadecimal value of 0x26 or the decimal equivalent of `38` is specified.</span></span> <span data-ttu-id="131ac-168">Enumere los bits de derecha a izquierda.</span><span class="sxs-lookup"><span data-stu-id="131ac-168">Number the bits from right to left.</span></span> <span data-ttu-id="131ac-169">La opción affinity mask comienza a contar los procesadores de 0 a 31, de modo que en el ejemplo siguiente el contador `1` representa el segundo procesador del servidor.</span><span class="sxs-lookup"><span data-stu-id="131ac-169">The affinity mask option starts counting processors from 0 to 31, so that in the following example the counter `1` represents the second processor on the server.</span></span>  
  
```  
sp_configure 'show advanced options', 1;  
RECONFIGURE;  
GO  
sp_configure 'affinity mask', 38;  
RECONFIGURE;  
GO  
```  
  
 <span data-ttu-id="131ac-170">A continuación se indican los valores de `affinity mask` para un sistema con 8 CPU.</span><span class="sxs-lookup"><span data-stu-id="131ac-170">These are `affinity mask` values for an 8-CPU system.</span></span>  
  
|<span data-ttu-id="131ac-171">Valor decimal</span><span class="sxs-lookup"><span data-stu-id="131ac-171">Decimal value</span></span>|<span data-ttu-id="131ac-172">Máscara de bits binarios</span><span class="sxs-lookup"><span data-stu-id="131ac-172">Binary bit mask</span></span>|<span data-ttu-id="131ac-173">Permitir subprocesos de SQL Server en procesadores</span><span class="sxs-lookup"><span data-stu-id="131ac-173">Allow SQL Server threads on processors</span></span>|  
|-------------------|---------------------|--------------------------------------------|  
|<span data-ttu-id="131ac-174">1</span><span class="sxs-lookup"><span data-stu-id="131ac-174">1</span></span>|<span data-ttu-id="131ac-175">00000001</span><span class="sxs-lookup"><span data-stu-id="131ac-175">00000001</span></span>|<span data-ttu-id="131ac-176">0</span><span class="sxs-lookup"><span data-stu-id="131ac-176">0</span></span>|  
|<span data-ttu-id="131ac-177">3</span><span class="sxs-lookup"><span data-stu-id="131ac-177">3</span></span>|<span data-ttu-id="131ac-178">00000011</span><span class="sxs-lookup"><span data-stu-id="131ac-178">00000011</span></span>|<span data-ttu-id="131ac-179">0 y 1</span><span class="sxs-lookup"><span data-stu-id="131ac-179">0 and 1</span></span>|  
|<span data-ttu-id="131ac-180">7</span><span class="sxs-lookup"><span data-stu-id="131ac-180">7</span></span>|<span data-ttu-id="131ac-181">00000111</span><span class="sxs-lookup"><span data-stu-id="131ac-181">00000111</span></span>|<span data-ttu-id="131ac-182">0, 1 y 2</span><span class="sxs-lookup"><span data-stu-id="131ac-182">0, 1, and 2</span></span>|  
|<span data-ttu-id="131ac-183">15</span><span class="sxs-lookup"><span data-stu-id="131ac-183">15</span></span>|<span data-ttu-id="131ac-184">00001111</span><span class="sxs-lookup"><span data-stu-id="131ac-184">00001111</span></span>|<span data-ttu-id="131ac-185">0, 1, 2 y 3</span><span class="sxs-lookup"><span data-stu-id="131ac-185">0, 1, 2, and 3</span></span>|  
|<span data-ttu-id="131ac-186">31</span><span class="sxs-lookup"><span data-stu-id="131ac-186">31</span></span>|<span data-ttu-id="131ac-187">00011111</span><span class="sxs-lookup"><span data-stu-id="131ac-187">00011111</span></span>|<span data-ttu-id="131ac-188">0, 1, 2, 3 y 4</span><span class="sxs-lookup"><span data-stu-id="131ac-188">0, 1, 2, 3, and 4</span></span>|  
|<span data-ttu-id="131ac-189">63</span><span class="sxs-lookup"><span data-stu-id="131ac-189">63</span></span>|<span data-ttu-id="131ac-190">00111111</span><span class="sxs-lookup"><span data-stu-id="131ac-190">00111111</span></span>|<span data-ttu-id="131ac-191">0, 1, 2, 3, 4 y 5</span><span class="sxs-lookup"><span data-stu-id="131ac-191">0, 1, 2, 3, 4, and 5</span></span>|  
|<span data-ttu-id="131ac-192">127</span><span class="sxs-lookup"><span data-stu-id="131ac-192">127</span></span>|<span data-ttu-id="131ac-193">01111111</span><span class="sxs-lookup"><span data-stu-id="131ac-193">01111111</span></span>|<span data-ttu-id="131ac-194">0, 1, 2, 3, 4, 5 y 6</span><span class="sxs-lookup"><span data-stu-id="131ac-194">0, 1, 2, 3, 4, 5, and 6</span></span>|  
|<span data-ttu-id="131ac-195">255</span><span class="sxs-lookup"><span data-stu-id="131ac-195">255</span></span>|<span data-ttu-id="131ac-196">11111111</span><span class="sxs-lookup"><span data-stu-id="131ac-196">11111111</span></span>|<span data-ttu-id="131ac-197">0, 1, 2, 3, 4, 5, 6 y 7</span><span class="sxs-lookup"><span data-stu-id="131ac-197">0, 1, 2, 3, 4, 5, 6, and 7</span></span>|  
  
 <span data-ttu-id="131ac-198">La opción affinity mask es una opción avanzada.</span><span class="sxs-lookup"><span data-stu-id="131ac-198">The affinity mask option is an advanced option.</span></span> <span data-ttu-id="131ac-199">Si usa el sp_configure procedimiento almacenado del sistema para cambiar la configuración, solo puede cambiar si `affinity mask` **Mostrar opciones avanzadas** está establecido en 1.</span><span class="sxs-lookup"><span data-stu-id="131ac-199">If you are using the sp_configure system stored procedure to change the setting, you can change `affinity mask` only when **show advanced options** is set to 1.</span></span> <span data-ttu-id="131ac-200">Después de ejecutar el comando RECONFIGURE de [!INCLUDE[tsql](../../includes/tsql-md.md)] , la nueva configuración se aplica inmediatamente sin necesidad de reiniciar la instancia de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="131ac-200">After executing the [!INCLUDE[tsql](../../includes/tsql-md.md)] RECONFIGURE command, the new setting takes effect immediately without requiring a restart of the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance.</span></span>  
  
## <a name="non-uniform-memory-access-numa"></a><span data-ttu-id="131ac-201">Acceso no uniforme a memoria (NUMA)</span><span class="sxs-lookup"><span data-stu-id="131ac-201">Non-uniform Memory Access (NUMA)</span></span>  
 <span data-ttu-id="131ac-202">Cuando se utiliza el acceso no uniforme a memoria (NUMA) basado en hardware y se ha establecido affinity mask, se establecerá la afinidad de cada programador de un nodo con su propia CPU.</span><span class="sxs-lookup"><span data-stu-id="131ac-202">When using hardware based non-uniform memory access (NUMA) and the affinity mask is set, every scheduler in a node will be affinitized to its own CPU.</span></span> <span data-ttu-id="131ac-203">Cuando no se establece la opción affinity mask, se establece la afinidad de cada programador con el grupo de CPU en un nodo NUMA y un programador asignado al nodo NUMA N1 puede programar trabajos en cualquier CPU del nodo, pero no en las CPU asociadas a otro nodo.</span><span class="sxs-lookup"><span data-stu-id="131ac-203">When the affinity mask is not set, each scheduler is affinitized to the group of CPUs within the NUMA node and a scheduler mapped to NUMA node N1 can schedule work on any CPU in the node, but not on CPUs associated with another node.</span></span>  
  
 <span data-ttu-id="131ac-204">Cualquier operación que se ejecute en un solo nodo NUMA únicamente puede utilizar las páginas de búfer de ese nodo.</span><span class="sxs-lookup"><span data-stu-id="131ac-204">Any operation running on a single NUMA node can only use buffer pages from that node.</span></span> <span data-ttu-id="131ac-205">Cuando una operación se ejecuta en paralelo en las CPU de varios nodos, se puede utilizar la memoria de cualquiera de estos nodos.</span><span class="sxs-lookup"><span data-stu-id="131ac-205">When an operation is run in parallel on CPUs from multiple nodes, memory can be used from any node involved.</span></span>  
  
## <a name="licensing-issues"></a><span data-ttu-id="131ac-206">Consideraciones acerca de las licencias</span><span class="sxs-lookup"><span data-stu-id="131ac-206">Licensing Issues</span></span>  
 <span data-ttu-id="131ac-207">La afinidad dinámica está estrictamente restringida por las licencias de CPU.</span><span class="sxs-lookup"><span data-stu-id="131ac-207">Dynamic affinity is tightly constrained by CPU licensing.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="131ac-208">no permite la configuración de las opciones de máscara de afinidad que infrinjan las directivas de las licencias.</span><span class="sxs-lookup"><span data-stu-id="131ac-208">does not allow any configuration of affinity mask options that violates the licensing policy.</span></span>  
  
### <a name="startup"></a><span data-ttu-id="131ac-209">Inicio</span><span class="sxs-lookup"><span data-stu-id="131ac-209">Startup</span></span>  
 <span data-ttu-id="131ac-210">Si una máscara de afinidad especificada infringe las directivas de las licencias durante el inicio de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] o al adjuntar la base de datos, el nivel del motor completará el proceso de inicio o la operación para adjuntar o restaurar la base de datos; después, volverá a establecer en cero el valor de ejecución de sp_configure para la opción affinity mask y enviará un mensaje de error al registro de errores de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="131ac-210">If a specified affinity mask violates the licensing policy during [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] startup or during database attach, the engine layer will complete the startup process or database attach/restore operation, and then it will reset the sp_configure run value for the affinity mask to zero, issuing an error message to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log.</span></span>  
  
### <a name="reconfigure"></a><span data-ttu-id="131ac-211">Volver a configurar</span><span class="sxs-lookup"><span data-stu-id="131ac-211">Reconfigure</span></span>  
 <span data-ttu-id="131ac-212">Si una máscara de afinidad determinada infringe las directivas de las licencias en la ejecución del comando RECONFIGURE de [!INCLUDE[tsql](../../includes/tsql-md.md)] , se envía un mensaje de error a la sesión de cliente y al registro de errores de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] solicitando que el administrador de la base de datos vuelva a configurar la máscara de afinidad.</span><span class="sxs-lookup"><span data-stu-id="131ac-212">If a specified affinity mask violates the licensing policy when running [!INCLUDE[tsql](../../includes/tsql-md.md)] RECONFIGURE command, an error message is reported to the client session and to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log, requiring the database administrator to reconfigure the affinity mask.</span></span> <span data-ttu-id="131ac-213">En este caso no se acepta ningún comando RECONFIGURE WITH OVERRIDE.</span><span class="sxs-lookup"><span data-stu-id="131ac-213">No RECONFIGURE WITH OVERRIDE command is accepted in this case.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="131ac-214">Consulte también</span><span class="sxs-lookup"><span data-stu-id="131ac-214">See Also</span></span>  
 <span data-ttu-id="131ac-215">[Supervisar el uso de recursos &#40;Monitor de sistema&#41;](../../relational-databases/performance-monitor/monitor-resource-usage-system-monitor.md) </span><span class="sxs-lookup"><span data-stu-id="131ac-215">[Monitor Resource Usage &#40;System Monitor&#41;](../../relational-databases/performance-monitor/monitor-resource-usage-system-monitor.md) </span></span>  
 <span data-ttu-id="131ac-216">[RECONFIGURE &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/reconfigure-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="131ac-216">[RECONFIGURE &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/reconfigure-transact-sql) </span></span>  
 <span data-ttu-id="131ac-217">[Opciones de configuración de servidor &#40;SQL Server&#41;](server-configuration-options-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="131ac-217">[Server Configuration Options &#40;SQL Server&#41;](server-configuration-options-sql-server.md) </span></span>  
 <span data-ttu-id="131ac-218">[sp_configure &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-configure-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="131ac-218">[sp_configure &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-configure-transact-sql) </span></span>  
 [<span data-ttu-id="131ac-219">ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="131ac-219">ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-server-configuration-transact-sql)  
  
  
