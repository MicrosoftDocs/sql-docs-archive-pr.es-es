---
title: Registrar un nombre de entidad de seguridad de servicio para las conexiones con Kerberos | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: configuration
ms.topic: conceptual
helpviewer_keywords:
- connections [SQL Server], SPNs
- network connections [SQL Server], SPNs
- registering SPNs
- Server Principal Names
- SPNs [SQL Server]
ms.assetid: e38d5ce4-e538-4ab9-be67-7046e0d9504e
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: f4db1e8b86fca057acbce29491be9c2be91f0748
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87676172"
---
# <a name="register-a-service-principal-name-for-kerberos-connections"></a><span data-ttu-id="8895d-102">Registrar un nombre de entidad de seguridad de servicio para las conexiones con Kerberos</span><span class="sxs-lookup"><span data-stu-id="8895d-102">Register a Service Principal Name for Kerberos Connections</span></span>
  <span data-ttu-id="8895d-103">El uso de la autenticación Kerberos con [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] requiere que se cumplan las siguientes condiciones:</span><span class="sxs-lookup"><span data-stu-id="8895d-103">To use Kerberos authentication with [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] requires both the following conditions to be true:</span></span>  
  
-   <span data-ttu-id="8895d-104">Los equipos servidor y cliente deben formar parte del mismo dominio de Windows o estar en dominios de confianza.</span><span class="sxs-lookup"><span data-stu-id="8895d-104">The client and server computers must be part of the same Windows domain, or in trusted domains.</span></span>  
  
-   <span data-ttu-id="8895d-105">Se debe registrar un Nombre principal de servicio (SPN) en Active Directory, suponiendo que el rol del Centro de distribución de claves se encuentre en un dominio de Windows.</span><span class="sxs-lookup"><span data-stu-id="8895d-105">A Service Principal Name (SPN) must be registered with Active Directory, which assumes the role of the Key Distribution Center in a Windows domain.</span></span> <span data-ttu-id="8895d-106">El SPN, una vez registrado, se asigna a la cuenta de Windows que inició el servicio de la instancia de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="8895d-106">The SPN, after it is registered, maps to the Windows account that started the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance service.</span></span> <span data-ttu-id="8895d-107">Si el registro del SPN no se ha realizado o ha provocado un error, el nivel de seguridad de Windows no podrá determinar la cuenta asociada al SPN y no se utilizará la autenticación Kerberos.</span><span class="sxs-lookup"><span data-stu-id="8895d-107">If the SPN registration has not been performed or fails, the Windows security layer cannot determine the account associated with the SPN, and Kerberos authentication will not be used.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="8895d-108">Si el servidor no puede registrar automáticamente el SPN, éste se deberá registrar manualmente.</span><span class="sxs-lookup"><span data-stu-id="8895d-108">If the server cannot automatically register the SPN, the SPN must be registered manually.</span></span> <span data-ttu-id="8895d-109">Vea [Registro manual de SPN](#Manual).</span><span class="sxs-lookup"><span data-stu-id="8895d-109">See [Manual SPN Registration](#Manual).</span></span>  
  
 <span data-ttu-id="8895d-110">Puede comprobar que una conexión está utilizando Kerberos consultando la vista de administración dinámica sys.dm_exec_connections.</span><span class="sxs-lookup"><span data-stu-id="8895d-110">You can verify that a connection is using Kerberos by querying the sys.dm_exec_connections dynamic management view.</span></span> <span data-ttu-id="8895d-111">Ejecute la consulta siguiente y compruebe el valor de la columna auth_scheme, que será "KERBEROS" si Kerberos está habilitado.</span><span class="sxs-lookup"><span data-stu-id="8895d-111">Run the following query and check the value of the auth_scheme column, which will be "KERBEROS" if Kerberos is enabled.</span></span>  
  
```  
SELECT auth_scheme FROM sys.dm_exec_connections WHERE session_id = @@spid ;  
```  
  
> [!TIP]  
>  <span data-ttu-id="8895d-112">**[!INCLUDE[msCoName](../../includes/msconame-md.md)] Administrador de configuración de Kerberos para [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]** es una herramienta de diagnóstico que sirve para solucionar problemas de conectividad de Kerberos relacionados con [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8895d-112">**[!INCLUDE[msCoName](../../includes/msconame-md.md)] Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]** is a diagnostic tool that helps troubleshoot Kerberos related connectivity issues with [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="8895d-113">Para obtener más información, vea [Administrador de configuración de Microsoft Kerberos para SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span><span class="sxs-lookup"><span data-stu-id="8895d-113">For more information, see [Microsoft Kerberos Configuration Manager for SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span></span>  
  
##  <a name="the-role-of-the-spn-in-authentication"></a><a name="Role"></a> <span data-ttu-id="8895d-114">El rol del SPN en la autenticación</span><span class="sxs-lookup"><span data-stu-id="8895d-114">The Role of the SPN in Authentication</span></span>  
 <span data-ttu-id="8895d-115">Cuando una aplicación abre una conexión y usa la autenticación de Windows, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client pasa el nombre del equipo de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , el nombre de instancia y, opcionalmente, un SPN.</span><span class="sxs-lookup"><span data-stu-id="8895d-115">When an application opens a connection and uses Windows Authentication, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client passes the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] computer name, instance name and, optionally, an SPN.</span></span> <span data-ttu-id="8895d-116">Si la conexión pasa un SPN, se utilizará sin ningún cambio.</span><span class="sxs-lookup"><span data-stu-id="8895d-116">If the connection passes an SPN it is used without any changes.</span></span>  
  
 <span data-ttu-id="8895d-117">Si la conexión no pasa un SPN, se creará un SPN predeterminado basándose en el protocolo utilizado, el nombre del servidor y el nombre de instancia.</span><span class="sxs-lookup"><span data-stu-id="8895d-117">If the connection does not pass an SPN, a default SPN is constructed based on the protocol used, server name, and the instance name.</span></span>  
  
 <span data-ttu-id="8895d-118">En los escenarios anteriores, el SPN se envía al Centro de distribución de claves con el fin de obtener un token de seguridad para autenticar la conexión.</span><span class="sxs-lookup"><span data-stu-id="8895d-118">In both of the preceding scenarios, the SPN is sent to the Key Distribution Center to obtain a security token for authenticating the connection.</span></span> <span data-ttu-id="8895d-119">Si no se puede obtener un token de seguridad, la autenticación utilizará NTLM.</span><span class="sxs-lookup"><span data-stu-id="8895d-119">If a security token cannot be obtained, authentication uses NTLM.</span></span>  
  
 <span data-ttu-id="8895d-120">Un nombre principal de servicio (SPN) es el nombre por el que un cliente identifica de forma unívoca una instancia de un servicio.</span><span class="sxs-lookup"><span data-stu-id="8895d-120">A service principal name (SPN) is the name by which a client uniquely identifies an instance of a service.</span></span> <span data-ttu-id="8895d-121">El servicio de autenticación de Kerberos puede utilizar un SPN para autenticar un servicio.</span><span class="sxs-lookup"><span data-stu-id="8895d-121">The Kerberos authentication service can use an SPN to authenticate a service.</span></span> <span data-ttu-id="8895d-122">Cuando un cliente desea conectarse a un servicio, busca una instancia del servicio, compone un SPN para esa instancia, se conecta al servicio y presenta el SPN para que lo autentique el servicio.</span><span class="sxs-lookup"><span data-stu-id="8895d-122">When a client wants to connect to a service, it locates an instance of the service, composes an SPN for that instance, connects to the service, and presents the SPN for the service to authenticate.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="8895d-123">La información proporcionada en este tema también se aplica a las configuraciones de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] que utilizan la agrupación en clústeres.</span><span class="sxs-lookup"><span data-stu-id="8895d-123">The information that is provided in this topic also applies to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] configurations that use clustering.</span></span>  
  
 <span data-ttu-id="8895d-124">El método preferido para que los usuarios se autentiquen en SQL Server es la autenticación de Windows.</span><span class="sxs-lookup"><span data-stu-id="8895d-124">Windows Authentication is the preferred method for users to authenticate to SQL Server.</span></span> <span data-ttu-id="8895d-125">Los clientes que usan la autenticación de Windows se autentican mediante NTLM o Kerberos.</span><span class="sxs-lookup"><span data-stu-id="8895d-125">Clients that use Windows Authentication are authenticated by either using NTLM or Kerberos.</span></span> <span data-ttu-id="8895d-126">En un entorno de Active Directory, se intenta utilizar siempre en primer lugar la autenticación Kerberos.</span><span class="sxs-lookup"><span data-stu-id="8895d-126">In an Active Directory environment, Kerberos authentication is always attempted first.</span></span> <span data-ttu-id="8895d-127">La autenticación Kerberos no está disponible para los clientes de [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] mediante canalizaciones con nombre.</span><span class="sxs-lookup"><span data-stu-id="8895d-127">Kerberos authentication is not available for [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] clients using named pipes.</span></span>  
  
##  <a name="permissions"></a><a name="Permissions"></a> <span data-ttu-id="8895d-128">Permisos</span><span class="sxs-lookup"><span data-stu-id="8895d-128">Permissions</span></span>  
 <span data-ttu-id="8895d-129">Al iniciarse el servicio [!INCLUDE[ssDE](../../includes/ssde-md.md)] , se intenta registrar el nombre principal de servicio (SPN).</span><span class="sxs-lookup"><span data-stu-id="8895d-129">When the [!INCLUDE[ssDE](../../includes/ssde-md.md)] service starts, it attempts to register the Service Principal Name (SPN).</span></span> <span data-ttu-id="8895d-130">Si la cuenta con la que se inicia SQL Server no tiene permiso para registrar un SPN en los servicios de dominio de Active Directory, esta llamada producirá un error y se registrará un mensaje de advertencia en el registro de eventos de la aplicación así como en el registro de errores de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="8895d-130">If the account starting SQL Server doesn't have permission to register a SPN in Active Directory Domain Services, this call will fail and a warning message will be logged in the Application event log as well as the SQL Server error log.</span></span> <span data-ttu-id="8895d-131">Para registrar el SPN, se debe ejecutar [!INCLUDE[ssDE](../../includes/ssde-md.md)] en una cuenta integrada, como Sistema local (no se recomienda) o Servicio de red, o bien, en una cuenta que tenga permiso para registrar un SPN, como la de administrador de dominio.</span><span class="sxs-lookup"><span data-stu-id="8895d-131">To register the SPN, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] must be running under a built-in account, such as Local System (not recommended), or NETWORK SERVICE, or an account that has permission to register an SPN, such as a domain administrator account.</span></span> <span data-ttu-id="8895d-132">Cuando [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] se ejecuta en el sistema operativo  [!INCLUDE[win7](../../includes/win7-md.md)] o  [!INCLUDE[winserver2008r2](../../includes/winserver2008r2-md.md)] , se puede ejecutar [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] mediante una cuenta virtual o una cuenta de servicio administrada (MSA).</span><span class="sxs-lookup"><span data-stu-id="8895d-132">When [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is running on the  [!INCLUDE[win7](../../includes/win7-md.md)] or  [!INCLUDE[winserver2008r2](../../includes/winserver2008r2-md.md)] operating system, you can run [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] using a virtual account or a managed service account (MSA).</span></span> <span data-ttu-id="8895d-133">Las cuentas virtuales y las MSA pueden registrar un SPN.</span><span class="sxs-lookup"><span data-stu-id="8895d-133">Both virtual accounts and MSA's can register an SPN.</span></span> <span data-ttu-id="8895d-134">Si [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] no se ejecuta en ninguna de estas cuentas, el SPN no se registrará en el inicio y el administrador de dominio deberá hacerlo manualmente.</span><span class="sxs-lookup"><span data-stu-id="8895d-134">If [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is not running under one of these accounts, the SPN is not registered at startup and the domain administrator must register the SPN manually.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="8895d-135">Cuando el dominio de Windows está configurado para ejecutarse en un nivel menor que el funcional de [!INCLUDE[winserver2008r2](../../includes/winserver2008r2-md.md)] Windows Server 2008 R2, la cuenta de servicio administrada no tendrá los permisos necesarios para registrar los SPN para el servicio [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="8895d-135">When the Windows domain is configured to run at less than the [!INCLUDE[winserver2008r2](../../includes/winserver2008r2-md.md)] Windows Server 2008 R2 functional level, then the Managed Service Account will not have the necessary permissions to register the SPNs for the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] service.</span></span> <span data-ttu-id="8895d-136">Si se requiere la autenticación Kerberos, el administrador de dominio debe registrar manualmente los SPN de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] en la cuenta de servicio administrada.</span><span class="sxs-lookup"><span data-stu-id="8895d-136">If Kerberos authentication is required, the Domain Administrator should manually register the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] SPNs on the Managed Service Account.</span></span>  
  
 <span data-ttu-id="8895d-137">El artículo de Knowledge Base [Cómo usar la autenticación Kerberos en SQL Server](https://support.microsoft.com/kb/319723)contiene información acerca de cómo conceder permisos de lectura o de escritura a un SPN para cuentas distintas de las de administrador de dominio.</span><span class="sxs-lookup"><span data-stu-id="8895d-137">The KB article, [How to use Kerberos authentication in SQL Server](https://support.microsoft.com/kb/319723), contains information about how to grant read or write permission to an SPN for an account that is not a Domain Administrator.</span></span>  
  
 <span data-ttu-id="8895d-138">Encontrará información adicional en [Implementar la delegación restringida de Kerberos con SQL Server 2008](https://technet.microsoft.com/library/ee191523.aspx)</span><span class="sxs-lookup"><span data-stu-id="8895d-138">Additional information is available at [How to Implement Kerberos Constrained Delegation with SQL Server 2008](https://technet.microsoft.com/library/ee191523.aspx)</span></span>  
  
##  <a name="spn-formats"></a><a name="Formats"></a> <span data-ttu-id="8895d-139">Formatos de SPN</span><span class="sxs-lookup"><span data-stu-id="8895d-139">SPN Formats</span></span>  
 <span data-ttu-id="8895d-140">A partir de [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)], el formato de SPN ha cambiado para ser compatible con la autenticación Kerberos en TCP/IP, las canalizaciones con nombre y la memoria compartida.</span><span class="sxs-lookup"><span data-stu-id="8895d-140">Beginning with [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)], the SPN format is changed in order to support Kerberos authentication on TCP/IP, named pipes, and shared memory.</span></span> <span data-ttu-id="8895d-141">Los formatos de SPN admitidos para las instancias predeterminadas y con nombre son los siguientes.</span><span class="sxs-lookup"><span data-stu-id="8895d-141">The supported SPN formats for named and default instances are as follows.</span></span>  
  
 <span data-ttu-id="8895d-142">**Instancia con nombre**</span><span class="sxs-lookup"><span data-stu-id="8895d-142">**Named instance**</span></span>  
  
-   <span data-ttu-id="8895d-143">*MSSQLSvc/FQDN*:[_puerto_**|**_nombreDeInstancia_], donde:</span><span class="sxs-lookup"><span data-stu-id="8895d-143">*MSSQLSvc/FQDN*:[_port_**|**_instancename_], where:</span></span>  
  
    -   <span data-ttu-id="8895d-144">*MSSQLSvc* es el servicio que se va a registrar.</span><span class="sxs-lookup"><span data-stu-id="8895d-144">*MSSQLSvc* is the service that is being registered.</span></span>  
  
    -   <span data-ttu-id="8895d-145">*FQDN* es el nombre de dominio completo del servidor.</span><span class="sxs-lookup"><span data-stu-id="8895d-145">*FQDN* is the fully qualified domain name of the server.</span></span>  
  
    -   <span data-ttu-id="8895d-146">*Port* es el número de puerto TCP.</span><span class="sxs-lookup"><span data-stu-id="8895d-146">*port* is the TCP port number.</span></span>  
  
    -   <span data-ttu-id="8895d-147">*InstanceName* es el nombre de la [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instancia.</span><span class="sxs-lookup"><span data-stu-id="8895d-147">*instancename* is the name of the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance.</span></span>  
  
 <span data-ttu-id="8895d-148">**Instancia predeterminada**</span><span class="sxs-lookup"><span data-stu-id="8895d-148">**Default instance**</span></span>  
  
-   <span data-ttu-id="8895d-149">*MSSQLSvc/FQDN*:_Puerto_ **|** _MSSQLSvc/FQDN_, donde:</span><span class="sxs-lookup"><span data-stu-id="8895d-149">*MSSQLSvc/FQDN*:_port_**|**_MSSQLSvc/FQDN_, where:</span></span>  
  
    -   <span data-ttu-id="8895d-150">*MSSQLSvc* es el servicio que se va a registrar.</span><span class="sxs-lookup"><span data-stu-id="8895d-150">*MSSQLSvc* is the service that is being registered.</span></span>  
  
    -   <span data-ttu-id="8895d-151">*FQDN* es el nombre de dominio completo del servidor.</span><span class="sxs-lookup"><span data-stu-id="8895d-151">*FQDN* is the fully qualified domain name of the server.</span></span>  
  
    -   <span data-ttu-id="8895d-152">*Port* es el número de puerto TCP.</span><span class="sxs-lookup"><span data-stu-id="8895d-152">*port* is the TCP port number.</span></span>  
  
 <span data-ttu-id="8895d-153">El nuevo formato SPN no requiere un número de puerto.</span><span class="sxs-lookup"><span data-stu-id="8895d-153">The new SPN format does not require a port number.</span></span> <span data-ttu-id="8895d-154">Esto significa que un servidor con varios puertos o un protocolo que no use números de puerto puede utilizar la autenticación Kerberos.</span><span class="sxs-lookup"><span data-stu-id="8895d-154">This means that a multiple-port server or a protocol that does not use port numbers can use Kerberos authentication.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="8895d-155">En el caso de una conexión TCP/IP, en la que el puerto TCP está incluido en el SPN, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] debe habilitar el protocolo TCP para que los usuarios puedan conectarse usando la autenticación Kerberos.</span><span class="sxs-lookup"><span data-stu-id="8895d-155">In the case of a TCP/IP connection, where the TCP port is included in the SPN, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] must enable the TCP protocol for a user to connect by using Kerberos authentication.</span></span>  
  
|||  
|-|-|  
|<span data-ttu-id="8895d-156">MSSQLSvc/*FQDN: Puerto*</span><span class="sxs-lookup"><span data-stu-id="8895d-156">MSSQLSvc/*fqdn:port*</span></span>|<span data-ttu-id="8895d-157">SPN predeterminado generado por el proveedor cuando se usa TCP.</span><span class="sxs-lookup"><span data-stu-id="8895d-157">The provider-generated, default SPN when TCP is used.</span></span> <span data-ttu-id="8895d-158">*puerto* en un número de puerto TCP.</span><span class="sxs-lookup"><span data-stu-id="8895d-158">*port* is a TCP port number.</span></span>|  
|<span data-ttu-id="8895d-159">MSSQLSvc/*FQDN*</span><span class="sxs-lookup"><span data-stu-id="8895d-159">MSSQLSvc/*fqdn*</span></span>|<span data-ttu-id="8895d-160">SPN predeterminado generado por el proveedor para una instancia predeterminada cuando se usa un protocolo distinto de TCP.</span><span class="sxs-lookup"><span data-stu-id="8895d-160">The provider-generated, default SPN for a default instance when a protocol other than TCP is used.</span></span> <span data-ttu-id="8895d-161">*FQDN* es un nombre de dominio completo.</span><span class="sxs-lookup"><span data-stu-id="8895d-161">*fqdn* is a fully-qualified domain name.</span></span>|  
|<span data-ttu-id="8895d-162">MSSQLSvc/*FQDN: nombreDeInstancia*</span><span class="sxs-lookup"><span data-stu-id="8895d-162">MSSQLSvc/*fqdn:InstanceName*</span></span>|<span data-ttu-id="8895d-163">SPN predeterminado generado por el proveedor para una instancia con nombre cuando se usa un protocolo distinto de TCP.</span><span class="sxs-lookup"><span data-stu-id="8895d-163">The provider-generated, default SPN for a named instance when a protocol other than TCP is used.</span></span> <span data-ttu-id="8895d-164">*InstanceName* es el nombre de una instancia de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="8895d-164">*InstanceName* is the name of an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>|  
  
##  <a name="automatic-spn-registration"></a><a name="Auto"></a> <span data-ttu-id="8895d-165">Registro automático de SPN</span><span class="sxs-lookup"><span data-stu-id="8895d-165">Automatic SPN Registration</span></span>  
 <span data-ttu-id="8895d-166">Cuando se inicia una instancia de [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] , [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] intenta registrar el SPN para el servicio [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="8895d-166">When an instance of the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] starts, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] tries to register the SPN for the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] service.</span></span> <span data-ttu-id="8895d-167">Cuando la instancia se detiene, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] intenta anular el registro del SPN.</span><span class="sxs-lookup"><span data-stu-id="8895d-167">When the instance is stopped, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] tries to unregister the SPN.</span></span> <span data-ttu-id="8895d-168">Para una conexión TCP/IP, el SPN se registra con el formato *MSSQLSvc/\<FQDN>* : *\<tcpport>* . Las instancias con nombre y la instancia predeterminada se registran como *MSSQLSvc* y se usa el valor *\<tcpport>* para diferenciar las instancias.</span><span class="sxs-lookup"><span data-stu-id="8895d-168">For a TCP/IP connection the SPN is registered in the format *MSSQLSvc/\<FQDN>*:*\<tcpport>*.Both named instances and the default instance are registered as *MSSQLSvc*, relying on the *\<tcpport>* value to differentiate the instances.</span></span>  
  
 <span data-ttu-id="8895d-169">En el caso de otras conexiones compatibles con Kerberos, el SPN se registra con el formato \*MSSQLSvc/ \<FQDN> \*: *\<instancename>* para una instancia con nombre.</span><span class="sxs-lookup"><span data-stu-id="8895d-169">For other connections that support Kerberos the SPN is registered in the format *MSSQLSvc/\<FQDN>*:*\<instancename>* for a named instance.</span></span> <span data-ttu-id="8895d-170">El formato para registrar la instancia predeterminada es *MSSQLSvc/\<FQDN>* .</span><span class="sxs-lookup"><span data-stu-id="8895d-170">The format for registering the default instance is *MSSQLSvc/\<FQDN>*.</span></span>  
  
 <span data-ttu-id="8895d-171">Es posible que se requiera una intervención manual para registrar o anular el registro del SPN si la cuenta de servicio carece de los permisos requeridos para estas acciones.</span><span class="sxs-lookup"><span data-stu-id="8895d-171">Manual intervention might be required to register or unregister the SPN if the service account lacks the permissions that are required for these actions.</span></span>  
  
##  <a name="manual-spn-registration"></a><a name="Manual"></a> <span data-ttu-id="8895d-172">Registro manual de SPN</span><span class="sxs-lookup"><span data-stu-id="8895d-172">Manual SPN Registration</span></span>  
 <span data-ttu-id="8895d-173">Para registrar el SPN manualmente, el administrador debe usar la herramienta Setspn.exe incluida en las herramientas de soporte técnico de Microsoft [!INCLUDE[winxpsvr](../../includes/winxpsvr-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="8895d-173">To register the SPN manually, the administrator must use the Setspn.exe tool that is provided with the Microsoft [!INCLUDE[winxpsvr](../../includes/winxpsvr-md.md)] Support Tools.</span></span> <span data-ttu-id="8895d-174">Para obtener más información, vea el artículo de Knowledge Base [Herramientas de soporte técnico del Service Pack 1 de Windows Server 2003](https://support.microsoft.com/kb/892777) .</span><span class="sxs-lookup"><span data-stu-id="8895d-174">For more information, see the [Windows Server 2003 Service Pack 1 Support Tools](https://support.microsoft.com/kb/892777) KB article.</span></span>  
  
 <span data-ttu-id="8895d-175">Setspn.exe es una herramienta de línea de comandos que le permite leer, modificar y eliminar la propiedad de directorio Nombres de la entidad de seguridad del servicio (SPN).</span><span class="sxs-lookup"><span data-stu-id="8895d-175">Setspn.exe is a command line tool that enables you to read, modify, and delete the Service Principal Names (SPN) directory property.</span></span> <span data-ttu-id="8895d-176">Esta herramienta también le permite ver los SPN actuales, restablecer los SPN predeterminados de la cuenta y agregar o eliminar los SPN complementarios.</span><span class="sxs-lookup"><span data-stu-id="8895d-176">This tool also enables you to view the current SPNs, reset the account's default SPNs, and add or delete supplemental SPNs.</span></span>  
  
 <span data-ttu-id="8895d-177">El ejemplo siguiente muestra la sintaxis usada para registrar manualmente un SPN para una conexión TCP/IP.</span><span class="sxs-lookup"><span data-stu-id="8895d-177">The following example illustrates the syntax used to register manually register an SPN for a TCP/IP connection.</span></span>  
  
```  
setspn -A MSSQLSvc/myhost.redmond.microsoft.com:1433 accountname  
```  
  
 <span data-ttu-id="8895d-178">**Nota** : Si un SPN ya existe, se debe eliminar antes de que se pueda volver a registrar.</span><span class="sxs-lookup"><span data-stu-id="8895d-178">**Note** If an SPN already exists, it must be deleted before it can be reregistered.</span></span> <span data-ttu-id="8895d-179">Para ello, use el comando `setspn` junto con el modificador `-D` .</span><span class="sxs-lookup"><span data-stu-id="8895d-179">You do this by using the `setspn` command together with the `-D` switch.</span></span> <span data-ttu-id="8895d-180">Los ejemplos siguientes muestran cómo registrar manualmente un nuevo SPN basado en instancias.</span><span class="sxs-lookup"><span data-stu-id="8895d-180">The following examples illustrate how to manually register a new instance-based SPN.</span></span> <span data-ttu-id="8895d-181">Para una instancia predeterminada, use:</span><span class="sxs-lookup"><span data-stu-id="8895d-181">For a default instance, use:</span></span>  
  
```  
setspn -A MSSQLSvc/myhost.redmond.microsoft.com accountname  
```  
  
 <span data-ttu-id="8895d-182">Para una instancia con nombre, use:</span><span class="sxs-lookup"><span data-stu-id="8895d-182">For a named instance, use:</span></span>  
  
```  
setspn -A MSSQLSvc/myhost.redmond.microsoft.com:instancename accountname  
```  
  
##  <a name="client-connections"></a><a name="Client"></a> <span data-ttu-id="8895d-183">Conexiones de cliente</span><span class="sxs-lookup"><span data-stu-id="8895d-183">Client Connections</span></span>  
 <span data-ttu-id="8895d-184">Los SPN especificados por el usuario son compatibles con los controladores de cliente.</span><span class="sxs-lookup"><span data-stu-id="8895d-184">User-specified SPNs are supported in client drivers.</span></span> <span data-ttu-id="8895d-185">Sin embargo, si no se proporciona un SPN, se generará automáticamente basándose en el tipo de conexión de cliente.</span><span class="sxs-lookup"><span data-stu-id="8895d-185">However, if an SPN is not provided, it will be generated automatically based on the type of a client connection.</span></span> <span data-ttu-id="8895d-186">Para una conexión TCP, se usa un SPN con el formato *MSSQLSvc*/*FQDN*:[*puerto*] tanto para las instancias predeterminadas como para las instancias con nombre.</span><span class="sxs-lookup"><span data-stu-id="8895d-186">For a TCP connection, an SPN in the format *MSSQLSvc*/*FQDN*:[*port*] is used for both the named and default instances.</span></span>  
  
 <span data-ttu-id="8895d-187">En el caso de las conexiones de canalización con nombre y de memoria compartida, se usa un SPN con el formato *MSSQLSvc* / *FQDN*:*InstanceName* para una instancia con nombre y *MSSQLSvc* / se utiliza el*FQDN* de MSSQLSvc para la instancia predeterminada.</span><span class="sxs-lookup"><span data-stu-id="8895d-187">For named pipes and shared memory connections, an SPN in the format *MSSQLSvc*/*FQDN*:*instancename* is used for a named instance and *MSSQLSvc*/*FQDN* is used for the default instance.</span></span>  
  
 <span data-ttu-id="8895d-188">**Usar una cuenta de servicio como un SPN**</span><span class="sxs-lookup"><span data-stu-id="8895d-188">**Using a service account as an SPN**</span></span>  
  
 <span data-ttu-id="8895d-189">Las cuentas de servicio se pueden usar como un SPN.</span><span class="sxs-lookup"><span data-stu-id="8895d-189">Service accounts can be used as an SPN.</span></span> <span data-ttu-id="8895d-190">Se especifican mediante el atributo de conexión para la autenticación Kerberos y pueden tener los formatos siguientes:</span><span class="sxs-lookup"><span data-stu-id="8895d-190">They are specified through the connection attribute for the Kerberos authentication and take the following formats:</span></span>  
  
-   <span data-ttu-id="8895d-191">**username@domain**o **dominio\nombre** de usuario para una cuenta de usuario de dominio</span><span class="sxs-lookup"><span data-stu-id="8895d-191">**username@domain** or **domain\username** for a domain user account</span></span>  
  
-   <span data-ttu-id="8895d-192">**equipo$@domain** o **host\FQDN** de una cuenta de dominio de equipo, como Sistema local o NETWORK SERVICES.</span><span class="sxs-lookup"><span data-stu-id="8895d-192">**machine$@domain** or **host\FQDN** for a computer domain account such as Local System or NETWORK SERVICES.</span></span>  
  
 <span data-ttu-id="8895d-193">Para determinar el método de autenticación de una conexión, ejecute la consulta siguiente.</span><span class="sxs-lookup"><span data-stu-id="8895d-193">To determine the authentication method of a connection, execute the following query.</span></span>  
  
```sql  
SELECT net_transport, auth_scheme   
FROM sys.dm_exec_connections   
WHERE session_id = @@SPID;  
```  
  
##  <a name="authentication-defaults"></a><a name="Defaults"></a> <span data-ttu-id="8895d-194">Valores predeterminados de autenticación</span><span class="sxs-lookup"><span data-stu-id="8895d-194">Authentication Defaults</span></span>  
 <span data-ttu-id="8895d-195">En la tabla siguiente se describen los valores predeterminados de autenticación que se usan basándose en los escenarios de registro de SPN.</span><span class="sxs-lookup"><span data-stu-id="8895d-195">The following table describes the authentication defaults that are used based on SPN registration scenarios.</span></span>  
  
|<span data-ttu-id="8895d-196">Escenario</span><span class="sxs-lookup"><span data-stu-id="8895d-196">Scenario</span></span>|<span data-ttu-id="8895d-197">Método de autenticación</span><span class="sxs-lookup"><span data-stu-id="8895d-197">Authentication method</span></span>|  
|--------------|---------------------------|  
|<span data-ttu-id="8895d-198">El SPN se asigna a la cuenta de dominio, cuenta virtual, MSA o cuenta integrada correcta.</span><span class="sxs-lookup"><span data-stu-id="8895d-198">The SPN maps to the correct domain account, virtual account, MSA, or built-in account.</span></span> <span data-ttu-id="8895d-199">Por ejemplo, Sistema local o Servicio de red.</span><span class="sxs-lookup"><span data-stu-id="8895d-199">For example, Local System or NETWORK SERVICE.</span></span><br /><br /> <span data-ttu-id="8895d-200">Nota: correcto significa que la cuenta asignada por el SPN registrado es la cuenta en la que se está ejecutando el servicio de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="8895d-200">Note: Correct means that the account mapped by the registered SPN is the account that the SQL Server service is running under.</span></span>|<span data-ttu-id="8895d-201">Las conexiones locales usan NTLM, mientras que las conexiones remotas usan Kerberos.</span><span class="sxs-lookup"><span data-stu-id="8895d-201">Local connections use NTLM, remote connections use Kerberos.</span></span>|  
|<span data-ttu-id="8895d-202">El SPN es la cuenta de dominio, cuenta virtual, MSA o cuenta integrada correcta.</span><span class="sxs-lookup"><span data-stu-id="8895d-202">The SPN is the correct domain account, virtual account, MSA, or built-in account.</span></span><br /><br /> <span data-ttu-id="8895d-203">Nota: correcto significa que la cuenta asignada por el SPN registrado es la cuenta en la que se está ejecutando el servicio de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="8895d-203">Note: Correct means that the account mapped by the registered SPN is the account that the SQL Server service is running under.</span></span>|<span data-ttu-id="8895d-204">Las conexiones locales usan NTLM, mientras que las conexiones remotas usan Kerberos.</span><span class="sxs-lookup"><span data-stu-id="8895d-204">Local connections use NTLM, remote connections use Kerberos.</span></span>|  
|<span data-ttu-id="8895d-205">El SPN se asigna a una cuenta de dominio, cuenta virtual, MSA o cuenta integrada incorrecta.</span><span class="sxs-lookup"><span data-stu-id="8895d-205">The SPN maps to an incorrect domain account, virtual account, MSA, or built-in account</span></span>|<span data-ttu-id="8895d-206">Se produce un error en la autenticación.</span><span class="sxs-lookup"><span data-stu-id="8895d-206">Authentication fails.</span></span>|  
|<span data-ttu-id="8895d-207">Se produce un error en la búsqueda de SPN o no se asigna a una cuenta de dominio, cuenta virtual, MSA o cuenta integrada correcta, o no es una cuenta de dominio, cuenta virtual MSA o cuenta integrada correcta.</span><span class="sxs-lookup"><span data-stu-id="8895d-207">The SPN lookup fails or does not map to a correct domain account, virtual account, MSA, or built-in account, or is not a correct domain account, virtual account, MSA, or built-in account.</span></span>|<span data-ttu-id="8895d-208">Tanto las conexiones locales como las remotas usan NTLM.</span><span class="sxs-lookup"><span data-stu-id="8895d-208">Local and remote connections use NTLM.</span></span>|  
  
##  <a name="comments"></a><a name="Comments"></a> <span data-ttu-id="8895d-209">Comentarios</span><span class="sxs-lookup"><span data-stu-id="8895d-209">Comments</span></span>  
 <span data-ttu-id="8895d-210">La conexión de administrador dedicada (DAC) usa un SPN basado en el nombre de instancia.</span><span class="sxs-lookup"><span data-stu-id="8895d-210">The Dedicated Administrator Connection (DAC) uses an instance name based SPN.</span></span> <span data-ttu-id="8895d-211">Se puede usar la autenticación Kerberos con una DAC si se ha registrado correctamente ese SPN.</span><span class="sxs-lookup"><span data-stu-id="8895d-211">Kerberos authentication can be used with a DAC if that SPN is registered successfully.</span></span> <span data-ttu-id="8895d-212">Como alternativa, el usuario puede especificar el nombre de cuenta como un SPN.</span><span class="sxs-lookup"><span data-stu-id="8895d-212">As an alternative a user can specify the account name as an SPN.</span></span>  
  
 <span data-ttu-id="8895d-213">Si no se puede registrar el SPN durante el inicio, se indica el problema en el registro de errores de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] y el inicio continúa.</span><span class="sxs-lookup"><span data-stu-id="8895d-213">If SPN registration fails during startup, this failure is recorded in the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log, and startup continues.</span></span>  
  
 <span data-ttu-id="8895d-214">Si no se puede anular el registro del SPN durante el cierre, se indica el problema en el registro de errores de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] y el cierre continúa.</span><span class="sxs-lookup"><span data-stu-id="8895d-214">If SPN de-registration fails during shutdown, this failure is recorded in the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log, and shutdown continues.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="8895d-215">Consulte también</span><span class="sxs-lookup"><span data-stu-id="8895d-215">See Also</span></span>  
 <span data-ttu-id="8895d-216">[Compatibilidad con Nombre de entidad de seguridad de servicio &#40;SPN&#41; en conexiones cliente](../../relational-databases/native-client/features/service-principal-name-spn-support-in-client-connections.md) </span><span class="sxs-lookup"><span data-stu-id="8895d-216">[Service Principal Name &#40;SPN&#41; Support in Client Connections](../../relational-databases/native-client/features/service-principal-name-spn-support-in-client-connections.md) </span></span>  
 <span data-ttu-id="8895d-217">[Nombres de entidad de seguridad de servicio &#40;SPNs&#41; en conexiones cliente &#40;OLE DB&#41;](../../relational-databases/native-client/ole-db/service-principal-names-spns-in-client-connections-ole-db.md) </span><span class="sxs-lookup"><span data-stu-id="8895d-217">[Service Principal Names &#40;SPNs&#41; in Client Connections &#40;OLE DB&#41;](../../relational-databases/native-client/ole-db/service-principal-names-spns-in-client-connections-ole-db.md) </span></span>  
 <span data-ttu-id="8895d-218">[Nombres de entidad de seguridad de servicio &#40;SPNs&#41; en conexiones cliente &#40;ODBC&#41;](../../relational-databases/native-client/odbc/service-principal-names-spns-in-client-connections-odbc.md) </span><span class="sxs-lookup"><span data-stu-id="8895d-218">[Service Principal Names &#40;SPNs&#41; in Client Connections &#40;ODBC&#41;](../../relational-databases/native-client/odbc/service-principal-names-spns-in-client-connections-odbc.md) </span></span>  
 <span data-ttu-id="8895d-219">[Características de SQL Server Native Client](../../relational-databases/native-client/features/sql-server-native-client-features.md) </span><span class="sxs-lookup"><span data-stu-id="8895d-219">[SQL Server Native Client Features](../../relational-databases/native-client/features/sql-server-native-client-features.md) </span></span>  
 [<span data-ttu-id="8895d-220">Administrar problemas de autenticación Kerberos en un entorno de Reporting Services</span><span class="sxs-lookup"><span data-stu-id="8895d-220">Manage Kerberos Authentication Issues in a Reporting Services Environment</span></span>](https://technet.microsoft.com/library/ff679930.aspx)  
  
  
