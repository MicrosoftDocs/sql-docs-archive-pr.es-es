---
title: Testigo de creación de reflejo de la base de datos | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- witness [SQL Server], about witness
- witness [SQL Server]
- database mirroring [SQL Server], witness
ms.assetid: 05606de8-90c3-451a-938d-1ed34211dad7
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 6ac02e2a5dbe86af72c15c07e14de70b12892b48
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87663675"
---
# <a name="database-mirroring-witness"></a><span data-ttu-id="132d0-102">Database Mirroring Witness</span><span class="sxs-lookup"><span data-stu-id="132d0-102">Database Mirroring Witness</span></span>
  <span data-ttu-id="132d0-103">Para admitir la conmutación automática por error, una sesión de creación de reflejo de la base de datos debe configurarse en modo de alta seguridad y tener una tercera instancia del servidor, denominada *testigo*.</span><span class="sxs-lookup"><span data-stu-id="132d0-103">To support automatic failover, a database mirroring session must be configured in high-safety mode and also possess a third server instance, known as the *witness*.</span></span> <span data-ttu-id="132d0-104">El testigo es una instancia opcional de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] que habilita al servidor reflejado en una sesión en modo de alta seguridad para que reconozca si se debe iniciar una conmutación automática por error.</span><span class="sxs-lookup"><span data-stu-id="132d0-104">The witness is an optional instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that enables the mirror server in a high-safety mode session to recognize whether to initiate an automatic failover.</span></span> <span data-ttu-id="132d0-105">A diferencia de los dos asociados, el testigo no sirve a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="132d0-105">Unlike the two partners, the witness does not serve the database.</span></span> <span data-ttu-id="132d0-106">El único rol del testigo es hacer posible la conmutación automática por error.</span><span class="sxs-lookup"><span data-stu-id="132d0-106">Supporting automatic failover is the only role of the witness.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="132d0-107">En el modo de alto rendimiento, el testigo puede afectar negativamente a la disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="132d0-107">In high-performance mode, the witness can adversely affect availability.</span></span> <span data-ttu-id="132d0-108">Si se configura un testigo para una sesión de creación de reflejo de la base de datos, el servidor principal debe conectarse al menos a otra de las instancias de servidor, el servidor reflejado o el testigo, o bien a ambos.</span><span class="sxs-lookup"><span data-stu-id="132d0-108">If a witness is configured for a database mirroring session, the principal server must be connected at least to one of the other server instances, the mirror server or the witness, or both of them.</span></span> <span data-ttu-id="132d0-109">De lo contrario, la base de datos no estará disponible y no se podrá forzar el servicio (con posible pérdida de datos).</span><span class="sxs-lookup"><span data-stu-id="132d0-109">Otherwise, the database becomes unavailable and forcing service (with possible data loss) is impossible.</span></span> <span data-ttu-id="132d0-110">Por lo tanto, para el modo de alto rendimiento, se recomienda mantener el testigo establecido siempre en OFF.</span><span class="sxs-lookup"><span data-stu-id="132d0-110">Therefore, for high-performance mode, we strongly recommend that you always keep the witness set to OFF.</span></span> <span data-ttu-id="132d0-111">Para información sobre las repercusiones de un testigo en el modo de alto rendimiento, vea [Modos de funcionamiento de la creación de reflejo de la base de datos](database-mirroring-operating-modes.md).</span><span class="sxs-lookup"><span data-stu-id="132d0-111">For information about the impact of a witness on high-performance mode, see [Database Mirroring Operating Modes](database-mirroring-operating-modes.md).</span></span>  
  
 <span data-ttu-id="132d0-112">En la siguiente ilustración se muestra una sesión en modo de alta seguridad que incluye un testigo.</span><span class="sxs-lookup"><span data-stu-id="132d0-112">The following illustration shows a high-safety mode session with a witness.</span></span>  
  
 <span data-ttu-id="132d0-113">![Sesión de creación de reflejo con un testigo](../media/dbm-3-way-session-intro.gif "Sesión de creación de reflejo con un testigo")</span><span class="sxs-lookup"><span data-stu-id="132d0-113">![Mirroring session with a witness](../media/dbm-3-way-session-intro.gif "Mirroring session with a witness")</span></span>  
  
 <span data-ttu-id="132d0-114">**En este tema:**</span><span class="sxs-lookup"><span data-stu-id="132d0-114">**In This Topic:**</span></span>  
  
-   [<span data-ttu-id="132d0-115">Usar un testigo en varias sesiones</span><span class="sxs-lookup"><span data-stu-id="132d0-115">Using a Witness in Multiple Sessions</span></span>](#InMultipleSessions)  
  
-   [<span data-ttu-id="132d0-116">Recomendaciones de software y hardware</span><span class="sxs-lookup"><span data-stu-id="132d0-116">Software and Hardware Recommendations</span></span>](#SwHwRecommendations)  
  
-   [<span data-ttu-id="132d0-117">Rol del testigo en la conmutación automática por error</span><span class="sxs-lookup"><span data-stu-id="132d0-117">Role of the Witness in Automatic Failover</span></span>](#InAutoFo)  
  
-   [<span data-ttu-id="132d0-118">Para agregar o quitar un testigo</span><span class="sxs-lookup"><span data-stu-id="132d0-118">To Add or Remove a Witness</span></span>](#AddRemoveWitness)  
  
##  <a name="using-a-witness-in-multiple-sessions"></a><a name="InMultipleSessions"></a> <span data-ttu-id="132d0-119">Usar un testigo en varias sesiones</span><span class="sxs-lookup"><span data-stu-id="132d0-119">Using a Witness in Multiple Sessions</span></span>  
 <span data-ttu-id="132d0-120">Una instancia de servidor específica puede actuar como testigo en sesiones de creación de reflejo de la base de datos simultáneas, cada una de ellas para una base de datos distinta.</span><span class="sxs-lookup"><span data-stu-id="132d0-120">A specific server instance can act as a witness in concurrent database mirroring sessions, each for a different database.</span></span> <span data-ttu-id="132d0-121">Sesiones diferentes pueden tener asociados diferentes.</span><span class="sxs-lookup"><span data-stu-id="132d0-121">Different sessions can be with different partners.</span></span> <span data-ttu-id="132d0-122">En la siguiente ilustración se muestra una instancia de servidor que actúa como testigo de dos sesiones de creación de reflejo de la base de datos con asociados diferentes.</span><span class="sxs-lookup"><span data-stu-id="132d0-122">The following illustration shows a server instance that is a witness in two database mirroring sessions with different partners.</span></span>  
  
 <span data-ttu-id="132d0-123">![Instancia de servidor que es testigo de dos bases de datos](../media/dbm-witness-in-2-sessions.gif "Instancia de servidor que es testigo de dos bases de datos")</span><span class="sxs-lookup"><span data-stu-id="132d0-123">![Server instance that is a witness for 2 databases](../media/dbm-witness-in-2-sessions.gif "Server instance that is a witness for 2 databases")</span></span>  
  
 <span data-ttu-id="132d0-124">Una sola instancia de servidor también puede funcionar simultáneamente como testigo en unas sesiones y como asociado en otras.</span><span class="sxs-lookup"><span data-stu-id="132d0-124">A single-server instance can also function at the same time as a witness in some sessions and a partner in other sessions.</span></span> <span data-ttu-id="132d0-125">Sin embargo, en la práctica, las instancias de servidor suelen funcionar o como testigo o como asociado.</span><span class="sxs-lookup"><span data-stu-id="132d0-125">However, in practice, a server instance typically functions as either a witness or a partner.</span></span> <span data-ttu-id="132d0-126">Esto se debe a que los asociados requieren equipos complejos que tienen hardware suficiente para admitir una base de datos de producción, mientras que los testigos se pueden ejecutar en cualquier sistema de Windows disponible que admita [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="132d0-126">This is because the partners require sophisticated computers that have enough hardware to support a production database, whereas the witness can run on any available Windows system that supports [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span>  
  
##  <a name="software-and-hardware-recommendations"></a><a name="SwHwRecommendations"></a> <span data-ttu-id="132d0-127">Recomendaciones de software y hardware</span><span class="sxs-lookup"><span data-stu-id="132d0-127">Software and Hardware Recommendations</span></span>  
 <span data-ttu-id="132d0-128">Es muy recomendable que el testigo se encuentre en un equipo diferente de los asociados.</span><span class="sxs-lookup"><span data-stu-id="132d0-128">We strongly recommend that the witness reside on a separate computer from the partners.</span></span> <span data-ttu-id="132d0-129">Los asociados de creación de reflejo de la base de datos solo se admiten en la edición [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard y [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise.</span><span class="sxs-lookup"><span data-stu-id="132d0-129">Database mirroring partners are supported only by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard edition and by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise edition.</span></span> <span data-ttu-id="132d0-130">Por el contrario, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Workgroup y [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Express también admiten los testigos.</span><span class="sxs-lookup"><span data-stu-id="132d0-130">Witnesses, in contrast, are also supported by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Workgroup and by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Express.</span></span> <span data-ttu-id="132d0-131">Excepto durante una actualización de una versión anterior de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], todas las instancias de servidor de una sesión de creación de reflejo deben ejecutar la misma versión de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="132d0-131">Except during an upgrade from an earlier version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], the server instances in a mirroring session must all be running the same version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="132d0-132">Por ejemplo, se admite un testigo de [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] al actualizar desde una configuración de creación de reflejo de [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] pero no se puede agregar a una configuración de creación de reflejo existente o nueva de [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)] o posterior.</span><span class="sxs-lookup"><span data-stu-id="132d0-132">For example, a [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] witness is supported when you are upgrading from a [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] mirroring configuration but cannot be added to an existing or new [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)] or later mirroring configuration.</span></span>  
  
 <span data-ttu-id="132d0-133">Un testigo puede ejecutarse en cualquier sistema informático confiable que admita cualquiera de estas ediciones de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="132d0-133">A witness can run on any reliable computer system that supports any of these editions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="132d0-134">No obstante, se recomienda que cualquier instancia del servidor que se utilice como testigo cumpla con los requisitos mínimos de configuración necesarios para la versión Standard de la versión de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] que esté usando.</span><span class="sxs-lookup"><span data-stu-id="132d0-134">However, we recommend that every server instance that is used as a witness correspond to the minimum configuration that is required for the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard version that you are running.</span></span> <span data-ttu-id="132d0-135">Para obtener más información acerca de estos requisitos, consulte [Hardware and software Requirements for installing SQL Server 2014](../../sql-server/install/hardware-and-software-requirements-for-installing-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="132d0-135">For more information about these requirements, see [Hardware and Software Requirements for Installing SQL Server 2014](../../sql-server/install/hardware-and-software-requirements-for-installing-sql-server.md).</span></span>  
  
##  <a name="role-of-the-witness-in-automatic-failover"></a><a name="InAutoFo"></a> <span data-ttu-id="132d0-136">Rol del testigo en la conmutación automática por error</span><span class="sxs-lookup"><span data-stu-id="132d0-136">Role of the Witness in Automatic Failover</span></span>  
 <span data-ttu-id="132d0-137">Durante la sesión de creación de reflejo de una base de datos, todas las instancias de servidor supervisan su estado de conexión.</span><span class="sxs-lookup"><span data-stu-id="132d0-137">Throughout a database mirroring session, all the server instances monitor their connection status.</span></span> <span data-ttu-id="132d0-138">Si los asociados quedan desconectados entre sí, dependen del testigo para garantizar que únicamente uno de ellos sirve actualmente a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="132d0-138">If the partners become disconnected from each other, they rely on the witness to make sure that only one of them is currently serving the database.</span></span> <span data-ttu-id="132d0-139">Si un servidor reflejado sincronizado pierde su conexión con el servidor principal pero permanece conectado al testigo, se pondrá en contacto con el testigo para determinar si este último ha perdido la conexión con el servidor principal.</span><span class="sxs-lookup"><span data-stu-id="132d0-139">If a synchronized mirror server loses its connection to the principal server but remains connected to the witness, the mirror server contacts the witness to determine whether the witness has lost its connection to the principal server:</span></span>  
  
-   <span data-ttu-id="132d0-140">Si el servidor principal aún está conectado al testigo, no se produce la conmutación automática por error.</span><span class="sxs-lookup"><span data-stu-id="132d0-140">If the principal server is still connected to the witness, automatic failover does not occur.</span></span> <span data-ttu-id="132d0-141">Por el contrario, el servidor principal continúa sirviendo a la base de datos y, al mismo tiempo, acumula entradas del registro para enviarlas al servidor reflejado cuando los asociados vuelvan a conectarse.</span><span class="sxs-lookup"><span data-stu-id="132d0-141">Instead, the principal server continues to server the database while accumulating log records to send the mirror server when the partners reconnect.</span></span>  
  
-   <span data-ttu-id="132d0-142">Si el testigo también está desconectado del servidor principal, el servidor reflejado sabrá que la base de datos principal no está disponible.</span><span class="sxs-lookup"><span data-stu-id="132d0-142">If the witness is also disconnected from the principal server, the mirror server knows that principal database has become unavailable.</span></span> <span data-ttu-id="132d0-143">En este caso, el servidor reflejado inicia de inmediato la conmutación automática por error.</span><span class="sxs-lookup"><span data-stu-id="132d0-143">In this case, the mirror server immediately initiates an automatic failover.</span></span>  
  
-   <span data-ttu-id="132d0-144">Si el servidor reflejado está desconectado del testigo y también del servidor principal, no se puede realizar la conmutación automática por error, independientemente del estado del servidor principal.</span><span class="sxs-lookup"><span data-stu-id="132d0-144">If the mirror server is disconnected from the witness and also from the principal server, automatic failover is not possible, regardless of the state of the principal server.</span></span>  
  
 <span data-ttu-id="132d0-145">El requisito de que al menos dos de las instancias de servidor estén conectadas se denomina *quórum*.</span><span class="sxs-lookup"><span data-stu-id="132d0-145">The requirement that at least two of the server instances be connected is known as *quorum*.</span></span> <span data-ttu-id="132d0-146">El quórum garantiza el servicio de la base de datos únicamente por parte de un asociado cada vez.</span><span class="sxs-lookup"><span data-stu-id="132d0-146">Quorum makes sure that the database can only be served by one partner at a time.</span></span> <span data-ttu-id="132d0-147">Para obtener más información sobre el funcionamiento del cuórum y su repercusión en una sesión, vea [Cuórum: cómo un testigo afecta a la disponibilidad de la base de datos &#40;creación de reflejo de la base de datos&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="132d0-147">For information about how quorum works and its impact on a session, see [Quorum: How a Witness Affects Database Availability &#40;Database Mirroring&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span></span>  
  
##  <a name="to-add-or-remove-a-witness"></a><a name="AddRemoveWitness"></a> <span data-ttu-id="132d0-148">Para agregar o quitar un testigo</span><span class="sxs-lookup"><span data-stu-id="132d0-148">To Add or Remove a Witness</span></span>  
 <span data-ttu-id="132d0-149">**Para agregar un testigo**</span><span class="sxs-lookup"><span data-stu-id="132d0-149">**To add a witness**</span></span>  
  
-   [<span data-ttu-id="132d0-150">Agregar o reemplazar un testigo de creación de reflejo de la base de datos &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="132d0-150">Add or Replace a Database Mirroring Witness &#40;SQL Server Management Studio&#41;</span></span>](../database-mirroring/add-or-replace-a-database-mirroring-witness-sql-server-management-studio.md)  
  
-   [<span data-ttu-id="132d0-151">Agregar un testigo de creación de reflejo de la base de datos mediante la autenticación de Windows &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="132d0-151">Add a Database Mirroring Witness Using Windows Authentication &#40;Transact-SQL&#41;</span></span>](add-a-database-mirroring-witness-using-windows-authentication-transact-sql.md)  
  
 <span data-ttu-id="132d0-152">**Para quitar el testigo**</span><span class="sxs-lookup"><span data-stu-id="132d0-152">**To remove the witness**</span></span>  
  
-   [<span data-ttu-id="132d0-153">Quitar el testigo de una sesión de creación de reflejo de la base de datos &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="132d0-153">Remove the Witness from a Database Mirroring Session &#40;SQL Server&#41;</span></span>](remove-the-witness-from-a-database-mirroring-session-sql-server.md)  
  
## <a name="see-also"></a><span data-ttu-id="132d0-154">Consulte también</span><span class="sxs-lookup"><span data-stu-id="132d0-154">See Also</span></span>  
 <span data-ttu-id="132d0-155">[Conmutación de roles durante una sesión de creación de reflejo de la base de datos &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="132d0-155">[Role Switching During a Database Mirroring Session &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md) </span></span>  
 <span data-ttu-id="132d0-156">[Modos de funcionamiento de la creación de reflejo de la base de datos](database-mirroring-operating-modes.md) </span><span class="sxs-lookup"><span data-stu-id="132d0-156">[Database Mirroring Operating Modes](database-mirroring-operating-modes.md) </span></span>  
 <span data-ttu-id="132d0-157">[Cuórum: cómo un testigo afecta a la disponibilidad de la base de datos &#40;reflejo de base de datos&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md) </span><span class="sxs-lookup"><span data-stu-id="132d0-157">[Quorum: How a Witness Affects Database Availability &#40;Database Mirroring&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md) </span></span>  
 <span data-ttu-id="132d0-158">[Posibles errores durante la creación de reflejo de la base de datos](possible-failures-during-database-mirroring.md) </span><span class="sxs-lookup"><span data-stu-id="132d0-158">[Possible Failures During Database Mirroring](possible-failures-during-database-mirroring.md) </span></span>  
 [<span data-ttu-id="132d0-159">Estados de creación de reflejo &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="132d0-159">Mirroring States &#40;SQL Server&#41;</span></span>](mirroring-states-sql-server.md)  
  
  
