---
title: Replicación y creación de reflejo de la base de datos (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- database mirroring [SQL Server], interoperability
- replication [SQL Server], database mirroring and
ms.assetid: 82796217-02e2-4bc5-9ab5-218bae11a2d6
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: b126aeb8ccd24932706b8798ebfe7088308918e2
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87748252"
---
# <a name="database-mirroring-and-replication-sql-server"></a><span data-ttu-id="fd3b4-102">Replicación y creación de reflejo de la base de datos (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="fd3b4-102">Database Mirroring and Replication (SQL Server)</span></span>
  <span data-ttu-id="fd3b4-103">La creación de reflejo de la base de datos se puede usar conjuntamente con la replicación para mejorar la disponibilidad para la base de datos de publicación.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-103">Database mirroring can be used in conjunction with replication to improve availability for the publication database.</span></span> <span data-ttu-id="fd3b4-104">La creación de reflejo de la base de datos incluye la creación de dos copias de una sola base de datos que suelen residir en diferentes equipos.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-104">Database mirroring involves two copies of a single database that typically reside on different computers.</span></span> <span data-ttu-id="fd3b4-105">En cada momento, solo una copia de la base de datos está disponible para los clientes.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-105">At any given time, only one copy of the database is currently available to clients.</span></span> <span data-ttu-id="fd3b4-106">Esta copia se conoce como la base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-106">This copy is known as the principal database.</span></span> <span data-ttu-id="fd3b4-107">Las actualizaciones realizadas por los clientes en la base de datos de la entidad de seguridad se aplican a la otra copia de la base de datos, conocida como la base de datos reflejada.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-107">Updates made by clients to the principal database are applied on the other copy of the database, known as the mirror database.</span></span> <span data-ttu-id="fd3b4-108">La creación de reflejo incluye la aplicación a la base de datos reflejada del registro de transacciones con todas las inserciones, actualizaciones o eliminaciones efectuadas en la base de datos de la entidad de seguridad.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-108">Mirroring involves applying the transaction log from every insertion, update, or deletion made on the principal database onto the mirror database.</span></span>  
  
 <span data-ttu-id="fd3b4-109">La conmutación por error de replicación en un reflejo se admite totalmente para las bases de datos de publicación, con compatibilidad limitada con las bases de datos de suscripciones.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-109">Replication failover to a mirror is fully supported for publication databases, with limited support for subscription databases.</span></span> <span data-ttu-id="fd3b4-110">La creación de reflejo de la base de datos no se admite para la base de datos de distribución.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-110">Database mirroring is not supported for the distribution database.</span></span> <span data-ttu-id="fd3b4-111">Para obtener información sobre la recuperación de una base de datos de distribución o una base de datos de suscripciones sin necesidad de volver configurar la replicación, vea [Back Up and Restore Replicated Databases (Realizar copias de seguridad y restaurar bases de datos replicadas)](../../relational-databases/replication/administration/back-up-and-restore-replicated-databases.md).</span><span class="sxs-lookup"><span data-stu-id="fd3b4-111">For information about recovering a distribution database or subscription database without any need to reconfigure replication, see [Back Up and Restore Replicated Databases](../../relational-databases/replication/administration/back-up-and-restore-replicated-databases.md).</span></span> <span data-ttu-id="fd3b4-112">Para obtener información sobre la creación de reflejo de la base de datos de suscriptor, vea</span><span class="sxs-lookup"><span data-stu-id="fd3b4-112">For information about mirroring the subscriber database, see the</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="fd3b4-113">Después de una conmutación por error, la entidad reflejada se convierte en la entidad de seguridad.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-113">After a failover, the mirror becomes the principal.</span></span> <span data-ttu-id="fd3b4-114">En este tema, los términos "entidad de seguridad" y "reflejada" siempre hacen referencia a las entidades de seguridad y reflejada originales.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-114">In this topic, "principal" and "mirror" always refer to the original principal and mirror.</span></span>  
  
## <a name="requirements-and-considerations-for-using-replication-with-database-mirroring"></a><span data-ttu-id="fd3b4-115">Requisitos y consideraciones para el uso de la replicación con la creación de reflejo de la base de datos</span><span class="sxs-lookup"><span data-stu-id="fd3b4-115">Requirements and Considerations for Using Replication with Database Mirroring</span></span>  
 <span data-ttu-id="fd3b4-116">Se deben tener en cuenta los siguientes requisitos y consideraciones al utilizar la replicación con la creación de reflejo de la base de datos:</span><span class="sxs-lookup"><span data-stu-id="fd3b4-116">Be aware of the following requirements and considerations when using replication with database mirroring:</span></span>  
  
-   <span data-ttu-id="fd3b4-117">Las entidades de seguridad y reflejada deben compartir un distribuidor.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-117">The principal and mirror must share a Distributor.</span></span> <span data-ttu-id="fd3b4-118">Se recomienda que éste sea un distribuidor remoto, ya que proporciona mayor tolerancia a errores si se produce una conmutación por error imprevista en el publicador.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-118">We recommend that this be a remote Distributor, which provides greater fault tolerance if the Publisher has an unplanned failover.</span></span>  
  
-   <span data-ttu-id="fd3b4-119">La replicación admite la creación de reflejo de la base de datos de publicación en la replicación de mezcla y en la replicación transaccional con suscriptores de solo lectura o suscriptores de actualización en cola.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-119">Replication supports mirroring the publication database for merge replication and for transactional replication with read-only Subscribers or queued updating Subscribers.</span></span> <span data-ttu-id="fd3b4-120">No se admiten suscriptores de actualización inmediata, publicadores de Oracle, publicadores en una topología punto a punto ni republicación.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-120">Immediate updating Subscribers, Oracle Publishers, Publishers in a peer-to-peer topology, and republishing are not supported.</span></span>  
  
-   <span data-ttu-id="fd3b4-121">Los metadatos y los objetos que existen fuera de la base de datos, incluidos inicios de sesión, trabajos, servidores vinculados, etc., no se copian en la entidad reflejada.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-121">Metadata and objects that exist outside the database are not copied to the mirror, including logins, jobs, linked servers, and so on.</span></span> <span data-ttu-id="fd3b4-122">Si se requieren los metadatos y los objetos en la entidad reflejada, se deben copiar manualmente.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-122">If you require the metadata and objects at the mirror, you must copy them manually.</span></span> <span data-ttu-id="fd3b4-123">Para obtener más información, vea [Administración de inicios de sesión y trabajos tras la conmutación de roles &#40;SQL Server&#41;](../../sql-server/failover-clusters/management-of-logins-and-jobs-after-role-switching-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="fd3b4-123">For more information, see [Management of Logins and Jobs After Role Switching &#40;SQL Server&#41;](../../sql-server/failover-clusters/management-of-logins-and-jobs-after-role-switching-sql-server.md).</span></span>  
  
## <a name="configuring-replication-with-database-mirroring"></a><span data-ttu-id="fd3b4-124">Configurar la replicación con la creación de reflejo de la base de datos</span><span class="sxs-lookup"><span data-stu-id="fd3b4-124">Configuring Replication with Database Mirroring</span></span>  
 <span data-ttu-id="fd3b4-125">La configuración de la replicación y la creación de reflejo de la base de datos implica cinco pasos.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-125">Configuring replication and database mirroring involves five steps.</span></span> <span data-ttu-id="fd3b4-126">Cada paso se describe en detalle en la siguiente sección.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-126">Each step is described in more detail in the following section.</span></span>  
  
1.  <span data-ttu-id="fd3b4-127">Configurar el publicador</span><span class="sxs-lookup"><span data-stu-id="fd3b4-127">Configure the Publisher.</span></span>  
  
2.  <span data-ttu-id="fd3b4-128">Configurar la creación de reflejo de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-128">Configure database mirroring.</span></span>  
  
3.  <span data-ttu-id="fd3b4-129">Configurar la entidad reflejada de manera que utilice el mismo distribuidor que la entidad de seguridad</span><span class="sxs-lookup"><span data-stu-id="fd3b4-129">Configure the mirror to use the same Distributor as the principal.</span></span>  
  
4.  <span data-ttu-id="fd3b4-130">Configurar los agentes de replicación para la conmutación por error</span><span class="sxs-lookup"><span data-stu-id="fd3b4-130">Configure replication agents for failover.</span></span>  
  
5.  <span data-ttu-id="fd3b4-131">Agregue las entidades de seguridad y reflejada al Monitor de replicación.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-131">Add the principal and mirror to Replication Monitor.</span></span>  
  
 <span data-ttu-id="fd3b4-132">El orden de los pasos 1 y 2 se puede invertir.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-132">Steps 1 and 2 can also be performed in the opposite order.</span></span>  
  
#### <a name="to-configure-database-mirroring-for-a-publication-database"></a><span data-ttu-id="fd3b4-133">Para configurar la creación de reflejo de la base de datos para una base de datos de publicación</span><span class="sxs-lookup"><span data-stu-id="fd3b4-133">To configure database mirroring for a publication database</span></span>  
  
1.  <span data-ttu-id="fd3b4-134">Configure el publicador:</span><span class="sxs-lookup"><span data-stu-id="fd3b4-134">Configure the Publisher:</span></span>  
  
    1.  <span data-ttu-id="fd3b4-135">Se recomienda el uso de un distribuidor remoto.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-135">We recommend using a remote Distributor.</span></span> <span data-ttu-id="fd3b4-136">Para obtener más información sobre cómo configurar la distribución, vea [Configure Distribution (Configurar la distribución)](../../relational-databases/replication/configure-distribution.md).</span><span class="sxs-lookup"><span data-stu-id="fd3b4-136">For more information about configuring distribution, see [Configure Distribution](../../relational-databases/replication/configure-distribution.md).</span></span>  
  
    2.  <span data-ttu-id="fd3b4-137">Se puede habilitar una base de datos para publicaciones transaccionales y de instantáneas y/o para publicaciones de combinación.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-137">You can enable a database for snapshot and transactional publications and/or merge publications.</span></span> <span data-ttu-id="fd3b4-138">Para las bases de datos reflejadas que incluirán más de un tipo de publicación, se debe habilitar la base de datos para ambos tipos en el mismo nodo mediante [sp_replicationdboption](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="fd3b4-138">For mirrored databases that will contain more than one type of publication, you must enable the database for both types at the same node using [sp_replicationdboption](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql).</span></span> <span data-ttu-id="fd3b4-139">Por ejemplo, puede ejecutar el siguiente procedimiento almacenado en la entidad de seguridad:</span><span class="sxs-lookup"><span data-stu-id="fd3b4-139">For example, you could execute the following stored procedure calls at the principal:</span></span>  
  
        ```  
        exec sp_replicationdboption @dbname='<PublicationDatabase>', @optname='publish', @value=true;  
        exec sp_replicationdboption @dbname='<PublicationDatabase>', @optname='mergepublish', @value=true;  
        ```  
  
         <span data-ttu-id="fd3b4-140">Para obtener más información sobre la creación de publicaciones, vea [Publish Data and Database Objects (Publicar datos y objetos de base de datos)](../../relational-databases/replication/publish/publish-data-and-database-objects.md).</span><span class="sxs-lookup"><span data-stu-id="fd3b4-140">For more information about creating publications, see [Publish Data and Database Objects](../../relational-databases/replication/publish/publish-data-and-database-objects.md).</span></span>  
  
2.  <span data-ttu-id="fd3b4-141">Configurar la creación de reflejo de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-141">Configure database mirroring.</span></span> <span data-ttu-id="fd3b4-142">Para obtener más información, vea [Establecer una sesión de creación de reflejo de la base de datos mediante la autenticación de Windows &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md) y [Configurar la creación de reflejo de la base de datos &#40;SQL Server&#41;](database-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="fd3b4-142">For more information, see [Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md) and [Setting Up Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md).</span></span>  
  
3.  <span data-ttu-id="fd3b4-143">Configurar la distribución para la entidad reflejada.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-143">Configure distribution for the mirror.</span></span> <span data-ttu-id="fd3b4-144">Indique el nombre de la entidad reflejada como el publicador y especifique el mismo distribuidor y la misma carpeta de instantáneas que se utilizan en la entidad de seguridad.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-144">Specify the mirror name as the Publisher, and specify the same Distributor and snapshot folder that the principal uses.</span></span> <span data-ttu-id="fd3b4-145">Por ejemplo, si está configurando la replicación con procedimientos almacenados, ejecute [sp_adddistpublisher](/sql/relational-databases/system-stored-procedures/sp-adddistpublisher-transact-sql) en el distribuidor y, después, ejecute [sp_adddistributor](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql) en la entidad reflejada.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-145">For example, if you are configuring replication with stored procedures, execute [sp_adddistpublisher](/sql/relational-databases/system-stored-procedures/sp-adddistpublisher-transact-sql) at the Distributor; and then execute [sp_adddistributor](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql) at the mirror.</span></span> <span data-ttu-id="fd3b4-146">Para **sp_adddistpublisher**:</span><span class="sxs-lookup"><span data-stu-id="fd3b4-146">For **sp_adddistpublisher**:</span></span>  
  
    -   <span data-ttu-id="fd3b4-147">Establezca el valor del **@publisher** parámetro en el nombre de red del reflejo.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-147">Set the value of the **@publisher** parameter to the network name of the mirror.</span></span>  
  
    -   <span data-ttu-id="fd3b4-148">Establezca el valor del **@working_directory** parámetro en la carpeta de instantáneas usada por la entidad de seguridad.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-148">Set the value of the **@working_directory** parameter to the snapshot folder used by the principal.</span></span>  
  
4.  <span data-ttu-id="fd3b4-149">Especifique el nombre de la entidad reflejada para el parámetro de agente **- PublisherFailoverPartner**.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-149">Specify the mirror name for the **-PublisherFailoverPartner** agent parameter.</span></span> <span data-ttu-id="fd3b4-150">Este parámetro es necesario para que los siguientes agentes identifiquen la entidad reflejada después de una conmutación por error:</span><span class="sxs-lookup"><span data-stu-id="fd3b4-150">Agent This parameter is required for the following agents to identify the mirror after failover:</span></span>  
  
    -   <span data-ttu-id="fd3b4-151">Agente de instantáneas (para todas las publicaciones)</span><span class="sxs-lookup"><span data-stu-id="fd3b4-151">Snapshot Agent (for all publications)</span></span>  
  
    -   <span data-ttu-id="fd3b4-152">Agente de registro del LOG (para todas las publicaciones transaccionales)</span><span class="sxs-lookup"><span data-stu-id="fd3b4-152">Log Reader Agent (for all transactional publications)</span></span>  
  
    -   <span data-ttu-id="fd3b4-153">Agente de lectura de cola (para las publicaciones transaccionales que admiten suscripciones de actualización en cola)</span><span class="sxs-lookup"><span data-stu-id="fd3b4-153">Queue Reader Agent (for transactional publications that support queued updating subscriptions)</span></span>  
  
    -   <span data-ttu-id="fd3b4-154">Agente de mezcla (para suscripciones de mezcla)</span><span class="sxs-lookup"><span data-stu-id="fd3b4-154">Merge Agent (for merge subscriptions)</span></span>  
  
    -   [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="fd3b4-155">Escucha de replicación (replisapi.dll: para suscripciones de mezcla sincronizadas mediante sincronización web)</span><span class="sxs-lookup"><span data-stu-id="fd3b4-155">replication listener (replisapi.dll: for merge subscriptions synchronized using Web synchronization)</span></span>  
  
    -   <span data-ttu-id="fd3b4-156">Control ActiveX de mezcla de SQL (para suscripciones de mezcla sincronizadas con el control)</span><span class="sxs-lookup"><span data-stu-id="fd3b4-156">SQL Merge ActiveX Control (for merge subscriptions synchronized with the control)</span></span>  
  
     <span data-ttu-id="fd3b4-157">El Agente de distribución y el Control ActiveX de distribución de SQL no tienen este parámetro porque no se conectan al publicador.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-157">The Distribution Agent and Distribution ActiveX Control do not have this parameter because they do not connect to the Publisher.</span></span>  
  
     <span data-ttu-id="fd3b4-158">Los cambios en los parámetros del agente tendrán efecto la próxima vez que se inicie el agente.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-158">Agent parameter changes take effect the next time the agent is started.</span></span> <span data-ttu-id="fd3b4-159">Si el agente se ejecuta sin interrupción, debe detenerlo y reiniciarlo.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-159">If the agent runs continuously, you must stop and restart the agent.</span></span> <span data-ttu-id="fd3b4-160">Los parámetros se pueden especificar en perfiles de agente y desde el símbolo del sistema.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-160">Parameters can be specified in agent profiles and from the command prompt.</span></span> <span data-ttu-id="fd3b4-161">Para más información, consulte:</span><span class="sxs-lookup"><span data-stu-id="fd3b4-161">For more information, see:</span></span>  
  
    -   [<span data-ttu-id="fd3b4-162">Ver y modificar parámetros del símbolo del sistema de los agentes de replicación &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="fd3b4-162">View and Modify Replication Agent Command Prompt Parameters &#40;SQL Server Management Studio&#41;</span></span>](../../relational-databases/replication/agents/view-and-modify-replication-agent-command-prompt-parameters.md)  
  
    -   [<span data-ttu-id="fd3b4-163">Conceptos de los ejecutables del Agente de replicación</span><span class="sxs-lookup"><span data-stu-id="fd3b4-163">Replication Agent Executables Concepts</span></span>](../../relational-databases/replication/concepts/replication-agent-executables-concepts.md)  
  
     <span data-ttu-id="fd3b4-164">Se recomienda agregar el parámetro **-PublisherFailoverPartner** a un perfil de agente y, después, especificar el nombre de la entidad reflejada en el perfil.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-164">We recommend adding the **-PublisherFailoverPartner** to an agent profile, and then specifying the mirror name in the profile.</span></span> <span data-ttu-id="fd3b4-165">Por ejemplo, si configura la replicación con procedimientos almacenados:</span><span class="sxs-lookup"><span data-stu-id="fd3b4-165">For example, if you are configuring replication with stored procedures:</span></span>  
  
    ```  
    -- Execute sp_help_agent_profile in the context of the distribution database to get the list of profiles.  
    -- Select the profile id of the profile that needs to be updated from the result set.  
    -- In the agent_type column returned by sp_help_agent_profile:   
    -- 1 = Snapshot Agent; 2 = Log Reader Agent; 3 = Distribution Agent; 4 = Merge Agent; 9 = Queue Reader Agent.  
  
    exec sp_help_agent_profile;  
  
    -- Setting the -PublisherFailoverPartner parameter in the default Snapshot Agent profile (profile 1).  
    -- Execute sp_add_agent_parameter in the context of the distribution database.  
    exec sp_add_agent_parameter @profile_id = 1, @parameter_name = N'-PublisherFailoverPartner', @parameter_value = N'<Failover Partner Name>';  
  
    -- Setting the -PublisherFailoverPartner parameter in the default Merge Agent profile (profile 6).  
    -- Execute sp_add_agent_parameter in the context of the distribution database.  
    exec sp_add_agent_parameter @profile_id = 6, @parameter_name = N'-PublisherFailoverPartner', @parameter_value = N'<Failover Partner Name>';  
    ```  
  
5.  <span data-ttu-id="fd3b4-166">Agregue las entidades de seguridad y reflejada al Monitor de replicación.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-166">Add the principal and mirror to Replication Monitor.</span></span> <span data-ttu-id="fd3b4-167">Para obtener más información, vea [Agregar y quitar publicadores del Monitor de replicación](../../relational-databases/replication/monitor/add-and-remove-publishers-from-replication-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="fd3b4-167">For more information, see [Add and Remove Publishers from Replication Monitor](../../relational-databases/replication/monitor/add-and-remove-publishers-from-replication-monitor.md).</span></span>  
  
## <a name="maintaining-a-mirrored-publication-database"></a><span data-ttu-id="fd3b4-168">Mantener una base de datos de publicación reflejada</span><span class="sxs-lookup"><span data-stu-id="fd3b4-168">Maintaining a Mirrored Publication Database</span></span>  
 <span data-ttu-id="fd3b4-169">El mantenimiento de una base de datos de publicación reflejada se realiza básicamente de la misma forma que para una base de datos no reflejada, con las siguientes salvedades:</span><span class="sxs-lookup"><span data-stu-id="fd3b4-169">Maintaining a mirrored publication database is essentially the same as maintaining a non-mirrored database, with the following considerations:</span></span>  
  
-   <span data-ttu-id="fd3b4-170">La administración y la supervisión deben tener lugar en el servidor activo.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-170">Administration and monitoring must occur at the active server.</span></span> <span data-ttu-id="fd3b4-171">En [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], las publicaciones aparecen debajo de la carpeta **Publicaciones locales** solo para el servidor activo.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-171">In [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], publications appear under the **Local Publications** folder only for the active server.</span></span> <span data-ttu-id="fd3b4-172">Por ejemplo, si produce la conmutación por error a la entidad reflejada, las publicaciones se muestran en la entidad reflejada y dejan de aparecer en la entidad de seguridad.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-172">For example, if you failover to the mirror, the publications are displayed at the mirror and are no longer displayed at the principal.</span></span> <span data-ttu-id="fd3b4-173">Si se produce la conmutación por error de la base de datos a la entidad reflejada, puede que sea necesario actualizar manualmente [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] y el Monitor de replicación para que se refleje el cambio.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-173">If the database fails over to the mirror, you might need to manually refresh [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] and Replication Monitor for the change to be reflected.</span></span>  
  
-   <span data-ttu-id="fd3b4-174">El Monitor de replicación muestra los nodos del publicador en el árbol de objetos de la entidad de seguridad y reflejada.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-174">Replication Monitor displays Publisher nodes in the object tree for both the principal and the mirror.</span></span> <span data-ttu-id="fd3b4-175">Si la entidad de seguridad es el servidor activo, la información de publicación solo se mostrará debajo del nodo de la entidad de seguridad en el Monitor de replicación.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-175">If the principal is the active server, publication information is displayed only under the principal node in Replication Monitor.</span></span>  
  
     <span data-ttu-id="fd3b4-176">Si la entidad reflejada es el servidor activo:</span><span class="sxs-lookup"><span data-stu-id="fd3b4-176">If the mirror is the active server:</span></span>  
  
    -   <span data-ttu-id="fd3b4-177">Si se produce un error en un agente, solo se indicará en el nodo de la entidad de seguridad, no en el nodo de la entidad reflejada.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-177">If an agent has an error, the error is indicated only on the principal node, not on the mirror node.</span></span>  
  
    -   <span data-ttu-id="fd3b4-178">Si la entidad de seguridad no está disponible, los nodos de la entidad de seguridad y reflejada muestran listas de publicaciones idénticas.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-178">If the principal is unavailable, the principal and mirror nodes display identical lists of publications.</span></span> <span data-ttu-id="fd3b4-179">La supervisión debe realizarse en las publicaciones debajo del nodo de la entidad reflejada.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-179">Monitoring should be performed on the publications under the mirror node.</span></span>  
  
-   <span data-ttu-id="fd3b4-180">Si se utilizan procedimientos almacenados o Replication Management Objects (RMO) para administrar la replicación en la entidad reflejada, en los casos en que se especifica el nombre del publicador, se debe especificar el nombre de la instancia en la que la base de datos se habilitó para la replicación.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-180">When using stored procedures or Replication Management Objects (RMO) to administer replication at the mirror, for cases in which you specify the Publisher name, you must specify the name of the instance on which the database was enabled for replication.</span></span> <span data-ttu-id="fd3b4-181">Para determinar el nombre correcto, use la función [publishingservername](/sql/t-sql/functions/replication-functions-publishingservername).</span><span class="sxs-lookup"><span data-stu-id="fd3b4-181">To determine the appropriate name, use the function [publishingservername](/sql/t-sql/functions/replication-functions-publishingservername).</span></span>  
  
     <span data-ttu-id="fd3b4-182">Cuando se crea el reflejo de una base de datos de publicación, los metadatos de la replicación que se encuentran almacenados en la base de datos reflejada son idénticos a los que se encuentran almacenados en la base de datos de la entidad de seguridad.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-182">When a publication database is mirrored, the replication metadata stored in the mirrored database is identical to the metadata stored in the principal database.</span></span> <span data-ttu-id="fd3b4-183">En consecuencia, para las bases de datos de publicación habilitadas para replicación en la entidad de seguridad, el nombre de la instancia del publicador que está almacenado en las tablas del sistema en la entidad reflejada es el nombre de la entidad de seguridad, en lugar del nombre de la entidad reflejada.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-183">Consequently, for publication databases enabled for replication at the principal, the Publisher instance name stored in system tables at the mirror is the name of the principal, not the mirror.</span></span> <span data-ttu-id="fd3b4-184">Esto afecta a la configuración y al mantenimiento de la replicación si se produce la conmutación por error de la base de datos de publicación a la entidad reflejada.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-184">This affects replication configuration and maintenance if the publication database fails over to the mirror.</span></span> <span data-ttu-id="fd3b4-185">Por ejemplo, si está configurando la replicación con procedimientos almacenados en el reflejo después de una conmutación por error y desea agregar una suscripción de extracción a una base de datos de publicación que se habilitó en la entidad de seguridad, debe especificar el nombre principal en lugar del nombre del reflejo para el **@publisher** parámetro de **sp_addpullsubscription** o **sp_addmergepullsubscription**.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-185">For example, if you are configuring replication with stored procedures on the mirror after a failover, and you want to add a pull subscription to a publication database that was enabled at the principal, you must specify the principal name rather than the mirror name for the **@publisher** parameter of **sp_addpullsubscription** or **sp_addmergepullsubscription**.</span></span>  
  
     <span data-ttu-id="fd3b4-186">Si habilita una base de datos de publicación en el reflejo después de la conmutación por error en el reflejo, el nombre de instancia del publicador almacenado en las tablas del sistema es el nombre del reflejo; en este caso, usaría el nombre del reflejo para el **@publisher** parámetro.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-186">If you enable a publication database at the mirror after failover to the mirror, the Publisher instance name stored in system tables is the name of the mirror; in this case, you would use the name of the mirror for the **@publisher** parameter.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="fd3b4-187">En algunos casos, por ejemplo **sp_addpublication**, el parámetro **@publisher** solo se admite para publicadores que no sean de[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . En estos casos, no es relevante para la creación de reflejo de la base de datos de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="fd3b4-187">In some cases, such as **sp_addpublication**, the **@publisher** parameter is supported only for non-[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Publishers; in these cases, it is not relevant for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database mirroring.</span></span>  
  
-   <span data-ttu-id="fd3b4-188">Para sincronizar una suscripción en [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] tras una conmutación por error: sincronice las suscripciones de extracción del suscriptor y sincronice las suscripciones de inserción del publicador activo.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-188">To synchronize a subscription in [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] after a failover: synchronize pull subscriptions from the Subscriber; and synchronize push subscriptions from the active Publisher.</span></span>  
  
### <a name="replication-behavior-if-mirroring-is-removed"></a><span data-ttu-id="fd3b4-189">Comportamiento de la replicación si se quita la creación de reflejo</span><span class="sxs-lookup"><span data-stu-id="fd3b4-189">Replication Behavior if Mirroring is Removed</span></span>  
 <span data-ttu-id="fd3b4-190">Tenga en cuenta las siguientes consideraciones si se quita la creación de reflejo de la base de datos de una base de datos publicada:</span><span class="sxs-lookup"><span data-stu-id="fd3b4-190">Keep the following issues in mind if database mirroring is removed from a published database:</span></span>  
  
-   <span data-ttu-id="fd3b4-191">Si la base de datos de publicación de la entidad de seguridad ya no está reflejada, la replicación continúa funcionando sin variaciones con la entidad de seguridad original.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-191">If the publication database at the principal is no longer mirrored, replication continues to work unchanged against the original principal.</span></span>  
  
-   <span data-ttu-id="fd3b4-192">Si se produce la conmutación por error de la base de datos de publicación de la entidad de seguridad a la entidad reflejada y, por consiguiente, se deshabilita o quita la relación de creación de reflejo, los agentes de replicación no funcionarán con la entidad reflejada.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-192">If the publication database fails over from the principal to the mirror and the mirroring relationship is subsequently disabled or removed, replication agents will not function against the mirror.</span></span> <span data-ttu-id="fd3b4-193">Si la entidad de seguridad se pierde de forma permanente, deshabilite y, a continuación, vuelva a configurar la replicación con la entidad reflejada especificada como publicador.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-193">If the principal is permanently lost, disable and then reconfigure replication with the mirror specified as the Publisher.</span></span>  
  
-   <span data-ttu-id="fd3b4-194">Si se quita por completo la creación de reflejo de la base de datos, la base de datos reflejada se encontrará en un estado de recuperación y deberá restaurarse para ser funcional.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-194">If database mirroring is removed completely, the mirror database is in a recovery state and must be restored in order to become functional.</span></span> <span data-ttu-id="fd3b4-195">El comportamiento de la base de datos recuperada con respecto a la replicación depende de si se ha especificado la opción KEEP_REPLICATION.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-195">The behavior of the recovered database with respect to replication depends on whether the KEEP_REPLICATION option is specified.</span></span> <span data-ttu-id="fd3b4-196">Esta opción obliga a la operación de restauración a conservar la configuración de la replicación cuando restaure una base de datos publicada en un servidor distinto del servidor en el que se creó la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-196">This option forces the restore operation to preserve replication settings when restoring a published database to a server other than that on which the backup was created.</span></span> <span data-ttu-id="fd3b4-197">Utilice la opción KEEP_REPLICATION solo cuando la otra base de datos de publicación no esté disponible.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-197">Use the KEEP_REPLICATION option only when the other publication database is unavailable.</span></span> <span data-ttu-id="fd3b4-198">Esta opción no es compatible si la otra base de datos de publicación sigue intacta y continúa con la replicación.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-198">The option is not supported if the other publication database is still intact and replicating.</span></span> <span data-ttu-id="fd3b4-199">Para obtener más información sobre KEEP_REPLICATION, vea [RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="fd3b4-199">For more information about KEEP_REPLICATION, see [RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql).</span></span>  
  
## <a name="log-reader-agent-behavior"></a><span data-ttu-id="fd3b4-200">Comportamiento del Agente de registro del LOG</span><span class="sxs-lookup"><span data-stu-id="fd3b4-200">Log Reader Agent Behavior</span></span>  
 <span data-ttu-id="fd3b4-201">En la siguiente tabla se describe el comportamiento del Agente de registro del LOG en los distintos modos de funcionamiento de la creación de reflejo de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-201">The following table describes Log Reader Agent behavior for the various operating modes of database mirroring.</span></span>  
  
|<span data-ttu-id="fd3b4-202">Modo de funcionamiento</span><span class="sxs-lookup"><span data-stu-id="fd3b4-202">Operating mode</span></span>|<span data-ttu-id="fd3b4-203">Comportamiento del Agente de registro del LOG si la entidad reflejada no está disponible</span><span class="sxs-lookup"><span data-stu-id="fd3b4-203">Log Reader Agent behavior if the mirror is unavailable</span></span>|  
|--------------------|------------------------------------------------------------|  
|<span data-ttu-id="fd3b4-204">Modo de seguridad alta con conmutación automática por error</span><span class="sxs-lookup"><span data-stu-id="fd3b4-204">High-safety mode with automatic failover</span></span>|<span data-ttu-id="fd3b4-205">Si la entidad reflejada no está disponible, el Agente de registro del LOG propaga los comandos a la base de datos de distribución.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-205">If the mirror is unavailable, the Log Reader Agent propagates commands to the distribution database.</span></span> <span data-ttu-id="fd3b4-206">La entidad de seguridad no puede realizar la conmutación por error a la entidad reflejada hasta que la entidad reflejada vuelva a estar en línea e incluya todas las transacciones de la entidad de seguridad.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-206">The principal cannot failover to the mirror until the mirror is back online and has all transactions from the principal.</span></span>|  
|<span data-ttu-id="fd3b4-207">Modo de alto rendimiento</span><span class="sxs-lookup"><span data-stu-id="fd3b4-207">High-performance mode</span></span>|<span data-ttu-id="fd3b4-208">Si la entidad reflejada no está disponible, la base de datos de la entidad de seguridad se ejecuta de forma expuesta (es decir, sin reflejo).</span><span class="sxs-lookup"><span data-stu-id="fd3b4-208">If the mirror is unavailable, the principal database is running exposed (that is, unmirrored).</span></span> <span data-ttu-id="fd3b4-209">Sin embargo, el Agente de registro del LOG solo replica las transacciones reforzadas en la entidad reflejada.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-209">However, the Log Reader Agent only replicates those transactions that are hardened on the mirror.</span></span> <span data-ttu-id="fd3b4-210">Si se fuerza el servicio y el servidor reflejado asume el rol de la entidad de seguridad, el Agente de registro del LOG trabajará con la entidad reflejada y comenzará a recoger las transacciones nuevas.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-210">If service is forced and the mirror server assumes the role of the principal, the Log Reader Agent will work against the mirror and start picking up the new transactions.</span></span><br /><br /> <span data-ttu-id="fd3b4-211">Tenga en cuenta que aumentará la latencia de replicación si la entidad reflejada se retrasa con respecto a la entidad de seguridad.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-211">Be aware that replication latency will increase if the mirror falls behind the principal.</span></span>|  
|<span data-ttu-id="fd3b4-212">Modo de alta seguridad sin conmutación automática por error</span><span class="sxs-lookup"><span data-stu-id="fd3b4-212">High-safety mode without automatic failover</span></span>|<span data-ttu-id="fd3b4-213">Se garantiza que todas las transacciones confirmadas se refuerzan en disco en la entidad reflejada.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-213">All committed transactions are guaranteed to be hardened to disk on the mirror.</span></span> <span data-ttu-id="fd3b4-214">El Agente de registro del LOG solo replica las transacciones reforzadas en la entidad reflejada.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-214">The Log Reader Agent replicates only those transactions that are hardened on the mirror.</span></span> <span data-ttu-id="fd3b4-215">Si la entidad reflejada no está disponible, la entidad de seguridad no permite que continúe la actividad en la base de datos; por lo tanto, el Agente de registro del LOG no contará con transacciones para replicar.</span><span class="sxs-lookup"><span data-stu-id="fd3b4-215">If the mirror is unavailable, the principal disallows further activity in the database; therefore the Log Reader Agent has no transactions to replicate.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="fd3b4-216">Consulte también</span><span class="sxs-lookup"><span data-stu-id="fd3b4-216">See Also</span></span>  
 <span data-ttu-id="fd3b4-217">[Replicación de SQL Server](../../relational-databases/replication/sql-server-replication.md) </span><span class="sxs-lookup"><span data-stu-id="fd3b4-217">[SQL Server Replication](../../relational-databases/replication/sql-server-replication.md) </span></span>  
 [<span data-ttu-id="fd3b4-218">Trasvase de registros y replicación &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="fd3b4-218">Log Shipping and Replication &#40;SQL Server&#41;</span></span>](../log-shipping/log-shipping-and-replication-sql-server.md)  
  
  
