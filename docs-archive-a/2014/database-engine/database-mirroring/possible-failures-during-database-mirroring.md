---
title: Posibles errores durante la creación de reflejo de la base de datos | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- time-out period [SQL Server database mirroring]
- soft errors [SQL Server]
- database mirroring [SQL Server], troubleshooting
- timeout errors [SQL Server]
- troubleshooting [SQL Server], database mirroring
- hard errors
- failed database mirroring sessions [SQL Server]
ms.assetid: d7031f58-5f49-4e6d-9a62-9b420f2bb17e
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 25ba1ccc87c024fa3da370f2ff19251a1bee9f30
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87746511"
---
# <a name="possible-failures-during-database-mirroring"></a><span data-ttu-id="d3ea4-102">Posibles errores durante la creación de reflejo de la base de datos</span><span class="sxs-lookup"><span data-stu-id="d3ea4-102">Possible Failures During Database Mirroring</span></span>
  <span data-ttu-id="d3ea4-103">Los problemas físicos, del sistema operativo o de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] pueden provocar un error en una sesión de creación de reflejo de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-103">Physical, operating system, or [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] problems can cause a failure in a database mirroring session.</span></span> <span data-ttu-id="d3ea4-104">La creación de reflejo de la base de datos no comprueba regularmente los componentes de los que depende Sqlservr.exe para comprobar si están funcionando de forma correcta o si se ha producido un error.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-104">Database mirroring does not regularly check the components on which Sqlservr.exe relies to verify whether they are functioning correctly or have failed.</span></span> <span data-ttu-id="d3ea4-105">Sin embargo, en algunos tipos de errores, el componente afectado informa a Sqlservr.exe.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-105">However, for some types of failures, the affected component reports an error to Sqlservr.exe.</span></span> <span data-ttu-id="d3ea4-106">Cuando otro componente informa del error, éste se denomina *error de hardware*.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-106">An error reported by another component is called a *hard error*.</span></span> <span data-ttu-id="d3ea4-107">Para detectar otros errores que pudieran pasar desapercibidos, la creación de reflejo de la base de datos implementa su propio mecanismo de tiempo de espera.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-107">To detect other failures that would otherwise go unnoticed, database mirroring implements its own time-out mechanism.</span></span> <span data-ttu-id="d3ea4-108">Si se agota el tiempo de espera de la creación de reflejo, la creación de reflejo de la base de datos supone que se ha producido un error y declara un *error de software*.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-108">When a mirroring time-out occurs, database mirroring assumes that a failure has occurred and declares a *soft error*.</span></span> <span data-ttu-id="d3ea4-109">Sin embargo, algunos errores que se producen en el nivel de instancia de SQL Server no ocasionan que se agote el tiempo de espera de la creación de reflejo y pueden no ser detectados.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-109">However, some failures that happen at the SQL Server instance level do not cause mirroring to time-out and can go undetected.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="d3ea4-110">Los errores en las bases de datos que no son reflejadas no se detectan en una sesión de creación de reflejo de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-110">Failures in databases other than the mirrored database are not detectable in a database mirroring session.</span></span> <span data-ttu-id="d3ea4-111">Además, no es probable que se detecte un error en el disco de datos, a menos que la base de datos se reinicie por el error de un disco de datos.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-111">Moreover, a data disk failure is unlikely to be detected, unless the database is restarted because of a data disk failure.</span></span>  
  
 <span data-ttu-id="d3ea4-112">La rapidez en la detección de errores y, por tanto, el tiempo de reacción ante un error de la sesión de creación de reflejo, depende de si el error es de hardware o software.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-112">The speed of error detection and, therefore, the reaction time of the mirroring session to a failure, depends on whether the error is hard or soft.</span></span> <span data-ttu-id="d3ea4-113">En el caso de algunos errores de hardware, como los errores de red, se informa de inmediato.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-113">Some hard errors, such as network failures are reported immediately.</span></span> <span data-ttu-id="d3ea4-114">Sin embargo, en ciertos casos, es posible que períodos de tiempo de espera de componentes específicos retrasen el informe de algunos errores de hardware.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-114">However, in some cases, component-specific time-out periods can delay the reporting of some hard errors.</span></span> <span data-ttu-id="d3ea4-115">En los errores de software, la longitud del período de tiempo de espera de la creación de reflejo determina la rapidez en la detección del error.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-115">For soft errors, the length of the mirroring time-out period determines the speed of error detection.</span></span> <span data-ttu-id="d3ea4-116">De manera predeterminada, este valor es 10 segundos.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-116">By default, this period is 10 seconds.</span></span> <span data-ttu-id="d3ea4-117">Éste es el valor mínimo recomendado.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-117">This is the minimum recommended value.</span></span>  
  
## <a name="failures-due-to-hard-errors"></a><span data-ttu-id="d3ea4-118">Problemas debidos a errores de hardware</span><span class="sxs-lookup"><span data-stu-id="d3ea4-118">Failures Due to Hard Errors</span></span>  
 <span data-ttu-id="d3ea4-119">Las posibles causas de errores de hardware incluyen (sin limitarse a) las siguientes condiciones:</span><span class="sxs-lookup"><span data-stu-id="d3ea4-119">Possible causes of hard errors include (but are not limited to) the following conditions:</span></span>  
  
-   <span data-ttu-id="d3ea4-120">Una conexión interrumpida o un cable roto</span><span class="sxs-lookup"><span data-stu-id="d3ea4-120">A broken connection or wire</span></span>  
  
-   <span data-ttu-id="d3ea4-121">Una tarjeta de red en mal estado</span><span class="sxs-lookup"><span data-stu-id="d3ea4-121">A bad network card</span></span>  
  
-   <span data-ttu-id="d3ea4-122">Un cambio de enrutador</span><span class="sxs-lookup"><span data-stu-id="d3ea4-122">A router change</span></span>  
  
-   <span data-ttu-id="d3ea4-123">Cambios en el firewall</span><span class="sxs-lookup"><span data-stu-id="d3ea4-123">Changes in the firewall</span></span>  
  
-   <span data-ttu-id="d3ea4-124">Reconfiguración de extremos</span><span class="sxs-lookup"><span data-stu-id="d3ea4-124">Endpoint reconfiguration</span></span>  
  
-   <span data-ttu-id="d3ea4-125">Pérdida de la unidad en que reside el registro de transacciones</span><span class="sxs-lookup"><span data-stu-id="d3ea4-125">Loss of the drive where the transaction log resides</span></span>  
  
-   <span data-ttu-id="d3ea4-126">Errores de proceso o errores del sistema operativo</span><span class="sxs-lookup"><span data-stu-id="d3ea4-126">Operating system or process failure</span></span>  
  
 <span data-ttu-id="d3ea4-127">Por ejemplo, cuando la unidad de registro de la base de datos principal deja de responder y se produce un error, el sistema operativo informa a Sqlservr.exe de que se ha producido un error grave.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-127">For example, when the log drive on the principal database becomes unresponsive and fails, the operating system informs Sqlservr.exe that a serious error has occurred.</span></span>  
  
 <span data-ttu-id="d3ea4-128">Algunos componentes, como los componentes de red y ciertos subsistemas de E/S, tienen sus propios tiempos de espera para determinar errores.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-128">Some components, such as network components and some IO subsystems, have their own time-outs to determine failures.</span></span> <span data-ttu-id="d3ea4-129">Esos tiempos de espera son independientes de la creación de reflejo de la base de datos, que los desconoce y no sabe nada de su comportamiento.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-129">Such time-outs are independent of database mirroring, which has no knowledge of them and is completely unaware of their behavior.</span></span> <span data-ttu-id="d3ea4-130">En estos casos, la demora del tiempo de espera aumenta el tiempo entre que se produce un error y el momento en que la base de datos de creación de reflejo recibe el error de hardware resultante.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-130">In these cases, the time-out delay increases the time between a failure and when database mirroring receive the resulting hard error.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d3ea4-131">La única comprobación de errores activa que realiza el proceso de creación de reflejo de la base de datos se produce en los casos en que tiene lugar un error de software</span><span class="sxs-lookup"><span data-stu-id="d3ea4-131">The only active error checking performed for database mirroring occurs for soft error cases.</span></span> <span data-ttu-id="d3ea4-132">Para obtener más información, vea "Problemas debidos a errores de software", más adelante en este tema.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-132">For more information, see "Failures Due to Soft Errors," later in this topic.</span></span>  
  
 <span data-ttu-id="d3ea4-133">Para ayudarle a interpretar las situaciones de error que tienen lugar en su red, pregunte al ingeniero de red qué mensajes de error se envían a un puerto cuando tienen lugar los siguientes eventos en una conexión TCP:</span><span class="sxs-lookup"><span data-stu-id="d3ea4-133">To help you interpret the error conditions that occur on the network, ask a network engineer what error messages are sent to a port when the following events occur on a TCP connection:</span></span>  
  
-   <span data-ttu-id="d3ea4-134">DNS no funciona</span><span class="sxs-lookup"><span data-stu-id="d3ea4-134">DNS is not working.</span></span>  
  
-   <span data-ttu-id="d3ea4-135">Los cables están desconectados</span><span class="sxs-lookup"><span data-stu-id="d3ea4-135">Cables are unplugged.</span></span>  
  
-   [!INCLUDE[msCoName](../../includes/msconame-md.md)] <span data-ttu-id="d3ea4-136">Windows tiene un firewall que bloquea un puerto específico.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-136">Windows has a firewall that blocks a specific port.</span></span>  
  
-   <span data-ttu-id="d3ea4-137">Se ha producido un error en la aplicación que está supervisando un puerto</span><span class="sxs-lookup"><span data-stu-id="d3ea4-137">The application that is monitoring a port fails.</span></span>  
  
-   <span data-ttu-id="d3ea4-138">Se cambia el nombre de un servidor basado en Windows.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-138">A Windows-based server is renamed.</span></span>  
  
-   <span data-ttu-id="d3ea4-139">Se reinicia un servidor basado en Windows.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-139">A Windows-based server is rebooted.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d3ea4-140">La creación de reflejos no protege frente a problemas específicos de los clientes que intentan obtener acceso a los servidores.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-140">Mirroring does not protect against problems specific to client accessing the servers.</span></span> <span data-ttu-id="d3ea4-141">Por ejemplo, imagine un caso en el que un adaptador de red pública controla las conexiones de los clientes a la instancia de servidor principal, mientras una tarjeta de interfaz de red privada controla todo el tráfico de creación de reflejo entre las instancias de servidor.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-141">For example, consider a case in which a public network adapter handles client connections to the principal server instance, while a private network interface card handles all mirroring traffic among server instances.</span></span> <span data-ttu-id="d3ea4-142">En este caso, un error en el adaptador de red pública impediría que los clientes tuvieran acceso a la base de datos; si bien, el reflejo de la base de datos se seguirá creando.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-142">In this case, failure of the public network adapter would prevent clients from accessing the database, though the database would continue to be mirrored.</span></span>  
  
## <a name="failures-due-to-soft-errors"></a><span data-ttu-id="d3ea4-143">Problemas debidos a errores de software</span><span class="sxs-lookup"><span data-stu-id="d3ea4-143">Failures Due to Soft Errors</span></span>  
 <span data-ttu-id="d3ea4-144">Las condiciones que pueden provocar el agotamiento del tiempo de espera en la creación de reflejo incluyen (sin limitarse a) lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="d3ea4-144">Conditions that might cause mirroring time-outs include (but are not limited to) the following:</span></span>  
  
-   <span data-ttu-id="d3ea4-145">Errores de red, como tiempos de espera de vínculos TCP, paquetes que se han dañado o se han quitado o paquetes que están en un orden incorrecto.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-145">Network errors such as TCP link time-outs, dropped or corrupted packets, or packets that are in an incorrect order.</span></span>  
  
-   <span data-ttu-id="d3ea4-146">Un sistema operativo, un servidor o una base de datos que no responde.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-146">An operating system, server, or database that is not responding.</span></span>  
  
-   <span data-ttu-id="d3ea4-147">Se ha agotado el tiempo de espera de un servidor de Windows.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-147">A Windows server timing out.</span></span>  
  
-   <span data-ttu-id="d3ea4-148">Insuficientes recursos, tales como una sobrecarga de disco o CPU, llenado completo del registro de transacciones, falta de memoria o subprocesos en el sistema.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-148">Insufficient computing resources, such as a CPU or disk overload, the transaction log filling up, or the system is running out of memory or threads.</span></span> <span data-ttu-id="d3ea4-149">En estos casos, debe incrementar el período de tiempo de espera, reducir la carga de trabajo o cambiar el hardware para que pueda ocuparse de la carga de trabajo.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-149">In these cases, you must increase the time-out period, reduce the workload, or change the hardware to handle the workload.</span></span>  
  
### <a name="the-mirroring-time-out-mechanism"></a><span data-ttu-id="d3ea4-150">El mecanismo de tiempo de espera de la creación de reflejo</span><span class="sxs-lookup"><span data-stu-id="d3ea4-150">The Mirroring Time-Out Mechanism</span></span>  
 <span data-ttu-id="d3ea4-151">Debido a que los errores de software no son detectables directamente por una instancia de servidor, un error de software podría provocar que una instancia de servidor esperara de manera indefinida.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-151">Because soft errors are not detectable directly by a server instance, a soft error could potentially cause a server instance to wait indefinitely.</span></span> <span data-ttu-id="d3ea4-152">Para evitarlo, la creación de reflejo de la base de datos implementa su propio mecanismo de tiempo de espera basado en que cada instancia de servidor de una sesión de creación de reflejo hace ping en cada conexión abierta con un intervalo fijo.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-152">To prevent this, database mirroring implements its own time-out mechanism, based on each server instance in a mirroring session sending out a ping on each open connection at a fixed interval.</span></span>  
  
 <span data-ttu-id="d3ea4-153">Para mantener una conexión abierta, una instancia de servidor debe recibir un ping en dicha conexión dentro del período de tiempo de espera definido, además del tiempo de espera necesario para enviar otro ping.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-153">To keep a connection open, a server instance must receive a ping on that connection in the time-out period defined, plus the time that is required to send one more ping.</span></span> <span data-ttu-id="d3ea4-154">La recepción de un ping durante el período de tiempo de espera indica que la conexión todavía está abierta y que las instancias de servidor se comunican a través de ella.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-154">Receiving a ping during the time-out period indicates that the connection is still open and that the server instances are communicating over it.</span></span> <span data-ttu-id="d3ea4-155">Al recibir un ping, una instancia de servidor restablece su contador de tiempo de espera en dicha conexión.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-155">On receiving a ping, a server instance resets its time-out counter on that connection.</span></span>  
  
 <span data-ttu-id="d3ea4-156">Si no se recibe ningún ping en una conexión durante el período de tiempo de espera, una instancia de servidor considera que la conexión ha agotado el tiempo de espera. La instancia de servidor cierra la conexión que ha superado el tiempo de espera y controla el evento de tiempo de espera según el estado y el modo de funcionamiento de la sesión.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-156">If no ping is received on a connection during the time-out period, a server instance considers the connection to have timed out. The server instance closes the timed-out connection and handles the time-out event according to the state and operating mode of the session.</span></span>  
  
 <span data-ttu-id="d3ea4-157">Incluso aunque el otro servidor funcione correctamente, un tiempo de espera agotado se considera un error.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-157">Even if the other server is actually proceeding correctly, a time-out is considered a failure.</span></span> <span data-ttu-id="d3ea4-158">Si el valor de tiempo de espera establecido para una sesión es demasiado corto para el nivel de respuesta normal de cualquier servidor asociado, puede darse un error falso.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-158">If the time-out value for a session is too short for the regular responsiveness of either partner, false failures can occur.</span></span> <span data-ttu-id="d3ea4-159">Un error falso se produce cuando una instancia de servidor se pone en contacto correctamente con otra cuyo tiempo de respuesta es tan lento que sus comandos ping no se reciben antes de que expire el período de tiempo de espera.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-159">A false failure occurs when one server instance successfully contacts another whose response time is so slow that its pings are not received before the time-out period expires.</span></span>  
  
 <span data-ttu-id="d3ea4-160">En sesiones con el modo de alto rendimiento, el tiempo de espera siempre es de 10 segundos.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-160">In high-performance mode sessions, the time-out period is always 10 seconds.</span></span> <span data-ttu-id="d3ea4-161">Normalmente, esto es suficiente para evitar errores falsos.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-161">This is generally enough to avoid false failures.</span></span> <span data-ttu-id="d3ea4-162">En sesiones con el modo de alta seguridad, el período de tiempo de espera predeterminado es de 10 segundos, pero puede cambiar su duración.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-162">In high-safety mode sessions, the default time-out period is 10 seconds, but you can change the duration.</span></span> <span data-ttu-id="d3ea4-163">Para evitar errores falsos, es recomendable que el período del tiempo de espera de la creación de reflejo sea siempre de 10 segundos o más.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-163">To avoid false failures, we recommend that the mirroring time-out period always be 10 seconds or more.</span></span>  
  
 <span data-ttu-id="d3ea4-164">**Para cambiar el valor del tiempo de espera (solo modo de alta seguridad)**</span><span class="sxs-lookup"><span data-stu-id="d3ea4-164">**To change the time-out value (high-safety mode only)**</span></span>  
  
-   <span data-ttu-id="d3ea4-165">Use la instrucción [ALTER DATABASE \<database> SET PARTNER TIMEOUT \<integer>](/sql/t-sql/statements/alter-database-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d3ea4-165">Use the [ALTER DATABASE \<database> SET PARTNER TIMEOUT \<integer>](/sql/t-sql/statements/alter-database-transact-sql) statement.</span></span>  
  
 <span data-ttu-id="d3ea4-166">**Para visualizar el valor del tiempo de espera actual**</span><span class="sxs-lookup"><span data-stu-id="d3ea4-166">**To view the current time-out value**</span></span>  
  
-   <span data-ttu-id="d3ea4-167">Consulte **mirroring_connection_timeout** en [sys.database_mirroring](/sql/relational-databases/system-catalog-views/sys-database-mirroring-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d3ea4-167">Query **mirroring_connection_timeout** in [sys.database_mirroring](/sql/relational-databases/system-catalog-views/sys-database-mirroring-transact-sql).</span></span>  
  
## <a name="responding-to-an-error"></a><span data-ttu-id="d3ea4-168">Responder a un error</span><span class="sxs-lookup"><span data-stu-id="d3ea4-168">Responding to an Error</span></span>  
 <span data-ttu-id="d3ea4-169">Independientemente del tipo de error, una instancia de servidor que detecta un error responde apropiadamente según el rol de la instancia, el modo de funcionamiento de la sesión y el estado de las demás conexiones de la sesión.</span><span class="sxs-lookup"><span data-stu-id="d3ea4-169">Regardless of the type of error, a server instance that detects an error responds appropriately based on the role of the instance, the operating mode of the session, and the state of any other connection in the session.</span></span> <span data-ttu-id="d3ea4-170">Para obtener información acerca de lo que ocurre en caso de pérdida de un asociado, vea [Database Mirroring Operating Modes](database-mirroring-operating-modes.md).</span><span class="sxs-lookup"><span data-stu-id="d3ea4-170">For information about what occurs on the loss of a partner, see [Database Mirroring Operating Modes](database-mirroring-operating-modes.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d3ea4-171">Consulte también</span><span class="sxs-lookup"><span data-stu-id="d3ea4-171">See Also</span></span>  
 <span data-ttu-id="d3ea4-172">[Calcular la interrupción del servicio durante la conmutación de roles &#40;creación de reflejo de la base de datos&#41;](estimate-the-interruption-of-service-during-role-switching-database-mirroring.md) </span><span class="sxs-lookup"><span data-stu-id="d3ea4-172">[Estimate the Interruption of Service During Role Switching &#40;Database Mirroring&#41;](estimate-the-interruption-of-service-during-role-switching-database-mirroring.md) </span></span>  
 <span data-ttu-id="d3ea4-173">[Modos de funcionamiento de la creación de reflejo de la base de datos](database-mirroring-operating-modes.md) </span><span class="sxs-lookup"><span data-stu-id="d3ea4-173">[Database Mirroring Operating Modes](database-mirroring-operating-modes.md) </span></span>  
 <span data-ttu-id="d3ea4-174">[Conmutación de roles durante una sesión de creación de reflejo de la base de datos &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="d3ea4-174">[Role Switching During a Database Mirroring Session &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md) </span></span>  
 [<span data-ttu-id="d3ea4-175">Creación de reflejo de la base de datos &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d3ea4-175">Database Mirroring &#40;SQL Server&#41;</span></span>](database-mirroring-sql-server.md)  
  
  
