---
title: Creación de reflejo de la base de datos e instancias de clúster de conmutación por error | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- failover clustering [SQL Server], database mirroring
- database mirroring [SQL Server], failover
- high-availability mode [SQL Server]
ms.assetid: f1dd6a79-698b-4e31-b923-6bfc3ea0b617
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 378f834b4482f44f6a84abf419f027b353c7771a
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87748249"
---
# <a name="database-mirroring-and-sql-server-failover-cluster-instances"></a><span data-ttu-id="73277-102">Creación de reflejo de la base de datos e instancias de clúster de conmutación por error</span><span class="sxs-lookup"><span data-stu-id="73277-102">Database Mirroring and SQL Server Failover Cluster Instances</span></span>
  <span data-ttu-id="73277-103">Un clúster de conmutación por error es una combinación de uno o más discos físicos en un grupo de clústeres de los Servicios de Cluster Server de [!INCLUDE[msCoName](../../includes/msconame-md.md)] (MSCS), conocido como un grupo de recursos, que son nodos participantes en el clúster.</span><span class="sxs-lookup"><span data-stu-id="73277-103">A failover cluster is a combination of one or more physical disks in a [!INCLUDE[msCoName](../../includes/msconame-md.md)] Cluster Service (MSCS) cluster group, known as a resource group, that are participating nodes of the cluster.</span></span> <span data-ttu-id="73277-104">El grupo de recursos está configurado como una instancia en clúster de conmutación por error que hospeda una instancia de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="73277-104">The resource group is configured as a failover clustered instance that hosts an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="73277-105">Una instancia en clúster de conmutación por error de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] aparece en la red como si fuera un solo equipo, pero dispone de funcionalidad que proporciona conmutación por error de un nodo a otro si un nodo deja de estar disponible.</span><span class="sxs-lookup"><span data-stu-id="73277-105">A [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] failover clustered instance appears on the network as if it were a single computer, but has functionality that provides failover from one node to another if one node becomes unavailable.</span></span> <span data-ttu-id="73277-106">Para obtener más información, vea [Always On Failover Cluster Instances (SQL Server)](../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md) (Instancias de clúster de conmutación por error de Always On [SQL Server]).</span><span class="sxs-lookup"><span data-stu-id="73277-106">For more information, see [AlwaysOn Failover Cluster Instances (SQL Server)](../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md).</span></span>  
  
 <span data-ttu-id="73277-107">Los clústeres de conmutación por error proporcionan compatibilidad de alta disponibilidad para una instancia entera de [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], a diferencia de la creación de reflejo de la base de datos, que proporciona compatibilidad de alta disponibilidad para una sola base de datos.</span><span class="sxs-lookup"><span data-stu-id="73277-107">Failover clusters provide high-availability support for an entire [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance, in contrast to database mirroring, which provides high-availability support for a single database.</span></span> <span data-ttu-id="73277-108">La creación de reflejo de la base de datos trabaja entre clústeres de conmutación por error y, también, entre un clúster de conmutación por error y un host no agrupado.</span><span class="sxs-lookup"><span data-stu-id="73277-108">Database mirroring works between failover clusters and, also, between a failover cluster and a nonclustered host.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="73277-109">Para obtener una introducción a la creación de reflejo de la base de datos, vea [Creación de reflejo de la base de datos &#40;SQL Server&#41;](database-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="73277-109">For an introduction to database mirroring, see [Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md).</span></span>  
  
## <a name="mirroring-and-clustering"></a><span data-ttu-id="73277-110">Creación de reflejos y agrupación en clústeres</span><span class="sxs-lookup"><span data-stu-id="73277-110">Mirroring and Clustering</span></span>  
 <span data-ttu-id="73277-111">Normalmente, cuando se utiliza la creación de reflejo con la agrupación en clústeres, el servidor principal y el reflejado residen en clústeres, el servidor principal se ejecuta en la instancia en clúster de conmutación por error de un clúster y el servidor reflejado se ejecuta en la instancia en clúster de conmutación por error de otro clúster.</span><span class="sxs-lookup"><span data-stu-id="73277-111">Typically, when mirroring is used with clustering, the principal server and mirror server both reside on clusters, with the principal server running on the failover clustered instance of one cluster and the mirror server running on the failover clustered instance of a different cluster.</span></span> <span data-ttu-id="73277-112">Sin embargo, puede establecer una sesión de creación de reflejos en la que un asociado resida en la instancia en clúster de conmutación por error de un clúster y el otro asociado resida en un equipo no agrupado independiente.</span><span class="sxs-lookup"><span data-stu-id="73277-112">You can establish a mirroring session in which one partner resides on the failover clustered instance of a cluster and the other partner resides on a separate, unclustered computer, however.</span></span>  
  
 <span data-ttu-id="73277-113">Si una conmutación por error de clúster hace que un servidor principal deje de estar disponible temporalmente, las conexiones de cliente se desconectan de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="73277-113">If a cluster failover makes a principal server temporarily unavailable, client connections are disconnected from the database.</span></span> <span data-ttu-id="73277-114">Una vez completada la conmutación por error de clúster, los clientes pueden volverse a conectarse al servidor principal en el mismo clúster, en otro clúster o en un equipo no agrupado, dependiendo del [modo de funcionamiento](database-mirroring-operating-modes.md).</span><span class="sxs-lookup"><span data-stu-id="73277-114">After the cluster failover completes, clients can reconnect to the principal server on the same cluster, or on a different cluster or an unclustered computer, depending on the [operating mode](database-mirroring-operating-modes.md).</span></span> <span data-ttu-id="73277-115">Por tanto, a la hora de decidir cómo configurar la creación de reflejo de la base de datos en un entorno en clúster, el modo de funcionamiento que se emplea para la creación de reflejo es importante.</span><span class="sxs-lookup"><span data-stu-id="73277-115">Therefore, when deciding how to configure database mirroring in a clustered environment, the operating mode you use for mirroring is significant.</span></span>  
  
### <a name="high-safety-mode-session-with-automatic-failover"></a><span data-ttu-id="73277-116">Sesión en modo de alta seguridad con conmutación automática por error</span><span class="sxs-lookup"><span data-stu-id="73277-116">High-Safety mode Session with Automatic Failover</span></span>  
 <span data-ttu-id="73277-117">Si pretende crear un reflejo de una base de datos en modo de alta seguridad con conmutación automática por error, se recomienda una configuración de dos clústeres para los asociados.</span><span class="sxs-lookup"><span data-stu-id="73277-117">If you intend to mirror a database in high-safety mode with automatic failover, a two-cluster configuration is recommended for the partners.</span></span> <span data-ttu-id="73277-118">Esta configuración proporciona la disponibilidad máxima.</span><span class="sxs-lookup"><span data-stu-id="73277-118">This configuration provides maximum availability.</span></span> <span data-ttu-id="73277-119">El testigo puede residir en un tercer clúster o en un equipo no agrupado.</span><span class="sxs-lookup"><span data-stu-id="73277-119">The witness can reside either on a third cluster or on an unclustered computer.</span></span>  
  
 <span data-ttu-id="73277-120">Si el nodo que ejecuta el servidor principal actual tiene un error, en unos segundos empezará la conmutación automática por error de la base de datos, mientras que el clúster sigue con la conmutación por error a otro nodo.</span><span class="sxs-lookup"><span data-stu-id="73277-120">If the node running the current principal server fails, automatic failover of the database begins within a few seconds, while the cluster is still failing over to another node.</span></span> <span data-ttu-id="73277-121">La sesión de creación de reflejo de la base de datos realiza una conmutación por error al servidor reflejado en el otro clúster o en el equipo no agrupado, y el servidor reflejado anterior se convierte en el servidor principal.</span><span class="sxs-lookup"><span data-stu-id="73277-121">The database mirroring session fails over to the mirror server on the other cluster or unclustered computer, and the former mirror server becomes the principal server.</span></span> <span data-ttu-id="73277-122">El nuevo servidor principal pone al día su copia de la base de datos lo más rápido posible y la pone en línea como la base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="73277-122">The new principal server rolls forward its copy of the database as quickly as possible and brings it online as the principal database.</span></span> <span data-ttu-id="73277-123">Una vez completada la conmutación por error del clúster, que suele tardar varios minutos, la instancia en clúster de conmutación por error que antes era el servidor principal se convierte en el servidor reflejado.</span><span class="sxs-lookup"><span data-stu-id="73277-123">After the cluster failover completes, which typically takes several minutes, the failover clustered instance that was formerly the principal server becomes the mirror server.</span></span>  
  
 <span data-ttu-id="73277-124">La siguiente ilustración muestra una conmutación automática por error entre clústeres en una sesión de creación de reflejos que se ejecuta en modo de alta seguridad con un testigo (que admite la conmutación automática por error).</span><span class="sxs-lookup"><span data-stu-id="73277-124">The following illustration shows an automatic failover between clusters in a mirroring session running in high-safety mode with a witness (which supports automatic failover).</span></span>  
  
 <span data-ttu-id="73277-125">![Clúster de conmutación por error](../media/dbm-and-failover-clustering.gif "Clúster de conmutación por error")</span><span class="sxs-lookup"><span data-stu-id="73277-125">![A failover on a cluster](../media/dbm-and-failover-clustering.gif "A failover on a cluster")</span></span>  
  
 <span data-ttu-id="73277-126">Las tres instancias de servidor de la sesión de creación de reflejo residen en tres clústeres distintos: **Cluster_A**, **Cluster_B** y **Cluster_C**.</span><span class="sxs-lookup"><span data-stu-id="73277-126">The three server instances in the mirroring session reside on three distinct clusters: **Cluster_A**, **Cluster_B**, and **Cluster_C**.</span></span> <span data-ttu-id="73277-127">En cada clúster, se ejecuta una instancia predeterminada de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] como una instancia en clúster de conmutación por error de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="73277-127">On each cluster, a default instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is running as a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] failover clustered instance.</span></span> <span data-ttu-id="73277-128">Al iniciarse la sesión de creación de reflejo, la instancia en clúster de conmutación por error en **Cluster_A** es el servidor principal, la instancia en clúster de conmutación por error en **Cluster_B** es el servidor reflejado y la instancia en clúster de conmutación por error en **Cluster_C** es el testigo de la sesión de creación de reflejo.</span><span class="sxs-lookup"><span data-stu-id="73277-128">When the mirroring session starts, the failover clustered instance on **Cluster_A** is the principal server, the failover clustered instance on **Cluster_B** is the mirror server, and the failover clustered instance on **Cluster_C** is the witness in the mirroring session.</span></span> <span data-ttu-id="73277-129">Es posible que el nodo activo de **Cluster_A** tenga un error, lo que provocará que el servidor principal deje de estar disponible.</span><span class="sxs-lookup"><span data-stu-id="73277-129">Eventually, the active node on **Cluster_A** fails, which causes the principal server to become unavailable.</span></span>  
  
 <span data-ttu-id="73277-130">Antes de que el clúster tenga tiempo de realizar la conmutación por error, el servidor reflejado detecta la pérdida del servidor principal con la ayuda del testigo.</span><span class="sxs-lookup"><span data-stu-id="73277-130">Before the cluster has time to fail over, the loss of the principal server is detected by the mirror server, with the help of the witness.</span></span> <span data-ttu-id="73277-131">El servidor reflejado pone al día su base de datos y la pone en línea como nueva base de datos principal lo más rápido posible.</span><span class="sxs-lookup"><span data-stu-id="73277-131">The mirror server rolls forward its database and brings it online as the new principal database as quickly as possible.</span></span> <span data-ttu-id="73277-132">Cuando **Cluster_A** finaliza la conmutación por error, el servidor principal anterior se convierte en servidor reflejado y sincroniza su base de datos con la base de datos principal actual en **Cluster_B**.</span><span class="sxs-lookup"><span data-stu-id="73277-132">When **Cluster_A** finishes failing over, the former principal server is now the mirror server, and it synchronizes its database with the current principal database on **Cluster_B**.</span></span>  
  
### <a name="high-safety-mode-session-without-automatic-failover"></a><span data-ttu-id="73277-133">Sesión en modo de alta seguridad sin conmutación automática por error</span><span class="sxs-lookup"><span data-stu-id="73277-133">High-Safety Mode Session Without Automatic Failover</span></span>  
 <span data-ttu-id="73277-134">Si crea el reflejo de una base de datos en modo de alta seguridad sin conmutación automática por error, otro nodo del clúster actuará como servidor principal si el nodo en el que se ejecuta el servidor principal actual produce un error.</span><span class="sxs-lookup"><span data-stu-id="73277-134">If you are mirroring a database in high-safety mode without automatic failover, another node in the cluster will act as the principal server if the node running the current principal server fails.</span></span> <span data-ttu-id="73277-135">Tenga en cuenta que mientras el clúster no está disponible, la base de datos tampoco lo está.</span><span class="sxs-lookup"><span data-stu-id="73277-135">Note that while the cluster is unavailable, the database is unavailable.</span></span>  
  
### <a name="high-performance-mode-session"></a><span data-ttu-id="73277-136">Sesión de modo de alto rendimiento</span><span class="sxs-lookup"><span data-stu-id="73277-136">High-Performance Mode Session</span></span>  
 <span data-ttu-id="73277-137">Si pretende crear el reflejo de una base de datos en modo de alto rendimiento, considere la posibilidad de colocar el servidor principal en la instancia en clúster de conmutación por error de un clúster y colocar el servidor reflejado en un servidor no en clúster en una ubicación remota.</span><span class="sxs-lookup"><span data-stu-id="73277-137">If you intend to mirror a database in high-performance mode, consider placing the principal server on the failover clustered instance of a cluster and placing the mirror server on an unclustered server in a remote location.</span></span> <span data-ttu-id="73277-138">Si el clúster realiza una conmutación por error a otro nodo, la instancia en clúster de conmutación por error continuará como servidor principal en la sesión de creación de reflejo.</span><span class="sxs-lookup"><span data-stu-id="73277-138">If the cluster fails over to a different node, the failover clustered instance will continue as the principal server in the mirroring session.</span></span> <span data-ttu-id="73277-139">Si todo el clúster tiene problemas, puede forzar el servicio en el servidor reflejado.</span><span class="sxs-lookup"><span data-stu-id="73277-139">If the entire cluster has problems, you can force service onto the mirror server.</span></span>  
  
 <span data-ttu-id="73277-140">**Para configurar un nuevo clúster de conmutación por error de SQL Server**</span><span class="sxs-lookup"><span data-stu-id="73277-140">**To set up a new SQL Server failover cluster**</span></span>  
  
-   [<span data-ttu-id="73277-141">Crear un nuevo clúster de conmutación por error de SQL Server &#40;programa de instalación&#41;</span><span class="sxs-lookup"><span data-stu-id="73277-141">Create a New SQL Server Failover Cluster &#40;Setup&#41;</span></span>](../../sql-server/failover-clusters/install/create-a-new-sql-server-failover-cluster-setup.md)  
  
 <span data-ttu-id="73277-142">**Para configurar la creación de reflejo de la base de datos**</span><span class="sxs-lookup"><span data-stu-id="73277-142">**To set up database mirroring**</span></span>  
  
-   [<span data-ttu-id="73277-143">Configurar la creación de reflejo de la base de datos &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="73277-143">Setting Up Database Mirroring &#40;SQL Server&#41;</span></span>](setting-up-database-mirroring-sql-server.md)  
  
-   [<span data-ttu-id="73277-144">Establecer una sesión de creación de reflejo de la base de datos mediante la autenticación de Windows &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="73277-144">Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;</span></span>](establish-database-mirroring-session-windows-authentication.md)  
  
## <a name="see-also"></a><span data-ttu-id="73277-145">Consulte también</span><span class="sxs-lookup"><span data-stu-id="73277-145">See Also</span></span>  
 <span data-ttu-id="73277-146">[Creación de reflejo de la base de datos &#40;SQL Server&#41;](database-mirroring-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="73277-146">[Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md) </span></span>  
 <span data-ttu-id="73277-147">[Modos de funcionamiento de la creación de reflejo de la base de datos](database-mirroring-operating-modes.md) </span><span class="sxs-lookup"><span data-stu-id="73277-147">[Database Mirroring Operating Modes](database-mirroring-operating-modes.md) </span></span>  
 [<span data-ttu-id="73277-148">Instancias de clúster de conmutación por error de AlwaysOn (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="73277-148">AlwaysOn Failover Cluster Instances (SQL Server)</span></span>](../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md) 
  
  
