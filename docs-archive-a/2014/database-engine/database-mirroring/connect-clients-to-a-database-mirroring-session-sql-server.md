---
title: Conectar clientes a una sesión de creación de reflejo de la base de datos (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- partners [SQL Server], connecting clients to
- database mirroring [SQL Server], connecting clients to
- client connections [SQL Server], database mirroring
- connections [SQL Server], database mirroring
ms.assetid: 0d5d2742-2614-43de-9ab9-864addb6299b
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 16faa8d02a22fba3e4cfa4cbe0bd6558fc140fdd
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87670571"
---
# <a name="connect-clients-to-a-database-mirroring-session-sql-server"></a><span data-ttu-id="6bf99-102">Conectar clientes a una sesión de creación de reflejo de la base de datos (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="6bf99-102">Connect Clients to a Database Mirroring Session (SQL Server)</span></span>
  <span data-ttu-id="6bf99-103">Para conectarse a una sesión de creación de reflejo de la base de datos, un cliente puede usar SQL Native Client de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] o el proveedor de datos de .NET Framework para [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="6bf99-103">To connect to a database mirroring session, a client can use either [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client or .NET Framework Data Provider for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="6bf99-104">Estos proveedores de acceso a datos son totalmente compatibles con la creación de reflejo de la base de datos cuando se configuran para una base de datos de [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="6bf99-104">When configured for a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] database, these data access providers both fully support database mirroring.</span></span> <span data-ttu-id="6bf99-105">Para obtener información acerca de las consideraciones de programación para el uso de una base de datos reflejada, vea [Using Database Mirroring](../../relational-databases/native-client/features/using-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="6bf99-105">For information about programming considerations for using a mirrored database, see [Using Database Mirroring](../../relational-databases/native-client/features/using-database-mirroring.md).</span></span> <span data-ttu-id="6bf99-106">Además, la instancia del servidor principal actual debe estar disponible y el inicio de sesión del cliente se debe haber creado en la instancia del servidor.</span><span class="sxs-lookup"><span data-stu-id="6bf99-106">In addition, the current principal server instance must be available and the login of the client must have been created on the server instance.</span></span> <span data-ttu-id="6bf99-107">Para obtener más información, vea [Solucionar problemas de usuarios huérfanos &#40;SQL Server&#41;](../../sql-server/failover-clusters/troubleshoot-orphaned-users-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="6bf99-107">For more information, see [Troubleshoot Orphaned Users &#40;SQL Server&#41;](../../sql-server/failover-clusters/troubleshoot-orphaned-users-sql-server.md).</span></span> <span data-ttu-id="6bf99-108">Las conexiones de cliente a una sesión de creación de reflejo de la base de datos no tienen relación con la instancia del servidor testigo, si existe alguno.</span><span class="sxs-lookup"><span data-stu-id="6bf99-108">Client connections to a database mirroring session do not involve the witness server instance, if one exists.</span></span>  
  
 ##  <a name="making-the-initial-connection-to-a-database-mirroring-session"></a><a name="InitialConnection"></a> <span data-ttu-id="6bf99-109">Establecer la conexión inicial en una sesión de creación de reflejo de la base de datos</span><span class="sxs-lookup"><span data-stu-id="6bf99-109">Making the Initial Connection to a Database Mirroring Session</span></span>  
 <span data-ttu-id="6bf99-110">Para la conexión inicial en una base de datos reflejada, un cliente debe suministrar una cadena de conexión que como mínimo proporcione el nombre de una instancia del servidor.</span><span class="sxs-lookup"><span data-stu-id="6bf99-110">For the initial connection to a mirrored database, a client must supply a connection string that minimally supplies the name of a server instance.</span></span> <span data-ttu-id="6bf99-111">Este nombre de servidor requerido debería identificar la instancia del servidor principal actual y se conoce como el *nombre del asociado inicial*.</span><span class="sxs-lookup"><span data-stu-id="6bf99-111">This required server name should identify the current principal server instance and is known as the *initial partner name*.</span></span>  
  
 <span data-ttu-id="6bf99-112">Opcionalmente, la cadena de conexión también puede proporcionar el nombre de otra instancia del servidor, que debería identificar la instancia del servidor reflejado actual, para usarla si el asociado inicial no está disponible durante el primer intento de conexión.</span><span class="sxs-lookup"><span data-stu-id="6bf99-112">Optionally, the connection string can also supply the name of another server instance, which should identify the current mirror server instance, for use if the initial partner is unavailable during the first connection attempt.</span></span> <span data-ttu-id="6bf99-113">Este nombre se conoce como el *nombre del asociado de conmutación por error*.</span><span class="sxs-lookup"><span data-stu-id="6bf99-113">The second name is known as the *failover partner name*.</span></span>  
  
 <span data-ttu-id="6bf99-114">La cadena de conexión también debe proporcionar el nombre de una base de datos.</span><span class="sxs-lookup"><span data-stu-id="6bf99-114">The connection string must also supply a database name.</span></span> <span data-ttu-id="6bf99-115">Esto es necesario para que el proveedor de acceso a datos pueda intentar la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="6bf99-115">This is necessary to enable failover attempts by the data access provider.</span></span>  
  
 <span data-ttu-id="6bf99-116">Al recibir una cadena de conexión, el proveedor de acceso a datos almacena el nombre del asociado inicial y el nombre del asociado de conmutación por error, si se suministran, en una caché en la memoria volátil del cliente (para el código administrado, el ámbito de la caché es el dominio de la aplicación).</span><span class="sxs-lookup"><span data-stu-id="6bf99-116">On receiving a connection string, the data access provider stores the initial partner name and the failover partner name, if supplied, in a cache in the client's volatile memory (for managed code, the cache is scoped to the application domain).</span></span> <span data-ttu-id="6bf99-117">Una vez almacenado en caché, el proveedor de acceso a datos nunca actualiza el nombre del asociado inicial.</span><span class="sxs-lookup"><span data-stu-id="6bf99-117">Once cached, the initial partner name is never updated by the data access provider.</span></span> <span data-ttu-id="6bf99-118">Cuando el cliente suministra el nombre del asociado de conmutación por error, el proveedor de acceso a datos también almacena este nombre temporalmente por si el proveedor no se puede conectar usando el nombre del asociado inicial.</span><span class="sxs-lookup"><span data-stu-id="6bf99-118">When the client supplies the failover partner name, the data access provider also stores this failover partner name temporarily in case the provider cannot connect using the initial partner name.</span></span>  
  
 <span data-ttu-id="6bf99-119">Una sesión de creación de reflejo de la base de datos no protege frente a problemas de acceso al servidor que sean específicos de los clientes, como cuando un equipo cliente tiene un problema en la comunicación con la red.</span><span class="sxs-lookup"><span data-stu-id="6bf99-119">A database mirroring session does not protect against server-access problems that are specific to clients, such as when a client computer is having a problems communicating with the network.</span></span> <span data-ttu-id="6bf99-120">Un intento de conexión a una base de datos reflejada también puede generar un error por diversas razones que no tienen que ver con el proveedor de acceso a datos; por ejemplo, debido a que la instancia del servidor principal esté inactiva, como ocurre cuando la base de datos está realizando la conmutación por error, o bien debido a un error de red.</span><span class="sxs-lookup"><span data-stu-id="6bf99-120">A connection attempt to a mirrored database can also fail for a variety of reasons that are unrelated to the data-access provider; for example, a connection attempt can fail because the principal server instance is inactive, as occurs when the database is failing over, or because of a network error.</span></span>  
  
 <span data-ttu-id="6bf99-121">Cuando se intenta la conexión, el proveedor de acceso a datos comienza usando el nombre del asociado inicial.</span><span class="sxs-lookup"><span data-stu-id="6bf99-121">When attempting to connect, the data access provider begins by using the initial partner name.</span></span> <span data-ttu-id="6bf99-122">Si la instancia del servidor especificada está disponible y es la instancia del servidor principal actual, el intento de conexión suele tener éxito.</span><span class="sxs-lookup"><span data-stu-id="6bf99-122">If the specified server instance is available and is the current principal server instance, the connection attempt typically succeeds.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6bf99-123">Si la sesión de creación de reflejo se pone en pausa, el cliente suele conectarse al servidor principal y descargar el nombre del asociado.</span><span class="sxs-lookup"><span data-stu-id="6bf99-123">If the mirroring session is paused, the client typically connects to the principal server and the downloads the partner name.</span></span> <span data-ttu-id="6bf99-124">Sin embargo, la base de datos no está disponible para el cliente hasta que se reanude la creación de reflejo.</span><span class="sxs-lookup"><span data-stu-id="6bf99-124">However, the database is unavailable to the client until mirroring resumes.</span></span>  
  
 <span data-ttu-id="6bf99-125">Si ese intento no funciona, el proveedor de acceso a datos prueba con el nombre del asociado de conmutación por error, si está disponible.</span><span class="sxs-lookup"><span data-stu-id="6bf99-125">If that attempt does not work, the data access provider tries the failover partner name, if available.</span></span> <span data-ttu-id="6bf99-126">Si otro nombre del asociado identifica correctamente el servidor principal actual, el proveedor de acceso a datos normalmente puede abrir la conexión inicial.</span><span class="sxs-lookup"><span data-stu-id="6bf99-126">If either partner name correctly identifies the current principal server, the data access provider normally succeeds in opening the initial connection.</span></span> <span data-ttu-id="6bf99-127">Al llevar a cabo esta conexión, el proveedor de acceso a datos descarga el nombre de la instancia del servidor del servidor reflejado actual.</span><span class="sxs-lookup"><span data-stu-id="6bf99-127">On completing this connection, the data access provider downloads the server instance name of the current mirror server.</span></span> <span data-ttu-id="6bf99-128">Este nombre se almacena en la caché como nombre del asociado de conmutación por error y sobrescribe el nombre proporcionado por el cliente, si hay alguno.</span><span class="sxs-lookup"><span data-stu-id="6bf99-128">This name is stored in the cache as the failover partner name, overwriting the client-supplied failover partner name, if any.</span></span> <span data-ttu-id="6bf99-129">Después, el Proveedor de datos de .NET Framework de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] no actualiza el nombre del asociado de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="6bf99-129">Thereafter, the .NET Framework Data Provider for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] does not update the failover partner name.</span></span> <span data-ttu-id="6bf99-130">Por el contrario, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client actualiza la caché siempre que una conexión posterior o el restablecimiento de la conexión devuelvan un nombre del asociado diferente.</span><span class="sxs-lookup"><span data-stu-id="6bf99-130">In contrast, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client updates the cache whenever a subsequent connection or connection reset returns a different partner name.</span></span>  
  
 <span data-ttu-id="6bf99-131">En la siguiente ilustración se muestra una conexión del cliente con el asociado inicial, **Partner_A**, para una base de datos reflejada denominada **Db_1**.</span><span class="sxs-lookup"><span data-stu-id="6bf99-131">The following figure illustrates a client connection to the initial partner, **Partner_A**, for a mirrored database named **Db_1**.</span></span> <span data-ttu-id="6bf99-132">En la ilustración se muestra un caso en el que el nombre del asociado inicial proporcionado por el cliente identifica correctamente el servidor principal actual, **Partner_A**.</span><span class="sxs-lookup"><span data-stu-id="6bf99-132">This figure shows a case in which the initial partner name supplied by the client correctly identifies the current principal server, **Partner_A**.</span></span> <span data-ttu-id="6bf99-133">El intento de conexión inicial se realiza correctamente y el proveedor de acceso a datos almacena el nombre del servidor reflejado ( **Partner_B**) como nombre del asociado de conmutación por error en la memoria caché local.</span><span class="sxs-lookup"><span data-stu-id="6bf99-133">The initial connection attempt succeeds, and the data access provider stores the name of the mirror server (currently **Partner_B**) as the failover partner name in the local cache.</span></span> <span data-ttu-id="6bf99-134">Finalmente, el cliente se conecta a la copia principal de la base de datos **Db_1** .</span><span class="sxs-lookup"><span data-stu-id="6bf99-134">Finally, the client connects to the principal copy of the **Db_1** database.</span></span>  
  
 <span data-ttu-id="6bf99-135">![Conexión de cliente si el asociado inicial es una entidad principal](../media/dbm-initial-connection.gif "Conexión de cliente si el asociado inicial es una entidad principal")</span><span class="sxs-lookup"><span data-stu-id="6bf99-135">![Client connection if initial partner is principal](../media/dbm-initial-connection.gif "Client connection if initial partner is principal")</span></span>  
  
 <span data-ttu-id="6bf99-136">El intento de conexión inicial puede no tener éxito, por ejemplo, debido a un error de red o una instancia del servidor inactiva.</span><span class="sxs-lookup"><span data-stu-id="6bf99-136">The initial connection attempt may fail, for example, because of a network error or an inactive server instance.</span></span> <span data-ttu-id="6bf99-137">Puesto que el asociado inicial no está disponible, para que el proveedor de acceso a datos intente conectarse al asociado de conmutación por error, el cliente deberá haber proporcionado el nombre del asociado de conmutación por error en la cadena de conexión.</span><span class="sxs-lookup"><span data-stu-id="6bf99-137">Because the initial partner is unavailable, for the data access provider to attempt to connect to the failover partner, the client must have supplied the failover partner name in the connection string.</span></span>  
  
 <span data-ttu-id="6bf99-138">En ese caso, si el nombre del asociado de conmutación por error no está disponible, el intento de conexión original continúa hasta que la conexión de red agota el tiempo de espera o se devuelve un error (igual que en una base de datos no reflejada).</span><span class="sxs-lookup"><span data-stu-id="6bf99-138">In that case, if the failover partner name is unavailable, the original connection attempt continues until the network connection timeout or an error is returned (just as for a non-mirrored database).</span></span>  
  
 <span data-ttu-id="6bf99-139">Cuando en la cadena de conexión se proporciona el nombre del asociado de conmutación por error, el comportamiento del proveedor de acceso a datos depende del protocolo de red y del sistema operativo del cliente, según se explica a continuación:</span><span class="sxs-lookup"><span data-stu-id="6bf99-139">When the failover partner name is supplied in the connection string, the behavior of the data access provider depends on the network protocol and operating system of the client, as follows:</span></span>  
  
-   <span data-ttu-id="6bf99-140">Para TCP/IP, los intentos de conexión son regulados mediante un algoritmo de reintento de conexión que es específico de la creación de reflejo de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="6bf99-140">For TCP/IP, the connection attempts are regulated by a connection retry algorithm that is specific to database mirroring.</span></span> <span data-ttu-id="6bf99-141">El *algoritmo de reintento de conexión* determina el tiempo máximo (el *tiempo de reintento*) asignado para abrir una conexión en un intento de conexión dado.</span><span class="sxs-lookup"><span data-stu-id="6bf99-141">The *connection retry algorithm* determines the maximum time (the *retry time*) allotted for opening a connection in a given connection attempt.</span></span>  
  
-   <span data-ttu-id="6bf99-142">Para otros protocolos de red</span><span class="sxs-lookup"><span data-stu-id="6bf99-142">For other network protocols</span></span>  
  
     <span data-ttu-id="6bf99-143">Si se produce un error o si el asociado inicial no está disponible, el intento de conexión inicial espera hasta que los períodos de tiempo de espera de la conexión de red o del inicio de sesión expiran en el proveedor de acceso a datos.</span><span class="sxs-lookup"><span data-stu-id="6bf99-143">If an error occurs or if the initial partner is unavailable, the initial connection attempt waits until the network connection timeout period expires or the login timeout period expires on the data access provider.</span></span> <span data-ttu-id="6bf99-144">Generalmente, esta espera es del orden de 20 a 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="6bf99-144">Typically, this wait is on the order of 20 to 30 seconds.</span></span> <span data-ttu-id="6bf99-145">Después, si el proveedor de acceso a datos no ha agotado el tiempo de espera, intenta conectarse al asociado de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="6bf99-145">Thereafter, if the data access provider has not timed out, it attempts to connect to the failover partner.</span></span> <span data-ttu-id="6bf99-146">Si el período de tiempo de espera de conmutación por error expira antes de que la conexión tenga éxito o si el asociado de conmutación por error no está disponible, el intento de conexión no tiene éxito.</span><span class="sxs-lookup"><span data-stu-id="6bf99-146">If the connection timeout period expires before the connection succeeds or the failover partner is unavailable, the connection attempt fails.</span></span> <span data-ttu-id="6bf99-147">Si el asociado de conmutación por error está disponible dentro del período de tiempo de espera de inicio de sesión y es ahora el servidor principal, el intento de conexión normalmente tiene éxito.</span><span class="sxs-lookup"><span data-stu-id="6bf99-147">If failover partner is available within the login timeout period and is now the principal server, the connection attempt normally succeeds.</span></span>  

  
### <a name="connection-strings-for-a-mirrored-database"></a><span data-ttu-id="6bf99-148">Cadenas de conexión para una base de datos reflejada</span><span class="sxs-lookup"><span data-stu-id="6bf99-148">Connection Strings for a Mirrored Database</span></span>  
 <span data-ttu-id="6bf99-149">La cadena de conexión proporcionada por el cliente incluye información que el proveedor de acceso a datos usa para conectarse a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="6bf99-149">The connection string supplied by the client contains information that the data access provider uses to connect to the database.</span></span> <span data-ttu-id="6bf99-150">En esta sección se explican las palabras clave que están relacionadas específicamente con la conexión a una base de datos reflejada mediante una conexión del controlador ODBC de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client.</span><span class="sxs-lookup"><span data-stu-id="6bf99-150">This section discusses the keywords that are specifically relevant for connecting to a mirrored database using a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC Driver Connection.</span></span>  
  
#### <a name="network-attribute"></a><span data-ttu-id="6bf99-151">Atributo Network</span><span class="sxs-lookup"><span data-stu-id="6bf99-151">Network Attribute</span></span>  
 <span data-ttu-id="6bf99-152">La cadena de conexión debe contener el atributo **Network** para especificar el protocolo de red.</span><span class="sxs-lookup"><span data-stu-id="6bf99-152">The connection string should contain the **Network** attribute to specify the network protocol.</span></span> <span data-ttu-id="6bf99-153">De este modo se asegura de que el protocolo de red especificado persiste entre conexiones a asociados diferentes.</span><span class="sxs-lookup"><span data-stu-id="6bf99-153">This ensures that the specified network protocol persists between connections to different partners.</span></span> <span data-ttu-id="6bf99-154">El mejor protocolo para conectarse a una base de datos reflejada es TCP/IP.</span><span class="sxs-lookup"><span data-stu-id="6bf99-154">The best protocol for connecting to a mirrored database is TCP/IP.</span></span> <span data-ttu-id="6bf99-155">Para garantizar que el cliente solicite TCP/IP para cada conexión con los asociados, una cadena de conexión proporciona el atributo siguiente:</span><span class="sxs-lookup"><span data-stu-id="6bf99-155">To ensure that the client requests TCP/IP for every connection to the partners, a connection string supplies the following attribute:</span></span>  
  
```  
Network=dbmssocn;   
```  
  
> [!IMPORTANT]  
>  <span data-ttu-id="6bf99-156">Se recomienda mantener TCP/IP al principio de la lista de protocolos del cliente.</span><span class="sxs-lookup"><span data-stu-id="6bf99-156">We recommend keeping TCP/IP at the top of a client's protocol list.</span></span> <span data-ttu-id="6bf99-157">Sin embargo, si la cadena de conexión especifica el atributo **Network** , se invalida el orden de la lista.</span><span class="sxs-lookup"><span data-stu-id="6bf99-157">However, if the connection string specifies the **Network** attribute, this overrides the list order.</span></span>  
  
 <span data-ttu-id="6bf99-158">O bien, para garantizar que el cliente solicite canalizaciones con nombre para cada conexión a los asociados, una cadena de conexión proporciona el atributo siguiente:</span><span class="sxs-lookup"><span data-stu-id="6bf99-158">Alternatively, to ensure that the client requests named pipes for every connection to the partners, a connection string supplies the following attribute:</span></span>  
  
```  
Network=dbnmpntw;   
```  
  
> [!IMPORTANT]  
>  <span data-ttu-id="6bf99-159">Dado que las canalizaciones con nombre no usan el algoritmo de reintento TCP/IP, en muchos casos, un intento de conexión a canalizaciones con nombre puede agotar el tiempo de espera antes de conectarse a una base de datos reflejada.</span><span class="sxs-lookup"><span data-stu-id="6bf99-159">Because named pipes does not use the TCP/IP retry algorithm, in many cases, a named pipes connection attempt may time out before connecting to a mirrored database.</span></span>  
  
#### <a name="server-attribute"></a><span data-ttu-id="6bf99-160">Atributo Server</span><span class="sxs-lookup"><span data-stu-id="6bf99-160">Server Attribute</span></span>  
 <span data-ttu-id="6bf99-161">La cadena de conexión debe contener un atributo `Server` que proporciona el nombre del asociado inicial, que debería identificar la instancia del servidor principal actual.</span><span class="sxs-lookup"><span data-stu-id="6bf99-161">The connection string must contain a `Server` attribute that supplies the initial partner name, which should identify the current principal server instance.</span></span>  
  
 <span data-ttu-id="6bf99-162">La manera más sencilla de identificar la instancia de servidor es especificando su nombre, *<nombre_de_servidor>* [ **\\** _<nombre_de_instancia_de_SQL_Server>_ ].</span><span class="sxs-lookup"><span data-stu-id="6bf99-162">The simplest way to identify the server instance is by specifying its name , *<server_name>*[**\\**_<SQL_Server_instance_name>_].</span></span> <span data-ttu-id="6bf99-163">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="6bf99-163">For example:</span></span>  
  
 `Server=Partner_A;`  
  
 <span data-ttu-id="6bf99-164">or</span><span class="sxs-lookup"><span data-stu-id="6bf99-164">or</span></span>  
  
 `Server=Partner_A\Instance_2;`  
  
 <span data-ttu-id="6bf99-165">Sin embargo, cuando se usa el nombre del sistema, el cliente debe realizar una búsqueda DNS para obtener la dirección IP del servidor y una consulta de SQL Server Browser para obtener el número de puerto del servidor en el que reside el asociado.</span><span class="sxs-lookup"><span data-stu-id="6bf99-165">However, when the system name is used, the client must perform a DNS lookup to obtain the IP address of the server and a SQL Server Browser query to obtain the port number of the server on which the partner resides.</span></span> <span data-ttu-id="6bf99-166">Estas búsquedas y consultas pueden omitirse si se especifica la dirección IP y el número de puerto del asociado en el atributo `Server`, en lugar de especificar el nombre de servidor.</span><span class="sxs-lookup"><span data-stu-id="6bf99-166">Those lookups and queries can be bypassed by specifying the IP address and port number of the partner in the `Server` attribute, rather than specifying the server name.</span></span> <span data-ttu-id="6bf99-167">Esto se recomienda para reducir la posibilidad de que se produzcan retardos externos mientras se conecta a ese asociado.</span><span class="sxs-lookup"><span data-stu-id="6bf99-167">This is recommended to minimize the possibility of external delays while connecting to that partner.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6bf99-168">Se necesita una consulta de SQL Server Browser si la cadena de conexión especifica el nombre de la instancia con nombre y no el puerto.</span><span class="sxs-lookup"><span data-stu-id="6bf99-168">A SQL Server Browser query is necessary if the connection string specifies the named instance name and not the port.</span></span>  
  
 <span data-ttu-id="6bf99-169">Para especificar la dirección IP y el puerto, el `Server` atributo adopta el formato siguiente, `Server=` *<ip_address>* `,` *\<port>* , por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="6bf99-169">To specify the IP address and port, the `Server` attribute takes the following form, `Server=`*<ip_address>*`,`*\<port>*, for example:</span></span>  
  
```  
Server=123.34.45.56,4724;   
```  
  
> [!NOTE]  
>  <span data-ttu-id="6bf99-170">La dirección IP puede ser IP Versión 4 (IPv4) o IP Versión 6 (IPv6).</span><span class="sxs-lookup"><span data-stu-id="6bf99-170">The IP address can be IP Version 4 (IPv4) or IP Version 6 (IPv6).</span></span>  
  
#### <a name="database-attribute"></a><span data-ttu-id="6bf99-171">Atributo Database</span><span class="sxs-lookup"><span data-stu-id="6bf99-171">Database Attribute</span></span>  
 <span data-ttu-id="6bf99-172">Además, la cadena de conexión debe especificar el atributo `Database` para proporcionar el nombre de la base de datos reflejada.</span><span class="sxs-lookup"><span data-stu-id="6bf99-172">In addition, the connection string must specify the `Database` attribute to supply the name of the mirrored database.</span></span> <span data-ttu-id="6bf99-173">Si la base de datos no está disponible cuando el cliente intente conectarse, se producirá una excepción.</span><span class="sxs-lookup"><span data-stu-id="6bf99-173">If the database is unavailable when the client attempts to connect, an exception is raised.</span></span>  
  
 <span data-ttu-id="6bf99-174">Por ejemplo, para conectarse expresamente a la base de datos **AdventureWorks** del servidor principal Partner_A, un cliente usa la cadena de conexión siguiente:</span><span class="sxs-lookup"><span data-stu-id="6bf99-174">For example, to expressly connect to the **AdventureWorks** database on the principal server Partner_A, a client uses the following connection string:</span></span>  
  
 `" Server=Partner_A; Database=AdventureWorks "`  
  
> [!NOTE]  
>  <span data-ttu-id="6bf99-175">En esta cadena se omite la información de autenticación.</span><span class="sxs-lookup"><span data-stu-id="6bf99-175">This string omits authentication information.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="6bf99-176">La agrupación del prefijo de protocolo con el `Server` atributo ( `Server=tcp:` *\<servername>* ) es incompatible con el atributo **Network** , y si se especifica el protocolo en ambos lugares, es probable que se produzca un error.</span><span class="sxs-lookup"><span data-stu-id="6bf99-176">Bundling the protocol prefix with the `Server` attribute (`Server=tcp:`*\<servername>*) is incompatible with the **Network** attribute, and specifying the protocol in both places will likely result in an error.</span></span> <span data-ttu-id="6bf99-177">Por lo tanto, se recomienda que una cadena de conexión especifique el protocolo con el atributo **Network** y especifique solo el nombre del servidor en el `Server` atributo ( `"Network=dbmssocn; Server=` *\<servername>* `"` ).</span><span class="sxs-lookup"><span data-stu-id="6bf99-177">Therefore, we recommend that a connection string specify the protocol using the **Network** attribute and specify only the server name in the `Server` attribute (`"Network=dbmssocn; Server=`*\<servername>*`"`).</span></span>  
  
#### <a name="failover-partner-attribute"></a><span data-ttu-id="6bf99-178">Atributo Failover Partner</span><span class="sxs-lookup"><span data-stu-id="6bf99-178">Failover Partner Attribute</span></span>  
 <span data-ttu-id="6bf99-179">Además del nombre del asociado inicial, el cliente puede especificar también el nombre del asociado de conmutación por error, que debería identificar la instancia del servidor reflejado actual.</span><span class="sxs-lookup"><span data-stu-id="6bf99-179">In addition to the initial partner name, the client can also specify failover partner name, which should identify the current mirror server instance.</span></span> <span data-ttu-id="6bf99-180">Una de las palabras clave especifica el asociado de conmutación por error para el atributo de asociado de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="6bf99-180">The failover partner is specified by one of the keywords for the failover partner attribute.</span></span> <span data-ttu-id="6bf99-181">La palabra clave para este atributo depende de la API que está utilizando.</span><span class="sxs-lookup"><span data-stu-id="6bf99-181">The keyword for this attribute depends on the API that you are using.</span></span> <span data-ttu-id="6bf99-182">En la tabla siguiente se enumeran estas palabras clave.</span><span class="sxs-lookup"><span data-stu-id="6bf99-182">The following table lists these keywords:</span></span>  
  
|<span data-ttu-id="6bf99-183">API</span><span class="sxs-lookup"><span data-stu-id="6bf99-183">API</span></span>|<span data-ttu-id="6bf99-184">Palabra clave para el atributo de asociado de conmutación por error</span><span class="sxs-lookup"><span data-stu-id="6bf99-184">Keyword for failover partner attribute</span></span>|  
|---------|--------------------------------------------|  
|<span data-ttu-id="6bf99-185">Proveedor OLE DB</span><span class="sxs-lookup"><span data-stu-id="6bf99-185">OLE DB Provider</span></span>|`FailoverPartner`|  
|<span data-ttu-id="6bf99-186">Controlador ODBC</span><span class="sxs-lookup"><span data-stu-id="6bf99-186">ODBC Driver</span></span>|`Failover_Partner`|  
|<span data-ttu-id="6bf99-187">Objetos de datos ActiveX (ADO)</span><span class="sxs-lookup"><span data-stu-id="6bf99-187">ActiveX Data Objects (ADO)</span></span>|`Failover Partner`|  
  
 <span data-ttu-id="6bf99-188">La manera más sencilla de identificar la instancia de servidor es especificando su nombre de sistema, *<nombre_de_servidor>* [ **\\** _<nombre_de_instancia_de_SQL_Server>_ ].</span><span class="sxs-lookup"><span data-stu-id="6bf99-188">The simplest way to identify the server instance is by its system name, *<server_name>*[**\\**_<SQL_Server_instance_name>_].</span></span>  
  
 <span data-ttu-id="6bf99-189">O bien, la dirección IP y el número de puerto pueden proporcionarse en el atributo `Failover Partner`.</span><span class="sxs-lookup"><span data-stu-id="6bf99-189">Alternatively, the IP address and port number can be supplied in the `Failover Partner` attribute.</span></span> <span data-ttu-id="6bf99-190">Si el intento de conexión inicial no tiene éxito durante la primera conexión a la base de datos, el intento de conectarse al asociado de conmutación por error no tendrá que retransmitirse en DNS y SQL Server Browser.</span><span class="sxs-lookup"><span data-stu-id="6bf99-190">If the initial connection attempt fails during the first connection to the database, the attempt to connect to the failover partner will be freed from relying on DNS and SQL Server Browser.</span></span> <span data-ttu-id="6bf99-191">Una vez que se establezca la conexión, el nombre del asociado de conmutación por error se sobrescribirá con el nombre del asociado de conmutación por error, de modo que, si se produce una conmutación por error, las conexiones redirigidas requerirán DNS y SQL Server Browser.</span><span class="sxs-lookup"><span data-stu-id="6bf99-191">Once a connection is established, the failover partner name will be overwritten with the failover partner name, so if a failover occurs, the redirected connections will require DNS and SQL Server Browser.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6bf99-192">Si solo se proporciona el nombre del asociado inicial, los programadores de la aplicación no necesitarán realizar ninguna acción ni escribir ningún código para volver a conectarse.</span><span class="sxs-lookup"><span data-stu-id="6bf99-192">When only the initial partner name is provided, application developers do not need to take any action or write any code except about how to reconnect.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6bf99-193">Los programadores de aplicaciones de código administrado proporcionan el nombre del asociado de conmutación por error en la cadena `ConnectionString` del objeto `SqlConnection`.</span><span class="sxs-lookup"><span data-stu-id="6bf99-193">Managed code application developers supply the failover partner name in the `ConnectionString` of the `SqlConnection` object.</span></span> <span data-ttu-id="6bf99-194">Para obtener información acerca de cómo utilizar esta cadena de conexión, vea el apartado sobre la compatibilidad de la creación de reflejo de la base de datos del proveedor de datos de .NET Framework para SQL Server en la documentación de ADO.NET, que forma parte del SDK de [!INCLUDE[msCoName](../../includes/msconame-md.md)] .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="6bf99-194">For information on using this connection string, see "Database Mirroring Support in the .NET Framework Data Provider for SQL Server" in the ADO.NET documentation, which is part of the [!INCLUDE[msCoName](../../includes/msconame-md.md)] .NET Framework SDK.</span></span>  
  
#### <a name="example-connection-string"></a><span data-ttu-id="6bf99-195">Ejemplo de cadena de conexión</span><span class="sxs-lookup"><span data-stu-id="6bf99-195">Example Connection String</span></span>  
 <span data-ttu-id="6bf99-196">Por ejemplo, para conectarse explícitamente con TCP/IP a la base de datos **AdventureWorks** en Partner_A o Partner_B, una aplicación cliente que use el controlador ODBC podría proporcionar la cadena de conexión siguiente:</span><span class="sxs-lookup"><span data-stu-id="6bf99-196">For example, to explicitly connect using TCP/IP to the **AdventureWorks** database on either Partner_A or Partner_B, a client application that uses the ODBC Driver could supply the following connection string:</span></span>  
  
```  
"Server=Partner_A; Failover_Partner=Partner_B; Database=AdventureWorks; Network=dbmssocn"  
```  
  
 <span data-ttu-id="6bf99-197">O bien, el cliente podría usar la dirección IP y el número de puerto para identificar al asociado inicial, Partner_A; por ejemplo, si la dirección IP es 250.65.43.21 y el número de puerto es 4734, la cadena de conexión sería:</span><span class="sxs-lookup"><span data-stu-id="6bf99-197">Alternatively, the client could use the IP address and port number to identify the initial partner, Partner_A; for example, if the IP address is 250.65.43.21 and the port number is 4734, the connection string would be:</span></span>  
  
```  
"Server=250.65.43.21,4734; Failover_Partner=Partner_B; Database=AdventureWorks; Network=dbmssocn"  
```  
  
##  <a name="connection-retry-algorithm-for-tcpip-connections"></a><a name="RetryAlgorithm"></a> <span data-ttu-id="6bf99-198">Algoritmo de reintento de conexión (para conexiones TCP/IP)</span><span class="sxs-lookup"><span data-stu-id="6bf99-198">Connection Retry Algorithm (for TCP/IP Connections)</span></span>  
 <span data-ttu-id="6bf99-199">Para una conexión TCP/IP, cuando los nombres de ambos asociados están en la memoria caché, el proveedor de acceso a datos se ajusta a un algoritmo de reintento de conexión.</span><span class="sxs-lookup"><span data-stu-id="6bf99-199">For a TCP/IP connection, when both partner names are in the cache, the data access provider adheres to a connection retry algorithm.</span></span> <span data-ttu-id="6bf99-200">Esto se cumple para establecer la conexión inicial a la sesión y para volver a conectarse después de que una conexión establecida se haya perdido.</span><span class="sxs-lookup"><span data-stu-id="6bf99-200">This is true both for making the initial connection to the session and for reconnecting after losing an established connection.</span></span> <span data-ttu-id="6bf99-201">Una vez que se ha abierto una conexión, finalizar los pasos previos de inicio de sesión y el inicio de sesión requiere tiempo adicional.</span><span class="sxs-lookup"><span data-stu-id="6bf99-201">Once a connection has been opened, completing the pre-login and login steps takes additional time.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6bf99-202">El tiempo empleado en abrir una conexión puede superar el tiempo de reintento debido a factores externos como, por ejemplo, lentas búsquedas de DNS, un controlador de dominio/KDC (Kerberos Key Distribution Center) lento, el tiempo necesario para contactar con SQL Server Browser, congestión de la red, etc.</span><span class="sxs-lookup"><span data-stu-id="6bf99-202">The time spent in opening a connection can exceed the retry time because of external factors, such as slow DNS lookups, slow domain controller/Kerberos Key Distribution Center (KDC), time spent contacting SQL Server Browser, network congestion, and so forth.</span></span> <span data-ttu-id="6bf99-203">Estos factores externos pueden impedir que un cliente se conecte a una base de datos reflejada.</span><span class="sxs-lookup"><span data-stu-id="6bf99-203">Such external factors can prevent a client from connecting to a mirrored database.</span></span> <span data-ttu-id="6bf99-204">Además, los factores externos pueden hacer que una conexión tarde más en abrirse que el tiempo de reintento asignado.</span><span class="sxs-lookup"><span data-stu-id="6bf99-204">Also, external factors can cause a connection to take longer to open than the allotted retry time.</span></span> <span data-ttu-id="6bf99-205">Para obtener información acerca de cómo omitir DNS y SQL Server Browser para el intento de conexión al asociado inicial, vea [Establecer la conexión inicial en una sesión de creación de reflejo de la base de datos](#InitialConnection), anteriormente en este tema.</span><span class="sxs-lookup"><span data-stu-id="6bf99-205">For information on bypassing DNS and SQL Server Browser for connection attempt to the initial partner, see [Making the Initial Connection to a Database Mirroring Session](#InitialConnection), earlier in this topic.</span></span>  
  
 <span data-ttu-id="6bf99-206">Si el intento de conexión genera un error o el tiempo de reintento expira antes de que se realice correctamente, el proveedor de acceso a datos probará con el otro asociado.</span><span class="sxs-lookup"><span data-stu-id="6bf99-206">If a connection attempt fails or the retry time expires before it succeeds, the data access provider tries the other partner.</span></span> <span data-ttu-id="6bf99-207">Si este punto no abre una conexión, el proveedor probará, de forma alternativa, con los nombre inicial y del asociado de conmutación por error, hasta que se abra una conexión o el periodo de inicio de sesión se agote. El periodo de tiempo de espera predeterminado es de 15 segundos.</span><span class="sxs-lookup"><span data-stu-id="6bf99-207">If a connection is not opened by this point, the provider alternately tries the initial and failover partner names, until a connection is opened or the login period times out. The default login time-out period is 15 seconds.</span></span> <span data-ttu-id="6bf99-208">Es recomendable que el periodo de espera de inicio de sesión sea de 5 segundos o más.</span><span class="sxs-lookup"><span data-stu-id="6bf99-208">We recommend that the login time-out period be at least 5 seconds.</span></span> <span data-ttu-id="6bf99-209">Si se especifica un periodo de tiempo de espera menor, es posible que ningún intento de conexión pueda realizarse correctamente.</span><span class="sxs-lookup"><span data-stu-id="6bf99-209">Specifying a smaller time-out period might prevent any of the connection attempts from succeeding.</span></span>  
  
 <span data-ttu-id="6bf99-210">El tiempo de reintento es un porcentaje del periodo de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="6bf99-210">The retry time is a percentage of the login period.</span></span> <span data-ttu-id="6bf99-211">El tiempo de reintento de una conexión es mayor en cada ciclo sucesivo.</span><span class="sxs-lookup"><span data-stu-id="6bf99-211">The retry time for a connection attempt is larger in each successive round.</span></span> <span data-ttu-id="6bf99-212">En el primer ciclo, el tiempo de reintento de cada uno de los dos intentos es el 8 por ciento del periodo de inicio de sesión total.</span><span class="sxs-lookup"><span data-stu-id="6bf99-212">In the first round, the retry time for each of the two attempts is 8 percent of the total login period.</span></span> <span data-ttu-id="6bf99-213">En cada ciclo sucesivo, el algoritmo de reintento incrementa el tiempo máximo de reintento en la misma cantidad.</span><span class="sxs-lookup"><span data-stu-id="6bf99-213">In each successive round, the retry algorithm increases the maximum retry time by the same amount.</span></span> <span data-ttu-id="6bf99-214">De esta forma, los tiempos de reintento de las primeras ocho conexiones son las siguientes:</span><span class="sxs-lookup"><span data-stu-id="6bf99-214">Thus, the retry times for the first eight connection attempts is as follows:</span></span>  
  
 <span data-ttu-id="6bf99-215">8%, 8%, 16%, 16%, 24%, 24%, 32%, 32%</span><span class="sxs-lookup"><span data-stu-id="6bf99-215">8%, 8%, 16%, 16%, 24%, 24%, 32%, 32%</span></span>  
  
 <span data-ttu-id="6bf99-216">El tiempo de reintento se calcula mediante la siguiente fórmula:</span><span class="sxs-lookup"><span data-stu-id="6bf99-216">The retry time is calculated using the following formula:</span></span>  
  
 <span data-ttu-id="6bf99-217">_RetryTime_ **=** _PreviousRetryTime_ **+(** 0.08 **&#42;** _LoginTimeout_ **)**</span><span class="sxs-lookup"><span data-stu-id="6bf99-217">_RetryTime_ **=** _PreviousRetryTime_ **+(** 0.08 **&#42;**_LoginTimeout_**)**</span></span>  
  
 <span data-ttu-id="6bf99-218">Donde *PreviousRetryTime* es inicialmente 0.</span><span class="sxs-lookup"><span data-stu-id="6bf99-218">Where *PreviousRetryTime* is initially 0.</span></span>  
  
 <span data-ttu-id="6bf99-219">Por ejemplo, si se usa el tiempo de espera predeterminado de 15 segundos, *LoginTimeout* *= 15*.</span><span class="sxs-lookup"><span data-stu-id="6bf99-219">For example, if using the default login time-out period of 15 seconds, *LoginTimeout* *= 15*.</span></span> <span data-ttu-id="6bf99-220">En este caso, los tiempos de reintento en los primeros tres ciclos son los siguientes:</span><span class="sxs-lookup"><span data-stu-id="6bf99-220">In this case, the retry times allotted in the first three rounds are as follows:</span></span>  
  
|<span data-ttu-id="6bf99-221">Round</span><span class="sxs-lookup"><span data-stu-id="6bf99-221">Round</span></span>|<span data-ttu-id="6bf99-222">Cálculo de*RetryTime*</span><span class="sxs-lookup"><span data-stu-id="6bf99-222">*RetryTime* calculation</span></span>|<span data-ttu-id="6bf99-223">Tiempo de reintento por intento</span><span class="sxs-lookup"><span data-stu-id="6bf99-223">Retry time per attempt</span></span>|  
|-----------|-----------------------------|----------------------------|  
|<span data-ttu-id="6bf99-224">1</span><span class="sxs-lookup"><span data-stu-id="6bf99-224">1</span></span>|<span data-ttu-id="6bf99-225">0 **+(** 0,08 **&#42;** 15 **)**</span><span class="sxs-lookup"><span data-stu-id="6bf99-225">0 **+(** 0.08 **&#42;** 15 **)**</span></span>|<span data-ttu-id="6bf99-226">1,2 segundos</span><span class="sxs-lookup"><span data-stu-id="6bf99-226">1.2 seconds</span></span>|  
|<span data-ttu-id="6bf99-227">2</span><span class="sxs-lookup"><span data-stu-id="6bf99-227">2</span></span>|<span data-ttu-id="6bf99-228">1,2 **+(** 0,08 **&#42;** 15 **)**</span><span class="sxs-lookup"><span data-stu-id="6bf99-228">1.2 **+(** 0.08 **&#42;** 15 **)**</span></span>|<span data-ttu-id="6bf99-229">2,4 segundos</span><span class="sxs-lookup"><span data-stu-id="6bf99-229">2.4 seconds</span></span>|  
|<span data-ttu-id="6bf99-230">3</span><span class="sxs-lookup"><span data-stu-id="6bf99-230">3</span></span>|<span data-ttu-id="6bf99-231">2,4 **+(** 0,08 **&#42;** 15 **)**</span><span class="sxs-lookup"><span data-stu-id="6bf99-231">2.4 **+(** 0.08 **&#42;** 15 **)**</span></span>|<span data-ttu-id="6bf99-232">3,6 segundos</span><span class="sxs-lookup"><span data-stu-id="6bf99-232">3.6 seconds</span></span>|  
|<span data-ttu-id="6bf99-233">4</span><span class="sxs-lookup"><span data-stu-id="6bf99-233">4</span></span>|<span data-ttu-id="6bf99-234">3,6 **+(** 0,08 **&#42;** 15 **)**</span><span class="sxs-lookup"><span data-stu-id="6bf99-234">3.6 **+(** 0.08 **&#42;** 15 **)**</span></span>|<span data-ttu-id="6bf99-235">4,8 segundos</span><span class="sxs-lookup"><span data-stu-id="6bf99-235">4.8 seconds</span></span>|   
  
 <span data-ttu-id="6bf99-236">En la siguiente ilustración se muestran los tiempos de reintento para intentos de conexión sucesivos, cada uno de los cuales se agota.</span><span class="sxs-lookup"><span data-stu-id="6bf99-236">The following figure illustrates these retry times for successive connection attempts, each of which times out.</span></span>  
  
 <span data-ttu-id="6bf99-237">![Número máximo de intervalos entre reintentos para un tiempo de espera de inicio de sesión de 15 segundos](../media/dbm-retry-algorithm.gif "Número máximo de intervalos entre reintentos para un tiempo de espera de inicio de sesión de 15 segundos")</span><span class="sxs-lookup"><span data-stu-id="6bf99-237">![Maximum retry delays for 15 second login timeout](../media/dbm-retry-algorithm.gif "Maximum retry delays for 15 second login timeout")</span></span>  
  
 <span data-ttu-id="6bf99-238">Para el periodo de espera de inicio de sesión predeterminado, el tiempo máximo asignado para los primeros tres ciclos de intentos de conexión es de 14,4 segundos.</span><span class="sxs-lookup"><span data-stu-id="6bf99-238">For the default login time-out period, the maximum time allotted to the first three rounds of connection attempts is 14.4 seconds.</span></span> <span data-ttu-id="6bf99-239">Si cada intento utilizase todo el tiempo que tiene asignado, solo quedarían 0,6 segundos antes de que el periodo de inicio de sesión se agotara. En este caso, el cuarto ciclo se acortaría y solo se permitiría un intento final rápido para conectarse mediante el nombre del asociado inicial.</span><span class="sxs-lookup"><span data-stu-id="6bf99-239">If every attempt were to use all of its allotted time, only 0.6 seconds of time would remain before the login period times out. In that case, the fourth round would be curtailed, allowing only a final quick attempt to connect using the initial partner name.</span></span> <span data-ttu-id="6bf99-240">No obstante, un intento de conexión puede generar un error en menos tiempo que el tiempo de reintento asignado, especialmente en los ciclos posteriores.</span><span class="sxs-lookup"><span data-stu-id="6bf99-240">However, a connection attempt may fail in less than its allotted retry time, particularly in later rounds.</span></span> <span data-ttu-id="6bf99-241">Por ejemplo, la recepción de un error de red puede causar que un intento termine antes de que el tiempo de reintento expire.</span><span class="sxs-lookup"><span data-stu-id="6bf99-241">For example, receiving a network error can cause an attempt to end before the retry time expires.</span></span> <span data-ttu-id="6bf99-242">Si los primeros intentos no se realizan correctamente debido a errores de red, habría tiempo disponible adicional para el cuarto ciclo y, probablemente, para ciclos adicionales.</span><span class="sxs-lookup"><span data-stu-id="6bf99-242">If earlier attempts fail due to a network error, additional time would be available for the fourth round and, perhaps, additional rounds.</span></span>  
  
 <span data-ttu-id="6bf99-243">Otra razón de que un intento genere un error es una instancia de servidor inactiva, como pasa cuando una instancia de servidor se encuentra ocupada en realizar la conmutación por error de su base de datos.</span><span class="sxs-lookup"><span data-stu-id="6bf99-243">Another cause of a failed attempt is an inactive server instance, as occurs when a server instance is engaged in failing over its database.</span></span> <span data-ttu-id="6bf99-244">En este caso, se impone un intervalo entre reintentos para evitar que los clientes sobrecarguen a los asociados con una rápida sucesión de intentos de conexión.</span><span class="sxs-lookup"><span data-stu-id="6bf99-244">In this case, a retry delay is imposed to prevent clients from overloading the partners with a rapid succession of connection attempts.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6bf99-245">Cuando ambos nombres de asociados están disponibles, si el periodo de espera de inicio de sesión es infinito, el cliente intenta volver a conectarse a los servidores de forma indefinida, alternando entre el nombre del asociado inicial y el nombre del asociado de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="6bf99-245">When both partner names are available, if the login time-out period is infinite, the client attempts to reconnect to the servers indefinitely, alternating between the initial partner name and the failover partner name.</span></span>  
<span data-ttu-id="6bf99-246">)</span><span class="sxs-lookup"><span data-stu-id="6bf99-246">)</span></span>  
  
### <a name="retry-delays-during-failover"></a><span data-ttu-id="6bf99-247">Intervalos de reintento durante la conmutación por error</span><span class="sxs-lookup"><span data-stu-id="6bf99-247">Retry Delays During Failover</span></span>  
 <span data-ttu-id="6bf99-248">Si un cliente intenta conectarse a un asociado que está en conmutación por error, este responde inmediatamente que se encuentra inactivo.</span><span class="sxs-lookup"><span data-stu-id="6bf99-248">If a client attempts to connect to a partner that is failing over, the partner immediately responds that it is inactive.</span></span> <span data-ttu-id="6bf99-249">En este caso, cada ciclo de intentos de conexión es mucho más breve que el tiempo de reintento asignado.</span><span class="sxs-lookup"><span data-stu-id="6bf99-249">In this case, each round of connection attempts are much briefer than the allotted retry time.</span></span> <span data-ttu-id="6bf99-250">Esto significa que pueden producirse muchos ciclos de intentos de conexión antes de que el periodo de inicio de sesión se agote. Para evitar la sobrecarga de los asociados con una rápida serie de intentos de conexión durante una conmutación por error, el proveedor de acceso a datos agrega un breve intervalo entre reintentos después de cada ciclo.</span><span class="sxs-lookup"><span data-stu-id="6bf99-250">This means that many rounds of connection attempts could happen before the login period times out. To avoid overloading the partners with a rapid series of connection attempts during a failover, the data access provider adds a brief retry delay after each retry cycle.</span></span> <span data-ttu-id="6bf99-251">La longitud de un intervalo entre reintentos determinado se define mediante el algoritmo de intervalos entre reintentos.</span><span class="sxs-lookup"><span data-stu-id="6bf99-251">The length of a given retry delay is determined by the retry-delay algorithm.</span></span> <span data-ttu-id="6bf99-252">Después del primer ciclo, el intervalo es de 100 milisegundos.</span><span class="sxs-lookup"><span data-stu-id="6bf99-252">After the first round, the delay is 100 milliseconds.</span></span> <span data-ttu-id="6bf99-253">Después de cada uno de los tres ciclos siguientes, el intervalo entre reintentos se duplica: 200, 400 y 800.</span><span class="sxs-lookup"><span data-stu-id="6bf99-253">After each of the next three rounds, the retry delay doubles-to 200, 400, and 800.</span></span> <span data-ttu-id="6bf99-254">En todos los ciclos posteriores, el intervalo entre reintentos es de 1 segundo hasta que la conexión se realiza correctamente o se supera el tiempo de espera.</span><span class="sxs-lookup"><span data-stu-id="6bf99-254">For all later rounds, the retry delay is 1 second until the connection attempt succeeds or times out.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6bf99-255">Si la instancia de servidor se detiene, la solicitud de conexión genera un error de forma inmediata.</span><span class="sxs-lookup"><span data-stu-id="6bf99-255">If the server instance is stopped, then the connection request fails immediately.</span></span>  
  
 <span data-ttu-id="6bf99-256">En la siguiente ilustración se muestra cómo los intervalos entre reintentos afectan a los intentos de conexión durante una conmutación por error manual, donde los asociados conmutan sus roles.</span><span class="sxs-lookup"><span data-stu-id="6bf99-256">The following figure illustrates how the retry delay affects connection attempts during a manual failover, in which the partners switch their roles.</span></span> <span data-ttu-id="6bf99-257">El periodo de tiempo de espera de inicio de sesión es de 15 segundos.</span><span class="sxs-lookup"><span data-stu-id="6bf99-257">The login time-out period is 15 seconds.</span></span>  
  
 <span data-ttu-id="6bf99-258">![Algoritmo de intervalo entre reintentos](../media/dbm-retry-delay-algorithm.gif "Algoritmo de intervalo entre reintentos")</span><span class="sxs-lookup"><span data-stu-id="6bf99-258">![Retry-delay algorithm](../media/dbm-retry-delay-algorithm.gif "Retry-delay algorithm")</span></span>  
  
##  <a name="reconnecting-to-a-database-mirroring-session"></a><a name="Reconnecting"></a> <span data-ttu-id="6bf99-259">Volver a conectar una sesión de creación de reflejo de la base de datos</span><span class="sxs-lookup"><span data-stu-id="6bf99-259">Reconnecting to a Database Mirroring Session</span></span>  
 <span data-ttu-id="6bf99-260">Si una conexión establecida de una sesión de creación de reflejo de la base de datos genera un error por alguna razón; por ejemplo, debido a una conmutación automática por error, y la aplicación intenta volver a conectarse al servidor inicial, el proveedor de acceso a datos puede tratar de volver a conectarse mediante el nombre de asociado de conmutación por error almacenado en la memoria caché del cliente.</span><span class="sxs-lookup"><span data-stu-id="6bf99-260">If an established connection to a database mirroring session fails for any reason, for example, due to a database mirroring failover, and the application attempts to reconnect to the initial server, the data access provider can attempt to reconnect using the failover partner name stored in the client's cache.</span></span> <span data-ttu-id="6bf99-261">No obstante, volver a conectarse no es un proceso automático.</span><span class="sxs-lookup"><span data-stu-id="6bf99-261">Reconnecting is not automatic, however.</span></span> <span data-ttu-id="6bf99-262">La aplicación debe detectar el error.</span><span class="sxs-lookup"><span data-stu-id="6bf99-262">The application must become aware of the error.</span></span> <span data-ttu-id="6bf99-263">Después, la aplicación necesita cerrar la conexión con error y abrir una nueva utilizando los mismos atributos de la cadena de conexión.</span><span class="sxs-lookup"><span data-stu-id="6bf99-263">Then, the application needs to close the failed connection and open a new connection using the same connection string attributes.</span></span> <span data-ttu-id="6bf99-264">En este punto, el proveedor de acceso a datos redirige la conexión al asociado de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="6bf99-264">At this point, the data access provider redirects the connection to the failover partner.</span></span> <span data-ttu-id="6bf99-265">Si la instancia de servidor que se identifica con este nombre es actualmente el servidor principal, el intento de conexión suele tener éxito.</span><span class="sxs-lookup"><span data-stu-id="6bf99-265">If the server instance identified by this name is currently the principal server, the connection attempt usually succeeds.</span></span> <span data-ttu-id="6bf99-266">Si no está claro si una transacción se confirmó o revirtió, la aplicación debe comprobar el estado de la transacción, de la misma forma en que lo hace cuando se vuelve a conectar con una instancia de servidor independiente.</span><span class="sxs-lookup"><span data-stu-id="6bf99-266">If it is unclear whether a transaction was committed or rolled back, the application must check on the state of the transaction, in the same way as when reconnecting to a stand-alone server instance.</span></span>  
  
 <span data-ttu-id="6bf99-267">Volver a conectarse se parece bastante a una conexión inicial donde la cadena de conexión suministra un nombre de asociado de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="6bf99-267">Reconnecting resembles an initial connection for which the connection string supplied a failover partner name.</span></span> <span data-ttu-id="6bf99-268">Si el primer intento no tiene éxito, los intentos de conexión se alternan repetidamente entre el nombre del asociado inicial y el nombre del asociado de conmutación por error, hasta que el cliente se conecta al servidor principal o el proveedor de acceso a datos agota el tiempo de espera.</span><span class="sxs-lookup"><span data-stu-id="6bf99-268">If the first connection attempt fails, connection attempts alternate back and forth between the initial partner name and failover partner name until either the client connects to the  principal server or the data access provider times out.</span></span>  
  
> [!NOTE]  
>  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="6bf99-269">Native Client comprueba que se conecta a una instancia de servidor principal, pero no si esta instancia es el asociado de la instancia de servidor especificada en el nombre de asociado inicial de la cadena de conexión.</span><span class="sxs-lookup"><span data-stu-id="6bf99-269">Native Client verifies that it connects to a principal server instance but not whether this instance is the partner of server instance specified in the initial partner name of the connection string.</span></span>  
  
 <span data-ttu-id="6bf99-270">Si las conexiones utilizan TCP/IP, el algoritmo de reintento de conexión determina la cantidad de tiempo asignada a los intentos de conexión en cada ciclo.</span><span class="sxs-lookup"><span data-stu-id="6bf99-270">If the connections use TCP/IP, the connection retry algorithm determines the amount of time allotted to the connection attempts in each round.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="6bf99-271">Si se desconecta el cliente de la base de datos, el proveedor de acceso a datos no intentará volver a conectarse.</span><span class="sxs-lookup"><span data-stu-id="6bf99-271">If the client gets disconnected from the database, the data access provider does not attempt to reconnect.</span></span> <span data-ttu-id="6bf99-272">El cliente deberá emitir una nueva solicitud de conexión.</span><span class="sxs-lookup"><span data-stu-id="6bf99-272">The client must issue a new connection request.</span></span> <span data-ttu-id="6bf99-273">Además, si se cierra una aplicación al perder la conexión, la aplicación pierde los nombres de asociado en la caché.</span><span class="sxs-lookup"><span data-stu-id="6bf99-273">Also, if an application shuts down on losing the connection, it will lose the cached partner names.</span></span> <span data-ttu-id="6bf99-274">Si se perdió la conexión porque el servidor principal dejó de estar disponible, la única forma en que la aplicación puede volver a conectarse al servidor reflejado es proporcionando el nombre de asociado de conmutación por error en su cadena de conexión.</span><span class="sxs-lookup"><span data-stu-id="6bf99-274">If the connection was lost because the principal server became unavailable, the only way that the application can reconnect to the mirror server is by supplying the failover partner name in its connection string.</span></span>  
  
  
### <a name="impact-of-redirection-on-a-client-application"></a><span data-ttu-id="6bf99-275">Impacto de la redirección en una aplicación cliente</span><span class="sxs-lookup"><span data-stu-id="6bf99-275">Impact of Redirection on a Client Application</span></span>  
 <span data-ttu-id="6bf99-276">Después de una conmutación por error, el proveedor de acceso a datos redirige la conexión a la instancia de servidor principal actual.</span><span class="sxs-lookup"><span data-stu-id="6bf99-276">After a failover, the data access provider redirects the connection to the current principal server instance.</span></span> <span data-ttu-id="6bf99-277">Sin embargo, la redirección resulta transparente para los clientes.</span><span class="sxs-lookup"><span data-stu-id="6bf99-277">However, the redirection is transparent to clients.</span></span> <span data-ttu-id="6bf99-278">Para un cliente, una conexión redirigida parece una conexión a la instancia de servidor identificada por el nombre de asociado inicial.</span><span class="sxs-lookup"><span data-stu-id="6bf99-278">To a client, a redirected connection appears to be a connection to the server instance identified by the initial partner name.</span></span> <span data-ttu-id="6bf99-279">Cuando el asociado inicial es actualmente el servidor reflejado, es posible que el cliente parezca estar conectado al servidor reflejado y actualizando la base de datos reflejada.</span><span class="sxs-lookup"><span data-stu-id="6bf99-279">When the initial partner is currently the mirror server, the client can appear to be connected to the mirror server and updating the mirror database.</span></span> <span data-ttu-id="6bf99-280">No obstante, en realidad se ha redirigido el cliente al asociado de conmutación por error, que es la base de datos principal actual, y el cliente está actualizando la nueva base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="6bf99-280">Actually, however, the client has been redirected to the failover partner, which is the current principal database, and the client is updating the new principal database.</span></span>  
  
 <span data-ttu-id="6bf99-281">Después de ser redirigido al asociado de conmutación por error, un cliente puede obtener resultados inesperados cuando utiliza una instrucción USE de [!INCLUDE[tsql](../../includes/tsql-md.md)] para usar otra base de datos.</span><span class="sxs-lookup"><span data-stu-id="6bf99-281">After being redirected to the failover partner, a client can experience unexpected results when using a [!INCLUDE[tsql](../../includes/tsql-md.md)] USE statement to use a different database.</span></span> <span data-ttu-id="6bf99-282">Esto puede producirse si la instancia del servidor principal (el asociado de conmutación por error) tiene un conjunto diferente de bases de datos que el servidor principal (el asociado inicial).</span><span class="sxs-lookup"><span data-stu-id="6bf99-282">This can happen if the current principal server instance (the failover partner) has a different set of databases than the original principal server (the initial partner).</span></span>  
  
##  <a name="the-impact-of-a-stale-failover-partner-name"></a><a name="StalePartnerName"></a> <span data-ttu-id="6bf99-283">Impacto de un nombre de asociado de conmutación por error desusado</span><span class="sxs-lookup"><span data-stu-id="6bf99-283">The Impact of a Stale Failover Partner Name</span></span>  
 <span data-ttu-id="6bf99-284">El administrador de la base de datos puede cambiar el asociado de conmutación por error en cualquier momento.</span><span class="sxs-lookup"><span data-stu-id="6bf99-284">The database administrator can change the failover partner at any time.</span></span> <span data-ttu-id="6bf99-285">Por lo tanto, un nombre de asociado de conmutación por error que suministre un cliente podría estar desfasado o *desusado*.</span><span class="sxs-lookup"><span data-stu-id="6bf99-285">Therefore, a client-supplied failover partner name might be out of date, or *stale*.</span></span> <span data-ttu-id="6bf99-286">Por ejemplo, imagine que tiene un asociado de conmutación por error que se llama Partner_B y que es sustituido por otra instancia de servidor, Partner_C.</span><span class="sxs-lookup"><span data-stu-id="6bf99-286">For example, consider a failover partner named Partner_B that is replaced by another server instance, Partner_C.</span></span> <span data-ttu-id="6bf99-287">Si un cliente proporciona Partner_B como nombre del asociado de conmutación por error, ese nombre está desusado.</span><span class="sxs-lookup"><span data-stu-id="6bf99-287">Now, if a client supplies Partner_B as the failover partner name, that name is stale.</span></span> <span data-ttu-id="6bf99-288">En este caso, el comportamiento del proveedor de acceso a datos es el mismo que cuando el cliente no proporciona un nombre de asociado de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="6bf99-288">When the client-supplied failover partner name is stale, the behavior of the data access provider equates to the case in which a failover partner name is not supplied by the client.</span></span>  
  
 <span data-ttu-id="6bf99-289">Por ejemplo, suponga que un cliente utiliza una cadena de conexión para una serie de cuatro intentos de conexión.</span><span class="sxs-lookup"><span data-stu-id="6bf99-289">For example, consider situation in which a client uses one connection string for a series of four connection attempts.</span></span> <span data-ttu-id="6bf99-290">En la cadena de conexión, el nombre del asociado inicial es Partner_A y el del asociado de conmutación por error, Partner_B:</span><span class="sxs-lookup"><span data-stu-id="6bf99-290">In the connection string, the initial partner name is Partner_A, and the failover partner name is Partner_B:</span></span>  
  
```  
"Server=Partner_A; Failover Partner=Partner_B; Database=AdventureWorks"  
```  
  
 <span data-ttu-id="6bf99-291">En la siguiente tabla se muestran cuatro configuraciones de asociado y se indica en cada caso si la cadena de conexión funciona para conectar el cliente por primera vez.</span><span class="sxs-lookup"><span data-stu-id="6bf99-291">The following table shows four partner configurations and indicates for each whether this connection string works for connecting the client for the first time.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6bf99-292">Una aplicación puede realizar el seguimiento de los cambios de configuración y modificar su cadena de conexión en consecuencia.</span><span class="sxs-lookup"><span data-stu-id="6bf99-292">An application can track configuration changes and change its connection string accordingly.</span></span> <span data-ttu-id="6bf99-293">Ello requiere código adicional, pero se consigue reducir la carga administrativa.</span><span class="sxs-lookup"><span data-stu-id="6bf99-293">This requires extra code but reduces the administrative burden.</span></span>  
  
|<span data-ttu-id="6bf99-294">Configuración</span><span class="sxs-lookup"><span data-stu-id="6bf99-294">Configuration</span></span>|<span data-ttu-id="6bf99-295">Servidor principal</span><span class="sxs-lookup"><span data-stu-id="6bf99-295">Principal server</span></span>|<span data-ttu-id="6bf99-296">Servidor reflejado</span><span class="sxs-lookup"><span data-stu-id="6bf99-296">Mirror server</span></span>|<span data-ttu-id="6bf99-297">Comportamiento al intentar conectarse especificando Partner_A y Partner_B</span><span class="sxs-lookup"><span data-stu-id="6bf99-297">Behavior when attempting to connect specifying Partner_A and Partner_B</span></span>|  
|-------------------|----------------------|-------------------|------------------------------------------------------------------------------|  
|<span data-ttu-id="6bf99-298">Configuración de creación de reflejo original.</span><span class="sxs-lookup"><span data-stu-id="6bf99-298">Original mirroring configuration.</span></span>|<span data-ttu-id="6bf99-299">Partner_A</span><span class="sxs-lookup"><span data-stu-id="6bf99-299">Partner_A</span></span>|<span data-ttu-id="6bf99-300">Partner_B</span><span class="sxs-lookup"><span data-stu-id="6bf99-300">Partner_B</span></span>|<span data-ttu-id="6bf99-301">Se almacena Partner_A en la caché como nombre del asociado inicial.</span><span class="sxs-lookup"><span data-stu-id="6bf99-301">Partner_A is cached as the initial partner name.</span></span> <span data-ttu-id="6bf99-302">El cliente se conecta correctamente a Partner_A.</span><span class="sxs-lookup"><span data-stu-id="6bf99-302">The client succeeds in connecting to Partner_A.</span></span> <span data-ttu-id="6bf99-303">El cliente descarga el nombre del servidor reflejado, Partner B, y lo almacena en caché, sin tener en cuenta el nombre del asociado de conmutación por error proporcionado por el cliente.</span><span class="sxs-lookup"><span data-stu-id="6bf99-303">The client downloads the name of mirror server, Partner_B, and caches it, ignoring the client-supplied failover partner name.</span></span>|  
|<span data-ttu-id="6bf99-304">Partner_A sufre un error de hardware y se produce la conmutación por error (se desconectan los clientes).</span><span class="sxs-lookup"><span data-stu-id="6bf99-304">Partner_A experiences a hardware failure, and failover occurs (disconnecting clients).</span></span>|<span data-ttu-id="6bf99-305">Partner_B</span><span class="sxs-lookup"><span data-stu-id="6bf99-305">Partner_B</span></span>|<span data-ttu-id="6bf99-306">None</span><span class="sxs-lookup"><span data-stu-id="6bf99-306">none</span></span>|<span data-ttu-id="6bf99-307">Partner_A sigue almacenado en caché como nombre del asociado inicial, pero el nombre del asociado de conmutación por error proporcionado por el cliente, Partner_B, permite al cliente conectarse al servidor principal actual.</span><span class="sxs-lookup"><span data-stu-id="6bf99-307">The Partner_A is still cached as the initial partner name, but the client-supplied failover partner name, Partner_B, permits the client to connect to the current principal server.</span></span>|  
|<span data-ttu-id="6bf99-308">El administrador de la base de datos detiene la creación del reflejo (se desconectan los clientes), sustituye Partner_A por Partner_C y reinicia la creación del reflejo.</span><span class="sxs-lookup"><span data-stu-id="6bf99-308">The database administrator stops mirroring (disconnecting clients), replaces Partner_A with Partner_C, and restarts mirroring.</span></span>|<span data-ttu-id="6bf99-309">Partner_B</span><span class="sxs-lookup"><span data-stu-id="6bf99-309">Partner_B</span></span>|<span data-ttu-id="6bf99-310">Partner_C</span><span class="sxs-lookup"><span data-stu-id="6bf99-310">Partner_C</span></span>|<span data-ttu-id="6bf99-311">El cliente intenta conectarse a Partner_A y surge un error. A continuación, lo intenta con Partner_B (el servidor principal actual) y se conecta correctamente.</span><span class="sxs-lookup"><span data-stu-id="6bf99-311">The client attempts to connect to Partner_A and fails; then the client tries Partner_B (the current principal server) and succeeds.</span></span> <span data-ttu-id="6bf99-312">El proveedor de acceso a datos descarga el nombre del servidor reflejado actual, Partner_C, y lo almacena en caché como nombre del asociado de conmutación por error actual.</span><span class="sxs-lookup"><span data-stu-id="6bf99-312">The data access provider downloads the name of the current mirror server, Partner_C, and caches it as the current failover partner name.</span></span>|  
|<span data-ttu-id="6bf99-313">El servicio se conmuta manualmente a Partner_C (se desconectan los clientes).</span><span class="sxs-lookup"><span data-stu-id="6bf99-313">Service is manually failed over to Partner_C (disconnecting clients).</span></span>|<span data-ttu-id="6bf99-314">Partner_C</span><span class="sxs-lookup"><span data-stu-id="6bf99-314">Partner_C</span></span>|<span data-ttu-id="6bf99-315">Partner_B</span><span class="sxs-lookup"><span data-stu-id="6bf99-315">Partner_B</span></span>|<span data-ttu-id="6bf99-316">El cliente trata de conectarse primero a Partner_A y, después, a Partner_B.</span><span class="sxs-lookup"><span data-stu-id="6bf99-316">Client attempts to connect to Partner_A initially, and then to Partner_B.</span></span> <span data-ttu-id="6bf99-317">Los dos nombres producen un error y, finalmente, se agota el tiempo de espera de la solicitud y se produce un error.</span><span class="sxs-lookup"><span data-stu-id="6bf99-317">Both names fail, and eventually the connection request times out and fails.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="6bf99-318">Consulte también</span><span class="sxs-lookup"><span data-stu-id="6bf99-318">See Also</span></span>  
 <span data-ttu-id="6bf99-319">[Creación de reflejo de la base de datos &#40;SQL Server&#41;](database-mirroring-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="6bf99-319">[Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md) </span></span>  
 [<span data-ttu-id="6bf99-320">Posibles errores durante la creación de reflejo de la base de datos</span><span class="sxs-lookup"><span data-stu-id="6bf99-320">Possible Failures During Database Mirroring</span></span>](possible-failures-during-database-mirroring.md)  
  
  
