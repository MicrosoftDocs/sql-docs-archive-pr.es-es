---
title: Crear reflejo de la base de datos y trasvase de registros (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- database mirroring [SQL Server], interoperability
- log shipping [SQL Server], database mirroring
ms.assetid: 53e98134-e274-4dfd-8b72-0cc0fd5c800e
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: fe11f4244eff98923a6f4ee291caca9c094237f4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87670564"
---
# <a name="database-mirroring-and-log-shipping-sql-server"></a><span data-ttu-id="aa6a5-102">Crear reflejo de la base de datos y trasvase de registros (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="aa6a5-102">Database Mirroring and Log Shipping (SQL Server)</span></span>
  <span data-ttu-id="aa6a5-103">Se puede crear el reflejo de una determinada base de datos o realizar un trasvase de registros; también es posible realizar ambos procesos de forma simultánea.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-103">A given database can be mirrored or log shipped; it can also be simultaneously mirrored and log shipped.</span></span> <span data-ttu-id="aa6a5-104">Para elegir qué método se debe utilizar, tenga en cuenta los siguientes aspectos:</span><span class="sxs-lookup"><span data-stu-id="aa6a5-104">To choose what approach to use, consider the following:</span></span>  
  
-   <span data-ttu-id="aa6a5-105">¿Cuántos servidores de destino necesita?</span><span class="sxs-lookup"><span data-stu-id="aa6a5-105">How many destination servers do you require?</span></span>  
  
     <span data-ttu-id="aa6a5-106">Si solo es necesaria una base de datos de destino, la creación de reflejo de la base de datos es la solución recomendada.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-106">If you require only a single destination database, database mirroring is the recommended solution.</span></span>  
  
     <span data-ttu-id="aa6a5-107">Si son necesarias varias bases de datos de destino, debe utilizar el trasvase de registros, ya sea por sí mismo o en combinación con la creación de reflejo de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-107">If you require more than one destination database, you need to use log shipping, either alone or with database mirroring.</span></span> <span data-ttu-id="aa6a5-108">La combinación de estos métodos ofrece las ventajas de la creación de reflejo de la base de datos y la compatibilidad con varios destinos que proporciona el trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-108">Combining these approaches gives you the benefits of database mirroring along with the support for multiple destinations provided by log shipping.</span></span>  
  
-   <span data-ttu-id="aa6a5-109">Si necesita retrasar la restauración de registros en la base de datos de destino (generalmente para protegerla de errores lógicos), utilice el trasvase de registros, por sí mismo o en combinación con la creación de reflejo.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-109">If you need to delay restoring log on the destination database (typically, to protect against logical errors), use log shipping, alone or with database mirroring.</span></span>  
  
 <span data-ttu-id="aa6a5-110">En este tema se tratan los aspectos relativos a la combinación del trasvase de registros y la creación de reflejo de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-110">This topic discusses considerations for combining log shipping and database mirroring.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="aa6a5-111">Para ver introducciones a estas tecnologías, consulte [Creación de reflejo de la base de datos &#40;SQL Server&#41;](database-mirroring-sql-server.md) y [Acerca del trasvase de registros &#40;SQL Server&#41;](../log-shipping/about-log-shipping-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="aa6a5-111">For introductions to these technologies, see [Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md) and [About Log Shipping &#40;SQL Server&#41;](../log-shipping/about-log-shipping-sql-server.md).</span></span>  
  
## <a name="combining-log-shipping-and-database-mirroring"></a><span data-ttu-id="aa6a5-112">Combinar el trasvase de registros y la creación de reflejo de la base de datos</span><span class="sxs-lookup"><span data-stu-id="aa6a5-112">Combining Log Shipping and Database Mirroring</span></span>  
 <span data-ttu-id="aa6a5-113">La base de datos principal en una sesión de creación de reflejo puede actuar también como base de datos principal en una configuración de trasvase de registros, o viceversa, ya que el recurso compartido de copia de seguridad de trasvase de registros está intacto.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-113">The principal database in a mirroring session can also act as the primary database in a log shipping configuration, or vice versa, as the log shipping backup share is intact.</span></span> <span data-ttu-id="aa6a5-114">La sesión de creación de reflejo de la base de datos se ejecuta en cualquier modo operativo, ya sea sincrónico (con la seguridad de transacciones configurada en FULL) o asincrónico (con la seguridad de transacciones configurada en OFF).</span><span class="sxs-lookup"><span data-stu-id="aa6a5-114">The database mirroring session run in any operating mode, whether synchronous (with transaction safety set to FULL) or asynchronous (with transaction safety set to OFF).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="aa6a5-115">Para utilizar la creación de reflejo en una base de datos, es obligatorio el modelo de recuperación completa.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-115">To use database mirroring on a database, the full recovery model is always required.</span></span>  
  
 <span data-ttu-id="aa6a5-116">En general, al combinar el trasvase de registros y la creación de reflejo de la base de datos, la sesión de creación de reflejo se establece antes que el trasvase de registros, aunque no es necesario.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-116">Typically, when combining log shipping and database mirroring, the mirroring session is established before log shipping, although this is not required.</span></span> <span data-ttu-id="aa6a5-117">Después, la base de datos principal actual se configura como principal del trasvase de registros ( *base de datos principal/primaria*), junto con una o varias bases de datos secundarias remotas.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-117">Then the current principal database is configured as the log shipping primary (the *principal/primary database*), along with one or more remote secondary databases.</span></span> <span data-ttu-id="aa6a5-118">Además, la base de datos reflejada debe estar configurada como principal del trasvase de registros ( *base de datos reflejada/principal*).</span><span class="sxs-lookup"><span data-stu-id="aa6a5-118">Also, the mirror database must be configured as a log shipping primary (the *mirror/primary database*).</span></span> <span data-ttu-id="aa6a5-119">Las bases de datos secundarias del trasvase de registros deben residir en instancias de servidor distintas del servidor principal/primario o el servidor reflejado/primario.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-119">The log shipping secondary databases should be on different server instances than either the principal/primary server or mirror/primary server.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="aa6a5-120">La configuración de uso de mayúsculas y minúsculas de los servidores que participan en el trasvase de registros debe coincidir.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-120">The case sensitivity settings of the servers involved in log shipping should match.</span></span>  
  
 <span data-ttu-id="aa6a5-121">Durante una sesión de trasvase de registros, los trabajos de copia de seguridad de la base de datos principal crean copias de seguridad de registros en una carpeta.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-121">During a log shipping session, backup jobs on the primary database create log backups in a backup folder.</span></span> <span data-ttu-id="aa6a5-122">Los trabajos de copia de los servidores secundarios copian de ahí las copias de seguridad.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-122">From there, the backups are copied by the copy jobs of the secondary servers.</span></span> <span data-ttu-id="aa6a5-123">Para que los trabajos de copia de seguridad y los trabajos de copia se realicen correctamente, deben tener acceso a la carpeta de copias de seguridad del trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-123">For the backup jobs and copy jobs to succeed, they must have access to the log shipping backup folder.</span></span> <span data-ttu-id="aa6a5-124">Para ofrecer la máxima disponibilidad del servidor principal, se recomienda establecer la carpeta de copias de seguridad en una ubicación compartida en un equipo host independiente.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-124">To maximize availability of the primary server, we recommend that you establish the backup folder in a shared backup location on a separate host computer.</span></span> <span data-ttu-id="aa6a5-125">Asegúrese de que todos los servidores de trasvase de registros, incluido el servidor reflejado/principal, pueden acceder a la ubicación compartida de copias de seguridad (conocida como *recurso compartido de copia de seguridad*).</span><span class="sxs-lookup"><span data-stu-id="aa6a5-125">Ensure that all the log shipping servers, including the mirror/primary server, can access the shared backup location (known as a *backup share*).</span></span>  
  
 <span data-ttu-id="aa6a5-126">Para que el trasvase de registros pueda continuar tras realizar la conmutación por error de la creación de reflejo de la base de datos, debe configurar también el servidor reflejado como servidor principal, con la misma configuración que utiliza para el servidor primario en la base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-126">To allow log shipping to continue after database mirroring fails over, you must also configure the mirror server as a primary server, using the same configuration you use for the primary on the principal database.</span></span> <span data-ttu-id="aa6a5-127">La base de datos reflejada se encuentra en el estado de restauración, lo que impide que los trabajos de copia de seguridad puedan realizar una copia de seguridad del registro en la base de datos reflejada.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-127">The mirror database is in the restoring state, which prevents the backup jobs from backing up the log on the mirror database.</span></span> <span data-ttu-id="aa6a5-128">De esta forma se asegura que la base de datos reflejada/primaria no interfiere con la base de datos principal/primaria cuyas copias de seguridad de registros están copiando los servidores secundarios.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-128">This ensures that the mirror/primary database does not interfere with the principal/primary database whose log backups are currently being copied by secondary servers.</span></span> <span data-ttu-id="aa6a5-129">Para evitar falsas alertas, después de que el trabajo de copia de seguridad se ejecute en la base de datos reflejada/principal, el trabajo de copia de seguridad registra un mensaje en la tabla**log_shipping_monitor_history_detail** y el trabajo del agente devuelve un estado de correcto.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-129">To prevent spurious alerts, after the backup job executes on the mirror/primary database, the backup job logs a message to the l**og_shipping_monitor_history_detail** table, and the agent job returns a status of success.</span></span>  
  
 <span data-ttu-id="aa6a5-130">La base de datos reflejada/primaria está inactiva en la sesión de trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-130">The mirror/primary database is inactive in the log shipping session.</span></span> <span data-ttu-id="aa6a5-131">No obstante, si en la creación de reflejo se realiza la conmutación por error, la base de datos reflejada anterior se pone en línea como la base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-131">However, if mirroring fails over, the former mirror database comes online as the principal database.</span></span> <span data-ttu-id="aa6a5-132">En ese momento, dicha base de datos pasa también a ser la base de datos principal activa del trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-132">At that point, that database also becomes active as the log shipping primary database.</span></span> <span data-ttu-id="aa6a5-133">Los trabajos de copia de seguridad del trasvase de registros que previamente no pudieron trasvasar los registros en esa base de datos comienzan el trasvase.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-133">The log shipping backup jobs that were previously unable to ship log on that database, begin shipping log.</span></span> <span data-ttu-id="aa6a5-134">En contraposición, como consecuencia de una conmutación por error, la base de datos principal/primaria anterior se convierte en la nueva base de datos reflejada/primaria, entra en el estado de restauración y los trabajos de copia de seguridad de esa base de datos dejan de realizar la copia de seguridad de registros.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-134">Conversely, a failover causes the former principal/primary database to become the new mirror/primary database and enter the restoring state, and backup jobs on that database cease to backup log.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="aa6a5-135">En el caso de producirse una conmutación automática por error, la conmutación al rol reflejado tiene lugar cuando la base de datos principal/primaria anterior se vuelve a unir a la sesión de creación de reflejo.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-135">In the event of an automatic failover, the switch to the mirror role occurs when the former principal/primary database rejoins the mirroring session.</span></span>  
  
 <span data-ttu-id="aa6a5-136">Para que se ejecute en modo de alta seguridad con conmutación por error automática, la sesión de creación de reflejo está configurada con una instancia de servidor adicional que se conoce como *testigo*.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-136">To run in high-safety mode with automatic failover the mirroring session is configured with an additional server instance known as the *witness*.</span></span> <span data-ttu-id="aa6a5-137">Si la base de datos principal se pierde por alguna razón después de sincronizar la base de datos y si el servidor reflejado y el testigo pueden seguir comunicándose mutuamente, se produce la conmutación automática por error.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-137">If the principal database is lost for any reason after the database is synchronized and if the mirror server and witness can still communicate with each other, automatic failover occurs.</span></span> <span data-ttu-id="aa6a5-138">La conmutación automática por error hace que el servidor reflejado asuma el rol principal y ponga en línea su base de datos como base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-138">An automatic failover causes mirror server to assume the principal role and bring its database online as the principal database.</span></span> <span data-ttu-id="aa6a5-139">Si el nuevo servidor principal/primario no tiene acceso a la ubicación de copias de seguridad del trasvase de registros, los trabajos de copia de seguridad comienzan el trasvase de las copias de seguridad de registros a dicha ubicación.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-139">If the log shipping backup location is accessible to the new principal/primary server, its backup jobs begin to ship log backups to that location.</span></span> <span data-ttu-id="aa6a5-140">El modo sincrónico de la creación de reflejo de la base de datos garantiza que la conmutación por error de la creación de reflejo no afecta a la cadena de registros y que solo se restauran los registros válidos.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-140">The database mirroring synchronous mode guarantees that the log chain is unaffected by a mirroring failover and that only valid log is restored.</span></span> <span data-ttu-id="aa6a5-141">Los servidores secundarios continúan copiando copias de seguridad de registros sin saber que una instancia de servidor diferente es ahora el servidor principal.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-141">The secondary servers continue to copy log backups without knowing that a different server instance has become the primary server.</span></span>  
  
 <span data-ttu-id="aa6a5-142">Si se utiliza un monitor de trasvase de registros local, no son necesarias consideraciones especiales para admitir este escenario.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-142">When using a local log shipping monitor, no special considerations are necessary to accommodate this scenario.</span></span> <span data-ttu-id="aa6a5-143">Para obtener información acerca de cómo utilizar una instancia de supervisión remota con este escenario, vea "Impacto de la creación de reflejo de la base de datos en una instancia de supervisión remota", más adelante en este tema.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-143">For information about using a remote monitoring instance with this scenario, see, "The Impact of Database Mirroring on a Remote Monitoring Instance," later in this topic.</span></span>  
  
## <a name="failing-over-from-the-principal-to-the-mirror-database"></a><span data-ttu-id="aa6a5-144">Conmutación por error de la base de datos principal a la base de datos reflejada</span><span class="sxs-lookup"><span data-stu-id="aa6a5-144">Failing over from the Principal to the Mirror database</span></span>  
 <span data-ttu-id="aa6a5-145">En la siguiente ilustración se muestra el funcionamiento conjunto del trasvase de registros y la creación de reflejo de la base de datos cuando la creación de reflejo se ejecuta en el modo de alta seguridad con conmutación automática por error.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-145">The following figure shows how log shipping and database mirroring work together when mirroring is running in high-safety mode with automatic failover.</span></span> <span data-ttu-id="aa6a5-146">Inicialmente, **Server_A** es el servidor principal para la creación de reflejo y el servidor principal del trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-146">Initially, **Server_A** is both the principal server for mirroring and the primary server for log shipping.</span></span> <span data-ttu-id="aa6a5-147">**Server_B** es el servidor reflejado y además está configurado como servidor principal, que actualmente está inactivo.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-147">**Server_B** is the mirror server and is also configured as a primary server, which is currently inactive.</span></span> <span data-ttu-id="aa6a5-148">**Server_C** y **Server_D** son servidores secundarios de trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-148">**Server_C** and **Server_D** are log shipping secondary servers.</span></span> <span data-ttu-id="aa6a5-149">Para ofrecer la máxima disponibilidad de la sesión de trasvase de registros, la ubicación de copias de seguridad se encuentra en un directorio de recurso compartido en un equipo host independiente.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-149">To maximize availability of the log shipping session, the backup location is on a share directory on a separate host computer.</span></span>  
  
 <span data-ttu-id="aa6a5-150">![Trasvase de registros y creación de reflejo de la base de datos](../media/logshipping-and-dbm-automatic-failover.gif "Trasvase de registros y creación de reflejo de la base de datos")</span><span class="sxs-lookup"><span data-stu-id="aa6a5-150">![Log shipping and database mirroring](../media/logshipping-and-dbm-automatic-failover.gif "Log shipping and database mirroring")</span></span>  
  
 <span data-ttu-id="aa6a5-151">Tras una conmutación por error de la creación de reflejo, el nombre del servidor principal definido en el servidor secundario no se modifica.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-151">After a mirroring failover, the primary server name defined on the secondary server is unchanged.</span></span> <span data-ttu-id="aa6a5-152">.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-152">.</span></span>  
  
## <a name="the-impact-of-database-mirroring-on-a-remote-monitoring-instance"></a><span data-ttu-id="aa6a5-153">Impacto de la creación de reflejo de la base de datos en una instancia de supervisión remota</span><span class="sxs-lookup"><span data-stu-id="aa6a5-153">The Impact of Database Mirroring on a Remote Monitoring Instance</span></span>  
 <span data-ttu-id="aa6a5-154">Si el trasvase de registros se utiliza con una instancia de supervisión remota, la combinación de la sesión de trasvase de registros y la creación de reflejo de la base de datos afecta a la información de las tablas del monitor.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-154">When log shipping uses with a remote monitoring instance, combining the log shipping session and database mirroring affects the information in the monitor tables.</span></span> <span data-ttu-id="aa6a5-155">La información acerca del servidor principal es una combinación del monitor configurado en el servidor principal/primario y el configurado en cada servidor secundario.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-155">The information about the primary is a combination of the one configured at the principal/primary and the monitor configured on each secondary.</span></span>  
  
 <span data-ttu-id="aa6a5-156">Para mantener la máxima uniformidad posible de la supervisión, si se utiliza un monitor remoto se recomienda especificar el nombre del servidor principal original al configurar el servidor principal en el secundario.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-156">To keep monitoring as seamless as possible, when you use a remote monitor, we recommend that you specify the original primary name when configuring the primary at the secondary.</span></span> <span data-ttu-id="aa6a5-157">Este enfoque facilita también el cambio de la configuración de trasvase de registros en el Agente Microsoft [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="aa6a5-157">This approach also facilitates changing the log shipping configuration from Microsoft [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent.</span></span> <span data-ttu-id="aa6a5-158">Para obtener más información sobre la supervisión, vea [Supervisar el trasvase de registros &#40;Transact-SQL&#41;](../log-shipping/monitor-log-shipping-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="aa6a5-158">For more information about monitoring, see [Monitor Log Shipping &#40;Transact-SQL&#41;](../log-shipping/monitor-log-shipping-transact-sql.md).</span></span>  
  
## <a name="setting-up-mirroring-and-log-shipping-together"></a><span data-ttu-id="aa6a5-159">Configurar conjuntamente la creación de reflejo y el trasvase de registros</span><span class="sxs-lookup"><span data-stu-id="aa6a5-159">Setting Up Mirroring and Log Shipping Together</span></span>  
 <span data-ttu-id="aa6a5-160">Para configurar conjuntamente la creación de reflejo de la base de datos y el trasvase de registros, es necesario seguir estos pasos:</span><span class="sxs-lookup"><span data-stu-id="aa6a5-160">To set up database mirroring and log shipping together, the following steps are required:</span></span>  
  
1.  <span data-ttu-id="aa6a5-161">Restaure las copias de seguridad de la base de datos principal/primaria con la opción NORECOVERY en otra instancia de servidor que posteriormente se utilizará como base de datos reflejada de la creación de reflejo para la base de datos principal/primaria.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-161">Restore backups of the principal/primary database with NORECOVERY onto another server instance to be later used as database mirroring mirror database for the principal/primary database.</span></span> <span data-ttu-id="aa6a5-162">Para obtener más información, vea [Preparar una base de datos reflejada para la creación de reflejo &#40;SQL Server&#41;](prepare-a-mirror-database-for-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="aa6a5-162">For more information, see [Prepare a Mirror Database for Mirroring &#40;SQL Server&#41;](prepare-a-mirror-database-for-mirroring-sql-server.md).</span></span>  
  
2.  <span data-ttu-id="aa6a5-163">Configure la creación de reflejo de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-163">Set up database mirroring.</span></span> <span data-ttu-id="aa6a5-164">Para obtener más información, vea [Establecer una sesión de creación de reflejo de la base de datos mediante la autenticación de Windows &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md) y [Configurar la creación de reflejo de la base de datos &#40;SQL Server&#41;](setting-up-database-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="aa6a5-164">For more information, see [Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md) or [Setting Up Database Mirroring &#40;SQL Server&#41;](setting-up-database-mirroring-sql-server.md).</span></span>  
  
3.  <span data-ttu-id="aa6a5-165">Restaure las copias de seguridad de la base de datos principal/primaria en otras instancias de servidor que posteriormente se utilizarán como bases de datos secundarias del trasvase de registros para la base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-165">Restore backups of the principal/primary database to other server instances to be later used as log shipping secondary databases for the primary database.</span></span>  
  
4.  <span data-ttu-id="aa6a5-166">Configure el trasvase de registros en la base de datos principal como la base de datos principal para una o varias bases de datos secundarias.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-166">Set up log shipping on the principal database as the primary database for one or more secondary databases.</span></span>  
  
     <span data-ttu-id="aa6a5-167">Debe configurar un único recurso compartido como directorio de copias de seguridad (recurso compartido de copia de seguridad).</span><span class="sxs-lookup"><span data-stu-id="aa6a5-167">You should set up a single share as the backup directory (a backup share).</span></span> <span data-ttu-id="aa6a5-168">De esta forma se asegura que tras la conmutación de roles entre los servidores principal y reflejado, los trabajos de copia de seguridad continúan escribiendo en el mismo directorio que antes.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-168">This ensures that after role switching between the principal and mirror servers, backup jobs continue to write to the same directory as before.</span></span> <span data-ttu-id="aa6a5-169">Como práctica recomendada, es conveniente asegurarse de que este recurso compartido se encuentra en un servidor físico diferente de los servidores que hospedan las bases de datos que participan en la creación de reflejo y el trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-169">A best practice is to ensure that this share is located on a different physical server from the servers hosting the databases involved in mirroring and log shipping.</span></span>  
  
     <span data-ttu-id="aa6a5-170">Para obtener más información, vea [Configurar el trasvase de registros &#40;SQL Server&#41;](../log-shipping/configure-log-shipping-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="aa6a5-170">For more information, see [Configure Log Shipping &#40;SQL Server&#41;](../log-shipping/configure-log-shipping-sql-server.md).</span></span>  
  
5.  <span data-ttu-id="aa6a5-171">Realice la conmutación por error manualmente desde el servidor principal al reflejado.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-171">Manually failover from the principal to the mirror.</span></span>  
  
     <span data-ttu-id="aa6a5-172">Para realizar una conmutación por error manualmente:</span><span class="sxs-lookup"><span data-stu-id="aa6a5-172">To perform a manual failover:</span></span>  
  
    -   [<span data-ttu-id="aa6a5-173">Realizar manualmente la conmutación por error de una sesión de creación de reflejo de la base de datos &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="aa6a5-173">Manually Fail Over a Database Mirroring Session &#40;SQL Server Management Studio&#41;</span></span>](manually-fail-over-a-database-mirroring-session-sql-server-management-studio.md)  
  
    -   [<span data-ttu-id="aa6a5-174">Realizar una conmutación por error manualmente de una sesión de creación de reflejo de la base de datos &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="aa6a5-174">Manually Fail Over a Database Mirroring Session &#40;Transact-SQL&#41;</span></span>](manually-fail-over-a-database-mirroring-session-transact-sql.md)  
  
6.  <span data-ttu-id="aa6a5-175">Configure el trasvase de registros en el nuevo servidor principal (anteriormente el reflejado) como la base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-175">Set up log shipping on the new principal (previously mirror) as the primary database.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="aa6a5-176">No realice ninguna configuración en los servidores secundarios.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-176">Do not perform any setup from a secondary.</span></span>  
  
     <span data-ttu-id="aa6a5-177">Debe utilizar el mismo recurso compartido de copia de seguridad que utilizó en el paso 4.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-177">You must use the same backup share that you used in step 4.</span></span>  
  
     <span data-ttu-id="aa6a5-178">La interfaz **Trasvase de registro de transacción** de [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] solo admite una base de datos principal por cada configuración de trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-178">The **Transaction Log Shipping** interface in [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] supports only one primary database per log shipping configuration.</span></span> <span data-ttu-id="aa6a5-179">Por lo tanto, debe utilizar procedimientos almacenados para configurar el nuevo servidor de la entidad de seguridad como servidor principal.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-179">Therefore, you must use stored procedures to set up the new principal as primary.</span></span>  
  
7.  <span data-ttu-id="aa6a5-180">Realice otra conmutación por error manualmente para conmutar a la entidad de seguridad original.</span><span class="sxs-lookup"><span data-stu-id="aa6a5-180">Perform another manual failover to fail back to the original principal.</span></span>  
  
  
