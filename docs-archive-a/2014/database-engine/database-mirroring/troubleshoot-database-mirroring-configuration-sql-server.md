---
title: Solucionar problemas de configuración de creación de reflejo de la base de datos (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- database mirroring [SQL Server], deployment
- endpoints [SQL Server], database mirroring
- database mirroring [SQL Server], troubleshooting
- troubleshooting [SQL Server], database mirroring
ms.assetid: 87d3801b-dc52-419e-9316-8b1f1490946c
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 0dafd98f721bfc2d2d0dd64a9f97689466529407
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87671682"
---
# <a name="troubleshoot-database-mirroring-configuration-sql-server"></a><span data-ttu-id="3b2c5-102">Solucionar problemas de configuración de creación de reflejo de la base de datos (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="3b2c5-102">Troubleshoot Database Mirroring Configuration (SQL Server)</span></span>
  <span data-ttu-id="3b2c5-103">En este tema se ofrece información que le ayudará a solucionar problemas de configuración de una sesión de creación de reflejo de una base de datos.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-103">This topic provides information to help you troubleshoot problems in setting up a database mirroring session.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="3b2c5-104"> Asegurarse de que cumple todos los [requisitos previos para la creación de reflejo de la base de datos](prerequisites-restrictions-and-recommendations-for-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="3b2c5-104">Ensure that you are meeting all the [prerequisites for database mirroring](prerequisites-restrictions-and-recommendations-for-database-mirroring.md).</span></span>  
  
|<span data-ttu-id="3b2c5-105">Incidencia</span><span class="sxs-lookup"><span data-stu-id="3b2c5-105">Issue</span></span>|<span data-ttu-id="3b2c5-106">Resumen</span><span class="sxs-lookup"><span data-stu-id="3b2c5-106">Summary</span></span>|  
|-----------|-------------|  
|<span data-ttu-id="3b2c5-107">Mensaje de error 1418</span><span class="sxs-lookup"><span data-stu-id="3b2c5-107">Error Message 1418</span></span>|<span data-ttu-id="3b2c5-108">Este mensaje de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] indica que la dirección de red del servidor es inaccesible o no existe, y recomienda que se compruebe el nombre de dirección de red y se vuelva a emitir el comando.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-108">This [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] message indicates that the server network address cannot be reached or does not exist, and it suggests that you verify the network address name and reissue the command.</span></span> <span data-ttu-id="3b2c5-109">Para obtener más información, vea el tema [MSSQLSERVER_1418](../../relational-databases/errors-events/mssqlserver-1418-database-engine-error.md) .</span><span class="sxs-lookup"><span data-stu-id="3b2c5-109">For more information, see the [MSSQLSERVER_1418](../../relational-databases/errors-events/mssqlserver-1418-database-engine-error.md) topic.</span></span>|  
|[<span data-ttu-id="3b2c5-110">Cuentas</span><span class="sxs-lookup"><span data-stu-id="3b2c5-110">Accounts</span></span>](#Accounts)|<span data-ttu-id="3b2c5-111">Analiza los requisitos para configurar correctamente las cuentas en que se ejecuta [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="3b2c5-111">Discusses requirements for correctly configuring the accounts under which [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is running.</span></span>|  
|[<span data-ttu-id="3b2c5-112">Extremos</span><span class="sxs-lookup"><span data-stu-id="3b2c5-112">Endpoints</span></span>](#Endpoints)|<span data-ttu-id="3b2c5-113">Explica los requisitos para configurar correctamente el extremo de la creación de reflejo de la base de datos de cada instancia de servidor.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-113">Discusses requirements for correctly configuring the database mirroring endpoint of each server instance.</span></span>|  
|[<span data-ttu-id="3b2c5-114">SystemAddress</span><span class="sxs-lookup"><span data-stu-id="3b2c5-114">SystemAddress</span></span>](#SystemAddress)|<span data-ttu-id="3b2c5-115">Resume las alternativas para especificar el nombre del sistema de una instancia de servidor en una configuración de creación de reflejo de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-115">Summarizes the alternatives for specifying the system name of a server instance in a database mirroring configuration.</span></span>|  
|[<span data-ttu-id="3b2c5-116">Acceso de red</span><span class="sxs-lookup"><span data-stu-id="3b2c5-116">Network access</span></span>](#NetworkAccess)|<span data-ttu-id="3b2c5-117">Explica el requisito por el que cada instancia de servidor debe poder tener acceso a los puertos de las otras instancias de servidor a través de TCP.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-117">Documents the requirement that each the server instance be able to access the ports of the other server instance or instances over TCP.</span></span>|  
|[<span data-ttu-id="3b2c5-118">Preparación de la base de datos reflejada</span><span class="sxs-lookup"><span data-stu-id="3b2c5-118">Mirror database preparation</span></span>](#MirrorDbPrep)|<span data-ttu-id="3b2c5-119">Resume los requisitos de preparación de la base de datos reflejada para habilitar el inicio de la creación de reflejo.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-119">Summarizes the requirements for preparing the mirror database to enable mirroring to start.</span></span>|  
|[<span data-ttu-id="3b2c5-120">Error en una operación de creación de archivo</span><span class="sxs-lookup"><span data-stu-id="3b2c5-120">Failed create-file operation</span></span>](#FailedCreateFileOp)|<span data-ttu-id="3b2c5-121">Describe cómo responder a un error en una operación de creación de archivo.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-121">Describes how to respond to a failed create-file operation.</span></span>|  
|[<span data-ttu-id="3b2c5-122">Iniciar la creación de reflejo mediante Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="3b2c5-122">Starting mirroring by Using Transact-SQL</span></span>](#StartDbm)|<span data-ttu-id="3b2c5-123">Describe el orden necesario de las instrucciones ALTER DATABASE *database_name* SET PARTNER **='***partner_server***'** .</span><span class="sxs-lookup"><span data-stu-id="3b2c5-123">Describes the required order for ALTER DATABASE *database_name* SET PARTNER **='***partner_server***'** statements.</span></span>|  
|[<span data-ttu-id="3b2c5-124">Transacciones entre bases de datos</span><span class="sxs-lookup"><span data-stu-id="3b2c5-124">Cross-Database Transactions</span></span>](#CrossDbTxns)|<span data-ttu-id="3b2c5-125">Una conmutación automática por error podría provocar la resolución automática y posiblemente incorrecta de transacciones dudosas.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-125">An automatic failover could lead to automatic and possibly incorrect resolution of in-doubt transactions.</span></span> <span data-ttu-id="3b2c5-126">Por esta razón, la creación de reflejo de la base de datos no admite transacciones entre bases de datos.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-126">For this reason database mirroring does not support cross-database transactions.</span></span>|  
  
##  <a name="accounts"></a><a name="Accounts"></a> <span data-ttu-id="3b2c5-127">Cuentas</span><span class="sxs-lookup"><span data-stu-id="3b2c5-127">Accounts</span></span>  
 <span data-ttu-id="3b2c5-128">Las cuentas en las que se ejecuta [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] deben estar configuradas correctamente.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-128">The accounts under which [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is running must be correctly configured.</span></span>  
  
1.  <span data-ttu-id="3b2c5-129">¿Tienen las cuentas los permisos adecuados?</span><span class="sxs-lookup"><span data-stu-id="3b2c5-129">Do the accounts have the correct permissions?</span></span>  
  
    1.  <span data-ttu-id="3b2c5-130">Si las cuentas se ejecutan en el mismo dominio, disminuye la probabilidad de una configuración incorrecta.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-130">If the accounts are running in the same domain accounts, the chances of misconfiguration are reduced.</span></span>  
  
    2.  <span data-ttu-id="3b2c5-131">Si las cuentas se ejecutan en distintos dominios o no son cuentas de dominio, cree en la base de datos **master** del otro equipo el inicio de sesión de una cuenta y concédale permisos CONNECT en el extremo.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-131">If the accounts are running in different domains or are not domain accounts, the login of one account must be created in **master** on the other computer, and that login must be granted CONNECT permissions on the endpoint.</span></span> <span data-ttu-id="3b2c5-132">Para obtener más información, vea [Administrar los metadatos cuando una base de datos pasa a estar disponible en otra instancia del servidor &#40;SQL Server&#41;](../../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md).</span><span class="sxs-lookup"><span data-stu-id="3b2c5-132">For more information, see [Manage Metadata When Making a Database Available on Another Server Instance &#40;SQL Server&#41;](../../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md).</span></span> <span data-ttu-id="3b2c5-133">Esto incluye la cuenta Servicio de red.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-133">This includes the Network Service account.</span></span>  
  
2.  <span data-ttu-id="3b2c5-134">Si [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] se ejecuta como un servicio que usa la cuenta del sistema local, deben utilizarse certificados para la autenticación.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-134">If [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is running as a service that is using the local system account, you must use certificates for authentication.</span></span> <span data-ttu-id="3b2c5-135">Para obtener más información, vea [Usar certificados para un punto de conexión de creación de reflejo de la base de datos &#40;Transact-SQL&#41;](use-certificates-for-a-database-mirroring-endpoint-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="3b2c5-135">For more information, see [Use Certificates for a Database Mirroring Endpoint &#40;Transact-SQL&#41;](use-certificates-for-a-database-mirroring-endpoint-transact-sql.md).</span></span>  
  
##  <a name="endpoints"></a><a name="Endpoints"></a> <span data-ttu-id="3b2c5-136">Endpoints</span><span class="sxs-lookup"><span data-stu-id="3b2c5-136">Endpoints</span></span>  
 <span data-ttu-id="3b2c5-137">Los extremos deben estar configurados correctamente.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-137">Endpoints must be correctly configured.</span></span>  
  
1.  <span data-ttu-id="3b2c5-138">Asegúrese de que cada instancia de servidor (principal, reflejado y testigo, si existe) tiene un extremo de creación de reflejo de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-138">Make sure that each server instance (the principal server, mirror server, and witness, if any) has a database mirroring endpoint.</span></span> <span data-ttu-id="3b2c5-139">Para obtener más información, vea [sys.database_mirroring_endpoints &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-endpoints-transact-sql) y, según la forma de autenticación, ya sea [Crear un punto de conexión de creación de reflejo de la base de datos para la autenticación de Windows &#40;Transact-SQL&#41;](create-a-database-mirroring-endpoint-for-windows-authentication-transact-sql.md) o [Usar certificados para un punto de conexión de creación de reflejo de la base de datos &#40;Transact-SQL&#41;](use-certificates-for-a-database-mirroring-endpoint-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="3b2c5-139">For more information, see [sys.database_mirroring_endpoints &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-endpoints-transact-sql) and, depending on the form of authentication, either [Create a Database Mirroring Endpoint for Windows Authentication &#40;Transact-SQL&#41;](create-a-database-mirroring-endpoint-for-windows-authentication-transact-sql.md) or [Use Certificates for a Database Mirroring Endpoint &#40;Transact-SQL&#41;](use-certificates-for-a-database-mirroring-endpoint-transact-sql.md).</span></span>  
  
2.  <span data-ttu-id="3b2c5-140">Compruebe que los números de puerto son correctos.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-140">Check that the port numbers are correct.</span></span>  
  
     <span data-ttu-id="3b2c5-141">Para identificar el puerto asociado actualmente al punto de conexión de creación de reflejo de la base de datos de una instancia de servidor, use las vistas de catálogo [sys.database_mirroring_endpoints](/sql/relational-databases/system-catalog-views/sys-database-mirroring-endpoints-transact-sql) y [sys.tcp_endpoints](/sql/relational-databases/system-catalog-views/sys-tcp-endpoints-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="3b2c5-141">To identify the port currently associated with database mirroring endpoint of a server instance, use the [sys.database_mirroring_endpoints](/sql/relational-databases/system-catalog-views/sys-database-mirroring-endpoints-transact-sql) and [sys.tcp_endpoints](/sql/relational-databases/system-catalog-views/sys-tcp-endpoints-transact-sql) catalog views.</span></span>  
  
3.  <span data-ttu-id="3b2c5-142">En caso de problemas de configuración de la creación de reflejo de la base de datos difíciles de explicar, se recomienda que compruebe cada una de las instancias de servidor para determinar si escuchan en los puertos correctos.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-142">For database mirroring setup issues that are difficult to explain, we recommend that you inspect each server instance to determine whether it is listening on the correct ports.</span></span> <span data-ttu-id="3b2c5-143">Para obtener más información sobre la comprobación de disponibilidad de puertos, vea [MSSQLSERVER_1418](../../relational-databases/errors-events/mssqlserver-1418-database-engine-error.md).</span><span class="sxs-lookup"><span data-stu-id="3b2c5-143">For information about verifying port availability, see [MSSQLSERVER_1418](../../relational-databases/errors-events/mssqlserver-1418-database-engine-error.md).</span></span>  
  
4.  <span data-ttu-id="3b2c5-144">Asegúrese de que se han iniciado los extremos (STATE=STARTED).</span><span class="sxs-lookup"><span data-stu-id="3b2c5-144">Make sure that the endpoints are started (STATE=STARTED).</span></span> <span data-ttu-id="3b2c5-145">En cada una de las instancias de servidor, utilice la siguiente instrucción [!INCLUDE[tsql](../../includes/tsql-md.md)].</span><span class="sxs-lookup"><span data-stu-id="3b2c5-145">On each server instance, use the following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement.</span></span>  
  
    ```  
    SELECT state_desc FROM sys.database_mirroring_endpoints  
    ```  
  
     <span data-ttu-id="3b2c5-146">Para obtener más información sobre la columna **state_desc**, vea [sys.database_mirroring_endpoints &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-endpoints-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="3b2c5-146">For more information about the **state_desc** column, see [sys.database_mirroring_endpoints &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-endpoints-transact-sql).</span></span>  
  
     <span data-ttu-id="3b2c5-147">Para iniciar un extremo, utilice la siguiente instrucción [!INCLUDE[tsql](../../includes/tsql-md.md)].</span><span class="sxs-lookup"><span data-stu-id="3b2c5-147">To start an endpoint, use the following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement.</span></span>  
  
    ```  
    ALTER ENDPOINT Endpoint_Mirroring   
    STATE = STARTED   
    AS TCP (LISTENER_PORT = <port_number>)  
    FOR database_mirroring (ROLE = ALL);  
    GO  
    ```  
  
     <span data-ttu-id="3b2c5-148">Para obtener más información, vea [ALTER ENDPOINT &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-endpoint-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="3b2c5-148">For more information, see [ALTER ENDPOINT &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-endpoint-transact-sql).</span></span>  
  
5.  <span data-ttu-id="3b2c5-149">Compruebe que el valor de ROLE sea correcto.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-149">Check that the ROLE is correct.</span></span> <span data-ttu-id="3b2c5-150">En cada instancia de servidor, use la siguiente instrucción [!INCLUDE[tsql](../../includes/tsql-md.md)].</span><span class="sxs-lookup"><span data-stu-id="3b2c5-150">On each server instance use the following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement.</span></span>  
  
    ```  
    SELECT role FROM sys.database_mirroring_endpoints;  
    GO  
    ```  
  
     <span data-ttu-id="3b2c5-151">Para obtener más información, vea [sys.database_mirroring_endpoints &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-endpoints-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="3b2c5-151">For more information, see [sys.database_mirroring_endpoints &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-endpoints-transact-sql).</span></span>  
  
6.  <span data-ttu-id="3b2c5-152">El inicio de sesión de la cuenta de servicio desde la otra instancia de servidor necesita el permiso CONNECT.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-152">The login for the service account from the other server instance requires CONNECT permission.</span></span> <span data-ttu-id="3b2c5-153">Asegúrese de que el inicio de sesión del otro servidor dispone de permiso CONNECT.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-153">Make sure that the login from the other server has CONNECT permission.</span></span> <span data-ttu-id="3b2c5-154">Para determinar quién tiene permiso CONNECT para un extremo, use la siguiente instrucción [!INCLUDE[tsql](../../includes/tsql-md.md)] en cada instancia de servidor.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-154">To determine who has CONNECT permission for an endpoint, on each server instance use the following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement.</span></span>  
  
    ```  
    SELECT 'Metadata Check';  
    SELECT EP.name, SP.STATE,   
       CONVERT(nvarchar(38), suser_name(SP.grantor_principal_id))   
          AS GRANTOR,   
       SP.TYPE AS PERMISSION,  
       CONVERT(nvarchar(46),suser_name(SP.grantee_principal_id))   
          AS GRANTEE   
       FROM sys.server_permissions SP , sys.endpoints EP  
       WHERE SP.major_id = EP.endpoint_id  
       ORDER BY Permission,grantor, grantee;   
    GO  
  
    ```  
  
##  <a name="system-address"></a><a name="SystemAddress"></a> <span data-ttu-id="3b2c5-155">Dirección del sistema</span><span class="sxs-lookup"><span data-stu-id="3b2c5-155">System Address</span></span>  
 <span data-ttu-id="3b2c5-156">Como nombre del sistema de una instancia de servidor en una configuración de creación de reflejo de la base de datos, se puede utilizar cualquier nombre que identifique el sistema de forma inequívoca.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-156">For the system name of a server instance in a database mirroring configuration, you can use any name that unambiguously identifies the system.</span></span> <span data-ttu-id="3b2c5-157">La dirección del sistema puede ser un nombre del sistema (si los sistemas se encuentran en el mismo dominio), un nombre de dominio completo o una dirección IP (de preferencia, una dirección IP estática).</span><span class="sxs-lookup"><span data-stu-id="3b2c5-157">The server address can be a system name (if the systems are in the same domain), a fully qualified domain name, or an IP address (preferably, a static IP address).</span></span> <span data-ttu-id="3b2c5-158">Se garantiza que el uso de un nombre de dominio completo funciona correctamente.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-158">Using the fully qualified domain name is guaranteed to work.</span></span> <span data-ttu-id="3b2c5-159">Para obtener más información, vea [Especificar una dirección de red de servidor &#40;creación de reflejo de la base de datos&#41;](specify-a-server-network-address-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="3b2c5-159">For more information, see [Specify a Server Network Address &#40;Database Mirroring&#41;](specify-a-server-network-address-database-mirroring.md).</span></span>  
  
##  <a name="network-access"></a><a name="NetworkAccess"></a> <span data-ttu-id="3b2c5-160">Network Access</span><span class="sxs-lookup"><span data-stu-id="3b2c5-160">Network Access</span></span>  
 <span data-ttu-id="3b2c5-161">Cada instancia de servidor debe tener acceso a los puertos de las demás instancias de servidor a través de TCP.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-161">Each server instance must be able to access the ports of the other server instance or instances over TCP.</span></span> <span data-ttu-id="3b2c5-162">Esto es especialmente importante si las instancias de servidor están en distintos dominios que no confían unos en otros (dominios que no son de confianza).</span><span class="sxs-lookup"><span data-stu-id="3b2c5-162">This is especially important if the server instances are in different domains that do not trust each other (untrusted domains).</span></span> <span data-ttu-id="3b2c5-163">Así se restringe mucho la comunicación entre las instancias de servidor.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-163">This restricts much of the communication between the server instances.</span></span>  
  
##  <a name="mirror-database-preparation"></a><a name="MirrorDbPrep"></a> <span data-ttu-id="3b2c5-164">Mirror Database Preparation</span><span class="sxs-lookup"><span data-stu-id="3b2c5-164">Mirror Database Preparation</span></span>  
 <span data-ttu-id="3b2c5-165">Cuando se inicia la creación de reflejo por primera vez o se inicia de nuevo después de eliminar la creación de reflejo, compruebe que la base de datos reflejada esté preparada para esta operación.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-165">Whether starting mirroring for the first time or starting it again after mirroring was removed, verify that the mirror database is prepared for mirroring.</span></span>  
  
 <span data-ttu-id="3b2c5-166">Al crear la base de datos reflejada en el servidor reflejado, asegúrese de restaurar la copia de seguridad de la base de datos principal especificando la misma base de datos con la opción WITH NORECOVERY.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-166">When you create the mirror database on the mirror server, make sure that you restore the backup of the principal database specifying the same database name WITH NORECOVERY.</span></span> <span data-ttu-id="3b2c5-167">Además, también deben aplicarse todas las copias de seguridad de registros creadas después de crear la copia de seguridad, de nuevo con WITH NORECOVERY.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-167">Also, all log backups created after that backup was taken must also be applied, again WITH NORECOVERY.</span></span>  
  
 <span data-ttu-id="3b2c5-168">También se recomienda que, si es posible, la ruta de acceso al archivo (incluida la letra de unidad) de la base de datos reflejada sea idéntica a la de la base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-168">Also, we recommend that, if it is possible, the file path (including the drive letter) of the mirror database be identical to the path of the principal database.</span></span> <span data-ttu-id="3b2c5-169">Si las rutas de acceso de archivo deben ser diferentes (por ejemplo, si la base de datos principal se encuentra en la unidad 'F:' pero el sistema reflejado no tiene unidad F:), se debe incluir la opción MOVE en la instrucción RESTORE.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-169">If the file paths must differ, for example, if the principal database is on drive 'F:' but the mirror system lacks an F: drive, you must include the MOVE option in the RESTORE statement.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="3b2c5-170">Si mueve los archivos de la base de datos al crear la base de datos reflejada, es posible que no pueda agregar archivos a la base de datos posteriormente sin suspender la creación de reflejo.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-170">If you move the database files when you are creating the mirror database, you might be unable to add files to the database later without mirroring being suspended.</span></span>  
  
 <span data-ttu-id="3b2c5-171">Si la creación de reflejo de la base de datos se ha detenido, todas las copias de seguridad de registros subsiguientes que se realicen en la base de datos principal deben aplicarse a la base de datos reflejada para poder reiniciar la creación de reflejo.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-171">If database mirroring has been stopped, all subsequent log backups taken on the principal database must be applied to the mirror database before mirroring can be restarted.</span></span>  
  
 <span data-ttu-id="3b2c5-172">Para obtener más información, vea [Preparar una base de datos reflejada para la creación de reflejo &#40;SQL Server&#41;](prepare-a-mirror-database-for-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="3b2c5-172">For more information, see [Prepare a Mirror Database for Mirroring &#40;SQL Server&#41;](prepare-a-mirror-database-for-mirroring-sql-server.md).</span></span>  
  
##  <a name="failed-create-file-operation"></a><a name="FailedCreateFileOp"></a> <span data-ttu-id="3b2c5-173">Failed Create-File Operation</span><span class="sxs-lookup"><span data-stu-id="3b2c5-173">Failed Create-File Operation</span></span>  
 <span data-ttu-id="3b2c5-174">Para poder agregar un archivo sin afectar a una sesión de creación de reflejo, la ruta de acceso del archivo debe existir en ambos servidores.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-174">Adding a file without impacting a mirroring session requires that the path of the file exist on both servers.</span></span> <span data-ttu-id="3b2c5-175">Por consiguiente, si mueve los archivos de base de datos al crear la base de datos reflejada, se podría producir un error en una operación posterior para agregar un archivo en la base de datos reflejada y provocar la suspensión de la creación del reflejo.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-175">Therefore, if you move the database files when creating the mirror database, a later add-file operation might fail on the mirror database and cause mirroring to be suspended.</span></span>  
  
 <span data-ttu-id="3b2c5-176">Para corregir el problema:</span><span class="sxs-lookup"><span data-stu-id="3b2c5-176">To fix the problem:</span></span>  
  
1.  <span data-ttu-id="3b2c5-177">El propietario de la base de datos debe quitar la sesión de creación de reflejo y restaurar una copia de seguridad completa del grupo de archivos que contiene el archivo agregado.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-177">The database owner must remove the mirroring session and restore a full backup of the filegroup that contains the added file.</span></span>  
  
2.  <span data-ttu-id="3b2c5-178">A continuación, el propietario debe hacer una copia de seguridad del registro que contenga la operación para agregar el archivo en el servidor principal y restaurar manualmente la copia de seguridad del registro en la base de datos reflejada utilizando las opciones WITH NORECOVERY y MOVE.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-178">The owner must then back up the log containing the add-file operation on the principal server and manually restore the log backup on the mirror database using the WITH NORECOVERY and WITH MOVE options.</span></span> <span data-ttu-id="3b2c5-179">De este modo, se crea la ruta de acceso del archivo especificado en el servidor reflejado y se restaura el archivo nuevo en esa ubicación.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-179">Doing this creates the specified file path on the mirror server and restores the new file to that location.</span></span>  
  
3.  <span data-ttu-id="3b2c5-180">Para preparar la base de datos para una nueva sesión de creación de reflejo, el propietario también debe restaurar WITH NO RECOVERY cualquier otra copia de seguridad del registro pendiente desde el servidor principal.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-180">To prepare the database for a new mirroring session, the owner must also restore WITH NO RECOVERY any other outstanding log backups from the principal server.</span></span>  
  
 <span data-ttu-id="3b2c5-181">Para obtener más información, vea [Quitar la creación de reflejo de la base de datos &#40;SQL Server&#41;](database-mirroring-sql-server.md), [Preparar una base de datos reflejada para la creación de reflejo &#40;SQL Server&#41;](prepare-a-mirror-database-for-mirroring-sql-server.md), [Establecer una sesión de creación de reflejo de la base de datos mediante la autenticación de Windows &#40;Transact-SQL&#41;](database-mirroring-establish-session-windows-authentication.md), [Usar certificados para un punto de conexión de creación de reflejo de la base de datos &#40;Transact-SQL&#41;](use-certificates-for-a-database-mirroring-endpoint-transact-sql.md) o [Establecer una sesión de creación de reflejo de la base de datos mediante la autenticación de Windows &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="3b2c5-181">For more information, see [Removing Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md), [Prepare a Mirror Database for Mirroring &#40;SQL Server&#41;](prepare-a-mirror-database-for-mirroring-sql-server.md), [Establish a Database Mirroring Session Using Windows Authentication &#40;Transact-SQL&#41;](database-mirroring-establish-session-windows-authentication.md), [Use Certificates for a Database Mirroring Endpoint &#40;Transact-SQL&#41;](use-certificates-for-a-database-mirroring-endpoint-transact-sql.md), or [Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md).</span></span>  
  
##  <a name="starting-mirroring-by-using-transact-sql"></a><a name="StartDbm"></a><span data-ttu-id="3b2c5-182">Iniciar la creación de reflejo mediante Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="3b2c5-182">Starting mirroring by Using Transact-SQL</span></span>  
 <span data-ttu-id="3b2c5-183">El orden en que se emiten las instrucciones ALTER DATABASE *database_name* SET PARTNER **='***partner_server***'** es muy importante.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-183">The order in which the ALTER DATABASE *database_name* SET PARTNER **='***partner_server***'** statements are issued is very important.</span></span>  
  
1.  <span data-ttu-id="3b2c5-184">La primera instrucción se debe ejecutar en el servidor reflejado.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-184">The first statement must be run on the mirror server.</span></span> <span data-ttu-id="3b2c5-185">Cuando se emite la instrucción, el servidor reflejado no intenta ponerse en contacto con ninguna otra instancia de servidor.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-185">When this statement is issued, the mirror server does not try to contact any other server instance.</span></span> <span data-ttu-id="3b2c5-186">En lugar de ello, el servidor reflejado indica a su base de datos que espere a que el servidor principal se haya puesto en contacto con el servidor reflejado.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-186">Instead, the mirror server instructs its database to wait until the mirror server has been contacted by the principal server.</span></span>  
  
2.  <span data-ttu-id="3b2c5-187">La segunda instrucción ALTER DATABASE se debe ejecutar en el servidor principal.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-187">The second ALTER DATABASE statement must be run on the principal server.</span></span> <span data-ttu-id="3b2c5-188">Esta instrucción provoca que el servidor principal intente conectarse al servidor reflejado.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-188">This statement causes the principal server to try to connect to the mirror server.</span></span> <span data-ttu-id="3b2c5-189">Una vez creada dicha conexión, el servidor reflejado intenta conectarse al servidor principal a través de otra conexión.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-189">After that connection is created, the mirror then tries to connect to the principal server on another connection.</span></span>  
  
 <span data-ttu-id="3b2c5-190">Para obtener más información, vea [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="3b2c5-190">For more information, see [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="3b2c5-191">Para obtener información sobre cómo usar [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] para iniciar la creación de reflejo, vea [Establecer una sesión de creación de reflejo de la base de datos mediante la autenticación de Windows &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="3b2c5-191">For information about using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] to start mirroring, see [Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md).</span></span>  
  
##  <a name="cross-database-transactions"></a><a name="CrossDbTxns"></a><span data-ttu-id="3b2c5-192">Transacciones entre bases de datos</span><span class="sxs-lookup"><span data-stu-id="3b2c5-192">Cross-Database Transactions</span></span>  
 <span data-ttu-id="3b2c5-193">Cuando se realiza la creación de reflejo de una base de datos en modo de alta seguridad con conmutación automática por error, dicha conmutación puede generar una solución automática y posiblemente incorrecta de transacciones dudosas.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-193">When a database is being mirrored in high-safety mode with automatic failover, an automatic failover could lead to automatic and possibly incorrect resolution of in-doubt transactions.</span></span> <span data-ttu-id="3b2c5-194">Si se produce una conmutación automática por error en una base de datos cuando se está confirmando una transacción entre bases de datos, se pueden generar incoherencias lógicas entre las bases de datos.</span><span class="sxs-lookup"><span data-stu-id="3b2c5-194">If an automatic failover occurs on either database while a cross-database transaction is being committed, logical inconsistencies can occur between the databases.</span></span>  
  
 <span data-ttu-id="3b2c5-195">Los tipos de transacciones entre bases de datos que pueden verse afectadas por una conmutación automática por error son:</span><span class="sxs-lookup"><span data-stu-id="3b2c5-195">The types of cross-database transactions that can be affected by an automatic failover include the following:</span></span>  
  
-   <span data-ttu-id="3b2c5-196">Una transacción que actualice varias bases de datos en la misma instancia de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="3b2c5-196">A transaction that is updating multiple databases in the same instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
-   <span data-ttu-id="3b2c5-197">Transacciones que utilizan el Coordinador de transacciones distribuidas de [!INCLUDE[msCoName](../../includes/msconame-md.md)] DTC (Coordinador de transacciones distribuidas).</span><span class="sxs-lookup"><span data-stu-id="3b2c5-197">Transactions that use a [!INCLUDE[msCoName](../../includes/msconame-md.md)] Distributed Transaction Coordinator (MS DTC).</span></span>  
  
 <span data-ttu-id="3b2c5-198">Para más información, vea [Transacciones entre bases de datos no compatibles para la creación de reflejo de la base de datos o grupos de disponibilidad AlwaysOn &#40;SQL Server&#41;](../availability-groups/windows/transactions-always-on-availability-and-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="3b2c5-198">For more information, see [Cross-Database Transactions Not Supported For Database Mirroring or AlwaysOn Availability Groups &#40;SQL Server&#41;](../availability-groups/windows/transactions-always-on-availability-and-database-mirroring.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="3b2c5-199">Consulte también</span><span class="sxs-lookup"><span data-stu-id="3b2c5-199">See Also</span></span>  
 <span data-ttu-id="3b2c5-200">[Configurar la creación de reflejo de la base de datos &#40;SQL Server&#41;](setting-up-database-mirroring-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="3b2c5-200">[Setting Up Database Mirroring &#40;SQL Server&#41;](setting-up-database-mirroring-sql-server.md) </span></span>  
 [<span data-ttu-id="3b2c5-201">Seguridad de transporte para la creación de reflejo de la base de datos y Grupos de disponibilidad AlwaysOn &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="3b2c5-201">Transport Security for Database Mirroring and AlwaysOn Availability Groups &#40;SQL Server&#41;</span></span>](transport-security-database-mirroring-always-on-availability.md)  
  
  
