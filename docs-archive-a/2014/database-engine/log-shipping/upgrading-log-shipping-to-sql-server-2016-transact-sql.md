---
title: Actualizar el trasvase de registros a SQL Server 2014 (Transact-SQL) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- log shipping [SQL Server], upgrading
ms.assetid: b1289cc3-f5be-40bb-8801-0e3eed40336e
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 80330d03853c984cfd26100b02918eb218705085
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87677822"
---
# <a name="upgrade-log-shipping-to-sql-server-2014-transact-sql"></a><span data-ttu-id="1153f-102">Actualizar el trasvase de registros a SQL Server 2014 (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="1153f-102">Upgrade Log Shipping to SQL Server 2014 (Transact-SQL)</span></span>
  <span data-ttu-id="1153f-103">Es posible conservar las configuraciones de trasvase de registros al actualizar de [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)], [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)], [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)]o [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="1153f-103">It is possible to preserve log shipping configurations when upgrading from [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)], [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)], [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)], or [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="1153f-104">En este tema se describen escenarios alternativos y prácticas recomendadas para actualizar la configuración de trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="1153f-104">This topic describes alternative scenarios and best practices for upgrading a log shipping configuration.</span></span>

> [!NOTE]
>  <span data-ttu-id="1153f-105">La[compresión de copia de seguridad](../../relational-databases/backup-restore/backup-compression-sql-server.md) se incluyó en [!INCLUDE[ssEnterpriseEd10](../../includes/ssenterpriseed10-md.md)].</span><span class="sxs-lookup"><span data-stu-id="1153f-105">[Backup compression](../../relational-databases/backup-restore/backup-compression-sql-server.md) was introduced in [!INCLUDE[ssEnterpriseEd10](../../includes/ssenterpriseed10-md.md)].</span></span> <span data-ttu-id="1153f-106">Una configuración de trasvase de registros actualizada usa la opción de configuración de nivel de seguridad **Compresión de copia de seguridad predeterminada** para controlar si se emplea la compresión de copia de seguridad para los archivos de copia de seguridad del registro de transacciones.</span><span class="sxs-lookup"><span data-stu-id="1153f-106">An upgraded log shipping configuration uses the **backup compression default** server-level configuration option to control whether backup compression is used for the transaction log backup files.</span></span> <span data-ttu-id="1153f-107">El comportamiento de la compresión de las copias de seguridad de registros se puede especificar para cada configuración de trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="1153f-107">The backup compression behavior of log backups can be specified for each log shipping configuration.</span></span> <span data-ttu-id="1153f-108">Para obtener más información, vea [Configurar el trasvase de registros &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="1153f-108">For more information, see [Configure Log Shipping &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span></span>


##  <a name="protect-your-data-before-the-upgrade"></a><a name="ProtectData"></a> <span data-ttu-id="1153f-109">Proteger los datos antes de la actualización</span><span class="sxs-lookup"><span data-stu-id="1153f-109">Protect Your Data Before the Upgrade</span></span>
 <span data-ttu-id="1153f-110">Como práctica recomendada, es aconsejable que proteja sus datos antes de realizar una actualización del trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="1153f-110">As a best practice, we recommend that you protect your data before a log shipping upgrade.</span></span>

 <span data-ttu-id="1153f-111">**Para proteger los datos**</span><span class="sxs-lookup"><span data-stu-id="1153f-111">**To protect your data**</span></span>

1.  <span data-ttu-id="1153f-112">Realice una copia de seguridad completa de cada base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="1153f-112">Perform a full database backup on every primary database.</span></span>

     <span data-ttu-id="1153f-113">Para obtener más información, vea [Crear una copia de seguridad completa de base de datos &#40;SQL Server&#41;](../../relational-databases/backup-restore/create-a-full-database-backup-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="1153f-113">For more information, see [Create a Full Database Backup &#40;SQL Server&#41;](../../relational-databases/backup-restore/create-a-full-database-backup-sql-server.md).</span></span>

2.  <span data-ttu-id="1153f-114">Ejecute el comando [DBCC CHECKDB](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql) en cada base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="1153f-114">Run the [DBCC CHECKDB](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql) command on every primary database.</span></span>

##  <a name="upgrading-the-monitor-server-instance"></a><a name="UpgradeMonitor"></a><span data-ttu-id="1153f-115">Actualización de la instancia del servidor de supervisión</span><span class="sxs-lookup"><span data-stu-id="1153f-115">Upgrading the Monitor Server Instance</span></span>
 <span data-ttu-id="1153f-116">La instancia del servidor de supervisión, si existe, se puede actualizar en cualquier momento.</span><span class="sxs-lookup"><span data-stu-id="1153f-116">The monitor server instance, if any, can be upgraded at any time.</span></span>

 <span data-ttu-id="1153f-117">Mientras se actualiza el servidor de supervisión, la configuración de trasvase de registros continúa funcionando, pero su estado no se registra en las tablas del monitor.</span><span class="sxs-lookup"><span data-stu-id="1153f-117">While the monitor server is being upgraded, the log shipping configuration continues to work, but its status is not recorded in the tables on the monitor.</span></span> <span data-ttu-id="1153f-118">Cualquier alerta que se haya configurado no se desencadenará mientras el servidor de supervisión se esté actualizando.</span><span class="sxs-lookup"><span data-stu-id="1153f-118">Any alerts that have been configured will not be triggered while the monitor server is being upgraded.</span></span> <span data-ttu-id="1153f-119">Después de la actualización, puede actualizar la información de las tablas del monitor ejecutando el procedimiento almacenado del sistema [sp_refresh_log_shipping_monitor](/sql/relational-databases/system-stored-procedures/sp-refresh-log-shipping-monitor-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="1153f-119">After the upgrade, you can update the information in the monitor tables by executing the [sp_refresh_log_shipping_monitor](/sql/relational-databases/system-stored-procedures/sp-refresh-log-shipping-monitor-transact-sql) system stored procedure.</span></span>

##  <a name="upgrading-log-shipping-configurations-with-a-single-secondary-server"></a><a name="UpgradeSingleSecondary"></a><span data-ttu-id="1153f-120">Actualización de configuraciones de trasvase de registros con un único servidor secundario</span><span class="sxs-lookup"><span data-stu-id="1153f-120">Upgrading Log Shipping Configurations with a Single Secondary Server</span></span>
 <span data-ttu-id="1153f-121">El proceso de actualización descrito en esta sección supone una configuración que consta del servidor principal y de un único servidor secundario.</span><span class="sxs-lookup"><span data-stu-id="1153f-121">The upgrade process described in this section assumes a configuration consisting of the primary server and only one secondary server.</span></span> <span data-ttu-id="1153f-122">Esta configuración se representa en la ilustración siguiente, que muestra una instancia del servidor principal, A, y una única instancia del servidor secundario, B.</span><span class="sxs-lookup"><span data-stu-id="1153f-122">This configuration is represented in the following illustration, which shows a primary server instance, A, and a single secondary server instance, B.</span></span>

 <span data-ttu-id="1153f-123">![Un servidor secundario y ningún servidor supervisor](../media/ls-2-wayconfig-nomonitor.gif "Un servidor secundario y ningún servidor supervisor")</span><span class="sxs-lookup"><span data-stu-id="1153f-123">![One secondary server and no monitor server](../media/ls-2-wayconfig-nomonitor.gif "One secondary server and no monitor server")</span></span>

 <span data-ttu-id="1153f-124">Para obtener información sobre cómo actualizar varios servidores secundarios, vea [Actualizar varias instancias de servidores secundarios](#MultipleSecondaries), más adelante en este tema.</span><span class="sxs-lookup"><span data-stu-id="1153f-124">For information about upgrading multiple secondary servers, see [Upgrading Multiple Secondary Server Instances](#MultipleSecondaries), later in this topic.</span></span>
 

###  <a name="upgrading-the-secondary-server-instance"></a><a name="UpgradeSecondary"></a><span data-ttu-id="1153f-125">Actualización de la instancia del servidor secundario</span><span class="sxs-lookup"><span data-stu-id="1153f-125">Upgrading the Secondary Server Instance</span></span>
 <span data-ttu-id="1153f-126">El proceso de actualización implica actualizar las instancias de los servidores secundarios de una configuración de trasvase de registros de [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] o posterior a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] antes de actualizar la instancia del servidor principal.</span><span class="sxs-lookup"><span data-stu-id="1153f-126">The upgrade process involves upgrading the secondary server instances of a [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] or higher log shipping configuration to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] before upgrading the primary server instance.</span></span> <span data-ttu-id="1153f-127">Actualice siempre la instancia del servidor secundario en primer lugar.</span><span class="sxs-lookup"><span data-stu-id="1153f-127">Always upgrade the secondary server instance first.</span></span> <span data-ttu-id="1153f-128">Si el servidor principal se actualizara antes que un servidor secundario, se produciría un error en el trasvase de registros porque una copia de seguridad creada en una versión más reciente de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] no se puede restaurar en una versión anterior de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="1153f-128">If the primary server were upgraded before a secondary server, log shipping would fail because a backup created on a newer version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] cannot be restored on an older version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>

 <span data-ttu-id="1153f-129">El trasvase de registros continúa a lo largo del proceso de actualización porque los servidores secundarios actualizados continúan restaurando las copias de seguridad de registros a partir del servidor principal de [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] o versiones posteriores.</span><span class="sxs-lookup"><span data-stu-id="1153f-129">Log shipping continues throughout the upgrade process because the upgraded secondary servers continue to restore the log backups from the [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] or higher primary server.</span></span> <span data-ttu-id="1153f-130">El proceso para actualizar las instancias de los servidores secundarios depende en parte de si la configuración de trasvase de registros posee varios servidores secundarios.</span><span class="sxs-lookup"><span data-stu-id="1153f-130">The process for upgrading the secondary server instances depends partly on whether the log shipping configuration possesses multiple secondary servers.</span></span> <span data-ttu-id="1153f-131">Para obtener más información, vea [Actualizar varias instancias del servidor secundario](#MultipleSecondaries), posteriormente en este tema.</span><span class="sxs-lookup"><span data-stu-id="1153f-131">For more information, see [Upgrading Multiple Secondary Server Instances](#MultipleSecondaries), later in this topic.</span></span>

 <span data-ttu-id="1153f-132">Mientras se actualiza la instancia del servidor secundario, no se ejecutan los trabajos de copia y restauración del trasvase de registros, por lo que se acumularán las copias de seguridad de registros de transacciones sin restaurar.</span><span class="sxs-lookup"><span data-stu-id="1153f-132">While the secondary server instance is being upgraded, the log shipping copy and restore jobs do not run, so unrestored transaction log backups will accumulate.</span></span> <span data-ttu-id="1153f-133">El grado de acumulación depende de la frecuencia de la copia de seguridad programada en el servidor principal.</span><span class="sxs-lookup"><span data-stu-id="1153f-133">The amount of accumulation depends on the frequency of scheduled backup on the primary server.</span></span> <span data-ttu-id="1153f-134">Además, si se ha configurado un servidor de supervisión independiente, se podrían generar alertas que indiquen que no se han realizado restauraciones durante más tiempo que el intervalo configurado.</span><span class="sxs-lookup"><span data-stu-id="1153f-134">Also, if a separate monitor server has been configured, alerts might be raised indicating restores have not been performed for longer than the configured interval.</span></span>

 <span data-ttu-id="1153f-135">Una vez actualizado el servidor secundario, los trabajos de los agentes de trasvase de registros se reanudan y continúan copiando y restaurando las copias de seguridad de registros a partir de la instancia del servidor principal, el servidor A. La cantidad de tiempo requerida para que el servidor secundario ponga al día la base de datos secundaria varía, dependiendo del tiempo que se tarde en actualizar el servidor secundario y la frecuencia de las copias de seguridad en el servidor principal.</span><span class="sxs-lookup"><span data-stu-id="1153f-135">Once the secondary server has been upgraded, the log shipping agents jobs resume and continue to copy and restore log backups from the primary server instance, server A. The amount of time required for the secondary server to bring the secondary database up to date varies, depending on the time taken to upgrade the secondary server and the frequency of the backups on the primary server.</span></span>

> [!NOTE]
>  <span data-ttu-id="1153f-136">Durante la actualización del servidor, la base de datos secundaria no se actualiza a una base de datos de [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="1153f-136">During the server upgrade, the secondary database is not upgraded to a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] database.</span></span> <span data-ttu-id="1153f-137">Solo se actualizará si se pone en conexión.</span><span class="sxs-lookup"><span data-stu-id="1153f-137">It will get upgraded only if it is brought online.</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="1153f-138">La opción RESTORE WITH STANDBY no se admite para una base de datos que requiere actualizarse.</span><span class="sxs-lookup"><span data-stu-id="1153f-138">The RESTORE WITH STANDBY option is not supported for a database that requires upgrading.</span></span> <span data-ttu-id="1153f-139">Si una base de datos secundaria actualizada se ha configurado utilizando RESTORE WITH STANDBY, los registros de transacciones ya no se pueden restaurar después de la actualización.</span><span class="sxs-lookup"><span data-stu-id="1153f-139">If an upgraded secondary database has been configured by using RESTORE WITH STANDBY, transaction logs can no longer be restored after upgrade.</span></span> <span data-ttu-id="1153f-140">Para reanudar el trasvase de registros en esa base de datos secundaria, tendrá que configurarlo de nuevo en ese servidor de reserva.</span><span class="sxs-lookup"><span data-stu-id="1153f-140">To resume log shipping on that secondary database, you will need to set up log shipping again on that standby server.</span></span> <span data-ttu-id="1153f-141">Para obtener más información acerca de la opción STANDBY, vea [arguments restore &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-arguments-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="1153f-141">For more information about the STANDBY option, see [RESTORE Arguments &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-arguments-transact-sql).</span></span>

###  <a name="upgrading-the-primary-server-instance"></a><a name="UpgradePrimary"></a> <span data-ttu-id="1153f-142">Actualizar la instancia del servidor principal</span><span class="sxs-lookup"><span data-stu-id="1153f-142">Upgrading the Primary Server Instance</span></span>
 <span data-ttu-id="1153f-143">Al planear una actualización, es importante tener en cuenta la cantidad de tiempo que la base de datos dejará de estar disponible.</span><span class="sxs-lookup"><span data-stu-id="1153f-143">When planning an upgrade, a significant consideration is the amount of time that your database will be unavailable.</span></span> <span data-ttu-id="1153f-144">El escenario de actualización más sencillo implica que la base de datos no esté disponible mientras se actualiza el servidor principal (escenario 1, a continuación).</span><span class="sxs-lookup"><span data-stu-id="1153f-144">The simplest upgrade scenario involves the database being unavailable while you upgrade the primary server (scenario 1, below).</span></span>

 <span data-ttu-id="1153f-145">A costa de un proceso de actualización más complicado, puede obtener la máxima disponibilidad de la base de datos conmutando por error el servidor principal de [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] o posterior al servidor secundario de [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] antes de actualizar el servidor principal original (escenario 2, a continuación).</span><span class="sxs-lookup"><span data-stu-id="1153f-145">At the cost of a more complicated upgrade process, you can maximize your database availability by failing over the [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] or higher primary server to a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] secondary server before upgrading the original primary server (scenario 2, below).</span></span> <span data-ttu-id="1153f-146">Hay dos variantes del escenario de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="1153f-146">There are two variants of the failover scenario.</span></span> <span data-ttu-id="1153f-147">Puede volver al servidor principal original y mantener la configuración de trasvase de registros original.</span><span class="sxs-lookup"><span data-stu-id="1153f-147">You can switch back to the original primary server and keep the original log shipping configuration.</span></span> <span data-ttu-id="1153f-148">O bien, puede quitar la configuración de trasvase de registros original antes de actualizar el servidor principal original y después crear una configuración nueva usando el servidor principal nuevo.</span><span class="sxs-lookup"><span data-stu-id="1153f-148">Alternatively, you can remove the original log shipping configuration before upgrading the original primary server and later create a new configuration using the new primary server.</span></span> <span data-ttu-id="1153f-149">En esta sección se describen ambos escenarios.</span><span class="sxs-lookup"><span data-stu-id="1153f-149">This section describes both these scenarios.</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="1153f-150">Asegúrese de actualizar la instancia del servidor secundario antes de actualizar la instancia del servidor principal.</span><span class="sxs-lookup"><span data-stu-id="1153f-150">Be sure to upgrade the secondary server instance before upgrading the primary server instance.</span></span> <span data-ttu-id="1153f-151">Para obtener más información, vea [Actualizar la instancia del servidor secundario](#UpgradeSecondary), anteriormente en este tema.</span><span class="sxs-lookup"><span data-stu-id="1153f-151">For more information, see [Upgrading the Secondary Server Instance](#UpgradeSecondary), earlier in this topic.</span></span>


####  <a name="scenario-1-upgrade-primary-server-instance-without-failover"></a><a name="Scenario1"></a><span data-ttu-id="1153f-152">Escenario 1: actualizar la instancia del servidor principal sin conmutación por error</span><span class="sxs-lookup"><span data-stu-id="1153f-152">Scenario 1: Upgrade Primary Server Instance Without Failover</span></span>
 <span data-ttu-id="1153f-153">Este es el escenario más sencillo, pero ocasiona más tiempo de inactividad que la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="1153f-153">This is the simpler scenario, but it causes more downtime than using failover.</span></span> <span data-ttu-id="1153f-154">Simplemente se actualiza la instancia del servidor principal y la base de datos no está disponible durante la actualización.</span><span class="sxs-lookup"><span data-stu-id="1153f-154">The primary server instance is simply upgraded and the database is unavailable during this upgrade.</span></span>

 <span data-ttu-id="1153f-155">Una vez actualizado el servidor, la base de datos se vuelve a poner en línea automáticamente, lo que hace que se actualice.</span><span class="sxs-lookup"><span data-stu-id="1153f-155">Once the server is upgraded, the database is automatically brought back online, which causes it to be upgraded.</span></span> <span data-ttu-id="1153f-156">Una vez actualizada la base de datos, los trabajos de trasvase de registros se reanudan.</span><span class="sxs-lookup"><span data-stu-id="1153f-156">After the database is upgraded, the log shipping jobs resume.</span></span>

#### <a name="scenario-2-upgrade-primary-server-instance-with-failover"></a><span data-ttu-id="1153f-157">Escenario 2: actualizar la instancia del servidor principal con conmutación por error</span><span class="sxs-lookup"><span data-stu-id="1153f-157">Scenario 2: Upgrade Primary Server Instance with Failover</span></span>
 <span data-ttu-id="1153f-158">En este escenario se obtiene la máxima disponibilidad y se reduce al mínimo el tiempo de inactividad.</span><span class="sxs-lookup"><span data-stu-id="1153f-158">This scenario maximizes availability and minimizes downtime.</span></span> <span data-ttu-id="1153f-159">Utiliza una conmutación por error controlada a la instancia del servidor secundario, lo que mantiene la base de datos disponible mientras se actualiza la instancia del servidor principal original.</span><span class="sxs-lookup"><span data-stu-id="1153f-159">It utilizes a controlled failover to the secondary server instance, which keeps the database available while the original primary server instance is upgraded.</span></span> <span data-ttu-id="1153f-160">El tiempo de inactividad se limita al tiempo relativamente corto que se requiere para la conmutación por error, en lugar del tiempo exigido para actualizar la instancia del servidor principal.</span><span class="sxs-lookup"><span data-stu-id="1153f-160">Downtime is limited to the relatively short time required to fail over, rather than the time required to upgrade the primary server instance.</span></span>

 <span data-ttu-id="1153f-161">Actualizar la instancia del servidor principal con conmutación por error implica tres procedimientos generales: realizar una conmutación por error controlada al servidor secundario, actualizar la instancia del servidor principal original a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]y configurar el trasvase de registros en una instancia del servidor principal de [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="1153f-161">Upgrading the primary server instance with failover involves three general procedures: performing a controlled failover to the secondary server, upgrading the original primary server instance to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)], and setting up log shipping on a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] primary server instance.</span></span> <span data-ttu-id="1153f-162">Estos procedimientos se describen en esta sección.</span><span class="sxs-lookup"><span data-stu-id="1153f-162">These procedures are described in this section.</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="1153f-163">Si piensa tener la instancia del servidor secundario como instancia del nuevo servidor principal, tiene que quitar la configuración de trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="1153f-163">If you plan to have the secondary server instance as the new primary server instance, you need to remove the log shipping configuration.</span></span> <span data-ttu-id="1153f-164">Una vez actualizada la instancia del servidor principal original, será preciso reconfigurar el trasvase de registros desde el nuevo servidor principal hasta el nuevo servidor secundario.</span><span class="sxs-lookup"><span data-stu-id="1153f-164">Log shipping will need to be reconfigured from the new primary to the new secondary, after the original primary server instance has been upgraded.</span></span> <span data-ttu-id="1153f-165">Para obtener más información, vea [quitar el trasvase de registros &#40;SQL Server&#41;](remove-log-shipping-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="1153f-165">For more information, see [Remove Log Shipping &#40;SQL Server&#41;](remove-log-shipping-sql-server.md).</span></span>


#####  <a name="procedure-1-perform-a-controlled-failover-to-the-secondary-server"></a><a name="Procedure1"></a><span data-ttu-id="1153f-166">Procedimiento 1: realizar una conmutación por error controlada al servidor secundario</span><span class="sxs-lookup"><span data-stu-id="1153f-166">Procedure 1: Perform a Controlled Failover to the Secondary Server</span></span>
 <span data-ttu-id="1153f-167">Conmutación por error controlada al servidor secundario:</span><span class="sxs-lookup"><span data-stu-id="1153f-167">Controlled failover to the secondary server:</span></span>

1.  <span data-ttu-id="1153f-168">Realice manualmente una [copia del final del registro](../../relational-databases/backup-restore/tail-log-backups-sql-server.md) del registro de transacciones en la base de datos principal especificando WITH NORECOVERY.</span><span class="sxs-lookup"><span data-stu-id="1153f-168">Manually perform a [tail-log backup](../../relational-databases/backup-restore/tail-log-backups-sql-server.md) of the transaction log on the primary database specifying WITH NORECOVERY.</span></span> <span data-ttu-id="1153f-169">Esta copia de seguridad de registros captura cualquier entrada del registro que todavía no se haya incluido en la copia de seguridad y deja la base de datos sin conexión.</span><span class="sxs-lookup"><span data-stu-id="1153f-169">This log backup captures any log records that have not been backed up yet and takes the database offline.</span></span> <span data-ttu-id="1153f-170">Tenga en cuenta que mientras la base de datos esté sin conexión, se producirá un error en el trabajo de copia de seguridad del trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="1153f-170">Note that while the database is offline, the log shipping backup job will fail.</span></span>

     <span data-ttu-id="1153f-171">En el ejemplo siguiente se crea una copia del final del registro de la base de datos `AdventureWorks` en el servidor principal.</span><span class="sxs-lookup"><span data-stu-id="1153f-171">The following example creates a tail log backup of the `AdventureWorks` database on the primary server.</span></span> <span data-ttu-id="1153f-172">El archivo de copia de seguridad se denomina `Failover_AW_20080315.trn`:</span><span class="sxs-lookup"><span data-stu-id="1153f-172">The backup file is named `Failover_AW_20080315.trn`:</span></span>

    ```
    BACKUP LOG AdventureWorks 
      TO DISK = N'\\FileServer\LogShipping\AdventureWorks\Failover_AW_20080315.trn' 
       WITH NORECOVERY;
    GO
    ```

     <span data-ttu-id="1153f-173">Se recomienda que utilice una convención de nomenclatura de archivos distinta para diferenciar el archivo de copia de seguridad creado manualmente de los que crea el trabajo de copia de seguridad de trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="1153f-173">We recommend that you use a distinct file naming convention to differentiate the manually-created backup file from the backup files created by the log shipping backup job.</span></span>

2.  <span data-ttu-id="1153f-174">En el servidor secundario:</span><span class="sxs-lookup"><span data-stu-id="1153f-174">On the secondary server:</span></span>

    1.  <span data-ttu-id="1153f-175">Asegúrese de que se han aplicado todas las copias de seguridad realizadas automáticamente por los trabajos de copia de seguridad de trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="1153f-175">Ensure that all backups taken automatically by the log shipping backup jobs have been applied.</span></span> <span data-ttu-id="1153f-176">Para comprobar qué trabajos de copia de seguridad se han aplicado, use el procedimiento almacenado del sistema [sp_help_log_shipping_monitor](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-monitor-transact-sql) en el servidor de supervisión o en los servidores principal y secundario.</span><span class="sxs-lookup"><span data-stu-id="1153f-176">To check which backup jobs have been applied, use the [sp_help_log_shipping_monitor](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-monitor-transact-sql) system stored procedure on the monitor server or on the primary and secondary servers.</span></span> <span data-ttu-id="1153f-177">El mismo archivo debe aparecer en las columnas **last_backup_file**, **last_copied_file**y **last_restored_file** .</span><span class="sxs-lookup"><span data-stu-id="1153f-177">The same file should be listed in the **last_backup_file**, **last_copied_file**, and **last_restored_file** columns.</span></span> <span data-ttu-id="1153f-178">Si alguno de los archivos de copia de seguridad no se ha copiado y restaurado, invoque manualmente los trabajos de restauración y copia del agente para la configuración de trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="1153f-178">If any of the backup files have not been copied and restored, manually invoke the agent copy and restore jobs for the log shipping configuration.</span></span>

         <span data-ttu-id="1153f-179">Para obtener información sobre cómo iniciar un trabajo, vea [Start a Job](../../ssms/agent/start-a-job.md).</span><span class="sxs-lookup"><span data-stu-id="1153f-179">For information about starting a job, see [Start a Job](../../ssms/agent/start-a-job.md).</span></span>

    2.  <span data-ttu-id="1153f-180">Copie el archivo de copia de seguridad del final del registro que creó en el paso 1 desde el recurso compartido de archivos en la ubicación local usada por el trasvase de registros del servidor secundario.</span><span class="sxs-lookup"><span data-stu-id="1153f-180">Copy your the final log backup file that you created in step 1 from the file share to the local location that is used by log shipping on the secondary server.</span></span>

    3.  <span data-ttu-id="1153f-181">Restaure la copia de seguridad del final del registro especificando WITH RECOVERY para poner en línea la base de datos.</span><span class="sxs-lookup"><span data-stu-id="1153f-181">Restore the final log backup specifying WITH RECOVERY to bring the database online.</span></span> <span data-ttu-id="1153f-182">Al ponerse en línea, la base de datos se actualizará a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="1153f-182">As part of being brought online, the database will upgraded to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span>

         <span data-ttu-id="1153f-183">En el ejemplo siguiente se restaura la copia del final del registro de la base de datos `AdventureWorks` en la base de datos secundaria.</span><span class="sxs-lookup"><span data-stu-id="1153f-183">The following example restores the tail log backup of the `AdventureWorks` database on the secondary database.</span></span> <span data-ttu-id="1153f-184">En el ejemplo se usa la opción WITH RECOVERY, que pone en línea la base de datos:</span><span class="sxs-lookup"><span data-stu-id="1153f-184">The example uses the WITH RECOVERY option, which brings the database online:</span></span>

        ```
        RESTORE LOG AdventureWorks 
          FROM DISK = N'c:\logshipping\Failover_AW_20080315.trn' 
           WITH RECOVERY;
        GO
        ```

        > [!NOTE]
        >  <span data-ttu-id="1153f-185">En una configuración que contenga más de un servidor secundario, hay consideraciones adicionales.</span><span class="sxs-lookup"><span data-stu-id="1153f-185">For a configuration that contains more than one secondary server, there are additional considerations.</span></span> <span data-ttu-id="1153f-186">Para obtener más información, vea [Actualizar varias instancias del servidor secundario](#MultipleSecondaries), posteriormente en este tema.</span><span class="sxs-lookup"><span data-stu-id="1153f-186">For more information, see [Upgrading Multiple Secondary Server Instances](#MultipleSecondaries), later in this topic.</span></span>

    4.  <span data-ttu-id="1153f-187">Realice la conmutación por error de la base de datos redirigiendo a los clientes del servidor principal original (servidor A) al servidor secundario (servidor B) en línea.</span><span class="sxs-lookup"><span data-stu-id="1153f-187">Fail over the database by redirecting clients from the original primary server (server A) to the online secondary server (server B).</span></span>

    5.  <span data-ttu-id="1153f-188">Tenga cuidado de que el registro de transacciones de la base de datos secundaria no se llene mientras la base de datos está en línea.</span><span class="sxs-lookup"><span data-stu-id="1153f-188">Take care that the transaction log of the secondary database does not fill while the database is online.</span></span> <span data-ttu-id="1153f-189">Para evitar que el registro de transacciones se llene, puede que sea necesario realizar una copia de seguridad del mismo.</span><span class="sxs-lookup"><span data-stu-id="1153f-189">To prevent the transaction log from filling, you might need to back it up.</span></span> <span data-ttu-id="1153f-190">En ese caso, se recomienda que ponga la copia de seguridad en una ubicación compartida, un *recurso compartido de copia de seguridad*, de modo que las copias de seguridad estén disponibles para restaurarse en la otra instancia del servidor.</span><span class="sxs-lookup"><span data-stu-id="1153f-190">If so, we recommend that you back it up to a shared location, a *backup share*, to make the backups available for restoring on the other server instance.</span></span>

#####  <a name="procedure-2-upgrade-the-original-primary-server-instance-to-sscurrent"></a><a name="Procedure2"></a><span data-ttu-id="1153f-191">Procedimiento 2: actualizar la instancia del servidor principal original a[!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]</span><span class="sxs-lookup"><span data-stu-id="1153f-191">Procedure 2: Upgrade the Original Primary Server Instance to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]</span></span>
 <span data-ttu-id="1153f-192">Después de actualizar la instancia del servidor principal original a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)], la base de datos todavía estará sin conexión y en el formato.</span><span class="sxs-lookup"><span data-stu-id="1153f-192">After you upgrade the original primary server instance to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)], the database will still be offline and in the format.</span></span>

#####  <a name="procedure-3-set-up-log-shipping-on-sscurrent"></a><a name="Procedure3"></a><span data-ttu-id="1153f-193">Procedimiento 3: configurar el trasvase de registros en[!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]</span><span class="sxs-lookup"><span data-stu-id="1153f-193">Procedure 3: Set Up Log Shipping on [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]</span></span>
 <span data-ttu-id="1153f-194">El resto del proceso de actualización depende de si el trasvase de registros sigue estando configurado, como se explica a continuación:</span><span class="sxs-lookup"><span data-stu-id="1153f-194">The rest of the upgrade process depends on whether log shipping is still configured, as follows:</span></span>

-   <span data-ttu-id="1153f-195">Si ha conservado la configuración de trasvase de registros de [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)]o posterior, vuelva a la instancia del servidor principal original.</span><span class="sxs-lookup"><span data-stu-id="1153f-195">If you have kept the [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)]or higher log shipping configuration, switch back to the original primary server instance.</span></span> <span data-ttu-id="1153f-196">Para obtener más información, vea [Para volver a la instancia del servidor principal original](#SwitchToOrigPrimary), más adelante en esta sección.</span><span class="sxs-lookup"><span data-stu-id="1153f-196">For more information, see [To Switch Back to the Original Primary Server Instance](#SwitchToOrigPrimary), later in this section.</span></span>

-   <span data-ttu-id="1153f-197">Si quitó la configuración de trasvase de registros antes de la conmutación por error, cree una nueva configuración de trasvase de registros en la que la instancia del servidor secundario original sea la instancia del nuevo servidor principal.</span><span class="sxs-lookup"><span data-stu-id="1153f-197">If you removed the log shipping configuration before failing over, create a new log shipping configuration in which the original secondary server instance is the new primary server instance.</span></span> <span data-ttu-id="1153f-198">Para obtener más información, vea [Para mantener la instancia del servidor secundario anterior como instancia del nuevo servidor principal](#KeepOldSecondaryAsNewPrimary), posteriormente en esta sección.</span><span class="sxs-lookup"><span data-stu-id="1153f-198">For more information, see [To Keep the Old Secondary Server Instance As the New Primary Server Instance](#KeepOldSecondaryAsNewPrimary), later in this section.</span></span>

######  <a name="to-switch-back-to-the-original-primary-server-instance"></a><a name="SwitchToOrigPrimary"></a><span data-ttu-id="1153f-199">Para volver a la instancia del servidor principal original</span><span class="sxs-lookup"><span data-stu-id="1153f-199">To Switch Back to the Original Primary Server Instance</span></span>

1.  <span data-ttu-id="1153f-200">En el servidor principal provisional (servidor B), haga una copia de seguridad del final del registro usando WITH NORECOVERY para crear una copia del final del registro y dejar la base de datos sin conexión.</span><span class="sxs-lookup"><span data-stu-id="1153f-200">On the interim primary server (server B), back up the tail of the log using WITH NORECOVERY to create a tail-log backup and take the database offline.</span></span> <span data-ttu-id="1153f-201">La copia de seguridad del final del registro se denomina `Switchback_AW_20080315.trn`. Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="1153f-201">The tail log backup is named `Switchback_AW_20080315.trn`.For example:</span></span>

    ```
    BACKUP LOG AdventureWorks 
      TO DISK = N'\\FileServer\LogShipping\AdventureWorks\Switchback_AW_20080315.trn' 
       WITH NORECOVERY;
    GO
    ```

2.  <span data-ttu-id="1153f-202">Si se realizó alguna copia de seguridad de registros de transacciones en la base de datos principal provisional exceptuando la copia de seguridad del final del registro que creó en el paso 1, restaure esas copias de seguridad del registro usando WITH NORECOVERY en la base de datos sin conexión del servidor principal original (servidor A).</span><span class="sxs-lookup"><span data-stu-id="1153f-202">If any transaction log backups were taken on the interim primary database, other than the tail backup that you created in step 1, restore those log backups using WITH NORECOVERY to the offline database on the original primary server (server A).</span></span> <span data-ttu-id="1153f-203">La base de datos se actualiza al formato de [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] cuando se restaura la primera copia de seguridad de registros.</span><span class="sxs-lookup"><span data-stu-id="1153f-203">The database is upgraded to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] format when the first log backup is restored.</span></span>

3.  <span data-ttu-id="1153f-204">Restaure la copia del final del registro, `Switchback_AW_20080315.trn`, en la base de datos principal original (en servidor A) usando WITH RECOVERY para poner en línea la base de datos.</span><span class="sxs-lookup"><span data-stu-id="1153f-204">Restore the tail-log backup, `Switchback_AW_20080315.trn`, on the original primary database (on server A) using WITH RECOVERY to bring the database online.</span></span>

4.  <span data-ttu-id="1153f-205">Conmute por error de nuevo a la base de datos principal original (en el servidor A) redirigiendo a los clientes del servidor secundario en línea al servidor principal original.</span><span class="sxs-lookup"><span data-stu-id="1153f-205">Fail over back to the original primary database (on server A) by redirecting clients to the online secondary server from the original primary server.</span></span>

 <span data-ttu-id="1153f-206">Una vez que la base de datos se ponga en línea, se reanudará la configuración de trasvase de registros original.</span><span class="sxs-lookup"><span data-stu-id="1153f-206">After the database comes online, the original log shipping configuration will resume.</span></span>

######  <a name="to-keep-the-old-secondary-server-instance-as-the-new-primary-server-instance"></a><a name="KeepOldSecondaryAsNewPrimary"></a><span data-ttu-id="1153f-207">Para mantener la instancia del servidor secundario anterior como instancia del nuevo servidor principal</span><span class="sxs-lookup"><span data-stu-id="1153f-207">To Keep the Old Secondary Server Instance As the New Primary Server Instance</span></span>
 <span data-ttu-id="1153f-208">Establezca una nueva configuración de trasvase de registros utilizando la instancia del servidor secundario anterior, B, como servidor principal y la instancia del servidor principal anterior, A, como nuevo servidor secundario, de la forma siguiente:</span><span class="sxs-lookup"><span data-stu-id="1153f-208">Establish a new log shipping configuration using the old secondary server instance, B, as the primary server and the old primary server instance, A, as the new secondary server, as follows:</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="1153f-209">La configuración de trasvase de registros anterior se debería haber quitado del servidor principal original al principio del proceso, antes de realizar la copia de seguridad manual del registro de transacciones que puso sin conexión la base de datos.</span><span class="sxs-lookup"><span data-stu-id="1153f-209">The old log shipping configuration should have been removed from the original primary server at the start of the process before taking the manual transaction log backup that took the database offline.</span></span>

1.  <span data-ttu-id="1153f-210">Para evitar realizar una copia de seguridad y restauración completa de la base de datos en el nuevo servidor secundario (servidor A), aplique las copias de seguridad de registros desde la nueva base de datos principal hasta la nueva base de datos secundaria.</span><span class="sxs-lookup"><span data-stu-id="1153f-210">To avoid performing a complete backup and restore of the database on the new secondary server (server A), apply the log backups from the new primary database to the new secondary database.</span></span> <span data-ttu-id="1153f-211">En la configuración del ejemplo, esto implica restaurar las copias de seguridad de registros tomadas en el servidor B a la base de datos del servidor A.</span><span class="sxs-lookup"><span data-stu-id="1153f-211">In the example configuration, this involves restoring the log backups taken on server B to the database on server A.</span></span>

2.  <span data-ttu-id="1153f-212">Haga una copia de seguridad de registros desde la nueva base de datos principal (en el servidor B).</span><span class="sxs-lookup"><span data-stu-id="1153f-212">Back up the log from the new primary database (on server B).</span></span>

3.  <span data-ttu-id="1153f-213">Restaure las copias de seguridad de registros en la instancia del nuevo servidor secundario (servidor A) usando WITH NORECOVERY.</span><span class="sxs-lookup"><span data-stu-id="1153f-213">Restore the log backups to the new secondary server instance (server A) using WITH NORECOVERY.</span></span> <span data-ttu-id="1153f-214">La primera operación de restauración actualiza la base de datos a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="1153f-214">The first restore operation updates the database to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span>

4.  <span data-ttu-id="1153f-215">Configure el trasvase de registros con el servidor secundario antiguo (servidor B) como instancia del servidor principal.</span><span class="sxs-lookup"><span data-stu-id="1153f-215">Configure log shipping with the former secondary server (server B) as the primary server instance.</span></span>

    > [!IMPORTANT]
    >  <span data-ttu-id="1153f-216">Si usa [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], especifique que la base de datos secundaria ya está inicializada.</span><span class="sxs-lookup"><span data-stu-id="1153f-216">If you use [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], specify that the secondary database is already initialized.</span></span>

     <span data-ttu-id="1153f-217">Para obtener más información, vea [Configurar el trasvase de registros &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="1153f-217">For more information, see [Configure Log Shipping &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span></span>

5.  <span data-ttu-id="1153f-218">Realice la conmutación por error de la base de datos redirigiendo a los clientes del servidor principal original (servidor A) al servidor secundario (servidor B) en línea.</span><span class="sxs-lookup"><span data-stu-id="1153f-218">Fail over the database by redirecting clients from the original primary server (server A) to the online secondary server (server B).</span></span>

    > [!IMPORTANT]
    >  <span data-ttu-id="1153f-219">Cuando realice la conmutación por error a una nueva base de datos primaria, debe asegurarse de que sus metadatos sean coherentes con los de la base de datos principal original.</span><span class="sxs-lookup"><span data-stu-id="1153f-219">When you failover to a new primary database, you should ensure that its metadata is consistent with the metadata of the original primary database.</span></span> <span data-ttu-id="1153f-220">Para obtener más información, vea [Administrar los metadatos cuando una base de datos pasa a estar disponible en otra instancia del servidor &#40;SQL Server&#41;](../../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md).</span><span class="sxs-lookup"><span data-stu-id="1153f-220">For more information, see [Manage Metadata When Making a Database Available on Another Server Instance &#40;SQL Server&#41;](../../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md).</span></span>

##  <a name="upgrading-multiple-secondary-server-instances"></a><a name="MultipleSecondaries"></a><span data-ttu-id="1153f-221">Actualización de varias instancias del servidor secundario</span><span class="sxs-lookup"><span data-stu-id="1153f-221">Upgrading Multiple Secondary Server Instances</span></span>
 <span data-ttu-id="1153f-222">Esta configuración se representa en la ilustración siguiente, que muestra una instancia del servidor principal, A, y dos instancias de servidores secundarios, B y C.</span><span class="sxs-lookup"><span data-stu-id="1153f-222">This configuration is represented in the following illustration, which shows a primary server instance, A, and two secondary server instances, B and C.</span></span>

 <span data-ttu-id="1153f-223">![Dos servidores secundarios y ningún servidor supervisor](../media/ls-3-wayconfig-nomonitor.gif "Dos servidores secundarios y ningún servidor supervisor")</span><span class="sxs-lookup"><span data-stu-id="1153f-223">![Two secondary servers and no monitor server](../media/ls-3-wayconfig-nomonitor.gif "Two secondary servers and no monitor server")</span></span>

 <span data-ttu-id="1153f-224">En esta sección se explica cómo actualizar con una conmutación por error y después volver al servidor principal original.</span><span class="sxs-lookup"><span data-stu-id="1153f-224">This section discusses how to upgrade using a failover and then switching back to the original primary server.</span></span> <span data-ttu-id="1153f-225">Al actualizar la instancia principal con conmutación por error, el proceso es más complejo si hay varias instancias de servidores secundarios.</span><span class="sxs-lookup"><span data-stu-id="1153f-225">When upgrading the primary instance with failover the process is more complex when there are multiple secondary server instances.</span></span> <span data-ttu-id="1153f-226">En el procedimiento siguiente, una vez actualizados todos los servidores secundarios, el servidor principal conmuta por error a una de las bases de datos secundarias actualizadas.</span><span class="sxs-lookup"><span data-stu-id="1153f-226">In the following procedure, after all the secondary servers are upgraded, the primary server is failed over to one of the upgraded secondary databases.</span></span> <span data-ttu-id="1153f-227">Se actualiza el servidor principal original y el trasvase de registros conmuta por error a él.</span><span class="sxs-lookup"><span data-stu-id="1153f-227">The original primary server is upgraded, and log shipping is failed over back to it.</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="1153f-228">Actualice siempre todas las instancias de los servidores secundarios antes de actualizar el servidor principal.</span><span class="sxs-lookup"><span data-stu-id="1153f-228">Always upgrade all the secondary server instances before you upgrade the primary server.</span></span>

 <span data-ttu-id="1153f-229">**Para actualizar con una conmutación por error y volver al servidor principal original.**</span><span class="sxs-lookup"><span data-stu-id="1153f-229">**To upgrade using a failover and then switching back to original primary server**</span></span>

1.  <span data-ttu-id="1153f-230">Actualice todas las instancias de los servidores secundarios (servidor B y servidor C).</span><span class="sxs-lookup"><span data-stu-id="1153f-230">Upgrade all the secondary server instances (server B and server C).</span></span>

2.  <span data-ttu-id="1153f-231">Obtenga el final del registro de transacciones de la base de datos principal (en el servidor A) y ponga la base de datos sin conexión, haciendo una copia de seguridad de registros de transacciones usando WITH NORECOVERY.</span><span class="sxs-lookup"><span data-stu-id="1153f-231">Obtain the tail of the transaction log of the primary database (on server A), and take the database offline, by backing up the transaction log using WITH NORECOVERY.</span></span>

3.  <span data-ttu-id="1153f-232">En el servidor secundario hacia el que planea realizar la conmutación por error (servidor B), ponga la base de datos secundaria en línea, restaurando la copia de seguridad de registros usando WITH RECOVERY.</span><span class="sxs-lookup"><span data-stu-id="1153f-232">On the secondary server to which you plan to fail over (server B), bring the secondary database online, by restoring the log backup using WITH RECOVERY.</span></span>

4.  <span data-ttu-id="1153f-233">En el otro servidor secundario (servidor C), deje la base de datos secundaria sin conexión restaurando la copia de seguridad de registros usando WITH NORECOVERY.</span><span class="sxs-lookup"><span data-stu-id="1153f-233">On every other secondary server (server C), leave the secondary database offline by restoring the log backup using WITH NORECOVERY.</span></span>

    > [!NOTE]
    >  <span data-ttu-id="1153f-234">Los trabajos de copia y restauración del trasvase de registros y se ejecutarán en los servidores secundarios, pero no harán nada porque los nuevos archivos de copia de seguridad de registros no se colocarán en el recurso compartido de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="1153f-234">The log shipping copy and restore jobs will run on the secondary servers, but the jobs will do nothing because new log-backup files will not be placed on the backup share.</span></span>

5.  <span data-ttu-id="1153f-235">Realice la conmutación por error de la base de datos redirigiendo a los clientes del servidor principal original (servidor A) al servidor secundario (servidor B) en línea.</span><span class="sxs-lookup"><span data-stu-id="1153f-235">Fail over the database by redirecting clients from the original primary server (server A) to the online secondary server (server B).</span></span> <span data-ttu-id="1153f-236">La base de datos en línea se convierte en el servidor principal provisional y se mantiene disponible mientras el servidor principal original está sin conexión (servidor A).</span><span class="sxs-lookup"><span data-stu-id="1153f-236">The online database becomes an interim primary server, keeping the database available while the original primary server is offline (server A).</span></span>

6.  <span data-ttu-id="1153f-237">Actualice el servidor principal original (servidor A).</span><span class="sxs-lookup"><span data-stu-id="1153f-237">Upgrade the original primary server (server A).</span></span>

7.  <span data-ttu-id="1153f-238">En la base de datos en la que se realizó la conmutación por error, la base de datos principal provisional (en el servidor B), realice manualmente una copia de seguridad del registro de transacciones mediante WITH NORECOVERY.</span><span class="sxs-lookup"><span data-stu-id="1153f-238">On the database to which you failed over-the interim primary database (on server B), manually back up the transaction log using WITH NORECOVERY.</span></span> <span data-ttu-id="1153f-239">De esta forma se deja la base de datos sin conexión.</span><span class="sxs-lookup"><span data-stu-id="1153f-239">This takes the database offline.</span></span>

8.  <span data-ttu-id="1153f-240">Restaure todas las copias de seguridad de registros de transacciones que creó en la base de datos principal provisional (en el servidor B) en la otra base de datos secundaria (en el servidor C) usando WITH NORECOVERY.</span><span class="sxs-lookup"><span data-stu-id="1153f-240">Restore all transaction log backups that you created on the interim primary database (on server B) to every other secondary database (on server C) using WITH NORECOVERY.</span></span> <span data-ttu-id="1153f-241">Esto permite al trasvase de registros continuar a partir de la base de datos principal original después de su actualización, sin requerir una restauración de la base de datos completa en cada base de datos secundaria.</span><span class="sxs-lookup"><span data-stu-id="1153f-241">This allows log shipping to continue from the original primary database after its upgrade, without requiring a full database restore on each secondary database.</span></span>

9. <span data-ttu-id="1153f-242">Restaure el registro de transacciones a partir del servidor principal provisional (servidor B) en la base de datos principal original (en el servidor A) usando WITH RECOVERY.</span><span class="sxs-lookup"><span data-stu-id="1153f-242">Restore the transaction log from the interim primary server (server B) to the original primary database (on server A) using WITH RECOVERY.</span></span>

##  <a name="redeploying-log-shipping"></a><a name="Redeploying"></a><span data-ttu-id="1153f-243">Volver a implementar el trasvase de registros</span><span class="sxs-lookup"><span data-stu-id="1153f-243">Redeploying Log Shipping</span></span>
 <span data-ttu-id="1153f-244">Si no desea migrar la configuración de trasvase de registros mediante uno de los procedimientos antes indicados, puede volver a implementar el trasvase de registros desde el principio reinicializando la base de datos secundaria con una copia de seguridad y restauración completa de la base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="1153f-244">If you do not want to migrate your log shipping configuration using one of the procedures shown above, you can redeploy log shipping from scratch by reinitializing your secondary database with a full backup and restore of the primary database.</span></span> <span data-ttu-id="1153f-245">Esta opción puede ser adecuada si tiene una base de datos pequeña o si no es crucial una alta disponibilidad durante el procedimiento de actualización.</span><span class="sxs-lookup"><span data-stu-id="1153f-245">This may be a desirable option if you have a small database or if high availability is not crucial during the upgrade procedure.</span></span>

 <span data-ttu-id="1153f-246">Para obtener información acerca de cómo habilitar el trasvase de registros, vea [configurar el trasvase de registros &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="1153f-246">For information about enabling log shipping, see [Configure Log Shipping &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="1153f-247">Consulte también</span><span class="sxs-lookup"><span data-stu-id="1153f-247">See Also</span></span>
 <span data-ttu-id="1153f-248">[Copias de seguridad de registros de transacciones &#40;SQL Server&#41;](../../relational-databases/backup-restore/transaction-log-backups-sql-server.md) [aplicar copias de seguridad de registros de transacciones &#40;SQL Server&#41;](../../relational-databases/backup-restore/apply-transaction-log-backups-sql-server.md) [tablas y procedimientos almacenados de trasvase de registros](log-shipping-tables-and-stored-procedures.md)</span><span class="sxs-lookup"><span data-stu-id="1153f-248">[Transaction Log Backups &#40;SQL Server&#41;](../../relational-databases/backup-restore/transaction-log-backups-sql-server.md) [Apply Transaction Log Backups &#40;SQL Server&#41;](../../relational-databases/backup-restore/apply-transaction-log-backups-sql-server.md) [Log Shipping Tables and Stored Procedures](log-shipping-tables-and-stored-procedures.md)</span></span>
