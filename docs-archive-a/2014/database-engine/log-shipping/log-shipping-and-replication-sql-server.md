---
title: Trasvase de registros y replicación (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- replication [SQL Server], log shipping and
- log shipping [SQL Server], replication and
ms.assetid: 132bebfd-0206-4d23-829a-b38e5ed17bc9
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: e3b1a0e08c5850b9e31202965909dfcfe1273e47
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87674326"
---
# <a name="log-shipping-and-replication-sql-server"></a><span data-ttu-id="d5782-102">Trasvase de registros y replicación (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="d5782-102">Log Shipping and Replication (SQL Server)</span></span>
  <span data-ttu-id="d5782-103">El trasvase de registros incluye dos copias de una sola base de datos que suelen residir en diferentes equipos.</span><span class="sxs-lookup"><span data-stu-id="d5782-103">Log shipping involves two copies of a single database that typically reside on different computers.</span></span> <span data-ttu-id="d5782-104">En cada momento, solo una copia de la base de datos está disponible para los clientes.</span><span class="sxs-lookup"><span data-stu-id="d5782-104">At any given time, only one copy of the database is currently available to clients.</span></span> <span data-ttu-id="d5782-105">Esta copia se conoce como la base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="d5782-105">This copy is known as the primary database.</span></span> <span data-ttu-id="d5782-106">Las actualizaciones realizadas por los clientes en la base de datos principal se propagan mediante el trasvase de registros a la otra copia de la base de datos, conocida como la base de datos secundaria.</span><span class="sxs-lookup"><span data-stu-id="d5782-106">Updates made by clients to the primary database are propagated by means of log shipping to the other copy of the database, known as the secondary database.</span></span> <span data-ttu-id="d5782-107">El trasvase de registros incluye la aplicación a la base de datos secundaria del registro de transacciones con todas las inserciones, actualizaciones o eliminaciones efectuadas en la base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="d5782-107">Log shipping involves applying the transaction log from every insertion, update, or deletion made on the primary database onto the secondary database.</span></span>  
  
 <span data-ttu-id="d5782-108">El trasvase de registros se puede usar conjuntamente con la replicación, con el siguiente comportamiento:</span><span class="sxs-lookup"><span data-stu-id="d5782-108">Log shipping can be used in conjunction with replication, with the following behavior:</span></span>  
  
-   <span data-ttu-id="d5782-109">La replicación no continúa después de producirse una conmutación por error de trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="d5782-109">Replication does not continue after a log shipping failover.</span></span> <span data-ttu-id="d5782-110">Si se produce una conmutación por error, los agentes de replicación no se conectan a la base de datos secundaria, de modo que no se replican transacciones en los suscriptores.</span><span class="sxs-lookup"><span data-stu-id="d5782-110">If a failover occurs, replication agents do not connect to the secondary, so transactions are not replicated to Subscribers.</span></span> <span data-ttu-id="d5782-111">Si se produce una conmutación por recuperación en la base de datos principal, se reanuda la replicación.</span><span class="sxs-lookup"><span data-stu-id="d5782-111">If a failback to the primary occurs, replication resumes.</span></span> <span data-ttu-id="d5782-112">Todas las transacciones que el trasvase de registros vuelve a copiar desde la base de datos secundaria a la base de datos principal se replican en los suscriptores.</span><span class="sxs-lookup"><span data-stu-id="d5782-112">All transactions that log shipping copies from the secondary back to the primary are replicated to Subscribers.</span></span>  
  
-   <span data-ttu-id="d5782-113">Si la base de datos principal se pierde de forma permanente, se puede cambiar el nombre de la base de datos secundaria de manera que se pueda continuar con la replicación.</span><span class="sxs-lookup"><span data-stu-id="d5782-113">If the primary is permanently lost, the secondary can be renamed so that replication can continue.</span></span> <span data-ttu-id="d5782-114">En el resto de este tema, se describen los requisitos y procedimientos necesarios para abordar este caso.</span><span class="sxs-lookup"><span data-stu-id="d5782-114">The remainder of this topic describes the requirements and procedures for handling this case.</span></span> <span data-ttu-id="d5782-115">El ejemplo presentado corresponde a la base de datos de publicaciones, que es la base de datos a la que se aplica el trasvase de registros con mayor frecuencia, aunque también se puede aplicar un proceso similar a las bases de datos de suscripciones y de distribución.</span><span class="sxs-lookup"><span data-stu-id="d5782-115">The example given is the publication database, which is the most common database to log ship, but a similar process can also be applied to subscription and distribution databases.</span></span>  
  
 <span data-ttu-id="d5782-116">Para obtener información sobre la recuperación de las bases de datos involucradas en la replicación sin necesidad de reconfigurar la replicación, vea [Hacer copias de seguridad y restaurar bases de datos replicadas](../../relational-databases/replication/administration/back-up-and-restore-replicated-databases.md).</span><span class="sxs-lookup"><span data-stu-id="d5782-116">For information about recovering databases involved in replication without any need to reconfigure replication, see [Back Up and Restore Replicated Databases](../../relational-databases/replication/administration/back-up-and-restore-replicated-databases.md).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d5782-117">Se recomienda utilizar la creación de reflejo de la base de datos, en lugar del trasvase de registros, para proporcionar disponibilidad a la base de datos de publicaciones.</span><span class="sxs-lookup"><span data-stu-id="d5782-117">We recommend using database mirroring, rather than log shipping, to provide availability for the publication database.</span></span> <span data-ttu-id="d5782-118">Para obtener más información, vea [Replicación y creación de reflejo de la base de datos &#40;SQL Server&#41;](../database-mirroring/database-mirroring-and-replication-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="d5782-118">For more information, see [Database Mirroring and Replication &#40;SQL Server&#41;](../database-mirroring/database-mirroring-and-replication-sql-server.md).</span></span>  
  
## <a name="requirements-and-procedures-for-replicating-from-the-secondary-if-the-primary-is-lost"></a><span data-ttu-id="d5782-119">Requisitos y procedimientos para replicar desde la base de datos secundaria si se pierde la base de datos principal</span><span class="sxs-lookup"><span data-stu-id="d5782-119">Requirements and Procedures for Replicating from the Secondary If the Primary Is Lost</span></span>  
 <span data-ttu-id="d5782-120">Se deben tener en cuenta los siguientes requisitos y consideraciones:</span><span class="sxs-lookup"><span data-stu-id="d5782-120">Be aware of the following requirements and considerations:</span></span>  
  
-   <span data-ttu-id="d5782-121">Si la base de datos principal contiene más de una base de datos de publicaciones, trasvase los registros de todas las bases de datos de publicaciones a la misma base de datos secundaria.</span><span class="sxs-lookup"><span data-stu-id="d5782-121">If a primary contains more than one publication database, log ship all of the publication databases to the same secondary.</span></span>  
  
-   <span data-ttu-id="d5782-122">La ruta de instalación de la instancia del servidor secundario debe ser la misma que la del primario.</span><span class="sxs-lookup"><span data-stu-id="d5782-122">The installation path for the secondary server instance must be the same as the primary.</span></span> <span data-ttu-id="d5782-123">Las ubicaciones de las bases de datos de usuario en el servidor secundario deben ser las mismas que las del primario.</span><span class="sxs-lookup"><span data-stu-id="d5782-123">User database locations on the secondary server must be the same as on the primary.</span></span>  
  
-   <span data-ttu-id="d5782-124">Haga una copia de seguridad de la clave maestra de servicio en la base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="d5782-124">Back up the service master key at the primary.</span></span> <span data-ttu-id="d5782-125">Esta clave se restaurará en la base de datos secundaria.</span><span class="sxs-lookup"><span data-stu-id="d5782-125">This key will be restored at the secondary.</span></span> <span data-ttu-id="d5782-126">Para obtener más información, vea [BACKUP SERVICE MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-service-master-key-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d5782-126">For more information, see [BACKUP SERVICE MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-service-master-key-transact-sql).</span></span>  
  
-   <span data-ttu-id="d5782-127">El trasvase de registros no garantiza que no se produzca una pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="d5782-127">Log shipping does not guarantee against data loss.</span></span> <span data-ttu-id="d5782-128">Un error en la base de datos principal puede originar la pérdida de los datos que aún no tienen una copia de seguridad o la pérdida de copias de seguridad durante la ejecución del error.</span><span class="sxs-lookup"><span data-stu-id="d5782-128">A failure on the primary database can result in the loss of data that has not yet been backed up or for backups that are lost during the failure.</span></span>  
  
### <a name="log-shipping-with-transactional-replication"></a><span data-ttu-id="d5782-129">Trasvase de registros con la replicación transaccional</span><span class="sxs-lookup"><span data-stu-id="d5782-129">Log Shipping with Transactional Replication</span></span>  
 <span data-ttu-id="d5782-130">En la replicación transaccional, el comportamiento del trasvase de registros depende de la opción **sync with backup** .</span><span class="sxs-lookup"><span data-stu-id="d5782-130">For transactional replication, the behavior of log shipping depends on the **sync with backup** option.</span></span> <span data-ttu-id="d5782-131">Esta opción se puede establecer en la base de datos de publicaciones y en la base de datos de distribución. En lo que respecta al trasvase de registros para el publicador, solo tiene relevancia la configuración de la base de datos de publicaciones.</span><span class="sxs-lookup"><span data-stu-id="d5782-131">This option can be set on the publication database and distribution database; in log shipping for the Publisher, only the setting on the publication database is relevant.</span></span>  
  
 <span data-ttu-id="d5782-132">Establecer esta opción en la base de datos de publicaciones garantiza que las transacciones no se enviarán a la base de datos de distribución hasta que se hayan incluido en la copia de seguridad en la base de datos de publicaciones.</span><span class="sxs-lookup"><span data-stu-id="d5782-132">Setting this option on the publication database ensures that transactions are not delivered to the distribution database until they are backed up at the publication database.</span></span> <span data-ttu-id="d5782-133">La última copia de seguridad de la base de datos de publicaciones se puede restaurar posteriormente en el servidor secundario sin que exista ninguna posibilidad de que la base de datos de distribución contenga transacciones que no existan en la base de datos de publicaciones restaurada.</span><span class="sxs-lookup"><span data-stu-id="d5782-133">The last publication database backup can then be restored at the secondary server without any possibility of the distribution database having transactions that the restored publication database does not have.</span></span> <span data-ttu-id="d5782-134">Esta opción garantiza que si el publicador genera un error en el servidor secundario, se mantendrá la coherencia entre el publicador, el distribuidor y los suscriptores.</span><span class="sxs-lookup"><span data-stu-id="d5782-134">This option guarantees that if the Publisher fails over to a secondary server, consistency is maintained between the Publisher, Distributor, and Subscribers.</span></span> <span data-ttu-id="d5782-135">La latencia y el rendimiento se verán afectados porque no será posible entregar transacciones a la base de datos de distribución hasta que se haya hecho una copia de seguridad de ellas en el publicador. Si la aplicación puede tolerar esta latencia, se recomienda establecer esta opción en la base de datos de publicaciones.</span><span class="sxs-lookup"><span data-stu-id="d5782-135">Latency and throughput are affected because transactions cannot be delivered to the distribution database until they have been backed up at the Publisher; if your application can tolerate this latency, we recommend that you set this option on the publication database.</span></span> <span data-ttu-id="d5782-136">Si no se establece la opción **sync with backup** , los suscriptores podrían recibir cambios que ya no están incluidos en la base de datos recuperada en el servidor secundario.</span><span class="sxs-lookup"><span data-stu-id="d5782-136">If the **sync with backup** option is not set, Subscribers might receive changes that are no longer included in the recovered database at the secondary server.</span></span> <span data-ttu-id="d5782-137">Para más información, consulte [Estrategias para hacer copias de seguridad y restaurar replicación de instantáneas o replicación transaccional](../../relational-databases/replication/transactional/transactional-replication.md).</span><span class="sxs-lookup"><span data-stu-id="d5782-137">For more information, see [Strategies for Backing Up and Restoring Snapshot and Transactional Replication](../../relational-databases/replication/transactional/transactional-replication.md).</span></span>  
  
 <span data-ttu-id="d5782-138">**Para configurar la replicación transaccional y el trasvase de registros con la opción sync with backup:**</span><span class="sxs-lookup"><span data-stu-id="d5782-138">**To configure transactional replication and log shipping with the sync with backup option**</span></span>  
  
1.  <span data-ttu-id="d5782-139">Si la opción sync with backup no está establecida en la base de datos de publicaciones, ejecute `sp_replicationdboption '<publicationdatabasename>', 'sync with backup', 'true'`.</span><span class="sxs-lookup"><span data-stu-id="d5782-139">If the sync with backup option is not set on the publication database, execute `sp_replicationdboption '<publicationdatabasename>', 'sync with backup', 'true'`.</span></span> <span data-ttu-id="d5782-140">Para obtener más información, vea [sp_replicationdboption &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d5782-140">For more information, see [sp_replicationdboption &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql).</span></span>  
  
2.  <span data-ttu-id="d5782-141">Configure el trasvase de registros para la base de datos de publicaciones.</span><span class="sxs-lookup"><span data-stu-id="d5782-141">Configure log shipping for the publication database.</span></span> <span data-ttu-id="d5782-142">Para obtener más información, vea [Configurar el trasvase de registros &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="d5782-142">For more information, see [Configure Log Shipping &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span></span>  
  
3.  <span data-ttu-id="d5782-143">Si se produce un error en el publicador, restaure el último registro de la base de datos en el servidor secundario mediante la opción KEEP_REPLICATION de RESTORE LOG.</span><span class="sxs-lookup"><span data-stu-id="d5782-143">If the Publisher fails, restore the last log of the database to the secondary server, using the KEEP_REPLICATION option of RESTORE LOG.</span></span> <span data-ttu-id="d5782-144">De esta manera se conservará toda la configuración de la replicación correspondiente a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="d5782-144">This retains all replication settings for the database.</span></span> <span data-ttu-id="d5782-145">Para obtener más información, vea [Conmutar por error a una base de datos secundaria de trasvase de registros &#40;SQL Server&#41;](fail-over-to-a-log-shipping-secondary-sql-server.md) y [RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d5782-145">For more information, see [Fail Over to a Log Shipping Secondary &#40;SQL Server&#41;](fail-over-to-a-log-shipping-secondary-sql-server.md) and [RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql).</span></span>  
  
4.  <span data-ttu-id="d5782-146">Restaure la base de datos **msdb** y las bases de datos **maestras** del servidor principal al secundario.</span><span class="sxs-lookup"><span data-stu-id="d5782-146">Restore the **msdb** database and **master** databases from the primary to the secondary.</span></span> <span data-ttu-id="d5782-147">Para obtener más información, vea [Realizar copias de seguridad y restaurar bases de datos del sistema &#40;SQL Server&#41;](../../relational-databases/backup-restore/back-up-and-restore-of-system-databases-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="d5782-147">For more information, see [Back Up and Restore of System Databases &#40;SQL Server&#41;](../../relational-databases/backup-restore/back-up-and-restore-of-system-databases-sql-server.md).</span></span> <span data-ttu-id="d5782-148">Si la base de datos principal también era un distribuidor, restaure la base de datos de distribución del servidor principal al secundario.</span><span class="sxs-lookup"><span data-stu-id="d5782-148">If the primary was also a Distributor, restore the distribution database from the primary to the secondary.</span></span>  
  
     <span data-ttu-id="d5782-149">Las bases de datos deben ser coherentes con la base de datos de publicaciones del servidor principal en lo que respecta a las opciones de configuración de la replicación.</span><span class="sxs-lookup"><span data-stu-id="d5782-149">These databases must be consistent with the publication database at the primary in terms of replication configuration and settings.</span></span>  
  
5.  <span data-ttu-id="d5782-150">En el servidor secundario, cambie el nombre del equipo y, a continuación, cambie el nombre de la instancia de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] de manera que coincida con el nombre del servidor principal.</span><span class="sxs-lookup"><span data-stu-id="d5782-150">At the secondary server, rename the computer and then rename the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance to match the primary server name.</span></span> <span data-ttu-id="d5782-151">Para obtener información sobre cómo cambiar el nombre del equipo, vea la documentación de Windows.</span><span class="sxs-lookup"><span data-stu-id="d5782-151">For information about renaming the computer, see the Windows documentation.</span></span> <span data-ttu-id="d5782-152">Para obtener más información sobre cómo cambiar el nombre de servidor, vea [Cambiar el nombre de un equipo que hospeda una instancia independiente de SQL Server](../install-windows/rename-a-computer-that-hosts-a-stand-alone-instance-of-sql-server.md) y [Cambiar el nombre de una instancia de clúster de conmutación por error de SQL Server](../../sql-server/failover-clusters/install/rename-a-sql-server-failover-cluster-instance.md).</span><span class="sxs-lookup"><span data-stu-id="d5782-152">For information about renaming the server, see [Rename a Computer that Hosts a Stand-Alone Instance of SQL Server](../install-windows/rename-a-computer-that-hosts-a-stand-alone-instance-of-sql-server.md) and [Rename a SQL Server Failover Cluster Instance](../../sql-server/failover-clusters/install/rename-a-sql-server-failover-cluster-instance.md).</span></span>  
  
6.  <span data-ttu-id="d5782-153">En el servidor secundario, restaure la clave maestra de servicio que se copió desde el servidor principal.</span><span class="sxs-lookup"><span data-stu-id="d5782-153">At the secondary server, restore the service master key that was backed up from the primary.</span></span> <span data-ttu-id="d5782-154">Para obtener más información, vea [RESTORE SERVICE MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-service-master-key-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d5782-154">For more information, see [RESTORE SERVICE MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-service-master-key-transact-sql).</span></span>  
  
 <span data-ttu-id="d5782-155">**Para configurar la replicación transaccional y el trasvase de registros sin la opción sync with backup**</span><span class="sxs-lookup"><span data-stu-id="d5782-155">**To configure transactional replication and log shipping without the sync with backup option**</span></span>  
  
1.  <span data-ttu-id="d5782-156">Configure el trasvase de registros para la base de datos de publicaciones.</span><span class="sxs-lookup"><span data-stu-id="d5782-156">Configure log shipping for the publication database.</span></span> <span data-ttu-id="d5782-157">Para obtener más información, vea [Configurar el trasvase de registros &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="d5782-157">For more information, see [Configure Log Shipping &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span></span>  
  
2.  <span data-ttu-id="d5782-158">Si se produce un error en el publicador, restaure el último registro de la base de datos en el servidor secundario mediante la opción KEEP_REPLICATION de RESTORE LOG.</span><span class="sxs-lookup"><span data-stu-id="d5782-158">If the Publisher fails, restore the last log of the database to the secondary server, using the KEEP_REPLICATION option of RESTORE LOG.</span></span> <span data-ttu-id="d5782-159">De esta manera se conservará toda la configuración de la replicación correspondiente a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="d5782-159">This retains all replication settings for the database.</span></span> <span data-ttu-id="d5782-160">Para obtener más información, vea [Conmutar por error a una base de datos secundaria de trasvase de registros &#40;SQL Server&#41;](fail-over-to-a-log-shipping-secondary-sql-server.md) y [RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d5782-160">For more information, see [Fail Over to a Log Shipping Secondary &#40;SQL Server&#41;](fail-over-to-a-log-shipping-secondary-sql-server.md) and [RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql).</span></span>  
  
3.  <span data-ttu-id="d5782-161">Restaure la base de datos **msdb** y las bases de datos **maestras** del servidor principal al secundario.</span><span class="sxs-lookup"><span data-stu-id="d5782-161">Restore the **msdb** database and **master** databases from the primary to the secondary.</span></span> <span data-ttu-id="d5782-162">Para obtener más información, vea [Realizar copias de seguridad y restaurar bases de datos del sistema &#40;SQL Server&#41;](../../relational-databases/backup-restore/back-up-and-restore-of-system-databases-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="d5782-162">For more information, see [Back Up and Restore of System Databases &#40;SQL Server&#41;](../../relational-databases/backup-restore/back-up-and-restore-of-system-databases-sql-server.md).</span></span> <span data-ttu-id="d5782-163">Si la base de datos principal también era un distribuidor, restaure la base de datos de distribución del servidor principal al secundario.</span><span class="sxs-lookup"><span data-stu-id="d5782-163">If the primary was also a Distributor, restore the distribution database from the primary to the secondary.</span></span>  
  
     <span data-ttu-id="d5782-164">Las bases de datos deben ser coherentes con la base de datos de publicaciones del servidor principal en lo que respecta a las opciones de configuración de la replicación.</span><span class="sxs-lookup"><span data-stu-id="d5782-164">These databases must be consistent with the publication database at the primary in terms of replication configuration and settings.</span></span>  
  
4.  <span data-ttu-id="d5782-165">En el servidor secundario, cambie el nombre del equipo y, a continuación, cambie el nombre de la instancia de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] de manera que coincida con el nombre del servidor principal.</span><span class="sxs-lookup"><span data-stu-id="d5782-165">At the secondary server, rename the computer and then rename the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance to match the primary server name.</span></span> <span data-ttu-id="d5782-166">Para obtener información sobre cómo cambiar el nombre del equipo, vea la documentación de Windows.</span><span class="sxs-lookup"><span data-stu-id="d5782-166">For information about renaming the computer, see the Windows documentation.</span></span> <span data-ttu-id="d5782-167">Para obtener más información sobre cómo cambiar el nombre de servidor, vea [Cambiar el nombre de un equipo que hospeda una instancia independiente de SQL Server](../install-windows/rename-a-computer-that-hosts-a-stand-alone-instance-of-sql-server.md) y [Cambiar el nombre de una instancia de clúster de conmutación por error de SQL Server](../../sql-server/failover-clusters/install/rename-a-sql-server-failover-cluster-instance.md).</span><span class="sxs-lookup"><span data-stu-id="d5782-167">For information about renaming the server, see [Rename a Computer that Hosts a Stand-Alone Instance of SQL Server](../install-windows/rename-a-computer-that-hosts-a-stand-alone-instance-of-sql-server.md) and [Rename a SQL Server Failover Cluster Instance](../../sql-server/failover-clusters/install/rename-a-sql-server-failover-cluster-instance.md).</span></span>  
  
     <span data-ttu-id="d5782-168">Es probable que reciba un mensaje de error del Agente de registro del LOG comunicándole que la base de datos de publicaciones y la base de datos de distribución no están sincronizadas.</span><span class="sxs-lookup"><span data-stu-id="d5782-168">You might receive an error message from the Log Reader Agent that the publication database and the distribution database are not synchronized.</span></span>  
  
5.  <span data-ttu-id="d5782-169">En el servidor secundario, restaure la clave maestra de servicio que se copió desde el servidor principal.</span><span class="sxs-lookup"><span data-stu-id="d5782-169">At the secondary server, restore the service master key that was backed up from the primary.</span></span> <span data-ttu-id="d5782-170">Para obtener más información, vea [RESTORE SERVICE MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-service-master-key-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d5782-170">For more information, see [RESTORE SERVICE MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-service-master-key-transact-sql).</span></span>  
  
6.  <span data-ttu-id="d5782-171">Ejecute **sp_replrestart**.</span><span class="sxs-lookup"><span data-stu-id="d5782-171">Execute **sp_replrestart**.</span></span> <span data-ttu-id="d5782-172">Este procedimiento almacenado se puede utilizar para forzar que el Agente de registro del LOG omita todas las transacciones replicadas anteriormente en el registro de la base de datos de publicaciones.</span><span class="sxs-lookup"><span data-stu-id="d5782-172">This stored procedure can be used to force the Log Reader Agent to ignore all the previous replicated transactions in the publication database log.</span></span> <span data-ttu-id="d5782-173">Las transacciones aplicadas tras la finalización del procedimiento almacenado se procesan mediante el Agente de registro del LOG.</span><span class="sxs-lookup"><span data-stu-id="d5782-173">Transactions applied after the completion of the stored procedure are processed by the Log Reader Agent.</span></span> <span data-ttu-id="d5782-174">Para obtener más información, vea [sp_replrestart &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replrestart-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d5782-174">For more information, see [sp_replrestart &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replrestart-transact-sql).</span></span>  
  
7.  <span data-ttu-id="d5782-175">Reinicie el Agente de registro del LOG después de que el procedimiento almacenado se haya ejecutado correctamente.</span><span class="sxs-lookup"><span data-stu-id="d5782-175">Restart the Log Reader Agent after the stored procedure executes successfully.</span></span> <span data-ttu-id="d5782-176">Para obtener más información, vea [Iniciar y detener un agente de replicación &#40;SQL Server Management Studio&#41;](../../relational-databases/replication/agents/start-and-stop-a-replication-agent-sql-server-management-studio.md).</span><span class="sxs-lookup"><span data-stu-id="d5782-176">For more information, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../../relational-databases/replication/agents/start-and-stop-a-replication-agent-sql-server-management-studio.md).</span></span>  
  
8.  <span data-ttu-id="d5782-177">Las transacciones que ya se distribuyeron al suscriptor podrían aplicarse al publicador.</span><span class="sxs-lookup"><span data-stu-id="d5782-177">Transactions that have already been distributed to Subscriber might be applied at the Publisher.</span></span> <span data-ttu-id="d5782-178">Para asegurarse de que el Agente de distribución no genere un error cuando intente volver a aplicar estas transacciones en el suscriptor, especifique el perfil de agente llamado **Continuar después de errores de coherencia de datos**.</span><span class="sxs-lookup"><span data-stu-id="d5782-178">To ensure that the Distribution Agent does not fail with an error when attempting to reapply these transactions at a Subscriber, specify the agent profile titled **Continue On Data Consistency Errors**.</span></span>  
  
### <a name="log-shipping-with-merge-replication"></a><span data-ttu-id="d5782-179">Trasvase de registros con la replicación de mezcla</span><span class="sxs-lookup"><span data-stu-id="d5782-179">Log Shipping with Merge Replication</span></span>  
 <span data-ttu-id="d5782-180">Realice los pasos del siguiente procedimiento para configurar la replicación de mezcla y el trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="d5782-180">Follow the steps in the procedure below to configure merge replication and log shipping.</span></span>  
  
 <span data-ttu-id="d5782-181">**Para configurar la replicación de mezcla y el trasvase de registros**</span><span class="sxs-lookup"><span data-stu-id="d5782-181">**To configure merge replication and log shipping**</span></span>  
  
1.  <span data-ttu-id="d5782-182">Configure el trasvase de registros para la base de datos de publicaciones.</span><span class="sxs-lookup"><span data-stu-id="d5782-182">Configure log shipping for the publication database.</span></span> <span data-ttu-id="d5782-183">Para obtener más información, vea [Configurar el trasvase de registros &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="d5782-183">For more information, see [Configure Log Shipping &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span></span>  
  
2.  <span data-ttu-id="d5782-184">En el publicador que da error, en el servidor secundario cambie el nombre del equipo y, a continuación, cambie el nombre de la instancia de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] de manera que coincida con el nombre del servidor principal.</span><span class="sxs-lookup"><span data-stu-id="d5782-184">If the Publisher fails, at the secondary server, rename the computer and then rename the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance to match the primary server name.</span></span> <span data-ttu-id="d5782-185">Para obtener información sobre cómo cambiar el nombre del equipo, vea la documentación de Windows.</span><span class="sxs-lookup"><span data-stu-id="d5782-185">For information about renaming the computer, see the Windows documentation.</span></span> <span data-ttu-id="d5782-186">Para obtener más información sobre cómo cambiar el nombre de servidor, vea [Cambiar el nombre de un equipo que hospeda una instancia independiente de SQL Server](../install-windows/rename-a-computer-that-hosts-a-stand-alone-instance-of-sql-server.md) y [Cambiar el nombre de una instancia de clúster de conmutación por error de SQL Server](../../sql-server/failover-clusters/install/rename-a-sql-server-failover-cluster-instance.md).</span><span class="sxs-lookup"><span data-stu-id="d5782-186">For information about renaming the server, see [Rename a Computer that Hosts a Stand-Alone Instance of SQL Server](../install-windows/rename-a-computer-that-hosts-a-stand-alone-instance-of-sql-server.md) and [Rename a SQL Server Failover Cluster Instance](../../sql-server/failover-clusters/install/rename-a-sql-server-failover-cluster-instance.md).</span></span>  
  
3.  <span data-ttu-id="d5782-187">Restaure el último registro de la base de datos en el servidor secundario mediante la opción KEEP_REPLICATION de RESTORE LOG.</span><span class="sxs-lookup"><span data-stu-id="d5782-187">Restore the last log of the database to the secondary server, using the KEEP_REPLICATION option of RESTORE LOG.</span></span> <span data-ttu-id="d5782-188">De esta manera se conservará toda la configuración de la replicación correspondiente a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="d5782-188">This retains all replication settings for the database.</span></span> <span data-ttu-id="d5782-189">Para obtener más información, vea [Conmutar por error a una base de datos secundaria de trasvase de registros &#40;SQL Server&#41;](fail-over-to-a-log-shipping-secondary-sql-server.md) y [RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d5782-189">For more information, see [Fail Over to a Log Shipping Secondary &#40;SQL Server&#41;](fail-over-to-a-log-shipping-secondary-sql-server.md) and [RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql).</span></span>  
  
4.  <span data-ttu-id="d5782-190">Restaure la base de datos **msdb** y las bases de datos **maestras** del servidor principal al secundario.</span><span class="sxs-lookup"><span data-stu-id="d5782-190">Restore the **msdb** database and **master** databases from the primary to the secondary.</span></span> <span data-ttu-id="d5782-191">Para obtener más información, vea [Realizar copias de seguridad y restaurar bases de datos del sistema &#40;SQL Server&#41;](../../relational-databases/backup-restore/back-up-and-restore-of-system-databases-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="d5782-191">For more information, see [Back Up and Restore of System Databases &#40;SQL Server&#41;](../../relational-databases/backup-restore/back-up-and-restore-of-system-databases-sql-server.md).</span></span> <span data-ttu-id="d5782-192">Si la base de datos principal también era un distribuidor, restaure la base de datos de distribución del servidor principal al secundario.</span><span class="sxs-lookup"><span data-stu-id="d5782-192">If the primary was also a Distributor, restore the distribution database from the primary to the secondary.</span></span>  
  
     <span data-ttu-id="d5782-193">Las bases de datos deben ser coherentes con la base de datos de publicaciones del servidor principal en lo que respecta a las opciones de configuración de la replicación.</span><span class="sxs-lookup"><span data-stu-id="d5782-193">These databases must be consistent with the publication database at the primary in terms of replication configuration and settings.</span></span>  
  
5.  <span data-ttu-id="d5782-194">En el servidor secundario, restaure la clave maestra de servicio que se copió desde el servidor principal.</span><span class="sxs-lookup"><span data-stu-id="d5782-194">At the secondary server, restore the service master key that was backed up from the primary.</span></span> <span data-ttu-id="d5782-195">Para obtener más información, vea [RESTORE SERVICE MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-service-master-key-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d5782-195">For more information, see [RESTORE SERVICE MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-service-master-key-transact-sql).</span></span>  
  
6.  <span data-ttu-id="d5782-196">Sincronice la base de datos de publicaciones con una o más bases de datos de suscripciones.</span><span class="sxs-lookup"><span data-stu-id="d5782-196">Synchronize the publication database with one or more subscription databases.</span></span> <span data-ttu-id="d5782-197">Esto permite cargar los cambios realizados anteriormente en la base de datos de publicaciones, pero que no se muestran en la copia de seguridad restaurada.</span><span class="sxs-lookup"><span data-stu-id="d5782-197">This allows you to upload those changes made previously in the publication database, but not represented in the restored backup.</span></span> <span data-ttu-id="d5782-198">Los datos que se pueden cargar dependen de la forma en que se filtra una publicación:</span><span class="sxs-lookup"><span data-stu-id="d5782-198">The data that can be uploaded depends on the way in which a publication is filtered:</span></span>  
  
    -   <span data-ttu-id="d5782-199">Si la publicación no está filtrada, debe poder actualizar la base de datos de publicaciones sincronizándola con el suscriptor más actualizado.</span><span class="sxs-lookup"><span data-stu-id="d5782-199">If the publication is not filtered, you should be able to bring the publication database up-to-date by synchronizing with the most up-to-date Subscriber.</span></span>  
  
    -   <span data-ttu-id="d5782-200">Si la publicación está filtrada, es posible que no pueda actualizar la base de datos de publicaciones.</span><span class="sxs-lookup"><span data-stu-id="d5782-200">If the publication is filtered, you might not be able to bring the publication database up-to-date.</span></span> <span data-ttu-id="d5782-201">Considere una tabla dividida de forma que cada suscripción reciba únicamente datos de clientes de una región: norte, este, sur y oeste.</span><span class="sxs-lookup"><span data-stu-id="d5782-201">Consider a table that is partitioned such that each subscription receives customer data only for a single region: North, East, South, and West.</span></span> <span data-ttu-id="d5782-202">Si hay al menos un suscriptor para cada partición de datos, al sincronizar cada partición con un suscriptor se debería actualizar la base de datos de publicaciones.</span><span class="sxs-lookup"><span data-stu-id="d5782-202">If there is at least one Subscriber for each partition of data, synchronizing with a Subscriber for each partition should bring the publication database up-to-date.</span></span> <span data-ttu-id="d5782-203">Sin embargo, si los datos de la partición oeste, por ejemplo, no se han replicado en ningún suscriptor, no se podrán actualizar estos datos en el publicador.</span><span class="sxs-lookup"><span data-stu-id="d5782-203">However, if data in the West partition, for example, was not replicated to any Subscribers, this data at the Publisher cannot be brought up-to-date.</span></span> <span data-ttu-id="d5782-204">En este caso, se recomienda reinicializar todas las suscripciones de manera que los datos del publicador y de los suscriptores converjan.</span><span class="sxs-lookup"><span data-stu-id="d5782-204">In this case, we recommend reinitializing all subscriptions so that the data at the Publisher and Subscribers converges.</span></span> <span data-ttu-id="d5782-205">Para obtener más información, vea [Reinicializar suscripciones](../../relational-databases/replication/reinitialize-subscriptions.md).</span><span class="sxs-lookup"><span data-stu-id="d5782-205">For more information, see [Reinitialize Subscriptions](../../relational-databases/replication/reinitialize-subscriptions.md).</span></span>  
  
     <span data-ttu-id="d5782-206">Si se sincroniza con un suscriptor que ejecute una versión de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] anterior a [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)], la suscripción no puede ser anónima, sino que debe ser una suscripción de cliente o de servidor (llamadas suscripciones locales y suscripciones globales en versiones anteriores).</span><span class="sxs-lookup"><span data-stu-id="d5782-206">If you synchronize with a Subscriber that is running a version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] prior to [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)], the subscription cannot be anonymous; it must be a client subscription or server subscription (referred to as local subscriptions and global subscriptions in previous releases).</span></span> <span data-ttu-id="d5782-207">Para obtener más información, vea [Sincronizar datos](../../relational-databases/replication/synchronize-data.md).</span><span class="sxs-lookup"><span data-stu-id="d5782-207">For more information, see [Synchronize Data](../../relational-databases/replication/synchronize-data.md).</span></span>   
  
## <a name="see-also"></a><span data-ttu-id="d5782-208">Consulte también</span><span class="sxs-lookup"><span data-stu-id="d5782-208">See Also</span></span>  
 <span data-ttu-id="d5782-209">[Replicación de SQL Server](../../relational-databases/replication/sql-server-replication.md) </span><span class="sxs-lookup"><span data-stu-id="d5782-209">[SQL Server Replication](../../relational-databases/replication/sql-server-replication.md) </span></span>  
 <span data-ttu-id="d5782-210">[Acerca del trasvase de registros &#40;SQL Server&#41;](about-log-shipping-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="d5782-210">[About Log Shipping &#40;SQL Server&#41;](about-log-shipping-sql-server.md) </span></span>  
 [<span data-ttu-id="d5782-211">Replicación y creación de reflejo de la base de datos &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d5782-211">Database Mirroring and Replication &#40;SQL Server&#41;</span></span>](../database-mirroring/database-mirroring-and-replication-sql-server.md)  
  
  
