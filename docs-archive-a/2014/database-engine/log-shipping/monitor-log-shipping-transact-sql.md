---
title: Supervisar el trasvase de registros (Transact-SQL) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- log shipping [SQL Server], status
- history tables [SQL Server]
- historical information [SQL Server], log shipping
- log shipping [SQL Server], monitoring
- alerts [SQL Server], log shipping
- status information [SQL Server], log shipping
- monitoring log shipping [SQL Server]
ms.assetid: acf3cd99-55f7-4287-8414-0892f830f423
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 0ab87d5d8aa08b7b2860fe52fd097f33af327a94
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87670529"
---
# <a name="monitor-log-shipping-transact-sql"></a><span data-ttu-id="bde37-102">Supervisar el trasvase de registros (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="bde37-102">Monitor Log Shipping (Transact-SQL)</span></span>
  <span data-ttu-id="bde37-103">Después de configurar el trasvase de registros, puede supervisar la información acerca del estado de todos los servidores de trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="bde37-103">After you have configured log shipping, you can monitor information about the status of all the log shipping servers.</span></span> <span data-ttu-id="bde37-104">El historial y el estado de las operaciones de trasvase de registros siempre se guardan de forma local en los trabajos de trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="bde37-104">The history and status of log shipping operations are always saved locally by the log shipping jobs.</span></span> <span data-ttu-id="bde37-105">El historial y el estado de la operación de copia de seguridad se almacenan en el servidor principal, y el historial y el estado de las operaciones de copia y restauración se almacenan en el servidor secundario.</span><span class="sxs-lookup"><span data-stu-id="bde37-105">The history and status of the backup operation are stored at the primary server, and the history and status of the copy and restore operations are stored at the secondary server.</span></span> <span data-ttu-id="bde37-106">Si ha implementado un servidor de supervisión remoto, esta información se almacena también en dicho servidor.</span><span class="sxs-lookup"><span data-stu-id="bde37-106">If you have implemented a remote monitor server, this information is also stored on the monitor server.</span></span>  
  
 <span data-ttu-id="bde37-107">Puede configurar alertas que se activarán si las operaciones de trasvase de registros no se producen según lo programado.</span><span class="sxs-lookup"><span data-stu-id="bde37-107">You can configure alerts that will fire if log shipping operations fail to occur as scheduled.</span></span> <span data-ttu-id="bde37-108">Los errores se indican mediante un trabajo de alerta que vigila el estado de las operaciones de copias de seguridad y restauración.</span><span class="sxs-lookup"><span data-stu-id="bde37-108">Errors are raised by an alert job that watches the status of the backup and restore operations.</span></span> <span data-ttu-id="bde37-109">Puede definir alertas que envíen una notificación a un operador cuando aparezcan estos errores.</span><span class="sxs-lookup"><span data-stu-id="bde37-109">You can define alerts that notify an operator when these errors are raised.</span></span> <span data-ttu-id="bde37-110">Si hay un servidor de supervisión configurado, el trabajo de alerta se ejecuta en el servidor de supervisión que detecta los errores de todas las operaciones de la configuración de trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="bde37-110">If a monitor server is configured, one alert job runs on the monitor server that raises errors for all operations in the log shipping configuration.</span></span> <span data-ttu-id="bde37-111">Si no se ha especificado ningún servidor de supervisión, el trabajo de alerta se ejecuta en la instancia de servidor principal, que supervisa la operación de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bde37-111">If a monitor server is not specified, an alert job runs on the primary server instance, which monitors the backup operation.</span></span> <span data-ttu-id="bde37-112">Si no se ha especificado ningún servidor de supervisión, el trabajo de alerta se ejecuta también en cada instancia de servidor secundario para supervisar las operaciones locales de copia y restauración.</span><span class="sxs-lookup"><span data-stu-id="bde37-112">If a monitor server is not specified, an alert job also runs on each secondary server instance to monitor the local copy and restore operations.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="bde37-113">Para supervisar una configuración de trasvase de registros, deberá agregar el servidor de supervisión cuando habilite el trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="bde37-113">To monitor a log shipping configuration, you must add the monitor server when you enable log shipping.</span></span> <span data-ttu-id="bde37-114">Si agrega un servidor de supervisión más adelante, deberá quitar la configuración de trasvase de registros y reemplazarla por una configuración nueva que incluya un servidor de supervisión.</span><span class="sxs-lookup"><span data-stu-id="bde37-114">If you add a monitor server later, you must remove the log shipping configuration and then replace it with a new configuration that includes a monitor server.</span></span> <span data-ttu-id="bde37-115">Para obtener más información, vea [Configurar el trasvase de registros &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="bde37-115">For more information, see [Configure Log Shipping &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span></span> <span data-ttu-id="bde37-116">Además, una vez configurado el servidor de supervisión, no puede modificarse sin quitar primero el trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="bde37-116">Furthermore, after the monitor server has been configured, it cannot be changed without removing log shipping first.</span></span>  
  
## <a name="history-tables-containing-monitoring-information"></a><span data-ttu-id="bde37-117">Tablas del historial que contienen información de supervisión</span><span class="sxs-lookup"><span data-stu-id="bde37-117">History Tables Containing Monitoring Information</span></span>  
 <span data-ttu-id="bde37-118">Las tablas del historial de supervisión contienen metadatos que se almacenan en el servidor de supervisión.</span><span class="sxs-lookup"><span data-stu-id="bde37-118">The monitoring history tables contain metadata that is stored on the monitor server.</span></span> <span data-ttu-id="bde37-119">También se almacena localmente una copia de la información específica de un servidor primario o secundario determinado.</span><span class="sxs-lookup"><span data-stu-id="bde37-119">A copy of information specific to a given primary or secondary server is also stored locally.</span></span>  
  
 <span data-ttu-id="bde37-120">Estas tablas se pueden consultar para supervisar el estado de una sesión de trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="bde37-120">You can query these tables to monitor the status of a log shipping session.</span></span> <span data-ttu-id="bde37-121">Por ejemplo, para conocer el estado del trasvase de registros, compruebe el estado y el historial del trabajo de copia de seguridad, trabajo de copia y trabajo de restauración.</span><span class="sxs-lookup"><span data-stu-id="bde37-121">For example, to learn status of log shipping, check the status and history of the backup job, copy job, and restore job.</span></span> <span data-ttu-id="bde37-122">Puede ver el historial y los detalles de errores específicos del trasvase de registros mediante la consulta de las siguientes tablas de supervisión.</span><span class="sxs-lookup"><span data-stu-id="bde37-122">You can view specific log shipping history and error details by querying the following monitoring tables.</span></span>  
  
|<span data-ttu-id="bde37-123">Tabla</span><span class="sxs-lookup"><span data-stu-id="bde37-123">Table</span></span>|<span data-ttu-id="bde37-124">Descripción</span><span class="sxs-lookup"><span data-stu-id="bde37-124">Description</span></span>|  
|-----------|-----------------|  
|[<span data-ttu-id="bde37-125">log_shipping_monitor_alert</span><span class="sxs-lookup"><span data-stu-id="bde37-125">log_shipping_monitor_alert</span></span>](/sql/relational-databases/system-tables/log-shipping-monitor-alert-transact-sql)|<span data-ttu-id="bde37-126">Almacena el Id. del trabajo de alerta.</span><span class="sxs-lookup"><span data-stu-id="bde37-126">Stores alert job ID.</span></span>|  
|[<span data-ttu-id="bde37-127">log_shipping_monitor_error_detail</span><span class="sxs-lookup"><span data-stu-id="bde37-127">log_shipping_monitor_error_detail</span></span>](/sql/relational-databases/system-tables/log-shipping-monitor-error-detail-transact-sql)|<span data-ttu-id="bde37-128">Almacena los detalles de errores de los trabajos de trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="bde37-128">Stores error details for log shipping jobs.</span></span> <span data-ttu-id="bde37-129">Puede consultar esta tabla para ver los errores de una sesión de agente.</span><span class="sxs-lookup"><span data-stu-id="bde37-129">You can query this table see the errors for an agent session.</span></span> <span data-ttu-id="bde37-130">Opcionalmente, puede ordenar los errores por la fecha y la hora en que se registraron.</span><span class="sxs-lookup"><span data-stu-id="bde37-130">Optionally, you can sort the errors by the date and time at which each was logged.</span></span> <span data-ttu-id="bde37-131">Cada error se registra como una secuencia de excepciones y se pueden registrar varios errores (secuencias) por sesión de agente.</span><span class="sxs-lookup"><span data-stu-id="bde37-131">Each error is logged as a sequence of exceptions, and multiple errors (sequences) can per agent session.</span></span>|  
|[<span data-ttu-id="bde37-132">log_shipping_monitor_history_detail</span><span class="sxs-lookup"><span data-stu-id="bde37-132">log_shipping_monitor_history_detail</span></span>](/sql/relational-databases/system-tables/log-shipping-monitor-history-detail-transact-sql)|<span data-ttu-id="bde37-133">Contiene los detalles del historial de los agentes de trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="bde37-133">Contains history details for log shipping agents.</span></span> <span data-ttu-id="bde37-134">Puede consultar esta tabla para ver los detalles del historial de una sesión de agente.</span><span class="sxs-lookup"><span data-stu-id="bde37-134">You can query this table to see the history detail for an agent session.</span></span>|  
|[<span data-ttu-id="bde37-135">log_shipping_monitor_primary</span><span class="sxs-lookup"><span data-stu-id="bde37-135">log_shipping_monitor_primary</span></span>](/sql/relational-databases/system-tables/log-shipping-monitor-primary-transact-sql)|<span data-ttu-id="bde37-136">Almacena un registro de supervisión para la base de datos principal en cada configuración de trasvase de registros, incluida información acerca del último archivo de copia de seguridad y el último archivo restaurado que es útil para la supervisión.</span><span class="sxs-lookup"><span data-stu-id="bde37-136">Stores one monitor record for the primary database in each log shipping configuration, including information about the last backup file and last restored file that is useful for monitoring.</span></span>|  
|[<span data-ttu-id="bde37-137">log_shipping_monitor_secondary</span><span class="sxs-lookup"><span data-stu-id="bde37-137">log_shipping_monitor_secondary</span></span>](/sql/relational-databases/system-tables/log-shipping-monitor-secondary-transact-sql)|<span data-ttu-id="bde37-138">Almacena un registro de supervisión para cada base de datos secundaria, incluida información acerca del último archivo de copia de seguridad y el último archivo restaurado que es útil para la supervisión.</span><span class="sxs-lookup"><span data-stu-id="bde37-138">Stores one monitor record for each secondary database, including information about the last backup file and last restored file that is useful for monitoring.</span></span>|  
  
## <a name="stored-procedures-for-monitoring-log-shipping"></a><span data-ttu-id="bde37-139">Procedimientos almacenados para supervisar el trasvase de registros</span><span class="sxs-lookup"><span data-stu-id="bde37-139">Stored Procedures for Monitoring Log Shipping</span></span>  
 <span data-ttu-id="bde37-140">La información de supervisión e historial se almacena en tablas de **msdb**, a las que se puede tener acceso mediante procedimientos almacenados de trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="bde37-140">Monitoring and history information is stored in tables in **msdb**, which can be accessed using log shipping stored procedures.</span></span> <span data-ttu-id="bde37-141">Ejecute estos procedimientos almacenados en los servidores indicados en la siguiente tabla.</span><span class="sxs-lookup"><span data-stu-id="bde37-141">Run these stored procedures on the servers indicated in the following table.</span></span>  
  
|<span data-ttu-id="bde37-142">Procedimiento almacenado</span><span class="sxs-lookup"><span data-stu-id="bde37-142">Stored procedure</span></span>|<span data-ttu-id="bde37-143">Descripción</span><span class="sxs-lookup"><span data-stu-id="bde37-143">Description</span></span>|<span data-ttu-id="bde37-144">Ejecute este procedimiento en</span><span class="sxs-lookup"><span data-stu-id="bde37-144">Run this procedure on</span></span>|  
|----------------------|-----------------|---------------------------|  
|[<span data-ttu-id="bde37-145">sp_help_log_shipping_monitor_primary</span><span class="sxs-lookup"><span data-stu-id="bde37-145">sp_help_log_shipping_monitor_primary</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-monitor-primary-transact-sql)|<span data-ttu-id="bde37-146">Devuelve registros de supervisión para la base de datos principal especificada desde la tabla **log_shipping_monitor_primary** .</span><span class="sxs-lookup"><span data-stu-id="bde37-146">Returns monitor records for the specified primary database from the **log_shipping_monitor_primary** table.</span></span>|<span data-ttu-id="bde37-147">Servidor de supervisión o servidor principal</span><span class="sxs-lookup"><span data-stu-id="bde37-147">Monitor server or primary server</span></span>|  
|[<span data-ttu-id="bde37-148">sp_help_log_shipping_monitor_secondary</span><span class="sxs-lookup"><span data-stu-id="bde37-148">sp_help_log_shipping_monitor_secondary</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-monitor-secondary-transact-sql)|<span data-ttu-id="bde37-149">Devuelve registros de supervisión para la base de datos secundaria especificada desde la tabla **log_shipping_monitor_secondary** .</span><span class="sxs-lookup"><span data-stu-id="bde37-149">Returns monitor records for the specified secondary database from the **log_shipping_monitor_secondary** table.</span></span>|<span data-ttu-id="bde37-150">Servidor de supervisión o servidor secundario</span><span class="sxs-lookup"><span data-stu-id="bde37-150">Monitor server or secondary server</span></span>|  
|[<span data-ttu-id="bde37-151">sp_help_log_shipping_alert_job</span><span class="sxs-lookup"><span data-stu-id="bde37-151">sp_help_log_shipping_alert_job</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-alert-job-transact-sql)|<span data-ttu-id="bde37-152">Devuelve el Id. del trabajo de alerta.</span><span class="sxs-lookup"><span data-stu-id="bde37-152">Returns the job ID of the alert job.</span></span>|<span data-ttu-id="bde37-153">Servidor de supervisión, o bien servidor primario o secundario si no hay ningún servidor de supervisión definido</span><span class="sxs-lookup"><span data-stu-id="bde37-153">Monitor server, or primary or secondary server if no monitor is defined</span></span>|  
|[<span data-ttu-id="bde37-154">sp_help_log_shipping_primary_database</span><span class="sxs-lookup"><span data-stu-id="bde37-154">sp_help_log_shipping_primary_database</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-primary-database-transact-sql)|<span data-ttu-id="bde37-155">Recupera la configuración de la base de datos principal y muestra los valores de las tablas **log_shipping_primary_databases** y **log_shipping_monitor_primary** .</span><span class="sxs-lookup"><span data-stu-id="bde37-155">Retrieves primary database settings and displays the values from the **log_shipping_primary_databases** and **log_shipping_monitor_primary** tables.</span></span>|<span data-ttu-id="bde37-156">Servidor principal</span><span class="sxs-lookup"><span data-stu-id="bde37-156">Primary server</span></span>|  
|[<span data-ttu-id="bde37-157">sp_help_log_shipping_primary_secondary</span><span class="sxs-lookup"><span data-stu-id="bde37-157">sp_help_log_shipping_primary_secondary</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-primary-secondary-transact-sql)|<span data-ttu-id="bde37-158">Recupera nombres de las bases de datos secundarias para una base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="bde37-158">Retrieves secondary database names for a primary database.</span></span>|<span data-ttu-id="bde37-159">Servidor principal</span><span class="sxs-lookup"><span data-stu-id="bde37-159">Primary server</span></span>|  
|[<span data-ttu-id="bde37-160">sp_help_log_shipping_secondary_database</span><span class="sxs-lookup"><span data-stu-id="bde37-160">sp_help_log_shipping_secondary_database</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-secondary-database-transact-sql)|<span data-ttu-id="bde37-161">Recupera la configuración de la base de datos secundaria de las tablas **log_shipping_secondary**, **log_shipping_secondary_databases** y **log_shipping_monitor_secondary** .</span><span class="sxs-lookup"><span data-stu-id="bde37-161">Retrieves secondary-database settings from the **log_shipping_secondary**, **log_shipping_secondary_databases** and **log_shipping_monitor_secondary** tables.</span></span>|<span data-ttu-id="bde37-162">Servidor secundario</span><span class="sxs-lookup"><span data-stu-id="bde37-162">Secondary server</span></span>|  
|[<span data-ttu-id="bde37-163">sp_help_log_shipping_secondary_primary &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="bde37-163">sp_help_log_shipping_secondary_primary &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-secondary-primary-transact-sql)|<span data-ttu-id="bde37-164">Este procedimiento almacenado recupera la configuración de una base de datos principal determinada en el servidor secundario.</span><span class="sxs-lookup"><span data-stu-id="bde37-164">This stored procedure retrieves the settings for a given primary database on the secondary server.</span></span>|<span data-ttu-id="bde37-165">Servidor secundario</span><span class="sxs-lookup"><span data-stu-id="bde37-165">Secondary server</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="bde37-166">Consulte también</span><span class="sxs-lookup"><span data-stu-id="bde37-166">See Also</span></span>  
 <span data-ttu-id="bde37-167">[Ver el informe de trasvase de registros &#40;SQL Server Management Studio&#41;](view-the-log-shipping-report-sql-server-management-studio.md) </span><span class="sxs-lookup"><span data-stu-id="bde37-167">[View the Log Shipping Report &#40;SQL Server Management Studio&#41;](view-the-log-shipping-report-sql-server-management-studio.md) </span></span>  
 [<span data-ttu-id="bde37-168">Tablas y procedimientos almacenados de trasvase de registros</span><span class="sxs-lookup"><span data-stu-id="bde37-168">Log Shipping Stored Procedures and Tables</span></span>](log-shipping-tables-and-stored-procedures.md)  
  
  
