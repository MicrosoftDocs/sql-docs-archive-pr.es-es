---
title: Transacciones en tablas con optimización para memoria | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: 2cd07d26-a1f1-4034-8d6f-f196eed1b763
author: stevestein
ms.author: sstein
ms.openlocfilehash: bc9109c7243e609e5ddd820b61386183761167bf
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87751370"
---
# <a name="transactions-in-memory-optimized-tables"></a><span data-ttu-id="89c5c-102">Transacciones en tablas con optimización para memoria</span><span class="sxs-lookup"><span data-stu-id="89c5c-102">Transactions in Memory-Optimized Tables</span></span>
  <span data-ttu-id="89c5c-103">La versión de las filas de las tablas basadas en disco (con el aislamiento de instantánea o READ_COMMITTED_SNAPSHOT) proporciona una forma de control de simultaneidad optimista.</span><span class="sxs-lookup"><span data-stu-id="89c5c-103">Row versioning on disk-based tables (using SNAPSHOT isolation or READ_COMMITTED_SNAPSHOT) provides a form of optimistic concurrency control.</span></span> <span data-ttu-id="89c5c-104">Los lectores y los escritores no se bloquean entre sí.</span><span class="sxs-lookup"><span data-stu-id="89c5c-104">Readers and writers do not block each other.</span></span> <span data-ttu-id="89c5c-105">Con las tablas optimizadas para memoria, los escritores no bloquean a los escritores.</span><span class="sxs-lookup"><span data-stu-id="89c5c-105">With memory-optimized tables, writers do not block writers.</span></span> <span data-ttu-id="89c5c-106">Con las versiones de fila de las tablas basadas en disco, una transacción cierra la fila y se bloquean las transacciones simultáneas que intentan actualizar la fila.</span><span class="sxs-lookup"><span data-stu-id="89c5c-106">With row versioning on disk-based tables, one transaction locks the row and concurrent transactions attempting to update the row are blocked.</span></span> <span data-ttu-id="89c5c-107">Con las tablas optimizadas para memoria, no hay bloqueos.</span><span class="sxs-lookup"><span data-stu-id="89c5c-107">There is no locking with memory-optimized tables.</span></span> <span data-ttu-id="89c5c-108">En su lugar, si dos transacciones intentan actualizar la misma fila, se produciría un conflicto de escritura/escritura (error 41302).</span><span class="sxs-lookup"><span data-stu-id="89c5c-108">Instead, if two transactions attempt to update the same row, a write/write conflict (error 41302) will occur.</span></span>

 <span data-ttu-id="89c5c-109">A diferencia de las tablas basadas en disco, las tablas optimizadas para memoria permiten un control de simultaneidad optimista con los mayores niveles de aislamiento, REPEATABLE READ y SERIALIZABLE.</span><span class="sxs-lookup"><span data-stu-id="89c5c-109">Unlike disk-based tables, memory-optimized tables allow optimistic concurrency control with the higher isolation levels, REPEATABLE READ and SERIALIZABLE.</span></span> <span data-ttu-id="89c5c-110">Los bloqueos no se adoptan para exigir los niveles de aislamiento.</span><span class="sxs-lookup"><span data-stu-id="89c5c-110">Locks are not taken to enforce the isolation levels.</span></span> <span data-ttu-id="89c5c-111">En su lugar, al final de la transacción, la validación garantiza las suposiciones de seriabilidad o de lectura repetible.</span><span class="sxs-lookup"><span data-stu-id="89c5c-111">Instead, at the end of the transaction validation ensures the repeatable read or serializability assumptions.</span></span> <span data-ttu-id="89c5c-112">Si las suposiciones se infringen, la transacción se termina.</span><span class="sxs-lookup"><span data-stu-id="89c5c-112">If the assumptions are violated, the transaction is terminated.</span></span> <span data-ttu-id="89c5c-113">Para obtener más información, consulte [Transaction Isolation Levels](../../2014/database-engine/transaction-isolation-levels.md).</span><span class="sxs-lookup"><span data-stu-id="89c5c-113">For more information, see [Transaction Isolation Levels](../../2014/database-engine/transaction-isolation-levels.md).</span></span>

 <span data-ttu-id="89c5c-114">La semántica de transacciones importantes para las tablas optimizadas para memoria es:</span><span class="sxs-lookup"><span data-stu-id="89c5c-114">The important transaction semantics for memory-optimized tables are:</span></span>

-   <span data-ttu-id="89c5c-115">Multiversión</span><span class="sxs-lookup"><span data-stu-id="89c5c-115">Multi-versioning</span></span>

-   <span data-ttu-id="89c5c-116">Aislamiento de transacción basada en instantánea</span><span class="sxs-lookup"><span data-stu-id="89c5c-116">Snapshot-based transaction isolation</span></span>

-   <span data-ttu-id="89c5c-117">Optimistic</span><span class="sxs-lookup"><span data-stu-id="89c5c-117">Optimistic</span></span>

-   <span data-ttu-id="89c5c-118">Detección de conflictos</span><span class="sxs-lookup"><span data-stu-id="89c5c-118">Conflict detection</span></span>

 <span data-ttu-id="89c5c-119">Cada uno de estos elementos de la semántica se explica en las secciones siguientes.</span><span class="sxs-lookup"><span data-stu-id="89c5c-119">Each of these semantics is explained in the following sections.</span></span>

## <a name="multi-versioning-in-memory-optimized-tables"></a><span data-ttu-id="89c5c-120">Multiversión en tablas con optimización para memoria</span><span class="sxs-lookup"><span data-stu-id="89c5c-120">Multi-Versioning in Memory-Optimized Tables</span></span>
 <span data-ttu-id="89c5c-121">Las filas de las tablas optimizadas para memoria pueden tener distintas versiones.</span><span class="sxs-lookup"><span data-stu-id="89c5c-121">Rows in memory-optimized tables can have different versions.</span></span> <span data-ttu-id="89c5c-122">Las transacciones simultáneas tienen acceso a versiones posiblemente diferentes de la misma fila.</span><span class="sxs-lookup"><span data-stu-id="89c5c-122">Concurrent transactions access potentially different versions of the same row.</span></span>

 <span data-ttu-id="89c5c-123">Los datos de las tablas con optimización para memoria están basados en versiones.</span><span class="sxs-lookup"><span data-stu-id="89c5c-123">Memory-optimized table data is version-based.</span></span> <span data-ttu-id="89c5c-124">Para una fila, puede haber varias versiones de fila diferentes que sean válidas en momentos distintos.</span><span class="sxs-lookup"><span data-stu-id="89c5c-124">For any row there may be different row versions that are valid at different points in time.</span></span> <span data-ttu-id="89c5c-125">Las tablas basadas en disco mantienen varias versiones de fila distintas, si READ_COMMITTED_SNAPSHOT o ALLOW_SNAPSHOT_ISOLATION están establecidos en ON.</span><span class="sxs-lookup"><span data-stu-id="89c5c-125">Disk-based tables maintain different row versions when READ_COMMITTED_SNAPSHOT or ALLOW_SNAPSHOT_ISOLATION is ON.</span></span> <span data-ttu-id="89c5c-126">Las tablas con optimización para memoria mantienen diferentes versiones de fila, incluso si READ_COMMITTED_SNAPSHOT y ALLOW_SNAPSHOT_ISOLATION se establecen en OFF.</span><span class="sxs-lookup"><span data-stu-id="89c5c-126">Memory-optimized tables maintain different row versions, even if READ_COMMITTED_SNAPSHOT and ALLOW_SNAPSHOT_ISOLATION are OFF.</span></span> <span data-ttu-id="89c5c-127">Las versiones de fila de las tablas optimizadas para memoria no se mantienen en tempdb.</span><span class="sxs-lookup"><span data-stu-id="89c5c-127">The row versions of memory-optimized tables are not maintained in tempdb.</span></span> <span data-ttu-id="89c5c-128">En su lugar, las versiones de fila se mantienen insertadas, como parte de las estructuras de datos optimizados para memoria que almacenan las filas en memoria.</span><span class="sxs-lookup"><span data-stu-id="89c5c-128">Instead, the row versions are maintained in-line, as part of the memory-optimized data structures storing the rows in memory.</span></span>

## <a name="snapshot-based-transaction-isolation-for-memory-optimized-tables"></a><span data-ttu-id="89c5c-129">Aislamiento de transacciones basado en instantáneas para las tablas con optimización para memoria</span><span class="sxs-lookup"><span data-stu-id="89c5c-129">Snapshot-Based Transaction Isolation for Memory-Optimized Tables</span></span>
 <span data-ttu-id="89c5c-130">Todas las operaciones de una sola transacción utilizan la misma instantánea coherente desde el punto de vista de las transacciones de las tablas optimizadas para memoria.</span><span class="sxs-lookup"><span data-stu-id="89c5c-130">All operations in a single transaction use the same transactionally-consistent snapshot of the memory-optimized tables.</span></span> <span data-ttu-id="89c5c-131">Todo el aislamiento de transacciones para las tablas optimizadas para memoria se basan en las instantáneas.</span><span class="sxs-lookup"><span data-stu-id="89c5c-131">All transaction isolation for memory-optimized tables is snapshot-based.</span></span> <span data-ttu-id="89c5c-132">Por ejemplo, una transacción que usa el nivel de aislamiento serializable para tener acceso a las tablas optimizadas para memoria realizará todas las operaciones en la misma instantánea coherente desde el punto de vista de las transacciones.</span><span class="sxs-lookup"><span data-stu-id="89c5c-132">For example, a transaction using the serializable isolation level to access memory-optimized tables will perform all operations on the same transactionally consistent snapshot.</span></span>

 <span data-ttu-id="89c5c-133">Las transacciones que tienen acceso a las tablas optimizadas para memoria utilizan esta versión de fila para obtener una instantánea coherente con las transacciones de las filas de las tablas.</span><span class="sxs-lookup"><span data-stu-id="89c5c-133">Transactions that access memory-optimized tables use this row versioning to obtain a transactionally consistent snapshot of the rows in the tables.</span></span> <span data-ttu-id="89c5c-134">Los datos leídos por cualquier instrucción de la transacción serán la versión coherente, desde el punto de vista transaccional, de los datos existentes en el momento en que la transacción se iniciara.</span><span class="sxs-lookup"><span data-stu-id="89c5c-134">The data read by any statement in the transaction will be the transactionally consistent version of the data that existed at the time the transaction started.</span></span> <span data-ttu-id="89c5c-135">Por tanto, las modificaciones realizadas simultáneamente ejecutando transacciones no son visibles para las instrucciones de la transacción actual.</span><span class="sxs-lookup"><span data-stu-id="89c5c-135">Therefore, any modifications made by concurrently running transactions are not visible to statements in the current transaction.</span></span>

## <a name="optimistic-concurrency-control-for-memory-optimized-tables"></a><span data-ttu-id="89c5c-136">Control de simultaneidad optimista para las tablas con optimización para memoria</span><span class="sxs-lookup"><span data-stu-id="89c5c-136">Optimistic Concurrency Control for Memory-Optimized Tables</span></span>
 <span data-ttu-id="89c5c-137">Los conflictos y errores son poco frecuentes y las transacciones en tablas optimizadas para memoria suponen que no hay ningún conflicto con transacciones simultáneas y que las operaciones se realizan correctamente.</span><span class="sxs-lookup"><span data-stu-id="89c5c-137">Conflicts and failures are rare and transactions on memory-optimized tables assume there are no conflicts with concurrent transactions and operations succeed.</span></span> <span data-ttu-id="89c5c-138">Las transacciones no utilizan bloqueos ni bloqueos temporales en tablas optimizadas para memoria al objeto de garantizar el aislamiento de las transacciones.</span><span class="sxs-lookup"><span data-stu-id="89c5c-138">Transactions do not take locks or latches on memory-optimized table to guarantee transaction isolation.</span></span> <span data-ttu-id="89c5c-139">Los escritores no bloquean a los lectores.</span><span class="sxs-lookup"><span data-stu-id="89c5c-139">Writers do not block readers.</span></span> <span data-ttu-id="89c5c-140">Los escritores no bloquean a los escritores.</span><span class="sxs-lookup"><span data-stu-id="89c5c-140">Writers do not block writers.</span></span> <span data-ttu-id="89c5c-141">En su lugar, las transacciones continúan con la suposición (optimista) de que no habrá ningún conflicto con otras transacciones.</span><span class="sxs-lookup"><span data-stu-id="89c5c-141">Instead, transactions proceed under the (optimistic) assumption that there will be no conflicts with other transactions.</span></span> <span data-ttu-id="89c5c-142">Al no utilizar bloqueos ni bloqueos temporales y al no esperar a que otras transacciones finalicen el procesamiento de las mismas filas, se mejora el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="89c5c-142">Not using locks and latches and not waiting for other transactions to finish processing the same rows improves performance.</span></span>

 <span data-ttu-id="89c5c-143">Además, si una transacción (TxA) lee filas que otra transacción (TxB) ha insertado o modificado y está en proceso de confirmación, se supondrá de forma optimista la confirmación de la otra transacción, en lugar de esperar a que la confirmación se produzca.</span><span class="sxs-lookup"><span data-stu-id="89c5c-143">In addition, if a transaction (TxA) reads rows that have been inserted or modified by another transaction (TxB) that is in the process of committing, it will optimistically assume the other transaction will commit rather than wait for the commit to occur.</span></span> <span data-ttu-id="89c5c-144">En este caso, la transacción TxA tendrá una dependencia de confirmación de la transacción TxB.</span><span class="sxs-lookup"><span data-stu-id="89c5c-144">In this case, transaction TxA will take a commit dependency on transaction TxB.</span></span>

## <a name="conflict-detection-validation-and-commit-dependency-checks"></a><span data-ttu-id="89c5c-145">Detección de conflictos, validación y comprobaciones de las dependencias de confirmación</span><span class="sxs-lookup"><span data-stu-id="89c5c-145">Conflict Detection, Validation, and Commit Dependency Checks</span></span>
 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] <span data-ttu-id="89c5c-146">detecta conflictos entre las operaciones simultáneas, así como las infracciones del nivel de aislamiento y condenará una de las transacciones en conflicto.</span><span class="sxs-lookup"><span data-stu-id="89c5c-146">detects conflicts between concurrent transactions, as well as isolation level violations, and will doom one of the conflicting transactions.</span></span> <span data-ttu-id="89c5c-147">Esta transacción tendrá que volver a intentarse.</span><span class="sxs-lookup"><span data-stu-id="89c5c-147">This transaction will need to be retried.</span></span> <span data-ttu-id="89c5c-148">(Para obtener más información, vea [Guidelines for Retry Logic for Transactions on Memory-Optimized Tables](../relational-databases/in-memory-oltp/memory-optimized-tables.md)).</span><span class="sxs-lookup"><span data-stu-id="89c5c-148">(For more information, see [Guidelines for Retry Logic for Transactions on Memory-Optimized Tables](../relational-databases/in-memory-oltp/memory-optimized-tables.md).)</span></span>

 <span data-ttu-id="89c5c-149">El sistema supone de forma optimista que no hay conflictos ni infracciones de aislamiento de transacciones.</span><span class="sxs-lookup"><span data-stu-id="89c5c-149">The system optimistically assumes there are no conflicts and no violations of transaction isolation.</span></span> <span data-ttu-id="89c5c-150">Los conflictos que puedan provocar incoherencias en la base de datos o puedan infringir el aislamiento de la transacción, se detectan y se termina la transacción.</span><span class="sxs-lookup"><span data-stu-id="89c5c-150">If any conflicts occur that may cause inconsistencies in the database or that may violate transaction isolation, these conflicts are detected, and the transaction is terminated.</span></span>

 <span data-ttu-id="89c5c-151">Si se detecta un conflicto, se termina la transacción y el cliente tiene que volver a intentarlo.</span><span class="sxs-lookup"><span data-stu-id="89c5c-151">If a conflict is detected, the transaction is terminated and the client needs to retry.</span></span>

 <span data-ttu-id="89c5c-152">En la tabla siguiente se resumen las condiciones de error de las transacciones que tienen acceso a las tablas optimizadas para memoria.</span><span class="sxs-lookup"><span data-stu-id="89c5c-152">The following table summarizes the error conditions for transactions that accesses memory-optimized tables.</span></span>

### <a name="error-conditions-for-transactions-accessing-memory-optimized-tables"></a><span data-ttu-id="89c5c-153">Condiciones de error para las transacciones que tienen acceso a las tablas optimizadas para memoria.</span><span class="sxs-lookup"><span data-stu-id="89c5c-153">Error conditions for transactions accessing memory-optimized tables.</span></span>

|<span data-ttu-id="89c5c-154">Error</span><span class="sxs-lookup"><span data-stu-id="89c5c-154">Error</span></span>|<span data-ttu-id="89c5c-155">Escenario</span><span class="sxs-lookup"><span data-stu-id="89c5c-155">Scenario</span></span>|
|-----------|--------------|
|<span data-ttu-id="89c5c-156">Conflicto de escritura.</span><span class="sxs-lookup"><span data-stu-id="89c5c-156">Write conflict.</span></span> <span data-ttu-id="89c5c-157">Intentando actualizar un registro que se ha actualizado desde que la transacción se inició.</span><span class="sxs-lookup"><span data-stu-id="89c5c-157">Attempting to update a record that has been updated since the transaction started.</span></span>|<span data-ttu-id="89c5c-158">UPDATE o DELETE una fila que ha sido actualizada o eliminada por una transacción simultánea.</span><span class="sxs-lookup"><span data-stu-id="89c5c-158">UPDATE or DELETE a row that has been updated or deleted by a concurrent transaction.</span></span>|
|<span data-ttu-id="89c5c-159">Error de validación de lectura repetible</span><span class="sxs-lookup"><span data-stu-id="89c5c-159">Repeatable read validation failure.</span></span>|<span data-ttu-id="89c5c-160">Una fila que la transacción leyó ha cambiado (se ha actualizado o eliminado) desde que se inició la transacción.</span><span class="sxs-lookup"><span data-stu-id="89c5c-160">A row that was read by the transaction has changed (updated or deleted) since the transaction started.</span></span> <span data-ttu-id="89c5c-161">La validación de lectura repetible suele producirse cuando se usan los niveles de aislamiento de transacción REPEATABLE READ y SERIALIZABLE.</span><span class="sxs-lookup"><span data-stu-id="89c5c-161">Repeatable read validation is typically occurs when using REPEATABLE READ and SERIALIZABLE transaction isolation levels.</span></span>|
|<span data-ttu-id="89c5c-162">Error de validación serializable.</span><span class="sxs-lookup"><span data-stu-id="89c5c-162">Serializable validation failure.</span></span>|<span data-ttu-id="89c5c-163">Una nueva fila (fantasma) se ha insertado en uno de los intervalos de recorrido en la transacción, desde que esta se inició.</span><span class="sxs-lookup"><span data-stu-id="89c5c-163">A new (phantom) row has been inserted in one of the scan ranges in the transaction, since the transaction started.</span></span> <span data-ttu-id="89c5c-164">La fila habría estado visible para la transacción si la fila se hubiera confirmado en la base de datos antes de que la transacción comenzara.</span><span class="sxs-lookup"><span data-stu-id="89c5c-164">The row would have been visible to the transaction if the row had been committed to the database before the transaction started.</span></span> <span data-ttu-id="89c5c-165">La validación SERIALIZABLE se produce normalmente cuando se usa el aislamiento SERIALIZABLE y la validación de restricciones PRIMARY KEY.</span><span class="sxs-lookup"><span data-stu-id="89c5c-165">SERIALIZABLE validation typically occurs when using SERIALIZABLE isolation and validating PRIMARY KEY constraints.</span></span>|
|<span data-ttu-id="89c5c-166">Confirme el error de dependencia.</span><span class="sxs-lookup"><span data-stu-id="89c5c-166">Commit dependency failure.</span></span>|<span data-ttu-id="89c5c-167">La transacción adoptó una dependencia en otra transacción, que no puede confirmarse, debido a uno de los errores de esta tabla, a una condición de memoria insuficiente o a que no puede confirmarse en el registro de transacciones.</span><span class="sxs-lookup"><span data-stu-id="89c5c-167">The transaction took a dependency on another transaction that failed to commit, either due to one of the failures in this table, an out-of-memory condition, or due to failure to commit to the transaction log.</span></span> <span data-ttu-id="89c5c-168">Este error puede aparecer con las transacciones de lectura/escritura y de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="89c5c-168">This failure can occur with both read/write and read-only transactions.</span></span>|

### <a name="transaction-lifetime"></a><span data-ttu-id="89c5c-169">Período de duración de las transacciones</span><span class="sxs-lookup"><span data-stu-id="89c5c-169">Transaction Lifetime</span></span>
 <span data-ttu-id="89c5c-170">Los errores enumerados en la tabla anterior pueden producirse en varios momentos durante una transacción.</span><span class="sxs-lookup"><span data-stu-id="89c5c-170">The failures mentioned in the previous table can occur at different points during a transaction.</span></span> <span data-ttu-id="89c5c-171">La ilustración siguiente muestra las fases de una transacción que tiene acceso a tablas optimizadas para memoria.</span><span class="sxs-lookup"><span data-stu-id="89c5c-171">The following figure illustrates the phases of a transaction that accesses memory-optimized tables.</span></span>

 <span data-ttu-id="89c5c-172">![Duración de una transacción.](../../2014/database-engine/media/hekaton-transactions.gif "Duración de una transacción.")</span><span class="sxs-lookup"><span data-stu-id="89c5c-172">![Lifetime of a transaction.](../../2014/database-engine/media/hekaton-transactions.gif "Lifetime of a transaction.")</span></span>
<span data-ttu-id="89c5c-173">Duración de una transacción que tiene acceso a tablas optimizadas para memoria.</span><span class="sxs-lookup"><span data-stu-id="89c5c-173">Lifetime of a transaction that accesses memory-optimized tables.</span></span>

#### <a name="regular-processing"></a><span data-ttu-id="89c5c-174">Procesamiento normal</span><span class="sxs-lookup"><span data-stu-id="89c5c-174">Regular Processing</span></span>
 <span data-ttu-id="89c5c-175">Durante esta fase, se ejecutan las instrucciones de [!INCLUDE[tsql](../includes/tsql-md.md)] emitidas por el usuario.</span><span class="sxs-lookup"><span data-stu-id="89c5c-175">During this phase, the user-issued [!INCLUDE[tsql](../includes/tsql-md.md)] statements are executed.</span></span> <span data-ttu-id="89c5c-176">Las filas se leen de las tablas y las nuevas versiones de fila se escriben en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="89c5c-176">Rows are read from the tables, and new row versions are written to the database.</span></span> <span data-ttu-id="89c5c-177">La transacción se aísla de todas las demás transacciones simultáneas.</span><span class="sxs-lookup"><span data-stu-id="89c5c-177">The transaction is isolated from all other concurrent transactions.</span></span> <span data-ttu-id="89c5c-178">La transacción utiliza la instantánea de las tablas optimizadas para memoria que existen en el momento de iniciarse la transacción.</span><span class="sxs-lookup"><span data-stu-id="89c5c-178">The transaction uses the snapshot of the memory-optimized tables that exists at the start of the transaction.</span></span>

 <span data-ttu-id="89c5c-179">Las acciones de escritura en las tablas en esta fase de la transacción ya no están visibles para otras transacciones, con una excepción: las actualizaciones de fila y las eliminaciones están visibles para las operaciones de actualización y eliminación en otras transacciones, con el fin de detectar conflictos de escritura.</span><span class="sxs-lookup"><span data-stu-id="89c5c-179">Writes to the tables in this phase of the transaction are not yet visible to other transactions, with one exception: row updates and deletes are visible to update and delete operations in other transactions, in order to detect write conflicts.</span></span>

 <span data-ttu-id="89c5c-180">Si una operación de actualización o de eliminación considera que se ha actualizado o se ha eliminado una fila desde el inicio lógico de la transacción, la operación producirá el error 41302.</span><span class="sxs-lookup"><span data-stu-id="89c5c-180">If an update or delete operation sees that a row has been updated or deleted since the logical start of the transaction, the operation will fail with error 41302.</span></span> <span data-ttu-id="89c5c-181">El mensaje del error 41302 es “La transacción actual intentó actualizar un registro en la tabla X que se ha actualizado desde que esta transacción se inició.</span><span class="sxs-lookup"><span data-stu-id="89c5c-181">The message for error 41302 is "The current transaction attempted to update a record in table X that has been updated since this transaction started.</span></span> <span data-ttu-id="89c5c-182">Se anuló la transacción."</span><span class="sxs-lookup"><span data-stu-id="89c5c-182">The transaction was aborted."</span></span>

 <span data-ttu-id="89c5c-183">Este error destruye la transacción (incluso si XACT_ABORT está en OFF), lo que significa que la transacción se revertirá cuando la sesión de usuario finaliza.</span><span class="sxs-lookup"><span data-stu-id="89c5c-183">This error dooms the transaction (even if XACT_ABORT is OFF), meaning that the transaction will be rolled back when the user session ends.</span></span> <span data-ttu-id="89c5c-184">Las transacciones condenadas no se puede confirmar y solo admiten operaciones de lectura que no escriben en el registro y no tienen acceso a las tablas optimizadas para memoria.</span><span class="sxs-lookup"><span data-stu-id="89c5c-184">Doomed transactions cannot be committed and only support read operations that do not write to the log and do not access memory-optimized tables.</span></span>

#####  <a name="commit-dependencies"></a><a name="cd"></a><span data-ttu-id="89c5c-185">Dependencias de confirmación</span><span class="sxs-lookup"><span data-stu-id="89c5c-185">Commit Dependencies</span></span>
 <span data-ttu-id="89c5c-186">Durante el procesamiento normal, una transacción puede leer las filas escritas por otras transacciones que están en la fase de confirmación o validación, pero aún no se hayan confirmado.</span><span class="sxs-lookup"><span data-stu-id="89c5c-186">During regular processing, a transaction can read rows written by other transactions that are in the validation or commit phase, but have not yet committed.</span></span> <span data-ttu-id="89c5c-187">Las filas están visibles porque la hora de finalización lógica de las transacciones se ha asignado al inicio de la fase de validación.</span><span class="sxs-lookup"><span data-stu-id="89c5c-187">The rows are visible because the logical end time of the transactions has been assigned at the start of the validation phase.</span></span>

 <span data-ttu-id="89c5c-188">Si una transacción lee estas filas no confirmadas, realizará una dependencia de confirmación en esa transacción.</span><span class="sxs-lookup"><span data-stu-id="89c5c-188">If a transaction reads such uncommitted rows, it will take a commit dependency on that transaction.</span></span> <span data-ttu-id="89c5c-189">Esto tiene dos implicaciones principales:</span><span class="sxs-lookup"><span data-stu-id="89c5c-189">This has two main implications:</span></span>

-   <span data-ttu-id="89c5c-190">Una transacción no puede confirmarse hasta que las transacciones de las que depende se hayan confirmado.</span><span class="sxs-lookup"><span data-stu-id="89c5c-190">A transaction cannot commit until the transactions it depends on have committed.</span></span> <span data-ttu-id="89c5c-191">Es decir, no puede entrar en la fase de confirmación hasta que todas las dependencias se hayan borrado.</span><span class="sxs-lookup"><span data-stu-id="89c5c-191">In other words, it cannot enter the commit phase, until all dependencies have cleared.</span></span>

-   <span data-ttu-id="89c5c-192">Además, no se devuelven los conjuntos de resultados al cliente hasta que todas las dependencias se han borrado.</span><span class="sxs-lookup"><span data-stu-id="89c5c-192">In addition, result sets are not returned to the client until all dependencies have cleared.</span></span> <span data-ttu-id="89c5c-193">Esto evita que el cliente observe datos los no confirmados.</span><span class="sxs-lookup"><span data-stu-id="89c5c-193">This prevents the client from observing uncommitted data.</span></span>

 <span data-ttu-id="89c5c-194">Si alguna de las transacciones dependientes no se puede confirmar, hay un error de dependencia de confirmación.</span><span class="sxs-lookup"><span data-stu-id="89c5c-194">If any of the dependent transactions fails to commit, there is a commit dependency failure.</span></span> <span data-ttu-id="89c5c-195">Esto significa que la transacción no podrá confirmarse con el error 41301 (“ Una transacción previa en la que la transacción actual tenía una dependencia ha sido anulada y la transacción actual ya no puede confirmarse").</span><span class="sxs-lookup"><span data-stu-id="89c5c-195">This means the transaction will fail to commit with error 41301 ("A previous transaction that the current transaction took a dependency on has aborted, and the current transaction can no longer commit.").</span></span>

#### <a name="validation-phase"></a><span data-ttu-id="89c5c-196">Fase de validación</span><span class="sxs-lookup"><span data-stu-id="89c5c-196">Validation Phase</span></span>
 <span data-ttu-id="89c5c-197">Durante la fase de validación, el sistema comprueba que las suposiciones necesarias para el nivel de aislamiento de transacción solicitado se ha cumplido entre el inicio lógico y la finalización lógica de la transacción.</span><span class="sxs-lookup"><span data-stu-id="89c5c-197">During the validation phase, the system validates that the assumptions necessary for the requested transaction isolation level were true between the logical start and logical end of the transaction.</span></span>

 <span data-ttu-id="89c5c-198">Al comienzo de la fase de validación, a la transacción se le asigna una hora de finalización lógica.</span><span class="sxs-lookup"><span data-stu-id="89c5c-198">At the start of the validation phase, the transaction is assigned a logical end time.</span></span> <span data-ttu-id="89c5c-199">Las versiones de fila escritas en la base de datos se hacen visibles para otras transacciones en el momento de finalización lógica.</span><span class="sxs-lookup"><span data-stu-id="89c5c-199">The row versions written in the database become visible to other transactions at the logical end time.</span></span> <span data-ttu-id="89c5c-200">Para obtener más información, vea [Confirmar las dependencias](#cd).</span><span class="sxs-lookup"><span data-stu-id="89c5c-200">For more information, see [Commit Dependencies](#cd).</span></span>

##### <a name="repeatable-read-validation"></a><span data-ttu-id="89c5c-201">Validación de lectura repetible</span><span class="sxs-lookup"><span data-stu-id="89c5c-201">Repeatable Read Validation</span></span>
 <span data-ttu-id="89c5c-202">Si el nivel de aislamiento de la transacción es REPEATABLE READ o SERIALIZABLE o bien, si se tiene acceso a las tablas con aislamiento REPEATABLE READ o SERIALIZABLE (para obtener más información, vea la sección sobre el aislamiento de operaciones individuales en [Transaction Isolation Levels](../../2014/database-engine/transaction-isolation-levels.md)), el sistema validará que las lecturas son repetibles.</span><span class="sxs-lookup"><span data-stu-id="89c5c-202">If the isolation level of the transaction is REPEATABLE READ or SERIALIZABLE, or if tables are accessed under REPEATABLE READ or SERIALIZABLE isolation (for more information, see the section on Isolation of Individual Operations in [Transaction Isolation Levels](../../2014/database-engine/transaction-isolation-levels.md)), the system validates that the reads are repeatable.</span></span> <span data-ttu-id="89c5c-203">Esto significa que comprueba que las versiones de las filas leídas por la transacción son todavía versiones de fila válidas con la lógica y la hora de la transacción.</span><span class="sxs-lookup"><span data-stu-id="89c5c-203">This means it validates that the versions of the rows read by the transaction are still valid row versions at the logical end time of the transaction.</span></span>

 <span data-ttu-id="89c5c-204">Si alguna de las filas se ha actualizado o se ha modificado, la transacción no puede confirmarse con el error 41305 (“La transacción actual no pudo confirmarse debido a un error de validación de lectura repetible").</span><span class="sxs-lookup"><span data-stu-id="89c5c-204">If any of the rows have been updated or changed, the transaction fails to commit with error 41305 ("The current transaction failed to commit due to a repeatable read validation failure.").</span></span>

 <span data-ttu-id="89c5c-205">Este error también puede producirse si se quita una tabla después de una operación de inserción, una actualización o una operación de eliminación y antes de que se confirme la transacción.</span><span class="sxs-lookup"><span data-stu-id="89c5c-205">This error can also occur if a table is dropped after an insert, update, or delete operation and before the transaction commits.</span></span> <span data-ttu-id="89c5c-206">Esto se aplica solo a las operaciones de inserción, actualización o eliminación en procedimientos almacenados compilados de forma nativa.</span><span class="sxs-lookup"><span data-stu-id="89c5c-206">This applies only to insert, update, or delete operations in natively compiled stored procedures.</span></span> <span data-ttu-id="89c5c-207">Tales operaciones de escritura realizadas a través de [!INCLUDE[tsql](../includes/tsql-md.md)] interpretado ocasionan que la instrucción DROP TABLE bloquee y espere hasta que la transacción se confirme.</span><span class="sxs-lookup"><span data-stu-id="89c5c-207">Such write operations performed through interpreted [!INCLUDE[tsql](../includes/tsql-md.md)] cause the DROP TABLE statement to block and wait until the transaction commits.</span></span>

##### <a name="serializable-validation"></a><span data-ttu-id="89c5c-208">Validación serializable</span><span class="sxs-lookup"><span data-stu-id="89c5c-208">Serializable Validation</span></span>
 <span data-ttu-id="89c5c-209">La validación serializable se realiza en dos casos:</span><span class="sxs-lookup"><span data-stu-id="89c5c-209">Serializable validation is performed in two cases:</span></span>

-   <span data-ttu-id="89c5c-210">Si el nivel de aislamiento de la transacción es SERIALIZABLE o se tiene acceso a las tablas con el aislamiento SERIALIZABLE.</span><span class="sxs-lookup"><span data-stu-id="89c5c-210">If the isolation level of the transaction is SERIALIZABLE or tables are accessed under SERIALIZABLE isolation.</span></span>

-   <span data-ttu-id="89c5c-211">Si las filas se insertan en un índice único, como el índice creado para una restricción PRIMARY KEY.</span><span class="sxs-lookup"><span data-stu-id="89c5c-211">If rows are inserted in a unique index, such as the index created for a PRIMARY KEY constraint.</span></span> <span data-ttu-id="89c5c-212">El sistema comprueba que no se han insertado simultáneamente filas con la misma clave.</span><span class="sxs-lookup"><span data-stu-id="89c5c-212">The system validates that no rows with the same key have been concurrently inserted.</span></span>

 <span data-ttu-id="89c5c-213">El sistema comprueba que no se han escrito filas fantasma en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="89c5c-213">The system validates that no phantom rows have been written to the database.</span></span> <span data-ttu-id="89c5c-214">Las operaciones de lectura realizadas por la transacción se evalúan para determinar que no se insertaron nuevas filas en los intervalos de recorrido de estas operaciones de lectura.</span><span class="sxs-lookup"><span data-stu-id="89c5c-214">The read operations performed by the transaction are evaluated to determine that no new rows were inserted in the scan ranges of these read operations.</span></span>

 <span data-ttu-id="89c5c-215">La inserción de una clave en un índice único incluye una operación de lectura implícita para determinar que la clave no es un duplicado.</span><span class="sxs-lookup"><span data-stu-id="89c5c-215">Insertion of a key in a unique index includes an implicit read operation, to determine that the key is not a duplicate.</span></span> <span data-ttu-id="89c5c-216">La validación serializable para índices únicos garantiza que estos índices no puedan tener duplicados en caso de que dos transacciones inserten simultáneamente la misma clave.</span><span class="sxs-lookup"><span data-stu-id="89c5c-216">Serializable validation for unique indexes ensures these indexes cannot have duplicates in case two transactions concurrently insert the same key.</span></span>

 <span data-ttu-id="89c5c-217">Si se detectan filas fantasma, la transacción no puede confirmarse con el error 41325 (“La transacción actual no pudo confirmarse debido a un error de validación serializable").</span><span class="sxs-lookup"><span data-stu-id="89c5c-217">If phantom rows are detected, the transaction fails to commit with error 41325 ("The current transaction failed to commit due to a serializable validation failure.").</span></span>

#### <a name="commit-processing"></a><span data-ttu-id="89c5c-218">Procesamiento de la confirmación</span><span class="sxs-lookup"><span data-stu-id="89c5c-218">Commit Processing</span></span>
 <span data-ttu-id="89c5c-219">Si la validación es correcta y todas las dependencias de la transacción se borran, la transacción entra en la fase de procesamiento de confirmación.</span><span class="sxs-lookup"><span data-stu-id="89c5c-219">If validation succeeds and all transaction dependencies clear, the transaction enters the commit processing phase.</span></span> <span data-ttu-id="89c5c-220">Durante esta fase, los cambios en las tablas durables se escriben en el registro y el registro se escribe en el disco, para asegurar la durabilidad.</span><span class="sxs-lookup"><span data-stu-id="89c5c-220">During this phase the changes to durable tables are written to the log, and the log is written to disk, to ensure durability.</span></span> <span data-ttu-id="89c5c-221">Una vez que el registro de la transacción se ha escrito en el disco, el control se devuelve al cliente.</span><span class="sxs-lookup"><span data-stu-id="89c5c-221">Once the log record for the transaction has been written to disk, control is returned to the client.</span></span>

 <span data-ttu-id="89c5c-222">Se borran todas las dependencias confirmadas en esta transacción y todas las transacciones que habían estado esperando esta transacción para confirmarse pueden continuar.</span><span class="sxs-lookup"><span data-stu-id="89c5c-222">All commit dependencies on this transaction are cleared, and all transactions that had been waiting for this transaction to commit can proceed.</span></span>

## <a name="limitations"></a><span data-ttu-id="89c5c-223">Limitaciones</span><span class="sxs-lookup"><span data-stu-id="89c5c-223">Limitations</span></span>

-   <span data-ttu-id="89c5c-224">Las transacciones entre bases de datos no se admiten con tablas optimizadas para memoria.</span><span class="sxs-lookup"><span data-stu-id="89c5c-224">Cross-database transactions are not supported with memory-optimized tables.</span></span> <span data-ttu-id="89c5c-225">Cada transacción que tiene acceso a tablas optimizadas para memoria no puede tener acceso a más de una base de datos, excepto para el acceso de lectura y escritura a tempdb y el acceso de solo lectura a la base de datos maestra del sistema.</span><span class="sxs-lookup"><span data-stu-id="89c5c-225">Every transaction that accesses memory-optimized tables cannot access more than one database, with the exception of read-write access to tempdb and read-only access to the system database master.</span></span>

-   <span data-ttu-id="89c5c-226">Las transacciones distribuidas no se admiten con tablas optimizadas para memoria.</span><span class="sxs-lookup"><span data-stu-id="89c5c-226">Distributed transactions are not supported with memory-optimized tables.</span></span> <span data-ttu-id="89c5c-227">Las transacciones distribuidas iniciadas con BEGIN DISTRIBUTED TRANSACTION no pueden tener acceso a las tablas optimizadas para memoria.</span><span class="sxs-lookup"><span data-stu-id="89c5c-227">Distributed transactions started with BEGIN DISTRIBUTED TRANSACTION cannot access memory-optimized tables.</span></span>

-   <span data-ttu-id="89c5c-228">Las tablas con optimización para memoria no admiten bloqueos.</span><span class="sxs-lookup"><span data-stu-id="89c5c-228">Memory-optimized tables do not support locking.</span></span> <span data-ttu-id="89c5c-229">Los bloqueos explícitos con sugerencias de bloqueo (como TABLOCK, XLOCK, ROWLOCK) no se admiten con las tablas optimizadas para memoria.</span><span class="sxs-lookup"><span data-stu-id="89c5c-229">Explicit locks through locking hints (such as TABLOCK, XLOCK, ROWLOCK) are not supported with memory-optimized tables.</span></span>

## <a name="see-also"></a><span data-ttu-id="89c5c-230">Consulte también</span><span class="sxs-lookup"><span data-stu-id="89c5c-230">See Also</span></span>
 [<span data-ttu-id="89c5c-231">Descripción de las transacciones en tablas con optimización para memoria</span><span class="sxs-lookup"><span data-stu-id="89c5c-231">Understanding Transactions on Memory-Optimized Tables</span></span>](../../2014/database-engine/understanding-transactions-on-memory-optimized-tables.md)


