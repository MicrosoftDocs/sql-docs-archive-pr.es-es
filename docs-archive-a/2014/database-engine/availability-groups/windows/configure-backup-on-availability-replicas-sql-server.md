---
title: Configurar la copia de seguridad en réplicas de disponibilidad (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/14/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- backup priority
- backup on secondary replicas
- Availability Groups [SQL Server], availability replicas
- Availability Groups [SQL Server], backup on secondary replicas
- active secondary replicas [SQL Server], backup on
- automated backup preference
- Availability Groups [SQL Server], active secondary replicas
ms.assetid: 74bc40bb-9f57-44e4-8988-1d69c0585eb6
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 91a781d957eb2f5a81d323fc3c65c93e34945c12
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87750206"
---
# <a name="configure-backup-on-availability-replicas-sql-server"></a><span data-ttu-id="bc78a-102">Configurar la copia de seguridad en réplicas de disponibilidad (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="bc78a-102">Configure Backup on Availability Replicas (SQL Server)</span></span>
  <span data-ttu-id="bc78a-103">En este tema se describe cómo configurar la copia de seguridad en réplicas secundarias para un grupo de disponibilidad AlwaysOn mediante [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../../includes/tsql-md.md)]o PowerShell en [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="bc78a-103">This topic describes how to configure backup on secondary replicas for an AlwaysOn availability group by using [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../../includes/tsql-md.md)], or PowerShell in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="bc78a-104">Para obtener una introducción a la copia de seguridad en las réplicas secundarias, vea secundarias [activas: copia de seguridad en las réplicas secundarias (grupos de disponibilidad AlwaysOn)](active-secondaries-backup-on-secondary-replicas-always-on-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="bc78a-104">For an introduction to backup on secondary replicas, see [Active Secondaries: Backup on Secondary Replicas (AlwaysOn Availability Groups)](active-secondaries-backup-on-secondary-replicas-always-on-availability-groups.md).</span></span>  
  
 
  

  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="bc78a-105">Antes de comenzar</span><span class="sxs-lookup"><span data-stu-id="bc78a-105">Before You Begin</span></span>  
  
###  <a name="prerequisites"></a><a name="Prerequisites"></a> <span data-ttu-id="bc78a-106">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="bc78a-106">Prerequisites</span></span>  
 <span data-ttu-id="bc78a-107">Debe estar conectado a la instancia del servidor que hospeda la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="bc78a-107">You must be connected to the server instance that hosts the primary replica.</span></span>  
  
###  <a name="security"></a><a name="Security"></a> <span data-ttu-id="bc78a-108">Seguridad</span><span class="sxs-lookup"><span data-stu-id="bc78a-108">Security</span></span>  
  
####  <a name="permissions"></a><a name="Permissions"></a> <span data-ttu-id="bc78a-109">Permisos</span><span class="sxs-lookup"><span data-stu-id="bc78a-109">Permissions</span></span>  
  
|<span data-ttu-id="bc78a-110">Tarea</span><span class="sxs-lookup"><span data-stu-id="bc78a-110">Task</span></span>|<span data-ttu-id="bc78a-111">Permisos</span><span class="sxs-lookup"><span data-stu-id="bc78a-111">Permissions</span></span>|  
|----------|-----------------|  
|<span data-ttu-id="bc78a-112">Para configurar la copia de seguridad en las réplicas secundarias al crear un grupo de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="bc78a-112">To configure backup on secondary replicas when creating an availability group</span></span>|<span data-ttu-id="bc78a-113">Se requiere la pertenencia al rol fijo de servidor **sysadmin** y el permiso de servidor CREATE AVAILABILITY GROUP, el permiso ALTER ANY AVAILABILITY GROUP o el permiso CONTROL SERVER.</span><span class="sxs-lookup"><span data-stu-id="bc78a-113">Requires membership in the **sysadmin** fixed server role and either CREATE AVAILABILITY GROUP server permission, ALTER ANY AVAILABILITY GROUP permission, or CONTROL SERVER permission.</span></span>|  
|<span data-ttu-id="bc78a-114">Para modificar un grupo de disponibilidad o una réplica de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="bc78a-114">To modify an availability group or availability replica</span></span>|<span data-ttu-id="bc78a-115">Se requiere el permiso ALTER AVAILABILITY GROUP en el grupo de disponibilidad, el permiso CONTROL AVAILABILITY GROUP, el permiso ALTER ANY AVAILABILITY GROUP o el permiso CONTROL SERVER.</span><span class="sxs-lookup"><span data-stu-id="bc78a-115">Requires ALTER AVAILABILITY GROUP permission on the availability group, CONTROL AVAILABILITY GROUP permission, ALTER ANY AVAILABILITY GROUP permission, or CONTROL SERVER permission.</span></span>|  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="bc78a-116">Uso de SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="bc78a-116">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="bc78a-117">**Para configurar la copia de seguridad en las réplicas secundarias**</span><span class="sxs-lookup"><span data-stu-id="bc78a-117">**To configure backup on secondary replicas**</span></span>  
  
1.  <span data-ttu-id="bc78a-118">En el Explorador de objetos, conéctese a la instancia del servidor que hospeda la réplica principal y haga clic en el nombre del servidor para expandir el árbol.</span><span class="sxs-lookup"><span data-stu-id="bc78a-118">In Object Explorer, connect to the server instance that hosts the primary replica, and click the server name to expand the server tree.</span></span>  
  
2.  <span data-ttu-id="bc78a-119">Expanda los nodos **Alta disponibilidad de AlwaysOn** y **Grupos de disponibilidad** .</span><span class="sxs-lookup"><span data-stu-id="bc78a-119">Expand the **AlwaysOn High Availability** node and the **Availability Groups** node.</span></span>  
  
3.  <span data-ttu-id="bc78a-120">Haga clic en el grupo de disponibilidad cuyas propiedades de copia de seguridad desea configurar y seleccione el comando **Propiedades** .</span><span class="sxs-lookup"><span data-stu-id="bc78a-120">Click the availability group whose backup preferences you want to configure, and select the **Properties** command.</span></span>  
  
4.  <span data-ttu-id="bc78a-121">En el cuadro de diálogo **Propiedades de grupo de disponibilidad**, seleccione la página **Preferencias de copia de seguridad**.</span><span class="sxs-lookup"><span data-stu-id="bc78a-121">In the **Availability Group Properties** dialog box, select **Backup Preferences** page.</span></span>  
  
5.  <span data-ttu-id="bc78a-122">En el panel **¿Dónde se realizarán las copias de seguridad?** , seleccione la preferencia de la copia de seguridad automatizada del grupo de disponibilidad, una de las siguientes:</span><span class="sxs-lookup"><span data-stu-id="bc78a-122">On the **Where should backups occur?** panel, select the automated backup preference for the availability group, one of:</span></span>  
  
     <span data-ttu-id="bc78a-123">**Preferir secundaria**</span><span class="sxs-lookup"><span data-stu-id="bc78a-123">**Prefer Secondary**</span></span>  
     <span data-ttu-id="bc78a-124">Especifica que las copias de seguridad se deben realizar en una réplica secundaria a menos que la réplica principal sea la única réplica en línea.</span><span class="sxs-lookup"><span data-stu-id="bc78a-124">Specifies that backups should occur on a secondary replica except when the primary replica is the only replica online.</span></span> <span data-ttu-id="bc78a-125">En ese caso, la copia de seguridad se debe realizar en la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="bc78a-125">In that case, the backup should occur on the primary replica.</span></span> <span data-ttu-id="bc78a-126">Ésta es la opción predeterminada.</span><span class="sxs-lookup"><span data-stu-id="bc78a-126">This is the default option.</span></span>  
  
     <span data-ttu-id="bc78a-127">**Solo secundaria**</span><span class="sxs-lookup"><span data-stu-id="bc78a-127">**Secondary only**</span></span>  
     <span data-ttu-id="bc78a-128">Especifica que las copias de seguridad no deben realizarse nunca en la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="bc78a-128">Specifies that backups should never be performed on the primary replica.</span></span> <span data-ttu-id="bc78a-129">Si la réplica principal es la única réplica en línea, no se debe realizar la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bc78a-129">If the primary replica is the only replica online, the backup should not occur.</span></span>  
  
     `Primary`  
     <span data-ttu-id="bc78a-130">Especifica que las copias de seguridad deben realizarse siempre en la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="bc78a-130">Specifies that the backups should always occur on the primary replica.</span></span> <span data-ttu-id="bc78a-131">Esta opción es útil si necesita usar características de copia de seguridad, como crear copias de seguridad diferenciales, que no se admiten cuando la copia de seguridad se ejecuta en una réplica secundaria.</span><span class="sxs-lookup"><span data-stu-id="bc78a-131">This option is useful if you need backup features, such as creating differential backups, that are not supported when backup is run on a secondary replica.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="bc78a-132">Si piensa usar el trasvase de registros para preparar cualquier base de datos secundaria de un grupo de disponibilidad, establezca la preferencia de copia de seguridad automatizada en `Primary` hasta que todas las bases de datos secundarias se hayan preparado y combinado con el grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="bc78a-132">If you plan to use log shipping to prepare any secondary databases for an availability group, set the automated backup preference to `Primary` until all the secondary databases have been prepared and joined to the availability group.</span></span>  
  
     <span data-ttu-id="bc78a-133">**Cualquier réplica**</span><span class="sxs-lookup"><span data-stu-id="bc78a-133">**Any Replica**</span></span>  
     <span data-ttu-id="bc78a-134">Especifica que, de acuerdo con sus preferencias, los trabajos de copia de seguridad omitan el rol de las réplicas de disponibilidad cuando la réplica realiza copias de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bc78a-134">Specifies that you prefer that backup jobs ignore the role of the availability replicas when choosing the replica to perform backups.</span></span> <span data-ttu-id="bc78a-135">Tenga en cuenta que los trabajos de copia de seguridad pueden evaluar otros factores, como la prioridad de copia de seguridad de cada réplica de disponibilidad junto con su estado operativo y de conexión.</span><span class="sxs-lookup"><span data-stu-id="bc78a-135">Note backup jobs might evaluate other factors such as backup priority of each availability replica in combination with its operational state and connected state.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="bc78a-136">No se aplica la configuración de preferencia de copia de seguridad automatizada.</span><span class="sxs-lookup"><span data-stu-id="bc78a-136">There is no enforcement of the automated backup preference setting.</span></span> <span data-ttu-id="bc78a-137">La interpretación de esta preferencia depende de la lógica, si existe, del script de los trabajos de copia de seguridad para las bases de datos de un grupo de disponibilidad dado.</span><span class="sxs-lookup"><span data-stu-id="bc78a-137">The interpretation of this preference depends on the logic, if any, that you script into backup jobs for the databases in a given availability group.</span></span> <span data-ttu-id="bc78a-138">La configuración de preferencia de copia de seguridad automatizada no tiene ningún efecto sobre las copias de seguridad ad hoc.</span><span class="sxs-lookup"><span data-stu-id="bc78a-138">The automated backup preference setting has no impact on ad-hoc backups.</span></span> <span data-ttu-id="bc78a-139">Para obtener más información, vea [seguimiento: después de configurar la copia de seguridad en las réplicas secundarias](#FollowUp) más adelante en este tema.</span><span class="sxs-lookup"><span data-stu-id="bc78a-139">For more information, see [Follow Up: After Configuring Backup on Secondary Replicas](#FollowUp) later in this topic.</span></span>  
  
6.  <span data-ttu-id="bc78a-140">Use la cuadrícula **Prioridades de copia de seguridad de réplica** para cambiar la prioridad de copia de seguridad de las réplicas de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="bc78a-140">Use the **Replica backup priorities** grid to change the backup priority of the availability replicas.</span></span> <span data-ttu-id="bc78a-141">Esta cuadrícula muestra la prioridad de copia de seguridad actual de cada instancia de servidor que hospeda una réplica para el grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="bc78a-141">This grid displays the current backup priority of each server instance that hosts a replica for the availability group.</span></span> <span data-ttu-id="bc78a-142">Las columnas de la cuadrícula son las siguientes:</span><span class="sxs-lookup"><span data-stu-id="bc78a-142">The grid columns are as follows:</span></span>  
  
     <span data-ttu-id="bc78a-143">**Instancia del servidor**</span><span class="sxs-lookup"><span data-stu-id="bc78a-143">**Server Instance**</span></span>  
     <span data-ttu-id="bc78a-144">El nombre de la instancia de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] que hospeda la réplica de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="bc78a-144">The name of the instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] that hosts the availability replica.</span></span>  
  
     <span data-ttu-id="bc78a-145">**Prioridad de copia de seguridad (Mínima=1, Máxima=100)**</span><span class="sxs-lookup"><span data-stu-id="bc78a-145">**Backup Priority (Lowest=1, Highest=100)**</span></span>  
     <span data-ttu-id="bc78a-146">Especifica la prioridad para realizar copias de seguridad en esta réplica en relación con las otras réplicas del mismo grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="bc78a-146">Specifies your priority for performing backups on this replica relative to the other replicas in the same availability group.</span></span> <span data-ttu-id="bc78a-147">El valor es un número entero en el intervalo de 0..100.</span><span class="sxs-lookup"><span data-stu-id="bc78a-147">The value is an integer in the range of 0..100.</span></span> <span data-ttu-id="bc78a-148">1 indica la prioridad mínima y 100 indica la prioridad máxima.</span><span class="sxs-lookup"><span data-stu-id="bc78a-148">1 indicates the lowest priority, and 100 indicates the highest priority.</span></span> <span data-ttu-id="bc78a-149">Si **Prioridad de copia de seguridad** = 1, la réplica de disponibilidad se elegiría para realizar copias de seguridad solamente si no hay disponibles actualmente réplicas de disponibilidad con mayor prioridad.</span><span class="sxs-lookup"><span data-stu-id="bc78a-149">If **Backup Priority** = 1, the availability replica would be chosen for performing backups only if no higher priority availability replicas are currently available.</span></span>  
  
     <span data-ttu-id="bc78a-150">**Excluir réplica**</span><span class="sxs-lookup"><span data-stu-id="bc78a-150">**Exclude Replica**</span></span>  
     <span data-ttu-id="bc78a-151">Seleccione esta opción si no desea que nunca se elija esta réplica de disponibilidad para realizar copias de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bc78a-151">Select if you never want this availability replica to be chosen for performing backups.</span></span> <span data-ttu-id="bc78a-152">Esto es útil, por ejemplo, para una réplica de disponibilidad remota en la que no desee nunca realizar la conmutación por error para las copias de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bc78a-152">This is useful, for example, for a remote availability replica to which you never want backups to fail over.</span></span>  
  
7.  <span data-ttu-id="bc78a-153">Para confirmar sus cambios, haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="bc78a-153">To commit your changes, click **OK**.</span></span>  
  
 <span data-ttu-id="bc78a-154">**Maneras alternativas de obtener acceso a la página Preferencias de copia de seguridad**</span><span class="sxs-lookup"><span data-stu-id="bc78a-154">**Alternative ways to access the Backup Preferences page**</span></span>  
  
-   [<span data-ttu-id="bc78a-155">Usar el cuadro de diálogo Nuevo grupo de disponibilidad &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="bc78a-155">Use the New Availability Group Dialog Box &#40;SQL Server Management Studio&#41;</span></span>](use-the-new-availability-group-dialog-box-sql-server-management-studio.md)  
  
-   [<span data-ttu-id="bc78a-156">Usar el Asistente para agregar una réplica al grupo de disponibilidad &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="bc78a-156">Use the Add Replica to Availability Group Wizard &#40;SQL Server Management Studio&#41;</span></span>](use-the-add-replica-to-availability-group-wizard-sql-server-management-studio.md)  
  
-   [<span data-ttu-id="bc78a-157">Usar el cuadro de diálogo Nuevo grupo de disponibilidad &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="bc78a-157">Use the New Availability Group Dialog Box &#40;SQL Server Management Studio&#41;</span></span>](use-the-new-availability-group-dialog-box-sql-server-management-studio.md)  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="bc78a-158">Usar Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="bc78a-158">Using Transact-SQL</span></span>  
 <span data-ttu-id="bc78a-159">**Para configurar la copia de seguridad en las réplicas secundarias**</span><span class="sxs-lookup"><span data-stu-id="bc78a-159">**To configure backup on secondary replicas**</span></span>  
  
1.  <span data-ttu-id="bc78a-160">Conéctese a la instancia del servidor que hospeda la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="bc78a-160">Connect to the server instance that hosts the primary replica.</span></span>  
  
2.  <span data-ttu-id="bc78a-161">Para un nuevo grupo de disponibilidad, use la instrucción [CREATE AVAILABILITY GROUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-availability-group-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="bc78a-161">For a new availability group, use the [CREATE AVAILABILITY GROUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-availability-group-transact-sql) statement.</span></span> <span data-ttu-id="bc78a-162">Si va a modificar un grupo de disponibilidad existente, use la instrucción [ALTER AVAILABILITY GROUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-availability-group-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="bc78a-162">If you are modifying an existing availability group, use the [ALTER AVAILABILITY GROUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-availability-group-transact-sql) statement.</span></span>  
  
##  <a name="using-powershell"></a><a name="PowerShellProcedure"></a> <span data-ttu-id="bc78a-163">Con PowerShell</span><span class="sxs-lookup"><span data-stu-id="bc78a-163">Using PowerShell</span></span>  

### <a name="to-configure-backup-on-secondary-replicas"></a><span data-ttu-id="bc78a-164">Para configurar la copia de seguridad en las réplicas secundarias</span><span class="sxs-lookup"><span data-stu-id="bc78a-164">To configure backup on secondary replicas</span></span>
  
1.  <span data-ttu-id="bc78a-165">Establezca el valor predeterminado (`cd`) en la instancia del servidor que hospeda la réplica de disponibilidad principal.</span><span class="sxs-lookup"><span data-stu-id="bc78a-165">Set default (`cd`) to the server instance that hosts the primary replica.</span></span>  
  
2.  <span data-ttu-id="bc78a-166">Opcionalmente, configure la prioridad de copia de seguridad de cada réplica de disponibilidad que está agregando o modificando.</span><span class="sxs-lookup"><span data-stu-id="bc78a-166">Optionally, configure the backup priority of each availability replica that you are adding or modifying.</span></span> <span data-ttu-id="bc78a-167">La instancia del servidor que hospeda la réplica principal usa esta prioridad para decidir qué réplica debe atender una solicitud de copia de seguridad automatizada en una base de datos del grupo de disponibilidad (se elige la réplica con mayor prioridad).</span><span class="sxs-lookup"><span data-stu-id="bc78a-167">This priority is used by the server instance that hosts the primary replica to decide which replica should service an automated backup request on a database in the availability group (the replica with highest priority is chosen).</span></span> <span data-ttu-id="bc78a-168">Esta prioridad puede ser cualquier número comprendido entre 0 y 100, ambos incluidos.</span><span class="sxs-lookup"><span data-stu-id="bc78a-168">This priority can be any number between 0 and 100, inclusive.</span></span> <span data-ttu-id="bc78a-169">Si la prioridad es 0, indica que la réplica no debe considerarse candidata para atender solicitudes de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bc78a-169">A priority of 0 indicates that the replica should not be considered as a candidate for servicing backup requests.</span></span>  <span data-ttu-id="bc78a-170">El valor predeterminado es 50.</span><span class="sxs-lookup"><span data-stu-id="bc78a-170">The default setting is 50.</span></span>  
  
     <span data-ttu-id="bc78a-171">Para agregar una réplica de disponibilidad a un grupo de disponibilidad, use el cmdlet `New-SqlAvailabilityReplica`.</span><span class="sxs-lookup"><span data-stu-id="bc78a-171">When adding an availability replica to an availability group, use the `New-SqlAvailabilityReplica` cmdlet.</span></span> <span data-ttu-id="bc78a-172">Para modificar una réplica de disponibilidad existente, use el cmdlet `Set-SqlAvailabilityReplica`.</span><span class="sxs-lookup"><span data-stu-id="bc78a-172">When modifying an existing availability replica, use the `Set-SqlAvailabilityReplica` cmdlet.</span></span> <span data-ttu-id="bc78a-173">En cualquier caso, especifique el `BackupPriority` parámetro *n* , donde *n* es un valor comprendido entre 0 y 100.</span><span class="sxs-lookup"><span data-stu-id="bc78a-173">In either case, specify the `BackupPriority`*n* parameter, where *n* is a value from 0 to 100.</span></span>  
  
     <span data-ttu-id="bc78a-174">Por ejemplo, el comando siguiente establece la prioridad de copia de seguridad de la réplica de disponibilidad `MyReplica` en `60`.</span><span class="sxs-lookup"><span data-stu-id="bc78a-174">For example, the following command sets the backup priority of the availability replica `MyReplica` to `60`.</span></span>  
  
    ```powershell
    Set-SqlAvailabilityReplica -BackupPriority 60 -Path SQLSERVER:\Sql\Computer\Instance\AvailabilityGroups\MyAg\AvailabilityReplicas\MyReplica  
    ```  
  
3.  <span data-ttu-id="bc78a-175">Opcionalmente, configure la preferencia de la copia de seguridad automatizada del grupo de disponibilidad que está creando o modificando.</span><span class="sxs-lookup"><span data-stu-id="bc78a-175">Optionally, configure the automated backup preference for the availability group that you are creating  or modifying.</span></span> <span data-ttu-id="bc78a-176">Esta preferencia indica cómo un trabajo de copia de seguridad debe evaluar la réplica principal cuando elige dónde realizar las copias de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bc78a-176">This preference indicates how a backup job should evaluate the primary replica when choosing where to perform backups.</span></span> <span data-ttu-id="bc78a-177">El valor predeterminado es preferir las réplicas secundarias.</span><span class="sxs-lookup"><span data-stu-id="bc78a-177">The default setting is to prefer secondary replicas.</span></span>  
  
     <span data-ttu-id="bc78a-178">Al crear un grupo de disponibilidad, use el cmdlet `New-SqlAvailabilityGroup`.</span><span class="sxs-lookup"><span data-stu-id="bc78a-178">When creating an availability group, use the `New-SqlAvailabilityGroup` cmdlet.</span></span> <span data-ttu-id="bc78a-179">Al modificar un grupo de disponibilidad existente, use el cmdlet `Set-SqlAvailabilityGroup`.</span><span class="sxs-lookup"><span data-stu-id="bc78a-179">When modifying an existing availability group, use the `Set-SqlAvailabilityGroup` cmdlet.</span></span> <span data-ttu-id="bc78a-180">En cualquier caso, especifique el parámetro `AutomatedBackupPreference`.</span><span class="sxs-lookup"><span data-stu-id="bc78a-180">In either case, specify the `AutomatedBackupPreference` parameter.</span></span>  
  
     <span data-ttu-id="bc78a-181">donde,</span><span class="sxs-lookup"><span data-stu-id="bc78a-181">where,</span></span>  
  
     `Primary`  
     <span data-ttu-id="bc78a-182">Especifica que las copias de seguridad deben realizarse siempre en la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="bc78a-182">Specifies that the backups should always occur on the primary replica.</span></span> <span data-ttu-id="bc78a-183">Esta opción es útil si necesita usar características de copia de seguridad, como crear copias de seguridad diferenciales, que no se admiten cuando la copia de seguridad se ejecuta en una réplica secundaria.</span><span class="sxs-lookup"><span data-stu-id="bc78a-183">This option is useful if you need backup features, such as creating differential backups, that are not supported when backup is run on a secondary replica.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="bc78a-184">Si piensa usar el trasvase de registros para preparar cualquier base de datos secundaria de un grupo de disponibilidad, establezca la preferencia de copia de seguridad automatizada en `Primary` hasta que todas las bases de datos secundarias se hayan preparado y combinado con el grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="bc78a-184">If you plan to use log shipping to prepare any secondary databases for an availability group, set the automated backup preference to `Primary` until all the secondary databases have been prepared and joined to the availability group.</span></span>  
  
     `SecondaryOnly`  
     <span data-ttu-id="bc78a-185">Especifica que las copias de seguridad no deben realizarse nunca en la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="bc78a-185">Specifies that backups should never be performed on the primary replica.</span></span> <span data-ttu-id="bc78a-186">Si la réplica principal es la única réplica en línea, no se debe realizar la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bc78a-186">If the primary replica is the only replica online, the backup should not occur.</span></span>  
  
     `Secondary`  
     <span data-ttu-id="bc78a-187">Especifica que las copias de seguridad se deben realizar en una réplica secundaria a menos que la réplica principal sea la única réplica en línea.</span><span class="sxs-lookup"><span data-stu-id="bc78a-187">Specifies that backups should occur on a secondary replica except when the primary replica is the only replica online.</span></span> <span data-ttu-id="bc78a-188">En ese caso, la copia de seguridad se debe realizar en la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="bc78a-188">In that case, the backup should occur on the primary replica.</span></span> <span data-ttu-id="bc78a-189">Este es el comportamiento predeterminado.</span><span class="sxs-lookup"><span data-stu-id="bc78a-189">This is the default behavior.</span></span>  
  
     `None`  
     <span data-ttu-id="bc78a-190">Especifica que, de acuerdo con sus preferencias, los trabajos de copia de seguridad omitan el rol de las réplicas de disponibilidad cuando la réplica realiza copias de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bc78a-190">Specifies that you prefer that backup jobs ignore the role of the availability replicas when choosing the replica to perform backups.</span></span> <span data-ttu-id="bc78a-191">Tenga en cuenta que los trabajos de copia de seguridad pueden considerar otros factores, como la prioridad de copia de seguridad de cada réplica de disponibilidad junto con su estado operativo y de conexión.</span><span class="sxs-lookup"><span data-stu-id="bc78a-191">Note backup jobs might evaluate other factors such as backup priority of each availability replica in combination with its operational state and  connected state.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="bc78a-192">No se aplica `AutomatedBackupPreference`.</span><span class="sxs-lookup"><span data-stu-id="bc78a-192">There is no enforcement of `AutomatedBackupPreference`.</span></span> <span data-ttu-id="bc78a-193">La interpretación de esta preferencia depende de la lógica, si existe, del script de los trabajos de copia de seguridad para las bases de datos de un grupo de disponibilidad dado.</span><span class="sxs-lookup"><span data-stu-id="bc78a-193">The interpretation of this preference depends on the logic, if any, that you script into backup jobs for the databases in a given availability group.</span></span> <span data-ttu-id="bc78a-194">La configuración de preferencia de copia de seguridad automatizada no tiene ningún efecto sobre las copias de seguridad ad hoc.</span><span class="sxs-lookup"><span data-stu-id="bc78a-194">The automated backup preference setting has no impact on ad-hoc backups.</span></span> <span data-ttu-id="bc78a-195">Para obtener más información, vea [seguimiento: después de configurar la copia de seguridad en las réplicas secundarias](#FollowUp) más adelante en este tema.</span><span class="sxs-lookup"><span data-stu-id="bc78a-195">For more information, see [Follow Up: After Configuring Backup on Secondary Replicas](#FollowUp) later in this topic.</span></span>  
  
     <span data-ttu-id="bc78a-196">Por ejemplo, el comando siguiente establece la propiedad `AutomatedBackupPreference` del grupo de disponibilidad `MyAg` en `SecondaryOnly`.</span><span class="sxs-lookup"><span data-stu-id="bc78a-196">For example, the following command sets the `AutomatedBackupPreference` property on the availability group `MyAg` to `SecondaryOnly`.</span></span> <span data-ttu-id="bc78a-197">Las copias de seguridad automatizadas de bases de datos en este grupo de disponibilidad nunca se producirán en la réplica principal, sino que se redirigirán a la réplica secundaria con la configuración de la prioridad de copia de seguridad más alta.</span><span class="sxs-lookup"><span data-stu-id="bc78a-197">Automated backups of databases in this availability group will never occur on the primary replica, but will be redirected to the secondary replica with the highest backup priority setting.</span></span>  
  
    ```powershell
    Set-SqlAvailabilityGroup -Path SQLSERVER:\Sql\PrimaryServer\InstanceName\AvailabilityGroups\MyAg `  
     -AutomatedBackupPreference SecondaryOnly  
    ```  
  
> [!NOTE]  
>  <span data-ttu-id="bc78a-198">Para ver la sintaxis de un cmdlet, use el cmdlet `Get-Help` en el entorno de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] PowerShell.</span><span class="sxs-lookup"><span data-stu-id="bc78a-198">To view the syntax of a cmdlet, use the `Get-Help` cmdlet in the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] PowerShell environment.</span></span> <span data-ttu-id="bc78a-199">Para más información, consulte [Get Help SQL Server PowerShell](../../../powershell/sql-server-powershell.md).</span><span class="sxs-lookup"><span data-stu-id="bc78a-199">For more information, see [Get Help SQL Server PowerShell](../../../powershell/sql-server-powershell.md).</span></span>  
  
<span data-ttu-id="bc78a-200">Para configurar y usar el proveedor de SQL Server PowerShell, vea [SQL Server PowerShell Provider](../../../powershell/sql-server-powershell-provider.md) y [Get Help SQL Server PowerShell](../../../powershell/sql-server-powershell.md).</span><span class="sxs-lookup"><span data-stu-id="bc78a-200">To set up and use the SQL Server PowerShell provider, see [SQL Server PowerShell Provider](../../../powershell/sql-server-powershell-provider.md) and [Get Help SQL Server PowerShell](../../../powershell/sql-server-powershell.md).</span></span>
  
##  <a name="follow-up-after-configuring-backup-on-secondary-replicas"></a><a name="FollowUp"></a><span data-ttu-id="bc78a-201">Seguimiento: después de configurar la copia de seguridad en las réplicas secundarias</span><span class="sxs-lookup"><span data-stu-id="bc78a-201">Follow Up: After Configuring Backup on Secondary Replicas</span></span>  
 <span data-ttu-id="bc78a-202">Para tener en cuenta la preferencia de la copia de seguridad automatizada para un grupo de disponibilidad dado, en cada instancia de servidor que hospede una réplica de disponibilidad cuya prioridad de copia de seguridad sea mayor que cero (>0), se necesitan los scripts de trabajos de copia de seguridad para las bases de datos del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="bc78a-202">To take the automated backup preference into account for a given availability group, on each server instance that hosts an availability replica whose backup priority is greater than zero (>0), you need to script backup jobs for the databases in the availability group.</span></span> <span data-ttu-id="bc78a-203">Para determinar si la réplica actual es la réplica de copia de seguridad preferida, use la función [sys.fn_hadr_backup_is_preferred_replica](/sql/relational-databases/system-functions/sys-fn-hadr-backup-is-preferred-replica-transact-sql) en el script de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bc78a-203">To determine whether the current replica is the preferred backup replica, use the [sys.fn_hadr_backup_is_preferred_replica](/sql/relational-databases/system-functions/sys-fn-hadr-backup-is-preferred-replica-transact-sql) function in your backup script.</span></span> <span data-ttu-id="bc78a-204">Si la réplica de disponibilidad que está hospedada en la instancia de servidor actual es la réplica preferida para las copias de seguridad, esta función devuelve 1.</span><span class="sxs-lookup"><span data-stu-id="bc78a-204">If the availability replica that is hosted by the current server instance is the preferred replica for backups, this function returns 1.</span></span> <span data-ttu-id="bc78a-205">De lo contrario, la función devuelve 0.</span><span class="sxs-lookup"><span data-stu-id="bc78a-205">If not, the function returns 0.</span></span> <span data-ttu-id="bc78a-206">Mediante la ejecución de un script simple en cada réplica de disponibilidad que consulta esta función, puede determinar qué réplica debe ejecutar un trabajo de copia de seguridad determinado.</span><span class="sxs-lookup"><span data-stu-id="bc78a-206">By running a simple script on each availability replica that queries this function, you can determine which replica should run a given backup job.</span></span> <span data-ttu-id="bc78a-207">Por ejemplo, un fragmento de código típico de un script de trabajo de copia de seguridad sería:</span><span class="sxs-lookup"><span data-stu-id="bc78a-207">For example, a typical snippet of a backup-job script would look like:</span></span>  
  
```  
IF (NOT sys.fn_hadr_backup_is_preferred_replica(@DBNAME))  
BEGIN  
      Select 'This is not the preferred replica, exiting with success';  
      RETURN 0 - This is a normal, expected condition, so the script returns success  
END  
BACKUP DATABASE @DBNAME TO DISK=<disk>  
   WITH COPY_ONLY;  
```  
  
 <span data-ttu-id="bc78a-208">La generación de un script para un trabajo de copia de seguridad con esta lógica permite programar que el trabajo se ejecute en cada réplica de disponibilidad en la misma programación.</span><span class="sxs-lookup"><span data-stu-id="bc78a-208">Scripting a backup job with this logic enables you to schedule the job to run on every availability replica on the same schedule.</span></span> <span data-ttu-id="bc78a-209">Cada uno de estos trabajos examina los mismos datos para determinar qué trabajo debe ejecutarse, por lo que solamente el trabajo programado pasa a la etapa de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bc78a-209">Each of these jobs looks at the same data to determine which job should run, so only one of the scheduled job actually proceeds to the backup stage.</span></span>  <span data-ttu-id="bc78a-210">En el caso de una conmutación por error, no es necesario modificar ninguno de los scripts o de los trabajos.</span><span class="sxs-lookup"><span data-stu-id="bc78a-210">In the event of a failover, none of the scripts or jobs needs to be modified.</span></span> <span data-ttu-id="bc78a-211">Además, si vuelve a configurar un grupo de disponibilidad para agregar una réplica de disponibilidad, la administración del trabajo de copia de seguridad solo requerirá copiar o programar el trabajo de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bc78a-211">Also, if you reconfigure an availability group to add an availability replica, managing the backup job requires simply copying or scheduling the backup job.</span></span> <span data-ttu-id="bc78a-212">Si quita una réplica de disponibilidad, solo tiene que eliminar el trabajo de copia de seguridad de la instancia de servidor que hospedaba esa réplica.</span><span class="sxs-lookup"><span data-stu-id="bc78a-212">If you remove an availability replica, simply delete the backup job from the server instance that hosted that replica.</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="bc78a-213">Si usa el[Asistente para planes de mantenimiento](../../../relational-databases/maintenance-plans/use-the-maintenance-plan-wizard.md)con el fin de crear un trabajo de copia de seguridad determinado, el trabajo incluirá automáticamente la lógica de scripting que llama a la función **sys.fn_hadr_backup_is_preferred_replica** y la comprueba.</span><span class="sxs-lookup"><span data-stu-id="bc78a-213">If you use the[Maintenance Plan Wizard](../../../relational-databases/maintenance-plans/use-the-maintenance-plan-wizard.md)to create a given backup job, the job will automatically include the scripting logic that calls and checks the **sys.fn_hadr_backup_is_preferred_replica** function.</span></span> <span data-ttu-id="bc78a-214">Pero el trabajo de copia de seguridad no devolverá el mensaje "Esta no es la réplica preferida…". Asegúrese de crear trabajos para cada base de datos de disponibilidad de cada instancia del servidor que hospeda una réplica de disponibilidad para el grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="bc78a-214">However, the backup job will not return the "This is not the preferred replica..." message.Be sure to create the job(s) for each availability database on every server instance that hosts an availability replica for the availability group.</span></span>  
  
##  <a name="to-obtain-information-about-backup-preference-settings"></a><a name="ForInfoAboutBuPref"></a><span data-ttu-id="bc78a-215">Para obtener información acerca de la configuración de preferencias de copia de seguridad</span><span class="sxs-lookup"><span data-stu-id="bc78a-215">To Obtain Information About Backup Preference Settings</span></span>  
 <span data-ttu-id="bc78a-216">Los siguientes apartados son útiles para obtener la información que es importante para la copia de seguridad en réplicas secundarias.</span><span class="sxs-lookup"><span data-stu-id="bc78a-216">The following are useful for obtaining information that is relevant for backup on secondary.</span></span>  
  
|<span data-ttu-id="bc78a-217">Ver</span><span class="sxs-lookup"><span data-stu-id="bc78a-217">View</span></span>|<span data-ttu-id="bc78a-218">Información</span><span class="sxs-lookup"><span data-stu-id="bc78a-218">Information</span></span>|<span data-ttu-id="bc78a-219">Columnas relevantes</span><span class="sxs-lookup"><span data-stu-id="bc78a-219">Relevant Columns</span></span>|  
|----------|-----------------|----------------------|  
|[<span data-ttu-id="bc78a-220">sys.fn_hadr_backup_is_preferred_replica</span><span class="sxs-lookup"><span data-stu-id="bc78a-220">sys.fn_hadr_backup_is_preferred_replica</span></span>](/sql/relational-databases/system-functions/sys-fn-hadr-backup-is-preferred-replica-transact-sql)|<span data-ttu-id="bc78a-221">¿Es la réplica actual la réplica de copia de seguridad preferida?</span><span class="sxs-lookup"><span data-stu-id="bc78a-221">Is the current replica the preferred backup replica?</span></span>|<span data-ttu-id="bc78a-222">No es aplicable.</span><span class="sxs-lookup"><span data-stu-id="bc78a-222">Not applicable.</span></span>|  
|[<span data-ttu-id="bc78a-223">sys.availability_groups</span><span class="sxs-lookup"><span data-stu-id="bc78a-223">sys.availability_groups</span></span>](/sql/relational-databases/system-catalog-views/sys-availability-groups-transact-sql)|<span data-ttu-id="bc78a-224">preferencia de copia de seguridad automatizada</span><span class="sxs-lookup"><span data-stu-id="bc78a-224">Automated backup preference</span></span>|<span data-ttu-id="bc78a-225">**automated_backup_preference**</span><span class="sxs-lookup"><span data-stu-id="bc78a-225">**automated_backup_preference**</span></span><br /><br /> <span data-ttu-id="bc78a-226">**automated_backup_preference_desc**</span><span class="sxs-lookup"><span data-stu-id="bc78a-226">**automated_backup_preference_desc**</span></span>|  
|[<span data-ttu-id="bc78a-227">sys.availability_replicas</span><span class="sxs-lookup"><span data-stu-id="bc78a-227">sys.availability_replicas</span></span>](/sql/relational-databases/system-catalog-views/sys-availability-replicas-transact-sql)|<span data-ttu-id="bc78a-228">Prioridad de copia de seguridad de una réplica de disponibilidad determinada</span><span class="sxs-lookup"><span data-stu-id="bc78a-228">Backup priority of a given availability replica</span></span>|<span data-ttu-id="bc78a-229">**backup_priority**</span><span class="sxs-lookup"><span data-stu-id="bc78a-229">**backup_priority**</span></span>|  
|[<span data-ttu-id="bc78a-230">sys.dm_hadr_availability_replica_states</span><span class="sxs-lookup"><span data-stu-id="bc78a-230">sys.dm_hadr_availability_replica_states</span></span>](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-availability-replica-states-transact-sql)|<span data-ttu-id="bc78a-231">¿Está la réplica local en la instancia del servidor?</span><span class="sxs-lookup"><span data-stu-id="bc78a-231">Is replica local to the server instance?</span></span><br /><br /> <span data-ttu-id="bc78a-232">Rol actual</span><span class="sxs-lookup"><span data-stu-id="bc78a-232">Current role</span></span><br /><br /> <span data-ttu-id="bc78a-233">Estado operativo</span><span class="sxs-lookup"><span data-stu-id="bc78a-233">Operational state</span></span><br /><br /> <span data-ttu-id="bc78a-234">Estado de conexión</span><span class="sxs-lookup"><span data-stu-id="bc78a-234">Connected state</span></span><br /><br /> <span data-ttu-id="bc78a-235">Estado de sincronización de una réplica de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="bc78a-235">Synchronization health of an availability replica</span></span>|<span data-ttu-id="bc78a-236">**is_local**</span><span class="sxs-lookup"><span data-stu-id="bc78a-236">**is_local**</span></span><br /><br /> <span data-ttu-id="bc78a-237">**role**, **role_desc**</span><span class="sxs-lookup"><span data-stu-id="bc78a-237">**role**, **role_desc**</span></span><br /><br /> <span data-ttu-id="bc78a-238">**operational_state**, **operational_state_desc**</span><span class="sxs-lookup"><span data-stu-id="bc78a-238">**operational_state**, **operational_state_desc**</span></span><br /><br /> <span data-ttu-id="bc78a-239">**connected_state**, **connected_state_desc**</span><span class="sxs-lookup"><span data-stu-id="bc78a-239">**connected_state**, **connected_state_desc**</span></span><br /><br /> <span data-ttu-id="bc78a-240">**synchronization_health**, **synchronization_health_desc**</span><span class="sxs-lookup"><span data-stu-id="bc78a-240">**synchronization_health**, **synchronization_health_desc**</span></span>|  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="bc78a-241">Contenido relacionado</span><span class="sxs-lookup"><span data-stu-id="bc78a-241">Related Content</span></span>  
  
-   [<span data-ttu-id="bc78a-242">Guía de soluciones AlwaysOn de Microsoft SQL Server para lograr alta disponibilidad y recuperación ante desastres</span><span class="sxs-lookup"><span data-stu-id="bc78a-242">Microsoft SQL Server AlwaysOn Solutions Guide for High Availability and Disaster Recovery</span></span>](https://go.microsoft.com/fwlink/?LinkId=227600)  
  
-   [<span data-ttu-id="bc78a-243">Blog del equipo de AlwaysOn de SQL Server: el blog del equipo de AlwaysOn oficial de SQL Server</span><span class="sxs-lookup"><span data-stu-id="bc78a-243">SQL Server AlwaysOn Team Blog: The official SQL Server AlwaysOn Team Blog</span></span>](https://blogs.msdn.com/b/sqlalwayson/)  
  
## <a name="see-also"></a><span data-ttu-id="bc78a-244">Consulte también</span><span class="sxs-lookup"><span data-stu-id="bc78a-244">See Also</span></span>  
 <span data-ttu-id="bc78a-245">[Información general de Grupos de disponibilidad AlwaysOn &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="bc78a-245">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) </span></span>  
 [<span data-ttu-id="bc78a-246">Secundarias activas: copia de seguridad en las réplicas secundarias (grupos de disponibilidad AlwaysOn)</span><span class="sxs-lookup"><span data-stu-id="bc78a-246">Active Secondaries: Backup on Secondary Replicas (AlwaysOn Availability Groups)</span></span>](active-secondaries-backup-on-secondary-replicas-always-on-availability-groups.md) 
