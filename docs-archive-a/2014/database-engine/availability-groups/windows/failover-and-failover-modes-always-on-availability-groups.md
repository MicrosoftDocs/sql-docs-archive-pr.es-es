---
title: Conmutación por error y modos de conmutación por error (Grupos de disponibilidad AlwaysOn) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- Availability Groups [SQL Server], availability replicas
- Availability Groups [SQL Server], failover
- Availability Groups [SQL Server], failover modes
- failover [SQL Server], AlwaysOn Availability Groups
ms.assetid: 378d2d63-50b9-420b-bafb-d375543fda17
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: eb904cd0f0649c43553b5d6c8b031c5f284901f4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87672280"
---
# <a name="failover-and-failover-modes-alwayson-availability-groups"></a><span data-ttu-id="3f9ec-102">Conmutación por error y modos de conmutación por error (grupos de disponibilidad AlwaysOn)</span><span class="sxs-lookup"><span data-stu-id="3f9ec-102">Failover and Failover Modes (AlwaysOn Availability Groups)</span></span>
  <span data-ttu-id="3f9ec-103">Dentro del contexto de un grupo de disponibilidad, el rol principal y el rol secundario de las réplicas de disponibilidad suelen ser intercambiables en un proceso denominado *conmutación por error*.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-103">Within the context of an availability group, the primary role and secondary role of availability replicas are typically interchangeable in a process known as *failover*.</span></span> <span data-ttu-id="3f9ec-104">Hay tres formas de conmutación por error: conmutación por error automática (sin pérdida de datos), conmutación por error manual planeada (sin pérdida de datos) y conmutación por error manual forzada (con posible pérdida de datos), normalmente denominada *conmutación por error forzada*.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-104">Three forms of failover exist: automatic failover (without data loss), planned manual failover (without data loss), and forced manual failover (with possible data loss), typically called *forced failover*.</span></span> <span data-ttu-id="3f9ec-105">Las conmutaciones por error automáticas o manuales planeadas mantienen todos los datos.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-105">Automatic and planned manual failover preserve all your data.</span></span> <span data-ttu-id="3f9ec-106">Un grupo de disponibilidad realiza la conmutación por error en el nivel de la réplica de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-106">An availability group fails over at the availability-replica level.</span></span> <span data-ttu-id="3f9ec-107">Es decir, un grupo de disponibilidad conmuta por error a una de sus réplicas secundarias (el *destino de conmutación por error*actual).</span><span class="sxs-lookup"><span data-stu-id="3f9ec-107">That is, an availability group fails over to one of its secondary replicas (the current *failover target*).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="3f9ec-108">Los problemas que se producen en el nivel de la base de datos, como, por ejemplo, en el caso de que una base de datos pase a ser sospechosa debido a la pérdida de un archivo de datos, la eliminación de una base de datos o los daños de un registro de transacciones, no producen la conmutación por error del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-108">Issues at the database level, such as a database becoming suspect due to the loss of a data file, deletion of a database, or corruption of a transaction log, do not cause an availability group to failover.</span></span>  
  
 <span data-ttu-id="3f9ec-109">Durante la conmutación por error, el destino de la conmutación por error asume el rol principal, recupera las bases de datos y las pone en línea como las nuevas bases de datos principales.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-109">During the failover, the failover target takes over the primary role, recovers its databases, and brings them online as the new primary databases.</span></span> <span data-ttu-id="3f9ec-110">La réplica principal anterior, cuando está disponible, cambia al rol secundario y sus bases de datos se convierten en bases de datos secundarias.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-110">The former primary replica, when available, switches to the secondary role, and its databases become secondary databases.</span></span> <span data-ttu-id="3f9ec-111">Estos roles podrían conmutarse repetidamente (o usar un destino de conmutación por error distinto) como respuesta a varios errores o con fines administrativos.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-111">Potentially, these roles can switch back and forth (or to a different failover target) in response to multiple failures or for administrative purposes.</span></span>  
  
 <span data-ttu-id="3f9ec-112">Las formas de conmutación por error que admite una determinada réplica de disponibilidad se especifican mediante la propiedad *modo de conmutación por error* .</span><span class="sxs-lookup"><span data-stu-id="3f9ec-112">The form(s) of failover that a given availability replica supports is specified by the *failover mode* property.</span></span> <span data-ttu-id="3f9ec-113">En una determinada réplica de disponibilidad, los modos de conmutación por error posibles dependen del [modo de disponibilidad](availability-modes-always-on-availability-groups.md) de la réplica, como sigue:</span><span class="sxs-lookup"><span data-stu-id="3f9ec-113">For a given availability replica, the possible failover modes depends on the [availability mode](availability-modes-always-on-availability-groups.md) of the replica, as follows:</span></span>  
  
-   <span data-ttu-id="3f9ec-114">Las **réplicas de confirmación sincrónica** admiten dos valores: automático o manual.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-114">**Synchronous-commit replicas** support two settings-automatic or manual.</span></span> <span data-ttu-id="3f9ec-115">El valor “automático” admite tanto la conmutación por error automática como la manual.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-115">The "automatic" setting supports both automatic failover and manual failover.</span></span> <span data-ttu-id="3f9ec-116">Para evitar la pérdida de datos, la conmutación automática por error y la conmutación por error planeada requieren que el destino de conmutación por error sea una réplica secundaria de confirmación sincrónica con un estado de sincronización apropiado (esto indica que todas las bases de datos secundarias del destino de conmutación por error están sincronizadas con la base de datos principal correspondiente).</span><span class="sxs-lookup"><span data-stu-id="3f9ec-116">To prevent data loss, automatic failover and planned failover require that the failover target be a synchronous-commit secondary replica with a healthy synchronization state (this indicates that every secondary database on the failover target is synchronized with its corresponding primary database).</span></span> <span data-ttu-id="3f9ec-117">Siempre que una réplica secundaria no cumple las dos condiciones, solo admite la conmutación por error manual forzada.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-117">Whenever a secondary replica does not meet both of these conditions, it supports only forced failover.</span></span> <span data-ttu-id="3f9ec-118">Tenga en cuenta que la conmutación por error también admite una réplica cuyo rol esté en el estado RESOLVING.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-118">Note that forced failover is also supported a replicas whose role is in the RESOLVING state.</span></span>  
  
-   <span data-ttu-id="3f9ec-119">Las**réplicas de confirmación asincrónica** solo admiten el modo de conmutación por error manual.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-119">**Asynchronous-commit replicas** support only the manual failover mode.</span></span> <span data-ttu-id="3f9ec-120">Además, debido a que nunca se sincronizan, solo admiten la conmutación por error forzada.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-120">Moreover, because they are never synchronized, they support only forced failover.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="3f9ec-121">Después de una conmutación por error, las aplicaciones cliente que necesitan tener acceso a las bases de datos principales deben establecer conexión con la nueva réplica principal.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-121">After a failover, client applications that need to access the primary databases must connect to the new primary replica.</span></span> <span data-ttu-id="3f9ec-122">Además, si la nueva réplica secundaria se configura para permitir el acceso de solo lectura, las aplicaciones cliente de solo lectura pueden conectarse a ella.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-122">Also, if the new secondary replica is configured to allow read-only access, read-only client applications can connect to it.</span></span> <span data-ttu-id="3f9ec-123">Para obtener información sobre cómo se conectan los clientes a un grupo de disponibilidad, vea [Agentes de escucha de grupo de disponibilidad, conectividad de cliente y conmutación por error de una aplicación &#40;SQL Server&#41;](../../listeners-client-connectivity-application-failover.md).</span><span class="sxs-lookup"><span data-stu-id="3f9ec-123">For information about how clients connect to an availability group, see [Availability Group Listeners, Client Connectivity, and Application Failover &#40;SQL Server&#41;](../../listeners-client-connectivity-application-failover.md).</span></span>  
  
  
##  <a name="terms-and-definitions"></a><a name="TermsAndDefinitions"></a> <span data-ttu-id="3f9ec-124">Términos y definiciones</span><span class="sxs-lookup"><span data-stu-id="3f9ec-124">Terms and Definitions</span></span>  
 <span data-ttu-id="3f9ec-125">Conmutación por error automática</span><span class="sxs-lookup"><span data-stu-id="3f9ec-125">Automatic failover</span></span>  
 <span data-ttu-id="3f9ec-126">Conmutación por error que se produce automáticamente en la pérdida de la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-126">A failover that occurs automatically on the loss of the primary replica.</span></span> <span data-ttu-id="3f9ec-127">La conmutación por error automática solo se admite cuando la réplica principal actual y una réplica secundaria están configuradas con el modo de conmutación por error establecido en AUTOMATIC y la réplica secundaria está sincronizada actualmente.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-127">Automatic failover is supported only when the current primary and one secondary replica are both configured with failover mode set to AUTOMATIC and the secondary replica currently synchronized.</span></span>  <span data-ttu-id="3f9ec-128">Si el modo de conmutación por error de la réplica principal o la réplica secundaria es MANUAL, no puede producirse la conmutación por error automática.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-128">If the failover mode of either the primary or secondary replica is MANUAL, automatic failover cannot occur.</span></span>  
  
 <span data-ttu-id="3f9ec-129">Conmutación por error manual planeada (sin pérdida de datos)</span><span class="sxs-lookup"><span data-stu-id="3f9ec-129">Planned manual failover (without data loss)</span></span>  
 <span data-ttu-id="3f9ec-130">La conmutación por error manual planeada, o *conmutación por error manual*, es una conmutación por error iniciada por un administrador de bases de datos, normalmente con fines administrativos.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-130">Planned manual failover, or *manual failover*, is a failover that is initiated by a database administrator, typically, for administrative purposes.</span></span> <span data-ttu-id="3f9ec-131">Una conmutación por error manual planeada solo se admite si tanto la réplica principal como la réplica secundaria se configuran en modo de confirmación sincrónica y la réplica secundaria está sincronizada actualmente (en estado SYNCHRONIZED).</span><span class="sxs-lookup"><span data-stu-id="3f9ec-131">A planned manual failover is supported only if both the primary replica and secondary replica are configured for synchronous-commit mode and the secondary replica is currently synchronized (in the SYNCHRONIZED state).</span></span> <span data-ttu-id="3f9ec-132">Cuando la réplica secundaria de destino está sincronizada, puede realizarse una conmutación por error manual (sin pérdida de datos) aunque la réplica principal se haya bloqueado, ya que las bases de datos secundarias están listas para la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-132">When the target secondary replica is synchronized, manual failover (without data loss) is possible even if the primary replica has crashed because the secondary databases are ready for failover.</span></span> <span data-ttu-id="3f9ec-133">Un administrador de base de datos inicia manualmente una conmutación por error manual.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-133">A database administrator manually initiates a manual failover.</span></span>  
  
 <span data-ttu-id="3f9ec-134">Conmutación por error forzada (con posible pérdida de datos)</span><span class="sxs-lookup"><span data-stu-id="3f9ec-134">Forced failover (with possible data loss)</span></span>  
 <span data-ttu-id="3f9ec-135">Un administrador de bases de datos puede iniciar una conmutación por error cuando no hay ninguna réplica secundaria en estado SYNCHRONIZED con la réplica principal o cuando la réplica principal no se está ejecutando y no hay ninguna réplica secundaria lista para la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-135">A failover that can be initiated by a database administrator when no secondary replica is SYNCHRONIZED with the primary replica or the primary replica is not running and no secondary replica is failover ready.</span></span> <span data-ttu-id="3f9ec-136">La conmutación por error forzada puede sufrir pérdida de datos y está recomendada únicamente para la recuperación ante desastres.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-136">Forced failover risks possible data loss and is recommended strictly for disaster recovery.</span></span> <span data-ttu-id="3f9ec-137">La conmutación por error forzada también se conoce como conmutación por error manual forzada porque solo se puede iniciar manualmente.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-137">Forced failover is also known as forced manual failover because it can only be initiated manually.</span></span> <span data-ttu-id="3f9ec-138">Esta es la única forma de conmutación por error admitida en el modo de disponibilidad de confirmación asincrónica.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-138">This is the only form of failover supported by in asynchronous-commit availability mode.</span></span>  
  
 [!INCLUDE[ssFosAutoC](../../../includes/ssfosautoc-md.md)]  
 <span data-ttu-id="3f9ec-139">Dentro de un grupo de disponibilidad dado, par de réplicas de disponibilidad (incluida la réplica principal actual) que están configuradas para el modo de confirmación sincrónica con conmutación por error automática, si existe.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-139">Within a given availability group, a pair of availability replicas (including the current primary replica) that are configured for synchronous-commit mode with automatic failover, if any.</span></span> <span data-ttu-id="3f9ec-140">[!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)]solo tiene efecto si la réplica secundaria está actualmente en estado SYNCHRONIZED con la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-140">An[!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)]takes effect only if the secondary replica is currently SYNCHRONIZED with the primary replica.</span></span>  
  
 [!INCLUDE[ssFosSyncC](../../../includes/ssfossyncc-md.md)]  
 <span data-ttu-id="3f9ec-141">Dentro de un grupo de disponibilidad dado, conjunto de dos o tres réplicas de disponibilidad (incluida la réplica principal actual) que están configuradas para el modo de confirmación sincrónica, si lo hubiera.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-141">Within a given availability group, a set of two or three availability replicas (including the current primary replica) that are configured for synchronous-commit mode, if any.</span></span> <span data-ttu-id="3f9ec-142">Un [!INCLUDE[ssFosSync](../../../includes/ssfossync-md.md)]solo tiene efecto si las replicas secundarias están configuradas para el modo de conmutación por error manual y al menos una réplica secundaria está actualmente en estado SYNCHRONIZED con la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-142">A [!INCLUDE[ssFosSync](../../../includes/ssfossync-md.md)]takes effect only if the secondary replicas are configured for manual failover mode and at least one secondary replica is currently SYNCHRONIZED with the primary replica.</span></span>  
  
 [!INCLUDE[ssFosEntireC](../../../includes/ssfosentirec-md.md)]  
 <span data-ttu-id="3f9ec-143">En un grupo de disponibilidad determinado, conjunto de todas las réplicas de disponibilidad cuyo estado operativo es actualmente ONLINE, independientemente del modo de disponibilidad y el modo de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-143">Within a given availability group, the set of all availability replicas whose operational state is currently ONLINE, regardless of availability mode and of failover mode.</span></span> <span data-ttu-id="3f9ec-144">El [!INCLUDE[ssFosEntire](../../../includes/ssfosentire-md.md)]es muy importante cuando no hay actualmente ninguna réplica secundaria en estado SYNCHRONIZED con la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-144">The [!INCLUDE[ssFosEntire](../../../includes/ssfosentire-md.md)]becomes relevant when no secondary replica is currently SYNCHRONIZED with the primary replica.</span></span>  
  
##  <a name="overview-of-failover"></a><a name="Overview"></a> <span data-ttu-id="3f9ec-145">Información general de la conmutación por error</span><span class="sxs-lookup"><span data-stu-id="3f9ec-145">Overview of Failover</span></span>  
 <span data-ttu-id="3f9ec-146">En la siguiente tabla se resumen las formas de conmutación por error admitidas en diferentes modos de disponibilidad y de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-146">The following table summarizes which forms of failover are supported under different availability and failover modes.</span></span> <span data-ttu-id="3f9ec-147">En cada pareja, el modo de disponibilidad y el modo de conmutación reales vienen determinados por la intersección de los modos de la réplica principal y los modos de una o varias réplicas secundarias.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-147">For each pairing, the effective availability mode and failover mode is determined by the intersection of the modes of the primary replica plus the modes of one or more secondary replicas.</span></span>  
  
||<span data-ttu-id="3f9ec-148">Modo de confirmación asincrónica</span><span class="sxs-lookup"><span data-stu-id="3f9ec-148">Asynchronous-commit mode</span></span>|<span data-ttu-id="3f9ec-149">Modo de confirmación sincrónica con modo de conmutación por error manual</span><span class="sxs-lookup"><span data-stu-id="3f9ec-149">Synchronous-commit mode with manual-failover mode</span></span>|<span data-ttu-id="3f9ec-150">Modo de confirmación sincrónica con modo de conmutación por error automática</span><span class="sxs-lookup"><span data-stu-id="3f9ec-150">Synchronous-commit mode with automatic-failover mode</span></span>|  
|-|-------------------------------|---------------------------------------------------------|------------------------------------------------------------|  
|<span data-ttu-id="3f9ec-151">Conmutación por error automática</span><span class="sxs-lookup"><span data-stu-id="3f9ec-151">Automatic failover</span></span>|<span data-ttu-id="3f9ec-152">No</span><span class="sxs-lookup"><span data-stu-id="3f9ec-152">No</span></span>|<span data-ttu-id="3f9ec-153">No</span><span class="sxs-lookup"><span data-stu-id="3f9ec-153">No</span></span>|<span data-ttu-id="3f9ec-154">Sí</span><span class="sxs-lookup"><span data-stu-id="3f9ec-154">Yes</span></span>|  
|<span data-ttu-id="3f9ec-155">Conmutación por error manual planeada</span><span class="sxs-lookup"><span data-stu-id="3f9ec-155">Planned manual failover</span></span>|<span data-ttu-id="3f9ec-156">No</span><span class="sxs-lookup"><span data-stu-id="3f9ec-156">No</span></span>|<span data-ttu-id="3f9ec-157">Sí</span><span class="sxs-lookup"><span data-stu-id="3f9ec-157">Yes</span></span>|<span data-ttu-id="3f9ec-158">Sí</span><span class="sxs-lookup"><span data-stu-id="3f9ec-158">Yes</span></span>|  
|<span data-ttu-id="3f9ec-159">conmutación por error forzada</span><span class="sxs-lookup"><span data-stu-id="3f9ec-159">Forced failover</span></span>|<span data-ttu-id="3f9ec-160">Sí</span><span class="sxs-lookup"><span data-stu-id="3f9ec-160">Yes</span></span>|<span data-ttu-id="3f9ec-161">Sí</span><span class="sxs-lookup"><span data-stu-id="3f9ec-161">Yes</span></span>|<span data-ttu-id="3f9ec-162">?**<sup>\*</sup>**</span><span class="sxs-lookup"><span data-stu-id="3f9ec-162">Yes**<sup>\*</sup>**</span></span>|  
  
 <span data-ttu-id="3f9ec-163">**<sup>\*</sup>** Si emite un comando de conmutación por error forzada en una réplica secundaria sincronizada, la réplica secundaria se comporta igual que en el caso de una conmutación por error manual.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-163">**<sup>\*</sup>**  If you issue a forced failover command on a synchronized secondary replica, the secondary replica behaves the same as for a manual failover.</span></span>  
  
 <span data-ttu-id="3f9ec-164">El período de tiempo que la base de datos no está disponible durante una conmutación por error depende del tipo de conmutación por error y su causa.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-164">The amount of time that the database is unavailable during a failover depends on the type of failover and its cause.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="3f9ec-165">Para admitir las conexiones de cliente después de la conmutación por error, excepto en las bases de datos independientes, los inicios de sesión y los trabajos definidos en cualquiera de las bases de datos principales anteriores se deben volver a crear manualmente en la nueva base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-165">To support client connections after failover, except for contained databases, logins and jobs defined on any of the former primary databases must be manually recreated on the new primary database.</span></span> <span data-ttu-id="3f9ec-166">Para obtener más información, vea [Administración de inicios de sesión y de trabajos para las bases de datos de un grupo de disponibilidad &#40;SQL Server&#41;](../../logins-and-jobs-for-availability-group-databases.md).</span><span class="sxs-lookup"><span data-stu-id="3f9ec-166">For more information, see [Management of Logins and Jobs for the Databases of an Availability Group &#40;SQL Server&#41;](../../logins-and-jobs-for-availability-group-databases.md).</span></span>  
  
### <a name="failover-sets"></a><span data-ttu-id="3f9ec-167">Conjuntos de conmutación por error</span><span class="sxs-lookup"><span data-stu-id="3f9ec-167">Failover Sets</span></span>  
 <span data-ttu-id="3f9ec-168">Las formas de conmutación por error posibles para un grupo de disponibilidad determinado se pueden considerar como conjuntos de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-168">The forms of failover that are possible for a given availability group can be understood in terms of failover sets.</span></span> <span data-ttu-id="3f9ec-169">Un conjunto de conmutación por error consta de una réplica principal y varias réplicas secundarias que admiten una determinada forma de conmutación, de la manera siguiente:</span><span class="sxs-lookup"><span data-stu-id="3f9ec-169">A failover set consists of the primary replica and secondary replicas that support a given form of failover, as follows:</span></span>  
  
-   <span data-ttu-id="3f9ec-170">**[!INCLUDE[ssFosAutoC](../../../includes/ssfosautoc-md.md)] (opcional):**  Dentro de un grupo de disponibilidad dado, par de réplicas de disponibilidad (incluida la réplica principal actual) que están configuradas para el modo de confirmación sincrónica con conmutación por error automática, si existe.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-170">**[!INCLUDE[ssFosAutoC](../../../includes/ssfosautoc-md.md)] (optional):**  Within a given availability group, a pair of availability replicas (including the current primary replica) that are configured for synchronous-commit mode with automatic failover, if any.</span></span> <span data-ttu-id="3f9ec-171">Un conjunto de conmutación automática por error solo tiene efecto si la réplica secundaria está actualmente en estado SYNCHRONIZED con la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-171">An automatic failover set takes effect only if the secondary replica is currently SYNCHRONIZED with the primary replica.</span></span>  
  
-   <span data-ttu-id="3f9ec-172">**[!INCLUDE[ssFosSyncC](../../../includes/ssfossyncc-md.md)] (opcional):**  Dentro de un grupo de disponibilidad dado, conjunto de dos o tres réplicas de disponibilidad (incluida la réplica principal actual) que están configuradas para el modo de confirmación sincrónica, si lo hubiera.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-172">**[!INCLUDE[ssFosSyncC](../../../includes/ssfossyncc-md.md)] (optional):**  Within a given availability group, a set of two or three availability replicas (including the current primary replica) that are configured for synchronous-commit mode, if any.</span></span> <span data-ttu-id="3f9ec-173">Un conjunto de confirmación sincrónica de conmutación automática por error solo tiene efecto si las réplicas secundarias están configuradas para el modo de conmutación por error manual y al menos una réplica secundaria está actualmente en estado SYNCHRONIZED con la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-173">A synchronous-commit failover set takes effect only if the secondary replicas are configured for manual failover mode and at least one secondary replica is currently SYNCHRONIZED with the primary replica.</span></span>  
  
-   <span data-ttu-id="3f9ec-174">**[!INCLUDE[ssFosEntireC](../../../includes/ssfosentirec-md.md)]:**   En un grupo de disponibilidad determinado, conjunto de todas las réplicas de disponibilidad cuyo estado operativo es actualmente ONLINE, independientemente del modo de disponibilidad y el modo de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-174">**[!INCLUDE[ssFosEntireC](../../../includes/ssfosentirec-md.md)] :**  Within a given availability group, the set of all availability replicas whose operational state is currently ONLINE, regardless of availability mode and of failover mode.</span></span> <span data-ttu-id="3f9ec-175">El conjunto completo de conmutación por error es importante cuando no hay actualmente ninguna réplica secundaria en estado SYNCHRONIZED con la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-175">The entire failover set becomes relevant when no secondary replica is currently SYNCHRONIZED with the primary replica.</span></span>  
  
 <span data-ttu-id="3f9ec-176">Al configurar una réplica de disponibilidad como confirmación sincrónica con conmutación por error automática, la réplica de disponibilidad forma parte de [!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)].</span><span class="sxs-lookup"><span data-stu-id="3f9ec-176">When you configure an availability replica as synchronous commit with automatic failover, the availability replica becomes part of the [!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)].</span></span> <span data-ttu-id="3f9ec-177">Sin embargo, que el conjunto tenga efecto dependerá de la réplica principal actual.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-177">However whether the set takes effect depends the current primary.</span></span> <span data-ttu-id="3f9ec-178">Las formas de conmutación por error que son actualmente posibles en un momento determinado dependen de qué conjuntos de conmutación estén actualmente activos.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-178">The forms of failover that are actually possible at a given time depends on what failover sets are currently in effect.</span></span>  
  
 <span data-ttu-id="3f9ec-179">Por ejemplo, considere el caso de un grupo de disponibilidad con cuatro réplicas de disponibilidad, del siguiente modo:</span><span class="sxs-lookup"><span data-stu-id="3f9ec-179">For example, consider an availability group that has four availability replicas, as follows:</span></span>  
  
|<span data-ttu-id="3f9ec-180">Réplica</span><span class="sxs-lookup"><span data-stu-id="3f9ec-180">Replica</span></span>|<span data-ttu-id="3f9ec-181">Configuración de disponibilidad y modo de conmutación por error</span><span class="sxs-lookup"><span data-stu-id="3f9ec-181">Availability Mode and Failover Mode Settings</span></span>|  
|-------------|--------------------------------------------------|  
|<span data-ttu-id="3f9ec-182">A</span><span class="sxs-lookup"><span data-stu-id="3f9ec-182">A</span></span>|<span data-ttu-id="3f9ec-183">Confirmación sincrónica con conmutación por error automática</span><span class="sxs-lookup"><span data-stu-id="3f9ec-183">Synchronous commit with automatic failover</span></span>|  
|<span data-ttu-id="3f9ec-184">B</span><span class="sxs-lookup"><span data-stu-id="3f9ec-184">B</span></span>|<span data-ttu-id="3f9ec-185">Confirmación sincrónica con conmutación por error automática</span><span class="sxs-lookup"><span data-stu-id="3f9ec-185">Synchronous commit with automatic failover</span></span>|  
|<span data-ttu-id="3f9ec-186">C</span><span class="sxs-lookup"><span data-stu-id="3f9ec-186">C</span></span>|<span data-ttu-id="3f9ec-187">Confirmación sincrónica con solo conmutación por error manual planeada</span><span class="sxs-lookup"><span data-stu-id="3f9ec-187">Synchronous commit with planned manual failover only</span></span>|  
|<span data-ttu-id="3f9ec-188">D</span><span class="sxs-lookup"><span data-stu-id="3f9ec-188">D</span></span>|<span data-ttu-id="3f9ec-189">Confirmación asincrónica (con solo conmutación por error forzada)</span><span class="sxs-lookup"><span data-stu-id="3f9ec-189">Asynchronous commit (with only forced failover)</span></span>|  
  
 <span data-ttu-id="3f9ec-190">El comportamiento de conmutación por error para cada réplica secundaria dependerá de qué réplica de disponibilidad sea actualmente la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-190">The failover behavior for each secondary replica depends on which availability replica is currently the primary replica.</span></span> <span data-ttu-id="3f9ec-191">Básicamente, para una réplica secundaria dada, el comportamiento de conmutación por error es el peor caso dada la réplica principal actual.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-191">Basically, for a given secondary replica, the failover behavior is the worst case given the current primary replica.</span></span> <span data-ttu-id="3f9ec-192">En la ilustración siguiente se muestra cómo el comportamiento de la conmutación por error de réplicas secundarias varía en función de la réplica principal actual y si está configurada para el modo de confirmación asincrónica (con solo conmutación por error forzada) o el modo de confirmación sincrónica (con o sin conmutación automática por error).</span><span class="sxs-lookup"><span data-stu-id="3f9ec-192">The following figure illustrates how the failover behavior of secondary replicas varies depending on the current primary replica, and whether it is configured for asynchronous-commit mode (with only forced failover) or synchronous-commit mode (with or without automatic failover).</span></span>  
  
 <span data-ttu-id="3f9ec-193">![Cómo afecta la configuración de la réplica principal a la conmutación por error](../../media/aoag-failoversetexample.gif "Cómo afecta la configuración de la réplica principal a la conmutación por error")</span><span class="sxs-lookup"><span data-stu-id="3f9ec-193">![How primary replica configuration affects failover](../../media/aoag-failoversetexample.gif "How primary replica configuration affects failover")</span></span>  
  
##  <a name="automatic-failover"></a><a name="AutomaticFailover"></a> <span data-ttu-id="3f9ec-194">Automatic Failover</span><span class="sxs-lookup"><span data-stu-id="3f9ec-194">Automatic Failover</span></span>  
 <span data-ttu-id="3f9ec-195">Una conmutación por error automática hace que una réplica secundaria calificada realice la transición automática al rol principal después de que la réplica principal deje de estar disponible.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-195">An automatic failover causes a qualified secondary replica to automatically transition to the primary role after the primary replica becomes unavailable.</span></span> <span data-ttu-id="3f9ec-196">La conmutación por error automática es más apropiada cuando el nodo de WSFC que hospeda la réplica principal es local para el nodo que hospeda la réplica secundaria.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-196">Automatic failover is best suited when the WSFC node that hosts the primary replica is local to the node that hosts the secondary replica.</span></span> <span data-ttu-id="3f9ec-197">Esto se debe a que la sincronización de datos funciona mejor con una latencia de mensajes baja entre equipos y a que las conexiones de cliente pueden seguir siendo locales.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-197">This is because data synchronization works best with low message latency between computers and because client connections can remain local.</span></span>  
  
  
###  <a name="conditions-required-for-an-automatic-failover"></a><a name="RequiredConditions"></a> <span data-ttu-id="3f9ec-198">Condiciones requeridas para una conmutación automática por error</span><span class="sxs-lookup"><span data-stu-id="3f9ec-198">Conditions Required for an Automatic Failover</span></span>  
 <span data-ttu-id="3f9ec-199">La conmutación por error automática solo aparece en las siguientes condiciones:</span><span class="sxs-lookup"><span data-stu-id="3f9ec-199">Automatic failover occurs only under the following conditions:</span></span>  
  
-   <span data-ttu-id="3f9ec-200">Ya existe un conjunto de conmutación por error automática.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-200">An automatic failover set exists.</span></span> <span data-ttu-id="3f9ec-201">Este conjunto consta de una réplica principal y una secundaria (el *destino de conmutación automática por error*) que están configuradas para el modo de confirmación sincrónica y también para la conmutación AUTOMÁTICA por error.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-201">This set consists of a primary replica and a secondary replica (the *automatic failover target*) that are both configured for synchronous-commit mode and set to AUTOMATIC failover.</span></span> <span data-ttu-id="3f9ec-202">HYPERLINK "file:///C:\\\Users\\\marshow\\\AppData\\\Local\\\Temp\\\DxEditor\\\DduePreview\\\Default\\\6fe88e12-4df1-4025-ba24-7579635ccecf\\\HTM\\\html\\\29e0ac5d-eb58-4801-82b9-e278f08db920" Si la réplica principal se establece en una conmutación por error de tipo MANUAL, no se puede realizar la conmutación por error automática, aunque se establezca una réplica secundaria en una conmutación por error de tipo AUTOMATIC.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-202">HYPERLINK "file:///C:\\\Users\\\marshow\\\AppData\\\Local\\\Temp\\\DxEditor\\\DduePreview\\\Default\\\6fe88e12-4df1-4025-ba24-7579635ccecf\\\HTM\\\html\\\29e0ac5d-eb58-4801-82b9-e278f08db920"  If the primary replica is set MANUAL failover, automatic failover cannot occur, even if a secondary replica is set to AUTOMATIC failover.</span></span>  
  
     <span data-ttu-id="3f9ec-203">Para más información, vea [Modos de disponibilidad &#40;Grupos de disponibilidad AlwaysOn&#41;](availability-modes-always-on-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="3f9ec-203">For more information, see [Availability Modes &#40;AlwaysOn Availability Groups&#41;](availability-modes-always-on-availability-groups.md).</span></span>  
  
-   <span data-ttu-id="3f9ec-204">El destino de la conmutación por error automática tiene un estado de sincronización correcto (esto indica que cada base de datos secundaria del destino de la conmutación por error se sincroniza con la base de datos principal correspondiente).</span><span class="sxs-lookup"><span data-stu-id="3f9ec-204">The automatic failover target has a healthy synchronization state (this indicates that every secondary database on the failover target is synchronized with its corresponding primary database).</span></span>  
  
    > [!TIP]  
    >  <span data-ttu-id="3f9ec-205">Los grupos de disponibilidad AlwaysOn supervisan el estado de ambas réplicas en un conjunto de conmutación por error automática.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-205">AlwaysOn Availability Groups monitors the health of both replicas in an automatic failover set.</span></span> <span data-ttu-id="3f9ec-206">Si se produce un error en alguna de las réplicas, el estado del grupo de disponibilidad se establece en CRITICAL.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-206">If either replica fails, the availability group's health state is set to CRITICAL.</span></span> <span data-ttu-id="3f9ec-207">Si se produce un error en la réplica secundaria, la conmutación por error automática no es posible debido a que el destino de esta no está disponible.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-207">If the secondary replica fails, automatic failover is not possible because the automatic failover target is unavailable.</span></span> <span data-ttu-id="3f9ec-208">Si se produce un error en la réplica principal, el grupo de disponibilidad realizará una conmutación por error a la réplica secundaria.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-208">If the primary replica fails, the availability group will fail over to the secondary replica.</span></span> <span data-ttu-id="3f9ec-209">No existirá ningún destino de conmutación por error automática hasta que la réplica principal anterior se ponga en línea.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-209">Until the former primary replica comes online, no automatic failover target exists.</span></span> <span data-ttu-id="3f9ec-210">De todas maneras, para garantizar la disponibilidad en el caso improbable de un fallo secuencial, se recomienda configurar una réplica secundaria diferente como destino de la conmutación por error automática.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-210">In either case, to ensure availability in the unlikely case of a sequential failure, we recommend that you configure a different secondary replica as the automatic failover target.</span></span>  
    >   
    >  <span data-ttu-id="3f9ec-211">Para más información, vea [Usar directivas de AlwaysOn para ver el estado de un grupo de disponibilidad &#40;SQL Server&#41;](use-always-on-policies-to-view-the-health-of-an-availability-group-sql-server.md) y [Cambiar el modo de conmutación por error de una réplica de disponibilidad &#40;SQL Server&#41;](change-the-failover-mode-of-an-availability-replica-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="3f9ec-211">For more information, see [Use AlwaysOn Policies to View the Health of an Availability Group &#40;SQL Server&#41;](use-always-on-policies-to-view-the-health-of-an-availability-group-sql-server.md) and [Change the Failover Mode of an Availability Replica &#40;SQL Server&#41;](change-the-failover-mode-of-an-availability-replica-sql-server.md).</span></span>  
  
-   <span data-ttu-id="3f9ec-212">El clúster del servicio de clústeres de conmutación por error (WSFC) tiene quórum.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-212">The Windows Server Failover Clustering (WSFC) cluster has quorum.</span></span> <span data-ttu-id="3f9ec-213">Para obtener más información, vea [Configuración de los votos y modos de cuórum WSFC &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-quorum-modes-and-voting-configuration-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="3f9ec-213">For more information, see [WSFC Quorum Modes and Voting Configuration &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-quorum-modes-and-voting-configuration-sql-server.md).</span></span>  
  
-   <span data-ttu-id="3f9ec-214">La réplica principal ha dejado de estar disponible y se han cumplido los niveles de condición de conmutación por error de la directiva de conmutación por error flexible.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-214">The primary replica has become unavailable, and the failover-condition levels defined by your the flexible failover policy have been met.</span></span> <span data-ttu-id="3f9ec-215">Para obtener más información sobre los niveles de condición de conmutación por error, vea [Directiva de conmutación por error flexible para conmutación automática por error de un grupo de disponibilidad &#40;SQL Server&#41;](flexible-automatic-failover-policy-availability-group.md).</span><span class="sxs-lookup"><span data-stu-id="3f9ec-215">For information about failover-condition levels, see [Flexible Failover Policy for Automatic Failover of an Availability Group &#40;SQL Server&#41;](flexible-automatic-failover-policy-availability-group.md).</span></span>  
  
###  <a name="how-automatic-failover-works"></a><a name="HowAutoFoWorks"></a> <span data-ttu-id="3f9ec-216">Cómo funciona la conmutación automática por error</span><span class="sxs-lookup"><span data-stu-id="3f9ec-216">How Automatic Failover Works</span></span>  
 <span data-ttu-id="3f9ec-217">Una conmutación automática por error inicia la siguiente secuencia de acciones:</span><span class="sxs-lookup"><span data-stu-id="3f9ec-217">An automatic failover initiates the following sequence of actions:</span></span>  
  
1.  <span data-ttu-id="3f9ec-218">Si la instancia del servidor que hospeda la réplica principal actual sigue en ejecución, cambia el estado de las bases de datos principales a DISCONNECTED y desconecta todos los clientes.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-218">If the server instance that is hosting the current primary replica is still running, it changes the state of the primary databases to DISCONNECTED and disconnects all clients.</span></span>  
  
2.  <span data-ttu-id="3f9ec-219">Si las entradas del registro están esperando en colas de recuperación en la réplica secundaria de destino, la réplica secundaria aplica las entradas del registro restantes para terminar la puesta al día de las bases de datos secundarias.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-219">If any log records are waiting in recovery queues on the target secondary replica, the secondary replica applies the remaining log records to finish rolling forward the secondary databases.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="3f9ec-220">La cantidad de tiempo que requiere la aplicación del registro a una base de datos dada depende de la velocidad del sistema, la carga de trabajo reciente y la cantidad de registro en la cola de cola de recuperación.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-220">The amount of time required to apply the log to a given database depends on the speed of the system, the recent work load, and the amount of log in the recovery queue.</span></span>  
  
3.  <span data-ttu-id="3f9ec-221">Las réplica secundaria anterior realiza la transición al rol principal.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-221">The former secondary replica transitions to the primary role.</span></span> <span data-ttu-id="3f9ec-222">Sus bases de datos se convierten en las bases de datos principales.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-222">Its databases become the primary databases.</span></span> <span data-ttu-id="3f9ec-223">La nueva réplica principal revierte las transacciones no confirmadas (fase de reversión de recuperación) lo más rápidamente posible.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-223">The new primary replica rolls back any uncommitted transactions (the undo phase of recovery) as quickly as possible.</span></span> <span data-ttu-id="3f9ec-224">Los bloqueos aíslan las transacciones no confirmadas, permitiendo que se produzca la reversión en segundo plano mientras los clientes usan la base de datos.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-224">Locks isolate these uncommitted transactions, allowing roll back to occur in the background while clients use the database.</span></span> <span data-ttu-id="3f9ec-225">Este proceso no revierte las transacciones confirmadas.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-225">This process does not roll back any committed transactions.</span></span>  
  
     <span data-ttu-id="3f9ec-226">Hasta que se conecta una determinada base de datos secundaria, se marca brevemente como NOT_SYNCHRONIZED.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-226">Until a given secondary database is connected, it is briefly marked as NOT_SYNCHRONIZED.</span></span> <span data-ttu-id="3f9ec-227">Antes de que la recuperación de reversión se inicie, las bases de datos secundarias pueden conectarse a las bases de datos principales y pasar rápidamente al estado SYNCHRONIZED.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-227">Before the rollback recovery starts, secondary databases can connect to the new primary databases and quickly transition to the SYNCHRONIZED state.</span></span> <span data-ttu-id="3f9ec-228">El caso que mejor suele funcionar es aquel en el que hay una tercera réplica de confirmación sincrónica que permanece en el rol secundario después de la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-228">The best case is usually for a third synchronous-commit replica that remains in the secondary role after the failover.</span></span>  
  
4.  <span data-ttu-id="3f9ec-229">Posteriormente, cuando la instancia del servidor que hospeda la réplica principal anterior se reinicia, reconoce que otra réplica de disponibilidad posee el rol principal.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-229">Later, when the server instance that is hosting the former primary replica restarts, it recognizes that another availability replica now owns the primary role.</span></span> <span data-ttu-id="3f9ec-230">La réplica principal anterior realiza la transición al rol secundario y sus bases de datos se convierten en bases de datos secundarias.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-230">The former primary replica transitions to the secondary role, and its databases become secondary databases.</span></span> <span data-ttu-id="3f9ec-231">La nueva réplica secundaria se conecta a la réplica principal actual y detecta su base de datos en las bases de datos principales actuales lo más rápidamente posible.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-231">The new secondary replica connects to the current primary replica and catches its database up to the current primary databases as quickly as possible.</span></span> <span data-ttu-id="3f9ec-232">Tan pronto como la nueva réplica secundaria haya vuelto a sincronizar sus bases de datos, la conmutación por error vuelve a ser posible, pero en dirección inversa.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-232">As soon as the new secondary replica has resynchronized its databases, failover is again possible, in the reverse direction.</span></span>  
  
###  <a name="to-configure-automatic-failover"></a><a name="EnableAutoFo"></a> <span data-ttu-id="3f9ec-233">Para configurar la conmutación automática por error</span><span class="sxs-lookup"><span data-stu-id="3f9ec-233">To Configure Automatic Failover</span></span>  
 <span data-ttu-id="3f9ec-234">Una réplica de disponibilidad se puede configurar para admitir la conmutación por error automática en cualquier momento.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-234">An availability replica can be configured to support automatic failover at any point.</span></span>  
  
 <span data-ttu-id="3f9ec-235">**Para configurar la conmutación automática por error**</span><span class="sxs-lookup"><span data-stu-id="3f9ec-235">**To configure automatic failover**</span></span>  
  
1.  <span data-ttu-id="3f9ec-236">Asegúrese de que la réplica secundaria esté configurada para utilizar el modo de disponibilidad de confirmación sincrónica.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-236">Ensure that the secondary replica is configured to use the synchronous-commit availability mode.</span></span> <span data-ttu-id="3f9ec-237">Para obtener más información, vea [Cambiar el modo de disponibilidad de una réplica de disponibilidad &#40;SQL Server&#41;](change-the-availability-mode-of-an-availability-replica-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="3f9ec-237">For more information, see [Change the Availability Mode of an Availability Replica &#40;SQL Server&#41;](change-the-availability-mode-of-an-availability-replica-sql-server.md).</span></span>  
  
2.  <span data-ttu-id="3f9ec-238">Establezca el modo de conmutación por error a automático.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-238">Set the failover mode to automatic.</span></span> <span data-ttu-id="3f9ec-239">Para obtener más información, vea [Cambiar el modo de conmutación por error de una réplica de disponibilidad &#40;SQL Server&#41;](change-the-failover-mode-of-an-availability-replica-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="3f9ec-239">For more information, see [Change the Failover Mode of an Availability Replica &#40;SQL Server&#41;](change-the-failover-mode-of-an-availability-replica-sql-server.md).</span></span>  
  
3.  <span data-ttu-id="3f9ec-240">Si lo desea, también puede cambiar la directiva de conmutación por error flexible del grupo de disponibilidad para especificar los tipos de errores que pueden causar una conmutación automática por error.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-240">Optionally, change the flexible failover policy of the availability group to specify the sorts of failures that can cause an automatic failover to occur.</span></span> <span data-ttu-id="3f9ec-241">Para más información, vea [Configurar la directiva de conmutación por error flexible para controlar las condiciones de la conmutación automática por error &#40;grupos de disponibilidad AlwaysOn&#41;](configure-flexible-automatic-failover-policy.md) HYPERLINK "file:///C:\\\Users\\\marshow\\\AppData\\\Local\\\Temp\\\DxEditor\\\DduePreview\\\Default\\\6a8d98a9-6e6a-40d1-9809-efa9013d7452\\\HTM\\\html\\\1ed564b4-9835-4245-ae35-9ba67419a4ce" y [Directiva de conmutación por error para instancias de clústeres de conmutación por error](../../../sql-server/failover-clusters/windows/failover-policy-for-failover-cluster-instances.md).</span><span class="sxs-lookup"><span data-stu-id="3f9ec-241">For more information, see [Configure the Flexible Failover Policy to Control Conditions for Automatic Failover &#40;AlwaysOn Availability Groups&#41;](configure-flexible-automatic-failover-policy.md) HYPERLINK "file:///C:\\\Users\\\marshow\\\AppData\\\Local\\\Temp\\\DxEditor\\\DduePreview\\\Default\\\6a8d98a9-6e6a-40d1-9809-efa9013d7452\\\HTM\\\html\\\1ed564b4-9835-4245-ae35-9ba67419a4ce"  and [Failover Policy for Failover Cluster Instances](../../../sql-server/failover-clusters/windows/failover-policy-for-failover-cluster-instances.md).</span></span>  
  
##  <a name="planned-manual-failover-without-data-loss"></a><a name="ManualFailover"></a> <span data-ttu-id="3f9ec-242">Conmutación por error manual planeada (sin pérdida de datos)</span><span class="sxs-lookup"><span data-stu-id="3f9ec-242">Planned Manual Failover (Without Data Loss)</span></span>  
 <span data-ttu-id="3f9ec-243">Una conmutación por error manual produce la transición de una réplica secundaria al rol principal después de que un administrador de bases de datos emita un comando de conmutación por error manual en la instancia del servidor que hospeda la réplica secundaria de destino.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-243">A manual failover causes a synchronized secondary replica to transition to the primary role after a database administrator issues a manual-failover command on the server instance that hosts the target secondary replica.</span></span> <span data-ttu-id="3f9ec-244">Para admitir la conmutación por error manual, la réplica secundaria y la réplica principal actual se deben configurar en modo de confirmación sincrónica, si lo hubiera.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-244">To support manual failover, the secondary replica and the current primary replica must both be configured for synchronous-commit mode, if any.</span></span> <span data-ttu-id="3f9ec-245">Cada base de datos secundaria de la réplica de disponibilidad debe unirse al grupo de disponibilidad y sincronizarse con la base de datos principal correspondiente (es decir, la réplica secundaria se debe sincronizar).</span><span class="sxs-lookup"><span data-stu-id="3f9ec-245">Every secondary database on the availability replica must be joined to the availability group and synchronized with its corresponding primary database (that is, the secondary replica must be synchronized).</span></span> <span data-ttu-id="3f9ec-246">Esto garantiza que cada transacción confirmada en una base de datos principal anterior también se ha confirmado en la nueva base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-246">This guarantees that every transaction that was committed on a former primary database has also been committed on the new primary database.</span></span> <span data-ttu-id="3f9ec-247">Por tanto, las nuevas bases de datos principales son idénticas a las bases de datos principales antiguas.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-247">Therefore, the new primary databases are identical to the old primary databases.</span></span>  
  
 <span data-ttu-id="3f9ec-248">En la siguiente ilustración se muestran las fases de una conmutación por error planeada:</span><span class="sxs-lookup"><span data-stu-id="3f9ec-248">The following figure illustrates the stages of a planned failover:</span></span>  
  
1.  <span data-ttu-id="3f9ec-249">Antes de la conmutación por error, la instancia del servidor hospeda la réplica principal en `Node01`.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-249">Before the failover, the primary replica is hosted by the server instance on `Node01`.</span></span>  
  
2.  <span data-ttu-id="3f9ec-250">Un administrador de bases de datos inicia una conmutación por error planeada.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-250">A database administrator initiates a planned failover.</span></span> <span data-ttu-id="3f9ec-251">El destino de la conmutación por error es la réplica de disponibilidad hospedada por la instancia de servidor en `Node02`.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-251">The failover target is the availability replica hosted by the server instance on `Node02`.</span></span>  
  
3.  <span data-ttu-id="3f9ec-252">El destino de la conmutación por error (en `Node02`) se convierte en la nueva réplica principal.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-252">The failover target (on `Node02`) becomes the new primary replica.</span></span> <span data-ttu-id="3f9ec-253">Como se trata de una conmutación por error planeada, la réplica principal anterior se cambia al rol secundario durante la conmutación por error y pone inmediatamente sus bases de datos en línea como bases de datos secundarias.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-253">Because this is a planned failover, the former primary replica switches to the secondary role during the failover and brings its databases online as secondary databases immediately.</span></span>  
  
 <span data-ttu-id="3f9ec-254">![Ilustración de una conmutación por error manual planeada](../../media/aoag-plannedmanualfailover.gif "Ilustración de una conmutación por error manual planeada")</span><span class="sxs-lookup"><span data-stu-id="3f9ec-254">![Illustation of a planned manual failover](../../media/aoag-plannedmanualfailover.gif "Illustation of a planned manual failover")</span></span>  
  
  
###  <a name="conditions-required-for-a-manual-failover"></a><a name="ManualFailoverConditions"></a> <span data-ttu-id="3f9ec-255">Condiciones requeridas para una conmutación por error manual</span><span class="sxs-lookup"><span data-stu-id="3f9ec-255">Conditions Required for a Manual Failover</span></span>  
 <span data-ttu-id="3f9ec-256">Para admitir una conmutación por error manual, la réplica principal actual debe establecerse en modo de confirmación sincrónica y una réplica secundaria debe estar:</span><span class="sxs-lookup"><span data-stu-id="3f9ec-256">To support a manual failover, the current primary replica must be set to synchronous-commit mode and a secondary replica must be:</span></span>  
  
-   <span data-ttu-id="3f9ec-257">Configurada para el modo de confirmación sincrónica.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-257">Configured for synchronous-commit mode.</span></span>  
  
-   <span data-ttu-id="3f9ec-258">Sincronizada actualmente con la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-258">Currently synchronized with the primary replica.</span></span>  
  
 <span data-ttu-id="3f9ec-259">Para realizar la conmutación por error manual en un grupo de disponibilidad, debe conectarse a la réplica secundaria que se va a convertir en la nueva réplica principal.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-259">To manually fail over an availability group, you must be connected to the secondary replica that is to become the new primary replica.</span></span>  
  
###  <a name="how-a-planned-manual-failover-works"></a><a name="ManualFailoverHowWorks"></a> <span data-ttu-id="3f9ec-260">Cómo funciona la conmutación por error manual planeada</span><span class="sxs-lookup"><span data-stu-id="3f9ec-260">How a Planned Manual Failover Works</span></span>  
 <span data-ttu-id="3f9ec-261">Una conmutación por error manual planeada, que se debe iniciar en la réplica secundaria de destino, inicia la siguiente secuencia de acciones:</span><span class="sxs-lookup"><span data-stu-id="3f9ec-261">A planned manual failover, which must be initiated on the target secondary replica, initiates the following sequence of actions:</span></span>  
  
1.  <span data-ttu-id="3f9ec-262">Para asegurarse de que se producen transacciones de ningún usuario nuevo en las bases de datos principales originales, el clúster de WSFC envía una solicitud a la réplica principal para pasar a modo sin conexión.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-262">To ensure that no new user transactions occur on the original primary databases, the WSFC cluster sends a request to the primary replica to go offline.</span></span>  
  
2.  <span data-ttu-id="3f9ec-263">Si un registro está esperando en la cola de recuperación de cualquier base de datos secundaria, la réplica secundaria finaliza las puesta al día de esa base de datos secundaria.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-263">If any log is waiting in the recovery queue of any secondary database, the secondary replica finishes rolling forward that secondary database.</span></span> <span data-ttu-id="3f9ec-264">La cantidad de tiempo que se necesita para ello depende de la velocidad del sistema, la carga de trabajo reciente y la cantidad de registro en la cola de recuperación.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-264">The amount of time required depends on the speed of the system, the recent workload, and the amount of log in the recovery queue.</span></span> <span data-ttu-id="3f9ec-265">Para conocer el tamaño actual de la cola de recuperación, utilice el contador de rendimiento **Cola de recuperación** .</span><span class="sxs-lookup"><span data-stu-id="3f9ec-265">To learn the current size of the recovery queue, use the **Recovery Queue** performance counter.</span></span> <span data-ttu-id="3f9ec-266">Para obtener más información, vea [SQL Server, Database Replica (SQL Server, réplica de base de datos)](../../../relational-databases/performance-monitor/sql-server-database-replica.md).</span><span class="sxs-lookup"><span data-stu-id="3f9ec-266">For more information, see [SQL Server, Database Replica](../../../relational-databases/performance-monitor/sql-server-database-replica.md).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="3f9ec-267">El tiempo de conmutación por error se puede regular limitando el tamaño de la cola de recuperación.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-267">The failover time can be regulated by limiting the size of the recovery queue.</span></span> <span data-ttu-id="3f9ec-268">Sin embargo, esto puede hacer que la réplica principal se ralentice para permitir que la réplica secundaria no se retrase.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-268">However, this can cause the primary replica to slow down to allow the secondary replica to keep up.</span></span>  
  
3.  <span data-ttu-id="3f9ec-269">La réplica secundaria se convierte en la nueva réplica principal y la réplica principal anterior se convierte en la nueva réplica secundaria.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-269">The secondary replica becomes the new primary replica, and the former primary replica becomes the new secondary replica.</span></span>  
  
4.  <span data-ttu-id="3f9ec-270">La nueva réplica principal revierte las transacciones no confirmadas y pone sus bases de datos en línea como bases de datos principales. Todas las bases de datos secundarias se marcan brevemente como NOT SYNCHRONIZED hasta que se conectan y vuelven a sincronizar con las nuevas bases de datos principales.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-270">The new primary replica rolls back any uncommitted transactions and brings its databases online as the primary databases.All secondary databases are briefly marked as NOT SYNCHRONIZED until they connect and resynchronize to the new primary databases.</span></span> <span data-ttu-id="3f9ec-271">Este proceso no revierte las transacciones confirmadas.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-271">This process does not roll back any committed transactions.</span></span>  
  
5.  <span data-ttu-id="3f9ec-272">Cuando la réplica principal anterior vuelve a estar en línea, toma el rol secundario y la base de datos principal anterior se convierte en la base de datos secundaria.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-272">When the former primary replica comes back online, it takes on the secondary role, and the former primary database becomes the secondary database.</span></span> <span data-ttu-id="3f9ec-273">La nueva réplica secundaria vuelve a sincronizar rápidamente las nuevas bases de datos secundarias con las bases de datos principales correspondientes.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-273">The new secondary replica quickly resynchronizes the new secondary databases with the corresponding primary databases.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="3f9ec-274">Tan pronto como la nueva réplica secundaria haya vuelto a sincronizar las bases de datos, la conmutación por error vuelve a ser posible, pero en dirección inversa.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-274">As soon as the new secondary replica has resynchronized the databases, failover is again possible, but in the reverse direction.</span></span>  
  
 <span data-ttu-id="3f9ec-275">Tras la conmutación por error, los clientes deben volver a conectarse a la base de datos principal actual.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-275">After failover, clients must reconnect to the current primary database.</span></span> <span data-ttu-id="3f9ec-276">Para obtener más información, vea [Agentes de escucha de grupo de disponibilidad, conectividad de cliente y conmutación por error de una aplicación &#40;SQL Server&#41;](../../listeners-client-connectivity-application-failover.md).</span><span class="sxs-lookup"><span data-stu-id="3f9ec-276">For more information, see [Availability Group Listeners, Client Connectivity, and Application Failover &#40;SQL Server&#41;](../../listeners-client-connectivity-application-failover.md).</span></span>  
  
###  <a name="maintaining-availability-during-upgrades"></a><a name="ManualFailoverDuringUpgrades"></a> <span data-ttu-id="3f9ec-277">Mantener la disponibilidad durante las actualizaciones</span><span class="sxs-lookup"><span data-stu-id="3f9ec-277">Maintaining Availability During Upgrades</span></span>  
 <span data-ttu-id="3f9ec-278">El administrador de base de datos para sus grupos de disponibilidad puede utilizar conmutaciones por error manuales para mantener la disponibilidad de la base de datos al actualizar el hardware o el software.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-278">The database administrator for your availability groups can use manual failovers to maintain database availability when you upgrade hardware or software.</span></span> <span data-ttu-id="3f9ec-279">Para utilizar un grupo de disponibilidad para actualizaciones de software, la instancia del servidor y/o el nodo del equipo que hospeda la réplica secundaria de destino deben haber recibido ya las actualizaciones.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-279">To use an availability group for software upgrades, the server instance and/or computer node that hosts the target secondary replica must have already received the upgrades.</span></span> <span data-ttu-id="3f9ec-280">Para obtener más información, consulte [Upgrade and Update of Availability Group Servers with Minimal Downtime and Data Loss](upgrading-always-on-availability-group-replica-instances.md).</span><span class="sxs-lookup"><span data-stu-id="3f9ec-280">For more information, see [Upgrade and Update of Availability Group Servers with Minimal Downtime and Data Loss](upgrading-always-on-availability-group-replica-instances.md).</span></span>  
  
##  <a name="forced-failover-with-possible-data-loss"></a><a name="ForcedFailover"></a> <span data-ttu-id="3f9ec-281">Conmutación por error forzada (con posible pérdida de datos)</span><span class="sxs-lookup"><span data-stu-id="3f9ec-281">Forced Failover (with Possible Data Loss)</span></span>  
 <span data-ttu-id="3f9ec-282">La acción de forzar una conmutación por error de un grupo de disponibilidad (con posible pérdida de datos) es un método de recuperación ante desastres que permite usar una réplica secundaria como servidor en espera semiactiva. Puesto que forzar la conmutación por error puede suponer una posible pérdida de datos, se debe hacer con precaución y moderación.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-282">Forcing failover of an availability group (with possible data loss) is a disaster recovery method that allows you to use a secondary replica as a warm standby server.Because forcing failover risks possible data loss, it should be used cautiously and sparingly.</span></span> <span data-ttu-id="3f9ec-283">Se recomienza que la conmutación por error solo se fuerce si es necesario restaurar el servicio en las bases de datos de disponibilidad inmediatamente y es aceptable el riesgo de perder algunos datos.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-283">We recommend forcing failover only if you must restore service to your availability databases immediately and are willing to risk losing data.</span></span> <span data-ttu-id="3f9ec-284">Para obtener más información sobre los requisitos previos y las recomendaciones para forzar la conmutación por error y para ver un escenario de ejemplo que usa una conmutación por error forzada para recuperarse de un error grave, vea [Realizar una conmutación por error manual forzada de un grupo de disponibilidad &#40;SQL Server&#41;](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="3f9ec-284">For more information about the prerequisites and recommendations for forcing failover and for an example scenario that uses a forced failover to recover from a catastrophic failure, see [Perform a Forced Manual Failover of an Availability Group &#40;SQL Server&#41;](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md).</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="3f9ec-285">La acción de forzar una conmutación por error requiere que el clúster de WSFC tenga quórum.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-285">Forcing failover requires that the WSFC cluster have quorum.</span></span> <span data-ttu-id="3f9ec-286">Para obtener información sobre cómo configurar y forzar el cuórum, vea [Clústeres de conmutación por error de Windows Server &#40;WSFC&#41; con SQL Server](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="3f9ec-286">For information about configuring quorum and forcing quorum, see [Windows Server Failover Clustering &#40;WSFC&#41; with SQL Server](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md).</span></span>  
  
  
###  <a name="how-forced-failover-works"></a><a name="ForcedFailoverHowWorks"></a> <span data-ttu-id="3f9ec-287">Cómo funciona la conmutación por error forzada</span><span class="sxs-lookup"><span data-stu-id="3f9ec-287">How Forced Failover Works</span></span>  
 <span data-ttu-id="3f9ec-288">Forzar la conmutación por error inicia una migración del rol principal a una réplica de destino cuyo rol está en el estado SECONDARY o RESOLVING.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-288">Forcing failover initiates a transition of the primary role to a target replica whose role is in the SECONDARY or RESOLVING state.</span></span> <span data-ttu-id="3f9ec-289">El destino de la conmutación por error se convierte en la nueva réplica principal y sirve inmediatamente sus copias de las bases de datos a los clientes.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-289">The failover target becomes the new primary replica and immediately serves its copies of the databases to clients.</span></span> <span data-ttu-id="3f9ec-290">Cuando la réplica principal anterior está disponible, realizará la transición al rol secundario y sus bases de datos se convertirán en bases de datos secundarias.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-290">When the former primary replica becomes available, it will transition to the secondary role and its databases will become secondary databases.</span></span>  
  
 <span data-ttu-id="3f9ec-291">Todas las bases de datos secundarias (incluidas las bases de datos principales anteriores cuando están disponibles) cambian al estado SUSPENDED.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-291">All secondary databases (including the former primary databases, when they become available) are SUSPENDED.</span></span> <span data-ttu-id="3f9ec-292">Según el estado de sincronización de datos anterior de una base de datos secundaria suspendida podría ser conveniente para recuperar los datos confirmados que faltan para esa base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-292">Depending on the previous data synchronization state of a suspended secondary database, it might be suitable for salvaging missing committed data for that primary database.</span></span> <span data-ttu-id="3f9ec-293">En una réplica secundaria configurada para el acceso de solo lectura se pueden consultar las bases de datos secundarias para detectar manualmente los datos que faltan.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-293">On a secondary replica that is configured for read-only access, you can query the secondary databases to manually discover missing data.</span></span> <span data-ttu-id="3f9ec-294">A continuación, se pueden emitir instrucciones [!INCLUDE[tsql](../../../includes/tsql-md.md)] en las nuevas bases de datos principales para realizar los cambios necesarios.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-294">Then you can issue [!INCLUDE[tsql](../../../includes/tsql-md.md)] statements on the new primary databases to make any necessary changes.</span></span>  
  
###  <a name="risks-of-forcing-failover"></a><a name="ForcedFailoverRisks"></a> <span data-ttu-id="3f9ec-295">Riesgos de forzar la conmutación por error</span><span class="sxs-lookup"><span data-stu-id="3f9ec-295">Risks of Forcing Failover</span></span>  
 <span data-ttu-id="3f9ec-296">Es esencial tener en cuenta que si se fuerza la conmutación por error se pueden perder datos.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-296">It is essential to understand that forcing failover can cause data loss.</span></span> <span data-ttu-id="3f9ec-297">La pérdida de datos es posible porque la réplica de destino no puede comunicarse con la réplica principal y, por lo tanto, no se puede garantizar que las bases de datos estén sincronizadas.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-297">Data loss is possible because the target replica cannot communicate with the primary replica and, therefore, cannot guarantee that the databases are synchronized.</span></span> <span data-ttu-id="3f9ec-298">Al forzar la conmutación por error se inicia una nueva bifurcación de recuperación.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-298">Forcing failover starts a new recovery fork.</span></span> <span data-ttu-id="3f9ec-299">Puesto que la base de datos principal original y las bases de datos secundarias están en bifurcaciones de recuperación diferentes, cada una de ellas contiene ahora datos que las otras bases de datos no contienen: cada base de datos principal original contiene los cambios que aún no se han enviado desde su cola de envío a la base de datos secundaria anterior (registro sin enviar); las bases de datos secundarias anteriores contienen los cambios que se han producido después de forzar la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-299">Because the original primary databases and secondary databases are on different recovery forks, each of them now contains data that the other database does not contain: each original primary database contains whatever changes were not yet sent from its send queue to the former secondary database (the unsent log); the former secondary databases contain whatever changes occur after failover was forced.</span></span>  
  
 <span data-ttu-id="3f9ec-300">Si la conmutación por error se fuerza debido a que la réplica principal no funcionó, la posible pérdida de datos depende de si no se ha enviado ningún registro de transacciones a la réplica secundaria antes del problema.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-300">If failover is forced because the primary replica has failed, potential data loss is depends on whether any transaction logs had not been sent to the secondary replica before the failure.</span></span> <span data-ttu-id="3f9ec-301">En el modo de confirmación asincrónica, la acumulación del registro sin enviar siempre es una posibilidad.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-301">Under the asynchronous-commit mode, accumulated unsent log is always a possibility.</span></span> <span data-ttu-id="3f9ec-302">En modo de confirmación sincrónica, esto solo es posible hasta que las bases de datos secundarias estén sincronizadas.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-302">Under synchronous-commit mode, this is possible only until the secondary databases becomes synchronized.</span></span>  
  
 <span data-ttu-id="3f9ec-303">En la tabla siguiente se resume la posibilidad de perder datos para una base de datos determinada en la réplica en la que se fuerza la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-303">The following table summarizes the possibility of data loss for a particular database on the replica to which you force failover.</span></span>  
  
|<span data-ttu-id="3f9ec-304">Modo de disponibilidad de una réplica secundaria</span><span class="sxs-lookup"><span data-stu-id="3f9ec-304">Availability mode of Secondary Replica</span></span>|<span data-ttu-id="3f9ec-305">¿Está sincronizada la base de datos?</span><span class="sxs-lookup"><span data-stu-id="3f9ec-305">Is database synchronized?</span></span>|<span data-ttu-id="3f9ec-306">¿Es posible que se pierdan datos?</span><span class="sxs-lookup"><span data-stu-id="3f9ec-306">Is data loss possible?</span></span>|  
|--------------------------------------------|-------------------------------|----------------------------|  
|<span data-ttu-id="3f9ec-307">Confirmación sincrónica</span><span class="sxs-lookup"><span data-stu-id="3f9ec-307">Synchronous-commit</span></span>|<span data-ttu-id="3f9ec-308">Sí</span><span class="sxs-lookup"><span data-stu-id="3f9ec-308">Yes</span></span>|<span data-ttu-id="3f9ec-309">No</span><span class="sxs-lookup"><span data-stu-id="3f9ec-309">No</span></span>|  
|<span data-ttu-id="3f9ec-310">Confirmación sincrónica</span><span class="sxs-lookup"><span data-stu-id="3f9ec-310">Synchronous-commit</span></span>|<span data-ttu-id="3f9ec-311">No</span><span class="sxs-lookup"><span data-stu-id="3f9ec-311">No</span></span>|<span data-ttu-id="3f9ec-312">Sí</span><span class="sxs-lookup"><span data-stu-id="3f9ec-312">Yes</span></span>|  
|<span data-ttu-id="3f9ec-313">Confirmación asincrónica</span><span class="sxs-lookup"><span data-stu-id="3f9ec-313">Asynchronous-commit</span></span>|<span data-ttu-id="3f9ec-314">No</span><span class="sxs-lookup"><span data-stu-id="3f9ec-314">No</span></span>|<span data-ttu-id="3f9ec-315">Sí</span><span class="sxs-lookup"><span data-stu-id="3f9ec-315">Yes</span></span>|  
||||  
  
 <span data-ttu-id="3f9ec-316">Las bases de datos secundarias realizan el seguimiento solo en dos bifurcaciones de recuperación, por lo que, si se realizan varias conmutaciones por error forzadas, no podrá reanudarse ninguna de las bases de datos secundarias que comenzaron la sincronización de datos con la conmutación por error forzada anterior.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-316">Secondary databases track only two recovery forks, so if you perform multiple forced failovers, any secondary database that did start data synchronization with the previous force failover might not be able to resume.</span></span> <span data-ttu-id="3f9ec-317">Si esto se produce, las bases de datos secundarias que no puedan reanudarse tendrán que quitarse del grupo de disponibilidad, restaurarse en el punto de tiempo preciso y unirse de nuevo al grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-317">If this occurs, any secondary databases that cannot be resumed will need to be removed from the availability group, restored to the correct point in time, and rejoined to the availability group.</span></span> <span data-ttu-id="3f9ec-318">Una restauración no funcionará entre varias bifurcaciones de recuperación; por tanto, asegúrese de realizar una copia de seguridad de registros después de realizar varias conmutaciones por error forzadas.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-318">A restore will not work across multiple recovery forks, therefore, be sure to perform a log backup after performing more than one forced failover.</span></span>  
  
###  <a name="why-forced-failover-is-required-after-forcing-quorum"></a><a name="WhyFFoPostForcedQuorum"></a> <span data-ttu-id="3f9ec-319">Por qué se requiere la conmutación por error después de forzar el quórum</span><span class="sxs-lookup"><span data-stu-id="3f9ec-319">Why Forced Failover is Required After Forcing Quorum</span></span>  
 <span data-ttu-id="3f9ec-320">Después de forzar el cuórum en el clúster WSFC (*cuórum forzado*), debe realizarse una conmutación por error forzada (con posible pérdida de datos) en todos los grupos de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-320">After quorum is forced on the WSFC cluster (*forced quorum*) you need to perform a forced failover (with possible data loss) on each availability group.</span></span> <span data-ttu-id="3f9ec-321">La conmutación por error forzada es necesaria porque el estado real de los valores del clúster WSFC puede haberse perdido.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-321">The forced failover is required because the real state of the WSFC cluster values might have been lost.</span></span> <span data-ttu-id="3f9ec-322">Es necesario evitar las conmutaciones por error normales después de un quórum forzado debido a la posibilidad de que una réplica secundaria no sincronizada parezca sincronizada en el clúster WSFC reconfigurado.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-322">Preventing normal failovers after a forced quorum is required because of the possibility than an unsynchronized secondary replica would appear to be synchronized on the reconfigured WSFC cluster.</span></span>  
  
 <span data-ttu-id="3f9ec-323">Por ejemplo, considere la posibilidad de un clúster WSFC que hospeda un grupo de disponibilidad en tres nodos:  el nodo A hospeda la réplica principal y los nodos B y C hospedan una réplica secundaria cada uno.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-323">For example, consider a WSFC cluster that hosts an availability group on three nodes:  Node A hosts the primary replica and Node B and Node C each hosts a secondary replica.</span></span> <span data-ttu-id="3f9ec-324">El nodo C se desconecta del clúster WSFC mientras la réplica secundaria local se sincroniza.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-324">Node C gets disconnected from the WSFC cluster while the local secondary replica is SYNCHRONIZED.</span></span>  <span data-ttu-id="3f9ec-325">Pero los nodos A y B conservan un quórum correcto y el grupo de disponibilidad sigue en línea.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-325">But Node A and Node B retain a healthy quorum and the availability group remains online.</span></span> <span data-ttu-id="3f9ec-326">En el nodo A, la réplica principal continúa aceptando actualizaciones y, en el nodo B, la réplica secundaria continúa sincronizándose con la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-326">On Node A, the primary replica continues to accept updates, and on Node B, the secondary replica continues to synchronize with the primary replica.</span></span> <span data-ttu-id="3f9ec-327">La réplica secundaria del nodo C se desincroniza y se encuentra cada vez más retrasada respecto de la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-327">The secondary replica on Node C becomes unsynchronized and falls increasingly behind the primary replica.</span></span> <span data-ttu-id="3f9ec-328">Sin embargo, debido a que el nodo C está desconectado, la réplica permanece incorrectamente en el estado SYNCHRONIZED.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-328">However, because Node C is disconnected, the replica remains, incorrectly, in the SYNCHRONIZED state.</span></span>  
  
 <span data-ttu-id="3f9ec-329">Si se pierde el quórum y después se fuerza en el nodo A, el estado de sincronización del grupo de disponibilidad del clúster WSFC debería ser correcto y la réplica secundaria del nodo C debería mostrarse como UNSYNCHRONIZED.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-329">If quorum is lost and is then forced on Node A, the synchronization state of the availability group on the WSFC cluster should be correct-with the secondary replica on Node C shown as UNSYNCHRONIZED.</span></span> <span data-ttu-id="3f9ec-330">Sin embargo, si se fuerza el quórum en el nodo C, la sincronización del grupo de disponibilidad será incorrecta.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-330">However, if quorum is forced on Node C, the synchronization of the availability group will be incorrect.</span></span> <span data-ttu-id="3f9ec-331">El estado de sincronización del clúster se habrá revertido al estado que tenía cuando el nodo C estaba desconectado y la réplica secundaria del nodo C se mostraría *incorrectamente* como SYNCHRONIZED.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-331">The synchronization state on the cluster will have reverted back to when Node C was disconnected-with the secondary replica on Node C *incorrectly* shown as SYNCHRONIZED.</span></span> <span data-ttu-id="3f9ec-332">Dado que las conmutaciones por error manuales planeadas garantizan la seguridad de los datos, no están permitidas para poner un grupo de disponibilidad de nuevo en línea después de forzar el quórum.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-332">Since planned manual failovers guarantee the safety of the data, they are disallowed for bring an availability group back online after quorum is forced.</span></span>  
  
###  <a name="tracking-potential-data-loss"></a><a name="TrackPotentialDataLoss"></a> <span data-ttu-id="3f9ec-333">Seguimiento de la posible pérdida de datos</span><span class="sxs-lookup"><span data-stu-id="3f9ec-333">Tracking Potential Data Loss</span></span>  
 <span data-ttu-id="3f9ec-334">Cuando el clúster WSFC tiene un quórum correcto, se puede calcular el potencial actual de pérdida de datos en las bases de datos.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-334">When the WSFC cluster has a healthy quorum, you can estimate the current potential for data loss on databases.</span></span> <span data-ttu-id="3f9ec-335">Para una réplica secundaria dada, el potencial actual de pérdida de datos depende de lo retrasadas que estén las bases de datos secundarias locales respecto de las bases de datos principales correspondientes.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-335">For a given secondary replica, the current potential for data loss depends on how far the local secondary databases are lagging behind the corresponding primary databases.</span></span> <span data-ttu-id="3f9ec-336">Debido a que la cantidad de retardo varía con el tiempo, se recomienda que realice un seguimiento periódico del potencial de pérdida de datos de las bases de datos secundarias no sincronizadas.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-336">Because the amount of lag varies over time, we recommend that you periodically track potential data loss for your unsynchronized secondary databases.</span></span> <span data-ttu-id="3f9ec-337">El seguimiento del retardo implica comparar el Último LSN de confirmación y la Última hora de confirmación de cada base de datos principal y de sus bases de datos secundarias, de la forma siguiente:</span><span class="sxs-lookup"><span data-stu-id="3f9ec-337">Tracking lag involves comparing the Last Commit LSN and Last Commit Time for each primary database and its secondary databases, as follows:</span></span>  
  
1.  <span data-ttu-id="3f9ec-338">Conéctese a la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-338">Connect to the primary replica.</span></span>  
  
2.  <span data-ttu-id="3f9ec-339">Consulte las `last_commit_lsn` columnas (LSN de la última transacción confirmada) y `last_commit_time` (hora de la última confirmación) de la vista de administración dinámica [Sys. dm_hadr_database_replica_states](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="3f9ec-339">Query the `last_commit_lsn` (LSN of the last committed transaction) and `last_commit_time` (time of the last commit) columns of the [sys.dm_hadr_database_replica_states](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql) dynamic management view.</span></span>  
  
3.  <span data-ttu-id="3f9ec-340">Compare los valores devueltos para cada base de datos principal y cada una de sus bases de datos secundarias.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-340">Compare the values returned for each primary database and each of its secondary databases.</span></span> <span data-ttu-id="3f9ec-341">La diferencia entre sus últimos LSN de confirmación indican el tiempo de retardo.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-341">The difference between their Last Commit LSNs indicate the amount of lag.</span></span>  
  
4.  <span data-ttu-id="3f9ec-342">Puede desencadenar una alerta cuando el tiempo de retardo en una base de datos o conjunto de base de datos supere el retardo máximo deseado durante un período de tiempo determinado.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-342">You can trigger an alert when the amount of lag on a database or set of databases exceeds your desired maximum lag for a given period of time.</span></span> <span data-ttu-id="3f9ec-343">Por ejemplo, un trabajo que se ejecute cada minuto en cada base de datos principal puede realizar la consulta.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-343">For example, the query can be run by a job that executes every minute on each primary database.</span></span> <span data-ttu-id="3f9ec-344">Si la diferencia entre la `last_commit_time` de una base de datos principal y cualquiera de sus bases de datos secundarias ha superado el objetivo de punto de recuperación (RPO) (por ejemplo, 5 minutos) desde la última vez que se ejecutó el trabajo, este puede generar una alerta.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-344">If the difference between the `last_commit_time` of a primary database and any of its secondary databases has exceeded the recovery point objective (RPO) (for example, 5 minutes) since the last time the job executed, the job can raise an alert.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="3f9ec-345">Cuando el clúster WSFC carece de quórum o cuando el quórum se ha forzado, `last_commit_lsn` y `last_commit_time` son NULL.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-345">When the WSFC cluster lacks quorum or quorum has been forced, `last_commit_lsn` and `last_commit_time` are NULL.</span></span> <span data-ttu-id="3f9ec-346">Para obtener información sobre cómo podría evitar la pérdida de datos después de forzar el cuórum, vea "Formas posibles de evitar la pérdida de datos después de forzar el cuórum" en [Realizar una conmutación por error manual forzada de un grupo de disponibilidad &#40;SQL Server&#41;](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="3f9ec-346">For information about how you might be able to avoid data loss after you forced quorum, see "Potential Ways to Avoid Data Loss After Quorum is Forced" in [Perform a Forced Manual Failover of an Availability Group &#40;SQL Server&#41;](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md).</span></span>  
  
###  <a name="managing-the-potential-data-loss"></a><a name="ForcedFailoverManagingDataLoss"></a> <span data-ttu-id="3f9ec-347">Administrar la potencial pérdida de datos</span><span class="sxs-lookup"><span data-stu-id="3f9ec-347">Managing the Potential Data Loss</span></span>  
 <span data-ttu-id="3f9ec-348">Después de forzar una conmutación por error, se suspenden todas las bases de datos secundarias.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-348">After failover is forced, all secondary databases are suspended.</span></span> <span data-ttu-id="3f9ec-349">Esto incluye las bases de datos principales antiguas, después de que la réplica principal anterior vuelva a estar en línea y detecte que ahora es una réplica secundaria.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-349">This includes the former primary databases, after the former primary replica comes back online and discovers that it is now a secondary replica.</span></span> <span data-ttu-id="3f9ec-350">Debe reanudar manualmente y de forma individual cada una de las bases de datos suspendidas en cada réplica secundaria.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-350">You must manually resume each suspended database individually on each secondary replica.</span></span>  
  
 <span data-ttu-id="3f9ec-351">Una vez que esté disponible la réplica principal anterior y en el supuesto de que sus bases de datos no estén dañadas, se puede intentar administrar la potencial pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-351">Once the former primary replica is available, assuming that its databases are undamaged, you can attempt to manage the potential data loss.</span></span> <span data-ttu-id="3f9ec-352">El enfoque disponible para administrar la posible pérdida de datos depende de si la réplica principal original se ha conectado a la nueva réplica principal.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-352">The available approach for managing potential data loss depends on whether the original primary replica has connected to the new primary replica.</span></span> <span data-ttu-id="3f9ec-353">Suponiendo que la réplica principal original pueda tener acceso a la nueva instancia principal, la reconexión se produce de forma automática y transparente.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-353">Assuming that the original primary replica can access the new primary instance, reconnecting occurs automatically and transparently.</span></span>  
  
#### <a name="the-original-primary-replica-has-reconnected"></a><span data-ttu-id="3f9ec-354">La réplica principal original se ha vuelto a conectar</span><span class="sxs-lookup"><span data-stu-id="3f9ec-354">The Original Primary Replica Has Reconnected</span></span>  
 <span data-ttu-id="3f9ec-355">Generalmente, después de un problema, cuando la réplica principal original se reinicia, se vuelve a conectar rápidamente a su asociado.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-355">Typically, after a failure, when the original primary replica restarts it quickly reconnects to its partner.</span></span> <span data-ttu-id="3f9ec-356">Al volver a conectarse, la réplica principal original se convierte en la réplica secundaria.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-356">On reconnecting, the original primary replica becomes the secondary replica.</span></span> <span data-ttu-id="3f9ec-357">Las bases de datos se convierten en bases de datos secundarias y entran en estado SUSPENDED.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-357">Its databases becomes the secondary databases and enter the SUSPENDED state.</span></span> <span data-ttu-id="3f9ec-358">Las nuevas bases de datos secundarias no se no se revertirán a menos que se reanuden.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-358">The new secondary databases will not be not rolled back unless you resume them.</span></span>  
  
 <span data-ttu-id="3f9ec-359">Sin embargo, las bases de datos suspendidas son inaccesibles; por lo tanto, no se pueden inspeccionar para evaluar qué datos se perderían si se reanudara una base de datos dada.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-359">However, the suspended databases are inaccessible, so you cannot inspect them to evaluate what data would be lost if you were to resume a given database.</span></span> <span data-ttu-id="3f9ec-360">Por lo tanto, la decisión de si ha de reanudar o quitar una base de datos secundaria depende de si se está dispuesto a aceptar una pérdida de datos, del siguiente modo:</span><span class="sxs-lookup"><span data-stu-id="3f9ec-360">Therefore, the decision on whether to resume or remove a secondary database depends on whether you are willing to accept any data loss, as follows:</span></span>  
  
-   <span data-ttu-id="3f9ec-361">Si una pérdida de datos es inaceptable, debe quitar las bases de datos del grupo de disponibilidad para protegerlas.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-361">If losing any data would be unacceptable, you should remove the databases from the availability group to salvage them.</span></span>  
  
     <span data-ttu-id="3f9ec-362">El administrador de base de datos puede ahora recuperar las bases de datos principales anteriores e intentar recuperar los datos que se habrían perdido.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-362">The database administrator can now recover the former primary databases and attempt to recover the data that would have been lost.</span></span> <span data-ttu-id="3f9ec-363">Sin embargo, cuando una base de datos principal anterior se pone en línea, es divergente de la base de datos principal actual, por lo que el administrador de base de datos debe hacer que la base de datos quitada o la base de datos principal actual no sea accesible a los clientes para evitar la divergencia posterior de las bases de datos y los problemas de conmutación por error del cliente.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-363">However, when a former primary database comes online, it is divergent from the current primary database, so the database administrator needs to make either the removed database or the current primary database inaccessible to clients to avoid further divergence of the databases and to prevent client-failover issues.</span></span>  
  
-   <span data-ttu-id="3f9ec-364">Si la pérdida de datos es aceptable para sus objetivos empresariales, puede reanudar las bases de datos secundarias.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-364">If losing data would be acceptable to your business goals, you can resume the secondary databases.</span></span>  
  
     <span data-ttu-id="3f9ec-365">Al reanudar una nueva base de datos secundaria se produce su reversión como primer paso en su sincronización.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-365">Resuming a new secondary database causes it to be rolled back as the first step in synchronizing the database.</span></span> <span data-ttu-id="3f9ec-366">Si alguna entrada del registro estuviera esperando en la cola de envío en el momento del problema, se perderían las transacciones correspondientes, incluso si se hubieran confirmado.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-366">If any log records were waiting in the send queue at the time of failure, the corresponding transactions are lost, even if they were committed.</span></span>  
  
#### <a name="the-original-primary-replica-has-not-reconnected"></a><span data-ttu-id="3f9ec-367">La réplica principal original no se ha vuelto a conectar</span><span class="sxs-lookup"><span data-stu-id="3f9ec-367">The Original Primary Replica Has Not Reconnected</span></span>  
 <span data-ttu-id="3f9ec-368">Si puede impedir temporalmente que la réplica principal original se vuelva a conectar a través de la red a la nueva réplica principal, puede inspeccionar las bases de datos principales originales para evaluar qué datos se perderían si se reanudaran.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-368">If you can temporarily prevent the original primary replica from reconnecting over the network to the new primary replica, you can inspect the original primary databases to evaluate what data would be lost if they were resumed.</span></span>  
  
-   <span data-ttu-id="3f9ec-369">Si la posible pérdida de datos es aceptable</span><span class="sxs-lookup"><span data-stu-id="3f9ec-369">If the potential data loss is acceptable</span></span>  
  
     <span data-ttu-id="3f9ec-370">Permita que la réplica principal original se vuelva a conectar a la nueva réplica principal.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-370">Allow the original primary replica to reconnect to the new primary replica.</span></span> <span data-ttu-id="3f9ec-371">La acción de volver a conectarse hace que las nuevas bases de datos secundarias se suspendan.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-371">Reconnecting causes the new secondary databases to be suspended.</span></span> <span data-ttu-id="3f9ec-372">Para iniciar la sincronización de datos en una base de datos, solo tiene que reanudarla.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-372">To start data synchronization on a database, simply resume it.</span></span> <span data-ttu-id="3f9ec-373">La nueva réplica secundaria quita la bifurcación de recuperación original para esa base de datos, con lo que se pierden las transacciones que no se han enviado nunca a la réplica secundaria anterior o no se han recibido de ella.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-373">The new secondary replica drops the original recovery fork for that database, losing any transactions that were never sent to or received by the former secondary replica.</span></span>  
  
-   <span data-ttu-id="3f9ec-374">Si la pérdida de datos es inaceptable</span><span class="sxs-lookup"><span data-stu-id="3f9ec-374">If the data loss is unacceptable</span></span>  
  
     <span data-ttu-id="3f9ec-375">Si la base de datos principal original contiene datos esenciales que se perderían si se reanudara la base de datos suspendida, puede preservar los datos de la base de datos principal original quitándola del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-375">If the original primary database contains critical data that would be lost if you resumed the suspended database, you can preserve the data on the original primary database by removing it from the availability group.</span></span> <span data-ttu-id="3f9ec-376">Esto hace que la base de datos entre en estado RESTORING.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-376">This causes the database to enter the RESTORING state.</span></span> <span data-ttu-id="3f9ec-377">Llegados a esta situación, se recomienda intentar realizar una copia de seguridad del final del registro de la base de datos quitada.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-377">At this point, we recommend that you attempt to back up the tail of the removed database's log.</span></span> <span data-ttu-id="3f9ec-378">Después, puede actualizar la base de datos principal actual (base de datos secundaria anterior) exportando los datos que desea proteger de la base de datos principal original e importándolos a la base de datos principal actual.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-378">Then, you can update the current primary (the former secondary database) by exporting the data you want to salvage from the original primary database and importing it into the current primary database.</span></span> <span data-ttu-id="3f9ec-379">Se recomienda realizar una copia de seguridad completa de la base de datos principal actualizada tan pronto como sea posible.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-379">We recommend taking a full database backup of the updated primary database as quickly as possible.</span></span>  
  
     <span data-ttu-id="3f9ec-380">A continuación, en la instancia del servidor que hospeda la nueva réplica secundaria, puede eliminar la base de datos secundaria suspendida y crear una nueva base de datos secundaria restaurando esta copia de seguridad (y al menos una copia de seguridad de registros posterior) utilizando RESTORE WITH NORECOVERY.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-380">Then, on the server instance that hosts the new secondary replica, you can delete the suspended secondary database and create a new secondary database by restoring this backup (and least one subsequent log backup) using RESTORE WITH NORECOVERY.</span></span> <span data-ttu-id="3f9ec-381">Se recomienda retrasar la realización de copias de seguridad de registros adicionales de las bases de datos principales actuales hasta que se reanuden las bases de datos secundarias correspondientes.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-381">We recommend delaying additional log backups of the current primary databases until the corresponding secondary databases are resumed.</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="3f9ec-382">El truncamiento del registro de transacciones se retrasa en una base de datos principal mientras cualquiera de sus bases de datos secundarias está suspendida.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-382">Transaction log truncation is delayed on a primary database while any of its secondary databases is suspended.</span></span> <span data-ttu-id="3f9ec-383">Además, el estado de sincronización de una réplica secundaria de confirmación sincrónica no puede pasar a HEALTHY siempre que alguna base de datos local se suspende.</span><span class="sxs-lookup"><span data-stu-id="3f9ec-383">Also the synchronization health of a synchronous-commit secondary replica cannot transition to HEALTHY as long as any local database remains suspended.</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="3f9ec-384">Tareas relacionadas</span><span class="sxs-lookup"><span data-stu-id="3f9ec-384">Related Tasks</span></span>  
 <span data-ttu-id="3f9ec-385">**Para configurar el comportamiento de la conmutación por error**</span><span class="sxs-lookup"><span data-stu-id="3f9ec-385">**To configure failover behavior**</span></span>  
  
-   [<span data-ttu-id="3f9ec-386">Cambiar el modo de disponibilidad de una réplica de disponibilidad &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="3f9ec-386">Change the Availability Mode of an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-availability-mode-of-an-availability-replica-sql-server.md)  
  
-   [<span data-ttu-id="3f9ec-387">Cambiar el modo de conmutación por error de una réplica de disponibilidad &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="3f9ec-387">Change the Failover Mode of an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-failover-mode-of-an-availability-replica-sql-server.md)  
  
-   [<span data-ttu-id="3f9ec-388">Configure la Directiva de conmutación por error flexible para controlar las condiciones de la conmutación por error automática &#40;Grupos de disponibilidad AlwaysOn&#41;</span><span class="sxs-lookup"><span data-stu-id="3f9ec-388">Configure the Flexible Failover Policy to Control Conditions for Automatic Failover &#40;AlwaysOn Availability Groups&#41;</span></span>](configure-flexible-automatic-failover-policy.md)  
  
 <span data-ttu-id="3f9ec-389">**Para realizar una conmutación por error manual**</span><span class="sxs-lookup"><span data-stu-id="3f9ec-389">**To perform a manual fail over**</span></span>  
  
-   [<span data-ttu-id="3f9ec-390">Realizar una conmutación por error manual planeada de un grupo de disponibilidad &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="3f9ec-390">Perform a Planned Manual Failover of an Availability Group &#40;SQL Server&#41;</span></span>](perform-a-planned-manual-failover-of-an-availability-group-sql-server.md)  
  
-   [<span data-ttu-id="3f9ec-391">Realizar una conmutación por error manual forzada de un grupo de disponibilidad &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="3f9ec-391">Perform a Forced Manual Failover of an Availability Group &#40;SQL Server&#41;</span></span>](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md)  
  
-   [<span data-ttu-id="3f9ec-392">Usar el Asistente para grupo de disponibilidad de conmutación por error &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="3f9ec-392">Use the Fail Over Availability Group Wizard &#40;SQL Server Management Studio&#41;</span></span>](use-the-fail-over-availability-group-wizard-sql-server-management-studio.md)  
  
-   [<span data-ttu-id="3f9ec-393">Administración de inicios de sesión y de trabajos para las bases de datos de un grupo de disponibilidad &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="3f9ec-393">Management of Logins and Jobs for the Databases of an Availability Group &#40;SQL Server&#41;</span></span>](../../logins-and-jobs-for-availability-group-databases.md)  
  
 <span data-ttu-id="3f9ec-394">**Para establecer la configuración de quórum de WSFC**</span><span class="sxs-lookup"><span data-stu-id="3f9ec-394">**To configure WSFC Quorum Configuration**</span></span>  
  
-   [<span data-ttu-id="3f9ec-395">Configurar los valores de NodeWeight de cuórum de clúster</span><span class="sxs-lookup"><span data-stu-id="3f9ec-395">Configure Cluster Quorum NodeWeight Settings</span></span>](../../../sql-server/failover-clusters/windows/configure-cluster-quorum-nodeweight-settings.md)  
  
-   [<span data-ttu-id="3f9ec-396">Ver la configuración de NodeWeight de cuórum de clúster</span><span class="sxs-lookup"><span data-stu-id="3f9ec-396">View Cluster Quorum NodeWeight Settings</span></span>](../../../sql-server/failover-clusters/windows/view-cluster-quorum-nodeweight-settings.md)  
  
-   [<span data-ttu-id="3f9ec-397">Forzar el inicio de un clúster WSFC sin un quórum</span><span class="sxs-lookup"><span data-stu-id="3f9ec-397">Force a WSFC Cluster to Start Without a Quorum</span></span>](../../../sql-server/failover-clusters/windows/force-a-wsfc-cluster-to-start-without-a-quorum.md)  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="3f9ec-398">Contenido relacionado</span><span class="sxs-lookup"><span data-stu-id="3f9ec-398">Related Content</span></span>  
  
-   [<span data-ttu-id="3f9ec-399">Guía de soluciones AlwaysOn de Microsoft SQL Server para lograr alta disponibilidad y recuperación ante desastres</span><span class="sxs-lookup"><span data-stu-id="3f9ec-399">Microsoft SQL Server AlwaysOn Solutions Guide for High Availability and Disaster Recovery</span></span>](https://go.microsoft.com/fwlink/?LinkId=227600)  
  
-   [<span data-ttu-id="3f9ec-400">Blog del equipo de AlwaysOn de SQL Server: el blog del equipo de AlwaysOn oficial de SQL Server</span><span class="sxs-lookup"><span data-stu-id="3f9ec-400">SQL Server AlwaysOn Team Blog: The official SQL Server AlwaysOn Team Blog</span></span>](https://blogs.msdn.com/b/sqlalwayson/)  
  
## <a name="see-also"></a><span data-ttu-id="3f9ec-401">Consulte también</span><span class="sxs-lookup"><span data-stu-id="3f9ec-401">See Also</span></span>  
 <span data-ttu-id="3f9ec-402">[Información general de Grupos de disponibilidad AlwaysOn &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="3f9ec-402">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) </span></span>  
 <span data-ttu-id="3f9ec-403">[Modos de disponibilidad &#40;Grupos de disponibilidad AlwaysOn&#41;](availability-modes-always-on-availability-groups.md) </span><span class="sxs-lookup"><span data-stu-id="3f9ec-403">[Availability Modes &#40;AlwaysOn Availability Groups&#41;](availability-modes-always-on-availability-groups.md) </span></span>  
 <span data-ttu-id="3f9ec-404">[Clústeres de conmutación por error de Windows Server &#40;WSFC&#41; con SQL Server](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="3f9ec-404">[Windows Server Failover Clustering &#40;WSFC&#41; with SQL Server](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md) </span></span>  
 <span data-ttu-id="3f9ec-405">[Transacciones entre bases de datos no admitidas para la creación de reflejo de la base de datos o Grupos de disponibilidad AlwaysOn &#40;SQL Server&#41;](transactions-always-on-availability-and-database-mirroring.md) </span><span class="sxs-lookup"><span data-stu-id="3f9ec-405">[Cross-Database Transactions Not Supported For Database Mirroring or AlwaysOn Availability Groups &#40;SQL Server&#41;](transactions-always-on-availability-and-database-mirroring.md) </span></span>  
 <span data-ttu-id="3f9ec-406">[Directiva de conmutación por error para instancias de clústeres de conmutación por error](../../../sql-server/failover-clusters/windows/failover-policy-for-failover-cluster-instances.md) </span><span class="sxs-lookup"><span data-stu-id="3f9ec-406">[Failover Policy for Failover Cluster Instances](../../../sql-server/failover-clusters/windows/failover-policy-for-failover-cluster-instances.md) </span></span>  
 [<span data-ttu-id="3f9ec-407">Directiva de conmutación por error flexible para conmutación automática por error de un grupo de disponibilidad &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="3f9ec-407">Flexible Failover Policy for Automatic Failover of an Availability Group &#40;SQL Server&#41;</span></span>](flexible-automatic-failover-policy-availability-group.md)  
  
  
