---
title: Transacciones entre bases de datos no admitidas para la creación de reflejo de la base de datos o Grupos de disponibilidad AlwaysOn (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- database mirroring [SQL Server], interoperability
- cross-database transactions [SQL Server]
- transactions [database mirroring]
- Availability Groups [SQL Server], interoperability
- troubleshooting [SQL Server], cross-database transactions
ms.assetid: 9f7ed895-ad65-43e3-ba08-00d7bff1456d
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: a0e23e073375c8f00317003635df8ec0b69883cd
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87750181"
---
# <a name="cross-database-transactions-not-supported-for-database-mirroring-or-alwayson-availability-groups-sql-server"></a><span data-ttu-id="dd557-102">Transacciones entre bases de datos no compatibles para la creación de reflejo de la base de datos o grupos de disponibilidad de AlwaysOn (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="dd557-102">Cross-Database Transactions Not Supported For Database Mirroring or AlwaysOn Availability Groups (SQL Server)</span></span>
  <span data-ttu-id="dd557-103">[!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] y la creación de reflejo de la base de datos no admiten las transacciones entre bases de datos ni las transacciones distribuidas.</span><span class="sxs-lookup"><span data-stu-id="dd557-103">Cross-database transactions and distributed transactions are not supported by [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] or by database mirroring.</span></span> <span data-ttu-id="dd557-104">Esto se debe a que la integridad o la atomicidad de las transacciones no se puede garantizar por las siguientes razones:</span><span class="sxs-lookup"><span data-stu-id="dd557-104">This is because transaction atomicity/integrity cannot be guaranteed for the following reasons:</span></span>  
  
-   <span data-ttu-id="dd557-105">Para las transacciones entre bases de datos: cada base de datos se confirma independientemente.</span><span class="sxs-lookup"><span data-stu-id="dd557-105">For cross-database transactions: Each database commits independently.</span></span> <span data-ttu-id="dd557-106">Por consiguiente, incluso para las bases de datos de un solo grupo de disponibilidad, podría producirse una conmutación por error después de que una base de datos confirme una transacción, pero antes de que lo haga la otra.</span><span class="sxs-lookup"><span data-stu-id="dd557-106">Therefore, even for databases in a single availability group, a failover could occur after one database commits a transaction but before the other database does.</span></span> <span data-ttu-id="dd557-107">Para la creación de reflejo de la base de datos este problema puede agravarse porque, después de una conmutación por error, la base de datos reflejada está normalmente en una instancia del servidor diferente al de la otra base de datos, e incluso si ambas bases de datos se reflejan entre los dos mismos asociados, no existe ninguna garantía de que ambas bases de datos se conmutarán por error al mismo tiempo.</span><span class="sxs-lookup"><span data-stu-id="dd557-107">For database mirroring this issue is compounded because after a failover, the mirrored database is typically on a different server instance from the other database, and  even if both databases are mirrored between the same two partners, there is no guarantee that both databases will fail over at the same time.</span></span>  
  
-   <span data-ttu-id="dd557-108">Para las transacciones distribuidas: después de una conmutación por error, el nuevo servidor principal o la nueva réplica principal no puede conectarse al coordinador de transacciones distribuidas en el servidor principal o la réplica principal anterior.</span><span class="sxs-lookup"><span data-stu-id="dd557-108">For distributed transactions: After a failover, the new principal server/primary replica is unable to connect to the distributed transaction coordinator on the previous principal server/primary replica.</span></span> <span data-ttu-id="dd557-109">Por lo tanto, el nuevo servidor principal o la nueva réplica principal no puede obtener el estado de la transacción.</span><span class="sxs-lookup"><span data-stu-id="dd557-109">Therefore, the new principal server/primary replica cannot obtain the transaction status.</span></span>  
  
 <span data-ttu-id="dd557-110">En el siguiente ejemplo de creación de reflejo de la base de datos se muestra cómo podría producirse una incoherencia lógica.</span><span class="sxs-lookup"><span data-stu-id="dd557-110">The following database mirroring example illustrates how a logical inconsistency could occur.</span></span> <span data-ttu-id="dd557-111">En este ejemplo, una aplicación utiliza una transacción entre bases de datos para insertar dos filas de datos: una fila se inserta en una tabla de una base de datos reflejada, A, y la otra fila se inserta en una tabla de otra base de datos, B. La base de datos A se está reflejando en modo de alta seguridad con conmutación automática por error.</span><span class="sxs-lookup"><span data-stu-id="dd557-111">In this example, an application uses a cross-database transaction to insert two rows of data: one row is inserted into a table in a mirrored database, A, and the other row is inserted into a table in another database, B. Database A is being mirrored in high-safety mode with automatic failover.</span></span> <span data-ttu-id="dd557-112">Mientras la transacción se confirma, la base de datos A deja de estar disponible y la sesión de creación de reflejo se conmuta por error automáticamente al reflejo de la base de datos A.</span><span class="sxs-lookup"><span data-stu-id="dd557-112">While the transaction is being committed, database A becomes unavailable, and the mirroring session automatically fails over to the mirror of database A.</span></span>  
  
 <span data-ttu-id="dd557-113">Después de la conmutación por error, la transacción entre bases de datos podría confirmarse correctamente en la base de datos B, pero no en la base de datos conmutada por error.</span><span class="sxs-lookup"><span data-stu-id="dd557-113">After the failover, the cross-database transaction might be successfully committed on database B but not on the failed-over database.</span></span> <span data-ttu-id="dd557-114">Esto se produciría si el servidor principal original de la base de datos A no hubiese enviado el registro de transacciones entre bases de datos al servidor reflejado antes del error.</span><span class="sxs-lookup"><span data-stu-id="dd557-114">This would occur if the original principal server for database A had not sent the log for the cross-database transaction to the mirror server before the failure.</span></span> <span data-ttu-id="dd557-115">Después de la conmutación por error, esa transacción no existiría en el nuevo servidor principal.</span><span class="sxs-lookup"><span data-stu-id="dd557-115">After the failover, that transaction would not exist on the new principal server.</span></span> <span data-ttu-id="dd557-116">Las bases de datos A y B se volverían incoherentes porque los datos insertados en la base de datos B se mantienen intactos, pero los datos insertados en la base de datos A se pierden.</span><span class="sxs-lookup"><span data-stu-id="dd557-116">Databases A and B would become inconsistent, because the data inserted in database B remains intact, but the data inserted in database A has been lost.</span></span>  
  
 <span data-ttu-id="dd557-117">Su puede producir un escenario similar cuando se usa una transacción de MS DTC.</span><span class="sxs-lookup"><span data-stu-id="dd557-117">A similar scenario can occur while using a MS DTC transaction.</span></span> <span data-ttu-id="dd557-118">Por ejemplo, después de la conmutación por error, el nuevo servidor principal contacta con MS DTC.</span><span class="sxs-lookup"><span data-stu-id="dd557-118">For example, after failover, the new principal contacts MS DTC.</span></span> <span data-ttu-id="dd557-119">Sin embargo, MS DTC.no tiene conocimiento del nuevo servidor principal y termina las transacciones que están "preparadas para confirmar" y que otras bases de datos consideran confirmadas.</span><span class="sxs-lookup"><span data-stu-id="dd557-119">But MS DTC has no knowledge of the new principal server, and it terminates any transactions that are "preparing to commit," which are considered committed in other databases.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="dd557-120">El uso de creación de reflejo de la base de datos o de grupos de disponibilidad junto con DTC no da como resultado una instalación no admitida de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="dd557-120">Using Database Mirroring or Availability Groups together with DTC does not result in an unsupported SQL Server installation.</span></span> <span data-ttu-id="dd557-121">Sin embargo, si una base de datos forma parte de una sesión de creación de reflejo de la base de datos o de un grupo de disponibilidad y también se usa DTC en la base de datos, Microsoft solo investigará los problemas de compatibilidad si no están relacionados con el uso combinado de creación de reflejo de la base de datos o de grupos de disponibilidad con DTC.</span><span class="sxs-lookup"><span data-stu-id="dd557-121">If, however, a database is part of a Database Mirroring session or an Availability Group and DTC is also used in the database, support issues will be investigated by Microsoft only if unrelated to the combined use of Database Mirroring or Availability Groups with DTC.</span></span>  
  
  
