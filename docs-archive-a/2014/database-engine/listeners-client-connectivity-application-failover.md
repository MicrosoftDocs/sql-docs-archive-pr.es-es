---
title: Agentes de escucha del grupo de disponibilidad, conectividad de cliente y conmutación por error de aplicaciones (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- Availability Groups [SQL Server], listeners
- read-only routing
- read-intent connections [AlwaysOn Availability Groups]
- Availability Groups [SQL Server], configuring
- Availability Groups [SQL Server], read-only routing
- Availability Groups [SQL Server], client connectivity
ms.assetid: 76fb3eca-6b08-4610-8d79-64019dd56c44
author: rothja
ms.author: jroth
ms.openlocfilehash: f66046625ca0078904e9555d1cf586873b9f697f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/04/2020
ms.locfileid: "87745395"
---
# <a name="availability-group-listeners-client-connectivity-and-application-failover-sql-server"></a><span data-ttu-id="d1dab-102">Agentes de escucha del grupo de disponibilidad, conectividad de cliente y conmutación por error de una aplicación (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="d1dab-102">Availability Group Listeners, Client Connectivity, and Application Failover (SQL Server)</span></span>
  <span data-ttu-id="d1dab-103">Este tema contiene información acerca de las consideraciones de conectividad del cliente de [!INCLUDE[ssHADR](../includes/sshadr-md.md)] y la funcionalidad de conmutación por error de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="d1dab-103">This topic contains information about considerations for [!INCLUDE[ssHADR](../includes/sshadr-md.md)] client connectivity and application-failover functionality.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d1dab-104">Para la mayoría de las configuraciones habituales de agente de escucha, puede crear el primer agente de escucha del grupo de disponibilidad utilizando simplemente instrucciones [!INCLUDE[tsql](../includes/tsql-md.md)] o cmdlets de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="d1dab-104">For the majority of the common listener configurations, you can create the first availability group listener simply by using [!INCLUDE[tsql](../includes/tsql-md.md)] statements or PowerShell cmdlets.</span></span> <span data-ttu-id="d1dab-105">Para obtener más información, vea [Tareas relacionadas](#RelatedTasks), más adelante en este mismo tema.</span><span class="sxs-lookup"><span data-stu-id="d1dab-105">For more information, see [Related Tasks](#RelatedTasks), later in this topic.</span></span>  
  
 
  
##  <a name="availability-group-listeners"></a><a name="AGlisteners"></a> <span data-ttu-id="d1dab-106">Agentes de escucha del grupo de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="d1dab-106">Availability Group Listeners</span></span>  
 <span data-ttu-id="d1dab-107">Puede proporcionar conectividad de cliente a la base de datos de un grupo de disponibilidad determinado mediante la creación de un agente de escucha del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="d1dab-107">You can provide client connectivity to the database of a given availability group by creating an availability group listener.</span></span> <span data-ttu-id="d1dab-108">Un agente de escucha de grupo de disponibilidad es un nombre de red virtual (VNN) al que los clientes pueden conectarse para tener acceso a una base de datos situada en una réplica principal o secundaria de un grupo de disponibilidad AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="d1dab-108">An availability group listener is a virtual network name (VNN) to which clients can connect in order to access a database in a primary or secondary replica of an AlwaysOn availability group.</span></span> <span data-ttu-id="d1dab-109">Los agentes de escucha del grupo de disponibilidad permiten a los clientes conectarse a una réplica de disponibilidad sin conocer el nombre de la instancia física de SQL Server a la que se están conectando.</span><span class="sxs-lookup"><span data-stu-id="d1dab-109">An availability group listener enables a client to connect to an availability replica without knowing the name of the physical instance of SQL Server to which the client is connecting.</span></span>  <span data-ttu-id="d1dab-110">No hay necesidad de modificar la cadena de conexión del cliente para conectarse a la ubicación actual de la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="d1dab-110">The client connection string does not need to be modified to connect to the current location of the current primary replica.</span></span>  
  
 <span data-ttu-id="d1dab-111">Un agente de escucha de grupo de disponibilidad se compone de un nombre de agente de escucha del Sistema de nombres de dominio (DNS), de una designación de puerto de agente de escucha y de una o varias direcciones IP.</span><span class="sxs-lookup"><span data-stu-id="d1dab-111">An availability group listener consists of a Domain Name System (DNS) listener name, listener port designation, and one or more IP addresses.</span></span> <span data-ttu-id="d1dab-112">Solo el protocolo TCP es compatible con el agente de escucha del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="d1dab-112">Only the TCP protocol is supported by availability group listener.</span></span>  <span data-ttu-id="d1dab-113">El nombre DNS del agente de escucha también debe ser único en el dominio y en NetBIOS.</span><span class="sxs-lookup"><span data-stu-id="d1dab-113">The DNS name of the listener must also be unique in the domain and in NetBIOS.</span></span>  <span data-ttu-id="d1dab-114">Cuando se crea un nuevo agente de escucha del grupo de disponibilidad, se convierte en un recurso en un clúster con un nombre de red virtual (VNN), una dirección IP virtual (VIP) y una dependencia de grupo de disponibilidad asociados.</span><span class="sxs-lookup"><span data-stu-id="d1dab-114">When you create a new availability group listener it becomes a resource in a cluster with an associated virtual network name (VNN), virtual IP (VIP), and availability group dependency.</span></span> <span data-ttu-id="d1dab-115">Un cliente utiliza DNS para resolver VNN en varias direcciones IP y después intenta conectarse a cada dirección hasta que una solicitud de conexión tiene éxito o hasta que se agota el tiempo de espera de las solicitudes de conexión.</span><span class="sxs-lookup"><span data-stu-id="d1dab-115">A client uses DNS to resolve the VNN into multiple IP addresses and then tries to connect to each address, until a connection request succeeds or until the connection requests time out.</span></span>  
  
 <span data-ttu-id="d1dab-116">Si el enrutamiento de solo lectura se configura para una o varias[réplicas secundarias legibles](availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md), las conexiones cliente de intento de lectura dirigidas a la réplica principal se redirigen a una réplica secundaria legible.</span><span class="sxs-lookup"><span data-stu-id="d1dab-116">If read-only routing is configured for one or more[readable secondary replicas](availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md), read-intent client connections to the primary replica are redirected to a readable secondary replica.</span></span> <span data-ttu-id="d1dab-117">Asimismo, si la réplica principal se queda sin conexión en una instancia de SQL Server y se pone en línea una nueva réplica principal en otra instancia de SQL Server, el agente de escucha del grupo de disponibilidad permite a los clientes conectarse a la nueva réplica principal.</span><span class="sxs-lookup"><span data-stu-id="d1dab-117">Also, if the primary replica goes offline on one instance of SQL Server, and a new primary replica comes online on another instance of SQL Server, the availability group listener enables clients to connect to the new primary replica.</span></span>  
  
 <span data-ttu-id="d1dab-118">Para obtener información esencial sobre los agentes de escucha del grupo de disponibilidad, vea [Crear o configurar un agente de escucha de grupo de disponibilidad &#40;SQL Server&#41;](availability-groups/windows/create-or-configure-an-availability-group-listener-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="d1dab-118">For essential information about availability group listeners, see [Create or Configure an Availability Group Listener &#40;SQL Server&#41;](availability-groups/windows/create-or-configure-an-availability-group-listener-sql-server.md).</span></span>  
  
 
  
###  <a name="availability-group-listener-configuration"></a><a name="AGlConfig"></a> <span data-ttu-id="d1dab-119">Configuración de agentes de escucha del grupo de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="d1dab-119">Availability Group Listener Configuration</span></span>  
 <span data-ttu-id="d1dab-120">Un agente de escucha del grupo de disponibilidad se define por lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="d1dab-120">An availability group listener is defined by the following:</span></span>  
  
 <span data-ttu-id="d1dab-121">Nombre DNS único</span><span class="sxs-lookup"><span data-stu-id="d1dab-121">A unique DNS name</span></span>  
 <span data-ttu-id="d1dab-122">Esto también se conoce como Nombre de red virtual (VNN).</span><span class="sxs-lookup"><span data-stu-id="d1dab-122">This is also known as a Virtual Network Name (VNN).</span></span> <span data-ttu-id="d1dab-123">Se aplican las reglas de nomenclatura de Active Directory para los nombres de host DNS.</span><span class="sxs-lookup"><span data-stu-id="d1dab-123">Active Directory naming rules for DNS host names apply.</span></span> <span data-ttu-id="d1dab-124">Para obtener más información, vea el artículo de KB [Convenciones de nomenclatura en Active Directory para equipos, dominios, sitios y unidades organizativas](https://support.microsoft.com/kb/909264) .</span><span class="sxs-lookup"><span data-stu-id="d1dab-124">For more information, see the [Naming conventions in Active Directory for computers, domains, sites, and OUs](https://support.microsoft.com/kb/909264) KB article.</span></span>  
  
 <span data-ttu-id="d1dab-125">Una o varias direcciones IP virtuales (VIP)</span><span class="sxs-lookup"><span data-stu-id="d1dab-125">One or more Virtual IP addresses (VIPs)</span></span>  
 <span data-ttu-id="d1dab-126">Las direcciones VIP se configuran para una o varias subredes en las que el grupo de disponibilidad puede realizar la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="d1dab-126">VIPs are configured for one or more subnets to which the availability group can failover.</span></span>  
  
 <span data-ttu-id="d1dab-127">Configuración de dirección IP</span><span class="sxs-lookup"><span data-stu-id="d1dab-127">IP address configuration</span></span>  
 <span data-ttu-id="d1dab-128">Para un agente de escucha determinado del grupo de disponibilidad, la dirección IP usa el Protocolo de configuración dinámica de host (DHCP) o una o varias direcciones IP estáticas.</span><span class="sxs-lookup"><span data-stu-id="d1dab-128">For a given availability group listener, the IP address uses either Dynamic Host Configuration Protocol (DHCP) or one or more static IP addresses.</span></span>  
  
-   <span data-ttu-id="d1dab-129">Protocolo de configuración dinámica de host (DHCP)</span><span class="sxs-lookup"><span data-stu-id="d1dab-129">Dynamic Host Configuration Protocol (DHCP)</span></span>  
  
     <span data-ttu-id="d1dab-130">Si un grupo de disponibilidad reside en una sola subred, puede configurar todas las direcciones IP del agente de escucha del grupo de disponibilidad para usar DHCP.</span><span class="sxs-lookup"><span data-stu-id="d1dab-130">If an availability group resides on a single subnet, you can configure all the availability group listener IP addresses to use DHCP.</span></span> <span data-ttu-id="d1dab-131">En los entornos de preproducción, DHCP proporciona una instalación fácil para un grupo de disponibilidad que no requiera recuperación ante desastres en un sitio remoto en una subred independiente.</span><span class="sxs-lookup"><span data-stu-id="d1dab-131">For pre-production environments, DHCP offers an easy setup for an availability group that does not require disaster recovery to a remote site on a separate subnet.</span></span> <span data-ttu-id="d1dab-132">Sin embargo, no se debe usar DHCP junto con un agente de escucha del grupo de disponibilidad en un entorno de producción.</span><span class="sxs-lookup"><span data-stu-id="d1dab-132">However, you should not use DHCP in conjunction with an availability group listener in a production environment.</span></span> <span data-ttu-id="d1dab-133">Esto se debe a que, en caso de tiempo de inactividad, si expira el tiempo de concesión de la dirección de IP de DHCP, se necesitará un tiempo adicional para volver a registrar la nueva dirección IP de DHCP asociada al nombre DNS del agente de escucha.</span><span class="sxs-lookup"><span data-stu-id="d1dab-133">This is because, in the event of down time, if the DHCP IP lease expires, extra time is required to re-register the new DHCP IP address associated with the listener DNS name.</span></span> <span data-ttu-id="d1dab-134">El tiempo adicional producirá un error de conexión del cliente.</span><span class="sxs-lookup"><span data-stu-id="d1dab-134">The extra time will cause client-connection failure.</span></span>  
  
-   <span data-ttu-id="d1dab-135">Direcciones IP estáticas</span><span class="sxs-lookup"><span data-stu-id="d1dab-135">Static IP addresses</span></span>  
  
     <span data-ttu-id="d1dab-136">En los entornos de producción, se recomienda que los agentes de escucha del grupo de disponibilidad usen direcciones IP estáticas.</span><span class="sxs-lookup"><span data-stu-id="d1dab-136">In production environments, we recommend that availability group listeners use static IP addresses.</span></span> <span data-ttu-id="d1dab-137">Además, en los casos donde los grupos de disponibilidad se extienden a través de subredes en un dominio de varias subredes, un agente de escucha del grupo de disponibilidad debe usar direcciones IP estáticas.</span><span class="sxs-lookup"><span data-stu-id="d1dab-137">Furthermore, where availability groups extend across subnets in a multi-subnet domain, an availability group listener must use static IP addresses.</span></span>  
  
 <span data-ttu-id="d1dab-138">Las configuraciones de red híbridas y DHCP en subredes no se admiten para los agentes de escucha del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="d1dab-138">Hybrid network configurations and DHCP across subnets are not supported for availability group listeners.</span></span> <span data-ttu-id="d1dab-139">Esto se debe a que cuando se produce una conmutación por error, una dirección IP dinámica puede expirar o lanzarse, con lo que se compromete la alta disponibilidad total.</span><span class="sxs-lookup"><span data-stu-id="d1dab-139">This is because when a failover happens, a dynamic IP might expire or be released, which jeopardizes overall high availability.</span></span>  
  
###  <a name="selecting-an-availability-group-listener-port"></a><a name="SelectListenerPort"></a> <span data-ttu-id="d1dab-140">Seleccionar un puerto de agentes de escucha del grupo de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="d1dab-140">Selecting an Availability Group Listener Port</span></span>  
 <span data-ttu-id="d1dab-141">Al configurar un agente de escucha del grupo de disponibilidad, debe designar un puerto.</span><span class="sxs-lookup"><span data-stu-id="d1dab-141">When configuring an availability group listener, you must designate a port.</span></span>  <span data-ttu-id="d1dab-142">Puede configurar el puerto predeterminado en 1433 para permitir la sencillez de las cadenas de conexión de cliente.</span><span class="sxs-lookup"><span data-stu-id="d1dab-142">You can configure the default port to 1433 in order to allow for simplicity of the client connection strings.</span></span> <span data-ttu-id="d1dab-143">Si utiliza 1433, no necesita indicar un número de puerto en una cadena de conexión.</span><span class="sxs-lookup"><span data-stu-id="d1dab-143">If using 1433, you do not need to designate a port number in a connection string.</span></span>   <span data-ttu-id="d1dab-144">Además, puesto que cada agente de escucha del grupo de disponibilidad tendrá un nombre de red virtual independiente, cada agente de escucha del grupo de disponibilidad configurado en un único WSFC se puede configurar para hacer referencia al mismo puerto predeterminado 1433.</span><span class="sxs-lookup"><span data-stu-id="d1dab-144">Also, since each availability group listener will have a separate virtual network name, each availability group listener configured on a single WSFC can be configured to reference the same default port of 1433.</span></span>  
  
 <span data-ttu-id="d1dab-145">También puede diseñar un puerto de agente de escucha no estándar, aunque esto significa que también necesitará especificar explícitamente un puerto de destino en la cadena de conexión cada vez que se conecte al agente de escucha del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="d1dab-145">You can also designate a non-standard listener port; however this means that you will also need to explicitly specify a target port in your connection string whenever connecting to the availability group listener.</span></span>  <span data-ttu-id="d1dab-146">También necesitará abrir permiso en el firewall para el puerto no estándar.</span><span class="sxs-lookup"><span data-stu-id="d1dab-146">You will also need to open permission on the firewall for the non-standard port.</span></span>  
  
 <span data-ttu-id="d1dab-147">Si utiliza el puerto predeterminado 1433 para los VNN del agente de escucha del grupo de disponibilidad, seguirá siendo necesario asegurarse de que ningún otro servicio en el nodo de clúster esté utilizando este puerto; de lo contrario, se produciría un conflicto de puerto.</span><span class="sxs-lookup"><span data-stu-id="d1dab-147">If you use the default port of 1433 for availability group listener VNNs, you will still need to ensure that no other services on the cluster node are using this port; otherwise this would cause a port conflict.</span></span>  
  
 <span data-ttu-id="d1dab-148">Si una de las instancias de SQL Server ya está escuchando en el puerto TCP 1433 a través del agente de escucha de la instancia y no hay otros servicios (incluidas las instancias adicionales de SQL Server) en el equipo que escuchen en el puerto 1433, no se producirá un conflicto de puerto con el agente de escucha del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="d1dab-148">If one of the instances of SQL Server is already listening on TCP port 1433 via the instance listener and there are no other services (including additional instances of SQL Server) on the computer listening on port 1433, this will not cause a port conflict with the availability group listener.</span></span>  <span data-ttu-id="d1dab-149">Esto se debe a que el agente de escucha del grupo de disponibilidad puede compartir el mismo puerto TCP en el mismo proceso del servicio.</span><span class="sxs-lookup"><span data-stu-id="d1dab-149">This is because the availability group listener can share the same TCP port inside the same service process.</span></span>  <span data-ttu-id="d1dab-150">Sin embargo, no se deben configurar varias instancias de SQL Server (en paralelo) para escuchar en el mismo puerto.</span><span class="sxs-lookup"><span data-stu-id="d1dab-150">However multiple instances of SQL Server (side-by-side)should not be configured to listen on the same port.</span></span>  
  
##  <a name="using-a-listener-to-connect-to-the-primary-replica"></a><a name="ConnectToPrimary"></a><span data-ttu-id="d1dab-151">Usar un agente de escucha para conectarse a la réplica principal</span><span class="sxs-lookup"><span data-stu-id="d1dab-151">Using a Listener to Connect to the Primary Replica</span></span>  
 <span data-ttu-id="d1dab-152">Para usar un agente de escucha del grupo de disponibilidad y conectarse a la réplica principal para acceso de lectura/escritura, la cadena de conexión especifica el nombre DNS del agente de escucha del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="d1dab-152">To use an availability group listener to connect to the primary replica for read-write access, the connection string specifies the availability group listener DNS name.</span></span>  <span data-ttu-id="d1dab-153">Si una réplica principal del grupo de disponibilidad cambia a una nueva réplica, las conexiones existentes que usan un nombre de red del agente de escucha del grupo de disponibilidad se desconectarán.</span><span class="sxs-lookup"><span data-stu-id="d1dab-153">If an availability group primary replica changes to a new replica, existing connections that use an availability group listener's network name are disconnected.</span></span>  <span data-ttu-id="d1dab-154">Las nuevas conexiones al agente de escucha del grupo de disponibilidad se dirigen a la nueva réplica principal.</span><span class="sxs-lookup"><span data-stu-id="d1dab-154">New connections to the availability group listener are then directed to the new primary replica.</span></span> <span data-ttu-id="d1dab-155">El siguiente es un ejemplo de una cadena de conexión básica para el proveedor ADO.NET (System.Data.SqlClient):</span><span class="sxs-lookup"><span data-stu-id="d1dab-155">An example of a basic connection string for the ADO.NET provider (System.Data.SqlClient) is as follows:</span></span>  
  
```  
Server=tcp: AGListener,1433;Database=MyDB;IntegratedSecurity=SSPI  
```  
  
 <span data-ttu-id="d1dab-156">Puede seguir eligiendo hacer referencia directamente a la instancia de SQL Server de las réplicas principal o secundaria en lugar de utilizar el nombre del servidor del agente de escucha del grupo de disponibilidad; sin embargo, si decide realizar esta acción, perderá la ventaja que supone dirigir automáticamente las nuevas conexiones a la réplica principal actual.</span><span class="sxs-lookup"><span data-stu-id="d1dab-156">You can still choose to directly reference the instance of SQL Server name of the primary or secondary replicas instead of using the availability group listener server name, however if you choose to do so you will lose the benefit of new connections being directed automatically to the current primary replica.</span></span>  <span data-ttu-id="d1dab-157">También perderá la ventaja del enrutamiento de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="d1dab-157">You will also lose the benefit of read-only routing.</span></span>  
  
##  <a name="using-a-listener-to-connect-to-a-read-only-secondary-replica-read-only-routing"></a><a name="ConnectToSecondary"></a> <span data-ttu-id="d1dab-158">Usar un agente de escucha para conectarse a una réplica secundaria de solo lectura (enrutamiento de solo lectura)</span><span class="sxs-lookup"><span data-stu-id="d1dab-158">Using a Listener to Connect to a Read-Only Secondary Replica (Read-Only Routing)</span></span>  
 <span data-ttu-id="d1dab-159">El*enrutamiento de solo lectura* se refiere a la capacidad de [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] de enrutar las conexiones entrantes a un agente de escucha de grupo de disponibilidad a una réplica secundaria configurada para permitir las cargas de trabajo de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="d1dab-159">*Read-only routing* refers to the ability of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] to route incoming connections to an availability group listener to a secondary replica that is configured to allow read-only workloads.</span></span> <span data-ttu-id="d1dab-160">Una conexión entrante que hace referencia al nombre de un agente de escucha del grupo de disponibilidad se puede enrutar automáticamente a una réplica de solo lectura si se cumple lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="d1dab-160">An incoming connection referencing an availability group listener name can automatically be routed to a read-only replica if the following are true:</span></span>  
  
-   <span data-ttu-id="d1dab-161">Al menos una réplica secundaria se establece para acceso de solo lectura, y cada réplica secundaria de solo lectura y la réplica principal se configuran para admitir el enrutamiento de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="d1dab-161">At least one secondary replica is set to read-only access, and each read-only secondary replica and the primary replica are configured to support read-only routing.</span></span> <span data-ttu-id="d1dab-162">Para obtener más información, vea [Para configurar réplicas de disponibilidad para el enrutamiento de solo lectura](#ConfigureARsForROR), más adelante en esta sección.</span><span class="sxs-lookup"><span data-stu-id="d1dab-162">For more information, see [To Configure Availability Replicas for Read-Only Routing](#ConfigureARsForROR), later in this section.</span></span>  
  
-   <span data-ttu-id="d1dab-163">La cadena de conexión hace referencia a un agente de escucha de grupo de disponibilidad y la intención de aplicaciones de la conexión entrante se establece en solo lectura (por ejemplo, al usar la palabra clave **Application Intent=ReadOnly** en las cadenas de conexión, los atributos de conexión o las propiedades de ODBC u OLEDB).</span><span class="sxs-lookup"><span data-stu-id="d1dab-163">The connection string references an availability group listener, and the application intent of the incoming connection is set to read-only (for example, by using the **Application Intent=ReadOnly** keyword in the ODBC or OLEDB connection strings or connection attributes or properties).</span></span> <span data-ttu-id="d1dab-164">Para obtener más información, vea [Intención de aplicación de solo lectura y enrutamiento de solo lectura](#ReadOnlyAppIntent), más adelante en esta sección.</span><span class="sxs-lookup"><span data-stu-id="d1dab-164">For more information, see [Read-Only Application Intent and Read-Only Routing](#ReadOnlyAppIntent), later in this section.</span></span>  
  
###  <a name="to-configure-availability-replicas-for-read-only-routing"></a><a name="ConfigureARsForROR"></a> <span data-ttu-id="d1dab-165">Para configurar réplicas de disponibilidad para el enrutamiento de solo lectura</span><span class="sxs-lookup"><span data-stu-id="d1dab-165">To Configure Availability Replicas for Read-Only Routing</span></span>  
 <span data-ttu-id="d1dab-166">Un administrador de base de datos debe configurar las réplicas de disponibilidad del siguiente modo:</span><span class="sxs-lookup"><span data-stu-id="d1dab-166">A database administrator must configure the availability replicas as follows:</span></span>  
  
1.  <span data-ttu-id="d1dab-167">Para cada réplica de disponibilidad que desee configurar como réplica secundaria legible, un administrador de base de datos debe configurar los valores siguientes, que tienen efecto solo en el rol secundario:</span><span class="sxs-lookup"><span data-stu-id="d1dab-167">For each availability replica that you want to configure as a readable secondary replica, a database administrator must configure the following settings, which take effect only under the secondary role:</span></span>  
  
    -   <span data-ttu-id="d1dab-168">El acceso de conexión debe establecerse en "todo" o "solo lectura".</span><span class="sxs-lookup"><span data-stu-id="d1dab-168">Connection access must be set to "all" or "read only".</span></span>  
  
    -   <span data-ttu-id="d1dab-169">Se debe especificar la dirección URL de enrutamiento de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="d1dab-169">The read-only routing URL must be specified.</span></span>  
  
2.  <span data-ttu-id="d1dab-170">Para cada una de estas réplicas, se debe especificar una lista de enrutamiento de solo lectura para el rol principal.</span><span class="sxs-lookup"><span data-stu-id="d1dab-170">For each of these replicas, a read-only routing list must be specified for the primary role.</span></span> <span data-ttu-id="d1dab-171">Especifique uno o varios nombres de servidor como destinos de enrutamiento.</span><span class="sxs-lookup"><span data-stu-id="d1dab-171">Specify one or more server names as routing targets.</span></span>  
  
####  <a name="related-tasks"></a><a name="RelatedTasksROR"></a> <span data-ttu-id="d1dab-172">Tareas relacionadas</span><span class="sxs-lookup"><span data-stu-id="d1dab-172">Related Tasks</span></span>  
  
-   [<span data-ttu-id="d1dab-173">Configurar el acceso de solo lectura en una réplica de disponibilidad &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d1dab-173">Configure Read-Only Access on an Availability Replica &#40;SQL Server&#41;</span></span>](availability-groups/windows/configure-read-only-access-on-an-availability-replica-sql-server.md)  
  
-   [<span data-ttu-id="d1dab-174">Configurar el enrutamiento de solo lectura para un grupo de disponibilidad &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d1dab-174">Configure Read-Only Routing for an Availability Group &#40;SQL Server&#41;</span></span>](availability-groups/windows/configure-read-only-routing-for-an-availability-group-sql-server.md)  
  
###  <a name="read-only-application-intent-and-read-only-routing"></a><a name="ReadOnlyAppIntent"></a><span data-ttu-id="d1dab-175">Intención de aplicación de solo lectura y enrutamiento de solo lectura</span><span class="sxs-lookup"><span data-stu-id="d1dab-175">Read-Only Application Intent and Read-Only Routing</span></span>  
 <span data-ttu-id="d1dab-176">La propiedad de la cadena de conexión de la intención de aplicación expresa la solicitud de la aplicación cliente de ser dirigida a una versión de lectura y escritura, o de solo lectura, de una base de datos del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="d1dab-176">The application intent connection string property expresses the client application's request to be directed either to a read-write or read-only version of an availability group database.</span></span> <span data-ttu-id="d1dab-177">Para utilizar el enrutamiento de solo lectura, un cliente debe utilizar un intento de aplicación de solo lectura en la cadena de conexión al conectarse al agente de escucha del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="d1dab-177">To use read-only routing, a client must use an application intent of read-only in the connection string when connecting to the availability group listener.</span></span> <span data-ttu-id="d1dab-178">Sin el intento de aplicación de solo lectura, las conexiones al agente de escucha del grupo de disponibilidad se dirigen a la base de datos en la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="d1dab-178">Without the read-only application intent, connections to the availability group listener are directed to the database on the primary replica.</span></span>  
  
 <span data-ttu-id="d1dab-179">El atributo de la intención de aplicación se almacena en la sesión de cliente durante el inicio de sesión y, después, la instancia de SQL Server procesará esta intención y determinará lo que debe hacer de acuerdo con la configuración del grupo de disponibilidad y el estado de lectura y escritura actual de la base de datos de destino en la réplica secundaria.</span><span class="sxs-lookup"><span data-stu-id="d1dab-179">The application intent attribute is stored in the client's session during login and the instance of SQL Server will then process this intent and determine what to do according to the configuration of the availability group and the current read-write state of the target database in the secondary replica.</span></span>  
  
 <span data-ttu-id="d1dab-180">El siguiente es un ejemplo de una cadena de conexión para el proveedor ADO.NET (System.Data.SqlClient) que designa el intento de solo lectura de la aplicación:</span><span class="sxs-lookup"><span data-stu-id="d1dab-180">An example of a connection string for the ADO.NET provider (System.Data.SqlClient) that designates read-only application intent is as follows:</span></span>  
  
```  
Server=tcp:AGListener,1433;Database=AdventureWorks;IntegratedSecurity=SSPI;ApplicationIntent=ReadOnly  
```  
  
 <span data-ttu-id="d1dab-181">En este ejemplo de cadena de comparación, el cliente intenta conectarse a un agente de escucha del grupo de disponibilidad denominado `AGListener` en el puerto 1433 (también puede omitir el puerto si el agente de escucha del grupo de disponibilidad escucha en 1433).</span><span class="sxs-lookup"><span data-stu-id="d1dab-181">In this connection string example, the client is attempting to connect to an availability group listener named `AGListener` on port 1433 (you may also omit the port if the availability group listener is listening on 1433).</span></span>  <span data-ttu-id="d1dab-182">La cadena de conexión tiene la `ApplicationIntent` propiedad establecida en `ReadOnly` , lo que lo convierte en una *cadena de conexión de intento de lectura*.</span><span class="sxs-lookup"><span data-stu-id="d1dab-182">The connection string has the `ApplicationIntent` property set to `ReadOnly`, making this a *read-intent connection string*.</span></span>  <span data-ttu-id="d1dab-183">Sin este valor, el servidor no habría intentado un enrutamiento de solo lectura de la conexión.</span><span class="sxs-lookup"><span data-stu-id="d1dab-183">Without this setting, the server would not have attempted a read-only routing of the connection.</span></span>  
  
 <span data-ttu-id="d1dab-184">La base de datos principal del grupo de disponibilidad procesa la solicitud de enrutamiento de solo lectura entrante e intenta localizar una réplica en línea de solo lectura que esté unida a la réplica principal y esté configurada para el enrutamiento de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="d1dab-184">The primary database of the availability group processes the incoming read-only routing request and attempts to locate an online, read-only replica that is joined to the primary replica and is configured for read-only routing.</span></span>  <span data-ttu-id="d1dab-185">El cliente recibe información de conexión del servidor de réplica principal y se conecta a la réplica de solo lectura identificada.</span><span class="sxs-lookup"><span data-stu-id="d1dab-185">The client receives back connection information from the primary replica server and connects to the identified read-only replica.</span></span>  
  
 <span data-ttu-id="d1dab-186">Observe que el intento de aplicación se puede enviar de un controlador de cliente a una instancia de nivel inferior de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="d1dab-186">Note that the application intent can be sent from a client driver to a down-level instance of SQL Server.</span></span>  <span data-ttu-id="d1dab-187">En este caso, el intento de aplicación de solo lectura se omite y la conexión continúa normalmente.</span><span class="sxs-lookup"><span data-stu-id="d1dab-187">In this case, application intent of read-only is ignored and the connection proceeds as normal.</span></span>  
  
 <span data-ttu-id="d1dab-188">Puede omitir el enrutamiento de solo lectura si no establece la propiedad de conexión de intención de aplicaciones en `ReadOnly` (cuando no está designada, el valor predeterminado es `ReadWrite` durante el inicio de sesión) o si se conecta directamente a la instancia de réplica principal de SQL Server en lugar de utilizar el nombre del agente de escucha del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="d1dab-188">You can bypass read-only routing by not setting the application intent connection property to `ReadOnly` (when not designated, the default is `ReadWrite` during login) or by connecting directly to the primary replica instance of SQL Server instead of using the availability group listener name.</span></span>  <span data-ttu-id="d1dab-189">El enrutamiento de solo lectura tampoco se producirá si se conecta directamente a una réplica de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="d1dab-189">Read-only routing will also not occur if you connect directly to a read-only replica.</span></span>  
  
####  <a name="related-tasks"></a><a name="RelatedTasksApps"></a> <span data-ttu-id="d1dab-190">Tareas relacionadas</span><span class="sxs-lookup"><span data-stu-id="d1dab-190">Related Tasks</span></span>  
  
-   [<span data-ttu-id="d1dab-191">Compatibilidad de SQL Server Native Client para la alta disponibilidad con recuperación de desastres</span><span class="sxs-lookup"><span data-stu-id="d1dab-191">SQL Server Native Client Support for High Availability, Disaster Recovery</span></span>](../relational-databases/native-client/features/sql-server-native-client-support-for-high-availability-disaster-recovery.md)  
  
-   [<span data-ttu-id="d1dab-192">Usar palabras clave de cadena de conexión con SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="d1dab-192">Using Connection String Keywords with SQL Server Native Client</span></span>](../relational-databases/native-client/applications/using-connection-string-keywords-with-sql-server-native-client.md)  
  
##  <a name="bypassing-availability-group-listeners"></a><a name="BypassAGl"></a><span data-ttu-id="d1dab-193">Omitir agentes de escucha del grupo de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="d1dab-193">Bypassing Availability Group Listeners</span></span>  
 <span data-ttu-id="d1dab-194">Mientras los agentes de escucha del grupo de disponibilidad habilitan la compatibilidad con la redirección de conmutación por error y el enrutamiento de solo lectura, las conexiones de cliente no requieren utilizarlos.</span><span class="sxs-lookup"><span data-stu-id="d1dab-194">While availability group listeners enable support for failover redirection and read-only routing, client connections are not required to use them.</span></span> <span data-ttu-id="d1dab-195">Una conexión de cliente puede hacer referencia directamente a la instancia de SQL Server en lugar de conectarse al agente de escucha del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="d1dab-195">A client connection can also directly reference the instance of SQL Server instead of connecting to the availability group listener.</span></span>  
  
 <span data-ttu-id="d1dab-196">Para la instancia de SQL Server, es irrelevante si una conexión inicia una sesión utilizando el agente de escucha del grupo de disponibilidad o utilizando otro extremo de la instancia.</span><span class="sxs-lookup"><span data-stu-id="d1dab-196">To the instance of SQL Server it is irrelevant whether a connection logs in using the availability group listener or using another instance endpoint.</span></span>  <span data-ttu-id="d1dab-197">La instancia de SQL Server comprobará el estado de la base de datos de destino y permitirá o denegará la conectividad basada en la configuración del grupo de disponibilidad y el estado actual de la base de datos de la instancia.</span><span class="sxs-lookup"><span data-stu-id="d1dab-197">The instance of SQL Server will verify the state of the targeted database and either allow or disallow connectivity based on the configuration of the availability group and the current state of the database on the instance.</span></span>  <span data-ttu-id="d1dab-198">Por ejemplo, si una aplicación cliente se conecta directamente a una instancia de puerto de SQL Server y se conecta a una base de datos de destino hospedada en un grupo de disponibilidad, y la base de datos de destino está en estado principal y en línea, la conectividad se realizará correctamente.</span><span class="sxs-lookup"><span data-stu-id="d1dab-198">For example, if a client application connects directly to a instance of SQL Server port and connects to a target database hosted in an availability group, and the target database is in primary state and online, then connectivity will succeed.</span></span>  <span data-ttu-id="d1dab-199">Si la base de datos de destino está sin conexión o en estado transitorio, la conectividad a la base de datos producirá un error.</span><span class="sxs-lookup"><span data-stu-id="d1dab-199">If the target database is offline or in a transitional state, connectivity to the database will fail.</span></span>  
  
 <span data-ttu-id="d1dab-200">Alternativamente, en la migración de creación de reflejo de la base de datos a [!INCLUDE[ssHADR](../includes/sshadr-md.md)], las aplicaciones pueden especificar la cadena de conexión de creación de reflejo de la base de datos mientras solo exista una réplica secundaria y no permita conexiones de usuario.</span><span class="sxs-lookup"><span data-stu-id="d1dab-200">Alternatively, while migrating from database mirroring to [!INCLUDE[ssHADR](../includes/sshadr-md.md)], applications can specify the database mirroring connection string as long as only one secondary replica exists and it disallows user connections.</span></span> <span data-ttu-id="d1dab-201">Para obtener más información, vea [Usar cadenas de conexión de creación de reflejo de la base de datos con grupos de disponibilidad](#DbmConnectionString), más adelante en esta sección.</span><span class="sxs-lookup"><span data-stu-id="d1dab-201">For more information, see [Using Database-Mirroring Connection Strings with Availability Groups](#DbmConnectionString), later in this section.</span></span>  
  
###  <a name="using-database-mirroring-connection-strings-with-availability-groups"></a><a name="DbmConnectionString"></a><span data-ttu-id="d1dab-202">Usar cadenas de conexión de creación de reflejo de la base de datos con grupos de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="d1dab-202">Using Database-Mirroring Connection Strings with Availability Groups</span></span>  
 <span data-ttu-id="d1dab-203">Si un grupo de disponibilidad posee solo una réplica secundaria y no está configurado para permitir el acceso de lectura a la réplica de disponibilidad secundaria, los clientes pueden conectarse a la réplica de disponibilidad principal utilizando una cadena de conexión de creación de reflejo de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="d1dab-203">If an availability group possesses only one secondary replica and is not configured to allow read-access to the secondary replica, clients can connect to the primary replica by using a database mirroring connection string.</span></span> <span data-ttu-id="d1dab-204">Este enfoque puede ser útil cuando se migra una aplicación existente de creación de reflejo de la base de datos a un grupo de disponibilidad, siempre que se limite el grupo de disponibilidad a dos réplicas de disponibilidad (una réplica principal y una réplica secundaria).</span><span class="sxs-lookup"><span data-stu-id="d1dab-204">This approach can be useful while migrating an existing application from database mirroring to an availability group, as long as you limit the availability group to two availability replicas (a primary replica and one secondary replica).</span></span> <span data-ttu-id="d1dab-205">Si agrega réplicas secundarias adicionales, deberá crear un agente de escucha del grupo de disponibilidad y actualizar sus aplicaciones para que se utilice el nombre DNS del agente de escucha del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="d1dab-205">If you add additional secondary replicas, you will need to create an availability group listener for the availability group and update your applications to use the availability group listener DNS name.</span></span>  
  
 <span data-ttu-id="d1dab-206">Cuando se utilizan cadenas de conexión de creación de reflejo de la base de datos, el cliente puede usar [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Native Client o el proveedor de datos de .NET Framework para [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d1dab-206">When using database mirroring connection strings, the client can use either [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Native Client or .NET Framework Data Provider for [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="d1dab-207">La cadena de conexión proporcionada por un cliente debe proporcionar como mínimo el nombre de una instancia del servidor, el *nombre del asociado inicial*, para identificar la instancia del servidor que hospeda inicialmente la réplica de disponibilidad con la que se desea establecer conexión.</span><span class="sxs-lookup"><span data-stu-id="d1dab-207">The connection string provided by a client must minimally supply the name of one server instance, the *initial partner name*, to identify the server instance that initially hosts the availability replica to which you intend to connect.</span></span> <span data-ttu-id="d1dab-208">Opcionalmente, la cadena de conexión también puede proporcionar el nombre de otra instancia del servidor, *nombre del asociado de conmutación por error*, para identificar la instancia del servidor que hospeda inicialmente la réplica secundaria como nombre del asociado de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="d1dab-208">Optionally, the connection string can also supply the name of another server instance, the *failover partner name*, to identify the server instance that initially hosts the secondary replica as the failover partner name.</span></span>  
  
 <span data-ttu-id="d1dab-209">Para obtener más información sobre las cadenas de conexión de creación de reflejo de la base de datos, vea [Conectar clientes a una sesión de creación de reflejo de la base de datos &#40;SQL Server&#41;](database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="d1dab-209">For more information about database mirroring connection strings, see [Connect Clients to a Database Mirroring Session &#40;SQL Server&#41;](database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md).</span></span>  
  
##  <a name="behavior-of-client-connections-on-failover"></a><a name="CCBehaviorOnFailover"></a><span data-ttu-id="d1dab-210">Comportamiento de las conexiones de cliente en la conmutación por error</span><span class="sxs-lookup"><span data-stu-id="d1dab-210">Behavior of Client Connections on Failover</span></span>  
 <span data-ttu-id="d1dab-211">Cuando se produce una conmutación por error de grupo de disponibilidad, las conexiones persistentes existentes al grupo de disponibilidad se terminan y el cliente debe establecer una nueva conexión para continuar trabajando con la misma base de datos principal o una base de datos secundaria de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="d1dab-211">When an availability group failover occurs, existing persistent connections to the availability group are terminated and the client must establish a new connection in order to continue working with the same primary database or read-only secondary database.</span></span>  <span data-ttu-id="d1dab-212">Mientras una conmutación por error se produce en el servidor, la conectividad al grupo de disponibilidad puede sufrir un error, forzando a la aplicación cliente a volver a intentar la conexión hasta que el servidor principal vuelve a ponerse totalmente en línea.</span><span class="sxs-lookup"><span data-stu-id="d1dab-212">While a failover is occurring on the server side, connectivity to the availability group may fail, forcing the client application to retry connecting until the primary is brought fully back online.</span></span>  
  
 <span data-ttu-id="d1dab-213">Si el grupo de disponibilidad vuelve a ponerse en línea durante el intento de conexión de una aplicación cliente pero antes del tiempo de espera de conexión, el controlador cliente puede conectarse correctamente durante uno de los intentos internos de reintento y no se producirá ningún error en la aplicación en este caso.</span><span class="sxs-lookup"><span data-stu-id="d1dab-213">If the availability group comes back online during a client application's connection attempt but before the connect timeout period, the client driver may successfully connect during one of its internal retry attempts and no error will be surfaced to the application in this case.</span></span>  
  
##  <a name="supporting-availability-group-multi-subnet-failovers"></a><a name="SupportAgMultiSubnetFailover"></a> <span data-ttu-id="d1dab-214">Compatibilidad con clústeres de conmutación por error de varias subredes de grupo de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="d1dab-214">Supporting Availability Group Multi-Subnet Failovers</span></span>  
 <span data-ttu-id="d1dab-215">Si usa bibliotecas cliente que admiten la opción de conexión MultiSubnetFailover en la cadena de conexión, puede optimizar la conmutación por error del grupo de disponibilidad a otra subred si establece MultiSubnetFailover en "True" o "Yes", en función de la sintaxis del proveedor que use.</span><span class="sxs-lookup"><span data-stu-id="d1dab-215">If you are using client libraries that support the MultiSubnetFailover connection option in the connection string, you can optimize availability group failover to a different subnet by setting MultiSubnetFailover to "True" or "Yes", depending on the syntax of the provider you are using.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d1dab-216">Se recomienda esta configuración para las conexiones de una red y de varias subredes a los agentes de escucha del grupo de disponibilidad y a los nombres de instancia de clúster de conmutación por error de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="d1dab-216">We recommend this setting for both single and multi-subnet connections to availability groups listeners and to SQL Server Failover Cluster Instance names.</span></span>  <span data-ttu-id="d1dab-217">La habilitación de esta opción agrega optimizaciones adicionales, incluso en escenarios de una sola subred.</span><span class="sxs-lookup"><span data-stu-id="d1dab-217">Enabling this option adds additional optimizations, even for single-subnet scenarios.</span></span>  
  
 <span data-ttu-id="d1dab-218">La opción de conexión `MultiSubnetFailover` solo funciona con el protocolo de red TCP y solo se admite en la conexión a un agente de escucha del grupo de disponibilidad y para cualquier nombre de red virtual que se conecta a [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d1dab-218">The `MultiSubnetFailover` connection option only works with the TCP network protocol and is only supported when connecting to an availability group listener and for any virtual network name connecting to [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)].</span></span>  
  
 <span data-ttu-id="d1dab-219">El siguiente es un ejemplo de cadena de conexión del proveedor ADO.NET (System.Data.SqlClient) que habilita la conmutación por error de varias subredes:</span><span class="sxs-lookup"><span data-stu-id="d1dab-219">An example of a for the ADO.NET provider (System.Data.SqlClient) connection string that enables multi-subnet failover is as follows:</span></span>  
  
```  
Server=tcp:AGListener,1433;Database=AdventureWorks;IntegratedSecurity=SSPI; MultiSubnetFailover=True  
```  
  
 <span data-ttu-id="d1dab-220">La opción de conexión `MultiSubnetFailover` debe establecerse en `True` aunque el grupo de disponibilidad solo abarque una única subred.</span><span class="sxs-lookup"><span data-stu-id="d1dab-220">The `MultiSubnetFailover` connection option should be set to `True` even if the availability group only spans a single subnet.</span></span>  <span data-ttu-id="d1dab-221">Esto permite preconfigurar nuevos clientes que puedan abarca en el futuro subredes sin necesidad de los cambios en la cadena de conexión de cliente y también optimiza el rendimiento de conmutación por error para conmutaciones por error de las subredes.</span><span class="sxs-lookup"><span data-stu-id="d1dab-221">This allows you to preconfigure new clients to support future spanning of subnets without any need for future client connection string changes and also optimizes failover performance for single subnet failovers.</span></span>  <span data-ttu-id="d1dab-222">Cuando la opción de conexión `MultiSubnetFailover` no es necesaria, proporciona la ventaja de una conmutación por error más rápida de la subred.</span><span class="sxs-lookup"><span data-stu-id="d1dab-222">While the `MultiSubnetFailover` connection option is not required, it does provide the benefit of a faster subnet failover.</span></span>  <span data-ttu-id="d1dab-223">Esto se debe a que el controlador cliente intentará abrir un socket de TCP para cada dirección IP en paralelo asociada al grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="d1dab-223">This is because the client driver will attempt to open up a TCP socket for each IP address in parallel associated with the availability group.</span></span>  <span data-ttu-id="d1dab-224">El controlador cliente esperará que la primera dirección IP responda y, una vez que lo haga, la utilizará para la conexión.</span><span class="sxs-lookup"><span data-stu-id="d1dab-224">The client driver will wait for the first IP to respond with success and once it does, will then use it for the connection.</span></span>  
  
##  <a name="availability-group-listeners-and-ssl-certificates"></a><a name="SSLcertificates"></a> <span data-ttu-id="d1dab-225">Agentes de escucha del grupo de disponibilidad y certificados SSL</span><span class="sxs-lookup"><span data-stu-id="d1dab-225">Availability Group Listeners and SSL Certificates</span></span>  
 <span data-ttu-id="d1dab-226">Al conectarse a un agente de escucha del grupo de disponibilidad, si las instancias participantes de SQL Server utilizan certificados SSL junto con cifrado de sesión, el controlador cliente de conexión deberá admitir el nombre alternativo del asunto del certificado SSL para forzar el cifrado.</span><span class="sxs-lookup"><span data-stu-id="d1dab-226">When connecting to an availability group listener, if the participating instances of SQL Server use SSL certificates in conjunction with session encryption, the connecting client driver will need to support the Subject Alternate Name in the SSL certificate in order to force encryption.</span></span>  <span data-ttu-id="d1dab-227">La compatibilidad del controlador de SQL Server con el nombre alternativo del asunto del certificado está previsto para ADO.NET (SqlClient), Microsoft JDBC y SQL Native Client (SNAC).</span><span class="sxs-lookup"><span data-stu-id="d1dab-227">SQL Server driver support for certificate Subject Alternative Name is planned for ADO.NET (SqlClient), Microsoft JDBC and SQL Native Client (SNAC).</span></span>  
  
 <span data-ttu-id="d1dab-228">Se debe configurar un certificado X.509 para cada nodo de servidor participante en el clúster de conmutación por error con una lista de todos los agentes de escucha del grupo de disponibilidad establecidos en el nombre alternativo del asunto del certificado.</span><span class="sxs-lookup"><span data-stu-id="d1dab-228">A X.509 certificate must be configured for each participating server node in the failover cluster with a list of all availability group listeners set in the Subject Alternate Name of the certificate.</span></span>  
  
 <span data-ttu-id="d1dab-229">Por ejemplo, si el WSFC tiene tres agentes de escucha del grupo de disponibilidad con los nombres `AG1_listener.Adventure-Works.com`, `AG2_listener.Adventure-Works.com`y `AG3_listener.Adventure-Works.com`, el nombre alternativo del asunto del certificado debe establecerse del modo siguiente:</span><span class="sxs-lookup"><span data-stu-id="d1dab-229">For example, if the WSFC has three availability group listeners with the names `AG1_listener.Adventure-Works.com`, `AG2_listener.Adventure-Works.com`, and `AG3_listener.Adventure-Works.com`, the Subject Alternative Name for the certificate should be set as follows:</span></span>  
  
```  
CN = ServerFQDN  
SAN = ServerFQDN,AG1_listener.Adventure-Works.com, AG2_listener.Adventure-Works.com, AG3_listener.Adventure-Works.com  
```  
  
##  <a name="availability-group-listeners-and-server-principal-names-spns"></a><a name="SPNs"></a><span data-ttu-id="d1dab-230">Agentes de escucha del grupo de disponibilidad y nombres principales de servidor (SPN)</span><span class="sxs-lookup"><span data-stu-id="d1dab-230">Availability Group Listeners and Server Principal Names (SPNs)</span></span>  
 <span data-ttu-id="d1dab-231">Un nombre principal del servidor debe ser configurado en Active Directory por un administrador de dominio para cada nombre de agente de escucha del grupo de disponibilidad con el fin de habilitar Kerberos para la conexión de cliente con el agente de escucha del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="d1dab-231">A Server Principal Name (SPN) must be configured in Active Directory by a domain administrator for each availability group listener name in order to enable Kerberos for the client connection to the availability group listener.</span></span> <span data-ttu-id="d1dab-232">Al registrar el SPN, debe usar la cuenta de servicio de la instancia del servidor que hospeda la réplica de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="d1dab-232">When registering the SPN, you must use the service account of the server instance that hosts the availability replica .</span></span>  <span data-ttu-id="d1dab-233">Para que el SPN funcione en todas las réplicas, debe utilizarse la misma cuenta de servicio para todas las instancias del clúster de WSFC que hospeda el grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="d1dab-233">For the SPN to work across all replicas, the same service account must be used for all instances in the WSFC cluster that hosts the availability group.</span></span>  
  
 <span data-ttu-id="d1dab-234">Utilice la herramienta de línea de comandos de Windows `setspn` para configurar el SPN.</span><span class="sxs-lookup"><span data-stu-id="d1dab-234">Use the `setspn` Windows command line tool to configure the SPN.</span></span>  <span data-ttu-id="d1dab-235">Por ejemplo, para configurar un SPN para un grupo de disponibilidad denominado `AG1listener.Adventure-Works.com` hospedado en un conjunto de instancias de SQL Server configuradas para ejecutarse en la cuenta de dominio `corp/svclogin2`:</span><span class="sxs-lookup"><span data-stu-id="d1dab-235">For example to configure an SPN for an availability group named `AG1listener.Adventure-Works.com` hosted on a set of instances of SQL Server all configured to run under the domain account `corp/svclogin2`:</span></span>  
  
```cmd
setspn -A MSSQLSvc/AG1listener.Adventure-Works.com:1433 corp/svclogin2  
```  
  
 <span data-ttu-id="d1dab-236">Para obtener más información acerca del registro manual de un SPN para SQL Server, vea [Registrar un nombre de entidad de seguridad de servicio para las conexiones con Kerberos](configure-windows/register-a-service-principal-name-for-kerberos-connections.md).</span><span class="sxs-lookup"><span data-stu-id="d1dab-236">For more information about manual registration of a SPN for SQL Server, see [Register a Service Principal Name for Kerberos Connections](configure-windows/register-a-service-principal-name-for-kerberos-connections.md).</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="d1dab-237">Tareas relacionadas</span><span class="sxs-lookup"><span data-stu-id="d1dab-237">Related Tasks</span></span>  
  
-   [<span data-ttu-id="d1dab-238">SQL Server de conectividad de cliente de AlwaysOn &#40;&#41;</span><span class="sxs-lookup"><span data-stu-id="d1dab-238">AlwaysOn Client Connectivity &#40;SQL Server&#41;</span></span>](availability-groups/windows/always-on-client-connectivity-sql-server.md)
  
-   [<span data-ttu-id="d1dab-239">Crear o configurar un agente de escucha de grupo de disponibilidad &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d1dab-239">Create or Configure an Availability Group Listener &#40;SQL Server&#41;</span></span>](availability-groups/windows/create-or-configure-an-availability-group-listener-sql-server.md)  
  
-   [<span data-ttu-id="d1dab-240">Ver las propiedades del agente de escucha de grupo de disponibilidad &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d1dab-240">View Availability Group Listener Properties &#40;SQL Server&#41;</span></span>](availability-groups/windows/view-availability-group-listener-properties-sql-server.md)  
  
-   [<span data-ttu-id="d1dab-241">Quitar un agente de escucha de grupo de disponibilidad &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d1dab-241">Remove an Availability Group Listener &#40;SQL Server&#41;</span></span>](availability-groups/windows/remove-an-availability-group-listener-sql-server.md)  
  
-   [<span data-ttu-id="d1dab-242">Configurar el acceso de solo lectura en una réplica de disponibilidad &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d1dab-242">Configure Read-Only Access on an Availability Replica &#40;SQL Server&#41;</span></span>](availability-groups/windows/configure-read-only-access-on-an-availability-replica-sql-server.md)  
  
-   [<span data-ttu-id="d1dab-243">Configurar el enrutamiento de solo lectura para un grupo de disponibilidad &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d1dab-243">Configure Read-Only Routing for an Availability Group &#40;SQL Server&#41;</span></span>](availability-groups/windows/configure-read-only-routing-for-an-availability-group-sql-server.md)  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="d1dab-244">Contenido relacionado</span><span class="sxs-lookup"><span data-stu-id="d1dab-244">Related Content</span></span>  
  
-   [<span data-ttu-id="d1dab-245">Guía de soluciones AlwaysOn de Microsoft SQL Server para lograr alta disponibilidad y recuperación ante desastres</span><span class="sxs-lookup"><span data-stu-id="d1dab-245">Microsoft SQL Server AlwaysOn Solutions Guide for High Availability and Disaster Recovery</span></span>](https://go.microsoft.com/fwlink/?LinkId=227600)  
  
-   <span data-ttu-id="d1dab-246">[Introducción al agente de escucha del grupo de la disponibilidad](https://blogs.msdn.com/b/sqlalwayson/archive/2012/01/16/introduction-to-the-availability-group-listener.aspx) (un blog del equipo de SQL Server AlwaysOn)</span><span class="sxs-lookup"><span data-stu-id="d1dab-246">[Introduction to the Availability Group Listener](https://blogs.msdn.com/b/sqlalwayson/archive/2012/01/16/introduction-to-the-availability-group-listener.aspx) (a SQL Server AlwaysOn team blog)</span></span>  
  
-   [<span data-ttu-id="d1dab-247">Blog del equipo de AlwaysOn de SQL Server: el blog del equipo de AlwaysOn oficial de SQL Server</span><span class="sxs-lookup"><span data-stu-id="d1dab-247">SQL Server AlwaysOn Team Blog: The official SQL Server AlwaysOn Team Blog</span></span>](https://blogs.msdn.com/b/sqlalwayson/)  
  
## <a name="see-also"></a><span data-ttu-id="d1dab-248">Consulte también</span><span class="sxs-lookup"><span data-stu-id="d1dab-248">See Also</span></span>  
 <span data-ttu-id="d1dab-249">[Información general de Grupos de disponibilidad AlwaysOn &#40;SQL Server&#41;](availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="d1dab-249">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md) </span></span>  
 [<span data-ttu-id="d1dab-250">SQL Server de conectividad de cliente de AlwaysOn &#40;&#41;</span><span class="sxs-lookup"><span data-stu-id="d1dab-250">AlwaysOn Client Connectivity &#40;SQL Server&#41;</span></span>](availability-groups/windows/always-on-client-connectivity-sql-server.md)  
 <span data-ttu-id="d1dab-251">[Acerca del acceso de conexión de cliente a réplicas de disponibilidad &#40;SQL Server&#41;](availability-groups/windows/about-client-connection-access-to-availability-replicas-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="d1dab-251">[About Client Connection Access to Availability Replicas &#40;SQL Server&#41;](availability-groups/windows/about-client-connection-access-to-availability-replicas-sql-server.md) </span></span>  
 <span data-ttu-id="d1dab-252">[Secundarias activas: réplicas secundarias legibles &#40;Grupos de disponibilidad AlwaysOn&#41;](availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md) </span><span class="sxs-lookup"><span data-stu-id="d1dab-252">[Active Secondaries: Readable Secondary Replicas &#40;AlwaysOn Availability Groups&#41;](availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md) </span></span>  
 [<span data-ttu-id="d1dab-253">Conectar clientes a una sesión de creación de reflejo de la base de datos &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d1dab-253">Connect Clients to a Database Mirroring Session &#40;SQL Server&#41;</span></span>](database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md)
